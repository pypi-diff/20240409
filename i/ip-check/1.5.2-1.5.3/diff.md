# Comparing `tmp/ip_check-1.5.2-py3-none-any.whl.zip` & `tmp/ip_check-1.5.3-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,25 +1,33 @@
-Zip file size: 34501 bytes, number of entries: 23
--rw-rw-r--  2.0 unx      383 b- defN 24-Mar-19 12:04 ipcheck/__init__.py
--rw-rw-r--  2.0 unx     6609 b- defN 24-Apr-03 13:41 ipcheck/geoinfo.py
--rw-rw-r--  2.0 unx    10445 b- defN 24-Apr-08 10:39 ipcheck/main.py
--rw-rw-r--  2.0 unx        0 b- defN 24-Mar-15 13:36 ipcheck/app/__init__.py
--rw-rw-r--  2.0 unx      726 b- defN 24-Mar-15 13:36 ipcheck/app/base_config.py
--rw-rw-r--  2.0 unx      388 b- defN 24-Mar-15 13:36 ipcheck/app/common_config.py
--rw-rw-r--  2.0 unx     6052 b- defN 24-Apr-03 13:41 ipcheck/app/config.py
--rw-rw-r--  2.0 unx     1773 b- defN 24-Mar-19 12:04 ipcheck/app/default_config.py
--rw-rw-r--  2.0 unx     2310 b- defN 24-Apr-08 10:49 ipcheck/app/gen_ip_utils.py
--rw-rw-r--  2.0 unx     1894 b- defN 24-Apr-08 11:11 ipcheck/app/ip_info.py
--rw-rw-r--  2.0 unx     2546 b- defN 24-Mar-15 13:36 ipcheck/app/rtt_test.py
--rw-rw-r--  2.0 unx      223 b- defN 24-Mar-15 13:36 ipcheck/app/rtt_test_config.py
--rw-rw-r--  2.0 unx     5656 b- defN 24-Apr-08 10:39 ipcheck/app/speed_test.py
--rw-rw-r--  2.0 unx      223 b- defN 24-Mar-15 13:36 ipcheck/app/speed_test_config.py
--rw-rw-r--  2.0 unx     3435 b- defN 24-Apr-08 10:39 ipcheck/app/utils.py
--rw-rw-r--  2.0 unx     3797 b- defN 24-Apr-08 10:39 ipcheck/app/valid_test.py
--rw-rw-r--  2.0 unx      303 b- defN 24-Mar-15 13:36 ipcheck/app/valid_test_config.py
--rw-r--r--  2.0 unx    35148 b- defN 24-Apr-08 12:22 ip_check-1.5.2.dist-info/LICENSE
--rw-rw-r--  2.0 unx     5266 b- defN 24-Apr-08 12:22 ip_check-1.5.2.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 24-Apr-08 12:22 ip_check-1.5.2.dist-info/WHEEL
--rwxrwxrwx  2.0 unx      201 b- defN 24-Apr-08 12:22 ip_check-1.5.2.dist-info/entry_points.txt
--rwxrwxrwx  2.0 unx        8 b- defN 24-Apr-08 12:22 ip_check-1.5.2.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     1864 b- defN 24-Apr-08 12:22 ip_check-1.5.2.dist-info/RECORD
-23 files, 89342 bytes uncompressed, 31491 bytes compressed:  64.8%
+Zip file size: 38150 bytes, number of entries: 31
+-rw-rw-r--  2.0 unx      383 b- defN 24-Mar-19 08:00 ipcheck/__init__.py
+-rw-rw-r--  2.0 unx     6609 b- defN 24-Apr-02 02:06 ipcheck/geoinfo.py
+-rw-rw-r--  2.0 unx    10450 b- defN 24-Apr-09 02:49 ipcheck/main.py
+-rw-rw-r--  2.0 unx        0 b- defN 24-Mar-14 08:04 ipcheck/app/__init__.py
+-rw-rw-r--  2.0 unx      726 b- defN 24-Mar-14 08:04 ipcheck/app/base_config.py
+-rw-rw-r--  2.0 unx      388 b- defN 24-Mar-14 08:04 ipcheck/app/common_config.py
+-rw-rw-r--  2.0 unx     6052 b- defN 24-Mar-25 07:07 ipcheck/app/config.py
+-rw-rw-r--  2.0 unx     1773 b- defN 24-Mar-19 08:00 ipcheck/app/default_config.py
+-rw-rw-r--  2.0 unx     1233 b- defN 24-Apr-09 03:10 ipcheck/app/gen_ip_utils.py
+-rw-rw-r--  2.0 unx     1894 b- defN 24-Apr-09 01:00 ipcheck/app/ip_info.py
+-rw-rw-r--  2.0 unx     2546 b- defN 24-Mar-14 08:04 ipcheck/app/rtt_test.py
+-rw-rw-r--  2.0 unx      223 b- defN 24-Mar-14 08:04 ipcheck/app/rtt_test_config.py
+-rw-rw-r--  2.0 unx     5656 b- defN 24-Apr-08 09:02 ipcheck/app/speed_test.py
+-rw-rw-r--  2.0 unx      223 b- defN 24-Mar-14 08:04 ipcheck/app/speed_test_config.py
+-rw-rw-r--  2.0 unx     2537 b- defN 24-Apr-09 02:27 ipcheck/app/utils.py
+-rw-rw-r--  2.0 unx     3753 b- defN 24-Apr-09 02:54 ipcheck/app/valid_test.py
+-rw-rw-r--  2.0 unx      362 b- defN 24-Apr-09 01:09 ipcheck/app/valid_test_config.py
+-rw-rw-r--  2.0 unx        0 b- defN 24-Apr-09 01:18 ipcheck/app/ipparser/__init__.py
+-rw-rw-r--  2.0 unx      364 b- defN 24-Apr-09 02:58 ipcheck/app/ipparser/base_parser.py
+-rw-rw-r--  2.0 unx      671 b- defN 24-Apr-09 02:57 ipcheck/app/ipparser/ip_cidr_parser.py
+-rw-rw-r--  2.0 unx      749 b- defN 24-Apr-09 03:11 ipcheck/app/ipparser/ip_dir_parser.py
+-rw-rw-r--  2.0 unx     1110 b- defN 24-Apr-09 03:05 ipcheck/app/ipparser/ip_file_parser.py
+-rw-rw-r--  2.0 unx      502 b- defN 24-Apr-09 02:57 ipcheck/app/ipparser/ip_parser.py
+-rw-r--r--  2.0 unx      738 b- defN 24-Apr-09 02:56 ipcheck/app/ipparser/ip_path_parser.py
+-rw-rw-r--  2.0 unx     1071 b- defN 24-Apr-09 02:56 ipcheck/app/ipparser/ip_port_parser.py
+-rw-rw-r--  2.0 unx    35148 b- defN 24-Apr-09 03:37 ip_check-1.5.3.dist-info/LICENSE
+-rw-rw-r--  2.0 unx     5417 b- defN 24-Apr-09 03:37 ip_check-1.5.3.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 24-Apr-09 03:37 ip_check-1.5.3.dist-info/WHEEL
+-rw-r--r--  2.0 unx      201 b- defN 24-Apr-09 03:37 ip_check-1.5.3.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        8 b- defN 24-Apr-09 03:37 ip_check-1.5.3.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     2601 b- defN 24-Apr-09 03:37 ip_check-1.5.3.dist-info/RECORD
+31 files, 93480 bytes uncompressed, 33954 bytes compressed:  63.7%
```

## zipnote {}

```diff
@@ -45,26 +45,50 @@
 
 Filename: ipcheck/app/valid_test.py
 Comment: 
 
 Filename: ipcheck/app/valid_test_config.py
 Comment: 
 
-Filename: ip_check-1.5.2.dist-info/LICENSE
+Filename: ipcheck/app/ipparser/__init__.py
 Comment: 
 
-Filename: ip_check-1.5.2.dist-info/METADATA
+Filename: ipcheck/app/ipparser/base_parser.py
 Comment: 
 
-Filename: ip_check-1.5.2.dist-info/WHEEL
+Filename: ipcheck/app/ipparser/ip_cidr_parser.py
 Comment: 
 
-Filename: ip_check-1.5.2.dist-info/entry_points.txt
+Filename: ipcheck/app/ipparser/ip_dir_parser.py
 Comment: 
 
-Filename: ip_check-1.5.2.dist-info/top_level.txt
+Filename: ipcheck/app/ipparser/ip_file_parser.py
 Comment: 
 
-Filename: ip_check-1.5.2.dist-info/RECORD
+Filename: ipcheck/app/ipparser/ip_parser.py
+Comment: 
+
+Filename: ipcheck/app/ipparser/ip_path_parser.py
+Comment: 
+
+Filename: ipcheck/app/ipparser/ip_port_parser.py
+Comment: 
+
+Filename: ip_check-1.5.3.dist-info/LICENSE
+Comment: 
+
+Filename: ip_check-1.5.3.dist-info/METADATA
+Comment: 
+
+Filename: ip_check-1.5.3.dist-info/WHEEL
+Comment: 
+
+Filename: ip_check-1.5.3.dist-info/entry_points.txt
+Comment: 
+
+Filename: ip_check-1.5.3.dist-info/top_level.txt
+Comment: 
+
+Filename: ip_check-1.5.3.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## ipcheck/main.py

```diff
@@ -138,15 +138,15 @@
     config.rt_max_loss = loss
     return config
 
 # 生成ip 列表
 def gen_ip_list(config: Config):
     ip_list = []
     for source in config.ip_source:
-        ip_list += gen_ip_list_by_arg(source, port=config.ip_port)
+        ip_list.extend(gen_ip_list_by_arg(source, port=config.ip_port))
     ip_list = list(dict.fromkeys(ip_list))
     if config.white_list:
         ip_list = filter_ip_list_by_white_list(ip_list, config.white_list)
     if config.block_list:
         ip_list = filter_ip_list_by_block_list(ip_list, config.block_list)
     random.shuffle(ip_list)
     return ip_list
```

## ipcheck/app/gen_ip_utils.py

```diff
@@ -1,68 +1,34 @@
 #!/usr/bin/env python3
 # -*- coding: utf-8 -*-
 
-import os
+
 from typing import List
-from ipcheck.app.utils import is_ip_address, is_ip_network, gen_ip_form_network, find_txt_in_dir, parse_ip_info_from_str
 from ipcheck.app.ip_info import IpInfo
+from ipcheck.app.ipparser.ip_dir_parser import IpDirParser
+from ipcheck.app.ipparser.ip_file_parser import IpFileParser
+from ipcheck.app.ipparser.ip_cidr_parser import IpCidrParser
+from ipcheck.app.ipparser.ip_parser import IpParser
+from ipcheck.app.ipparser.ip_port_parser import IpPortParser
 
 
 def gen_ip_list_by_arg(source, port=443) -> List[IpInfo]:
     ip_list = []
-    if os.path.exists(source):
-        ip_list = read_all_ips_form_path(source, port)
-    elif is_ip_network(source):
-        ip_list = gen_ip_form_network(source)
-    elif is_ip_address(source):
-        ip_list.append(IpInfo(source, port))
-    else:
-        ip_info = parse_ip_info_from_str(source)
-        if ip_info:
-            ip_list.append(ip_info)
-    # fixed_ips = [f'[{item}]' if get_ip_version(item) == 6 else item for item in ip_list]
+    parsers = [IpDirParser(source, port), IpFileParser(source, port), IpCidrParser(source, port), IpParser(source, port), IpPortParser(source, port)]
+    for parser in parsers:
+        if parser.is_valid:
+            ips = parser.parse()
+            ip_list.extend(ips)
+            break
     return ip_list
 
-def read_all_ips_form_path(path, port=443):
-    all_ip_files = []
-    all_ips = []
-    if os.path.isdir(os.path.abspath(path)):
-        all_ip_files = find_txt_in_dir(path)
-    else:
-        all_ip_files.append(path)
-    for file in all_ip_files:
-        all_ips += read_all_ips_form_file(file, port)
-    all_ips = list(dict.fromkeys(all_ips))
-    return all_ips
-
-
-def read_all_ips_form_file(file, port=443) -> List[IpInfo]:
-    all_ips = []
-    ip_networks = []
-    with open(file, 'r') as f:
-        for line in f.readlines():
-            if is_ip_address(line.strip()):
-                all_ips.append(IpInfo(line.strip(), port))
-            elif is_ip_network(line.strip()):
-                ip_networks.append(line.strip())
-            else:
-                ip_info = parse_ip_info_from_str(line.strip())
-                if ip_info:
-                    all_ips.append(ip_info)
-    ip_networks = list(dict.fromkeys(ip_networks))
-    for ip_network in ip_networks:
-        all_ips += gen_ip_form_network(ip_network)
-    all_ips = list(dict.fromkeys(all_ips))
-    return all_ips
-
-
 def filter_ip_list_by_white_list(ip_list, white_list):
     fixed_list = []
     for pref_str in white_list:
-        fixed_list += [ip_info for ip_info in ip_list if ip_info.ip.startswith(pref_str)]
+        fixed_list = [ip_info for ip_info in ip_list if ip_info.ip.startswith(pref_str)]
     return fixed_list
 
 def filter_ip_list_by_block_list(ip_list, block_list):
     fixed_list = []
     for block_str in block_list:
         fixed_list = [ip_info for ip_info in ip_list if not ip_info.ip.startswith(block_str)]
     return fixed_list
```

## ipcheck/app/utils.py

```diff
@@ -1,11 +1,10 @@
 #!/usr/bin/env python3
 # -*- coding: utf-8 -*-
 
-
 import ipaddress
 import os
 import random
 from datetime import datetime
 import sys
 import requests
 from tqdm import tqdm
@@ -27,49 +26,21 @@
         return False
 
 
 def get_ip_version(ip_str: str):
     ip = ipaddress.ip_address(ip_str)
     return ip.version
 
-
-def gen_ip_form_network(ip_str):
-    from ipcheck.app.ip_info import IpInfo
-    net = ipaddress.ip_network(ip_str, strict=False)
-    hosts = list(net.hosts())
-    all_ips = [IpInfo(str(ip)) for ip in hosts]
-    return all_ips
-
 def is_valid_port(port_str):
     try:
         port = int(port_str)
         return 0 < port <= 65535
     except ValueError:
         return False
 
-def parse_ip_info_from_str(expr_str : str):
-    from ipcheck.app.ip_info import IpInfo
-    try:
-        index = expr_str.rindex(':')
-        ip_str = expr_str[:index]
-        port_str = expr_str[index + 1:]
-        if not is_valid_port(port_str):
-            return None
-        if ip_str.startswith('[') and ip_str.endswith(']'):
-            ip_str = ip_str[1: -1]
-            if is_ip_address(ip_str) and get_ip_version(ip_str) == 6:
-                return IpInfo(ip_str, int(port_str))
-        else:
-            if is_ip_address(ip_str) and get_ip_version(ip_str) == 4:
-                return IpInfo(ip_str, int(port_str))
-    except:
-        pass
-    return None
-
-
 def find_txt_in_dir(dir):
     L = []
     if os.path.isdir(dir):
         for f in os.listdir(dir):
             file = os.path.join(dir, f)
             if os.path.isfile(file) and file.endswith('.txt'):
                 L.append(file)
```

## ipcheck/app/valid_test.py

```diff
@@ -18,15 +18,15 @@
     def __init__(self, ip_list: List[IpInfo], config: ValidTestConfig) -> None:
         self.ip_list = ip_list
         self.config = config
 
     def run(self) -> List[IpInfo]:
         if not self.config.enabled:
             print('跳过可用性测试')
-            return [IpInfo(ip, self.config.ip_port) for ip in self.ip_list]
+            return self.ip_list
         print('准备测试可用性 ... ...')
         print('可用性域名为: {}'.format(self.config.host_name))
         print('是否使用user-agent: {}'.format(self.config.user_agent))
         if len(self.ip_list) > self.config.ip_limit_count:
             print('待测试ip 过多，当前最大限制数量为{} 个，压缩中... ...'.format(self.config.ip_limit_count))
             self.ip_list = adjust_list_by_size(self.ip_list, self.config.ip_limit_count)
         total_count = len(self.ip_list)
```

## ipcheck/app/valid_test_config.py

```diff
@@ -6,9 +6,10 @@
 CONFIG_PREFIX = 'vt_'
 
 class ValidTestConfig(BaseConfig):
 
     def get_config_prefix(self) -> str:
         return CONFIG_PREFIX
 
-    def gen_cf_extra_part(self, config):
-        self.ip_port = config.ip_port
+    # 由于引入了新的参数方法，已经无用
+    # def gen_cf_extra_part(self, config):
+    #     self.ip_port = config.ip_port
```

### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

## Comparing `ip_check-1.5.2.dist-info/LICENSE` & `ip_check-1.5.3.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `ip_check-1.5.2.dist-info/METADATA` & `ip_check-1.5.3.dist-info/METADATA`

 * *Files 9% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: ip-check
-Version: 1.5.2
+Version: 1.5.3
 Summary: Powerful cdn network speed test utils.
 Author: nobitaqaq
 Author-email: xiaoleigs@gmail.com
 Keywords: cdn,speed test,network speed
 Requires-Python: >=3.8
 Description-Content-Type: text/markdown
 License-File: LICENSE
@@ -79,14 +79,15 @@
 ```shell
 # 文本参数，文本中内容支持ip、ip cidr、支持ipv6
 ip-check test.txt
 
 # ip 参数，支持ip、ip cidr、支持ipv6
 ip-check 192.168.1.1/32
 ip-check fe80::/ 10
+ip-check 1.1.1.1:443
 
 # 禁用可用性测试，某些情况可用性测试失效，可临时禁用。
 ip-check test.txt -dv
 # 禁用rtt 测试，某些情况rtt 测试失效，可临时禁用。
 ip-check test.txt -dr
 
 # ip 偏好，假设你偏好8和9 开头的ip
@@ -171,7 +172,15 @@
 usage: igeo-cfg [-h]
 
 geo-cfg 编辑geo config
 
 optional arguments:
   -h, --help  show this help message and exit
 ```
+
+## Release Note
+
+- V1.5.3
+  - 把ip 输入源解析重构，方便以后拓展
+
+- V1.5.2
+  - ip 传递参数新增ip:port 格式
```

