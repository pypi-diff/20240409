# Comparing `tmp/phidl-1.6.4.tar.gz` & `tmp/phidl-1.7.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "phidl-1.6.4.tar", last modified: Thu Jul 20 18:11:35 2023, max compression
+gzip compressed data, was "phidl-1.7.0.tar", last modified: Tue Apr  9 17:37:42 2024, max compression
```

## Comparing `phidl-1.6.4.tar` & `phidl-1.7.0.tar`

### file list

```diff
@@ -1,29 +1,28 @@
-drwxr-xr-x   0 amccaugh   (501) staff       (20)        0 2023-07-20 18:11:35.914297 phidl-1.6.4/
--rw-r--r--   0 amccaugh   (501) staff       (20)     1074 2023-06-27 02:39:05.000000 phidl-1.6.4/LICENSE
--rw-r--r--   0 amccaugh   (501) staff       (20)       16 2023-06-27 02:39:05.000000 phidl-1.6.4/MANIFEST.in
--rw-r--r--   0 amccaugh   (501) staff       (20)     6494 2023-07-20 18:11:35.914376 phidl-1.6.4/PKG-INFO
--rw-r--r--   0 amccaugh   (501) staff       (20)     6311 2023-07-20 18:06:17.000000 phidl-1.6.4/README.md
-drwxr-xr-x   0 amccaugh   (501) staff       (20)        0 2023-07-20 18:11:35.912653 phidl-1.6.4/phidl/
--rw-r--r--   0 amccaugh   (501) staff       (20)      541 2023-06-27 02:39:05.000000 phidl-1.6.4/phidl/__init__.py
--rw-r--r--   0 amccaugh   (501) staff       (20)    38409 2023-06-27 02:39:05.000000 phidl-1.6.4/phidl/constants.py
--rw-r--r--   0 amccaugh   (501) staff       (20)   107357 2023-07-20 18:06:17.000000 phidl-1.6.4/phidl/device_layout.py
--rw-r--r--   0 amccaugh   (501) staff       (20)     8052 2023-06-27 02:39:05.000000 phidl-1.6.4/phidl/font.py
--rw-r--r--   0 amccaugh   (501) staff       (20)   188610 2023-07-20 18:07:00.000000 phidl-1.6.4/phidl/geometry.py
--rw-r--r--   0 amccaugh   (501) staff       (20)    15306 2023-06-27 02:39:05.000000 phidl-1.6.4/phidl/path.py
--rw-r--r--   0 amccaugh   (501) staff       (20)    47548 2023-06-27 02:39:05.000000 phidl-1.6.4/phidl/phidl_tutorial_example.py
--rw-r--r--   0 amccaugh   (501) staff       (20)    35769 2023-06-27 02:39:05.000000 phidl-1.6.4/phidl/quickplotter.py
--rw-r--r--   0 amccaugh   (501) staff       (20)    69245 2023-06-27 02:39:05.000000 phidl-1.6.4/phidl/routing.py
--rw-r--r--   0 amccaugh   (501) staff       (20)     8945 2023-06-27 02:39:05.000000 phidl-1.6.4/phidl/utilities.py
-drwxr-xr-x   0 amccaugh   (501) staff       (20)        0 2023-07-20 18:11:35.913273 phidl-1.6.4/phidl.egg-info/
--rw-r--r--   0 amccaugh   (501) staff       (20)     6494 2023-07-20 18:11:35.000000 phidl-1.6.4/phidl.egg-info/PKG-INFO
--rw-r--r--   0 amccaugh   (501) staff       (20)      473 2023-07-20 18:11:35.000000 phidl-1.6.4/phidl.egg-info/SOURCES.txt
--rw-r--r--   0 amccaugh   (501) staff       (20)        1 2023-07-20 18:11:35.000000 phidl-1.6.4/phidl.egg-info/dependency_links.txt
--rw-r--r--   0 amccaugh   (501) staff       (20)       28 2023-07-20 18:11:35.000000 phidl-1.6.4/phidl.egg-info/requires.txt
--rw-r--r--   0 amccaugh   (501) staff       (20)        6 2023-07-20 18:11:35.000000 phidl-1.6.4/phidl.egg-info/top_level.txt
--rw-r--r--   0 amccaugh   (501) staff       (20)      250 2023-07-20 18:11:35.914859 phidl-1.6.4/setup.cfg
--rw-r--r--   0 amccaugh   (501) staff       (20)      765 2023-07-20 18:06:17.000000 phidl-1.6.4/setup.py
-drwxr-xr-x   0 amccaugh   (501) staff       (20)        0 2023-07-20 18:11:35.914085 phidl-1.6.4/tests/
--rw-r--r--   0 amccaugh   (501) staff       (20)    11095 2023-06-27 02:39:05.000000 phidl-1.6.4/tests/test_device.py
--rw-r--r--   0 amccaugh   (501) staff       (20)    10029 2023-06-27 03:23:46.000000 phidl-1.6.4/tests/test_geometry.py
--rw-r--r--   0 amccaugh   (501) staff       (20)     5717 2023-06-27 02:39:05.000000 phidl-1.6.4/tests/test_path.py
--rw-r--r--   0 amccaugh   (501) staff       (20)     5812 2023-06-27 02:39:05.000000 phidl-1.6.4/tests/test_routing.py
+drwxr-xr-x   0 amccaugh   (501) staff       (20)        0 2024-04-09 17:37:42.365909 phidl-1.7.0/
+-rw-r--r--   0 amccaugh   (501) staff       (20)     1074 2023-11-07 21:24:35.000000 phidl-1.7.0/LICENSE
+-rw-r--r--   0 amccaugh   (501) staff       (20)       16 2023-11-07 21:24:35.000000 phidl-1.7.0/MANIFEST.in
+-rw-r--r--   0 amccaugh   (501) staff       (20)     6824 2024-04-09 17:37:42.365797 phidl-1.7.0/PKG-INFO
+-rw-r--r--   0 amccaugh   (501) staff       (20)     6641 2024-04-09 17:18:59.000000 phidl-1.7.0/README.md
+drwxr-xr-x   0 amccaugh   (501) staff       (20)        0 2024-04-09 17:37:42.363657 phidl-1.7.0/phidl/
+-rw-r--r--   0 amccaugh   (501) staff       (20)      541 2023-11-07 21:24:35.000000 phidl-1.7.0/phidl/__init__.py
+-rw-r--r--   0 amccaugh   (501) staff       (20)    38409 2023-11-07 21:24:35.000000 phidl-1.7.0/phidl/constants.py
+-rw-r--r--   0 amccaugh   (501) staff       (20)   108173 2024-04-09 17:00:22.000000 phidl-1.7.0/phidl/device_layout.py
+-rw-r--r--   0 amccaugh   (501) staff       (20)     8051 2024-04-09 03:53:21.000000 phidl-1.7.0/phidl/font.py
+-rw-r--r--   0 amccaugh   (501) staff       (20)   201346 2024-04-09 17:09:17.000000 phidl-1.7.0/phidl/geometry.py
+-rw-r--r--   0 amccaugh   (501) staff       (20)    15306 2024-04-09 03:53:21.000000 phidl-1.7.0/phidl/path.py
+-rw-r--r--   0 amccaugh   (501) staff       (20)    36526 2024-04-09 16:03:03.000000 phidl-1.7.0/phidl/quickplotter.py
+-rw-r--r--   0 amccaugh   (501) staff       (20)    25310 2024-04-09 15:19:38.000000 phidl-1.7.0/phidl/routing.py
+-rw-r--r--   0 amccaugh   (501) staff       (20)     8863 2024-04-09 03:53:21.000000 phidl-1.7.0/phidl/utilities.py
+drwxr-xr-x   0 amccaugh   (501) staff       (20)        0 2024-04-09 17:37:42.364370 phidl-1.7.0/phidl.egg-info/
+-rw-r--r--   0 amccaugh   (501) staff       (20)     6824 2024-04-09 17:37:42.000000 phidl-1.7.0/phidl.egg-info/PKG-INFO
+-rw-r--r--   0 amccaugh   (501) staff       (20)      431 2024-04-09 17:37:42.000000 phidl-1.7.0/phidl.egg-info/SOURCES.txt
+-rw-r--r--   0 amccaugh   (501) staff       (20)        1 2024-04-09 17:37:42.000000 phidl-1.7.0/phidl.egg-info/dependency_links.txt
+-rw-r--r--   0 amccaugh   (501) staff       (20)       28 2024-04-09 17:37:42.000000 phidl-1.7.0/phidl.egg-info/requires.txt
+-rw-r--r--   0 amccaugh   (501) staff       (20)        6 2024-04-09 17:37:42.000000 phidl-1.7.0/phidl.egg-info/top_level.txt
+-rw-r--r--   0 amccaugh   (501) staff       (20)       38 2024-04-09 17:37:42.365942 phidl-1.7.0/setup.cfg
+-rw-r--r--   0 amccaugh   (501) staff       (20)      765 2024-04-09 16:59:44.000000 phidl-1.7.0/setup.py
+drwxr-xr-x   0 amccaugh   (501) staff       (20)        0 2024-04-09 17:37:42.365482 phidl-1.7.0/tests/
+-rw-r--r--   0 amccaugh   (501) staff       (20)    11095 2023-11-07 21:24:35.000000 phidl-1.7.0/tests/test_device.py
+-rw-r--r--   0 amccaugh   (501) staff       (20)    11753 2024-04-09 17:30:11.000000 phidl-1.7.0/tests/test_geometry.py
+-rw-r--r--   0 amccaugh   (501) staff       (20)     5717 2023-11-07 21:24:35.000000 phidl-1.7.0/tests/test_path.py
+-rw-r--r--   0 amccaugh   (501) staff       (20)     5812 2023-11-07 21:24:35.000000 phidl-1.7.0/tests/test_routing.py
```

### Comparing `phidl-1.6.4/LICENSE` & `phidl-1.7.0/LICENSE`

 * *Files identical despite different names*

### Comparing `phidl-1.6.4/PKG-INFO` & `phidl-1.7.0/PKG-INFO`

 * *Files 4% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: phidl
-Version: 1.6.4
+Version: 1.7.0
 Summary: PHIDL
 Author: Adam McCaughan
 Author-email: amccaugh@gmail.com
 Description-Content-Type: text/markdown
 License-File: LICENSE
 
 [![pytest](https://github.com/amccaugh/phidl/actions/workflows/pytest.yml/badge.svg)](https://github.com/amccaugh/phidl/actions/workflows/pytest.yml)
@@ -12,16 +12,18 @@
 
 # PHIDL
 GDS scripting for Python that's intuitive, fast, and powerful.
 
 - [**Installation / requirements**](#installation--requirements)
 - [**Tutorial + examples**](https://phidl.readthedocs.io/en/latest/tutorials.html) (or [try an interactive notebook](https://mybinder.org/v2/gh/amccaugh/phidl/master?filepath=phidl_tutorial_example.ipynb))
 - [**Geometry library + function documentation**](https://phidl.readthedocs.io/en/latest/geometry_reference.html)
-- [Changelog](https://github.com/amccaugh/phidl/blob/master/CHANGELOG.md) (latest update 1.6.3 on July 20, 2023)
-    - New `pg.fill_rectangle()` [examples and documentation](https://phidl.readthedocs.io/en/latest/geometry_reference.html#Fill-tool)
+- [Changelog](https://github.com/amccaugh/phidl/blob/master/CHANGELOG.md) (latest update 1.7.0 on April 9, 2024)
+-  New KLayout-based boolean/offset/outline functions!  These are under the name `pg.kl_boolean()`, `pg.kl_offset`, `pg.kl_outline()`, `pg.kl_invert()`.  They utilize the excellent KLayout tile processor, which allows breaking down & parallelizing these operations--in a nutshell, these operations should be much, much faster, and they also are more robust than the gdspy/clipper implementation.
+-  To use these new functions, you must first `pip install klayout`
+
 
 # Citation
 
 If you found PHIDL useful, please consider citing it in (just one!) of your publications -- we appreciate it greatly. ([BibTeX](https://raw.githubusercontent.com/amccaugh/phidl/master/CITATION.bib))
  - McCaughan, A. N., et. al. PHIDL: Python-based layout and geometry creation for nanolithography. *J. Vac. Sci. Technol. B* 39, 062601 (2021). http://dx.doi.org/10.1116/6.0001203
 
 # Gallery
```

### Comparing `phidl-1.6.4/README.md` & `phidl-1.7.0/README.md`

 * *Files 5% similar despite different names*

```diff
@@ -3,16 +3,18 @@
 
 # PHIDL
 GDS scripting for Python that's intuitive, fast, and powerful.
 
 - [**Installation / requirements**](#installation--requirements)
 - [**Tutorial + examples**](https://phidl.readthedocs.io/en/latest/tutorials.html) (or [try an interactive notebook](https://mybinder.org/v2/gh/amccaugh/phidl/master?filepath=phidl_tutorial_example.ipynb))
 - [**Geometry library + function documentation**](https://phidl.readthedocs.io/en/latest/geometry_reference.html)
-- [Changelog](https://github.com/amccaugh/phidl/blob/master/CHANGELOG.md) (latest update 1.6.3 on July 20, 2023)
-    - New `pg.fill_rectangle()` [examples and documentation](https://phidl.readthedocs.io/en/latest/geometry_reference.html#Fill-tool)
+- [Changelog](https://github.com/amccaugh/phidl/blob/master/CHANGELOG.md) (latest update 1.7.0 on April 9, 2024)
+-  New KLayout-based boolean/offset/outline functions!  These are under the name `pg.kl_boolean()`, `pg.kl_offset`, `pg.kl_outline()`, `pg.kl_invert()`.  They utilize the excellent KLayout tile processor, which allows breaking down & parallelizing these operations--in a nutshell, these operations should be much, much faster, and they also are more robust than the gdspy/clipper implementation.
+-  To use these new functions, you must first `pip install klayout`
+
 
 # Citation
 
 If you found PHIDL useful, please consider citing it in (just one!) of your publications -- we appreciate it greatly. ([BibTeX](https://raw.githubusercontent.com/amccaugh/phidl/master/CITATION.bib))
  - McCaughan, A. N., et. al. PHIDL: Python-based layout and geometry creation for nanolithography. *J. Vac. Sci. Technol. B* 39, 062601 (2021). http://dx.doi.org/10.1116/6.0001203
 
 # Gallery
```

### Comparing `phidl-1.6.4/phidl/__init__.py` & `phidl-1.7.0/phidl/__init__.py`

 * *Files identical despite different names*

### Comparing `phidl-1.6.4/phidl/constants.py` & `phidl-1.7.0/phidl/constants.py`

 * *Files identical despite different names*

### Comparing `phidl-1.6.4/phidl/device_layout.py` & `phidl-1.7.0/phidl/device_layout.py`

 * *Files 1% similar despite different names*

```diff
@@ -50,15 +50,15 @@
 import numpy as np
 from numpy import cos, mod, pi, sin, sqrt
 
 from phidl.constants import _CSS3_NAMES_TO_HEX
 
 gdspy.library.use_current_library = False
 
-__version__ = "1.6.4"
+__version__ = "1.7.0"
 
 
 # ==============================================================================
 # Useful transformation functions
 # ==============================================================================
 
 
@@ -312,15 +312,16 @@
     return np.divide(abs(cross), np.linalg.norm(vec))
 
 
 def _simplify(points, tolerance=0):
     """Ramer–Douglas–Peucker algorithm for line simplification. Takes an
     array of points of shape (N,2) and removes excess points in the line. The
     remaining points form a identical line to within `tolerance` from the
-    original"""
+    original
+    """
     # From https://github.com/fhirschmann/rdp/issues/7
     # originally written by Kirill Konevets https://github.com/kkonevets
 
     M = np.asarray(points)
     start, end = M[0], M[-1]
     dists = _line_distances(M, start, end)
 
@@ -776,20 +777,15 @@
         if self.width < 0:
             raise ValueError("[PHIDL] Port creation " "error: width must be >=0")
         Port._next_uid += 1
 
     def __repr__(self):
         """Prints a description of the Port object, including the name,
         midpoint, width, and orientation of the Port."""
-        return "Port (name {}, midpoint {}, width {}, orientation {})".format(
-            self.name,
-            self.midpoint,
-            self.width,
-            self.orientation,
-        )
+        return f"Port (name {self.name}, midpoint {self.midpoint}, width {self.width}, orientation {self.orientation})"
 
     @property
     def endpoints(self):
         """Returns the endpoints of the Port."""
         dxdy = np.array(
             [
                 self.width / 2 * cos((self.orientation - 90) * pi / 180),
@@ -1646,15 +1642,15 @@
         if reference not in self.references:
             raise ValueError(
                 """[PHIDL] Device.absorb() failed -
                 the reference it was asked to absorb does not
                 exist in this Device. """
             )
         ref_polygons = reference.get_polygons(by_spec=True)
-        for (layer, polys) in ref_polygons.items():
+        for layer, polys in ref_polygons.items():
             [self.add_polygon(points=p, layer=layer) for p in polys]
         self.add(reference.parent.labels)
         self.add(reference.parent.paths)
         self.remove(reference)
         return self
 
     def get_ports(self, depth=None):
@@ -1839,14 +1835,34 @@
         for p in self.ports.values():
             p.midpoint = _reflect_points(p.midpoint, p1, p2)
             phi = np.arctan2(p2[1] - p1[1], p2[0] - p1[0]) * 180 / pi
             p.orientation = 2 * phi - p.orientation
         self._bb_valid = False
         return self
 
+    def simplify(self, tolerance=1e-3):
+        """Simplifies every polygon in the Device, without changing
+        the shape by more than `tolerance` from the original. Uses the
+        Ramer-Douglas-Peucker algorithm.
+
+        Parameters
+        ----------
+        tolerance : float
+            Tolerance value for the simplification algorithm.  All points that
+            can be removed without changing the resulting polygon by more than
+            the value listed here will be removed. Also known as `epsilon` here
+            https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm
+        """
+        referenced_cells = [self]
+        referenced_cells += list(self.get_dependencies(recursive=True))
+        for cell in referenced_cells:
+            for polygon in cell.polygons:
+                polygon.simplify(tolerance=tolerance)
+        return self
+
     def hash_geometry(self, precision=1e-4):
         """Computes an SHA1 hash of the geometry in the Device. For each layer,
         each polygon is individually hashed and then the polygon hashes are
         sorted, to ensure the hash stays constant regardless of the ordering
         the polygons.  Similarly, the layers are sorted by (layer, datatype)
 
         Parameters
```

### Comparing `phidl-1.6.4/phidl/font.py` & `phidl-1.7.0/phidl/font.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,12 +1,11 @@
 """
 Support for font rendering in GDS files.
 """
 
-
 import gdspy
 import numpy as np
 from matplotlib import font_manager
 
 from .device_layout import Device
 
 _cached_fonts = {}
```

### Comparing `phidl-1.6.4/phidl/geometry.py` & `phidl-1.7.0/phidl/geometry.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,11789 +1,12585 @@
 00000000: 696d 706f 7274 2063 6f70 7920 6173 2070  import copy as p
 00000010: 7974 686f 6e5f 636f 7079 0a69 6d70 6f72  ython_copy.impor
 00000020: 7420 6974 6572 746f 6f6c 730a 696d 706f  t itertools.impo
-00000030: 7274 206a 736f 6e0a 696d 706f 7274 206f  rt json.import o
-00000040: 732e 7061 7468 0a69 6d70 6f72 7420 7069  s.path.import pi
-00000050: 636b 6c65 0a69 6d70 6f72 7420 7761 726e  ckle.import warn
-00000060: 696e 6773 0a66 726f 6d20 636f 6c6c 6563  ings.from collec
-00000070: 7469 6f6e 7320 696d 706f 7274 204f 7264  tions import Ord
-00000080: 6572 6564 4469 6374 0a66 726f 6d20 6675  eredDict.from fu
-00000090: 6e63 746f 6f6c 7320 696d 706f 7274 2075  nctools import u
-000000a0: 7064 6174 655f 7772 6170 7065 720a 0a69  pdate_wrapper..i
-000000b0: 6d70 6f72 7420 6764 7370 790a 696d 706f  mport gdspy.impo
-000000c0: 7274 206e 756d 7079 2061 7320 6e70 0a66  rt numpy as np.f
-000000d0: 726f 6d20 6764 7370 7920 696d 706f 7274  rom gdspy import
-000000e0: 2063 6c69 7070 6572 0a66 726f 6d20 6e75   clipper.from nu
-000000f0: 6d70 7920 696d 706f 7274 2063 6f73 2c20  mpy import cos, 
-00000100: 6578 702c 206c 6f67 2c20 7069 2c20 7369  exp, log, pi, si
-00000110: 6e2c 2073 696e 682c 2073 7172 740a 0a66  n, sinh, sqrt..f
-00000120: 726f 6d20 7068 6964 6c2e 636f 6e73 7461  rom phidl.consta
-00000130: 6e74 7320 696d 706f 7274 205f 676c 7970  nts import _glyp
-00000140: 682c 205f 696e 6465 6e74 2c20 5f77 6964  h, _indent, _wid
-00000150: 7468 0a66 726f 6d20 7068 6964 6c2e 6465  th.from phidl.de
-00000160: 7669 6365 5f6c 6179 6f75 7420 696d 706f  vice_layout impo
-00000170: 7274 2028 0a20 2020 2043 656c 6c41 7272  rt (.    CellArr
-00000180: 6179 2c0a 2020 2020 4465 7669 6365 2c0a  ay,.    Device,.
-00000190: 2020 2020 4465 7669 6365 5265 6665 7265      DeviceRefere
-000001a0: 6e63 652c 0a20 2020 2047 726f 7570 2c0a  nce,.    Group,.
-000001b0: 2020 2020 506f 6c79 676f 6e2c 0a20 2020      Polygon,.   
-000001c0: 2050 6f72 742c 0a20 2020 205f 7061 7273   Port,.    _pars
-000001d0: 655f 6c61 7965 722c 0a20 2020 206d 616b  e_layer,.    mak
-000001e0: 655f 6465 7669 6365 2c0a 290a 0a23 2323  e_device,.)..###
-000001f0: 2323 2043 6174 6567 6f72 6965 733a 0a23  ## Categories:.#
-00000200: 2050 6f6c 7967 6f6e 7320 2f20 7368 6170   Polygons / shap
-00000210: 6573 0a23 2042 6f6f 6c65 616e 2066 756e  es.# Boolean fun
-00000220: 6374 696f 6e73 0a23 204c 6974 686f 6772  ctions.# Lithogr
-00000230: 6170 6879 2074 6573 7420 7374 7275 6374  aphy test struct
-00000240: 7572 6573 0a23 2055 7469 6c69 7479 2066  ures.# Utility f
-00000250: 756e 6374 696f 6e73 2028 636f 7079 696e  unctions (copyin
-00000260: 672c 2069 6d70 6f72 7469 6e67 2c20 6578  g, importing, ex
-00000270: 7472 6163 7469 6e67 290a 2320 5061 6473  tracting).# Pads
-00000280: 0a23 2054 6170 6572 0a23 2054 6578 740a  .# Taper.# Text.
-00000290: 2320 5761 6665 7220 2f20 4469 650a 2320  # Wafer / Die.# 
-000002a0: 5761 7665 6775 6964 650a 2320 5061 636b  Waveguide.# Pack
-000002b0: 6572 2074 6f6f 6c20 2f20 4669 6c6c 2074  er tool / Fill t
-000002c0: 6f6f 6c0a 2320 5068 6f74 6f6e 6963 730a  ool.# Photonics.
-000002d0: 2320 4f70 7469 6d61 6c20 2863 7572 7265  # Optimal (curre
-000002e0: 6e74 2d63 726f 7764 696e 6729 2063 7572  nt-crowding) cur
-000002f0: 7665 730a 2320 5375 7065 7263 6f6e 6475  ves.# Supercondu
-00000300: 6374 696e 6720 6465 7669 6365 730a 0a23  cting devices..#
-00000310: 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d   ===============
-00000320: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00000330: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00000340: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00000350: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a  ===============.
-00000360: 230a 2320 506f 6c79 676f 6e73 202f 2053  #.# Polygons / S
-00000370: 6861 7065 730a 230a 2320 3d3d 3d3d 3d3d  hapes.#.# ======
+00000030: 7274 206a 736f 6e0a 696d 706f 7274 206d  rt json.import m
+00000040: 756c 7469 7072 6f63 6573 7369 6e67 0a69  ultiprocessing.i
+00000050: 6d70 6f72 7420 6f73 2e70 6174 680a 696d  mport os.path.im
+00000060: 706f 7274 2070 6963 6b6c 650a 696d 706f  port pickle.impo
+00000070: 7274 2077 6172 6e69 6e67 730a 6672 6f6d  rt warnings.from
+00000080: 2063 6f6c 6c65 6374 696f 6e73 2069 6d70   collections imp
+00000090: 6f72 7420 4f72 6465 7265 6444 6963 740a  ort OrderedDict.
+000000a0: 6672 6f6d 2066 756e 6374 6f6f 6c73 2069  from functools i
+000000b0: 6d70 6f72 7420 7570 6461 7465 5f77 7261  mport update_wra
+000000c0: 7070 6572 0a0a 696d 706f 7274 2067 6473  pper..import gds
+000000d0: 7079 0a69 6d70 6f72 7420 6e75 6d70 7920  py.import numpy 
+000000e0: 6173 206e 700a 6672 6f6d 2067 6473 7079  as np.from gdspy
+000000f0: 2069 6d70 6f72 7420 636c 6970 7065 720a   import clipper.
+00000100: 6672 6f6d 206e 756d 7079 2069 6d70 6f72  from numpy impor
+00000110: 7420 636f 732c 2065 7870 2c20 6c6f 672c  t cos, exp, log,
+00000120: 2070 692c 2073 696e 2c20 7369 6e68 2c20   pi, sin, sinh, 
+00000130: 7371 7274 0a0a 6672 6f6d 2070 6869 646c  sqrt..from phidl
+00000140: 2e63 6f6e 7374 616e 7473 2069 6d70 6f72  .constants impor
+00000150: 7420 5f67 6c79 7068 2c20 5f69 6e64 656e  t _glyph, _inden
+00000160: 742c 205f 7769 6474 680a 6672 6f6d 2070  t, _width.from p
+00000170: 6869 646c 2e64 6576 6963 655f 6c61 796f  hidl.device_layo
+00000180: 7574 2069 6d70 6f72 7420 280a 2020 2020  ut import (.    
+00000190: 4365 6c6c 4172 7261 792c 0a20 2020 2044  CellArray,.    D
+000001a0: 6576 6963 652c 0a20 2020 2044 6576 6963  evice,.    Devic
+000001b0: 6552 6566 6572 656e 6365 2c0a 2020 2020  eReference,.    
+000001c0: 4772 6f75 702c 0a20 2020 2050 6f6c 7967  Group,.    Polyg
+000001d0: 6f6e 2c0a 2020 2020 506f 7274 2c0a 2020  on,.    Port,.  
+000001e0: 2020 5f70 6172 7365 5f6c 6179 6572 2c0a    _parse_layer,.
+000001f0: 2020 2020 6d61 6b65 5f64 6576 6963 652c      make_device,
+00000200: 0a29 0a0a 4e55 4d5f 4350 5520 3d20 6d75  .)..NUM_CPU = mu
+00000210: 6c74 6970 726f 6365 7373 696e 672e 6370  ltiprocessing.cp
+00000220: 755f 636f 756e 7428 290a 0a23 2323 2323  u_count()..#####
+00000230: 2043 6174 6567 6f72 6965 733a 0a23 2050   Categories:.# P
+00000240: 6f6c 7967 6f6e 7320 2f20 7368 6170 6573  olygons / shapes
+00000250: 0a23 2042 6f6f 6c65 616e 2066 756e 6374  .# Boolean funct
+00000260: 696f 6e73 0a23 204c 6974 686f 6772 6170  ions.# Lithograp
+00000270: 6879 2074 6573 7420 7374 7275 6374 7572  hy test structur
+00000280: 6573 0a23 2055 7469 6c69 7479 2066 756e  es.# Utility fun
+00000290: 6374 696f 6e73 2028 636f 7079 696e 672c  ctions (copying,
+000002a0: 2069 6d70 6f72 7469 6e67 2c20 6578 7472   importing, extr
+000002b0: 6163 7469 6e67 290a 2320 5061 6473 0a23  acting).# Pads.#
+000002c0: 2054 6170 6572 0a23 2054 6578 740a 2320   Taper.# Text.# 
+000002d0: 5761 6665 7220 2f20 4469 650a 2320 5761  Wafer / Die.# Wa
+000002e0: 7665 6775 6964 650a 2320 5061 636b 6572  veguide.# Packer
+000002f0: 2074 6f6f 6c20 2f20 4669 6c6c 2074 6f6f   tool / Fill too
+00000300: 6c0a 2320 5068 6f74 6f6e 6963 730a 2320  l.# Photonics.# 
+00000310: 4f70 7469 6d61 6c20 2863 7572 7265 6e74  Optimal (current
+00000320: 2d63 726f 7764 696e 6729 2063 7572 7665  -crowding) curve
+00000330: 730a 2320 5375 7065 7263 6f6e 6475 6374  s.# Superconduct
+00000340: 696e 6720 6465 7669 6365 730a 0a23 203d  ing devices..# =
+00000350: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00000360: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00000370: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
 00000380: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00000390: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000003a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000003b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000003c0: 3d3d 3d3d 3d3d 3d3d 0a0a 0a64 6566 2072  ========...def r
-000003d0: 6563 7461 6e67 6c65 2873 697a 653d 2834  ectangle(size=(4
-000003e0: 2c20 3229 2c20 6c61 7965 723d 3029 3a0a  , 2), layer=0):.
-000003f0: 2020 2020 2222 2247 656e 6572 6174 6573      """Generates
-00000400: 2061 2072 6563 7461 6e67 6c65 2067 656f   a rectangle geo
-00000410: 6d65 7472 792e 0a0a 2020 2020 5061 7261  metry...    Para
-00000420: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
-00000430: 2d2d 2d2d 2d0a 2020 2020 7369 7a65 203a  -----.    size :
-00000440: 2074 7570 6c65 206f 6620 696e 7420 6f72   tuple of int or
-00000450: 2066 6c6f 6174 0a20 2020 2020 2020 2057   float.        W
-00000460: 6964 7468 2061 6e64 2068 6569 6768 7420  idth and height 
-00000470: 6f66 2072 6563 7461 6e67 6c65 2e0a 2020  of rectangle..  
-00000480: 2020 6c61 7965 7220 3a20 696e 742c 2061    layer : int, a
-00000490: 7272 6179 2d6c 696b 655b 325d 2c20 6f72  rray-like[2], or
-000004a0: 2073 6574 0a20 2020 2020 2020 2053 7065   set.        Spe
-000004b0: 6369 6669 6320 6c61 7965 7228 7329 2074  cific layer(s) t
-000004c0: 6f20 7075 7420 706f 6c79 676f 6e20 6765  o put polygon ge
-000004d0: 6f6d 6574 7279 206f 6e2e 0a0a 2020 2020  ometry on...    
-000004e0: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
-000004f0: 2d2d 2d0a 2020 2020 4420 3a20 4465 7669  ---.    D : Devi
-00000500: 6365 0a20 2020 2020 2020 2041 2044 6576  ce.        A Dev
-00000510: 6963 6520 636f 6e74 6169 6e69 6e67 2061  ice containing a
-00000520: 2073 696e 676c 6520 7265 6374 616e 676c   single rectangl
-00000530: 6520 706f 6c79 676f 6e2e 0a20 2020 2022  e polygon..    "
-00000540: 2222 0a20 2020 2044 203d 2044 6576 6963  "".    D = Devic
-00000550: 6528 6e61 6d65 3d22 7265 6374 616e 676c  e(name="rectangl
-00000560: 6522 290a 2020 2020 706f 696e 7473 203d  e").    points =
-00000570: 205b 5b73 697a 655b 305d 2c20 7369 7a65   [[size[0], size
-00000580: 5b31 5d5d 2c20 5b73 697a 655b 305d 2c20  [1]], [size[0], 
-00000590: 305d 2c20 5b30 2c20 305d 2c20 5b30 2c20  0], [0, 0], [0, 
-000005a0: 7369 7a65 5b31 5d5d 5d0a 2020 2020 442e  size[1]]].    D.
-000005b0: 6164 645f 706f 6c79 676f 6e28 706f 696e  add_polygon(poin
-000005c0: 7473 2c20 6c61 7965 723d 6c61 7965 7229  ts, layer=layer)
-000005d0: 0a20 2020 2072 6574 7572 6e20 440a 0a0a  .    return D...
-000005e0: 6465 6620 6262 6f78 2862 626f 783d 5b28  def bbox(bbox=[(
-000005f0: 2d31 2c20 2d31 292c 2028 332c 2034 295d  -1, -1), (3, 4)]
-00000600: 2c20 6c61 7965 723d 3029 3a0a 2020 2020  , layer=0):.    
-00000610: 2222 2243 7265 6174 6573 2061 2062 6f75  """Creates a bou
-00000620: 6e64 696e 6720 626f 7820 7265 6374 616e  nding box rectan
-00000630: 676c 6520 6672 6f6d 2063 6f6f 7264 696e  gle from coordin
-00000640: 6174 6573 2c20 746f 2061 6c6c 6f77 0a20  ates, to allow. 
-00000650: 2020 2063 7265 6174 696f 6e20 6f66 2061     creation of a
-00000660: 2072 6563 7461 6e67 6c65 2062 6f75 6e64   rectangle bound
-00000670: 696e 6720 626f 7820 6469 7265 6374 6c79  ing box directly
-00000680: 2066 6f72 6d20 616e 6f74 6865 7220 7368   form another sh
-00000690: 6170 652e 0a0a 2020 2020 5061 7261 6d65  ape...    Parame
-000006a0: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
-000006b0: 2d2d 2d0a 2020 2020 6262 6f78 203a 206c  ---.    bbox : l
-000006c0: 6973 7420 6f66 2074 7570 6c65 7320 6f66  ist of tuples of
-000006d0: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
-000006e0: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
-000006f0: 7320 6f66 2074 6865 2062 6f78 205b 2878  s of the box [(x
-00000700: 312c 2079 3129 2c20 2878 322c 2079 3229  1, y1), (x2, y2)
-00000710: 5d2e 0a20 2020 206c 6179 6572 203a 2069  ]..    layer : i
-00000720: 6e74 2c20 6172 7261 792d 6c69 6b65 5b32  nt, array-like[2
-00000730: 5d2c 206f 7220 7365 740a 2020 2020 2020  ], or set.      
-00000740: 2020 5370 6563 6966 6963 206c 6179 6572    Specific layer
-00000750: 2873 2920 746f 2070 7574 2070 6f6c 7967  (s) to put polyg
-00000760: 6f6e 2067 656f 6d65 7472 7920 6f6e 2e0a  on geometry on..
-00000770: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
-00000780: 202d 2d2d 2d2d 2d2d 0a20 2020 2044 203a   -------.    D :
-00000790: 2044 6576 6963 650a 2020 2020 2020 2020   Device.        
-000007a0: 4120 4465 7669 6365 2063 6f6e 7461 696e  A Device contain
-000007b0: 696e 6720 6120 7369 6e67 6c65 2072 6563  ing a single rec
-000007c0: 7461 6e67 6c65 2070 6f6c 7967 6f6e 2e0a  tangle polygon..
-000007d0: 0a20 2020 2045 7861 6d70 6c65 730a 2020  .    Examples.  
-000007e0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e    --------.    >
-000007f0: 3e3e 2044 203d 2070 672e 6262 6f78 2861  >> D = pg.bbox(a
-00000800: 6e6f 7468 6572 7368 6170 652e 6262 6f78  nothershape.bbox
-00000810: 290a 2020 2020 2222 220a 2020 2020 4420  ).    """.    D 
-00000820: 3d20 4465 7669 6365 286e 616d 653d 2262  = Device(name="b
-00000830: 626f 7822 290a 2020 2020 2861 2c20 6229  box").    (a, b)
-00000840: 2c20 2863 2c20 6429 203d 2062 626f 780a  , (c, d) = bbox.
-00000850: 2020 2020 706f 696e 7473 203d 2028 2861      points = ((a
-00000860: 2c20 6229 2c20 2863 2c20 6229 2c20 2863  , b), (c, b), (c
-00000870: 2c20 6429 2c20 2861 2c20 6429 290a 2020  , d), (a, d)).  
-00000880: 2020 442e 6164 645f 706f 6c79 676f 6e28    D.add_polygon(
-00000890: 706f 696e 7473 2c20 6c61 7965 723d 6c61  points, layer=la
-000008a0: 7965 7229 0a20 2020 2072 6574 7572 6e20  yer).    return 
-000008b0: 440a 0a0a 6465 6620 6372 6f73 7328 6c65  D...def cross(le
-000008c0: 6e67 7468 3d31 302c 2077 6964 7468 3d33  ngth=10, width=3
-000008d0: 2c20 6c61 7965 723d 3029 3a0a 2020 2020  , layer=0):.    
-000008e0: 2222 2247 656e 6572 6174 6573 2061 2072  """Generates a r
-000008f0: 6967 6874 2d61 6e67 6c65 2063 726f 7373  ight-angle cross
-00000900: 2028 2b20 7368 6170 652c 2073 796d 6d65   (+ shape, symme
-00000910: 7472 6963 2920 6672 6f6d 2074 776f 0a20  tric) from two. 
-00000920: 2020 2072 6563 7461 6e67 6c65 7320 6f66     rectangles of
-00000930: 2073 7065 6369 6669 6564 206c 656e 6774   specified lengt
-00000940: 6820 616e 6420 7769 6474 682e 0a0a 2020  h and width...  
-00000950: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00000960: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00000970: 6c65 6e67 7468 203a 2069 6e74 206f 7220  length : int or 
-00000980: 666c 6f61 740a 2020 2020 2020 2020 4c65  float.        Le
-00000990: 6e67 7468 206f 6620 7468 6520 6372 6f73  ngth of the cros
-000009a0: 7320 6672 6f6d 206f 6e65 2065 6e64 2074  s from one end t
-000009b0: 6f20 7468 6520 6f74 6865 722e 0a20 2020  o the other..   
-000009c0: 2077 6964 7468 203a 2069 6e74 206f 7220   width : int or 
-000009d0: 666c 6f61 740a 2020 2020 2020 2020 5769  float.        Wi
-000009e0: 6474 6820 6f66 2074 6865 2061 726d 7320  dth of the arms 
-000009f0: 6f66 2074 6865 2063 726f 7373 2e0a 2020  of the cross..  
-00000a00: 2020 6c61 7965 7220 3a20 696e 742c 2061    layer : int, a
-00000a10: 7272 6179 2d6c 696b 655b 325d 2c20 6f72  rray-like[2], or
-00000a20: 2073 6574 0a20 2020 2020 2020 2053 7065   set.        Spe
-00000a30: 6369 6669 6320 6c61 7965 7228 7329 2074  cific layer(s) t
-00000a40: 6f20 7075 7420 706f 6c79 676f 6e20 6765  o put polygon ge
-00000a50: 6f6d 6574 7279 206f 6e2e 0a0a 2020 2020  ometry on...    
-00000a60: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
-00000a70: 2d2d 2d0a 2020 2020 443a 2044 6576 6963  ---.    D: Devic
-00000a80: 650a 2020 2020 2020 2020 4120 4465 7669  e.        A Devi
-00000a90: 6365 2063 6f6e 7461 696e 696e 6720 6120  ce containing a 
-00000aa0: 6372 6f73 7320 706f 6c79 676f 6e2e 0a20  cross polygon.. 
-00000ab0: 2020 2022 2222 0a20 2020 2044 203d 2044     """.    D = D
-00000ac0: 6576 6963 6528 6e61 6d65 3d22 6372 6f73  evice(name="cros
-00000ad0: 7322 290a 2020 2020 5220 3d20 7265 6374  s").    R = rect
-00000ae0: 616e 676c 6528 7369 7a65 3d28 7769 6474  angle(size=(widt
-00000af0: 682c 206c 656e 6774 6829 2c20 6c61 7965  h, length), laye
-00000b00: 723d 6c61 7965 7229 0a20 2020 2072 3120  r=layer).    r1 
-00000b10: 3d20 442e 6164 645f 7265 6628 5229 2e72  = D.add_ref(R).r
-00000b20: 6f74 6174 6528 3930 290a 2020 2020 7232  otate(90).    r2
-00000b30: 203d 2044 2e61 6464 5f72 6566 2852 290a   = D.add_ref(R).
-00000b40: 2020 2020 7231 2e63 656e 7465 7220 3d20      r1.center = 
-00000b50: 2830 2c20 3029 0a20 2020 2072 322e 6365  (0, 0).    r2.ce
-00000b60: 6e74 6572 203d 2028 302c 2030 290a 2020  nter = (0, 0).  
-00000b70: 2020 7265 7475 726e 2044 0a0a 0a64 6566    return D...def
-00000b80: 2065 6c6c 6970 7365 2872 6164 6969 3d28   ellipse(radii=(
-00000b90: 3130 2c20 3529 2c20 616e 676c 655f 7265  10, 5), angle_re
-00000ba0: 736f 6c75 7469 6f6e 3d32 2e35 2c20 6c61  solution=2.5, la
-00000bb0: 7965 723d 3029 3a0a 2020 2020 2222 2247  yer=0):.    """G
-00000bc0: 656e 6572 6174 6573 2061 6e20 656c 6c69  enerates an elli
-00000bd0: 7073 6520 6765 6f6d 6574 7279 2e0a 0a20  pse geometry... 
-00000be0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00000bf0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-00000c00: 2072 6164 6969 203a 2074 7570 6c65 206f   radii : tuple o
-00000c10: 6620 696e 7420 6f72 2066 6c6f 6174 0a20  f int or float. 
-00000c20: 2020 2020 2020 2053 656d 696d 616a 6f72         Semimajor
-00000c30: 2028 7829 2061 6e64 2073 656d 696d 696e   (x) and semimin
-00000c40: 6f72 2028 7929 2061 7869 7320 6c65 6e67  or (y) axis leng
-00000c50: 7468 7320 6f66 2074 6865 2065 6c6c 6970  ths of the ellip
-00000c60: 7365 2e0a 2020 2020 616e 676c 655f 7265  se..    angle_re
-00000c70: 736f 6c75 7469 6f6e 203a 2069 6e74 206f  solution : int o
-00000c80: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
-00000c90: 5265 736f 6c75 7469 6f6e 206f 6620 7468  Resolution of th
-00000ca0: 6520 6375 7276 6520 6f66 2074 6865 2072  e curve of the r
-00000cb0: 696e 6720 2823 206f 6620 6465 6772 6565  ing (# of degree
-00000cc0: 7320 7065 7220 706f 696e 7429 2e0a 2020  s per point)..  
-00000cd0: 2020 6c61 7965 7220 3a20 696e 742c 2061    layer : int, a
-00000ce0: 7272 6179 2d6c 696b 655b 325d 2c20 6f72  rray-like[2], or
-00000cf0: 2073 6574 0a20 2020 2020 2020 2053 7065   set.        Spe
-00000d00: 6369 6669 6320 6c61 7965 7228 7329 2074  cific layer(s) t
-00000d10: 6f20 7075 7420 706f 6c79 676f 6e20 6765  o put polygon ge
-00000d20: 6f6d 6574 7279 206f 6e2e 0a0a 2020 2020  ometry on...    
-00000d30: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
-00000d40: 2d2d 2d0a 2020 2020 4420 3a20 4465 7669  ---.    D : Devi
-00000d50: 6365 0a20 2020 2020 2020 2041 2044 6576  ce.        A Dev
-00000d60: 6963 6520 636f 6e74 6169 6e69 6e67 2061  ice containing a
-00000d70: 6e20 656c 6c69 7073 6520 706f 6c79 676f  n ellipse polygo
-00000d80: 6e2e 0a20 2020 2022 2222 0a20 2020 2044  n..    """.    D
-00000d90: 203d 2044 6576 6963 6528 6e61 6d65 3d22   = Device(name="
-00000da0: 656c 6c69 7073 6522 290a 2020 2020 6120  ellipse").    a 
-00000db0: 3d20 7261 6469 695b 305d 0a20 2020 2062  = radii[0].    b
-00000dc0: 203d 2072 6164 6969 5b31 5d0a 2020 2020   = radii[1].    
-00000dd0: 7420 3d20 6e70 2e6c 696e 7370 6163 6528  t = np.linspace(
-00000de0: 302c 2033 3630 2c20 696e 7428 6e70 2e63  0, 360, int(np.c
-00000df0: 6569 6c28 3336 3020 2f20 616e 676c 655f  eil(360 / angle_
-00000e00: 7265 736f 6c75 7469 6f6e 2920 2b20 3129  resolution) + 1)
-00000e10: 2920 2a20 7069 202f 2031 3830 0a20 2020  ) * pi / 180.   
-00000e20: 2072 203d 2061 202a 2062 202f 2028 7371   r = a * b / (sq
-00000e30: 7274 2828 6220 2a20 636f 7328 7429 2920  rt((b * cos(t)) 
-00000e40: 2a2a 2032 202b 2028 6120 2a20 7369 6e28  ** 2 + (a * sin(
-00000e50: 7429 2920 2a2a 2032 2929 0a20 2020 2078  t)) ** 2)).    x
-00000e60: 7074 7320 3d20 7220 2a20 636f 7328 7429  pts = r * cos(t)
-00000e70: 0a20 2020 2079 7074 7320 3d20 7220 2a20  .    ypts = r * 
-00000e80: 7369 6e28 7429 0a20 2020 2044 2e61 6464  sin(t).    D.add
-00000e90: 5f70 6f6c 7967 6f6e 2870 6f69 6e74 733d  _polygon(points=
-00000ea0: 2878 7074 732c 2079 7074 7329 2c20 6c61  (xpts, ypts), la
-00000eb0: 7965 723d 6c61 7965 7229 0a20 2020 2072  yer=layer).    r
-00000ec0: 6574 7572 6e20 440a 0a0a 6465 6620 6369  eturn D...def ci
-00000ed0: 7263 6c65 2872 6164 6975 733d 3130 2c20  rcle(radius=10, 
-00000ee0: 616e 676c 655f 7265 736f 6c75 7469 6f6e  angle_resolution
-00000ef0: 3d32 2e35 2c20 6c61 7965 723d 3029 3a0a  =2.5, layer=0):.
-00000f00: 2020 2020 2222 2247 656e 6572 6174 6573      """Generates
-00000f10: 2061 2063 6972 636c 6520 6765 6f6d 6574   a circle geomet
-00000f20: 7279 2e0a 0a20 2020 2050 6172 616d 6574  ry...    Paramet
-00000f30: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
-00000f40: 2d2d 0a20 2020 2072 6164 6975 7320 3a20  --.    radius : 
-00000f50: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
-00000f60: 2020 2020 2052 6164 6975 7320 6f66 2074       Radius of t
-00000f70: 6865 2063 6972 636c 652e 0a20 2020 2061  he circle..    a
-00000f80: 6e67 6c65 5f72 6573 6f6c 7574 696f 6e20  ngle_resolution 
-00000f90: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
-00000fa0: 2020 2020 2020 2052 6573 6f6c 7574 696f         Resolutio
-00000fb0: 6e20 6f66 2074 6865 2063 7572 7665 206f  n of the curve o
-00000fc0: 6620 7468 6520 7269 6e67 2028 2320 6f66  f the ring (# of
-00000fd0: 2064 6567 7265 6573 2070 6572 2070 6f69   degrees per poi
-00000fe0: 6e74 292e 0a20 2020 206c 6179 6572 203a  nt)..    layer :
-00000ff0: 2069 6e74 2c20 6172 7261 792d 6c69 6b65   int, array-like
-00001000: 5b32 5d2c 206f 7220 7365 740a 2020 2020  [2], or set.    
-00001010: 2020 2020 5370 6563 6966 6963 206c 6179      Specific lay
-00001020: 6572 2873 2920 746f 2070 7574 2070 6f6c  er(s) to put pol
-00001030: 7967 6f6e 2067 656f 6d65 7472 7920 6f6e  ygon geometry on
-00001040: 2e0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
-00001050: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2044     -------.    D
-00001060: 203a 2044 6576 6963 650a 2020 2020 2020   : Device.      
-00001070: 2020 4120 4465 7669 6365 2063 6f6e 7461    A Device conta
-00001080: 696e 696e 6720 6120 6369 7263 6c65 2070  ining a circle p
-00001090: 6f6c 7967 6f6e 2e0a 2020 2020 2222 220a  olygon..    """.
-000010a0: 2020 2020 4420 3d20 4465 7669 6365 286e      D = Device(n
-000010b0: 616d 653d 2263 6972 636c 6522 290a 2020  ame="circle").  
-000010c0: 2020 7420 3d20 6e70 2e6c 696e 7370 6163    t = np.linspac
-000010d0: 6528 302c 2033 3630 2c20 696e 7428 6e70  e(0, 360, int(np
-000010e0: 2e63 6569 6c28 3336 3020 2f20 616e 676c  .ceil(360 / angl
-000010f0: 655f 7265 736f 6c75 7469 6f6e 2920 2b20  e_resolution) + 
-00001100: 3129 2920 2a20 7069 202f 2031 3830 0a20  1)) * pi / 180. 
-00001110: 2020 2078 7074 7320 3d20 2872 6164 6975     xpts = (radiu
-00001120: 7320 2a20 636f 7328 7429 292e 746f 6c69  s * cos(t)).toli
-00001130: 7374 2829 0a20 2020 2079 7074 7320 3d20  st().    ypts = 
-00001140: 2872 6164 6975 7320 2a20 7369 6e28 7429  (radius * sin(t)
-00001150: 292e 746f 6c69 7374 2829 0a20 2020 2044  ).tolist().    D
-00001160: 2e61 6464 5f70 6f6c 7967 6f6e 2870 6f69  .add_polygon(poi
-00001170: 6e74 733d 2878 7074 732c 2079 7074 7329  nts=(xpts, ypts)
-00001180: 2c20 6c61 7965 723d 6c61 7965 7229 0a20  , layer=layer). 
-00001190: 2020 2072 6574 7572 6e20 440a 0a0a 6465     return D...de
-000011a0: 6620 7269 6e67 2872 6164 6975 733d 3130  f ring(radius=10
-000011b0: 2c20 7769 6474 683d 302e 352c 2061 6e67  , width=0.5, ang
-000011c0: 6c65 5f72 6573 6f6c 7574 696f 6e3d 322e  le_resolution=2.
-000011d0: 352c 206c 6179 6572 3d30 293a 0a20 2020  5, layer=0):.   
-000011e0: 2022 2222 4765 6e65 7261 7465 7320 6120   """Generates a 
-000011f0: 7269 6e67 2067 656f 6d65 7472 792e 0a0a  ring geometry...
-00001200: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00001210: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00001220: 2020 7261 6469 7573 203a 2069 6e74 206f    radius : int o
-00001230: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
-00001240: 5261 6469 7573 206f 6620 7468 6520 7269  Radius of the ri
-00001250: 6e67 2063 656e 7465 726c 696e 650a 2020  ng centerline.  
-00001260: 2020 7769 6474 6820 3a20 696e 7420 6f72    width : int or
-00001270: 2066 6c6f 6174 0a20 2020 2020 2020 2057   float.        W
-00001280: 6964 7468 206f 6620 7468 6520 7269 6e67  idth of the ring
-00001290: 2e0a 2020 2020 616e 676c 655f 7265 736f  ..    angle_reso
-000012a0: 6c75 7469 6f6e 203a 2069 6e74 206f 7220  lution : int or 
-000012b0: 666c 6f61 740a 2020 2020 2020 2020 5265  float.        Re
-000012c0: 736f 6c75 7469 6f6e 206f 6620 7468 6520  solution of the 
-000012d0: 6375 7276 6520 6f66 2074 6865 2072 696e  curve of the rin
-000012e0: 6720 2823 206f 6620 6465 6772 6565 7320  g (# of degrees 
-000012f0: 7065 7220 706f 696e 7429 2e0a 2020 2020  per point)..    
-00001300: 6c61 7965 7220 3a0a 2020 2020 2020 2020  layer :.        
-00001310: 5370 6563 6966 6963 206c 6179 6572 2873  Specific layer(s
-00001320: 2920 746f 2070 7574 2070 6f6c 7967 6f6e  ) to put polygon
-00001330: 2067 656f 6d65 7472 7920 6f6e 2e0a 0a20   geometry on... 
-00001340: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
-00001350: 2d2d 2d2d 2d2d 0a20 2020 2044 203a 2044  ------.    D : D
-00001360: 6576 6963 650a 2020 2020 2020 2020 4120  evice.        A 
-00001370: 4465 7669 6365 2063 6f6e 7461 696e 696e  Device containin
-00001380: 6720 6120 7269 6e67 2070 6f6c 7967 6f6e  g a ring polygon
-00001390: 2e0a 0a20 2020 204e 6f74 6573 0a20 2020  ...    Notes.   
-000013a0: 202d 2d2d 2d2d 0a20 2020 2054 6865 2072   -----.    The r
-000013b0: 696e 6720 6973 2066 6f72 6d65 6420 6279  ing is formed by
-000013c0: 2074 616b 696e 6720 7468 6520 7261 6469   taking the radi
-000013d0: 7573 206f 7574 2074 6f20 7468 6520 7370  us out to the sp
-000013e0: 6563 6966 6965 6420 7661 6c75 652c 2061  ecified value, a
-000013f0: 6e64 0a20 2020 2074 6865 6e20 636f 6e73  nd.    then cons
-00001400: 7472 7563 7469 6e67 2074 6865 2074 6869  tructing the thi
-00001410: 636b 6e65 7373 2062 7920 6469 7669 6469  ckness by dividi
-00001420: 6e67 2074 6865 2077 6964 7468 2069 6e20  ng the width in 
-00001430: 6861 6c66 2061 6e64 2061 6464 696e 670a  half and adding.
-00001440: 2020 2020 7468 6174 2076 616c 7565 2074      that value t
-00001450: 6f20 6569 7468 6572 2073 6964 6520 6f66  o either side of
-00001460: 2074 6865 2072 6164 6975 732e 0a0a 2020   the radius...  
-00001470: 2020 5468 6520 616e 676c 655f 7265 736f    The angle_reso
-00001480: 6c75 7469 6f6e 2061 6c74 6572 7320 7468  lution alters th
-00001490: 6520 7072 6563 6973 696f 6e20 6f66 2074  e precision of t
-000014a0: 6865 2063 7572 7665 206f 6620 7468 6520  he curve of the 
-000014b0: 7269 6e67 2e20 4c61 7267 6572 0a20 2020  ring. Larger.   
-000014c0: 2076 616c 7565 7320 7969 656c 6420 6c6f   values yield lo
-000014d0: 7765 7220 7265 736f 6c75 7469 6f6e 2e0a  wer resolution..
-000014e0: 2020 2020 2222 220a 2020 2020 4420 3d20      """.    D = 
-000014f0: 4465 7669 6365 286e 616d 653d 2272 696e  Device(name="rin
-00001500: 6722 290a 2020 2020 696e 6e65 725f 7261  g").    inner_ra
-00001510: 6469 7573 203d 2072 6164 6975 7320 2d20  dius = radius - 
-00001520: 7769 6474 6820 2f20 320a 2020 2020 6f75  width / 2.    ou
-00001530: 7465 725f 7261 6469 7573 203d 2072 6164  ter_radius = rad
-00001540: 6975 7320 2b20 7769 6474 6820 2f20 320a  ius + width / 2.
-00001550: 2020 2020 6e20 3d20 696e 7428 6e70 2e72      n = int(np.r
-00001560: 6f75 6e64 2833 3630 202f 2061 6e67 6c65  ound(360 / angle
-00001570: 5f72 6573 6f6c 7574 696f 6e29 290a 2020  _resolution)).  
-00001580: 2020 7420 3d20 6e70 2e6c 696e 7370 6163    t = np.linspac
-00001590: 6528 302c 2033 3630 2c20 6e20 2b20 3129  e(0, 360, n + 1)
-000015a0: 202a 2070 6920 2f20 3138 300a 2020 2020   * pi / 180.    
-000015b0: 696e 6e65 725f 706f 696e 7473 5f78 203d  inner_points_x =
-000015c0: 2028 696e 6e65 725f 7261 6469 7573 202a   (inner_radius *
-000015d0: 2063 6f73 2874 2929 2e74 6f6c 6973 7428   cos(t)).tolist(
-000015e0: 290a 2020 2020 696e 6e65 725f 706f 696e  ).    inner_poin
-000015f0: 7473 5f79 203d 2028 696e 6e65 725f 7261  ts_y = (inner_ra
-00001600: 6469 7573 202a 2073 696e 2874 2929 2e74  dius * sin(t)).t
-00001610: 6f6c 6973 7428 290a 2020 2020 6f75 7465  olist().    oute
-00001620: 725f 706f 696e 7473 5f78 203d 2028 6f75  r_points_x = (ou
-00001630: 7465 725f 7261 6469 7573 202a 2063 6f73  ter_radius * cos
-00001640: 2874 2929 2e74 6f6c 6973 7428 290a 2020  (t)).tolist().  
-00001650: 2020 6f75 7465 725f 706f 696e 7473 5f79    outer_points_y
-00001660: 203d 2028 6f75 7465 725f 7261 6469 7573   = (outer_radius
-00001670: 202a 2073 696e 2874 2929 2e74 6f6c 6973   * sin(t)).tolis
-00001680: 7428 290a 2020 2020 7870 7473 203d 2069  t().    xpts = i
-00001690: 6e6e 6572 5f70 6f69 6e74 735f 7820 2b20  nner_points_x + 
-000016a0: 6f75 7465 725f 706f 696e 7473 5f78 5b3a  outer_points_x[:
-000016b0: 3a2d 315d 0a20 2020 2079 7074 7320 3d20  :-1].    ypts = 
-000016c0: 696e 6e65 725f 706f 696e 7473 5f79 202b  inner_points_y +
-000016d0: 206f 7574 6572 5f70 6f69 6e74 735f 795b   outer_points_y[
-000016e0: 3a3a 2d31 5d0a 2020 2020 442e 6164 645f  ::-1].    D.add_
-000016f0: 706f 6c79 676f 6e28 706f 696e 7473 3d28  polygon(points=(
-00001700: 7870 7473 2c20 7970 7473 292c 206c 6179  xpts, ypts), lay
-00001710: 6572 3d6c 6179 6572 290a 2020 2020 7265  er=layer).    re
-00001720: 7475 726e 2044 0a0a 0a64 6566 2061 7263  turn D...def arc
-00001730: 2872 6164 6975 733d 3130 2c20 7769 6474  (radius=10, widt
-00001740: 683d 302e 352c 2074 6865 7461 3d34 352c  h=0.5, theta=45,
-00001750: 2073 7461 7274 5f61 6e67 6c65 3d30 2c20   start_angle=0, 
-00001760: 616e 676c 655f 7265 736f 6c75 7469 6f6e  angle_resolution
-00001770: 3d32 2e35 2c20 6c61 7965 723d 3029 3a0a  =2.5, layer=0):.
-00001780: 2020 2020 2222 2243 7265 6174 6573 2061      """Creates a
-00001790: 6e20 6172 6320 6f66 2061 7263 6c65 6e67  n arc of arcleng
-000017a0: 7468 2060 6074 6865 7461 6060 2073 7461  th ``theta`` sta
-000017b0: 7274 696e 6720 6174 2061 6e67 6c65 0a20  rting at angle. 
-000017c0: 2020 2060 6073 7461 7274 5f61 6e67 6c65     ``start_angle
-000017d0: 6060 2e0a 0a20 2020 2050 6172 616d 6574  ``...    Paramet
-000017e0: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
-000017f0: 2d2d 0a20 2020 2072 6164 6975 7320 3a20  --.    radius : 
-00001800: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
-00001810: 2020 2020 2052 6164 6975 7320 6f66 2074       Radius of t
-00001820: 6865 2061 7263 2063 656e 7465 726c 696e  he arc centerlin
-00001830: 652e 0a20 2020 2077 6964 7468 203a 2069  e..    width : i
-00001840: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
-00001850: 2020 2020 5769 6474 6820 6f66 2074 6865      Width of the
-00001860: 2061 7263 2e0a 2020 2020 7468 6574 6120   arc..    theta 
-00001870: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
-00001880: 2020 2020 2020 2054 6f74 616c 2061 6e67         Total ang
-00001890: 6c65 2063 6f76 6572 6167 6520 6f66 2074  le coverage of t
-000018a0: 6865 2061 7263 2e0a 2020 2020 7374 6172  he arc..    star
-000018b0: 745f 616e 676c 6520 3a20 696e 7420 6f72  t_angle : int or
-000018c0: 2066 6c6f 6174 0a20 2020 2020 2020 2053   float.        S
-000018d0: 7461 7274 696e 6720 616e 676c 652e 0a20  tarting angle.. 
-000018e0: 2020 2061 6e67 6c65 5f72 6573 6f6c 7574     angle_resolut
-000018f0: 696f 6e20 3a20 696e 7420 6f72 2066 6c6f  ion : int or flo
-00001900: 6174 0a20 2020 2020 2020 2052 6573 6f6c  at.        Resol
-00001910: 7574 696f 6e20 6f66 2074 6865 2063 7572  ution of the cur
-00001920: 7665 206f 6620 7468 6520 6172 632e 0a20  ve of the arc.. 
-00001930: 2020 206c 6179 6572 203a 2069 6e74 2c20     layer : int, 
-00001940: 6172 7261 792d 6c69 6b65 5b32 5d2c 206f  array-like[2], o
-00001950: 7220 7365 740a 2020 2020 2020 2020 5370  r set.        Sp
-00001960: 6563 6966 6963 206c 6179 6572 2873 2920  ecific layer(s) 
-00001970: 746f 2070 7574 2070 6f6c 7967 6f6e 2067  to put polygon g
-00001980: 656f 6d65 7472 7920 6f6e 2e0a 0a20 2020  eometry on...   
-00001990: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
-000019a0: 2d2d 2d2d 0a20 2020 2044 203a 2044 6576  ----.    D : Dev
-000019b0: 6963 650a 2020 2020 2020 2020 4120 4465  ice.        A De
-000019c0: 7669 6365 2063 6f6e 7461 696e 696e 6720  vice containing 
-000019d0: 616e 2061 7263 2070 6f6c 7967 6f6e 2061  an arc polygon a
-000019e0: 6e64 2074 776f 2070 6f72 7473 2028 6031  nd two ports (`1
-000019f0: 6020 616e 6420 6032 6029 206f 6e0a 2020  ` and `2`) on.  
-00001a00: 2020 2020 2020 6569 7468 6572 2065 6e64        either end
-00001a10: 2e0a 0a20 2020 204e 6f74 6573 0a20 2020  ...    Notes.   
-00001a20: 202d 2d2d 2d2d 0a20 2020 2054 6865 7461   -----.    Theta
-00001a30: 203d 2030 2069 7320 6c6f 6361 7465 6420   = 0 is located 
-00001a40: 616c 6f6e 6720 7468 6520 706f 7369 7469  along the positi
-00001a50: 7665 2078 2d61 7869 7320 7265 6c61 7469  ve x-axis relati
-00001a60: 7665 2074 6f20 7468 6520 6365 6e74 6572  ve to the center
-00001a70: 206f 660a 2020 2020 7468 6520 6172 632e   of.    the arc.
-00001a80: 0a0a 2020 2020 506f 7274 7320 6172 6520  ..    Ports are 
-00001a90: 6164 6465 6420 746f 2065 6163 6820 656e  added to each en
-00001aa0: 6420 6f66 2074 6865 2061 7263 2074 6f20  d of the arc to 
-00001ab0: 6661 6369 6c69 7461 7465 2063 6f6e 6e65  facilitate conne
-00001ac0: 6374 696e 6720 7468 6f73 6520 656e 6473  cting those ends
-00001ad0: 0a20 2020 2074 6f20 6f74 6865 7220 6765  .    to other ge
-00001ae0: 6f6d 6574 7269 6573 2e0a 2020 2020 2222  ometries..    ""
-00001af0: 220a 2020 2020 696e 6e65 725f 7261 6469  ".    inner_radi
-00001b00: 7573 203d 2072 6164 6975 7320 2d20 7769  us = radius - wi
-00001b10: 6474 6820 2f20 320a 2020 2020 6f75 7465  dth / 2.    oute
-00001b20: 725f 7261 6469 7573 203d 2072 6164 6975  r_radius = radiu
-00001b30: 7320 2b20 7769 6474 6820 2f20 320a 2020  s + width / 2.  
-00001b40: 2020 616e 676c 6531 203d 2028 7374 6172    angle1 = (star
-00001b50: 745f 616e 676c 6529 202a 2070 6920 2f20  t_angle) * pi / 
-00001b60: 3138 300a 2020 2020 616e 676c 6532 203d  180.    angle2 =
-00001b70: 2028 7374 6172 745f 616e 676c 6520 2b20   (start_angle + 
-00001b80: 7468 6574 6129 202a 2070 6920 2f20 3138  theta) * pi / 18
-00001b90: 300a 2020 2020 7420 3d20 6e70 2e6c 696e  0.    t = np.lin
-00001ba0: 7370 6163 6528 616e 676c 6531 2c20 616e  space(angle1, an
-00001bb0: 676c 6532 2c20 696e 7428 6e70 2e63 6569  gle2, int(np.cei
-00001bc0: 6c28 6162 7328 7468 6574 6129 202f 2061  l(abs(theta) / a
-00001bd0: 6e67 6c65 5f72 6573 6f6c 7574 696f 6e29  ngle_resolution)
-00001be0: 2929 0a20 2020 2069 6e6e 6572 5f70 6f69  )).    inner_poi
-00001bf0: 6e74 735f 7820 3d20 2869 6e6e 6572 5f72  nts_x = (inner_r
-00001c00: 6164 6975 7320 2a20 636f 7328 7429 292e  adius * cos(t)).
-00001c10: 746f 6c69 7374 2829 0a20 2020 2069 6e6e  tolist().    inn
-00001c20: 6572 5f70 6f69 6e74 735f 7920 3d20 2869  er_points_y = (i
-00001c30: 6e6e 6572 5f72 6164 6975 7320 2a20 7369  nner_radius * si
-00001c40: 6e28 7429 292e 746f 6c69 7374 2829 0a20  n(t)).tolist(). 
-00001c50: 2020 206f 7574 6572 5f70 6f69 6e74 735f     outer_points_
-00001c60: 7820 3d20 286f 7574 6572 5f72 6164 6975  x = (outer_radiu
-00001c70: 7320 2a20 636f 7328 7429 292e 746f 6c69  s * cos(t)).toli
-00001c80: 7374 2829 0a20 2020 206f 7574 6572 5f70  st().    outer_p
-00001c90: 6f69 6e74 735f 7920 3d20 286f 7574 6572  oints_y = (outer
-00001ca0: 5f72 6164 6975 7320 2a20 7369 6e28 7429  _radius * sin(t)
-00001cb0: 292e 746f 6c69 7374 2829 0a20 2020 2078  ).tolist().    x
-00001cc0: 7074 7320 3d20 696e 6e65 725f 706f 696e  pts = inner_poin
-00001cd0: 7473 5f78 202b 206f 7574 6572 5f70 6f69  ts_x + outer_poi
-00001ce0: 6e74 735f 785b 3a3a 2d31 5d0a 2020 2020  nts_x[::-1].    
-00001cf0: 7970 7473 203d 2069 6e6e 6572 5f70 6f69  ypts = inner_poi
-00001d00: 6e74 735f 7920 2b20 6f75 7465 725f 706f  nts_y + outer_po
-00001d10: 696e 7473 5f79 5b3a 3a2d 315d 0a0a 2020  ints_y[::-1]..  
-00001d20: 2020 4420 3d20 4465 7669 6365 2822 6172    D = Device("ar
-00001d30: 6322 290a 2020 2020 442e 6164 645f 706f  c").    D.add_po
-00001d40: 6c79 676f 6e28 706f 696e 7473 3d28 7870  lygon(points=(xp
-00001d50: 7473 2c20 7970 7473 292c 206c 6179 6572  ts, ypts), layer
-00001d60: 3d6c 6179 6572 290a 2020 2020 442e 6164  =layer).    D.ad
-00001d70: 645f 706f 7274 280a 2020 2020 2020 2020  d_port(.        
-00001d80: 6e61 6d65 3d31 2c0a 2020 2020 2020 2020  name=1,.        
-00001d90: 6d69 6470 6f69 6e74 3d28 7261 6469 7573  midpoint=(radius
-00001da0: 202a 2063 6f73 2861 6e67 6c65 3129 2c20   * cos(angle1), 
-00001db0: 7261 6469 7573 202a 2073 696e 2861 6e67  radius * sin(ang
-00001dc0: 6c65 3129 292c 0a20 2020 2020 2020 2077  le1)),.        w
-00001dd0: 6964 7468 3d77 6964 7468 2c0a 2020 2020  idth=width,.    
-00001de0: 2020 2020 6f72 6965 6e74 6174 696f 6e3d      orientation=
-00001df0: 7374 6172 745f 616e 676c 6520 2d20 3930  start_angle - 90
-00001e00: 202b 2031 3830 202a 2028 7468 6574 6120   + 180 * (theta 
-00001e10: 3c20 3029 2c0a 2020 2020 290a 2020 2020  < 0),.    ).    
-00001e20: 442e 6164 645f 706f 7274 280a 2020 2020  D.add_port(.    
-00001e30: 2020 2020 6e61 6d65 3d32 2c0a 2020 2020      name=2,.    
-00001e40: 2020 2020 6d69 6470 6f69 6e74 3d28 7261      midpoint=(ra
-00001e50: 6469 7573 202a 2063 6f73 2861 6e67 6c65  dius * cos(angle
-00001e60: 3229 2c20 7261 6469 7573 202a 2073 696e  2), radius * sin
-00001e70: 2861 6e67 6c65 3229 292c 0a20 2020 2020  (angle2)),.     
-00001e80: 2020 2077 6964 7468 3d77 6964 7468 2c0a     width=width,.
-00001e90: 2020 2020 2020 2020 6f72 6965 6e74 6174          orientat
-00001ea0: 696f 6e3d 7374 6172 745f 616e 676c 6520  ion=start_angle 
-00001eb0: 2b20 7468 6574 6120 2b20 3930 202d 2031  + theta + 90 - 1
-00001ec0: 3830 202a 2028 7468 6574 6120 3c20 3029  80 * (theta < 0)
-00001ed0: 2c0a 2020 2020 290a 2020 2020 442e 696e  ,.    ).    D.in
-00001ee0: 666f 5b22 6c65 6e67 7468 225d 203d 2028  fo["length"] = (
-00001ef0: 6162 7328 7468 6574 6129 202a 2070 6920  abs(theta) * pi 
-00001f00: 2f20 3138 3029 202a 2072 6164 6975 730a  / 180) * radius.
-00001f10: 2020 2020 7265 7475 726e 2044 0a0a 0a64      return D...d
-00001f20: 6566 2074 7572 6e28 706f 7274 2c20 7261  ef turn(port, ra
-00001f30: 6469 7573 3d31 302c 2061 6e67 6c65 3d32  dius=10, angle=2
-00001f40: 3730 2c20 616e 676c 655f 7265 736f 6c75  70, angle_resolu
-00001f50: 7469 6f6e 3d32 2e35 2c20 6c61 7965 723d  tion=2.5, layer=
-00001f60: 3029 3a0a 2020 2020 2222 2253 7461 7274  0):.    """Start
-00001f70: 696e 6720 6672 6f6d 2061 2070 6f72 742c  ing from a port,
-00001f80: 2063 7265 6174 6573 2061 6e20 6172 6320   creates an arc 
-00001f90: 7768 6963 6820 636f 6e6e 6563 7473 2074  which connects t
-00001fa0: 6f20 7468 6520 7370 6563 6966 6965 640a  o the specified.
-00001fb0: 2020 2020 706f 7274 206f 6e20 6f6e 6520      port on one 
-00001fc0: 656e 642e 0a0a 2020 2020 5061 7261 6d65  end...    Parame
-00001fd0: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
-00001fe0: 2d2d 2d0a 2020 2020 706f 7274 203a 2050  ---.    port : P
-00001ff0: 6f72 740a 2020 2020 2020 2020 506f 7274  ort.        Port
-00002000: 2074 6f20 616e 6368 6f72 2061 7263 2074   to anchor arc t
-00002010: 6f2e 0a20 2020 2072 6164 6975 7320 3a20  o..    radius : 
-00002020: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
-00002030: 2020 2020 2052 6164 6975 7320 6f66 2074       Radius of t
-00002040: 6865 2061 7263 2063 656e 7465 726c 696e  he arc centerlin
-00002050: 652e 0a20 2020 2061 6e67 6c65 203a 2069  e..    angle : i
-00002060: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
-00002070: 2020 2020 546f 7461 6c20 616e 676c 6520      Total angle 
-00002080: 636f 7665 7261 6765 206f 6620 7468 6520  coverage of the 
-00002090: 6172 632e 0a20 2020 2061 6e67 6c65 5f72  arc..    angle_r
-000020a0: 6573 6f6c 7574 696f 6e20 3a20 696e 7420  esolution : int 
-000020b0: 6f72 2066 6c6f 6174 0a20 2020 2020 2020  or float.       
-000020c0: 2052 6573 6f6c 7574 696f 6e20 6f66 2074   Resolution of t
-000020d0: 6865 2063 7572 7665 206f 6620 7468 6520  he curve of the 
-000020e0: 6172 632e 0a20 2020 206c 6179 6572 203a  arc..    layer :
-000020f0: 2069 6e74 2c20 6172 7261 792d 6c69 6b65   int, array-like
-00002100: 5b32 5d2c 206f 7220 7365 740a 2020 2020  [2], or set.    
-00002110: 2020 2020 5370 6563 6966 6963 206c 6179      Specific lay
-00002120: 6572 2873 2920 746f 2070 7574 2074 6865  er(s) to put the
-00002130: 2070 6f6c 7967 6f6e 2067 656f 6d65 7472   polygon geometr
-00002140: 7920 6f6e 2e0a 0a20 2020 2052 6574 7572  y on...    Retur
-00002150: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
-00002160: 2020 2044 203a 2044 6576 6963 650a 2020     D : Device.  
-00002170: 2020 2020 2020 4120 4465 7669 6365 2063        A Device c
-00002180: 6f6e 7461 696e 696e 6720 616e 2061 7263  ontaining an arc
-00002190: 2070 6f6c 7967 6f6e 2061 6e64 2074 776f   polygon and two
-000021a0: 2070 6f72 7473 2028 6031 6020 616e 6420   ports (`1` and 
-000021b0: 6032 6029 206f 6e0a 2020 2020 2020 2020  `2`) on.        
-000021c0: 6569 7468 6572 2065 6e64 2e0a 0a20 2020  either end...   
-000021d0: 204e 6f74 6573 0a20 2020 202d 2d2d 2d2d   Notes.    -----
-000021e0: 0a20 2020 2041 6e67 6c65 203d 2030 2069  .    Angle = 0 i
-000021f0: 7320 6c6f 6361 7465 6420 616c 6f6e 6720  s located along 
-00002200: 7468 6520 706f 7369 7469 7665 2078 2d61  the positive x-a
-00002210: 7869 7320 7265 6c61 7469 7665 2074 6f20  xis relative to 
-00002220: 7468 6520 6365 6e74 6572 206f 660a 2020  the center of.  
-00002230: 2020 7468 6520 6172 632e 0a20 2020 2050    the arc..    P
-00002240: 6f72 7473 2061 7265 2061 6464 6564 2074  orts are added t
-00002250: 6f20 6561 6368 2065 6e64 206f 6620 7468  o each end of th
-00002260: 6520 6172 6320 746f 2066 6163 696c 6974  e arc to facilit
-00002270: 6174 6520 636f 6e6e 6563 7469 6e67 2074  ate connecting t
-00002280: 686f 7365 2065 6e64 730a 2020 2020 746f  hose ends.    to
-00002290: 206f 7468 6572 2067 656f 6d65 7472 6965   other geometrie
-000022a0: 732e 0a20 2020 2050 6f72 7420 6032 6020  s..    Port `2` 
-000022b0: 6973 2061 6c69 676e 6564 2074 6f20 636f  is aligned to co
-000022c0: 6e6e 6563 7420 746f 2074 6865 2073 7065  nnect to the spe
-000022d0: 6369 6669 6564 2070 6f72 742e 0a20 2020  cified port..   
-000022e0: 2022 2222 0a20 2020 2044 203d 2061 7263   """.    D = arc
-000022f0: 280a 2020 2020 2020 2020 7261 6469 7573  (.        radius
-00002300: 3d72 6164 6975 732c 0a20 2020 2020 2020  =radius,.       
-00002310: 2077 6964 7468 3d70 6f72 742e 7769 6474   width=port.widt
-00002320: 682c 0a20 2020 2020 2020 2074 6865 7461  h,.        theta
-00002330: 3d61 6e67 6c65 2c0a 2020 2020 2020 2020  =angle,.        
-00002340: 7374 6172 745f 616e 676c 653d 302c 0a20  start_angle=0,. 
-00002350: 2020 2020 2020 2061 6e67 6c65 5f72 6573         angle_res
-00002360: 6f6c 7574 696f 6e3d 616e 676c 655f 7265  olution=angle_re
-00002370: 736f 6c75 7469 6f6e 2c0a 2020 2020 2020  solution,.      
-00002380: 2020 6c61 7965 723d 6c61 7965 722c 0a20    layer=layer,. 
-00002390: 2020 2029 0a20 2020 2044 2e72 6f74 6174     ).    D.rotat
-000023a0: 6528 0a20 2020 2020 2020 2061 6e67 6c65  e(.        angle
-000023b0: 3d31 3830 202b 2070 6f72 742e 6f72 6965  =180 + port.orie
-000023c0: 6e74 6174 696f 6e20 2d20 442e 706f 7274  ntation - D.port
-000023d0: 735b 315d 2e6f 7269 656e 7461 7469 6f6e  s[1].orientation
-000023e0: 2c0a 2020 2020 2020 2020 6365 6e74 6572  ,.        center
-000023f0: 3d44 2e70 6f72 7473 5b31 5d2e 6d69 6470  =D.ports[1].midp
-00002400: 6f69 6e74 2c0a 2020 2020 290a 2020 2020  oint,.    ).    
-00002410: 442e 6d6f 7665 286f 7269 6769 6e3d 442e  D.move(origin=D.
-00002420: 706f 7274 735b 315d 2c20 6465 7374 696e  ports[1], destin
-00002430: 6174 696f 6e3d 706f 7274 290a 2020 2020  ation=port).    
-00002440: 7265 7475 726e 2044 0a0a 0a64 6566 2073  return D...def s
-00002450: 7472 6169 6768 7428 7369 7a65 3d28 342c  traight(size=(4,
-00002460: 2032 292c 206c 6179 6572 3d30 293a 0a20   2), layer=0):. 
-00002470: 2020 2022 2222 4765 6e65 7261 7465 7320     """Generates 
-00002480: 6120 7265 6374 616e 6775 6c61 7220 7769  a rectangular wi
-00002490: 7265 2067 656f 6d65 7472 7920 7769 7468  re geometry with
-000024a0: 2070 6f72 7473 206f 6e20 7468 6520 6c65   ports on the le
-000024b0: 6e67 7468 2065 6467 6573 2e0a 0a20 2020  ngth edges...   
-000024c0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-000024d0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2073  ----------.    s
-000024e0: 697a 6520 3a20 7475 706c 6520 6f66 2069  ize : tuple of i
-000024f0: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
-00002500: 2020 2020 5468 6520 6c65 6e67 7468 2061      The length a
-00002510: 6e64 2077 6964 7468 206f 6620 7468 6520  nd width of the 
-00002520: 7265 6374 616e 676c 652e 0a20 2020 206c  rectangle..    l
-00002530: 6179 6572 203a 2069 6e74 2c20 6172 7261  ayer : int, arra
-00002540: 792d 6c69 6b65 5b32 5d2c 206f 7220 7365  y-like[2], or se
-00002550: 740a 2020 2020 2020 2020 5370 6563 6966  t.        Specif
-00002560: 6963 206c 6179 6572 2873 2920 746f 2070  ic layer(s) to p
-00002570: 7574 2070 6f6c 7967 6f6e 2067 656f 6d65  ut polygon geome
-00002580: 7472 7920 6f6e 2e0a 0a20 2020 2052 6574  try on...    Ret
-00002590: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
-000025a0: 0a20 2020 2044 203a 2044 6576 6963 650a  .    D : Device.
-000025b0: 2020 2020 2020 2020 4120 4465 7669 6365          A Device
-000025c0: 2063 6f6e 7461 696e 696e 6720 6120 7265   containing a re
-000025d0: 6374 616e 676c 6520 706f 6c79 676f 6e20  ctangle polygon 
-000025e0: 616e 6420 7477 6f20 706f 7274 7320 2860  and two ports (`
-000025f0: 3160 2061 6e64 2060 3260 2920 6f6e 0a20  1` and `2`) on. 
-00002600: 2020 2020 2020 2065 6974 6865 7220 656e         either en
-00002610: 642e 0a0a 2020 2020 4e6f 7465 730a 2020  d...    Notes.  
-00002620: 2020 2d2d 2d2d 2d0a 2020 2020 506f 7274    -----.    Port
-00002630: 7320 6172 6520 696e 636c 7564 6564 206f  s are included o
-00002640: 6e20 626f 7468 2073 6964 6573 206f 6620  n both sides of 
-00002650: 7468 6520 6c65 6e67 7468 2065 6467 6520  the length edge 
-00002660: 2869 2e65 2e20 7369 7a65 5b30 5d29 206f  (i.e. size[0]) o
-00002670: 6620 7468 650a 2020 2020 6765 6f6d 6574  f the.    geomet
-00002680: 7279 2e0a 2020 2020 2222 220a 2020 2020  ry..    """.    
-00002690: 4420 3d20 4465 7669 6365 286e 616d 653d  D = Device(name=
-000026a0: 2277 6972 6522 290a 2020 2020 706f 696e  "wire").    poin
-000026b0: 7473 203d 205b 5b73 697a 655b 305d 2c20  ts = [[size[0], 
-000026c0: 7369 7a65 5b31 5d5d 2c20 5b73 697a 655b  size[1]], [size[
-000026d0: 305d 2c20 305d 2c20 5b30 2c20 305d 2c20  0], 0], [0, 0], 
-000026e0: 5b30 2c20 7369 7a65 5b31 5d5d 5d0a 2020  [0, size[1]]].  
-000026f0: 2020 442e 6164 645f 706f 6c79 676f 6e28    D.add_polygon(
-00002700: 706f 696e 7473 2c20 6c61 7965 723d 6c61  points, layer=la
-00002710: 7965 7229 0a20 2020 2044 2e61 6464 5f70  yer).    D.add_p
-00002720: 6f72 7428 6e61 6d65 3d31 2c20 6d69 6470  ort(name=1, midp
-00002730: 6f69 6e74 3d28 7369 7a65 5b30 5d20 2f20  oint=(size[0] / 
-00002740: 322c 2073 697a 655b 315d 292c 2077 6964  2, size[1]), wid
-00002750: 7468 3d73 697a 655b 305d 2c20 6f72 6965  th=size[0], orie
-00002760: 6e74 6174 696f 6e3d 3930 290a 2020 2020  ntation=90).    
-00002770: 442e 6164 645f 706f 7274 286e 616d 653d  D.add_port(name=
-00002780: 322c 206d 6964 706f 696e 743d 2873 697a  2, midpoint=(siz
-00002790: 655b 305d 202f 2032 2c20 3029 2c20 7769  e[0] / 2, 0), wi
-000027a0: 6474 683d 7369 7a65 5b30 5d2c 206f 7269  dth=size[0], ori
-000027b0: 656e 7461 7469 6f6e 3d2d 3930 290a 2020  entation=-90).  
-000027c0: 2020 7265 7475 726e 2044 0a0a 0a64 6566    return D...def
-000027d0: 204c 2877 6964 7468 3d31 2c20 7369 7a65   L(width=1, size
-000027e0: 3d28 3130 2c20 3230 292c 206c 6179 6572  =(10, 20), layer
-000027f0: 3d30 293a 0a20 2020 2022 2222 4765 6e65  =0):.    """Gene
-00002800: 7261 7465 7320 616e 2027 4c27 2067 656f  rates an 'L' geo
-00002810: 6d65 7472 7920 7769 7468 2070 6f72 7473  metry with ports
-00002820: 206f 6e20 626f 7468 2065 6e64 732e 0a0a   on both ends...
-00002830: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00002840: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00002850: 2020 7769 6474 6820 3a20 696e 7420 6f72    width : int or
-00002860: 2066 6c6f 6174 0a20 2020 2020 2020 2054   float.        T
-00002870: 6869 636b 6e65 7373 206f 6620 7468 6520  hickness of the 
-00002880: 6c69 6e65 2066 6f72 6d69 6e67 2074 6865  line forming the
-00002890: 204c 2e0a 2020 2020 7369 7a65 203a 2074   L..    size : t
-000028a0: 7570 6c65 206f 6620 696e 7420 6f72 2066  uple of int or f
-000028b0: 6c6f 6174 0a20 2020 2020 2020 204c 656e  loat.        Len
-000028c0: 6774 6873 206f 6620 7468 6520 6261 7365  gths of the base
-000028d0: 2061 6e64 2068 6569 6768 7420 6f66 2074   and height of t
-000028e0: 6865 204c 2c20 7265 7370 6563 7469 7665  he L, respective
-000028f0: 6c79 2e0a 2020 2020 6c61 7965 7220 3a20  ly..    layer : 
-00002900: 696e 742c 2061 7272 6179 2d6c 696b 655b  int, array-like[
-00002910: 325d 2c20 6f72 2073 6574 0a20 2020 2020  2], or set.     
-00002920: 2020 2053 7065 6369 6669 6320 6c61 7965     Specific laye
-00002930: 7228 7329 2074 6f20 7075 7420 706f 6c79  r(s) to put poly
-00002940: 676f 6e20 6765 6f6d 6574 7279 206f 6e2e  gon geometry on.
-00002950: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
-00002960: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 4420    -------.    D 
-00002970: 3a20 4465 7669 6365 0a20 2020 2020 2020  : Device.       
-00002980: 2041 2044 6576 6963 6520 636f 6e74 6169   A Device contai
-00002990: 6e69 6e67 2061 6e20 4c2d 7368 6170 6564  ning an L-shaped
-000029a0: 2070 6f6c 7967 6f6e 2061 6e64 2074 776f   polygon and two
-000029b0: 2070 6f72 7473 2028 6031 6020 616e 6420   ports (`1` and 
-000029c0: 6032 6029 206f 6e0a 2020 2020 2020 2020  `2`) on.        
-000029d0: 6569 7468 6572 2065 6e64 206f 6620 7468  either end of th
-000029e0: 6520 4c2e 0a20 2020 2022 2222 0a20 2020  e L..    """.   
-000029f0: 2044 203d 2044 6576 6963 6528 6e61 6d65   D = Device(name
-00002a00: 3d22 4c22 290a 2020 2020 7720 3d20 7769  ="L").    w = wi
-00002a10: 6474 6820 2f20 320a 2020 2020 7331 2c20  dth / 2.    s1, 
-00002a20: 7332 203d 2073 697a 650a 2020 2020 706f  s2 = size.    po
-00002a30: 696e 7473 203d 205b 282d 772c 202d 7729  ints = [(-w, -w)
-00002a40: 2c20 2873 312c 202d 7729 2c20 2873 312c  , (s1, -w), (s1,
-00002a50: 2077 292c 2028 772c 2077 292c 2028 772c   w), (w, w), (w,
-00002a60: 2073 3229 2c20 282d 772c 2073 3229 2c20   s2), (-w, s2), 
-00002a70: 282d 772c 202d 7729 5d0a 2020 2020 442e  (-w, -w)].    D.
-00002a80: 6164 645f 706f 6c79 676f 6e28 706f 696e  add_polygon(poin
-00002a90: 7473 2c20 6c61 7965 723d 6c61 7965 7229  ts, layer=layer)
-00002aa0: 0a20 2020 2044 2e61 6464 5f70 6f72 7428  .    D.add_port(
-00002ab0: 6e61 6d65 3d31 2c20 6d69 6470 6f69 6e74  name=1, midpoint
-00002ac0: 3d28 302c 2073 3229 2c20 7769 6474 683d  =(0, s2), width=
-00002ad0: 7769 6474 682c 206f 7269 656e 7461 7469  width, orientati
-00002ae0: 6f6e 3d39 3029 0a20 2020 2044 2e61 6464  on=90).    D.add
-00002af0: 5f70 6f72 7428 6e61 6d65 3d32 2c20 6d69  _port(name=2, mi
-00002b00: 6470 6f69 6e74 3d28 7331 2c20 3029 2c20  dpoint=(s1, 0), 
-00002b10: 7769 6474 683d 7769 6474 682c 206f 7269  width=width, ori
-00002b20: 656e 7461 7469 6f6e 3d30 290a 2020 2020  entation=0).    
-00002b30: 7265 7475 726e 2044 0a0a 0a64 6566 2043  return D...def C
-00002b40: 2877 6964 7468 3d31 2c20 7369 7a65 3d28  (width=1, size=(
-00002b50: 3130 2c20 3230 292c 206c 6179 6572 3d30  10, 20), layer=0
-00002b60: 293a 0a20 2020 2022 2222 4765 6e65 7261  ):.    """Genera
-00002b70: 7465 7320 6120 2743 2720 6765 6f6d 6574  tes a 'C' geomet
-00002b80: 7279 2077 6974 6820 706f 7274 7320 6f6e  ry with ports on
-00002b90: 2062 6f74 6820 656e 6473 2e0a 0a20 2020   both ends...   
-00002ba0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00002bb0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2077  ----------.    w
-00002bc0: 6964 7468 203a 2069 6e74 206f 7220 666c  idth : int or fl
-00002bd0: 6f61 740a 2020 2020 2020 2020 5468 6963  oat.        Thic
-00002be0: 6b6e 6573 7320 6f66 2074 6865 206c 696e  kness of the lin
-00002bf0: 6520 666f 726d 696e 6720 7468 6520 432e  e forming the C.
-00002c00: 0a20 2020 2073 697a 6520 3a20 7475 706c  .    size : tupl
-00002c10: 6520 6f66 2069 6e74 206f 7220 666c 6f61  e of int or floa
-00002c20: 740a 2020 2020 2020 2020 4c65 6e67 7468  t.        Length
-00002c30: 7320 6f66 2074 6865 2062 6173 6520 2b20  s of the base + 
-00002c40: 746f 7020 6564 6765 7320 616e 6420 7468  top edges and th
-00002c50: 6520 6865 6967 6874 206f 6620 7468 6520  e height of the 
-00002c60: 432c 2072 6573 7065 6374 6976 656c 792e  C, respectively.
-00002c70: 0a20 2020 206c 6179 6572 203a 2069 6e74  .    layer : int
-00002c80: 2c20 6172 7261 792d 6c69 6b65 5b32 5d2c  , array-like[2],
-00002c90: 206f 7220 7365 740a 2020 2020 2020 2020   or set.        
-00002ca0: 5370 6563 6966 6963 206c 6179 6572 2873  Specific layer(s
-00002cb0: 2920 746f 2070 7574 2070 6f6c 7967 6f6e  ) to put polygon
-00002cc0: 2067 656f 6d65 7472 7920 6f6e 2e0a 0a20   geometry on... 
-00002cd0: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
-00002ce0: 2d2d 2d2d 2d2d 0a20 2020 2044 203a 2044  ------.    D : D
-00002cf0: 6576 6963 650a 2020 2020 2020 2020 4120  evice.        A 
-00002d00: 4465 7669 6365 2063 6f6e 7461 696e 696e  Device containin
-00002d10: 6720 6120 5b2d 6272 6163 6b65 742d 7368  g a [-bracket-sh
-00002d20: 6170 6564 2070 6f6c 7967 6f6e 2061 6e64  aped polygon and
-00002d30: 2074 776f 2070 6f72 7473 2028 6031 6020   two ports (`1` 
-00002d40: 616e 640a 2020 2020 2020 2020 6032 6029  and.        `2`)
-00002d50: 206f 6e20 6569 7468 6572 2065 6e64 206f   on either end o
-00002d60: 6620 7468 6520 5b20 7368 6170 652e 0a20  f the [ shape.. 
-00002d70: 2020 2022 2222 0a20 2020 2044 203d 2044     """.    D = D
-00002d80: 6576 6963 6528 6e61 6d65 3d22 4322 290a  evice(name="C").
-00002d90: 2020 2020 7720 3d20 7769 6474 6820 2f20      w = width / 
-00002da0: 320a 2020 2020 7331 2c20 7332 203d 2073  2.    s1, s2 = s
-00002db0: 697a 650a 2020 2020 706f 696e 7473 203d  ize.    points =
-00002dc0: 205b 0a20 2020 2020 2020 2028 2d77 2c20   [.        (-w, 
-00002dd0: 2d77 292c 0a20 2020 2020 2020 2028 7331  -w),.        (s1
-00002de0: 2c20 2d77 292c 0a20 2020 2020 2020 2028  , -w),.        (
-00002df0: 7331 2c20 7729 2c0a 2020 2020 2020 2020  s1, w),.        
-00002e00: 2877 2c20 7729 2c0a 2020 2020 2020 2020  (w, w),.        
-00002e10: 2877 2c20 7332 202d 2077 292c 0a20 2020  (w, s2 - w),.   
-00002e20: 2020 2020 2028 7331 2c20 7332 202d 2077       (s1, s2 - w
-00002e30: 292c 0a20 2020 2020 2020 2028 7331 2c20  ),.        (s1, 
-00002e40: 7332 202b 2077 292c 0a20 2020 2020 2020  s2 + w),.       
-00002e50: 2028 2d77 2c20 7332 202b 2077 292c 0a20   (-w, s2 + w),. 
-00002e60: 2020 2020 2020 2028 2d77 2c20 2d77 292c         (-w, -w),
-00002e70: 0a20 2020 205d 0a20 2020 2044 2e61 6464  .    ].    D.add
-00002e80: 5f70 6f6c 7967 6f6e 2870 6f69 6e74 732c  _polygon(points,
-00002e90: 206c 6179 6572 3d6c 6179 6572 290a 2020   layer=layer).  
-00002ea0: 2020 442e 6164 645f 706f 7274 286e 616d    D.add_port(nam
-00002eb0: 653d 312c 206d 6964 706f 696e 743d 2873  e=1, midpoint=(s
-00002ec0: 312c 2073 3229 2c20 7769 6474 683d 7769  1, s2), width=wi
-00002ed0: 6474 682c 206f 7269 656e 7461 7469 6f6e  dth, orientation
-00002ee0: 3d30 290a 2020 2020 442e 6164 645f 706f  =0).    D.add_po
-00002ef0: 7274 286e 616d 653d 322c 206d 6964 706f  rt(name=2, midpo
-00002f00: 696e 743d 2873 312c 2030 292c 2077 6964  int=(s1, 0), wid
-00002f10: 7468 3d77 6964 7468 2c20 6f72 6965 6e74  th=width, orient
-00002f20: 6174 696f 6e3d 3029 0a20 2020 2072 6574  ation=0).    ret
-00002f30: 7572 6e20 440a 0a0a 2320 3d3d 3d3d 3d3d  urn D...# ======
-00002f40: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00002f50: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00002f60: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00002f70: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00002f80: 3d3d 3d3d 3d3d 3d3d 0a23 0a23 2042 6f6f  ========.#.# Boo
-00002f90: 6c65 616e 2066 756e 6374 696f 6e73 0a23  lean functions.#
-00002fa0: 0a23 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  .# =============
+00000390: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 230a  =============.#.
+000003a0: 2320 506f 6c79 676f 6e73 202f 2053 6861  # Polygons / Sha
+000003b0: 7065 730a 230a 2320 3d3d 3d3d 3d3d 3d3d  pes.#.# ========
+000003c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000003d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000003e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000003f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00000400: 3d3d 3d3d 3d3d 0a0a 0a64 6566 2072 6563  ======...def rec
+00000410: 7461 6e67 6c65 2873 697a 653d 2834 2c20  tangle(size=(4, 
+00000420: 3229 2c20 6c61 7965 723d 3029 3a0a 2020  2), layer=0):.  
+00000430: 2020 2222 2247 656e 6572 6174 6573 2061    """Generates a
+00000440: 2072 6563 7461 6e67 6c65 2067 656f 6d65   rectangle geome
+00000450: 7472 792e 0a0a 2020 2020 5061 7261 6d65  try...    Parame
+00000460: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
+00000470: 2d2d 2d0a 2020 2020 7369 7a65 203a 2074  ---.    size : t
+00000480: 7570 6c65 206f 6620 696e 7420 6f72 2066  uple of int or f
+00000490: 6c6f 6174 0a20 2020 2020 2020 2057 6964  loat.        Wid
+000004a0: 7468 2061 6e64 2068 6569 6768 7420 6f66  th and height of
+000004b0: 2072 6563 7461 6e67 6c65 2e0a 2020 2020   rectangle..    
+000004c0: 6c61 7965 7220 3a20 696e 742c 2061 7272  layer : int, arr
+000004d0: 6179 2d6c 696b 655b 325d 2c20 6f72 2073  ay-like[2], or s
+000004e0: 6574 0a20 2020 2020 2020 2053 7065 6369  et.        Speci
+000004f0: 6669 6320 6c61 7965 7228 7329 2074 6f20  fic layer(s) to 
+00000500: 7075 7420 706f 6c79 676f 6e20 6765 6f6d  put polygon geom
+00000510: 6574 7279 206f 6e2e 0a0a 2020 2020 5265  etry on...    Re
+00000520: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00000530: 2d0a 2020 2020 4420 3a20 4465 7669 6365  -.    D : Device
+00000540: 0a20 2020 2020 2020 2041 2044 6576 6963  .        A Devic
+00000550: 6520 636f 6e74 6169 6e69 6e67 2061 2073  e containing a s
+00000560: 696e 676c 6520 7265 6374 616e 676c 6520  ingle rectangle 
+00000570: 706f 6c79 676f 6e2e 0a20 2020 2022 2222  polygon..    """
+00000580: 0a20 2020 2044 203d 2044 6576 6963 6528  .    D = Device(
+00000590: 6e61 6d65 3d22 7265 6374 616e 676c 6522  name="rectangle"
+000005a0: 290a 2020 2020 706f 696e 7473 203d 205b  ).    points = [
+000005b0: 5b73 697a 655b 305d 2c20 7369 7a65 5b31  [size[0], size[1
+000005c0: 5d5d 2c20 5b73 697a 655b 305d 2c20 305d  ]], [size[0], 0]
+000005d0: 2c20 5b30 2c20 305d 2c20 5b30 2c20 7369  , [0, 0], [0, si
+000005e0: 7a65 5b31 5d5d 5d0a 2020 2020 442e 6164  ze[1]]].    D.ad
+000005f0: 645f 706f 6c79 676f 6e28 706f 696e 7473  d_polygon(points
+00000600: 2c20 6c61 7965 723d 6c61 7965 7229 0a20  , layer=layer). 
+00000610: 2020 2072 6574 7572 6e20 440a 0a0a 6465     return D...de
+00000620: 6620 6262 6f78 2862 626f 783d 5b28 2d31  f bbox(bbox=[(-1
+00000630: 2c20 2d31 292c 2028 332c 2034 295d 2c20  , -1), (3, 4)], 
+00000640: 6c61 7965 723d 3029 3a0a 2020 2020 2222  layer=0):.    ""
+00000650: 2243 7265 6174 6573 2061 2062 6f75 6e64  "Creates a bound
+00000660: 696e 6720 626f 7820 7265 6374 616e 676c  ing box rectangl
+00000670: 6520 6672 6f6d 2063 6f6f 7264 696e 6174  e from coordinat
+00000680: 6573 2c20 746f 2061 6c6c 6f77 0a20 2020  es, to allow.   
+00000690: 2063 7265 6174 696f 6e20 6f66 2061 2072   creation of a r
+000006a0: 6563 7461 6e67 6c65 2062 6f75 6e64 696e  ectangle boundin
+000006b0: 6720 626f 7820 6469 7265 6374 6c79 2066  g box directly f
+000006c0: 6f72 6d20 616e 6f74 6865 7220 7368 6170  orm another shap
+000006d0: 652e 0a0a 2020 2020 5061 7261 6d65 7465  e...    Paramete
+000006e0: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+000006f0: 2d0a 2020 2020 6262 6f78 203a 206c 6973  -.    bbox : lis
+00000700: 7420 6f66 2074 7570 6c65 7320 6f66 2069  t of tuples of i
+00000710: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
+00000720: 2020 2020 436f 6f72 6469 6e61 7465 7320      Coordinates 
+00000730: 6f66 2074 6865 2062 6f78 205b 2878 312c  of the box [(x1,
+00000740: 2079 3129 2c20 2878 322c 2079 3229 5d2e   y1), (x2, y2)].
+00000750: 0a20 2020 206c 6179 6572 203a 2069 6e74  .    layer : int
+00000760: 2c20 6172 7261 792d 6c69 6b65 5b32 5d2c  , array-like[2],
+00000770: 206f 7220 7365 740a 2020 2020 2020 2020   or set.        
+00000780: 5370 6563 6966 6963 206c 6179 6572 2873  Specific layer(s
+00000790: 2920 746f 2070 7574 2070 6f6c 7967 6f6e  ) to put polygon
+000007a0: 2067 656f 6d65 7472 7920 6f6e 2e0a 0a20   geometry on... 
+000007b0: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
+000007c0: 2d2d 2d2d 2d2d 0a20 2020 2044 203a 2044  ------.    D : D
+000007d0: 6576 6963 650a 2020 2020 2020 2020 4120  evice.        A 
+000007e0: 4465 7669 6365 2063 6f6e 7461 696e 696e  Device containin
+000007f0: 6720 6120 7369 6e67 6c65 2072 6563 7461  g a single recta
+00000800: 6e67 6c65 2070 6f6c 7967 6f6e 2e0a 0a20  ngle polygon... 
+00000810: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
+00000820: 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e  --------.    >>>
+00000830: 2044 203d 2070 672e 6262 6f78 2861 6e6f   D = pg.bbox(ano
+00000840: 7468 6572 7368 6170 652e 6262 6f78 290a  thershape.bbox).
+00000850: 2020 2020 2222 220a 2020 2020 4420 3d20      """.    D = 
+00000860: 4465 7669 6365 286e 616d 653d 2262 626f  Device(name="bbo
+00000870: 7822 290a 2020 2020 2861 2c20 6229 2c20  x").    (a, b), 
+00000880: 2863 2c20 6429 203d 2062 626f 780a 2020  (c, d) = bbox.  
+00000890: 2020 706f 696e 7473 203d 2028 2861 2c20    points = ((a, 
+000008a0: 6229 2c20 2863 2c20 6229 2c20 2863 2c20  b), (c, b), (c, 
+000008b0: 6429 2c20 2861 2c20 6429 290a 2020 2020  d), (a, d)).    
+000008c0: 442e 6164 645f 706f 6c79 676f 6e28 706f  D.add_polygon(po
+000008d0: 696e 7473 2c20 6c61 7965 723d 6c61 7965  ints, layer=laye
+000008e0: 7229 0a20 2020 2072 6574 7572 6e20 440a  r).    return D.
+000008f0: 0a0a 6465 6620 6372 6f73 7328 6c65 6e67  ..def cross(leng
+00000900: 7468 3d31 302c 2077 6964 7468 3d33 2c20  th=10, width=3, 
+00000910: 6c61 7965 723d 3029 3a0a 2020 2020 2222  layer=0):.    ""
+00000920: 2247 656e 6572 6174 6573 2061 2072 6967  "Generates a rig
+00000930: 6874 2d61 6e67 6c65 2063 726f 7373 2028  ht-angle cross (
+00000940: 2b20 7368 6170 652c 2073 796d 6d65 7472  + shape, symmetr
+00000950: 6963 2920 6672 6f6d 2074 776f 0a20 2020  ic) from two.   
+00000960: 2072 6563 7461 6e67 6c65 7320 6f66 2073   rectangles of s
+00000970: 7065 6369 6669 6564 206c 656e 6774 6820  pecified length 
+00000980: 616e 6420 7769 6474 682e 0a0a 2020 2020  and width...    
+00000990: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+000009a0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6c65  ---------.    le
+000009b0: 6e67 7468 203a 2069 6e74 206f 7220 666c  ngth : int or fl
+000009c0: 6f61 740a 2020 2020 2020 2020 4c65 6e67  oat.        Leng
+000009d0: 7468 206f 6620 7468 6520 6372 6f73 7320  th of the cross 
+000009e0: 6672 6f6d 206f 6e65 2065 6e64 2074 6f20  from one end to 
+000009f0: 7468 6520 6f74 6865 722e 0a20 2020 2077  the other..    w
+00000a00: 6964 7468 203a 2069 6e74 206f 7220 666c  idth : int or fl
+00000a10: 6f61 740a 2020 2020 2020 2020 5769 6474  oat.        Widt
+00000a20: 6820 6f66 2074 6865 2061 726d 7320 6f66  h of the arms of
+00000a30: 2074 6865 2063 726f 7373 2e0a 2020 2020   the cross..    
+00000a40: 6c61 7965 7220 3a20 696e 742c 2061 7272  layer : int, arr
+00000a50: 6179 2d6c 696b 655b 325d 2c20 6f72 2073  ay-like[2], or s
+00000a60: 6574 0a20 2020 2020 2020 2053 7065 6369  et.        Speci
+00000a70: 6669 6320 6c61 7965 7228 7329 2074 6f20  fic layer(s) to 
+00000a80: 7075 7420 706f 6c79 676f 6e20 6765 6f6d  put polygon geom
+00000a90: 6574 7279 206f 6e2e 0a0a 2020 2020 5265  etry on...    Re
+00000aa0: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00000ab0: 2d0a 2020 2020 443a 2044 6576 6963 650a  -.    D: Device.
+00000ac0: 2020 2020 2020 2020 4120 4465 7669 6365          A Device
+00000ad0: 2063 6f6e 7461 696e 696e 6720 6120 6372   containing a cr
+00000ae0: 6f73 7320 706f 6c79 676f 6e2e 0a20 2020  oss polygon..   
+00000af0: 2022 2222 0a20 2020 2044 203d 2044 6576   """.    D = Dev
+00000b00: 6963 6528 6e61 6d65 3d22 6372 6f73 7322  ice(name="cross"
+00000b10: 290a 2020 2020 5220 3d20 7265 6374 616e  ).    R = rectan
+00000b20: 676c 6528 7369 7a65 3d28 7769 6474 682c  gle(size=(width,
+00000b30: 206c 656e 6774 6829 2c20 6c61 7965 723d   length), layer=
+00000b40: 6c61 7965 7229 0a20 2020 2072 3120 3d20  layer).    r1 = 
+00000b50: 442e 6164 645f 7265 6628 5229 2e72 6f74  D.add_ref(R).rot
+00000b60: 6174 6528 3930 290a 2020 2020 7232 203d  ate(90).    r2 =
+00000b70: 2044 2e61 6464 5f72 6566 2852 290a 2020   D.add_ref(R).  
+00000b80: 2020 7231 2e63 656e 7465 7220 3d20 2830    r1.center = (0
+00000b90: 2c20 3029 0a20 2020 2072 322e 6365 6e74  , 0).    r2.cent
+00000ba0: 6572 203d 2028 302c 2030 290a 2020 2020  er = (0, 0).    
+00000bb0: 7265 7475 726e 2044 0a0a 0a64 6566 2065  return D...def e
+00000bc0: 6c6c 6970 7365 2872 6164 6969 3d28 3130  llipse(radii=(10
+00000bd0: 2c20 3529 2c20 616e 676c 655f 7265 736f  , 5), angle_reso
+00000be0: 6c75 7469 6f6e 3d32 2e35 2c20 6c61 7965  lution=2.5, laye
+00000bf0: 723d 3029 3a0a 2020 2020 2222 2247 656e  r=0):.    """Gen
+00000c00: 6572 6174 6573 2061 6e20 656c 6c69 7073  erates an ellips
+00000c10: 6520 6765 6f6d 6574 7279 2e0a 0a20 2020  e geometry...   
+00000c20: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00000c30: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2072  ----------.    r
+00000c40: 6164 6969 203a 2074 7570 6c65 206f 6620  adii : tuple of 
+00000c50: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
+00000c60: 2020 2020 2053 656d 696d 616a 6f72 2028       Semimajor (
+00000c70: 7829 2061 6e64 2073 656d 696d 696e 6f72  x) and semiminor
+00000c80: 2028 7929 2061 7869 7320 6c65 6e67 7468   (y) axis length
+00000c90: 7320 6f66 2074 6865 2065 6c6c 6970 7365  s of the ellipse
+00000ca0: 2e0a 2020 2020 616e 676c 655f 7265 736f  ..    angle_reso
+00000cb0: 6c75 7469 6f6e 203a 2069 6e74 206f 7220  lution : int or 
+00000cc0: 666c 6f61 740a 2020 2020 2020 2020 5265  float.        Re
+00000cd0: 736f 6c75 7469 6f6e 206f 6620 7468 6520  solution of the 
+00000ce0: 6375 7276 6520 6f66 2074 6865 2072 696e  curve of the rin
+00000cf0: 6720 2823 206f 6620 6465 6772 6565 7320  g (# of degrees 
+00000d00: 7065 7220 706f 696e 7429 2e0a 2020 2020  per point)..    
+00000d10: 6c61 7965 7220 3a20 696e 742c 2061 7272  layer : int, arr
+00000d20: 6179 2d6c 696b 655b 325d 2c20 6f72 2073  ay-like[2], or s
+00000d30: 6574 0a20 2020 2020 2020 2053 7065 6369  et.        Speci
+00000d40: 6669 6320 6c61 7965 7228 7329 2074 6f20  fic layer(s) to 
+00000d50: 7075 7420 706f 6c79 676f 6e20 6765 6f6d  put polygon geom
+00000d60: 6574 7279 206f 6e2e 0a0a 2020 2020 5265  etry on...    Re
+00000d70: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00000d80: 2d0a 2020 2020 4420 3a20 4465 7669 6365  -.    D : Device
+00000d90: 0a20 2020 2020 2020 2041 2044 6576 6963  .        A Devic
+00000da0: 6520 636f 6e74 6169 6e69 6e67 2061 6e20  e containing an 
+00000db0: 656c 6c69 7073 6520 706f 6c79 676f 6e2e  ellipse polygon.
+00000dc0: 0a20 2020 2022 2222 0a20 2020 2044 203d  .    """.    D =
+00000dd0: 2044 6576 6963 6528 6e61 6d65 3d22 656c   Device(name="el
+00000de0: 6c69 7073 6522 290a 2020 2020 6120 3d20  lipse").    a = 
+00000df0: 7261 6469 695b 305d 0a20 2020 2062 203d  radii[0].    b =
+00000e00: 2072 6164 6969 5b31 5d0a 2020 2020 7420   radii[1].    t 
+00000e10: 3d20 6e70 2e6c 696e 7370 6163 6528 302c  = np.linspace(0,
+00000e20: 2033 3630 2c20 696e 7428 6e70 2e63 6569   360, int(np.cei
+00000e30: 6c28 3336 3020 2f20 616e 676c 655f 7265  l(360 / angle_re
+00000e40: 736f 6c75 7469 6f6e 2920 2b20 3129 2920  solution) + 1)) 
+00000e50: 2a20 7069 202f 2031 3830 0a20 2020 2072  * pi / 180.    r
+00000e60: 203d 2061 202a 2062 202f 2028 7371 7274   = a * b / (sqrt
+00000e70: 2828 6220 2a20 636f 7328 7429 2920 2a2a  ((b * cos(t)) **
+00000e80: 2032 202b 2028 6120 2a20 7369 6e28 7429   2 + (a * sin(t)
+00000e90: 2920 2a2a 2032 2929 0a20 2020 2078 7074  ) ** 2)).    xpt
+00000ea0: 7320 3d20 7220 2a20 636f 7328 7429 0a20  s = r * cos(t). 
+00000eb0: 2020 2079 7074 7320 3d20 7220 2a20 7369     ypts = r * si
+00000ec0: 6e28 7429 0a20 2020 2044 2e61 6464 5f70  n(t).    D.add_p
+00000ed0: 6f6c 7967 6f6e 2870 6f69 6e74 733d 2878  olygon(points=(x
+00000ee0: 7074 732c 2079 7074 7329 2c20 6c61 7965  pts, ypts), laye
+00000ef0: 723d 6c61 7965 7229 0a20 2020 2072 6574  r=layer).    ret
+00000f00: 7572 6e20 440a 0a0a 6465 6620 6369 7263  urn D...def circ
+00000f10: 6c65 2872 6164 6975 733d 3130 2c20 616e  le(radius=10, an
+00000f20: 676c 655f 7265 736f 6c75 7469 6f6e 3d32  gle_resolution=2
+00000f30: 2e35 2c20 6c61 7965 723d 3029 3a0a 2020  .5, layer=0):.  
+00000f40: 2020 2222 2247 656e 6572 6174 6573 2061    """Generates a
+00000f50: 2063 6972 636c 6520 6765 6f6d 6574 7279   circle geometry
+00000f60: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
+00000f70: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+00000f80: 0a20 2020 2072 6164 6975 7320 3a20 696e  .    radius : in
+00000f90: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
+00000fa0: 2020 2052 6164 6975 7320 6f66 2074 6865     Radius of the
+00000fb0: 2063 6972 636c 652e 0a20 2020 2061 6e67   circle..    ang
+00000fc0: 6c65 5f72 6573 6f6c 7574 696f 6e20 3a20  le_resolution : 
+00000fd0: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
+00000fe0: 2020 2020 2052 6573 6f6c 7574 696f 6e20       Resolution 
+00000ff0: 6f66 2074 6865 2063 7572 7665 206f 6620  of the curve of 
+00001000: 7468 6520 7269 6e67 2028 2320 6f66 2064  the ring (# of d
+00001010: 6567 7265 6573 2070 6572 2070 6f69 6e74  egrees per point
+00001020: 292e 0a20 2020 206c 6179 6572 203a 2069  )..    layer : i
+00001030: 6e74 2c20 6172 7261 792d 6c69 6b65 5b32  nt, array-like[2
+00001040: 5d2c 206f 7220 7365 740a 2020 2020 2020  ], or set.      
+00001050: 2020 5370 6563 6966 6963 206c 6179 6572    Specific layer
+00001060: 2873 2920 746f 2070 7574 2070 6f6c 7967  (s) to put polyg
+00001070: 6f6e 2067 656f 6d65 7472 7920 6f6e 2e0a  on geometry on..
+00001080: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
+00001090: 202d 2d2d 2d2d 2d2d 0a20 2020 2044 203a   -------.    D :
+000010a0: 2044 6576 6963 650a 2020 2020 2020 2020   Device.        
+000010b0: 4120 4465 7669 6365 2063 6f6e 7461 696e  A Device contain
+000010c0: 696e 6720 6120 6369 7263 6c65 2070 6f6c  ing a circle pol
+000010d0: 7967 6f6e 2e0a 2020 2020 2222 220a 2020  ygon..    """.  
+000010e0: 2020 4420 3d20 4465 7669 6365 286e 616d    D = Device(nam
+000010f0: 653d 2263 6972 636c 6522 290a 2020 2020  e="circle").    
+00001100: 7420 3d20 6e70 2e6c 696e 7370 6163 6528  t = np.linspace(
+00001110: 302c 2033 3630 2c20 696e 7428 6e70 2e63  0, 360, int(np.c
+00001120: 6569 6c28 3336 3020 2f20 616e 676c 655f  eil(360 / angle_
+00001130: 7265 736f 6c75 7469 6f6e 2920 2b20 3129  resolution) + 1)
+00001140: 2920 2a20 7069 202f 2031 3830 0a20 2020  ) * pi / 180.   
+00001150: 2078 7074 7320 3d20 2872 6164 6975 7320   xpts = (radius 
+00001160: 2a20 636f 7328 7429 292e 746f 6c69 7374  * cos(t)).tolist
+00001170: 2829 0a20 2020 2079 7074 7320 3d20 2872  ().    ypts = (r
+00001180: 6164 6975 7320 2a20 7369 6e28 7429 292e  adius * sin(t)).
+00001190: 746f 6c69 7374 2829 0a20 2020 2044 2e61  tolist().    D.a
+000011a0: 6464 5f70 6f6c 7967 6f6e 2870 6f69 6e74  dd_polygon(point
+000011b0: 733d 2878 7074 732c 2079 7074 7329 2c20  s=(xpts, ypts), 
+000011c0: 6c61 7965 723d 6c61 7965 7229 0a20 2020  layer=layer).   
+000011d0: 2072 6574 7572 6e20 440a 0a0a 6465 6620   return D...def 
+000011e0: 7269 6e67 2872 6164 6975 733d 3130 2c20  ring(radius=10, 
+000011f0: 7769 6474 683d 302e 352c 2061 6e67 6c65  width=0.5, angle
+00001200: 5f72 6573 6f6c 7574 696f 6e3d 322e 352c  _resolution=2.5,
+00001210: 206c 6179 6572 3d30 293a 0a20 2020 2022   layer=0):.    "
+00001220: 2222 4765 6e65 7261 7465 7320 6120 7269  ""Generates a ri
+00001230: 6e67 2067 656f 6d65 7472 792e 0a0a 2020  ng geometry...  
+00001240: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00001250: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00001260: 7261 6469 7573 203a 2069 6e74 206f 7220  radius : int or 
+00001270: 666c 6f61 740a 2020 2020 2020 2020 5261  float.        Ra
+00001280: 6469 7573 206f 6620 7468 6520 7269 6e67  dius of the ring
+00001290: 2063 656e 7465 726c 696e 650a 2020 2020   centerline.    
+000012a0: 7769 6474 6820 3a20 696e 7420 6f72 2066  width : int or f
+000012b0: 6c6f 6174 0a20 2020 2020 2020 2057 6964  loat.        Wid
+000012c0: 7468 206f 6620 7468 6520 7269 6e67 2e0a  th of the ring..
+000012d0: 2020 2020 616e 676c 655f 7265 736f 6c75      angle_resolu
+000012e0: 7469 6f6e 203a 2069 6e74 206f 7220 666c  tion : int or fl
+000012f0: 6f61 740a 2020 2020 2020 2020 5265 736f  oat.        Reso
+00001300: 6c75 7469 6f6e 206f 6620 7468 6520 6375  lution of the cu
+00001310: 7276 6520 6f66 2074 6865 2072 696e 6720  rve of the ring 
+00001320: 2823 206f 6620 6465 6772 6565 7320 7065  (# of degrees pe
+00001330: 7220 706f 696e 7429 2e0a 2020 2020 6c61  r point)..    la
+00001340: 7965 7220 3a0a 2020 2020 2020 2020 5370  yer :.        Sp
+00001350: 6563 6966 6963 206c 6179 6572 2873 2920  ecific layer(s) 
+00001360: 746f 2070 7574 2070 6f6c 7967 6f6e 2067  to put polygon g
+00001370: 656f 6d65 7472 7920 6f6e 2e0a 0a20 2020  eometry on...   
+00001380: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
+00001390: 2d2d 2d2d 0a20 2020 2044 203a 2044 6576  ----.    D : Dev
+000013a0: 6963 650a 2020 2020 2020 2020 4120 4465  ice.        A De
+000013b0: 7669 6365 2063 6f6e 7461 696e 696e 6720  vice containing 
+000013c0: 6120 7269 6e67 2070 6f6c 7967 6f6e 2e0a  a ring polygon..
+000013d0: 0a20 2020 204e 6f74 6573 0a20 2020 202d  .    Notes.    -
+000013e0: 2d2d 2d2d 0a20 2020 2054 6865 2072 696e  ----.    The rin
+000013f0: 6720 6973 2066 6f72 6d65 6420 6279 2074  g is formed by t
+00001400: 616b 696e 6720 7468 6520 7261 6469 7573  aking the radius
+00001410: 206f 7574 2074 6f20 7468 6520 7370 6563   out to the spec
+00001420: 6966 6965 6420 7661 6c75 652c 2061 6e64  ified value, and
+00001430: 0a20 2020 2074 6865 6e20 636f 6e73 7472  .    then constr
+00001440: 7563 7469 6e67 2074 6865 2074 6869 636b  ucting the thick
+00001450: 6e65 7373 2062 7920 6469 7669 6469 6e67  ness by dividing
+00001460: 2074 6865 2077 6964 7468 2069 6e20 6861   the width in ha
+00001470: 6c66 2061 6e64 2061 6464 696e 670a 2020  lf and adding.  
+00001480: 2020 7468 6174 2076 616c 7565 2074 6f20    that value to 
+00001490: 6569 7468 6572 2073 6964 6520 6f66 2074  either side of t
+000014a0: 6865 2072 6164 6975 732e 0a0a 2020 2020  he radius...    
+000014b0: 5468 6520 616e 676c 655f 7265 736f 6c75  The angle_resolu
+000014c0: 7469 6f6e 2061 6c74 6572 7320 7468 6520  tion alters the 
+000014d0: 7072 6563 6973 696f 6e20 6f66 2074 6865  precision of the
+000014e0: 2063 7572 7665 206f 6620 7468 6520 7269   curve of the ri
+000014f0: 6e67 2e20 4c61 7267 6572 0a20 2020 2076  ng. Larger.    v
+00001500: 616c 7565 7320 7969 656c 6420 6c6f 7765  alues yield lowe
+00001510: 7220 7265 736f 6c75 7469 6f6e 2e0a 2020  r resolution..  
+00001520: 2020 2222 220a 2020 2020 4420 3d20 4465    """.    D = De
+00001530: 7669 6365 286e 616d 653d 2272 696e 6722  vice(name="ring"
+00001540: 290a 2020 2020 696e 6e65 725f 7261 6469  ).    inner_radi
+00001550: 7573 203d 2072 6164 6975 7320 2d20 7769  us = radius - wi
+00001560: 6474 6820 2f20 320a 2020 2020 6f75 7465  dth / 2.    oute
+00001570: 725f 7261 6469 7573 203d 2072 6164 6975  r_radius = radiu
+00001580: 7320 2b20 7769 6474 6820 2f20 320a 2020  s + width / 2.  
+00001590: 2020 6e20 3d20 696e 7428 6e70 2e72 6f75    n = int(np.rou
+000015a0: 6e64 2833 3630 202f 2061 6e67 6c65 5f72  nd(360 / angle_r
+000015b0: 6573 6f6c 7574 696f 6e29 290a 2020 2020  esolution)).    
+000015c0: 7420 3d20 6e70 2e6c 696e 7370 6163 6528  t = np.linspace(
+000015d0: 302c 2033 3630 2c20 6e20 2b20 3129 202a  0, 360, n + 1) *
+000015e0: 2070 6920 2f20 3138 300a 2020 2020 696e   pi / 180.    in
+000015f0: 6e65 725f 706f 696e 7473 5f78 203d 2028  ner_points_x = (
+00001600: 696e 6e65 725f 7261 6469 7573 202a 2063  inner_radius * c
+00001610: 6f73 2874 2929 2e74 6f6c 6973 7428 290a  os(t)).tolist().
+00001620: 2020 2020 696e 6e65 725f 706f 696e 7473      inner_points
+00001630: 5f79 203d 2028 696e 6e65 725f 7261 6469  _y = (inner_radi
+00001640: 7573 202a 2073 696e 2874 2929 2e74 6f6c  us * sin(t)).tol
+00001650: 6973 7428 290a 2020 2020 6f75 7465 725f  ist().    outer_
+00001660: 706f 696e 7473 5f78 203d 2028 6f75 7465  points_x = (oute
+00001670: 725f 7261 6469 7573 202a 2063 6f73 2874  r_radius * cos(t
+00001680: 2929 2e74 6f6c 6973 7428 290a 2020 2020  )).tolist().    
+00001690: 6f75 7465 725f 706f 696e 7473 5f79 203d  outer_points_y =
+000016a0: 2028 6f75 7465 725f 7261 6469 7573 202a   (outer_radius *
+000016b0: 2073 696e 2874 2929 2e74 6f6c 6973 7428   sin(t)).tolist(
+000016c0: 290a 2020 2020 7870 7473 203d 2069 6e6e  ).    xpts = inn
+000016d0: 6572 5f70 6f69 6e74 735f 7820 2b20 6f75  er_points_x + ou
+000016e0: 7465 725f 706f 696e 7473 5f78 5b3a 3a2d  ter_points_x[::-
+000016f0: 315d 0a20 2020 2079 7074 7320 3d20 696e  1].    ypts = in
+00001700: 6e65 725f 706f 696e 7473 5f79 202b 206f  ner_points_y + o
+00001710: 7574 6572 5f70 6f69 6e74 735f 795b 3a3a  uter_points_y[::
+00001720: 2d31 5d0a 2020 2020 442e 6164 645f 706f  -1].    D.add_po
+00001730: 6c79 676f 6e28 706f 696e 7473 3d28 7870  lygon(points=(xp
+00001740: 7473 2c20 7970 7473 292c 206c 6179 6572  ts, ypts), layer
+00001750: 3d6c 6179 6572 290a 2020 2020 7265 7475  =layer).    retu
+00001760: 726e 2044 0a0a 0a64 6566 2061 7263 2872  rn D...def arc(r
+00001770: 6164 6975 733d 3130 2c20 7769 6474 683d  adius=10, width=
+00001780: 302e 352c 2074 6865 7461 3d34 352c 2073  0.5, theta=45, s
+00001790: 7461 7274 5f61 6e67 6c65 3d30 2c20 616e  tart_angle=0, an
+000017a0: 676c 655f 7265 736f 6c75 7469 6f6e 3d32  gle_resolution=2
+000017b0: 2e35 2c20 6c61 7965 723d 3029 3a0a 2020  .5, layer=0):.  
+000017c0: 2020 2222 2243 7265 6174 6573 2061 6e20    """Creates an 
+000017d0: 6172 6320 6f66 2061 7263 6c65 6e67 7468  arc of arclength
+000017e0: 2060 6074 6865 7461 6060 2073 7461 7274   ``theta`` start
+000017f0: 696e 6720 6174 2061 6e67 6c65 0a20 2020  ing at angle.   
+00001800: 2060 6073 7461 7274 5f61 6e67 6c65 6060   ``start_angle``
+00001810: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
+00001820: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+00001830: 0a20 2020 2072 6164 6975 7320 3a20 696e  .    radius : in
+00001840: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
+00001850: 2020 2052 6164 6975 7320 6f66 2074 6865     Radius of the
+00001860: 2061 7263 2063 656e 7465 726c 696e 652e   arc centerline.
+00001870: 0a20 2020 2077 6964 7468 203a 2069 6e74  .    width : int
+00001880: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
+00001890: 2020 5769 6474 6820 6f66 2074 6865 2061    Width of the a
+000018a0: 7263 2e0a 2020 2020 7468 6574 6120 3a20  rc..    theta : 
+000018b0: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
+000018c0: 2020 2020 2054 6f74 616c 2061 6e67 6c65       Total angle
+000018d0: 2063 6f76 6572 6167 6520 6f66 2074 6865   coverage of the
+000018e0: 2061 7263 2e0a 2020 2020 7374 6172 745f   arc..    start_
+000018f0: 616e 676c 6520 3a20 696e 7420 6f72 2066  angle : int or f
+00001900: 6c6f 6174 0a20 2020 2020 2020 2053 7461  loat.        Sta
+00001910: 7274 696e 6720 616e 676c 652e 0a20 2020  rting angle..   
+00001920: 2061 6e67 6c65 5f72 6573 6f6c 7574 696f   angle_resolutio
+00001930: 6e20 3a20 696e 7420 6f72 2066 6c6f 6174  n : int or float
+00001940: 0a20 2020 2020 2020 2052 6573 6f6c 7574  .        Resolut
+00001950: 696f 6e20 6f66 2074 6865 2063 7572 7665  ion of the curve
+00001960: 206f 6620 7468 6520 6172 632e 0a20 2020   of the arc..   
+00001970: 206c 6179 6572 203a 2069 6e74 2c20 6172   layer : int, ar
+00001980: 7261 792d 6c69 6b65 5b32 5d2c 206f 7220  ray-like[2], or 
+00001990: 7365 740a 2020 2020 2020 2020 5370 6563  set.        Spec
+000019a0: 6966 6963 206c 6179 6572 2873 2920 746f  ific layer(s) to
+000019b0: 2070 7574 2070 6f6c 7967 6f6e 2067 656f   put polygon geo
+000019c0: 6d65 7472 7920 6f6e 2e0a 0a20 2020 2052  metry on...    R
+000019d0: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
+000019e0: 2d2d 0a20 2020 2044 203a 2044 6576 6963  --.    D : Devic
+000019f0: 650a 2020 2020 2020 2020 4120 4465 7669  e.        A Devi
+00001a00: 6365 2063 6f6e 7461 696e 696e 6720 616e  ce containing an
+00001a10: 2061 7263 2070 6f6c 7967 6f6e 2061 6e64   arc polygon and
+00001a20: 2074 776f 2070 6f72 7473 2028 6031 6020   two ports (`1` 
+00001a30: 616e 6420 6032 6029 206f 6e0a 2020 2020  and `2`) on.    
+00001a40: 2020 2020 6569 7468 6572 2065 6e64 2e0a      either end..
+00001a50: 0a20 2020 204e 6f74 6573 0a20 2020 202d  .    Notes.    -
+00001a60: 2d2d 2d2d 0a20 2020 2054 6865 7461 203d  ----.    Theta =
+00001a70: 2030 2069 7320 6c6f 6361 7465 6420 616c   0 is located al
+00001a80: 6f6e 6720 7468 6520 706f 7369 7469 7665  ong the positive
+00001a90: 2078 2d61 7869 7320 7265 6c61 7469 7665   x-axis relative
+00001aa0: 2074 6f20 7468 6520 6365 6e74 6572 206f   to the center o
+00001ab0: 660a 2020 2020 7468 6520 6172 632e 0a0a  f.    the arc...
+00001ac0: 2020 2020 506f 7274 7320 6172 6520 6164      Ports are ad
+00001ad0: 6465 6420 746f 2065 6163 6820 656e 6420  ded to each end 
+00001ae0: 6f66 2074 6865 2061 7263 2074 6f20 6661  of the arc to fa
+00001af0: 6369 6c69 7461 7465 2063 6f6e 6e65 6374  cilitate connect
+00001b00: 696e 6720 7468 6f73 6520 656e 6473 0a20  ing those ends. 
+00001b10: 2020 2074 6f20 6f74 6865 7220 6765 6f6d     to other geom
+00001b20: 6574 7269 6573 2e0a 2020 2020 2222 220a  etries..    """.
+00001b30: 2020 2020 696e 6e65 725f 7261 6469 7573      inner_radius
+00001b40: 203d 2072 6164 6975 7320 2d20 7769 6474   = radius - widt
+00001b50: 6820 2f20 320a 2020 2020 6f75 7465 725f  h / 2.    outer_
+00001b60: 7261 6469 7573 203d 2072 6164 6975 7320  radius = radius 
+00001b70: 2b20 7769 6474 6820 2f20 320a 2020 2020  + width / 2.    
+00001b80: 616e 676c 6531 203d 2028 7374 6172 745f  angle1 = (start_
+00001b90: 616e 676c 6529 202a 2070 6920 2f20 3138  angle) * pi / 18
+00001ba0: 300a 2020 2020 616e 676c 6532 203d 2028  0.    angle2 = (
+00001bb0: 7374 6172 745f 616e 676c 6520 2b20 7468  start_angle + th
+00001bc0: 6574 6129 202a 2070 6920 2f20 3138 300a  eta) * pi / 180.
+00001bd0: 2020 2020 7420 3d20 6e70 2e6c 696e 7370      t = np.linsp
+00001be0: 6163 6528 616e 676c 6531 2c20 616e 676c  ace(angle1, angl
+00001bf0: 6532 2c20 696e 7428 6e70 2e63 6569 6c28  e2, int(np.ceil(
+00001c00: 6162 7328 7468 6574 6129 202f 2061 6e67  abs(theta) / ang
+00001c10: 6c65 5f72 6573 6f6c 7574 696f 6e29 2929  le_resolution)))
+00001c20: 0a20 2020 2069 6e6e 6572 5f70 6f69 6e74  .    inner_point
+00001c30: 735f 7820 3d20 2869 6e6e 6572 5f72 6164  s_x = (inner_rad
+00001c40: 6975 7320 2a20 636f 7328 7429 292e 746f  ius * cos(t)).to
+00001c50: 6c69 7374 2829 0a20 2020 2069 6e6e 6572  list().    inner
+00001c60: 5f70 6f69 6e74 735f 7920 3d20 2869 6e6e  _points_y = (inn
+00001c70: 6572 5f72 6164 6975 7320 2a20 7369 6e28  er_radius * sin(
+00001c80: 7429 292e 746f 6c69 7374 2829 0a20 2020  t)).tolist().   
+00001c90: 206f 7574 6572 5f70 6f69 6e74 735f 7820   outer_points_x 
+00001ca0: 3d20 286f 7574 6572 5f72 6164 6975 7320  = (outer_radius 
+00001cb0: 2a20 636f 7328 7429 292e 746f 6c69 7374  * cos(t)).tolist
+00001cc0: 2829 0a20 2020 206f 7574 6572 5f70 6f69  ().    outer_poi
+00001cd0: 6e74 735f 7920 3d20 286f 7574 6572 5f72  nts_y = (outer_r
+00001ce0: 6164 6975 7320 2a20 7369 6e28 7429 292e  adius * sin(t)).
+00001cf0: 746f 6c69 7374 2829 0a20 2020 2078 7074  tolist().    xpt
+00001d00: 7320 3d20 696e 6e65 725f 706f 696e 7473  s = inner_points
+00001d10: 5f78 202b 206f 7574 6572 5f70 6f69 6e74  _x + outer_point
+00001d20: 735f 785b 3a3a 2d31 5d0a 2020 2020 7970  s_x[::-1].    yp
+00001d30: 7473 203d 2069 6e6e 6572 5f70 6f69 6e74  ts = inner_point
+00001d40: 735f 7920 2b20 6f75 7465 725f 706f 696e  s_y + outer_poin
+00001d50: 7473 5f79 5b3a 3a2d 315d 0a0a 2020 2020  ts_y[::-1]..    
+00001d60: 4420 3d20 4465 7669 6365 2822 6172 6322  D = Device("arc"
+00001d70: 290a 2020 2020 442e 6164 645f 706f 6c79  ).    D.add_poly
+00001d80: 676f 6e28 706f 696e 7473 3d28 7870 7473  gon(points=(xpts
+00001d90: 2c20 7970 7473 292c 206c 6179 6572 3d6c  , ypts), layer=l
+00001da0: 6179 6572 290a 2020 2020 442e 6164 645f  ayer).    D.add_
+00001db0: 706f 7274 280a 2020 2020 2020 2020 6e61  port(.        na
+00001dc0: 6d65 3d31 2c0a 2020 2020 2020 2020 6d69  me=1,.        mi
+00001dd0: 6470 6f69 6e74 3d28 7261 6469 7573 202a  dpoint=(radius *
+00001de0: 2063 6f73 2861 6e67 6c65 3129 2c20 7261   cos(angle1), ra
+00001df0: 6469 7573 202a 2073 696e 2861 6e67 6c65  dius * sin(angle
+00001e00: 3129 292c 0a20 2020 2020 2020 2077 6964  1)),.        wid
+00001e10: 7468 3d77 6964 7468 2c0a 2020 2020 2020  th=width,.      
+00001e20: 2020 6f72 6965 6e74 6174 696f 6e3d 7374    orientation=st
+00001e30: 6172 745f 616e 676c 6520 2d20 3930 202b  art_angle - 90 +
+00001e40: 2031 3830 202a 2028 7468 6574 6120 3c20   180 * (theta < 
+00001e50: 3029 2c0a 2020 2020 290a 2020 2020 442e  0),.    ).    D.
+00001e60: 6164 645f 706f 7274 280a 2020 2020 2020  add_port(.      
+00001e70: 2020 6e61 6d65 3d32 2c0a 2020 2020 2020    name=2,.      
+00001e80: 2020 6d69 6470 6f69 6e74 3d28 7261 6469    midpoint=(radi
+00001e90: 7573 202a 2063 6f73 2861 6e67 6c65 3229  us * cos(angle2)
+00001ea0: 2c20 7261 6469 7573 202a 2073 696e 2861  , radius * sin(a
+00001eb0: 6e67 6c65 3229 292c 0a20 2020 2020 2020  ngle2)),.       
+00001ec0: 2077 6964 7468 3d77 6964 7468 2c0a 2020   width=width,.  
+00001ed0: 2020 2020 2020 6f72 6965 6e74 6174 696f        orientatio
+00001ee0: 6e3d 7374 6172 745f 616e 676c 6520 2b20  n=start_angle + 
+00001ef0: 7468 6574 6120 2b20 3930 202d 2031 3830  theta + 90 - 180
+00001f00: 202a 2028 7468 6574 6120 3c20 3029 2c0a   * (theta < 0),.
+00001f10: 2020 2020 290a 2020 2020 442e 696e 666f      ).    D.info
+00001f20: 5b22 6c65 6e67 7468 225d 203d 2028 6162  ["length"] = (ab
+00001f30: 7328 7468 6574 6129 202a 2070 6920 2f20  s(theta) * pi / 
+00001f40: 3138 3029 202a 2072 6164 6975 730a 2020  180) * radius.  
+00001f50: 2020 7265 7475 726e 2044 0a0a 0a64 6566    return D...def
+00001f60: 2074 7572 6e28 706f 7274 2c20 7261 6469   turn(port, radi
+00001f70: 7573 3d31 302c 2061 6e67 6c65 3d32 3730  us=10, angle=270
+00001f80: 2c20 616e 676c 655f 7265 736f 6c75 7469  , angle_resoluti
+00001f90: 6f6e 3d32 2e35 2c20 6c61 7965 723d 3029  on=2.5, layer=0)
+00001fa0: 3a0a 2020 2020 2222 2253 7461 7274 696e  :.    """Startin
+00001fb0: 6720 6672 6f6d 2061 2070 6f72 742c 2063  g from a port, c
+00001fc0: 7265 6174 6573 2061 6e20 6172 6320 7768  reates an arc wh
+00001fd0: 6963 6820 636f 6e6e 6563 7473 2074 6f20  ich connects to 
+00001fe0: 7468 6520 7370 6563 6966 6965 640a 2020  the specified.  
+00001ff0: 2020 706f 7274 206f 6e20 6f6e 6520 656e    port on one en
+00002000: 642e 0a0a 2020 2020 5061 7261 6d65 7465  d...    Paramete
+00002010: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+00002020: 2d0a 2020 2020 706f 7274 203a 2050 6f72  -.    port : Por
+00002030: 740a 2020 2020 2020 2020 506f 7274 2074  t.        Port t
+00002040: 6f20 616e 6368 6f72 2061 7263 2074 6f2e  o anchor arc to.
+00002050: 0a20 2020 2072 6164 6975 7320 3a20 696e  .    radius : in
+00002060: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
+00002070: 2020 2052 6164 6975 7320 6f66 2074 6865     Radius of the
+00002080: 2061 7263 2063 656e 7465 726c 696e 652e   arc centerline.
+00002090: 0a20 2020 2061 6e67 6c65 203a 2069 6e74  .    angle : int
+000020a0: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
+000020b0: 2020 546f 7461 6c20 616e 676c 6520 636f    Total angle co
+000020c0: 7665 7261 6765 206f 6620 7468 6520 6172  verage of the ar
+000020d0: 632e 0a20 2020 2061 6e67 6c65 5f72 6573  c..    angle_res
+000020e0: 6f6c 7574 696f 6e20 3a20 696e 7420 6f72  olution : int or
+000020f0: 2066 6c6f 6174 0a20 2020 2020 2020 2052   float.        R
+00002100: 6573 6f6c 7574 696f 6e20 6f66 2074 6865  esolution of the
+00002110: 2063 7572 7665 206f 6620 7468 6520 6172   curve of the ar
+00002120: 632e 0a20 2020 206c 6179 6572 203a 2069  c..    layer : i
+00002130: 6e74 2c20 6172 7261 792d 6c69 6b65 5b32  nt, array-like[2
+00002140: 5d2c 206f 7220 7365 740a 2020 2020 2020  ], or set.      
+00002150: 2020 5370 6563 6966 6963 206c 6179 6572    Specific layer
+00002160: 2873 2920 746f 2070 7574 2074 6865 2070  (s) to put the p
+00002170: 6f6c 7967 6f6e 2067 656f 6d65 7472 7920  olygon geometry 
+00002180: 6f6e 2e0a 0a20 2020 2052 6574 7572 6e73  on...    Returns
+00002190: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
+000021a0: 2044 203a 2044 6576 6963 650a 2020 2020   D : Device.    
+000021b0: 2020 2020 4120 4465 7669 6365 2063 6f6e      A Device con
+000021c0: 7461 696e 696e 6720 616e 2061 7263 2070  taining an arc p
+000021d0: 6f6c 7967 6f6e 2061 6e64 2074 776f 2070  olygon and two p
+000021e0: 6f72 7473 2028 6031 6020 616e 6420 6032  orts (`1` and `2
+000021f0: 6029 206f 6e0a 2020 2020 2020 2020 6569  `) on.        ei
+00002200: 7468 6572 2065 6e64 2e0a 0a20 2020 204e  ther end...    N
+00002210: 6f74 6573 0a20 2020 202d 2d2d 2d2d 0a20  otes.    -----. 
+00002220: 2020 2041 6e67 6c65 203d 2030 2069 7320     Angle = 0 is 
+00002230: 6c6f 6361 7465 6420 616c 6f6e 6720 7468  located along th
+00002240: 6520 706f 7369 7469 7665 2078 2d61 7869  e positive x-axi
+00002250: 7320 7265 6c61 7469 7665 2074 6f20 7468  s relative to th
+00002260: 6520 6365 6e74 6572 206f 660a 2020 2020  e center of.    
+00002270: 7468 6520 6172 632e 0a20 2020 2050 6f72  the arc..    Por
+00002280: 7473 2061 7265 2061 6464 6564 2074 6f20  ts are added to 
+00002290: 6561 6368 2065 6e64 206f 6620 7468 6520  each end of the 
+000022a0: 6172 6320 746f 2066 6163 696c 6974 6174  arc to facilitat
+000022b0: 6520 636f 6e6e 6563 7469 6e67 2074 686f  e connecting tho
+000022c0: 7365 2065 6e64 730a 2020 2020 746f 206f  se ends.    to o
+000022d0: 7468 6572 2067 656f 6d65 7472 6965 732e  ther geometries.
+000022e0: 0a20 2020 2050 6f72 7420 6032 6020 6973  .    Port `2` is
+000022f0: 2061 6c69 676e 6564 2074 6f20 636f 6e6e   aligned to conn
+00002300: 6563 7420 746f 2074 6865 2073 7065 6369  ect to the speci
+00002310: 6669 6564 2070 6f72 742e 0a20 2020 2022  fied port..    "
+00002320: 2222 0a20 2020 2044 203d 2061 7263 280a  "".    D = arc(.
+00002330: 2020 2020 2020 2020 7261 6469 7573 3d72          radius=r
+00002340: 6164 6975 732c 0a20 2020 2020 2020 2077  adius,.        w
+00002350: 6964 7468 3d70 6f72 742e 7769 6474 682c  idth=port.width,
+00002360: 0a20 2020 2020 2020 2074 6865 7461 3d61  .        theta=a
+00002370: 6e67 6c65 2c0a 2020 2020 2020 2020 7374  ngle,.        st
+00002380: 6172 745f 616e 676c 653d 302c 0a20 2020  art_angle=0,.   
+00002390: 2020 2020 2061 6e67 6c65 5f72 6573 6f6c       angle_resol
+000023a0: 7574 696f 6e3d 616e 676c 655f 7265 736f  ution=angle_reso
+000023b0: 6c75 7469 6f6e 2c0a 2020 2020 2020 2020  lution,.        
+000023c0: 6c61 7965 723d 6c61 7965 722c 0a20 2020  layer=layer,.   
+000023d0: 2029 0a20 2020 2044 2e72 6f74 6174 6528   ).    D.rotate(
+000023e0: 0a20 2020 2020 2020 2061 6e67 6c65 3d31  .        angle=1
+000023f0: 3830 202b 2070 6f72 742e 6f72 6965 6e74  80 + port.orient
+00002400: 6174 696f 6e20 2d20 442e 706f 7274 735b  ation - D.ports[
+00002410: 315d 2e6f 7269 656e 7461 7469 6f6e 2c0a  1].orientation,.
+00002420: 2020 2020 2020 2020 6365 6e74 6572 3d44          center=D
+00002430: 2e70 6f72 7473 5b31 5d2e 6d69 6470 6f69  .ports[1].midpoi
+00002440: 6e74 2c0a 2020 2020 290a 2020 2020 442e  nt,.    ).    D.
+00002450: 6d6f 7665 286f 7269 6769 6e3d 442e 706f  move(origin=D.po
+00002460: 7274 735b 315d 2c20 6465 7374 696e 6174  rts[1], destinat
+00002470: 696f 6e3d 706f 7274 290a 2020 2020 7265  ion=port).    re
+00002480: 7475 726e 2044 0a0a 0a64 6566 2073 7472  turn D...def str
+00002490: 6169 6768 7428 7369 7a65 3d28 342c 2032  aight(size=(4, 2
+000024a0: 292c 206c 6179 6572 3d30 293a 0a20 2020  ), layer=0):.   
+000024b0: 2022 2222 4765 6e65 7261 7465 7320 6120   """Generates a 
+000024c0: 7265 6374 616e 6775 6c61 7220 7769 7265  rectangular wire
+000024d0: 2067 656f 6d65 7472 7920 7769 7468 2070   geometry with p
+000024e0: 6f72 7473 206f 6e20 7468 6520 6c65 6e67  orts on the leng
+000024f0: 7468 2065 6467 6573 2e0a 0a20 2020 2050  th edges...    P
+00002500: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+00002510: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2073 697a  --------.    siz
+00002520: 6520 3a20 7475 706c 6520 6f66 2069 6e74  e : tuple of int
+00002530: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
+00002540: 2020 5468 6520 6c65 6e67 7468 2061 6e64    The length and
+00002550: 2077 6964 7468 206f 6620 7468 6520 7265   width of the re
+00002560: 6374 616e 676c 652e 0a20 2020 206c 6179  ctangle..    lay
+00002570: 6572 203a 2069 6e74 2c20 6172 7261 792d  er : int, array-
+00002580: 6c69 6b65 5b32 5d2c 206f 7220 7365 740a  like[2], or set.
+00002590: 2020 2020 2020 2020 5370 6563 6966 6963          Specific
+000025a0: 206c 6179 6572 2873 2920 746f 2070 7574   layer(s) to put
+000025b0: 2070 6f6c 7967 6f6e 2067 656f 6d65 7472   polygon geometr
+000025c0: 7920 6f6e 2e0a 0a20 2020 2052 6574 7572  y on...    Retur
+000025d0: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
+000025e0: 2020 2044 203a 2044 6576 6963 650a 2020     D : Device.  
+000025f0: 2020 2020 2020 4120 4465 7669 6365 2063        A Device c
+00002600: 6f6e 7461 696e 696e 6720 6120 7265 6374  ontaining a rect
+00002610: 616e 676c 6520 706f 6c79 676f 6e20 616e  angle polygon an
+00002620: 6420 7477 6f20 706f 7274 7320 2860 3160  d two ports (`1`
+00002630: 2061 6e64 2060 3260 2920 6f6e 0a20 2020   and `2`) on.   
+00002640: 2020 2020 2065 6974 6865 7220 656e 642e       either end.
+00002650: 0a0a 2020 2020 4e6f 7465 730a 2020 2020  ..    Notes.    
+00002660: 2d2d 2d2d 2d0a 2020 2020 506f 7274 7320  -----.    Ports 
+00002670: 6172 6520 696e 636c 7564 6564 206f 6e20  are included on 
+00002680: 626f 7468 2073 6964 6573 206f 6620 7468  both sides of th
+00002690: 6520 6c65 6e67 7468 2065 6467 6520 2869  e length edge (i
+000026a0: 2e65 2e20 7369 7a65 5b30 5d29 206f 6620  .e. size[0]) of 
+000026b0: 7468 650a 2020 2020 6765 6f6d 6574 7279  the.    geometry
+000026c0: 2e0a 2020 2020 2222 220a 2020 2020 4420  ..    """.    D 
+000026d0: 3d20 4465 7669 6365 286e 616d 653d 2277  = Device(name="w
+000026e0: 6972 6522 290a 2020 2020 706f 696e 7473  ire").    points
+000026f0: 203d 205b 5b73 697a 655b 305d 2c20 7369   = [[size[0], si
+00002700: 7a65 5b31 5d5d 2c20 5b73 697a 655b 305d  ze[1]], [size[0]
+00002710: 2c20 305d 2c20 5b30 2c20 305d 2c20 5b30  , 0], [0, 0], [0
+00002720: 2c20 7369 7a65 5b31 5d5d 5d0a 2020 2020  , size[1]]].    
+00002730: 442e 6164 645f 706f 6c79 676f 6e28 706f  D.add_polygon(po
+00002740: 696e 7473 2c20 6c61 7965 723d 6c61 7965  ints, layer=laye
+00002750: 7229 0a20 2020 2044 2e61 6464 5f70 6f72  r).    D.add_por
+00002760: 7428 6e61 6d65 3d31 2c20 6d69 6470 6f69  t(name=1, midpoi
+00002770: 6e74 3d28 7369 7a65 5b30 5d20 2f20 322c  nt=(size[0] / 2,
+00002780: 2073 697a 655b 315d 292c 2077 6964 7468   size[1]), width
+00002790: 3d73 697a 655b 305d 2c20 6f72 6965 6e74  =size[0], orient
+000027a0: 6174 696f 6e3d 3930 290a 2020 2020 442e  ation=90).    D.
+000027b0: 6164 645f 706f 7274 286e 616d 653d 322c  add_port(name=2,
+000027c0: 206d 6964 706f 696e 743d 2873 697a 655b   midpoint=(size[
+000027d0: 305d 202f 2032 2c20 3029 2c20 7769 6474  0] / 2, 0), widt
+000027e0: 683d 7369 7a65 5b30 5d2c 206f 7269 656e  h=size[0], orien
+000027f0: 7461 7469 6f6e 3d2d 3930 290a 2020 2020  tation=-90).    
+00002800: 7265 7475 726e 2044 0a0a 0a64 6566 204c  return D...def L
+00002810: 2877 6964 7468 3d31 2c20 7369 7a65 3d28  (width=1, size=(
+00002820: 3130 2c20 3230 292c 206c 6179 6572 3d30  10, 20), layer=0
+00002830: 293a 0a20 2020 2022 2222 4765 6e65 7261  ):.    """Genera
+00002840: 7465 7320 616e 2027 4c27 2067 656f 6d65  tes an 'L' geome
+00002850: 7472 7920 7769 7468 2070 6f72 7473 206f  try with ports o
+00002860: 6e20 626f 7468 2065 6e64 732e 0a0a 2020  n both ends...  
+00002870: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00002880: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00002890: 7769 6474 6820 3a20 696e 7420 6f72 2066  width : int or f
+000028a0: 6c6f 6174 0a20 2020 2020 2020 2054 6869  loat.        Thi
+000028b0: 636b 6e65 7373 206f 6620 7468 6520 6c69  ckness of the li
+000028c0: 6e65 2066 6f72 6d69 6e67 2074 6865 204c  ne forming the L
+000028d0: 2e0a 2020 2020 7369 7a65 203a 2074 7570  ..    size : tup
+000028e0: 6c65 206f 6620 696e 7420 6f72 2066 6c6f  le of int or flo
+000028f0: 6174 0a20 2020 2020 2020 204c 656e 6774  at.        Lengt
+00002900: 6873 206f 6620 7468 6520 6261 7365 2061  hs of the base a
+00002910: 6e64 2068 6569 6768 7420 6f66 2074 6865  nd height of the
+00002920: 204c 2c20 7265 7370 6563 7469 7665 6c79   L, respectively
+00002930: 2e0a 2020 2020 6c61 7965 7220 3a20 696e  ..    layer : in
+00002940: 742c 2061 7272 6179 2d6c 696b 655b 325d  t, array-like[2]
+00002950: 2c20 6f72 2073 6574 0a20 2020 2020 2020  , or set.       
+00002960: 2053 7065 6369 6669 6320 6c61 7965 7228   Specific layer(
+00002970: 7329 2074 6f20 7075 7420 706f 6c79 676f  s) to put polygo
+00002980: 6e20 6765 6f6d 6574 7279 206f 6e2e 0a0a  n geometry on...
+00002990: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+000029a0: 2d2d 2d2d 2d2d 2d0a 2020 2020 4420 3a20  -------.    D : 
+000029b0: 4465 7669 6365 0a20 2020 2020 2020 2041  Device.        A
+000029c0: 2044 6576 6963 6520 636f 6e74 6169 6e69   Device containi
+000029d0: 6e67 2061 6e20 4c2d 7368 6170 6564 2070  ng an L-shaped p
+000029e0: 6f6c 7967 6f6e 2061 6e64 2074 776f 2070  olygon and two p
+000029f0: 6f72 7473 2028 6031 6020 616e 6420 6032  orts (`1` and `2
+00002a00: 6029 206f 6e0a 2020 2020 2020 2020 6569  `) on.        ei
+00002a10: 7468 6572 2065 6e64 206f 6620 7468 6520  ther end of the 
+00002a20: 4c2e 0a20 2020 2022 2222 0a20 2020 2044  L..    """.    D
+00002a30: 203d 2044 6576 6963 6528 6e61 6d65 3d22   = Device(name="
+00002a40: 4c22 290a 2020 2020 7720 3d20 7769 6474  L").    w = widt
+00002a50: 6820 2f20 320a 2020 2020 7331 2c20 7332  h / 2.    s1, s2
+00002a60: 203d 2073 697a 650a 2020 2020 706f 696e   = size.    poin
+00002a70: 7473 203d 205b 282d 772c 202d 7729 2c20  ts = [(-w, -w), 
+00002a80: 2873 312c 202d 7729 2c20 2873 312c 2077  (s1, -w), (s1, w
+00002a90: 292c 2028 772c 2077 292c 2028 772c 2073  ), (w, w), (w, s
+00002aa0: 3229 2c20 282d 772c 2073 3229 2c20 282d  2), (-w, s2), (-
+00002ab0: 772c 202d 7729 5d0a 2020 2020 442e 6164  w, -w)].    D.ad
+00002ac0: 645f 706f 6c79 676f 6e28 706f 696e 7473  d_polygon(points
+00002ad0: 2c20 6c61 7965 723d 6c61 7965 7229 0a20  , layer=layer). 
+00002ae0: 2020 2044 2e61 6464 5f70 6f72 7428 6e61     D.add_port(na
+00002af0: 6d65 3d31 2c20 6d69 6470 6f69 6e74 3d28  me=1, midpoint=(
+00002b00: 302c 2073 3229 2c20 7769 6474 683d 7769  0, s2), width=wi
+00002b10: 6474 682c 206f 7269 656e 7461 7469 6f6e  dth, orientation
+00002b20: 3d39 3029 0a20 2020 2044 2e61 6464 5f70  =90).    D.add_p
+00002b30: 6f72 7428 6e61 6d65 3d32 2c20 6d69 6470  ort(name=2, midp
+00002b40: 6f69 6e74 3d28 7331 2c20 3029 2c20 7769  oint=(s1, 0), wi
+00002b50: 6474 683d 7769 6474 682c 206f 7269 656e  dth=width, orien
+00002b60: 7461 7469 6f6e 3d30 290a 2020 2020 7265  tation=0).    re
+00002b70: 7475 726e 2044 0a0a 0a64 6566 2043 2877  turn D...def C(w
+00002b80: 6964 7468 3d31 2c20 7369 7a65 3d28 3130  idth=1, size=(10
+00002b90: 2c20 3230 292c 206c 6179 6572 3d30 293a  , 20), layer=0):
+00002ba0: 0a20 2020 2022 2222 4765 6e65 7261 7465  .    """Generate
+00002bb0: 7320 6120 2743 2720 6765 6f6d 6574 7279  s a 'C' geometry
+00002bc0: 2077 6974 6820 706f 7274 7320 6f6e 2062   with ports on b
+00002bd0: 6f74 6820 656e 6473 2e0a 0a20 2020 2050  oth ends...    P
+00002be0: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+00002bf0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2077 6964  --------.    wid
+00002c00: 7468 203a 2069 6e74 206f 7220 666c 6f61  th : int or floa
+00002c10: 740a 2020 2020 2020 2020 5468 6963 6b6e  t.        Thickn
+00002c20: 6573 7320 6f66 2074 6865 206c 696e 6520  ess of the line 
+00002c30: 666f 726d 696e 6720 7468 6520 432e 0a20  forming the C.. 
+00002c40: 2020 2073 697a 6520 3a20 7475 706c 6520     size : tuple 
+00002c50: 6f66 2069 6e74 206f 7220 666c 6f61 740a  of int or float.
+00002c60: 2020 2020 2020 2020 4c65 6e67 7468 7320          Lengths 
+00002c70: 6f66 2074 6865 2062 6173 6520 2b20 746f  of the base + to
+00002c80: 7020 6564 6765 7320 616e 6420 7468 6520  p edges and the 
+00002c90: 6865 6967 6874 206f 6620 7468 6520 432c  height of the C,
+00002ca0: 2072 6573 7065 6374 6976 656c 792e 0a20   respectively.. 
+00002cb0: 2020 206c 6179 6572 203a 2069 6e74 2c20     layer : int, 
+00002cc0: 6172 7261 792d 6c69 6b65 5b32 5d2c 206f  array-like[2], o
+00002cd0: 7220 7365 740a 2020 2020 2020 2020 5370  r set.        Sp
+00002ce0: 6563 6966 6963 206c 6179 6572 2873 2920  ecific layer(s) 
+00002cf0: 746f 2070 7574 2070 6f6c 7967 6f6e 2067  to put polygon g
+00002d00: 656f 6d65 7472 7920 6f6e 2e0a 0a20 2020  eometry on...   
+00002d10: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
+00002d20: 2d2d 2d2d 0a20 2020 2044 203a 2044 6576  ----.    D : Dev
+00002d30: 6963 650a 2020 2020 2020 2020 4120 4465  ice.        A De
+00002d40: 7669 6365 2063 6f6e 7461 696e 696e 6720  vice containing 
+00002d50: 6120 5b2d 6272 6163 6b65 742d 7368 6170  a [-bracket-shap
+00002d60: 6564 2070 6f6c 7967 6f6e 2061 6e64 2074  ed polygon and t
+00002d70: 776f 2070 6f72 7473 2028 6031 6020 616e  wo ports (`1` an
+00002d80: 640a 2020 2020 2020 2020 6032 6029 206f  d.        `2`) o
+00002d90: 6e20 6569 7468 6572 2065 6e64 206f 6620  n either end of 
+00002da0: 7468 6520 5b20 7368 6170 652e 0a20 2020  the [ shape..   
+00002db0: 2022 2222 0a20 2020 2044 203d 2044 6576   """.    D = Dev
+00002dc0: 6963 6528 6e61 6d65 3d22 4322 290a 2020  ice(name="C").  
+00002dd0: 2020 7720 3d20 7769 6474 6820 2f20 320a    w = width / 2.
+00002de0: 2020 2020 7331 2c20 7332 203d 2073 697a      s1, s2 = siz
+00002df0: 650a 2020 2020 706f 696e 7473 203d 205b  e.    points = [
+00002e00: 0a20 2020 2020 2020 2028 2d77 2c20 2d77  .        (-w, -w
+00002e10: 292c 0a20 2020 2020 2020 2028 7331 2c20  ),.        (s1, 
+00002e20: 2d77 292c 0a20 2020 2020 2020 2028 7331  -w),.        (s1
+00002e30: 2c20 7729 2c0a 2020 2020 2020 2020 2877  , w),.        (w
+00002e40: 2c20 7729 2c0a 2020 2020 2020 2020 2877  , w),.        (w
+00002e50: 2c20 7332 202d 2077 292c 0a20 2020 2020  , s2 - w),.     
+00002e60: 2020 2028 7331 2c20 7332 202d 2077 292c     (s1, s2 - w),
+00002e70: 0a20 2020 2020 2020 2028 7331 2c20 7332  .        (s1, s2
+00002e80: 202b 2077 292c 0a20 2020 2020 2020 2028   + w),.        (
+00002e90: 2d77 2c20 7332 202b 2077 292c 0a20 2020  -w, s2 + w),.   
+00002ea0: 2020 2020 2028 2d77 2c20 2d77 292c 0a20       (-w, -w),. 
+00002eb0: 2020 205d 0a20 2020 2044 2e61 6464 5f70     ].    D.add_p
+00002ec0: 6f6c 7967 6f6e 2870 6f69 6e74 732c 206c  olygon(points, l
+00002ed0: 6179 6572 3d6c 6179 6572 290a 2020 2020  ayer=layer).    
+00002ee0: 442e 6164 645f 706f 7274 286e 616d 653d  D.add_port(name=
+00002ef0: 312c 206d 6964 706f 696e 743d 2873 312c  1, midpoint=(s1,
+00002f00: 2073 3229 2c20 7769 6474 683d 7769 6474   s2), width=widt
+00002f10: 682c 206f 7269 656e 7461 7469 6f6e 3d30  h, orientation=0
+00002f20: 290a 2020 2020 442e 6164 645f 706f 7274  ).    D.add_port
+00002f30: 286e 616d 653d 322c 206d 6964 706f 696e  (name=2, midpoin
+00002f40: 743d 2873 312c 2030 292c 2077 6964 7468  t=(s1, 0), width
+00002f50: 3d77 6964 7468 2c20 6f72 6965 6e74 6174  =width, orientat
+00002f60: 696f 6e3d 3029 0a20 2020 2072 6574 7572  ion=0).    retur
+00002f70: 6e20 440a 0a0a 2320 3d3d 3d3d 3d3d 3d3d  n D...# ========
+00002f80: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00002f90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00002fa0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
 00002fb0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00002fc0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00002fd0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00002fe0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00002ff0: 3d0a 0a0a 6465 6620 6f66 6673 6574 280a  =...def offset(.
-00003000: 2020 2020 656c 656d 656e 7473 2c0a 2020      elements,.  
-00003010: 2020 6469 7374 616e 6365 3d30 2e31 2c0a    distance=0.1,.
-00003020: 2020 2020 6a6f 696e 5f66 6972 7374 3d54      join_first=T
-00003030: 7275 652c 0a20 2020 2070 7265 6369 7369  rue,.    precisi
-00003040: 6f6e 3d31 652d 342c 0a20 2020 206e 756d  on=1e-4,.    num
-00003050: 5f64 6976 6973 696f 6e73 3d5b 312c 2031  _divisions=[1, 1
-00003060: 5d2c 0a20 2020 206a 6f69 6e3d 226d 6974  ],.    join="mit
-00003070: 6572 222c 0a20 2020 2074 6f6c 6572 616e  er",.    toleran
-00003080: 6365 3d32 2c0a 2020 2020 6d61 785f 706f  ce=2,.    max_po
-00003090: 696e 7473 3d34 3030 302c 0a20 2020 206c  ints=4000,.    l
-000030a0: 6179 6572 3d30 2c0a 293a 0a20 2020 2022  ayer=0,.):.    "
-000030b0: 2222 5368 7269 6e6b 7320 6f72 2065 7870  ""Shrinks or exp
-000030c0: 616e 6473 2061 2070 6f6c 7967 6f6e 206f  ands a polygon o
-000030d0: 7220 7365 7420 6f66 2070 6f6c 7967 6f6e  r set of polygon
-000030e0: 732e 0a0a 2020 2020 5061 7261 6d65 7465  s...    Paramete
-000030f0: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-00003100: 2d0a 2020 2020 656c 656d 656e 7473 203a  -.    elements :
-00003110: 2044 6576 6963 6528 2f52 6566 6572 656e   Device(/Referen
-00003120: 6365 292c 206c 6973 7420 6f66 2044 6576  ce), list of Dev
-00003130: 6963 6528 2f52 6566 6572 656e 6365 292c  ice(/Reference),
-00003140: 206f 7220 506f 6c79 676f 6e0a 2020 2020   or Polygon.    
-00003150: 2020 2020 506f 6c79 676f 6e73 2074 6f20      Polygons to 
-00003160: 6f66 6673 6574 206f 7220 4465 7669 6365  offset or Device
-00003170: 2063 6f6e 7461 696e 696e 6720 706f 6c79   containing poly
-00003180: 676f 6e73 2074 6f20 6f66 6673 6574 2e0a  gons to offset..
-00003190: 2020 2020 6469 7374 616e 6365 203a 2069      distance : i
-000031a0: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
-000031b0: 2020 2020 4469 7374 616e 6365 2074 6f20      Distance to 
-000031c0: 6f66 6673 6574 2070 6f6c 7967 6f6e 732e  offset polygons.
-000031d0: 2050 6f73 6974 6976 6520 7661 6c75 6573   Positive values
-000031e0: 2065 7870 616e 642c 206e 6567 6174 6976   expand, negativ
-000031f0: 6520 7368 7269 6e6b 2e0a 2020 2020 7072  e shrink..    pr
-00003200: 6563 6973 696f 6e20 3a20 666c 6f61 740a  ecision : float.
-00003210: 2020 2020 2020 2020 4465 7369 7265 6420          Desired 
-00003220: 7072 6563 6973 696f 6e20 666f 7220 726f  precision for ro
-00003230: 756e 6469 6e67 2076 6572 7465 7820 636f  unding vertex co
-00003240: 6f72 6469 6e61 7465 732e 0a20 2020 206e  ordinates..    n
-00003250: 756d 5f64 6976 6973 696f 6e73 203a 2061  um_divisions : a
-00003260: 7272 6179 2d6c 696b 655b 325d 206f 6620  rray-like[2] of 
-00003270: 696e 740a 2020 2020 2020 2020 5468 6520  int.        The 
-00003280: 6e75 6d62 6572 206f 6620 6469 7669 7369  number of divisi
-00003290: 6f6e 7320 7769 7468 2077 6869 6368 2074  ons with which t
-000032a0: 6865 2067 656f 6d65 7472 7920 6973 2064  he geometry is d
-000032b0: 6976 6964 6564 2069 6e74 6f0a 2020 2020  ivided into.    
-000032c0: 2020 2020 6d75 6c74 6970 6c65 2072 6563      multiple rec
-000032d0: 7461 6e67 756c 6172 2072 6567 696f 6e73  tangular regions
-000032e0: 2e20 5468 6973 2061 6c6c 6f77 7320 666f  . This allows fo
-000032f0: 7220 6561 6368 2072 6567 696f 6e20 746f  r each region to
-00003300: 2062 650a 2020 2020 2020 2020 7072 6f63   be.        proc
-00003310: 6573 7365 6420 7365 7175 656e 7469 616c  essed sequential
-00003320: 6c79 2c20 7768 6963 6820 6973 206d 6f72  ly, which is mor
-00003330: 6520 636f 6d70 7574 6174 696f 6e61 6c6c  e computationall
-00003340: 7920 6566 6669 6369 656e 742e 0a20 2020  y efficient..   
-00003350: 206a 6f69 6e20 3a20 7b27 6d69 7465 7227   join : {'miter'
-00003360: 2c20 2762 6576 656c 272c 2027 726f 756e  , 'bevel', 'roun
-00003370: 6427 7d0a 2020 2020 2020 2020 5479 7065  d'}.        Type
-00003380: 206f 6620 6a6f 696e 2075 7365 6420 746f   of join used to
-00003390: 2063 7265 6174 6520 7468 6520 6f66 6673   create the offs
-000033a0: 6574 2070 6f6c 7967 6f6e 2e0a 2020 2020  et polygon..    
-000033b0: 746f 6c65 7261 6e63 6520 3a20 696e 7420  tolerance : int 
-000033c0: 6f72 2066 6c6f 6174 0a20 2020 2020 2020  or float.       
-000033d0: 2046 6f72 206d 6974 6572 206a 6f69 6e74   For miter joint
-000033e0: 732c 2074 6869 7320 6e75 6d62 6572 206d  s, this number m
-000033f0: 7573 7420 6265 2061 7420 6c65 6173 7420  ust be at least 
-00003400: 3220 616e 6420 6974 2072 6570 7265 7365  2 and it represe
-00003410: 6e74 7320 7468 650a 2020 2020 2020 2020  nts the.        
-00003420: 6d61 7869 6d61 6c20 6469 7374 616e 6365  maximal distance
-00003430: 2069 6e20 6d75 6c74 6970 6c65 7320 6f66   in multiples of
-00003440: 206f 6666 7365 7420 6265 7477 6565 6e20   offset between 
-00003450: 6e65 7720 7665 7274 6963 6573 2061 6e64  new vertices and
-00003460: 2074 6865 6972 0a20 2020 2020 2020 206f   their.        o
-00003470: 7269 6769 6e61 6c20 706f 7369 7469 6f6e  riginal position
-00003480: 2062 6566 6f72 6520 6265 7665 6c69 6e67   before beveling
-00003490: 2074 6f20 6176 6f69 6420 7370 696b 6573   to avoid spikes
-000034a0: 2061 7420 6163 7574 6520 6a6f 696e 7473   at acute joints
-000034b0: 2e20 466f 720a 2020 2020 2020 2020 726f  . For.        ro
-000034c0: 756e 6420 6a6f 696e 7473 2c20 6974 2069  und joints, it i
-000034d0: 6e64 6963 6174 6573 2074 6865 2063 7572  ndicates the cur
-000034e0: 7661 7475 7265 2072 6573 6f6c 7574 696f  vature resolutio
-000034f0: 6e20 696e 206e 756d 6265 7220 6f66 0a20  n in number of. 
-00003500: 2020 2020 2020 2070 6f69 6e74 7320 7065         points pe
-00003510: 7220 6675 6c6c 2063 6972 636c 652e 0a20  r full circle.. 
-00003520: 2020 206d 6178 5f70 6f69 6e74 7320 3a20     max_points : 
-00003530: 696e 740a 2020 2020 2020 2020 5468 6520  int.        The 
-00003540: 6d61 7869 6d75 6d20 6e75 6d62 6572 206f  maximum number o
-00003550: 6620 7665 7274 6963 6573 2077 6974 6869  f vertices withi
-00003560: 6e20 7468 6520 7265 7375 6c74 696e 6720  n the resulting 
-00003570: 706f 6c79 676f 6e2e 0a20 2020 206c 6179  polygon..    lay
-00003580: 6572 203a 2069 6e74 2c20 6172 7261 792d  er : int, array-
-00003590: 6c69 6b65 5b32 5d2c 206f 7220 7365 740a  like[2], or set.
-000035a0: 2020 2020 2020 2020 5370 6563 6966 6963          Specific
-000035b0: 206c 6179 6572 2873 2920 746f 2070 7574   layer(s) to put
-000035c0: 2070 6f6c 7967 6f6e 2067 656f 6d65 7472   polygon geometr
-000035d0: 7920 6f6e 2e0a 0a20 2020 2052 6574 7572  y on...    Retur
-000035e0: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
-000035f0: 2020 2044 203a 2044 6576 6963 650a 2020     D : Device.  
-00003600: 2020 2020 2020 4120 4465 7669 6365 2063        A Device c
-00003610: 6f6e 7461 696e 696e 6720 6120 706f 6c79  ontaining a poly
-00003620: 676f 6e28 7329 2077 6974 6820 7468 6520  gon(s) with the 
-00003630: 7370 6563 6966 6965 6420 6f66 6673 6574  specified offset
-00003640: 2061 7070 6c69 6564 2e0a 2020 2020 2222   applied..    ""
-00003650: 220a 2020 2020 6966 206e 6f74 2069 7369  ".    if not isi
-00003660: 6e73 7461 6e63 6528 656c 656d 656e 7473  nstance(elements
-00003670: 2c20 6c69 7374 293a 0a20 2020 2020 2020  , list):.       
-00003680: 2065 6c65 6d65 6e74 7320 3d20 5b65 6c65   elements = [ele
-00003690: 6d65 6e74 735d 0a20 2020 2070 6f6c 7967  ments].    polyg
-000036a0: 6f6e 735f 746f 5f6f 6666 7365 7420 3d20  ons_to_offset = 
-000036b0: 5b5d 0a20 2020 2066 6f72 2065 2069 6e20  [].    for e in 
-000036c0: 656c 656d 656e 7473 3a0a 2020 2020 2020  elements:.      
-000036d0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-000036e0: 652c 2028 4465 7669 6365 2c20 4465 7669  e, (Device, Devi
-000036f0: 6365 5265 6665 7265 6e63 6529 293a 0a20  ceReference)):. 
-00003700: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-00003710: 6f6e 735f 746f 5f6f 6666 7365 7420 2b3d  ons_to_offset +=
-00003720: 2065 2e67 6574 5f70 6f6c 7967 6f6e 7328   e.get_polygons(
-00003730: 6279 5f73 7065 633d 4661 6c73 6529 0a20  by_spec=False). 
-00003740: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-00003750: 7374 616e 6365 2865 2c20 2850 6f6c 7967  stance(e, (Polyg
-00003760: 6f6e 2c20 6764 7370 792e 506f 6c79 676f  on, gdspy.Polygo
-00003770: 6e29 293a 0a20 2020 2020 2020 2020 2020  n)):.           
-00003780: 2070 6f6c 7967 6f6e 735f 746f 5f6f 6666   polygons_to_off
-00003790: 7365 742e 6170 7065 6e64 2865 290a 2020  set.append(e).  
-000037a0: 2020 6966 206c 656e 2870 6f6c 7967 6f6e    if len(polygon
-000037b0: 735f 746f 5f6f 6666 7365 7429 203d 3d20  s_to_offset) == 
-000037c0: 303a 0a20 2020 2020 2020 2072 6574 7572  0:.        retur
-000037d0: 6e20 4465 7669 6365 2822 6f66 6673 6574  n Device("offset
-000037e0: 2229 0a0a 2020 2020 706f 6c79 676f 6e73  ")..    polygons
-000037f0: 5f74 6f5f 6f66 6673 6574 203d 205f 6d65  _to_offset = _me
-00003800: 7267 655f 666c 6f61 7469 6e67 5f70 6f69  rge_floating_poi
-00003810: 6e74 5f65 7272 6f72 7328 0a20 2020 2020  nt_errors(.     
-00003820: 2020 2070 6f6c 7967 6f6e 735f 746f 5f6f     polygons_to_o
-00003830: 6666 7365 742c 2074 6f6c 3d70 7265 6369  ffset, tol=preci
-00003840: 7369 6f6e 202f 2031 3030 300a 2020 2020  sion / 1000.    
-00003850: 290a 2020 2020 6764 735f 6c61 7965 722c  ).    gds_layer,
-00003860: 2067 6473 5f64 6174 6174 7970 6520 3d20   gds_datatype = 
-00003870: 5f70 6172 7365 5f6c 6179 6572 286c 6179  _parse_layer(lay
-00003880: 6572 290a 2020 2020 6966 2061 6c6c 286e  er).    if all(n
-00003890: 702e 6172 7261 7928 6e75 6d5f 6469 7669  p.array(num_divi
-000038a0: 7369 6f6e 7329 203d 3d20 6e70 2e61 7272  sions) == np.arr
-000038b0: 6179 285b 312c 2031 5d29 293a 0a20 2020  ay([1, 1])):.   
-000038c0: 2020 2020 2070 203d 2067 6473 7079 2e6f       p = gdspy.o
-000038d0: 6666 7365 7428 0a20 2020 2020 2020 2020  ffset(.         
-000038e0: 2020 2070 6f6c 7967 6f6e 735f 746f 5f6f     polygons_to_o
-000038f0: 6666 7365 742c 0a20 2020 2020 2020 2020  ffset,.         
-00003900: 2020 2064 6973 7461 6e63 653d 6469 7374     distance=dist
-00003910: 616e 6365 2c0a 2020 2020 2020 2020 2020  ance,.          
-00003920: 2020 6a6f 696e 3d6a 6f69 6e2c 0a20 2020    join=join,.   
-00003930: 2020 2020 2020 2020 2074 6f6c 6572 616e           toleran
-00003940: 6365 3d74 6f6c 6572 616e 6365 2c0a 2020  ce=tolerance,.  
-00003950: 2020 2020 2020 2020 2020 7072 6563 6973            precis
-00003960: 696f 6e3d 7072 6563 6973 696f 6e2c 0a20  ion=precision,. 
-00003970: 2020 2020 2020 2020 2020 206a 6f69 6e5f             join_
-00003980: 6669 7273 743d 6a6f 696e 5f66 6972 7374  first=join_first
-00003990: 2c0a 2020 2020 2020 2020 2020 2020 6d61  ,.            ma
-000039a0: 785f 706f 696e 7473 3d6d 6178 5f70 6f69  x_points=max_poi
-000039b0: 6e74 732c 0a20 2020 2020 2020 2020 2020  nts,.           
-000039c0: 206c 6179 6572 3d67 6473 5f6c 6179 6572   layer=gds_layer
-000039d0: 2c0a 2020 2020 2020 2020 2020 2020 6461  ,.            da
-000039e0: 7461 7479 7065 3d67 6473 5f64 6174 6174  tatype=gds_datat
-000039f0: 7970 652c 0a20 2020 2020 2020 2029 0a20  ype,.        ). 
-00003a00: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00003a10: 2070 203d 205f 6f66 6673 6574 5f70 6f6c   p = _offset_pol
-00003a20: 7967 6f6e 735f 7061 7261 6c6c 656c 280a  ygons_parallel(.
-00003a30: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
-00003a40: 676f 6e73 5f74 6f5f 6f66 6673 6574 2c0a  gons_to_offset,.
-00003a50: 2020 2020 2020 2020 2020 2020 6469 7374              dist
-00003a60: 616e 6365 3d64 6973 7461 6e63 652c 0a20  ance=distance,. 
-00003a70: 2020 2020 2020 2020 2020 206e 756d 5f64             num_d
-00003a80: 6976 6973 696f 6e73 3d6e 756d 5f64 6976  ivisions=num_div
-00003a90: 6973 696f 6e73 2c0a 2020 2020 2020 2020  isions,.        
-00003aa0: 2020 2020 6a6f 696e 5f66 6972 7374 3d6a      join_first=j
-00003ab0: 6f69 6e5f 6669 7273 742c 0a20 2020 2020  oin_first,.     
-00003ac0: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
-00003ad0: 3d70 7265 6369 7369 6f6e 2c0a 2020 2020  =precision,.    
-00003ae0: 2020 2020 2020 2020 6a6f 696e 3d6a 6f69          join=joi
-00003af0: 6e2c 0a20 2020 2020 2020 2020 2020 2074  n,.            t
-00003b00: 6f6c 6572 616e 6365 3d74 6f6c 6572 616e  olerance=toleran
-00003b10: 6365 2c0a 2020 2020 2020 2020 290a 0a20  ce,.        ).. 
-00003b20: 2020 2044 203d 2044 6576 6963 6528 226f     D = Device("o
-00003b30: 6666 7365 7422 290a 2020 2020 706f 6c79  ffset").    poly
-00003b40: 676f 6e73 203d 2044 2e61 6464 5f70 6f6c  gons = D.add_pol
-00003b50: 7967 6f6e 2870 2c20 6c61 7965 723d 6c61  ygon(p, layer=la
-00003b60: 7965 7229 0a20 2020 205b 0a20 2020 2020  yer).    [.     
-00003b70: 2020 2070 6f6c 7967 6f6e 2e66 7261 6374     polygon.fract
-00003b80: 7572 6528 6d61 785f 706f 696e 7473 3d6d  ure(max_points=m
-00003b90: 6178 5f70 6f69 6e74 732c 2070 7265 6369  ax_points, preci
-00003ba0: 7369 6f6e 3d70 7265 6369 7369 6f6e 290a  sion=precision).
-00003bb0: 2020 2020 2020 2020 666f 7220 706f 6c79          for poly
-00003bc0: 676f 6e20 696e 2070 6f6c 7967 6f6e 730a  gon in polygons.
-00003bd0: 2020 2020 5d0a 2020 2020 7265 7475 726e      ].    return
-00003be0: 2044 0a0a 0a64 6566 2062 6f6f 6c65 616e   D...def boolean
-00003bf0: 2820 2023 206e 6f71 613a 2043 3930 310a  (  # noqa: C901.
-00003c00: 2020 2020 412c 2042 2c20 6f70 6572 6174      A, B, operat
-00003c10: 696f 6e2c 2070 7265 6369 7369 6f6e 3d31  ion, precision=1
-00003c20: 652d 342c 206e 756d 5f64 6976 6973 696f  e-4, num_divisio
-00003c30: 6e73 3d5b 312c 2031 5d2c 206d 6178 5f70  ns=[1, 1], max_p
-00003c40: 6f69 6e74 733d 3430 3030 2c20 6c61 7965  oints=4000, laye
-00003c50: 723d 300a 293a 0a20 2020 2022 2222 5065  r=0.):.    """Pe
-00003c60: 7266 6f72 6d73 2062 6f6f 6c65 616e 206f  rforms boolean o
-00003c70: 7065 7261 7469 6f6e 7320 6265 7477 6565  perations betwee
-00003c80: 6e20 3220 4465 7669 6365 2f44 6576 6963  n 2 Device/Devic
-00003c90: 6552 6566 6572 656e 6365 206f 626a 6563  eReference objec
-00003ca0: 7473 0a20 2020 206f 7220 6c69 7374 7320  ts.    or lists 
-00003cb0: 6f66 2044 6576 6963 6573 2f44 6576 6963  of Devices/Devic
-00003cc0: 6552 6566 6572 656e 6365 732e 0a0a 2020  eReferences...  
-00003cd0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00003ce0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00003cf0: 4120 3a20 4465 7669 6365 282f 5265 6665  A : Device(/Refe
-00003d00: 7265 6e63 6529 206f 7220 6c69 7374 206f  rence) or list o
-00003d10: 6620 4465 7669 6365 282f 5265 6665 7265  f Device(/Refere
-00003d20: 6e63 6529 206f 7220 506f 6c79 676f 6e0a  nce) or Polygon.
-00003d30: 2020 2020 2020 2020 496e 7075 7420 4465          Input De
-00003d40: 7669 6365 732e 0a20 2020 2042 203a 2044  vices..    B : D
-00003d50: 6576 6963 6528 2f52 6566 6572 656e 6365  evice(/Reference
-00003d60: 2920 6f72 206c 6973 7420 6f66 2044 6576  ) or list of Dev
-00003d70: 6963 6528 2f52 6566 6572 656e 6365 2920  ice(/Reference) 
-00003d80: 6f72 2050 6f6c 7967 6f6e 0a20 2020 2020  or Polygon.     
-00003d90: 2020 2049 6e70 7574 2044 6576 6963 6573     Input Devices
-00003da0: 2e0a 2020 2020 6f70 6572 6174 696f 6e20  ..    operation 
-00003db0: 3a20 7b27 6e6f 7427 2c20 2761 6e64 272c  : {'not', 'and',
-00003dc0: 2027 6f72 272c 2027 786f 7227 2c20 2741   'or', 'xor', 'A
-00003dd0: 2d42 272c 2027 422d 4127 2c20 2741 2b42  -B', 'B-A', 'A+B
-00003de0: 277d 0a20 2020 2020 2020 2042 6f6f 6c65  '}.        Boole
-00003df0: 616e 206f 7065 7261 7469 6f6e 2074 6f20  an operation to 
-00003e00: 7065 7266 6f72 6d2e 0a20 2020 2070 7265  perform..    pre
-00003e10: 6369 7369 6f6e 203a 2066 6c6f 6174 0a20  cision : float. 
-00003e20: 2020 2020 2020 2044 6573 6972 6564 2070         Desired p
-00003e30: 7265 6369 7369 6f6e 2066 6f72 2072 6f75  recision for rou
-00003e40: 6e64 696e 6720 7665 7274 6578 2063 6f6f  nding vertex coo
-00003e50: 7264 696e 6174 6573 2e0a 2020 2020 6e75  rdinates..    nu
-00003e60: 6d5f 6469 7669 7369 6f6e 7320 3a20 6172  m_divisions : ar
-00003e70: 7261 792d 6c69 6b65 5b32 5d20 6f66 2069  ray-like[2] of i
-00003e80: 6e74 0a20 2020 2020 2020 2054 6865 206e  nt.        The n
-00003e90: 756d 6265 7220 6f66 2064 6976 6973 696f  umber of divisio
-00003ea0: 6e73 2077 6974 6820 7768 6963 6820 7468  ns with which th
-00003eb0: 6520 6765 6f6d 6574 7279 2069 7320 6469  e geometry is di
-00003ec0: 7669 6465 6420 696e 746f 0a20 2020 2020  vided into.     
-00003ed0: 2020 206d 756c 7469 706c 6520 7265 6374     multiple rect
-00003ee0: 616e 6775 6c61 7220 7265 6769 6f6e 732e  angular regions.
-00003ef0: 2054 6869 7320 616c 6c6f 7773 2066 6f72   This allows for
-00003f00: 2065 6163 6820 7265 6769 6f6e 2074 6f20   each region to 
-00003f10: 6265 0a20 2020 2020 2020 2070 726f 6365  be.        proce
-00003f20: 7373 6564 2073 6571 7565 6e74 6961 6c6c  ssed sequentiall
-00003f30: 792c 2077 6869 6368 2069 7320 6d6f 7265  y, which is more
-00003f40: 2063 6f6d 7075 7461 7469 6f6e 616c 6c79   computationally
-00003f50: 2065 6666 6963 6965 6e74 2e0a 2020 2020   efficient..    
-00003f60: 6d61 785f 706f 696e 7473 203a 2069 6e74  max_points : int
-00003f70: 0a20 2020 2020 2020 2054 6865 206d 6178  .        The max
-00003f80: 696d 756d 206e 756d 6265 7220 6f66 2076  imum number of v
-00003f90: 6572 7469 6365 7320 7769 7468 696e 2074  ertices within t
-00003fa0: 6865 2072 6573 756c 7469 6e67 2070 6f6c  he resulting pol
-00003fb0: 7967 6f6e 2e0a 2020 2020 6c61 7965 7220  ygon..    layer 
-00003fc0: 3a20 696e 742c 2061 7272 6179 2d6c 696b  : int, array-lik
-00003fd0: 655b 325d 2c20 6f72 2073 6574 0a20 2020  e[2], or set.   
-00003fe0: 2020 2020 2053 7065 6369 6669 6320 6c61       Specific la
-00003ff0: 7965 7228 7329 2074 6f20 7075 7420 706f  yer(s) to put po
-00004000: 6c79 676f 6e20 6765 6f6d 6574 7279 206f  lygon geometry o
-00004010: 6e2e 0a0a 2020 2020 5265 7475 726e 730a  n...    Returns.
-00004020: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-00004030: 443a 2044 6576 6963 650a 2020 2020 2020  D: Device.      
-00004040: 2020 4120 4465 7669 6365 2063 6f6e 7461    A Device conta
-00004050: 696e 696e 6720 6120 706f 6c79 676f 6e28  ining a polygon(
-00004060: 7329 2077 6974 6820 7468 6520 626f 6f6c  s) with the bool
-00004070: 6561 6e20 6f70 6572 6174 696f 6e73 2062  ean operations b
-00004080: 6574 7765 656e 0a20 2020 2020 2020 2074  etween.        t
-00004090: 6865 2032 2069 6e70 7574 2044 6576 6963  he 2 input Devic
-000040a0: 6573 2070 6572 666f 726d 6564 2e0a 0a20  es performed... 
-000040b0: 2020 204e 6f74 6573 0a20 2020 202d 2d2d     Notes.    ---
-000040c0: 2d2d 0a20 2020 2027 412b 4227 2069 7320  --.    'A+B' is 
-000040d0: 6571 7569 7661 6c65 6e74 2074 6f20 276f  equivalent to 'o
-000040e0: 7227 2e0a 2020 2020 2741 2d42 2720 6973  r'..    'A-B' is
-000040f0: 2065 7175 6976 616c 656e 7420 746f 2027   equivalent to '
-00004100: 6e6f 7427 2e0a 2020 2020 2742 2d41 2720  not'..    'B-A' 
-00004110: 6973 2065 7175 6976 616c 656e 7420 746f  is equivalent to
-00004120: 2027 6e6f 7427 2077 6974 6820 7468 6520   'not' with the 
-00004130: 6f70 6572 616e 6473 2073 7769 7463 6865  operands switche
-00004140: 642e 0a20 2020 2022 2222 0a20 2020 2044  d..    """.    D
-00004150: 203d 2044 6576 6963 6528 2262 6f6f 6c65   = Device("boole
-00004160: 616e 2229 0a0a 2020 2020 415f 706f 6c79  an")..    A_poly
-00004170: 7320 3d20 5b5d 0a20 2020 2042 5f70 6f6c  s = [].    B_pol
-00004180: 7973 203d 205b 5d0a 2020 2020 6966 206e  ys = [].    if n
-00004190: 6f74 2069 7369 6e73 7461 6e63 6528 412c  ot isinstance(A,
-000041a0: 206c 6973 7429 3a0a 2020 2020 2020 2020   list):.        
-000041b0: 4120 3d20 5b41 5d0a 2020 2020 6966 206e  A = [A].    if n
-000041c0: 6f74 2069 7369 6e73 7461 6e63 6528 422c  ot isinstance(B,
-000041d0: 206c 6973 7429 3a0a 2020 2020 2020 2020   list):.        
-000041e0: 4220 3d20 5b42 5d0a 0a20 2020 2066 6f72  B = [B]..    for
-000041f0: 2058 2c20 706f 6c79 7320 696e 2028 2841   X, polys in ((A
-00004200: 2c20 415f 706f 6c79 7329 2c20 2842 2c20  , A_polys), (B, 
-00004210: 425f 706f 6c79 7329 293a 0a20 2020 2020  B_polys)):.     
-00004220: 2020 2066 6f72 2065 2069 6e20 583a 0a20     for e in X:. 
-00004230: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00004240: 696e 7374 616e 6365 2865 2c20 2844 6576  instance(e, (Dev
-00004250: 6963 652c 2044 6576 6963 6552 6566 6572  ice, DeviceRefer
-00004260: 656e 6365 2929 3a0a 2020 2020 2020 2020  ence)):.        
-00004270: 2020 2020 2020 2020 706f 6c79 732e 6578          polys.ex
-00004280: 7465 6e64 2865 2e67 6574 5f70 6f6c 7967  tend(e.get_polyg
-00004290: 6f6e 7328 2929 0a20 2020 2020 2020 2020  ons()).         
-000042a0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-000042b0: 6365 2865 2c20 506f 6c79 676f 6e29 3a0a  ce(e, Polygon):.
-000042c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000042d0: 706f 6c79 732e 6578 7465 6e64 2865 2e70  polys.extend(e.p
-000042e0: 6f6c 7967 6f6e 7329 0a0a 2020 2020 6764  olygons)..    gd
-000042f0: 735f 6c61 7965 722c 2067 6473 5f64 6174  s_layer, gds_dat
-00004300: 6174 7970 6520 3d20 5f70 6172 7365 5f6c  atype = _parse_l
-00004310: 6179 6572 286c 6179 6572 290a 0a20 2020  ayer(layer)..   
-00004320: 206f 7065 7261 7469 6f6e 203d 206f 7065   operation = ope
-00004330: 7261 7469 6f6e 2e6c 6f77 6572 2829 2e72  ration.lower().r
-00004340: 6570 6c61 6365 2822 2022 2c20 2222 290a  eplace(" ", "").
-00004350: 2020 2020 6966 206f 7065 7261 7469 6f6e      if operation
-00004360: 203d 3d20 2261 2d62 223a 0a20 2020 2020   == "a-b":.     
-00004370: 2020 206f 7065 7261 7469 6f6e 203d 2022     operation = "
-00004380: 6e6f 7422 0a20 2020 2065 6c69 6620 6f70  not".    elif op
-00004390: 6572 6174 696f 6e20 3d3d 2022 622d 6122  eration == "b-a"
-000043a0: 3a0a 2020 2020 2020 2020 6f70 6572 6174  :.        operat
-000043b0: 696f 6e20 3d20 226e 6f74 220a 2020 2020  ion = "not".    
-000043c0: 2020 2020 415f 706f 6c79 732c 2042 5f70      A_polys, B_p
-000043d0: 6f6c 7973 203d 2042 5f70 6f6c 7973 2c20  olys = B_polys, 
-000043e0: 415f 706f 6c79 730a 2020 2020 656c 6966  A_polys.    elif
-000043f0: 206f 7065 7261 7469 6f6e 203d 3d20 2261   operation == "a
-00004400: 2b62 223a 0a20 2020 2020 2020 206f 7065  +b":.        ope
-00004410: 7261 7469 6f6e 203d 2022 6f72 220a 2020  ration = "or".  
-00004420: 2020 656c 6966 206f 7065 7261 7469 6f6e    elif operation
-00004430: 206e 6f74 2069 6e20 5b22 6e6f 7422 2c20   not in ["not", 
-00004440: 2261 6e64 222c 2022 6f72 222c 2022 786f  "and", "or", "xo
-00004450: 7222 2c20 2261 2d62 222c 2022 622d 6122  r", "a-b", "b-a"
-00004460: 2c20 2261 2b62 225d 3a0a 2020 2020 2020  , "a+b"]:.      
-00004470: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00004480: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00004490: 225b 5048 4944 4c5d 2070 6869 646c 2e67  "[PHIDL] phidl.g
-000044a0: 656f 6d65 7472 792e 626f 6f6c 6561 6e28  eometry.boolean(
-000044b0: 2920 606f 7065 7261 7469 6f6e 6020 220a  ) `operation` ".
-000044c0: 2020 2020 2020 2020 2020 2020 2270 6172              "par
-000044d0: 616d 6574 6572 206e 6f74 2072 6563 6f67  ameter not recog
-000044e0: 6e69 7a65 642c 206d 7573 7420 6265 206f  nized, must be o
-000044f0: 6e65 206f 6620 7468 6520 220a 2020 2020  ne of the ".    
-00004500: 2020 2020 2020 2020 2266 6f6c 6c6f 7769          "followi
-00004510: 6e67 3a20 2027 6e6f 7427 2c20 2761 6e64  ng:  'not', 'and
-00004520: 272c 2027 6f72 272c 2027 786f 7227 2c20  ', 'or', 'xor', 
-00004530: 2741 2d42 272c 2022 0a20 2020 2020 2020  'A-B', ".       
-00004540: 2020 2020 2022 2742 2d41 272c 2027 412b       "'B-A', 'A+
-00004550: 4227 220a 2020 2020 2020 2020 290a 0a20  B'".        ).. 
-00004560: 2020 2023 2043 6865 636b 2066 6f72 2074     # Check for t
-00004570: 7269 7669 616c 2073 6f6c 7574 696f 6e73  rivial solutions
-00004580: 0a20 2020 2069 6620 2828 6c65 6e28 415f  .    if ((len(A_
-00004590: 706f 6c79 7329 203d 3d20 3029 206f 7220  polys) == 0) or 
-000045a0: 286c 656e 2842 5f70 6f6c 7973 2920 3d3d  (len(B_polys) ==
-000045b0: 2030 2929 2061 6e64 2028 6f70 6572 6174   0)) and (operat
-000045c0: 696f 6e20 213d 2022 6f72 2229 3a0a 2020  ion != "or"):.  
-000045d0: 2020 2020 2020 6966 206f 7065 7261 7469        if operati
-000045e0: 6f6e 203d 3d20 226e 6f74 223a 0a20 2020  on == "not":.   
-000045f0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00004600: 415f 706f 6c79 7329 203d 3d20 303a 0a20  A_polys) == 0:. 
-00004610: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00004620: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00004630: 2020 2020 656c 6966 206c 656e 2842 5f70      elif len(B_p
-00004640: 6f6c 7973 2920 3d3d 2030 3a0a 2020 2020  olys) == 0:.    
-00004650: 2020 2020 2020 2020 2020 2020 7020 3d20              p = 
-00004660: 415f 706f 6c79 730a 2020 2020 2020 2020  A_polys.        
-00004670: 656c 6966 206f 7065 7261 7469 6f6e 203d  elif operation =
-00004680: 3d20 2261 6e64 223a 0a20 2020 2020 2020  = "and":.       
-00004690: 2020 2020 2070 203d 204e 6f6e 650a 2020       p = None.  
-000046a0: 2020 2020 2020 656c 6966 206f 7065 7261        elif opera
-000046b0: 7469 6f6e 203d 3d20 2278 6f72 223a 0a20  tion == "xor":. 
-000046c0: 2020 2020 2020 2020 2020 2069 6620 286c             if (l
-000046d0: 656e 2841 5f70 6f6c 7973 2920 3d3d 2030  en(A_polys) == 0
-000046e0: 2920 616e 6420 286c 656e 2842 5f70 6f6c  ) and (len(B_pol
-000046f0: 7973 2920 3d3d 2030 293a 0a20 2020 2020  ys) == 0):.     
-00004700: 2020 2020 2020 2020 2020 2070 203d 204e             p = N
-00004710: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00004720: 656c 6966 206c 656e 2841 5f70 6f6c 7973  elif len(A_polys
-00004730: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-00004740: 2020 2020 2020 2020 7020 3d20 425f 706f          p = B_po
-00004750: 6c79 730a 2020 2020 2020 2020 2020 2020  lys.            
-00004760: 656c 6966 206c 656e 2842 5f70 6f6c 7973  elif len(B_polys
-00004770: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-00004780: 2020 2020 2020 2020 7020 3d20 415f 706f          p = A_po
-00004790: 6c79 730a 2020 2020 656c 6966 2028 6c65  lys.    elif (le
-000047a0: 6e28 415f 706f 6c79 7329 203d 3d20 3029  n(A_polys) == 0)
-000047b0: 2061 6e64 2028 6c65 6e28 425f 706f 6c79   and (len(B_poly
-000047c0: 7329 203d 3d20 3029 2061 6e64 2028 6f70  s) == 0) and (op
-000047d0: 6572 6174 696f 6e20 3d3d 2022 6f72 2229  eration == "or")
-000047e0: 3a0a 2020 2020 2020 2020 7020 3d20 4e6f  :.        p = No
-000047f0: 6e65 0a20 2020 2065 6c73 653a 0a20 2020  ne.    else:.   
-00004800: 2020 2020 2023 2049 6620 6e6f 2074 7269       # If no tri
-00004810: 7669 616c 2073 6f6c 7574 696f 6e73 2c20  vial solutions, 
-00004820: 7275 6e20 626f 6f6c 6561 6e20 6f70 6572  run boolean oper
-00004830: 6174 696f 6e20 6569 7468 6572 2069 6e20  ation either in 
-00004840: 7061 7261 6c6c 656c 206f 720a 2020 2020  parallel or.    
-00004850: 2020 2020 2320 7374 7261 6967 6874 0a20      # straight. 
-00004860: 2020 2020 2020 2069 6620 616c 6c28 6e70         if all(np
-00004870: 2e61 7272 6179 286e 756d 5f64 6976 6973  .array(num_divis
-00004880: 696f 6e73 2920 3d3d 206e 702e 6172 7261  ions) == np.arra
-00004890: 7928 5b31 2c20 315d 2929 3a0a 2020 2020  y([1, 1])):.    
-000048a0: 2020 2020 2020 2020 7020 3d20 6764 7370          p = gdsp
-000048b0: 792e 626f 6f6c 6561 6e28 0a20 2020 2020  y.boolean(.     
-000048c0: 2020 2020 2020 2020 2020 206f 7065 7261             opera
-000048d0: 6e64 313d 415f 706f 6c79 732c 0a20 2020  nd1=A_polys,.   
-000048e0: 2020 2020 2020 2020 2020 2020 206f 7065               ope
-000048f0: 7261 6e64 323d 425f 706f 6c79 732c 0a20  rand2=B_polys,. 
-00004900: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00004910: 7065 7261 7469 6f6e 3d6f 7065 7261 7469  peration=operati
-00004920: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-00004930: 2020 2020 7072 6563 6973 696f 6e3d 7072      precision=pr
-00004940: 6563 6973 696f 6e2c 0a20 2020 2020 2020  ecision,.       
-00004950: 2020 2020 2020 2020 206d 6178 5f70 6f69           max_poi
-00004960: 6e74 733d 6d61 785f 706f 696e 7473 2c0a  nts=max_points,.
-00004970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004980: 6c61 7965 723d 6764 735f 6c61 7965 722c  layer=gds_layer,
+00002fc0: 3d3d 3d3d 3d3d 0a23 0a23 2042 6f6f 6c65  ======.#.# Boole
+00002fd0: 616e 2066 756e 6374 696f 6e73 0a23 0a23  an functions.#.#
+00002fe0: 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d   ===============
+00002ff0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00003000: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00003010: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00003020: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a  ===============.
+00003030: 0a0a 6465 6620 6f66 6673 6574 280a 2020  ..def offset(.  
+00003040: 2020 656c 656d 656e 7473 2c0a 2020 2020    elements,.    
+00003050: 6469 7374 616e 6365 3d30 2e31 2c0a 2020  distance=0.1,.  
+00003060: 2020 6a6f 696e 5f66 6972 7374 3d54 7275    join_first=Tru
+00003070: 652c 0a20 2020 2070 7265 6369 7369 6f6e  e,.    precision
+00003080: 3d31 652d 342c 0a20 2020 206e 756d 5f64  =1e-4,.    num_d
+00003090: 6976 6973 696f 6e73 3d5b 312c 2031 5d2c  ivisions=[1, 1],
+000030a0: 0a20 2020 206a 6f69 6e3d 226d 6974 6572  .    join="miter
+000030b0: 222c 0a20 2020 2074 6f6c 6572 616e 6365  ",.    tolerance
+000030c0: 3d32 2c0a 2020 2020 6d61 785f 706f 696e  =2,.    max_poin
+000030d0: 7473 3d34 3030 302c 0a20 2020 206c 6179  ts=4000,.    lay
+000030e0: 6572 3d30 2c0a 293a 0a20 2020 2022 2222  er=0,.):.    """
+000030f0: 5368 7269 6e6b 7320 6f72 2065 7870 616e  Shrinks or expan
+00003100: 6473 2061 2070 6f6c 7967 6f6e 206f 7220  ds a polygon or 
+00003110: 7365 7420 6f66 2070 6f6c 7967 6f6e 732e  set of polygons.
+00003120: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
+00003130: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
+00003140: 2020 2020 656c 656d 656e 7473 203a 2044      elements : D
+00003150: 6576 6963 6528 2f52 6566 6572 656e 6365  evice(/Reference
+00003160: 292c 206c 6973 7420 6f66 2044 6576 6963  ), list of Devic
+00003170: 6528 2f52 6566 6572 656e 6365 292c 206f  e(/Reference), o
+00003180: 7220 506f 6c79 676f 6e0a 2020 2020 2020  r Polygon.      
+00003190: 2020 506f 6c79 676f 6e73 2074 6f20 6f66    Polygons to of
+000031a0: 6673 6574 206f 7220 4465 7669 6365 2063  fset or Device c
+000031b0: 6f6e 7461 696e 696e 6720 706f 6c79 676f  ontaining polygo
+000031c0: 6e73 2074 6f20 6f66 6673 6574 2e0a 2020  ns to offset..  
+000031d0: 2020 6469 7374 616e 6365 203a 2069 6e74    distance : int
+000031e0: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
+000031f0: 2020 4469 7374 616e 6365 2074 6f20 6f66    Distance to of
+00003200: 6673 6574 2070 6f6c 7967 6f6e 732e 2050  fset polygons. P
+00003210: 6f73 6974 6976 6520 7661 6c75 6573 2065  ositive values e
+00003220: 7870 616e 642c 206e 6567 6174 6976 6520  xpand, negative 
+00003230: 7368 7269 6e6b 2e0a 2020 2020 6a6f 696e  shrink..    join
+00003240: 2066 6972 7374 3a20 626f 6f6c 0a20 2020   first: bool.   
+00003250: 2020 2020 2053 6574 7320 7768 6574 6865       Sets whethe
+00003260: 7220 746f 206d 6572 6765 2061 6c6c 2074  r to merge all t
+00003270: 6865 2070 6f6c 7967 6f6e 7320 6265 666f  he polygons befo
+00003280: 7265 2070 6572 666f 726d 696e 670a 2020  re performing.  
+00003290: 2020 2020 2020 7468 6520 6f66 6673 6574        the offset
+000032a0: 206f 7065 7261 7469 6f6e 2c20 6f72 206f   operation, or o
+000032b0: 6666 7365 7420 6561 6368 2070 6f6c 7967  ffset each polyg
+000032c0: 6f6e 2069 6e64 6976 6964 7561 6c6c 790a  on individually.
+000032d0: 2020 2020 7072 6563 6973 696f 6e20 3a20      precision : 
+000032e0: 666c 6f61 740a 2020 2020 2020 2020 4465  float.        De
+000032f0: 7369 7265 6420 7072 6563 6973 696f 6e20  sired precision 
+00003300: 666f 7220 726f 756e 6469 6e67 2076 6572  for rounding ver
+00003310: 7465 7820 636f 6f72 6469 6e61 7465 732e  tex coordinates.
+00003320: 0a20 2020 206e 756d 5f64 6976 6973 696f  .    num_divisio
+00003330: 6e73 203a 2061 7272 6179 2d6c 696b 655b  ns : array-like[
+00003340: 325d 206f 6620 696e 740a 2020 2020 2020  2] of int.      
+00003350: 2020 5468 6520 6e75 6d62 6572 206f 6620    The number of 
+00003360: 6469 7669 7369 6f6e 7320 7769 7468 2077  divisions with w
+00003370: 6869 6368 2074 6865 2067 656f 6d65 7472  hich the geometr
+00003380: 7920 6973 2064 6976 6964 6564 2069 6e74  y is divided int
+00003390: 6f0a 2020 2020 2020 2020 6d75 6c74 6970  o.        multip
+000033a0: 6c65 2072 6563 7461 6e67 756c 6172 2072  le rectangular r
+000033b0: 6567 696f 6e73 2e20 5468 6973 2061 6c6c  egions. This all
+000033c0: 6f77 7320 666f 7220 6561 6368 2072 6567  ows for each reg
+000033d0: 696f 6e20 746f 2062 650a 2020 2020 2020  ion to be.      
+000033e0: 2020 7072 6f63 6573 7365 6420 7365 7175    processed sequ
+000033f0: 656e 7469 616c 6c79 2c20 7768 6963 6820  entially, which 
+00003400: 6973 206d 6f72 6520 636f 6d70 7574 6174  is more computat
+00003410: 696f 6e61 6c6c 7920 6566 6669 6369 656e  ionally efficien
+00003420: 742e 0a20 2020 206a 6f69 6e20 3a20 7b27  t..    join : {'
+00003430: 6d69 7465 7227 2c20 2762 6576 656c 272c  miter', 'bevel',
+00003440: 2027 726f 756e 6427 7d0a 2020 2020 2020   'round'}.      
+00003450: 2020 5479 7065 206f 6620 6a6f 696e 2075    Type of join u
+00003460: 7365 6420 746f 2063 7265 6174 6520 7468  sed to create th
+00003470: 6520 6f66 6673 6574 2070 6f6c 7967 6f6e  e offset polygon
+00003480: 2e0a 2020 2020 746f 6c65 7261 6e63 6520  ..    tolerance 
+00003490: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
+000034a0: 2020 2020 2020 2046 6f72 206d 6974 6572         For miter
+000034b0: 206a 6f69 6e74 732c 2074 6869 7320 6e75   joints, this nu
+000034c0: 6d62 6572 206d 7573 7420 6265 2061 7420  mber must be at 
+000034d0: 6c65 6173 7420 3220 616e 6420 6974 2072  least 2 and it r
+000034e0: 6570 7265 7365 6e74 7320 7468 650a 2020  epresents the.  
+000034f0: 2020 2020 2020 6d61 7869 6d61 6c20 6469        maximal di
+00003500: 7374 616e 6365 2069 6e20 6d75 6c74 6970  stance in multip
+00003510: 6c65 7320 6f66 206f 6666 7365 7420 6265  les of offset be
+00003520: 7477 6565 6e20 6e65 7720 7665 7274 6963  tween new vertic
+00003530: 6573 2061 6e64 2074 6865 6972 0a20 2020  es and their.   
+00003540: 2020 2020 206f 7269 6769 6e61 6c20 706f       original po
+00003550: 7369 7469 6f6e 2062 6566 6f72 6520 6265  sition before be
+00003560: 7665 6c69 6e67 2074 6f20 6176 6f69 6420  veling to avoid 
+00003570: 7370 696b 6573 2061 7420 6163 7574 6520  spikes at acute 
+00003580: 6a6f 696e 7473 2e20 466f 720a 2020 2020  joints. For.    
+00003590: 2020 2020 726f 756e 6420 6a6f 696e 7473      round joints
+000035a0: 2c20 6974 2069 6e64 6963 6174 6573 2074  , it indicates t
+000035b0: 6865 2063 7572 7661 7475 7265 2072 6573  he curvature res
+000035c0: 6f6c 7574 696f 6e20 696e 206e 756d 6265  olution in numbe
+000035d0: 7220 6f66 0a20 2020 2020 2020 2070 6f69  r of.        poi
+000035e0: 6e74 7320 7065 7220 6675 6c6c 2063 6972  nts per full cir
+000035f0: 636c 652e 0a20 2020 206d 6178 5f70 6f69  cle..    max_poi
+00003600: 6e74 7320 3a20 696e 740a 2020 2020 2020  nts : int.      
+00003610: 2020 5468 6520 6d61 7869 6d75 6d20 6e75    The maximum nu
+00003620: 6d62 6572 206f 6620 7665 7274 6963 6573  mber of vertices
+00003630: 2077 6974 6869 6e20 7468 6520 7265 7375   within the resu
+00003640: 6c74 696e 6720 706f 6c79 676f 6e2e 0a20  lting polygon.. 
+00003650: 2020 206c 6179 6572 203a 2069 6e74 2c20     layer : int, 
+00003660: 6172 7261 792d 6c69 6b65 5b32 5d2c 206f  array-like[2], o
+00003670: 7220 7365 740a 2020 2020 2020 2020 5370  r set.        Sp
+00003680: 6563 6966 6963 206c 6179 6572 2873 2920  ecific layer(s) 
+00003690: 746f 2070 7574 2070 6f6c 7967 6f6e 2067  to put polygon g
+000036a0: 656f 6d65 7472 7920 6f6e 2e0a 0a20 2020  eometry on...   
+000036b0: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
+000036c0: 2d2d 2d2d 0a20 2020 2044 203a 2044 6576  ----.    D : Dev
+000036d0: 6963 650a 2020 2020 2020 2020 4120 4465  ice.        A De
+000036e0: 7669 6365 2063 6f6e 7461 696e 696e 6720  vice containing 
+000036f0: 6120 706f 6c79 676f 6e28 7329 2077 6974  a polygon(s) wit
+00003700: 6820 7468 6520 7370 6563 6966 6965 6420  h the specified 
+00003710: 6f66 6673 6574 2061 7070 6c69 6564 2e0a  offset applied..
+00003720: 2020 2020 2222 220a 2020 2020 6966 206e      """.    if n
+00003730: 6f74 2069 7369 6e73 7461 6e63 6528 656c  ot isinstance(el
+00003740: 656d 656e 7473 2c20 6c69 7374 293a 0a20  ements, list):. 
+00003750: 2020 2020 2020 2065 6c65 6d65 6e74 7320         elements 
+00003760: 3d20 5b65 6c65 6d65 6e74 735d 0a20 2020  = [elements].   
+00003770: 2070 6f6c 7967 6f6e 735f 746f 5f6f 6666   polygons_to_off
+00003780: 7365 7420 3d20 5b5d 0a20 2020 2066 6f72  set = [].    for
+00003790: 2065 2069 6e20 656c 656d 656e 7473 3a0a   e in elements:.
+000037a0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+000037b0: 7461 6e63 6528 652c 2028 4465 7669 6365  tance(e, (Device
+000037c0: 2c20 4465 7669 6365 5265 6665 7265 6e63  , DeviceReferenc
+000037d0: 6529 293a 0a20 2020 2020 2020 2020 2020  e)):.           
+000037e0: 2070 6f6c 7967 6f6e 735f 746f 5f6f 6666   polygons_to_off
+000037f0: 7365 7420 2b3d 2065 2e67 6574 5f70 6f6c  set += e.get_pol
+00003800: 7967 6f6e 7328 6279 5f73 7065 633d 4661  ygons(by_spec=Fa
+00003810: 6c73 6529 0a20 2020 2020 2020 2065 6c69  lse).        eli
+00003820: 6620 6973 696e 7374 616e 6365 2865 2c20  f isinstance(e, 
+00003830: 2850 6f6c 7967 6f6e 2c20 6764 7370 792e  (Polygon, gdspy.
+00003840: 506f 6c79 676f 6e29 293a 0a20 2020 2020  Polygon)):.     
+00003850: 2020 2020 2020 2070 6f6c 7967 6f6e 735f         polygons_
+00003860: 746f 5f6f 6666 7365 742e 6170 7065 6e64  to_offset.append
+00003870: 2865 290a 2020 2020 6966 206c 656e 2870  (e).    if len(p
+00003880: 6f6c 7967 6f6e 735f 746f 5f6f 6666 7365  olygons_to_offse
+00003890: 7429 203d 3d20 303a 0a20 2020 2020 2020  t) == 0:.       
+000038a0: 2072 6574 7572 6e20 4465 7669 6365 2822   return Device("
+000038b0: 6f66 6673 6574 2229 0a0a 2020 2020 706f  offset")..    po
+000038c0: 6c79 676f 6e73 5f74 6f5f 6f66 6673 6574  lygons_to_offset
+000038d0: 203d 205f 6d65 7267 655f 666c 6f61 7469   = _merge_floati
+000038e0: 6e67 5f70 6f69 6e74 5f65 7272 6f72 7328  ng_point_errors(
+000038f0: 0a20 2020 2020 2020 2070 6f6c 7967 6f6e  .        polygon
+00003900: 735f 746f 5f6f 6666 7365 742c 2074 6f6c  s_to_offset, tol
+00003910: 3d70 7265 6369 7369 6f6e 202f 2031 3030  =precision / 100
+00003920: 300a 2020 2020 290a 2020 2020 6764 735f  0.    ).    gds_
+00003930: 6c61 7965 722c 2067 6473 5f64 6174 6174  layer, gds_datat
+00003940: 7970 6520 3d20 5f70 6172 7365 5f6c 6179  ype = _parse_lay
+00003950: 6572 286c 6179 6572 290a 2020 2020 6966  er(layer).    if
+00003960: 2061 6c6c 286e 702e 6172 7261 7928 6e75   all(np.array(nu
+00003970: 6d5f 6469 7669 7369 6f6e 7329 203d 3d20  m_divisions) == 
+00003980: 6e70 2e61 7272 6179 285b 312c 2031 5d29  np.array([1, 1])
+00003990: 293a 0a20 2020 2020 2020 2070 203d 2067  ):.        p = g
+000039a0: 6473 7079 2e6f 6666 7365 7428 0a20 2020  dspy.offset(.   
+000039b0: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
+000039c0: 735f 746f 5f6f 6666 7365 742c 0a20 2020  s_to_offset,.   
+000039d0: 2020 2020 2020 2020 2064 6973 7461 6e63           distanc
+000039e0: 653d 6469 7374 616e 6365 2c0a 2020 2020  e=distance,.    
+000039f0: 2020 2020 2020 2020 6a6f 696e 3d6a 6f69          join=joi
+00003a00: 6e2c 0a20 2020 2020 2020 2020 2020 2074  n,.            t
+00003a10: 6f6c 6572 616e 6365 3d74 6f6c 6572 616e  olerance=toleran
+00003a20: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
+00003a30: 7072 6563 6973 696f 6e3d 7072 6563 6973  precision=precis
+00003a40: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+00003a50: 206a 6f69 6e5f 6669 7273 743d 6a6f 696e   join_first=join
+00003a60: 5f66 6972 7374 2c0a 2020 2020 2020 2020  _first,.        
+00003a70: 2020 2020 6d61 785f 706f 696e 7473 3d6d      max_points=m
+00003a80: 6178 5f70 6f69 6e74 732c 0a20 2020 2020  ax_points,.     
+00003a90: 2020 2020 2020 206c 6179 6572 3d67 6473         layer=gds
+00003aa0: 5f6c 6179 6572 2c0a 2020 2020 2020 2020  _layer,.        
+00003ab0: 2020 2020 6461 7461 7479 7065 3d67 6473      datatype=gds
+00003ac0: 5f64 6174 6174 7970 652c 0a20 2020 2020  _datatype,.     
+00003ad0: 2020 2029 0a20 2020 2065 6c73 653a 0a20     ).    else:. 
+00003ae0: 2020 2020 2020 2070 203d 205f 6f66 6673         p = _offs
+00003af0: 6574 5f70 6f6c 7967 6f6e 735f 7061 7261  et_polygons_para
+00003b00: 6c6c 656c 280a 2020 2020 2020 2020 2020  llel(.          
+00003b10: 2020 706f 6c79 676f 6e73 5f74 6f5f 6f66    polygons_to_of
+00003b20: 6673 6574 2c0a 2020 2020 2020 2020 2020  fset,.          
+00003b30: 2020 6469 7374 616e 6365 3d64 6973 7461    distance=dista
+00003b40: 6e63 652c 0a20 2020 2020 2020 2020 2020  nce,.           
+00003b50: 206e 756d 5f64 6976 6973 696f 6e73 3d6e   num_divisions=n
+00003b60: 756d 5f64 6976 6973 696f 6e73 2c0a 2020  um_divisions,.  
+00003b70: 2020 2020 2020 2020 2020 6a6f 696e 5f66            join_f
+00003b80: 6972 7374 3d6a 6f69 6e5f 6669 7273 742c  irst=join_first,
+00003b90: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
+00003ba0: 6369 7369 6f6e 3d70 7265 6369 7369 6f6e  cision=precision
+00003bb0: 2c0a 2020 2020 2020 2020 2020 2020 6a6f  ,.            jo
+00003bc0: 696e 3d6a 6f69 6e2c 0a20 2020 2020 2020  in=join,.       
+00003bd0: 2020 2020 2074 6f6c 6572 616e 6365 3d74       tolerance=t
+00003be0: 6f6c 6572 616e 6365 2c0a 2020 2020 2020  olerance,.      
+00003bf0: 2020 290a 0a20 2020 2044 203d 2044 6576    )..    D = Dev
+00003c00: 6963 6528 226f 6666 7365 7422 290a 2020  ice("offset").  
+00003c10: 2020 706f 6c79 676f 6e73 203d 2044 2e61    polygons = D.a
+00003c20: 6464 5f70 6f6c 7967 6f6e 2870 2c20 6c61  dd_polygon(p, la
+00003c30: 7965 723d 6c61 7965 7229 0a20 2020 205b  yer=layer).    [
+00003c40: 0a20 2020 2020 2020 2070 6f6c 7967 6f6e  .        polygon
+00003c50: 2e66 7261 6374 7572 6528 6d61 785f 706f  .fracture(max_po
+00003c60: 696e 7473 3d6d 6178 5f70 6f69 6e74 732c  ints=max_points,
+00003c70: 2070 7265 6369 7369 6f6e 3d70 7265 6369   precision=preci
+00003c80: 7369 6f6e 290a 2020 2020 2020 2020 666f  sion).        fo
+00003c90: 7220 706f 6c79 676f 6e20 696e 2070 6f6c  r polygon in pol
+00003ca0: 7967 6f6e 730a 2020 2020 5d0a 2020 2020  ygons.    ].    
+00003cb0: 7265 7475 726e 2044 0a0a 0a64 6566 2062  return D...def b
+00003cc0: 6f6f 6c65 616e 2820 2023 206e 6f71 613a  oolean(  # noqa:
+00003cd0: 2043 3930 310a 2020 2020 412c 2042 2c20   C901.    A, B, 
+00003ce0: 6f70 6572 6174 696f 6e2c 2070 7265 6369  operation, preci
+00003cf0: 7369 6f6e 3d31 652d 342c 206e 756d 5f64  sion=1e-4, num_d
+00003d00: 6976 6973 696f 6e73 3d5b 312c 2031 5d2c  ivisions=[1, 1],
+00003d10: 206d 6178 5f70 6f69 6e74 733d 3430 3030   max_points=4000
+00003d20: 2c20 6c61 7965 723d 300a 293a 0a20 2020  , layer=0.):.   
+00003d30: 2022 2222 5065 7266 6f72 6d73 2062 6f6f   """Performs boo
+00003d40: 6c65 616e 206f 7065 7261 7469 6f6e 7320  lean operations 
+00003d50: 6265 7477 6565 6e20 3220 4465 7669 6365  between 2 Device
+00003d60: 2f44 6576 6963 6552 6566 6572 656e 6365  /DeviceReference
+00003d70: 206f 626a 6563 7473 0a20 2020 206f 7220   objects.    or 
+00003d80: 6c69 7374 7320 6f66 2044 6576 6963 6573  lists of Devices
+00003d90: 2f44 6576 6963 6552 6566 6572 656e 6365  /DeviceReference
+00003da0: 732e 0a0a 2020 2020 5061 7261 6d65 7465  s...    Paramete
+00003db0: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+00003dc0: 2d0a 2020 2020 4120 3a20 4465 7669 6365  -.    A : Device
+00003dd0: 282f 5265 6665 7265 6e63 6529 206f 7220  (/Reference) or 
+00003de0: 6c69 7374 206f 6620 4465 7669 6365 282f  list of Device(/
+00003df0: 5265 6665 7265 6e63 6529 206f 7220 506f  Reference) or Po
+00003e00: 6c79 676f 6e0a 2020 2020 2020 2020 496e  lygon.        In
+00003e10: 7075 7420 4465 7669 6365 732e 0a20 2020  put Devices..   
+00003e20: 2042 203a 2044 6576 6963 6528 2f52 6566   B : Device(/Ref
+00003e30: 6572 656e 6365 2920 6f72 206c 6973 7420  erence) or list 
+00003e40: 6f66 2044 6576 6963 6528 2f52 6566 6572  of Device(/Refer
+00003e50: 656e 6365 2920 6f72 2050 6f6c 7967 6f6e  ence) or Polygon
+00003e60: 0a20 2020 2020 2020 2049 6e70 7574 2044  .        Input D
+00003e70: 6576 6963 6573 2e0a 2020 2020 6f70 6572  evices..    oper
+00003e80: 6174 696f 6e20 3a20 7b27 6e6f 7427 2c20  ation : {'not', 
+00003e90: 2761 6e64 272c 2027 6f72 272c 2027 786f  'and', 'or', 'xo
+00003ea0: 7227 2c20 2741 2d42 272c 2027 422d 4127  r', 'A-B', 'B-A'
+00003eb0: 2c20 2741 2b42 277d 0a20 2020 2020 2020  , 'A+B'}.       
+00003ec0: 2042 6f6f 6c65 616e 206f 7065 7261 7469   Boolean operati
+00003ed0: 6f6e 2074 6f20 7065 7266 6f72 6d2e 0a20  on to perform.. 
+00003ee0: 2020 2070 7265 6369 7369 6f6e 203a 2066     precision : f
+00003ef0: 6c6f 6174 0a20 2020 2020 2020 2044 6573  loat.        Des
+00003f00: 6972 6564 2070 7265 6369 7369 6f6e 2066  ired precision f
+00003f10: 6f72 2072 6f75 6e64 696e 6720 7665 7274  or rounding vert
+00003f20: 6578 2063 6f6f 7264 696e 6174 6573 2e0a  ex coordinates..
+00003f30: 2020 2020 6e75 6d5f 6469 7669 7369 6f6e      num_division
+00003f40: 7320 3a20 6172 7261 792d 6c69 6b65 5b32  s : array-like[2
+00003f50: 5d20 6f66 2069 6e74 0a20 2020 2020 2020  ] of int.       
+00003f60: 2054 6865 206e 756d 6265 7220 6f66 2064   The number of d
+00003f70: 6976 6973 696f 6e73 2077 6974 6820 7768  ivisions with wh
+00003f80: 6963 6820 7468 6520 6765 6f6d 6574 7279  ich the geometry
+00003f90: 2069 7320 6469 7669 6465 6420 696e 746f   is divided into
+00003fa0: 0a20 2020 2020 2020 206d 756c 7469 706c  .        multipl
+00003fb0: 6520 7265 6374 616e 6775 6c61 7220 7265  e rectangular re
+00003fc0: 6769 6f6e 732e 2054 6869 7320 616c 6c6f  gions. This allo
+00003fd0: 7773 2066 6f72 2065 6163 6820 7265 6769  ws for each regi
+00003fe0: 6f6e 2074 6f20 6265 0a20 2020 2020 2020  on to be.       
+00003ff0: 2070 726f 6365 7373 6564 2073 6571 7565   processed seque
+00004000: 6e74 6961 6c6c 792c 2077 6869 6368 2069  ntially, which i
+00004010: 7320 6d6f 7265 2063 6f6d 7075 7461 7469  s more computati
+00004020: 6f6e 616c 6c79 2065 6666 6963 6965 6e74  onally efficient
+00004030: 2e0a 2020 2020 6d61 785f 706f 696e 7473  ..    max_points
+00004040: 203a 2069 6e74 0a20 2020 2020 2020 2054   : int.        T
+00004050: 6865 206d 6178 696d 756d 206e 756d 6265  he maximum numbe
+00004060: 7220 6f66 2076 6572 7469 6365 7320 7769  r of vertices wi
+00004070: 7468 696e 2074 6865 2072 6573 756c 7469  thin the resulti
+00004080: 6e67 2070 6f6c 7967 6f6e 2e0a 2020 2020  ng polygon..    
+00004090: 6c61 7965 7220 3a20 696e 742c 2061 7272  layer : int, arr
+000040a0: 6179 2d6c 696b 655b 325d 2c20 6f72 2073  ay-like[2], or s
+000040b0: 6574 0a20 2020 2020 2020 2053 7065 6369  et.        Speci
+000040c0: 6669 6320 6c61 7965 7228 7329 2074 6f20  fic layer(s) to 
+000040d0: 7075 7420 706f 6c79 676f 6e20 6765 6f6d  put polygon geom
+000040e0: 6574 7279 206f 6e2e 0a0a 2020 2020 5265  etry on...    Re
+000040f0: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00004100: 2d0a 2020 2020 443a 2044 6576 6963 650a  -.    D: Device.
+00004110: 2020 2020 2020 2020 4120 4465 7669 6365          A Device
+00004120: 2063 6f6e 7461 696e 696e 6720 6120 706f   containing a po
+00004130: 6c79 676f 6e28 7329 2077 6974 6820 7468  lygon(s) with th
+00004140: 6520 626f 6f6c 6561 6e20 6f70 6572 6174  e boolean operat
+00004150: 696f 6e73 2062 6574 7765 656e 0a20 2020  ions between.   
+00004160: 2020 2020 2074 6865 2032 2069 6e70 7574       the 2 input
+00004170: 2044 6576 6963 6573 2070 6572 666f 726d   Devices perform
+00004180: 6564 2e0a 0a20 2020 204e 6f74 6573 0a20  ed...    Notes. 
+00004190: 2020 202d 2d2d 2d2d 0a20 2020 2027 412b     -----.    'A+
+000041a0: 4227 2069 7320 6571 7569 7661 6c65 6e74  B' is equivalent
+000041b0: 2074 6f20 276f 7227 2e0a 2020 2020 2741   to 'or'..    'A
+000041c0: 2d42 2720 6973 2065 7175 6976 616c 656e  -B' is equivalen
+000041d0: 7420 746f 2027 6e6f 7427 2e0a 2020 2020  t to 'not'..    
+000041e0: 2742 2d41 2720 6973 2065 7175 6976 616c  'B-A' is equival
+000041f0: 656e 7420 746f 2027 6e6f 7427 2077 6974  ent to 'not' wit
+00004200: 6820 7468 6520 6f70 6572 616e 6473 2073  h the operands s
+00004210: 7769 7463 6865 642e 0a20 2020 2022 2222  witched..    """
+00004220: 0a20 2020 2044 203d 2044 6576 6963 6528  .    D = Device(
+00004230: 2262 6f6f 6c65 616e 2229 0a0a 2020 2020  "boolean")..    
+00004240: 415f 706f 6c79 7320 3d20 5b5d 0a20 2020  A_polys = [].   
+00004250: 2042 5f70 6f6c 7973 203d 205b 5d0a 2020   B_polys = [].  
+00004260: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+00004270: 6e63 6528 412c 206c 6973 7429 3a0a 2020  nce(A, list):.  
+00004280: 2020 2020 2020 4120 3d20 5b41 5d0a 2020        A = [A].  
+00004290: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+000042a0: 6e63 6528 422c 206c 6973 7429 3a0a 2020  nce(B, list):.  
+000042b0: 2020 2020 2020 4220 3d20 5b42 5d0a 0a20        B = [B].. 
+000042c0: 2020 2066 6f72 2058 2c20 706f 6c79 7320     for X, polys 
+000042d0: 696e 2028 2841 2c20 415f 706f 6c79 7329  in ((A, A_polys)
+000042e0: 2c20 2842 2c20 425f 706f 6c79 7329 293a  , (B, B_polys)):
+000042f0: 0a20 2020 2020 2020 2066 6f72 2065 2069  .        for e i
+00004300: 6e20 583a 0a20 2020 2020 2020 2020 2020  n X:.           
+00004310: 2069 6620 6973 696e 7374 616e 6365 2865   if isinstance(e
+00004320: 2c20 2844 6576 6963 652c 2044 6576 6963  , (Device, Devic
+00004330: 6552 6566 6572 656e 6365 2929 3a0a 2020  eReference)):.  
+00004340: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00004350: 6c79 732e 6578 7465 6e64 2865 2e67 6574  lys.extend(e.get
+00004360: 5f70 6f6c 7967 6f6e 7328 2929 0a20 2020  _polygons()).   
+00004370: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
+00004380: 696e 7374 616e 6365 2865 2c20 506f 6c79  instance(e, Poly
+00004390: 676f 6e29 3a0a 2020 2020 2020 2020 2020  gon):.          
+000043a0: 2020 2020 2020 706f 6c79 732e 6578 7465        polys.exte
+000043b0: 6e64 2865 2e70 6f6c 7967 6f6e 7329 0a0a  nd(e.polygons)..
+000043c0: 2020 2020 6764 735f 6c61 7965 722c 2067      gds_layer, g
+000043d0: 6473 5f64 6174 6174 7970 6520 3d20 5f70  ds_datatype = _p
+000043e0: 6172 7365 5f6c 6179 6572 286c 6179 6572  arse_layer(layer
+000043f0: 290a 0a20 2020 206f 7065 7261 7469 6f6e  )..    operation
+00004400: 203d 206f 7065 7261 7469 6f6e 2e6c 6f77   = operation.low
+00004410: 6572 2829 2e72 6570 6c61 6365 2822 2022  er().replace(" "
+00004420: 2c20 2222 290a 2020 2020 6966 206f 7065  , "").    if ope
+00004430: 7261 7469 6f6e 203d 3d20 2261 2d62 223a  ration == "a-b":
+00004440: 0a20 2020 2020 2020 206f 7065 7261 7469  .        operati
+00004450: 6f6e 203d 2022 6e6f 7422 0a20 2020 2065  on = "not".    e
+00004460: 6c69 6620 6f70 6572 6174 696f 6e20 3d3d  lif operation ==
+00004470: 2022 622d 6122 3a0a 2020 2020 2020 2020   "b-a":.        
+00004480: 6f70 6572 6174 696f 6e20 3d20 226e 6f74  operation = "not
+00004490: 220a 2020 2020 2020 2020 415f 706f 6c79  ".        A_poly
+000044a0: 732c 2042 5f70 6f6c 7973 203d 2042 5f70  s, B_polys = B_p
+000044b0: 6f6c 7973 2c20 415f 706f 6c79 730a 2020  olys, A_polys.  
+000044c0: 2020 656c 6966 206f 7065 7261 7469 6f6e    elif operation
+000044d0: 203d 3d20 2261 2b62 223a 0a20 2020 2020   == "a+b":.     
+000044e0: 2020 206f 7065 7261 7469 6f6e 203d 2022     operation = "
+000044f0: 6f72 220a 2020 2020 656c 6966 206f 7065  or".    elif ope
+00004500: 7261 7469 6f6e 206e 6f74 2069 6e20 5b22  ration not in ["
+00004510: 6e6f 7422 2c20 2261 6e64 222c 2022 6f72  not", "and", "or
+00004520: 222c 2022 786f 7222 2c20 2261 2d62 222c  ", "xor", "a-b",
+00004530: 2022 622d 6122 2c20 2261 2b62 225d 3a0a   "b-a", "a+b"]:.
+00004540: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00004550: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00004560: 2020 2020 2020 225b 5048 4944 4c5d 2070        "[PHIDL] p
+00004570: 6869 646c 2e67 656f 6d65 7472 792e 626f  hidl.geometry.bo
+00004580: 6f6c 6561 6e28 2920 606f 7065 7261 7469  olean() `operati
+00004590: 6f6e 6020 220a 2020 2020 2020 2020 2020  on` ".          
+000045a0: 2020 2270 6172 616d 6574 6572 206e 6f74    "parameter not
+000045b0: 2072 6563 6f67 6e69 7a65 642c 206d 7573   recognized, mus
+000045c0: 7420 6265 206f 6e65 206f 6620 7468 6520  t be one of the 
+000045d0: 220a 2020 2020 2020 2020 2020 2020 2266  ".            "f
+000045e0: 6f6c 6c6f 7769 6e67 3a20 2027 6e6f 7427  ollowing:  'not'
+000045f0: 2c20 2761 6e64 272c 2027 6f72 272c 2027  , 'and', 'or', '
+00004600: 786f 7227 2c20 2741 2d42 272c 2022 0a20  xor', 'A-B', ". 
+00004610: 2020 2020 2020 2020 2020 2022 2742 2d41             "'B-A
+00004620: 272c 2027 412b 4227 220a 2020 2020 2020  ', 'A+B'".      
+00004630: 2020 290a 0a20 2020 2023 2043 6865 636b    )..    # Check
+00004640: 2066 6f72 2074 7269 7669 616c 2073 6f6c   for trivial sol
+00004650: 7574 696f 6e73 0a20 2020 2069 6620 2828  utions.    if ((
+00004660: 6c65 6e28 415f 706f 6c79 7329 203d 3d20  len(A_polys) == 
+00004670: 3029 206f 7220 286c 656e 2842 5f70 6f6c  0) or (len(B_pol
+00004680: 7973 2920 3d3d 2030 2929 2061 6e64 2028  ys) == 0)) and (
+00004690: 6f70 6572 6174 696f 6e20 213d 2022 6f72  operation != "or
+000046a0: 2229 3a0a 2020 2020 2020 2020 6966 206f  "):.        if o
+000046b0: 7065 7261 7469 6f6e 203d 3d20 226e 6f74  peration == "not
+000046c0: 223a 0a20 2020 2020 2020 2020 2020 2069  ":.            i
+000046d0: 6620 6c65 6e28 415f 706f 6c79 7329 203d  f len(A_polys) =
+000046e0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+000046f0: 2020 2020 2070 203d 204e 6f6e 650a 2020       p = None.  
+00004700: 2020 2020 2020 2020 2020 656c 6966 206c            elif l
+00004710: 656e 2842 5f70 6f6c 7973 2920 3d3d 2030  en(B_polys) == 0
+00004720: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004730: 2020 7020 3d20 415f 706f 6c79 730a 2020    p = A_polys.  
+00004740: 2020 2020 2020 656c 6966 206f 7065 7261        elif opera
+00004750: 7469 6f6e 203d 3d20 2261 6e64 223a 0a20  tion == "and":. 
+00004760: 2020 2020 2020 2020 2020 2070 203d 204e             p = N
+00004770: 6f6e 650a 2020 2020 2020 2020 656c 6966  one.        elif
+00004780: 206f 7065 7261 7469 6f6e 203d 3d20 2278   operation == "x
+00004790: 6f72 223a 0a20 2020 2020 2020 2020 2020  or":.           
+000047a0: 2069 6620 286c 656e 2841 5f70 6f6c 7973   if (len(A_polys
+000047b0: 2920 3d3d 2030 2920 616e 6420 286c 656e  ) == 0) and (len
+000047c0: 2842 5f70 6f6c 7973 2920 3d3d 2030 293a  (B_polys) == 0):
+000047d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000047e0: 2070 203d 204e 6f6e 650a 2020 2020 2020   p = None.      
+000047f0: 2020 2020 2020 656c 6966 206c 656e 2841        elif len(A
+00004800: 5f70 6f6c 7973 2920 3d3d 2030 3a0a 2020  _polys) == 0:.  
+00004810: 2020 2020 2020 2020 2020 2020 2020 7020                p 
+00004820: 3d20 425f 706f 6c79 730a 2020 2020 2020  = B_polys.      
+00004830: 2020 2020 2020 656c 6966 206c 656e 2842        elif len(B
+00004840: 5f70 6f6c 7973 2920 3d3d 2030 3a0a 2020  _polys) == 0:.  
+00004850: 2020 2020 2020 2020 2020 2020 2020 7020                p 
+00004860: 3d20 415f 706f 6c79 730a 2020 2020 656c  = A_polys.    el
+00004870: 6966 2028 6c65 6e28 415f 706f 6c79 7329  if (len(A_polys)
+00004880: 203d 3d20 3029 2061 6e64 2028 6c65 6e28   == 0) and (len(
+00004890: 425f 706f 6c79 7329 203d 3d20 3029 2061  B_polys) == 0) a
+000048a0: 6e64 2028 6f70 6572 6174 696f 6e20 3d3d  nd (operation ==
+000048b0: 2022 6f72 2229 3a0a 2020 2020 2020 2020   "or"):.        
+000048c0: 7020 3d20 4e6f 6e65 0a20 2020 2065 6c73  p = None.    els
+000048d0: 653a 0a20 2020 2020 2020 2023 2049 6620  e:.        # If 
+000048e0: 6e6f 2074 7269 7669 616c 2073 6f6c 7574  no trivial solut
+000048f0: 696f 6e73 2c20 7275 6e20 626f 6f6c 6561  ions, run boolea
+00004900: 6e20 6f70 6572 6174 696f 6e20 6569 7468  n operation eith
+00004910: 6572 2069 6e20 7061 7261 6c6c 656c 206f  er in parallel o
+00004920: 720a 2020 2020 2020 2020 2320 7374 7261  r.        # stra
+00004930: 6967 6874 0a20 2020 2020 2020 2069 6620  ight.        if 
+00004940: 616c 6c28 6e70 2e61 7272 6179 286e 756d  all(np.array(num
+00004950: 5f64 6976 6973 696f 6e73 2920 3d3d 206e  _divisions) == n
+00004960: 702e 6172 7261 7928 5b31 2c20 315d 2929  p.array([1, 1]))
+00004970: 3a0a 2020 2020 2020 2020 2020 2020 7020  :.            p 
+00004980: 3d20 6764 7370 792e 626f 6f6c 6561 6e28  = gdspy.boolean(
 00004990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000049a0: 2064 6174 6174 7970 653d 6764 735f 6461   datatype=gds_da
-000049b0: 7461 7479 7065 2c0a 2020 2020 2020 2020  tatype,.        
-000049c0: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
-000049d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000049e0: 7020 3d20 5f62 6f6f 6c65 616e 5f70 6f6c  p = _boolean_pol
-000049f0: 7967 6f6e 735f 7061 7261 6c6c 656c 280a  ygons_parallel(.
-00004a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a10: 706f 6c79 676f 6e73 5f41 3d41 5f70 6f6c  polygons_A=A_pol
-00004a20: 7973 2c0a 2020 2020 2020 2020 2020 2020  ys,.            
-00004a30: 2020 2020 706f 6c79 676f 6e73 5f42 3d42      polygons_B=B
-00004a40: 5f70 6f6c 7973 2c0a 2020 2020 2020 2020  _polys,.        
-00004a50: 2020 2020 2020 2020 6e75 6d5f 6469 7669          num_divi
-00004a60: 7369 6f6e 733d 6e75 6d5f 6469 7669 7369  sions=num_divisi
-00004a70: 6f6e 732c 0a20 2020 2020 2020 2020 2020  ons,.           
-00004a80: 2020 2020 206f 7065 7261 7469 6f6e 3d6f       operation=o
-00004a90: 7065 7261 7469 6f6e 2c0a 2020 2020 2020  peration,.      
-00004aa0: 2020 2020 2020 2020 2020 7072 6563 6973            precis
-00004ab0: 696f 6e3d 7072 6563 6973 696f 6e2c 0a20  ion=precision,. 
-00004ac0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00004ad0: 2020 6966 2070 2069 7320 6e6f 7420 4e6f    if p is not No
-00004ae0: 6e65 3a0a 2020 2020 2020 2020 706f 6c79  ne:.        poly
-00004af0: 676f 6e73 203d 2044 2e61 6464 5f70 6f6c  gons = D.add_pol
-00004b00: 7967 6f6e 2870 2c20 6c61 7965 723d 6c61  ygon(p, layer=la
-00004b10: 7965 7229 0a20 2020 2020 2020 205b 0a20  yer).        [. 
-00004b20: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-00004b30: 6f6e 2e66 7261 6374 7572 6528 6d61 785f  on.fracture(max_
-00004b40: 706f 696e 7473 3d6d 6178 5f70 6f69 6e74  points=max_point
-00004b50: 732c 2070 7265 6369 7369 6f6e 3d70 7265  s, precision=pre
-00004b60: 6369 7369 6f6e 290a 2020 2020 2020 2020  cision).        
-00004b70: 2020 2020 666f 7220 706f 6c79 676f 6e20      for polygon 
-00004b80: 696e 2070 6f6c 7967 6f6e 730a 2020 2020  in polygons.    
-00004b90: 2020 2020 5d0a 2020 2020 7265 7475 726e      ].    return
-00004ba0: 2044 0a0a 0a64 6566 206f 7574 6c69 6e65   D...def outline
-00004bb0: 280a 2020 2020 656c 656d 656e 7473 2c0a  (.    elements,.
-00004bc0: 2020 2020 6469 7374 616e 6365 3d31 2c0a      distance=1,.
-00004bd0: 2020 2020 7072 6563 6973 696f 6e3d 3165      precision=1e
-00004be0: 2d34 2c0a 2020 2020 6e75 6d5f 6469 7669  -4,.    num_divi
-00004bf0: 7369 6f6e 733d 5b31 2c20 315d 2c0a 2020  sions=[1, 1],.  
-00004c00: 2020 6a6f 696e 3d22 6d69 7465 7222 2c0a    join="miter",.
-00004c10: 2020 2020 746f 6c65 7261 6e63 653d 322c      tolerance=2,
-00004c20: 0a20 2020 206a 6f69 6e5f 6669 7273 743d  .    join_first=
-00004c30: 5472 7565 2c0a 2020 2020 6d61 785f 706f  True,.    max_po
-00004c40: 696e 7473 3d34 3030 302c 0a20 2020 206f  ints=4000,.    o
-00004c50: 7065 6e5f 706f 7274 733d 4661 6c73 652c  pen_ports=False,
-00004c60: 0a20 2020 206c 6179 6572 3d30 2c0a 293a  .    layer=0,.):
-00004c70: 0a20 2020 2022 2222 4372 6561 7465 7320  .    """Creates 
-00004c80: 616e 206f 7574 6c69 6e65 2061 726f 756e  an outline aroun
-00004c90: 6420 616c 6c20 7468 6520 706f 6c79 676f  d all the polygo
-00004ca0: 6e73 2070 6173 7365 6420 696e 2074 6865  ns passed in the
-00004cb0: 2060 656c 656d 656e 7473 600a 2020 2020   `elements`.    
-00004cc0: 6172 6775 6d65 6e74 2e20 6065 6c65 6d65  argument. `eleme
-00004cd0: 6e74 7360 206d 6179 2062 6520 6120 4465  nts` may be a De
-00004ce0: 7669 6365 2c20 506f 6c79 676f 6e2c 206f  vice, Polygon, o
-00004cf0: 7220 6c69 7374 206f 6620 4465 7669 6365  r list of Device
-00004d00: 732e 0a0a 2020 2020 5061 7261 6d65 7465  s...    Paramete
-00004d10: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-00004d20: 2d0a 2020 2020 656c 656d 656e 7473 203a  -.    elements :
-00004d30: 2044 6576 6963 6528 2f52 6566 6572 656e   Device(/Referen
-00004d40: 6365 292c 206c 6973 7420 6f66 2044 6576  ce), list of Dev
-00004d50: 6963 6528 2f52 6566 6572 656e 6365 292c  ice(/Reference),
-00004d60: 206f 7220 506f 6c79 676f 6e0a 2020 2020   or Polygon.    
-00004d70: 2020 2020 506f 6c79 676f 6e73 2074 6f20      Polygons to 
-00004d80: 6f75 746c 696e 6520 6f72 2044 6576 6963  outline or Devic
-00004d90: 6520 636f 6e74 6169 6e69 6e67 2070 6f6c  e containing pol
-00004da0: 7967 6f6e 7320 746f 206f 7574 6c69 6e65  ygons to outline
-00004db0: 2e0a 2020 2020 6469 7374 616e 6365 203a  ..    distance :
-00004dc0: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
-00004dd0: 2020 2020 2020 4469 7374 616e 6365 2074        Distance t
-00004de0: 6f20 6f66 6673 6574 2070 6f6c 7967 6f6e  o offset polygon
-00004df0: 732e 2050 6f73 6974 6976 6520 7661 6c75  s. Positive valu
-00004e00: 6573 2065 7870 616e 642c 206e 6567 6174  es expand, negat
-00004e10: 6976 6520 7368 7269 6e6b 2e0a 2020 2020  ive shrink..    
-00004e20: 7072 6563 6973 696f 6e20 3a20 666c 6f61  precision : floa
-00004e30: 740a 2020 2020 2020 2020 4465 7369 7265  t.        Desire
-00004e40: 6420 7072 6563 6973 696f 6e20 666f 7220  d precision for 
-00004e50: 726f 756e 6469 6e67 2076 6572 7465 7820  rounding vertex 
-00004e60: 636f 6f72 6469 6e61 7465 732e 0a20 2020  coordinates..   
-00004e70: 206e 756d 5f64 6976 6973 696f 6e73 203a   num_divisions :
-00004e80: 2061 7272 6179 2d6c 696b 655b 325d 206f   array-like[2] o
-00004e90: 6620 696e 740a 2020 2020 2020 2020 5468  f int.        Th
-00004ea0: 6520 6e75 6d62 6572 206f 6620 6469 7669  e number of divi
-00004eb0: 7369 6f6e 7320 7769 7468 2077 6869 6368  sions with which
-00004ec0: 2074 6865 2067 656f 6d65 7472 7920 6973   the geometry is
-00004ed0: 2064 6976 6964 6564 2069 6e74 6f0a 2020   divided into.  
-00004ee0: 2020 2020 2020 6d75 6c74 6970 6c65 2072        multiple r
-00004ef0: 6563 7461 6e67 756c 6172 2072 6567 696f  ectangular regio
-00004f00: 6e73 2e20 5468 6973 2061 6c6c 6f77 7320  ns. This allows 
-00004f10: 666f 7220 6561 6368 2072 6567 696f 6e20  for each region 
-00004f20: 746f 2062 650a 2020 2020 2020 2020 7072  to be.        pr
-00004f30: 6f63 6573 7365 6420 7365 7175 656e 7469  ocessed sequenti
-00004f40: 616c 6c79 2c20 7768 6963 6820 6973 206d  ally, which is m
-00004f50: 6f72 6520 636f 6d70 7574 6174 696f 6e61  ore computationa
-00004f60: 6c6c 7920 6566 6669 6369 656e 742e 0a20  lly efficient.. 
-00004f70: 2020 206a 6f69 6e20 3a20 7b27 6d69 7465     join : {'mite
-00004f80: 7227 2c20 2762 6576 656c 272c 2027 726f  r', 'bevel', 'ro
-00004f90: 756e 6427 7d0a 2020 2020 2020 2020 5479  und'}.        Ty
-00004fa0: 7065 206f 6620 6a6f 696e 2075 7365 6420  pe of join used 
-00004fb0: 746f 2063 7265 6174 6520 7468 6520 6f66  to create the of
-00004fc0: 6673 6574 2070 6f6c 7967 6f6e 2e0a 2020  fset polygon..  
-00004fd0: 2020 746f 6c65 7261 6e63 6520 3a20 696e    tolerance : in
-00004fe0: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
-00004ff0: 2020 2046 6f72 206d 6974 6572 206a 6f69     For miter joi
-00005000: 6e74 732c 2074 6869 7320 6e75 6d62 6572  nts, this number
-00005010: 206d 7573 7420 6265 2061 7420 6c65 6173   must be at leas
-00005020: 7420 3220 616e 6420 6974 2072 6570 7265  t 2 and it repre
-00005030: 7365 6e74 7320 7468 650a 2020 2020 2020  sents the.      
-00005040: 2020 6d61 7869 6d61 6c20 6469 7374 616e    maximal distan
-00005050: 6365 2069 6e20 6d75 6c74 6970 6c65 7320  ce in multiples 
-00005060: 6f66 206f 6666 7365 7420 6265 7477 6565  of offset betwee
-00005070: 6e20 6e65 7720 7665 7274 6963 6573 2061  n new vertices a
-00005080: 6e64 2074 6865 6972 0a20 2020 2020 2020  nd their.       
-00005090: 206f 7269 6769 6e61 6c20 706f 7369 7469   original positi
-000050a0: 6f6e 2062 6566 6f72 6520 6265 7665 6c69  on before beveli
-000050b0: 6e67 2074 6f20 6176 6f69 6420 7370 696b  ng to avoid spik
-000050c0: 6573 2061 7420 6163 7574 6520 6a6f 696e  es at acute join
-000050d0: 7473 2e20 466f 720a 2020 2020 2020 2020  ts. For.        
-000050e0: 726f 756e 6420 6a6f 696e 7473 2c20 6974  round joints, it
-000050f0: 2069 6e64 6963 6174 6573 2074 6865 2063   indicates the c
-00005100: 7572 7661 7475 7265 2072 6573 6f6c 7574  urvature resolut
-00005110: 696f 6e20 696e 206e 756d 6265 7220 6f66  ion in number of
-00005120: 0a20 2020 2020 2020 2070 6f69 6e74 7320  .        points 
-00005130: 7065 7220 6675 6c6c 2063 6972 636c 652e  per full circle.
-00005140: 0a20 2020 206a 6f69 6e5f 6669 7273 7420  .    join_first 
-00005150: 3a20 626f 6f6c 0a20 2020 2020 2020 204a  : bool.        J
-00005160: 6f69 6e20 616c 6c20 7061 7468 7320 6265  oin all paths be
-00005170: 666f 7265 206f 6666 7365 7474 696e 6720  fore offsetting 
-00005180: 746f 2061 766f 6964 2075 6e6e 6563 6573  to avoid unneces
-00005190: 7361 7279 206a 6f69 6e73 2069 6e0a 2020  sary joins in.  
-000051a0: 2020 2020 2020 6164 6a61 6365 6e74 2070        adjacent p
-000051b0: 6f6c 7967 6f6e 2073 6964 6573 2e0a 2020  olygon sides..  
-000051c0: 2020 6d61 785f 706f 696e 7473 203a 2069    max_points : i
-000051d0: 6e74 0a20 2020 2020 2020 2054 6865 206d  nt.        The m
-000051e0: 6178 696d 756d 206e 756d 6265 7220 6f66  aximum number of
-000051f0: 2076 6572 7469 6365 7320 7769 7468 696e   vertices within
-00005200: 2074 6865 2072 6573 756c 7469 6e67 2070   the resulting p
-00005210: 6f6c 7967 6f6e 2e0a 2020 2020 6f70 656e  olygon..    open
-00005220: 5f70 6f72 7473 203a 2062 6f6f 6c20 6f72  _ports : bool or
-00005230: 2066 6c6f 6174 0a20 2020 2020 2020 2049   float.        I
-00005240: 6620 6e6f 7420 4661 6c73 652c 2068 6f6c  f not False, hol
-00005250: 6573 2077 696c 6c20 6265 2063 7574 2069  es will be cut i
-00005260: 6e20 7468 6520 6f75 746c 696e 6520 7375  n the outline su
-00005270: 6368 2074 6861 7420 7468 6520 506f 7274  ch that the Port
-00005280: 7320 6172 650a 2020 2020 2020 2020 6e6f  s are.        no
-00005290: 7420 636f 7665 7265 642e 2049 6620 5472  t covered. If Tr
-000052a0: 7565 2c20 7468 6520 686f 6c65 7320 7769  ue, the holes wi
-000052b0: 6c6c 2068 6176 6520 7468 6520 7361 6d65  ll have the same
-000052c0: 2077 6964 7468 2061 7320 7468 6520 506f   width as the Po
-000052d0: 7274 732e 0a20 2020 2020 2020 2049 6620  rts..        If 
-000052e0: 6120 666c 6f61 742c 2074 6865 2068 6f6c  a float, the hol
-000052f0: 6573 2077 696c 6c20 6265 2062 6520 7769  es will be be wi
-00005300: 6465 6e65 6420 6279 2074 6861 7420 7661  dened by that va
-00005310: 6c75 6520 2875 7365 6675 6c20 666f 7220  lue (useful for 
-00005320: 6675 6c6c 790a 2020 2020 2020 2020 636c  fully.        cl
-00005330: 6561 7269 6e67 2074 6865 206f 7574 6c69  earing the outli
-00005340: 6e65 2061 726f 756e 6420 7468 6520 506f  ne around the Po
-00005350: 7274 7320 666f 7220 706f 7369 7469 7665  rts for positive
-00005360: 2d74 6f6e 6520 7072 6f63 6573 7365 730a  -tone processes.
-00005370: 2020 2020 6c61 7965 7220 3a20 696e 742c      layer : int,
-00005380: 2061 7272 6179 2d6c 696b 655b 325d 2c20   array-like[2], 
-00005390: 6f72 2073 6574 0a20 2020 2020 2020 2053  or set.        S
-000053a0: 7065 6369 6669 6320 6c61 7965 7228 7329  pecific layer(s)
-000053b0: 2074 6f20 7075 7420 706f 6c79 676f 6e20   to put polygon 
-000053c0: 6765 6f6d 6574 7279 206f 6e2e 290a 0a20  geometry on.).. 
-000053d0: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
-000053e0: 2d2d 2d2d 2d2d 0a20 2020 2044 203a 2044  ------.    D : D
-000053f0: 6576 6963 650a 2020 2020 2020 2020 4120  evice.        A 
-00005400: 4465 7669 6365 2063 6f6e 7461 696e 696e  Device containin
-00005410: 6720 7468 6520 6f75 746c 696e 6564 2070  g the outlined p
-00005420: 6f6c 7967 6f6e 2873 292e 0a20 2020 2022  olygon(s)..    "
-00005430: 2222 0a20 2020 2044 203d 2044 6576 6963  "".    D = Devic
-00005440: 6528 226f 7574 6c69 6e65 2229 0a20 2020  e("outline").   
-00005450: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-00005460: 6365 2865 6c65 6d65 6e74 732c 206c 6973  ce(elements, lis
-00005470: 7429 3a0a 2020 2020 2020 2020 656c 656d  t):.        elem
-00005480: 656e 7473 203d 205b 656c 656d 656e 7473  ents = [elements
-00005490: 5d0a 2020 2020 706f 7274 5f6c 6973 7420  ].    port_list 
-000054a0: 3d20 5b5d 0a20 2020 2066 6f72 2065 2069  = [].    for e i
-000054b0: 6e20 656c 656d 656e 7473 3a0a 2020 2020  n elements:.    
-000054c0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-000054d0: 6528 652c 2044 6576 6963 6529 3a0a 2020  e(e, Device):.  
-000054e0: 2020 2020 2020 2020 2020 442e 6164 645f            D.add_
-000054f0: 7265 6628 6529 0a20 2020 2020 2020 2020  ref(e).         
-00005500: 2020 2070 6f72 745f 6c69 7374 202b 3d20     port_list += 
-00005510: 6c69 7374 2865 2e70 6f72 7473 2e76 616c  list(e.ports.val
-00005520: 7565 7328 2929 0a20 2020 2020 2020 2065  ues()).        e
-00005530: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00005540: 2044 2e61 6464 2865 290a 2020 2020 6764   D.add(e).    gd
-00005550: 735f 6c61 7965 722c 2067 6473 5f64 6174  s_layer, gds_dat
-00005560: 6174 7970 6520 3d20 5f70 6172 7365 5f6c  atype = _parse_l
-00005570: 6179 6572 286c 6179 6572 290a 0a20 2020  ayer(layer)..   
-00005580: 2044 5f62 6c6f 6174 6564 203d 206f 6666   D_bloated = off
-00005590: 7365 7428 0a20 2020 2020 2020 2044 2c0a  set(.        D,.
-000055a0: 2020 2020 2020 2020 6469 7374 616e 6365          distance
-000055b0: 3d64 6973 7461 6e63 652c 0a20 2020 2020  =distance,.     
-000055c0: 2020 206a 6f69 6e5f 6669 7273 743d 6a6f     join_first=jo
-000055d0: 696e 5f66 6972 7374 2c0a 2020 2020 2020  in_first,.      
-000055e0: 2020 6e75 6d5f 6469 7669 7369 6f6e 733d    num_divisions=
-000055f0: 6e75 6d5f 6469 7669 7369 6f6e 732c 0a20  num_divisions,. 
-00005600: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
-00005610: 3d70 7265 6369 7369 6f6e 2c0a 2020 2020  =precision,.    
-00005620: 2020 2020 6d61 785f 706f 696e 7473 3d6d      max_points=m
-00005630: 6178 5f70 6f69 6e74 732c 0a20 2020 2020  ax_points,.     
-00005640: 2020 206a 6f69 6e3d 6a6f 696e 2c0a 2020     join=join,.  
-00005650: 2020 2020 2020 746f 6c65 7261 6e63 653d        tolerance=
-00005660: 746f 6c65 7261 6e63 652c 0a20 2020 2020  tolerance,.     
-00005670: 2020 206c 6179 6572 3d6c 6179 6572 2c0a     layer=layer,.
-00005680: 2020 2020 290a 0a20 2020 2054 7269 6d20      )..    Trim 
-00005690: 3d20 4465 7669 6365 2829 0a20 2020 2069  = Device().    i
-000056a0: 6620 6f70 656e 5f70 6f72 7473 2069 7320  f open_ports is 
-000056b0: 6e6f 7420 4661 6c73 653a 0a20 2020 2020  not False:.     
-000056c0: 2020 2069 6620 6f70 656e 5f70 6f72 7473     if open_ports
-000056d0: 2069 7320 5472 7565 3a0a 2020 2020 2020   is True:.      
-000056e0: 2020 2020 2020 7472 696d 5f77 6964 7468        trim_width
-000056f0: 203d 2030 0a20 2020 2020 2020 2065 6c73   = 0.        els
-00005700: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
-00005710: 7269 6d5f 7769 6474 6820 3d20 6f70 656e  rim_width = open
-00005720: 5f70 6f72 7473 202a 2032 0a20 2020 2020  _ports * 2.     
-00005730: 2020 2066 6f72 2070 6f72 7420 696e 2070     for port in p
-00005740: 6f72 745f 6c69 7374 3a0a 2020 2020 2020  ort_list:.      
-00005750: 2020 2020 2020 7472 696d 203d 2063 6f6d        trim = com
-00005760: 7061 7373 2873 697a 653d 2864 6973 7461  pass(size=(dista
-00005770: 6e63 6520 2b20 3620 2a20 7072 6563 6973  nce + 6 * precis
-00005780: 696f 6e2c 2070 6f72 742e 7769 6474 6820  ion, port.width 
-00005790: 2b20 7472 696d 5f77 6964 7468 2929 0a20  + trim_width)). 
-000057a0: 2020 2020 2020 2020 2020 2074 7269 6d5f             trim_
-000057b0: 7265 6620 3d20 5472 696d 203c 3c20 7472  ref = Trim << tr
-000057c0: 696d 0a20 2020 2020 2020 2020 2020 2074  im.            t
-000057d0: 7269 6d5f 7265 662e 636f 6e6e 6563 7428  rim_ref.connect(
-000057e0: 2245 222c 2070 6f72 742c 206f 7665 726c  "E", port, overl
-000057f0: 6170 3d32 202a 2070 7265 6369 7369 6f6e  ap=2 * precision
-00005800: 290a 0a20 2020 204f 7574 6c69 6e65 203d  )..    Outline =
-00005810: 2062 6f6f 6c65 616e 280a 2020 2020 2020   boolean(.      
-00005820: 2020 413d 445f 626c 6f61 7465 642c 0a20    A=D_bloated,. 
-00005830: 2020 2020 2020 2042 3d5b 442c 2054 7269         B=[D, Tri
-00005840: 6d5d 2c0a 2020 2020 2020 2020 6f70 6572  m],.        oper
-00005850: 6174 696f 6e3d 2241 2d42 2220 6966 2064  ation="A-B" if d
-00005860: 6973 7461 6e63 6520 3e20 3020 656c 7365  istance > 0 else
-00005870: 2022 422d 4122 2c0a 2020 2020 2020 2020   "B-A",.        
-00005880: 6e75 6d5f 6469 7669 7369 6f6e 733d 6e75  num_divisions=nu
-00005890: 6d5f 6469 7669 7369 6f6e 732c 0a20 2020  m_divisions,.   
-000058a0: 2020 2020 206d 6178 5f70 6f69 6e74 733d       max_points=
-000058b0: 6d61 785f 706f 696e 7473 2c0a 2020 2020  max_points,.    
-000058c0: 2020 2020 7072 6563 6973 696f 6e3d 7072      precision=pr
-000058d0: 6563 6973 696f 6e2c 0a20 2020 2020 2020  ecision,.       
-000058e0: 206c 6179 6572 3d6c 6179 6572 2c0a 2020   layer=layer,.  
-000058f0: 2020 290a 2020 2020 6966 206f 7065 6e5f    ).    if open_
-00005900: 706f 7274 7320 6973 206e 6f74 2046 616c  ports is not Fal
-00005910: 7365 2061 6e64 206c 656e 2865 6c65 6d65  se and len(eleme
-00005920: 6e74 7329 203d 3d20 313a 0a20 2020 2020  nts) == 1:.     
-00005930: 2020 2066 6f72 2070 6f72 7420 696e 2070     for port in p
-00005940: 6f72 745f 6c69 7374 3a0a 2020 2020 2020  ort_list:.      
-00005950: 2020 2020 2020 4f75 746c 696e 652e 6164        Outline.ad
-00005960: 645f 706f 7274 2870 6f72 743d 706f 7274  d_port(port=port
-00005970: 290a 2020 2020 7265 7475 726e 204f 7574  ).    return Out
-00005980: 6c69 6e65 0a0a 0a64 6566 2069 6e76 6572  line...def inver
-00005990: 7428 0a20 2020 2065 6c65 6d65 6e74 732c  t(.    elements,
-000059a0: 2062 6f72 6465 723d 3130 2c20 7072 6563   border=10, prec
-000059b0: 6973 696f 6e3d 3165 2d34 2c20 6e75 6d5f  ision=1e-4, num_
-000059c0: 6469 7669 7369 6f6e 733d 5b31 2c20 315d  divisions=[1, 1]
-000059d0: 2c20 6d61 785f 706f 696e 7473 3d34 3030  , max_points=400
-000059e0: 302c 206c 6179 6572 3d30 0a29 3a0a 2020  0, layer=0.):.  
-000059f0: 2020 2222 2243 7265 6174 6573 2061 6e20    """Creates an 
-00005a00: 696e 7665 7274 6564 2076 6572 7369 6f6e  inverted version
-00005a10: 206f 6620 7468 6520 696e 7075 7420 7368   of the input sh
-00005a20: 6170 6573 2077 6974 6820 616e 2061 6464  apes with an add
-00005a30: 6974 696f 6e61 6c0a 2020 2020 626f 7264  itional.    bord
-00005a40: 6572 2061 726f 756e 6420 7468 6520 6564  er around the ed
-00005a50: 6765 732e 0a0a 2020 2020 5061 7261 6d65  ges...    Parame
-00005a60: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
-00005a70: 2d2d 2d0a 2020 2020 656c 656d 656e 7473  ---.    elements
-00005a80: 203a 2044 6576 6963 6528 2f52 6566 6572   : Device(/Refer
-00005a90: 656e 6365 292c 206c 6973 7420 6f66 2044  ence), list of D
-00005aa0: 6576 6963 6528 2f52 6566 6572 656e 6365  evice(/Reference
-00005ab0: 292c 206f 7220 506f 6c79 676f 6e0a 2020  ), or Polygon.  
-00005ac0: 2020 2020 2020 4120 4465 7669 6365 2063        A Device c
-00005ad0: 6f6e 7461 696e 696e 6720 7468 6520 706f  ontaining the po
-00005ae0: 6c79 676f 6e73 2074 6f20 696e 7665 7274  lygons to invert
-00005af0: 2e0a 2020 2020 626f 7264 6572 203a 2069  ..    border : i
-00005b00: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
-00005b10: 2020 2020 5369 7a65 206f 6620 7468 6520      Size of the 
-00005b20: 626f 7264 6572 2061 726f 756e 6420 7468  border around th
-00005b30: 6520 696e 7665 7274 6564 2073 6861 7065  e inverted shape
-00005b40: 2028 626f 7264 6572 2076 616c 7565 2069   (border value i
-00005b50: 7320 7468 650a 2020 2020 2020 2020 6469  s the.        di
-00005b60: 7374 616e 6365 2066 726f 6d20 7468 6520  stance from the 
-00005b70: 6564 6765 7320 6f66 2074 6865 2062 6f75  edges of the bou
-00005b80: 6e64 6172 7920 626f 7820 6465 6669 6e69  ndary box defini
-00005b90: 6e67 2074 6865 2069 6e76 6572 7465 640a  ng the inverted.
-00005ba0: 2020 2020 2020 2020 7368 6170 6520 746f          shape to
-00005bb0: 2074 6865 2062 6f72 6465 722c 2061 6e64   the border, and
-00005bc0: 2069 7320 6170 706c 6965 6420 746f 2061   is applied to a
-00005bd0: 6c6c 2034 2073 6964 6573 206f 6620 7468  ll 4 sides of th
-00005be0: 6520 7368 6170 6529 2e0a 2020 2020 7072  e shape)..    pr
-00005bf0: 6563 6973 696f 6e20 3a20 666c 6f61 740a  ecision : float.
-00005c00: 2020 2020 2020 2020 4465 7369 7265 6420          Desired 
-00005c10: 7072 6563 6973 696f 6e20 666f 7220 726f  precision for ro
-00005c20: 756e 6469 6e67 2076 6572 7465 7820 636f  unding vertex co
-00005c30: 6f72 6469 6e61 7465 732e 0a20 2020 206e  ordinates..    n
-00005c40: 756d 5f64 6976 6973 696f 6e73 203a 2061  um_divisions : a
-00005c50: 7272 6179 2d6c 696b 655b 325d 206f 6620  rray-like[2] of 
-00005c60: 696e 740a 2020 2020 2020 2020 5468 6520  int.        The 
-00005c70: 6e75 6d62 6572 206f 6620 6469 7669 7369  number of divisi
-00005c80: 6f6e 7320 7769 7468 2077 6869 6368 2074  ons with which t
-00005c90: 6865 2067 656f 6d65 7472 7920 6973 2064  he geometry is d
-00005ca0: 6976 6964 6564 2069 6e74 6f0a 2020 2020  ivided into.    
-00005cb0: 2020 2020 6d75 6c74 6970 6c65 2072 6563      multiple rec
-00005cc0: 7461 6e67 756c 6172 2072 6567 696f 6e73  tangular regions
-00005cd0: 2e20 5468 6973 2061 6c6c 6f77 7320 666f  . This allows fo
-00005ce0: 7220 6561 6368 2072 6567 696f 6e20 746f  r each region to
-00005cf0: 2062 650a 2020 2020 2020 2020 7072 6f63   be.        proc
-00005d00: 6573 7365 6420 7365 7175 656e 7469 616c  essed sequential
-00005d10: 6c79 2c20 7768 6963 6820 6973 206d 6f72  ly, which is mor
-00005d20: 6520 636f 6d70 7574 6174 696f 6e61 6c6c  e computationall
-00005d30: 7920 6566 6669 6369 656e 742e 0a20 2020  y efficient..   
-00005d40: 206d 6178 5f70 6f69 6e74 7320 3a20 696e   max_points : in
-00005d50: 740a 2020 2020 2020 2020 5468 6520 6d61  t.        The ma
-00005d60: 7869 6d75 6d20 6e75 6d62 6572 206f 6620  ximum number of 
-00005d70: 7665 7274 6963 6573 2077 6974 6869 6e20  vertices within 
-00005d80: 7468 6520 7265 7375 6c74 696e 6720 706f  the resulting po
-00005d90: 6c79 676f 6e2e 0a20 2020 206c 6179 6572  lygon..    layer
-00005da0: 203a 2069 6e74 2c20 6172 7261 792d 6c69   : int, array-li
-00005db0: 6b65 5b32 5d2c 206f 7220 7365 740a 2020  ke[2], or set.  
-00005dc0: 2020 2020 2020 5370 6563 6966 6963 206c        Specific l
-00005dd0: 6179 6572 2873 2920 746f 2070 7574 2070  ayer(s) to put p
-00005de0: 6f6c 7967 6f6e 2067 656f 6d65 7472 7920  olygon geometry 
-00005df0: 6f6e 2e0a 0a20 2020 2052 6574 7572 6e73  on...    Returns
-00005e00: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
-00005e10: 2044 203a 2044 6576 6963 650a 2020 2020   D : Device.    
-00005e20: 2020 2020 4120 4465 7669 6365 2063 6f6e      A Device con
-00005e30: 7461 696e 696e 6720 7468 6520 696e 7665  taining the inve
-00005e40: 7274 6564 2076 6572 7369 6f6e 206f 6620  rted version of 
-00005e50: 7468 6520 696e 7075 7420 7368 6170 6528  the input shape(
-00005e60: 7329 2061 6e64 2074 6865 0a20 2020 2020  s) and the.     
-00005e70: 2020 2063 6f72 7265 7370 6f6e 6469 6e67     corresponding
-00005e80: 2062 6f72 6465 7228 7329 2e0a 2020 2020   border(s)..    
-00005e90: 2222 220a 2020 2020 5465 6d70 203d 2044  """.    Temp = D
-00005ea0: 6576 6963 6528 290a 2020 2020 6966 206e  evice().    if n
-00005eb0: 6f74 2069 7369 6e73 7461 6e63 6528 656c  ot isinstance(el
-00005ec0: 656d 656e 7473 2c20 6c69 7374 293a 0a20  ements, list):. 
-00005ed0: 2020 2020 2020 2065 6c65 6d65 6e74 7320         elements 
-00005ee0: 3d20 5b65 6c65 6d65 6e74 735d 0a20 2020  = [elements].   
-00005ef0: 2066 6f72 2065 2069 6e20 656c 656d 656e   for e in elemen
-00005f00: 7473 3a0a 2020 2020 2020 2020 6966 2069  ts:.        if i
-00005f10: 7369 6e73 7461 6e63 6528 652c 2044 6576  sinstance(e, Dev
-00005f20: 6963 6529 3a0a 2020 2020 2020 2020 2020  ice):.          
-00005f30: 2020 5465 6d70 2e61 6464 5f72 6566 2865    Temp.add_ref(e
-00005f40: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00005f50: 2020 2020 2020 2020 2020 2020 5465 6d70              Temp
-00005f60: 2e61 6464 2865 290a 2020 2020 6764 735f  .add(e).    gds_
-00005f70: 6c61 7965 722c 2067 6473 5f64 6174 6174  layer, gds_datat
-00005f80: 7970 6520 3d20 5f70 6172 7365 5f6c 6179  ype = _parse_lay
-00005f90: 6572 286c 6179 6572 290a 0a20 2020 2023  er(layer)..    #
-00005fa0: 2042 7569 6c64 2074 6865 2072 6563 7461   Build the recta
-00005fb0: 6e67 6c65 2061 726f 756e 6420 7468 6520  ngle around the 
-00005fc0: 6465 7669 6365 2044 0a20 2020 2052 203d  device D.    R =
-00005fd0: 2072 6563 7461 6e67 6c65 2873 697a 653d   rectangle(size=
-00005fe0: 2854 656d 702e 7873 697a 6520 2b20 3220  (Temp.xsize + 2 
-00005ff0: 2a20 626f 7264 6572 2c20 5465 6d70 2e79  * border, Temp.y
-00006000: 7369 7a65 202b 2032 202a 2062 6f72 6465  size + 2 * borde
-00006010: 7229 290a 2020 2020 522e 6365 6e74 6572  r)).    R.center
-00006020: 203d 2054 656d 702e 6365 6e74 6572 0a0a   = Temp.center..
-00006030: 2020 2020 4420 3d20 626f 6f6c 6561 6e28      D = boolean(
-00006040: 0a20 2020 2020 2020 2041 3d52 2c0a 2020  .        A=R,.  
-00006050: 2020 2020 2020 423d 5465 6d70 2c0a 2020        B=Temp,.  
-00006060: 2020 2020 2020 6f70 6572 6174 696f 6e3d        operation=
-00006070: 2241 2d42 222c 0a20 2020 2020 2020 2070  "A-B",.        p
-00006080: 7265 6369 7369 6f6e 3d70 7265 6369 7369  recision=precisi
-00006090: 6f6e 2c0a 2020 2020 2020 2020 6e75 6d5f  on,.        num_
-000060a0: 6469 7669 7369 6f6e 733d 6e75 6d5f 6469  divisions=num_di
-000060b0: 7669 7369 6f6e 732c 0a20 2020 2020 2020  visions,.       
-000060c0: 206d 6178 5f70 6f69 6e74 733d 6d61 785f   max_points=max_
-000060d0: 706f 696e 7473 2c0a 2020 2020 2020 2020  points,.        
-000060e0: 6c61 7965 723d 6c61 7965 722c 0a20 2020  layer=layer,.   
-000060f0: 2029 0a20 2020 2072 6574 7572 6e20 440a   ).    return D.
-00006100: 0a0a 6465 6620 786f 725f 6469 6666 2841  ..def xor_diff(A
-00006110: 2c20 422c 2070 7265 6369 7369 6f6e 3d31  , B, precision=1
-00006120: 652d 3429 3a0a 2020 2020 2222 2247 6976  e-4):.    """Giv
-00006130: 656e 2074 776f 2044 6576 6963 6573 2041  en two Devices A
-00006140: 2061 6e64 2042 2c20 7065 7266 6f72 6d73   and B, performs
-00006150: 2074 6865 206c 6179 6572 2d62 792d 6c61   the layer-by-la
-00006160: 7965 7220 584f 520a 2020 2020 6469 6666  yer XOR.    diff
-00006170: 6572 656e 6365 2062 6574 7765 656e 2041  erence between A
-00006180: 2061 6e64 2042 2061 6e64 2072 6574 7572   and B and retur
-00006190: 6e73 2070 6f6c 7967 6f6e 7320 7265 7072  ns polygons repr
-000061a0: 6573 656e 7469 6e67 2074 6865 0a20 2020  esenting the.   
-000061b0: 2064 6966 6665 7265 6e63 6573 2062 6574   differences bet
-000061c0: 7765 656e 2041 2061 6e64 2042 2e0a 0a20  ween A and B... 
-000061d0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-000061e0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-000061f0: 2041 203a 2044 6576 6963 6528 2f52 6566   A : Device(/Ref
-00006200: 6572 656e 6365 2920 6f72 206c 6973 7420  erence) or list 
-00006210: 6f66 2044 6576 6963 6528 2f52 6566 6572  of Device(/Refer
-00006220: 656e 6365 290a 2020 2020 2020 2020 4120  ence).        A 
-00006230: 4465 7669 6365 2063 6f6e 7461 696e 696e  Device containin
-00006240: 6720 6120 706f 6c79 676f 6e28 7329 2e0a  g a polygon(s)..
-00006250: 2020 2020 4220 3a20 4465 7669 6365 282f      B : Device(/
-00006260: 5265 6665 7265 6e63 6529 206f 7220 6c69  Reference) or li
-00006270: 7374 206f 6620 4465 7669 6365 282f 5265  st of Device(/Re
-00006280: 6665 7265 6e63 6529 0a20 2020 2020 2020  ference).       
-00006290: 2041 2044 6576 6963 6520 636f 6e74 6169   A Device contai
-000062a0: 6e69 6e67 2061 2070 6f6c 7967 6f6e 2873  ning a polygon(s
-000062b0: 292e 0a20 2020 2070 7265 6369 7369 6f6e  )..    precision
-000062c0: 203a 2066 6c6f 6174 0a20 2020 2020 2020   : float.       
-000062d0: 2044 6573 6972 6564 2070 7265 6369 7369   Desired precisi
-000062e0: 6f6e 2066 6f72 2072 6f75 6e64 696e 6720  on for rounding 
-000062f0: 7665 7274 6578 2063 6f6f 7264 696e 6174  vertex coordinat
-00006300: 6573 2e0a 0a20 2020 2052 6574 7572 6e73  es...    Returns
-00006310: 0a20 2020 202d 2d2d 2d2d 2d0a 2020 2020  .    ------.    
-00006320: 443a 2044 6576 6963 650a 2020 2020 2020  D: Device.      
-00006330: 2020 4120 4465 7669 6365 2063 6f6e 7461    A Device conta
-00006340: 696e 696e 6720 6120 706f 6c79 676f 6e28  ining a polygon(
-00006350: 7329 2064 6566 696e 6564 2062 7920 7468  s) defined by th
-00006360: 6520 584f 5220 6469 6666 6572 656e 6365  e XOR difference
-00006370: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
-00006380: 6265 7477 6565 6e20 4120 616e 6420 422e  between A and B.
-00006390: 0a20 2020 2022 2222 0a0a 2020 2020 4420  .    """..    D 
-000063a0: 3d20 4465 7669 6365 2822 786f 725f 6469  = Device("xor_di
-000063b0: 6666 2229 0a20 2020 2041 5f70 6f6c 7973  ff").    A_polys
-000063c0: 203d 2041 2e67 6574 5f70 6f6c 7967 6f6e   = A.get_polygon
-000063d0: 7328 6279 5f73 7065 633d 5472 7565 290a  s(by_spec=True).
-000063e0: 2020 2020 425f 706f 6c79 7320 3d20 422e      B_polys = B.
-000063f0: 6765 745f 706f 6c79 676f 6e73 2862 795f  get_polygons(by_
-00006400: 7370 6563 3d54 7275 6529 0a20 2020 2041  spec=True).    A
-00006410: 5f6c 6179 6572 7320 3d20 415f 706f 6c79  _layers = A_poly
-00006420: 732e 6b65 7973 2829 0a20 2020 2042 5f6c  s.keys().    B_l
-00006430: 6179 6572 7320 3d20 425f 706f 6c79 732e  ayers = B_polys.
-00006440: 6b65 7973 2829 0a20 2020 2061 6c6c 5f6c  keys().    all_l
-00006450: 6179 6572 7320 3d20 7365 7428 290a 2020  ayers = set().  
-00006460: 2020 616c 6c5f 6c61 7965 7273 2e75 7064    all_layers.upd
-00006470: 6174 6528 415f 6c61 7965 7273 290a 2020  ate(A_layers).  
-00006480: 2020 616c 6c5f 6c61 7965 7273 2e75 7064    all_layers.upd
-00006490: 6174 6528 425f 6c61 7965 7273 290a 2020  ate(B_layers).  
-000064a0: 2020 666f 7220 6c61 7965 7220 696e 2061    for layer in a
-000064b0: 6c6c 5f6c 6179 6572 733a 0a20 2020 2020  ll_layers:.     
-000064c0: 2020 2069 6620 286c 6179 6572 2069 6e20     if (layer in 
-000064d0: 415f 6c61 7965 7273 2920 616e 6420 286c  A_layers) and (l
-000064e0: 6179 6572 2069 6e20 425f 6c61 7965 7273  ayer in B_layers
-000064f0: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-00006500: 203d 2067 6473 7079 2e62 6f6f 6c65 616e   = gdspy.boolean
-00006510: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00006520: 2020 6f70 6572 616e 6431 3d41 5f70 6f6c    operand1=A_pol
-00006530: 7973 5b6c 6179 6572 5d2c 0a20 2020 2020  ys[layer],.     
-00006540: 2020 2020 2020 2020 2020 206f 7065 7261             opera
-00006550: 6e64 323d 425f 706f 6c79 735b 6c61 7965  nd2=B_polys[laye
-00006560: 725d 2c0a 2020 2020 2020 2020 2020 2020  r],.            
-00006570: 2020 2020 6f70 6572 6174 696f 6e3d 2278      operation="x
-00006580: 6f72 222c 0a20 2020 2020 2020 2020 2020  or",.           
-00006590: 2020 2020 2070 7265 6369 7369 6f6e 3d70       precision=p
-000065a0: 7265 6369 7369 6f6e 2c0a 2020 2020 2020  recision,.      
-000065b0: 2020 2020 2020 2020 2020 6d61 785f 706f            max_po
-000065c0: 696e 7473 3d34 3030 302c 0a20 2020 2020  ints=4000,.     
-000065d0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-000065e0: 3d6c 6179 6572 5b30 5d2c 0a20 2020 2020  =layer[0],.     
-000065f0: 2020 2020 2020 2020 2020 2064 6174 6174             datat
-00006600: 7970 653d 6c61 7965 725b 315d 2c0a 2020  ype=layer[1],.  
-00006610: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00006620: 2020 2020 656c 6966 206c 6179 6572 2069      elif layer i
-00006630: 6e20 415f 6c61 7965 7273 3a0a 2020 2020  n A_layers:.    
-00006640: 2020 2020 2020 2020 7020 3d20 415f 706f          p = A_po
-00006650: 6c79 735b 6c61 7965 725d 0a20 2020 2020  lys[layer].     
-00006660: 2020 2065 6c69 6620 6c61 7965 7220 696e     elif layer in
-00006670: 2042 5f6c 6179 6572 733a 0a20 2020 2020   B_layers:.     
-00006680: 2020 2020 2020 2070 203d 2042 5f70 6f6c         p = B_pol
-00006690: 7973 5b6c 6179 6572 5d0a 2020 2020 2020  ys[layer].      
-000066a0: 2020 6966 2070 2069 7320 6e6f 7420 4e6f    if p is not No
-000066b0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000066c0: 442e 6164 645f 706f 6c79 676f 6e28 702c  D.add_polygon(p,
-000066d0: 206c 6179 6572 3d6c 6179 6572 290a 2020   layer=layer).  
-000066e0: 2020 7265 7475 726e 2044 0a0a 0a64 6566    return D...def
-000066f0: 2075 6e69 6f6e 2844 2c20 6279 5f6c 6179   union(D, by_lay
-00006700: 6572 3d46 616c 7365 2c20 7072 6563 6973  er=False, precis
-00006710: 696f 6e3d 3165 2d34 2c20 6a6f 696e 5f66  ion=1e-4, join_f
-00006720: 6972 7374 3d54 7275 652c 206d 6178 5f70  irst=True, max_p
-00006730: 6f69 6e74 733d 3430 3030 2c20 6c61 7965  oints=4000, laye
-00006740: 723d 3029 3a0a 2020 2020 2222 2250 6572  r=0):.    """Per
-00006750: 666f 726d 7320 7468 6520 756e 696f 6e20  forms the union 
-00006760: 6f66 2061 6c6c 2070 6f6c 7967 6f6e 7320  of all polygons 
-00006770: 7769 7468 696e 2061 2044 6576 6963 652e  within a Device.
-00006780: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-00006790: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-000067a0: 2020 2020 4420 3a20 4465 7669 6365 282f      D : Device(/
-000067b0: 5265 6665 7265 6e63 6529 0a20 2020 2020  Reference).     
-000067c0: 2020 2041 2044 6576 6963 6520 636f 6e74     A Device cont
-000067d0: 6169 6e69 6e67 2070 6f6c 7967 6f6e 7320  aining polygons 
-000067e0: 746f 2070 6572 666f 726d 2061 2075 6e69  to perform a uni
-000067f0: 6f6e 206f 6e2e 0a20 2020 2062 795f 4c61  on on..    by_La
-00006800: 7965 7220 3a20 626f 6f6c 0a20 2020 2020  yer : bool.     
-00006810: 2020 2049 6620 7472 7565 2c20 7065 7266     If true, perf
-00006820: 6f72 6d73 2074 6865 2075 6e69 6f6e 206f  orms the union o
-00006830: 7065 7261 7469 6f6e 206c 6179 6572 2d77  peration layer-w
-00006840: 6973 6520 736f 2065 6163 6820 6c61 7965  ise so each laye
-00006850: 7220 6361 6e20 6265 0a20 2020 2020 2020  r can be.       
-00006860: 2069 6e64 6976 6964 7561 6c6c 7920 636f   individually co
-00006870: 6d62 696e 6564 2e0a 2020 2020 7072 6563  mbined..    prec
-00006880: 6973 696f 6e20 3a20 666c 6f61 740a 2020  ision : float.  
-00006890: 2020 2020 2020 4465 7369 7265 6420 7072        Desired pr
-000068a0: 6563 6973 696f 6e20 666f 7220 726f 756e  ecision for roun
-000068b0: 6469 6e67 2076 6572 7465 7820 636f 6f72  ding vertex coor
-000068c0: 6469 6e61 7465 732e 0a20 2020 206a 6f69  dinates..    joi
-000068d0: 6e5f 6669 7273 7420 3a20 626f 6f6c 0a20  n_first : bool. 
-000068e0: 2020 2020 2020 204a 6f69 6e20 616c 6c20         Join all 
-000068f0: 7061 7468 7320 6265 666f 7265 206f 6666  paths before off
-00006900: 7365 7474 696e 6720 746f 2061 766f 6964  setting to avoid
-00006910: 2075 6e6e 6563 6573 7361 7279 206a 6f69   unnecessary joi
-00006920: 6e73 2069 6e0a 2020 2020 2020 2020 6164  ns in.        ad
-00006930: 6a61 6365 6e74 2070 6f6c 7967 6f6e 2073  jacent polygon s
-00006940: 6964 6573 2e0a 2020 2020 6d61 785f 706f  ides..    max_po
-00006950: 696e 7473 203a 2069 6e74 0a20 2020 2020  ints : int.     
-00006960: 2020 2054 6865 206d 6178 696d 756d 206e     The maximum n
-00006970: 756d 6265 7220 6f66 2076 6572 7469 6365  umber of vertice
-00006980: 7320 7769 7468 696e 2074 6865 2072 6573  s within the res
-00006990: 756c 7469 6e67 2070 6f6c 7967 6f6e 2e0a  ulting polygon..
-000069a0: 2020 2020 6c61 7965 7220 3a20 696e 742c      layer : int,
-000069b0: 2061 7272 6179 2d6c 696b 655b 325d 2c20   array-like[2], 
-000069c0: 6f72 2073 6574 0a20 2020 2020 2020 2053  or set.        S
-000069d0: 7065 6369 6669 6320 6c61 7965 7228 7329  pecific layer(s)
-000069e0: 2074 6f20 7075 7420 706f 6c79 676f 6e20   to put polygon 
-000069f0: 6765 6f6d 6574 7279 206f 6e2e 0a0a 2020  geometry on...  
-00006a00: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
-00006a10: 2d2d 2d2d 2d0a 2020 2020 5520 3a20 4465  -----.    U : De
-00006a20: 7669 6365 0a20 2020 2020 2020 2041 2044  vice.        A D
-00006a30: 6576 6963 6520 636f 6e74 6169 6e69 6e67  evice containing
-00006a40: 2074 6865 2075 6e69 6f6e 206f 6620 7468   the union of th
-00006a50: 6520 706f 6c79 676f 6e73 2077 6974 6869  e polygons withi
-00006a60: 6e20 7468 6520 696e 7075 7420 4465 7669  n the input Devi
-00006a70: 6365 2e0a 2020 2020 2222 220a 2020 2020  ce..    """.    
-00006a80: 5520 3d20 4465 7669 6365 2822 756e 696f  U = Device("unio
-00006a90: 6e22 290a 0a20 2020 2069 6620 6279 5f6c  n")..    if by_l
-00006aa0: 6179 6572 3a0a 2020 2020 2020 2020 616c  ayer:.        al
-00006ab0: 6c5f 706f 6c79 676f 6e73 203d 2044 2e67  l_polygons = D.g
-00006ac0: 6574 5f70 6f6c 7967 6f6e 7328 6279 5f73  et_polygons(by_s
-00006ad0: 7065 633d 5472 7565 290a 2020 2020 2020  pec=True).      
-00006ae0: 2020 666f 7220 6c61 7965 722c 2070 6f6c    for layer, pol
-00006af0: 7967 6f6e 7320 696e 2061 6c6c 5f70 6f6c  ygons in all_pol
-00006b00: 7967 6f6e 732e 6974 656d 7328 293a 0a20  ygons.items():. 
-00006b10: 2020 2020 2020 2020 2020 2075 6e69 6f6e             union
-00006b20: 6564 5f70 6f6c 7967 6f6e 7320 3d20 5f75  ed_polygons = _u
-00006b30: 6e69 6f6e 5f70 6f6c 7967 6f6e 7328 0a20  nion_polygons(. 
-00006b40: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00006b50: 6f6c 7967 6f6e 732c 2070 7265 6369 7369  olygons, precisi
-00006b60: 6f6e 3d70 7265 6369 7369 6f6e 2c20 6d61  on=precision, ma
-00006b70: 785f 706f 696e 7473 3d6d 6178 5f70 6f69  x_points=max_poi
-00006b80: 6e74 730a 2020 2020 2020 2020 2020 2020  nts.            
-00006b90: 290a 2020 2020 2020 2020 2020 2020 552e  ).            U.
-00006ba0: 6164 645f 706f 6c79 676f 6e28 756e 696f  add_polygon(unio
-00006bb0: 6e65 645f 706f 6c79 676f 6e73 2c20 6c61  ned_polygons, la
-00006bc0: 7965 723d 6c61 7965 7229 0a20 2020 2065  yer=layer).    e
-00006bd0: 6c73 653a 0a20 2020 2020 2020 2061 6c6c  lse:.        all
-00006be0: 5f70 6f6c 7967 6f6e 7320 3d20 442e 6765  _polygons = D.ge
-00006bf0: 745f 706f 6c79 676f 6e73 2862 795f 7370  t_polygons(by_sp
-00006c00: 6563 3d46 616c 7365 290a 2020 2020 2020  ec=False).      
-00006c10: 2020 756e 696f 6e65 645f 706f 6c79 676f    unioned_polygo
-00006c20: 6e73 203d 205f 756e 696f 6e5f 706f 6c79  ns = _union_poly
-00006c30: 676f 6e73 280a 2020 2020 2020 2020 2020  gons(.          
-00006c40: 2020 616c 6c5f 706f 6c79 676f 6e73 2c20    all_polygons, 
-00006c50: 7072 6563 6973 696f 6e3d 7072 6563 6973  precision=precis
-00006c60: 696f 6e2c 206d 6178 5f70 6f69 6e74 733d  ion, max_points=
-00006c70: 6d61 785f 706f 696e 7473 0a20 2020 2020  max_points.     
-00006c80: 2020 2029 0a20 2020 2020 2020 2055 2e61     ).        U.a
-00006c90: 6464 5f70 6f6c 7967 6f6e 2875 6e69 6f6e  dd_polygon(union
-00006ca0: 6564 5f70 6f6c 7967 6f6e 732c 206c 6179  ed_polygons, lay
-00006cb0: 6572 3d6c 6179 6572 290a 2020 2020 7265  er=layer).    re
-00006cc0: 7475 726e 2055 0a0a 0a64 6566 205f 756e  turn U...def _un
-00006cd0: 696f 6e5f 706f 6c79 676f 6e73 2870 6f6c  ion_polygons(pol
-00006ce0: 7967 6f6e 732c 2070 7265 6369 7369 6f6e  ygons, precision
-00006cf0: 3d31 652d 342c 206d 6178 5f70 6f69 6e74  =1e-4, max_point
-00006d00: 733d 3430 3030 293a 0a20 2020 2022 2222  s=4000):.    """
-00006d10: 5065 7266 6f72 6d73 2074 6865 2075 6e69  Performs the uni
-00006d20: 6f6e 206f 6620 616c 6c20 706f 6c79 676f  on of all polygo
-00006d30: 6e73 2077 6974 6869 6e20 6120 506f 6c79  ns within a Poly
-00006d40: 676f 6e53 6574 206f 7220 6c69 7374 206f  gonSet or list o
-00006d50: 660a 2020 2020 706f 6c79 676f 6e73 2e0a  f.    polygons..
-00006d60: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-00006d70: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00006d80: 2020 2070 6f6c 7967 6f6e 7320 3a20 506f     polygons : Po
-00006d90: 6c79 676f 6e53 6574 206f 7220 6c69 7374  lygonSet or list
-00006da0: 206f 6620 706f 6c79 676f 6e73 0a20 2020   of polygons.   
-00006db0: 2020 2020 2041 2073 6574 2063 6f6e 7461       A set conta
-00006dc0: 696e 696e 6720 7468 6520 696e 7075 7420  ining the input 
-00006dd0: 706f 6c79 676f 6e73 2e0a 2020 2020 7072  polygons..    pr
-00006de0: 6563 6973 696f 6e20 3a20 666c 6f61 740a  ecision : float.
-00006df0: 2020 2020 2020 2020 4465 7369 7265 6420          Desired 
-00006e00: 7072 6563 6973 696f 6e20 666f 7220 726f  precision for ro
-00006e10: 756e 6469 6e67 2076 6572 7465 7820 636f  unding vertex co
-00006e20: 6f72 6469 6e61 7465 732e 0a20 2020 206d  ordinates..    m
-00006e30: 6178 5f70 6f69 6e74 7320 3a20 696e 740a  ax_points : int.
-00006e40: 2020 2020 2020 2020 5468 6520 6d61 7869          The maxi
-00006e50: 6d75 6d20 6e75 6d62 6572 206f 6620 7665  mum number of ve
-00006e60: 7274 6963 6573 2077 6974 6869 6e20 7468  rtices within th
-00006e70: 6520 7265 7375 6c74 696e 6720 706f 6c79  e resulting poly
-00006e80: 676f 6e2e 0a0a 2020 2020 5265 7475 726e  gon...    Return
-00006e90: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-00006ea0: 2020 756e 696f 6e65 6420 3a20 706f 6c79    unioned : poly
-00006eb0: 676f 6e0a 2020 2020 2020 2020 5468 6520  gon.        The 
-00006ec0: 7265 7375 6c74 206f 6620 7468 6520 756e  result of the un
-00006ed0: 696f 6e20 6f66 2061 6c6c 2074 6865 2070  ion of all the p
-00006ee0: 6f6c 7967 6f6e 7320 7769 7468 696e 2074  olygons within t
-00006ef0: 6865 2069 6e70 7574 0a20 2020 2020 2020  he input.       
-00006f00: 2050 6f6c 7967 6f6e 5365 742e 0a20 2020   PolygonSet..   
-00006f10: 2022 2222 0a20 2020 2070 6f6c 7967 6f6e   """.    polygon
-00006f20: 7320 3d20 5f6d 6572 6765 5f66 6c6f 6174  s = _merge_float
-00006f30: 696e 675f 706f 696e 745f 6572 726f 7273  ing_point_errors
-00006f40: 2870 6f6c 7967 6f6e 732c 2074 6f6c 3d70  (polygons, tol=p
-00006f50: 7265 6369 7369 6f6e 202f 2031 3030 3029  recision / 1000)
-00006f60: 0a20 2020 2075 6e69 6f6e 6564 203d 2067  .    unioned = g
-00006f70: 6473 7079 2e62 6f6f 6c65 616e 280a 2020  dspy.boolean(.  
-00006f80: 2020 2020 2020 706f 6c79 676f 6e73 2c20        polygons, 
-00006f90: 5b5d 2c20 6f70 6572 6174 696f 6e3d 226f  [], operation="o
-00006fa0: 7222 2c20 7072 6563 6973 696f 6e3d 7072  r", precision=pr
-00006fb0: 6563 6973 696f 6e2c 206d 6178 5f70 6f69  ecision, max_poi
-00006fc0: 6e74 733d 6d61 785f 706f 696e 7473 0a20  nts=max_points. 
-00006fd0: 2020 2029 0a20 2020 2072 6574 7572 6e20     ).    return 
-00006fe0: 756e 696f 6e65 640a 0a0a 6465 6620 5f6d  unioned...def _m
-00006ff0: 6572 6765 5f66 6c6f 6174 696e 675f 706f  erge_floating_po
-00007000: 696e 745f 6572 726f 7273 2870 6f6c 7967  int_errors(polyg
-00007010: 6f6e 732c 2074 6f6c 3d31 652d 3130 293a  ons, tol=1e-10):
-00007020: 0a20 2020 2022 2222 4669 7865 7320 666c  .    """Fixes fl
-00007030: 6f61 7469 6e67 2070 6f69 6e74 2065 7272  oating point err
-00007040: 6f72 7320 696e 2074 6865 2069 6e70 7574  ors in the input
-00007050: 2070 6f6c 7967 6f6e 2873 2920 6279 206d   polygon(s) by m
-00007060: 6572 6769 6e67 2076 616c 7565 730a 2020  erging values.  
-00007070: 2020 7769 7468 696e 2074 6865 2074 6f6c    within the tol
-00007080: 6572 616e 6365 2060 746f 6c60 2e20 5365  erance `tol`. Se
-00007090: 6520 5f6d 6572 6765 5f6e 6561 7262 795f  e _merge_nearby_
-000070a0: 666c 6f61 7469 6e67 5f70 6f69 6e74 7320  floating_points 
-000070b0: 666f 720a 2020 2020 7370 6563 6966 6963  for.    specific
-000070c0: 732e 0a0a 2020 2020 5061 7261 6d65 7465  s...    Paramete
-000070d0: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-000070e0: 2d0a 2020 2020 706f 6c79 676f 6e73 203a  -.    polygons :
-000070f0: 2050 6f6c 7967 6f6e 5365 7420 6f72 206c   PolygonSet or l
-00007100: 6973 7420 6f66 2070 6f6c 7967 6f6e 730a  ist of polygons.
-00007110: 2020 2020 2020 2020 5365 7420 6f66 2070          Set of p
-00007120: 6f6c 7967 6f6e 7320 7769 7468 2066 6c6f  olygons with flo
-00007130: 6174 696e 6720 706f 696e 7420 6572 726f  ating point erro
-00007140: 7273 2e0a 2020 2020 746f 6c20 3a20 666c  rs..    tol : fl
-00007150: 6f61 740a 2020 2020 2020 2020 546f 6c65  oat.        Tole
-00007160: 7261 6e63 6520 7769 7468 696e 2077 6869  rance within whi
-00007170: 6368 2070 6f69 6e74 7320 7769 6c6c 2062  ch points will b
-00007180: 6520 6d65 7267 6564 2e0a 0a20 2020 2052  e merged...    R
-00007190: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
-000071a0: 2d2d 0a20 2020 2070 6f6c 7967 6f6e 735f  --.    polygons_
-000071b0: 6669 7865 6420 3a20 506f 6c79 676f 6e53  fixed : PolygonS
-000071c0: 6574 0a20 2020 2020 2020 2053 6574 206f  et.        Set o
-000071d0: 6620 636f 7272 6563 7465 6420 706f 6c79  f corrected poly
-000071e0: 676f 6e73 2e0a 2020 2020 2222 220a 2020  gons..    """.  
-000071f0: 2020 7374 6163 6b65 645f 706f 6c79 676f    stacked_polygo
-00007200: 6e73 203d 206e 702e 7673 7461 636b 2870  ns = np.vstack(p
-00007210: 6f6c 7967 6f6e 7329 0a20 2020 2078 203d  olygons).    x =
-00007220: 2073 7461 636b 6564 5f70 6f6c 7967 6f6e   stacked_polygon
-00007230: 735b 3a2c 2030 5d0a 2020 2020 7920 3d20  s[:, 0].    y = 
-00007240: 7374 6163 6b65 645f 706f 6c79 676f 6e73  stacked_polygons
-00007250: 5b3a 2c20 315d 0a20 2020 2070 6f6c 7967  [:, 1].    polyg
-00007260: 6f6e 5f69 6e64 6963 6573 203d 206e 702e  on_indices = np.
-00007270: 6375 6d73 756d 285b 6c65 6e28 7029 2066  cumsum([len(p) f
-00007280: 6f72 2070 2069 6e20 706f 6c79 676f 6e73  or p in polygons
-00007290: 5d29 0a0a 2020 2020 7866 6978 6564 203d  ])..    xfixed =
-000072a0: 205f 6d65 7267 655f 6e65 6172 6279 5f66   _merge_nearby_f
-000072b0: 6c6f 6174 696e 675f 706f 696e 7473 2878  loating_points(x
-000072c0: 2c20 746f 6c3d 746f 6c29 0a20 2020 2079  , tol=tol).    y
-000072d0: 6669 7865 6420 3d20 5f6d 6572 6765 5f6e  fixed = _merge_n
-000072e0: 6561 7262 795f 666c 6f61 7469 6e67 5f70  earby_floating_p
-000072f0: 6f69 6e74 7328 792c 2074 6f6c 3d74 6f6c  oints(y, tol=tol
-00007300: 290a 2020 2020 7374 6163 6b65 645f 706f  ).    stacked_po
-00007310: 6c79 676f 6e73 5f66 6978 6564 203d 206e  lygons_fixed = n
-00007320: 702e 7673 7461 636b 285b 7866 6978 6564  p.vstack([xfixed
-00007330: 2c20 7966 6978 6564 5d29 2e54 0a20 2020  , yfixed]).T.   
-00007340: 2070 6f6c 7967 6f6e 735f 6669 7865 6420   polygons_fixed 
-00007350: 3d20 6e70 2e76 7370 6c69 7428 7374 6163  = np.vsplit(stac
-00007360: 6b65 645f 706f 6c79 676f 6e73 5f66 6978  ked_polygons_fix
-00007370: 6564 2c20 706f 6c79 676f 6e5f 696e 6469  ed, polygon_indi
-00007380: 6365 735b 3a2d 315d 290a 2020 2020 7265  ces[:-1]).    re
-00007390: 7475 726e 2070 6f6c 7967 6f6e 735f 6669  turn polygons_fi
-000073a0: 7865 640a 0a0a 6465 6620 5f6d 6572 6765  xed...def _merge
-000073b0: 5f6e 6561 7262 795f 666c 6f61 7469 6e67  _nearby_floating
-000073c0: 5f70 6f69 6e74 7328 782c 2074 6f6c 3d31  _points(x, tol=1
-000073d0: 652d 3130 293a 0a20 2020 2022 2222 5461  e-10):.    """Ta
-000073e0: 6b65 7320 616e 2061 7272 6179 2060 7860  kes an array `x`
-000073f0: 2061 6e64 206d 6572 6765 7320 616e 7920   and merges any 
-00007400: 7661 6c75 6573 2077 6974 6869 6e20 7468  values within th
-00007410: 6520 746f 6c65 7261 6e63 6520 6074 6f6c  e tolerance `tol
-00007420: 602e 0a0a 2020 2020 5061 7261 6d65 7465  `...    Paramete
-00007430: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-00007440: 2d0a 2020 2020 7820 3a20 6c69 7374 206f  -.    x : list o
-00007450: 6620 696e 7420 6f72 2066 6c6f 6174 0a20  f int or float. 
-00007460: 2020 2020 2020 2041 7272 6179 206f 6620         Array of 
-00007470: 7661 6c75 6573 2077 6974 6820 666c 6f61  values with floa
-00007480: 7469 6e67 2070 6f69 6e74 2065 7272 6f72  ting point error
-00007490: 732e 0a20 2020 2074 6f6c 203a 2066 6c6f  s..    tol : flo
-000074a0: 6174 0a20 2020 2020 2020 2054 6f6c 6572  at.        Toler
-000074b0: 616e 6365 2077 6974 6869 6e20 7768 6963  ance within whic
-000074c0: 6820 706f 696e 7473 2077 696c 6c20 6265  h points will be
-000074d0: 206d 6572 6765 642e 0a0a 2020 2020 5265   merged...    Re
-000074e0: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
-000074f0: 2d0a 2020 2020 7873 6f72 7420 3a20 6c69  -.    xsort : li
-00007500: 7374 206f 6620 696e 7420 6f72 2066 6c6f  st of int or flo
-00007510: 6174 0a20 2020 2020 2020 2043 6f72 7265  at.        Corre
-00007520: 6374 6564 2061 6e64 2073 6f72 7465 6420  cted and sorted 
-00007530: 6172 7261 792e 0a0a 2020 2020 4578 616d  array...    Exam
-00007540: 706c 6573 0a20 2020 202d 2d2d 2d2d 2d2d  ples.    -------
-00007550: 2d0a 2020 2020 4966 2067 6976 656e 3a0a  -.    If given:.
-00007560: 2020 2020 3e3e 3e20 7820 3d20 5b2d 322c      >>> x = [-2,
-00007570: 202d 312c 2030 2c20 312e 3030 3031 2c20   -1, 0, 1.0001, 
-00007580: 312e 3030 3032 2c20 312e 3030 3033 2c20  1.0002, 1.0003, 
-00007590: 342c 2035 2c20 352e 3030 332c 2036 2c20  4, 5, 5.003, 6, 
-000075a0: 372c 2038 5d0a 2020 2020 3e3e 3e20 5f6d  7, 8].    >>> _m
-000075b0: 6572 6765 5f6e 6561 7262 795f 666c 6f61  erge_nearby_floa
-000075c0: 7469 6e67 5f70 6f69 6e74 7328 782c 2074  ting_points(x, t
-000075d0: 6f6c 203d 2031 652d 3329 0a20 2020 2057  ol = 1e-3).    W
-000075e0: 696c 6c20 7265 7475 726e 3a0a 2020 2020  ill return:.    
-000075f0: 3e3e 3e20 5b2d 322c 202d 312c 2030 2c20  >>> [-2, -1, 0, 
-00007600: 312e 3030 3031 2c20 312e 3030 3031 2c20  1.0001, 1.0001, 
-00007610: 312e 3030 3031 2c20 342c 2035 2c20 352e  1.0001, 4, 5, 5.
-00007620: 3030 332c 2036 2c20 372c 2038 5d2e 0a20  003, 6, 7, 8].. 
-00007630: 2020 2022 2222 0a20 2020 2078 6172 6773     """.    xargs
-00007640: 6f72 7420 3d20 6e70 2e61 7267 736f 7274  ort = np.argsort
-00007650: 2878 290a 2020 2020 7861 7267 756e 736f  (x).    xargunso
-00007660: 7274 203d 206e 702e 6172 6773 6f72 7428  rt = np.argsort(
-00007670: 7861 7267 736f 7274 290a 2020 2020 7873  xargsort).    xs
-00007680: 6f72 7420 3d20 785b 7861 7267 736f 7274  ort = x[xargsort
-00007690: 5d0a 2020 2020 7873 6f72 7474 6872 6573  ].    xsortthres
-000076a0: 686f 6c64 203d 206e 702e 6469 6666 2878  hold = np.diff(x
-000076b0: 736f 7274 2920 3c20 746f 6c0a 2020 2020  sort) < tol.    
-000076c0: 7873 6f72 7474 6872 6573 686f 6c64 696e  xsortthresholdin
-000076d0: 6420 3d20 6e70 2e61 7267 7768 6572 6528  d = np.argwhere(
-000076e0: 7873 6f72 7474 6872 6573 686f 6c64 290a  xsortthreshold).
-000076f0: 0a20 2020 2023 204d 6572 6765 206e 6561  .    # Merge nea
-00007700: 7262 7920 666c 6f61 7469 6e67 2070 6f69  rby floating poi
-00007710: 6e74 2076 616c 7565 730a 2020 2020 666f  nt values.    fo
-00007720: 7220 7869 2069 6e20 7873 6f72 7474 6872  r xi in xsortthr
-00007730: 6573 686f 6c64 696e 643a 0a20 2020 2020  esholdind:.     
-00007740: 2020 2078 736f 7274 5b78 6920 2b20 315d     xsort[xi + 1]
-00007750: 203d 2078 736f 7274 5b78 695d 0a20 2020   = xsort[xi].   
-00007760: 2072 6574 7572 6e20 7873 6f72 745b 7861   return xsort[xa
-00007770: 7267 756e 736f 7274 5d0a 0a0a 6465 6620  rgunsort]...def 
-00007780: 5f63 726f 705f 7265 6769 6f6e 2870 6f6c  _crop_region(pol
-00007790: 7967 6f6e 732c 206c 6566 742c 2062 6f74  ygons, left, bot
-000077a0: 746f 6d2c 2072 6967 6874 2c20 746f 702c  tom, right, top,
-000077b0: 2070 7265 6369 7369 6f6e 293a 0a20 2020   precision):.   
-000077c0: 2022 2222 4769 7665 6e20 6120 7265 6374   """Given a rect
-000077d0: 616e 6775 6c61 7220 626f 756e 6461 7279  angular boundary
-000077e0: 2064 6566 696e 6564 2062 7920 6c65 6674   defined by left
-000077f0: 2f62 6f74 746f 6d2f 7269 6768 742f 746f  /bottom/right/to
-00007800: 702c 2074 6869 730a 2020 2020 7461 6b65  p, this.    take
-00007810: 7320 6120 6c69 7374 206f 6620 706f 6c79  s a list of poly
-00007820: 676f 6e73 2061 6e64 2063 7574 7320 7468  gons and cuts th
-00007830: 656d 2061 7420 7468 6520 626f 756e 6461  em at the bounda
-00007840: 7279 2c20 6469 7363 6172 6469 6e67 2070  ry, discarding p
-00007850: 6172 7473 0a20 2020 206f 6620 7468 6520  arts.    of the 
-00007860: 706f 6c79 676f 6e73 206f 7574 7369 6465  polygons outside
-00007870: 2074 6865 2072 6563 7461 6e67 6c65 2e0a   the rectangle..
-00007880: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-00007890: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-000078a0: 2020 2070 6f6c 7967 6f6e 7320 3a20 506f     polygons : Po
-000078b0: 6c79 676f 6e53 6574 206f 7220 6c69 7374  lygonSet or list
-000078c0: 206f 6620 706f 6c79 676f 6e73 0a20 2020   of polygons.   
-000078d0: 2020 2020 2053 6574 206f 7220 6c69 7374       Set or list
-000078e0: 206f 6620 706f 6c79 676f 6e73 2074 6f20   of polygons to 
-000078f0: 6265 2063 726f 7070 6564 2e0a 2020 2020  be cropped..    
-00007900: 6c65 6674 203a 2069 6e74 206f 7220 666c  left : int or fl
-00007910: 6f61 740a 2020 2020 2020 2020 5468 6520  oat.        The 
-00007920: 782d 636f 6f72 6469 6e61 7465 206f 6620  x-coordinate of 
-00007930: 7468 6520 6c65 6674 6861 6e64 2062 6f75  the lefthand bou
-00007940: 6e64 6172 792e 0a20 2020 2062 6f74 746f  ndary..    botto
-00007950: 6d20 3a20 696e 7420 6f72 2066 6c6f 6174  m : int or float
-00007960: 0a20 2020 2020 2020 2054 6865 2079 2d63  .        The y-c
-00007970: 6f6f 7264 696e 6174 6520 6f66 2074 6865  oordinate of the
-00007980: 2062 6f74 746f 6d20 626f 756e 6461 7279   bottom boundary
-00007990: 2e0a 2020 2020 7269 6768 7420 3a20 696e  ..    right : in
-000079a0: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
-000079b0: 2020 2054 6865 2078 2d63 6f6f 7264 696e     The x-coordin
-000079c0: 6174 6520 6f66 2074 6865 2072 6967 6874  ate of the right
-000079d0: 6861 6e64 2062 6f75 6e64 6172 792e 0a20  hand boundary.. 
-000079e0: 2020 2074 6f70 203a 2069 6e74 206f 7220     top : int or 
-000079f0: 666c 6f61 740a 2020 2020 2020 2020 5468  float.        Th
-00007a00: 6520 792d 636f 6f72 6469 6e61 7465 206f  e y-coordinate o
-00007a10: 6620 7468 6520 746f 7020 626f 756e 6461  f the top bounda
-00007a20: 7279 2e0a 2020 2020 7072 6563 6973 696f  ry..    precisio
-00007a30: 6e20 3a20 666c 6f61 740a 2020 2020 2020  n : float.      
-00007a40: 2020 4465 7369 7265 6420 7072 6563 6973    Desired precis
-00007a50: 696f 6e20 666f 7220 726f 756e 6469 6e67  ion for rounding
-00007a60: 2076 6572 7465 7820 636f 6f72 6469 6e61   vertex coordina
-00007a70: 7465 732e 0a0a 2020 2020 5265 7475 726e  tes...    Return
-00007a80: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-00007a90: 2020 6372 6f70 7065 645f 706f 6c79 676f    cropped_polygo
-00007aa0: 6e73 203a 2050 6f6c 7967 6f6e 5365 7420  ns : PolygonSet 
-00007ab0: 6f72 206c 6973 7420 6f66 2070 6f6c 7967  or list of polyg
-00007ac0: 6f6e 730a 2020 2020 2020 2020 5365 7420  ons.        Set 
-00007ad0: 6f72 206c 6973 7420 6f66 2070 6f6c 7967  or list of polyg
-00007ae0: 6f6e 7320 7468 6174 2061 7265 2063 726f  ons that are cro
-00007af0: 7070 6564 2061 6363 6f72 6469 6e67 2074  pped according t
-00007b00: 6f20 7468 6520 7370 6563 6966 6965 640a  o the specified.
-00007b10: 2020 2020 2020 2020 626f 756e 6461 7279          boundary
-00007b20: 2e0a 2020 2020 2222 220a 2020 2020 6372  ..    """.    cr
-00007b30: 6f70 7065 645f 706f 6c79 676f 6e73 203d  opped_polygons =
-00007b40: 205b 5d0a 2020 2020 666f 7220 7020 696e   [].    for p in
-00007b50: 2070 6f6c 7967 6f6e 733a 0a20 2020 2020   polygons:.     
-00007b60: 2020 2063 6c69 7070 6564 5f70 6f6c 7973     clipped_polys
-00007b70: 203d 2063 6c69 7070 6572 2e5f 6368 6f70   = clipper._chop
-00007b80: 2870 2c20 5b74 6f70 2c20 626f 7474 6f6d  (p, [top, bottom
-00007b90: 5d2c 2031 2c20 3120 2f20 7072 6563 6973  ], 1, 1 / precis
-00007ba0: 696f 6e29 0a20 2020 2020 2020 2023 2070  ion).        # p
-00007bb0: 6f6c 7967 6f6e 2c20 5b63 7574 735d 2c20  olygon, [cuts], 
-00007bc0: 6178 6973 2c20 7363 616c 650a 2020 2020  axis, scale.    
-00007bd0: 2020 2020 666f 7220 6370 2069 6e20 636c      for cp in cl
-00007be0: 6970 7065 645f 706f 6c79 735b 315d 3a0a  ipped_polys[1]:.
-00007bf0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00007c00: 6c74 203d 2063 6c69 7070 6572 2e5f 6368  lt = clipper._ch
-00007c10: 6f70 2863 702c 205b 6c65 6674 2c20 7269  op(cp, [left, ri
-00007c20: 6768 745d 2c20 302c 2031 202f 2070 7265  ght], 0, 1 / pre
-00007c30: 6369 7369 6f6e 290a 2020 2020 2020 2020  cision).        
-00007c40: 2020 2020 6372 6f70 7065 645f 706f 6c79      cropped_poly
-00007c50: 676f 6e73 202b 3d20 6c69 7374 2872 6573  gons += list(res
-00007c60: 756c 745b 315d 290a 2020 2020 7265 7475  ult[1]).    retu
-00007c70: 726e 2063 726f 7070 6564 5f70 6f6c 7967  rn cropped_polyg
-00007c80: 6f6e 730a 0a0a 6465 6620 5f63 726f 705f  ons...def _crop_
-00007c90: 6564 6765 5f70 6f6c 7967 6f6e 7328 616c  edge_polygons(al
-00007ca0: 6c5f 706f 6c79 676f 6e73 2c20 6262 6f78  l_polygons, bbox
-00007cb0: 6573 2c20 6c65 6674 2c20 626f 7474 6f6d  es, left, bottom
-00007cc0: 2c20 7269 6768 742c 2074 6f70 2c20 7072  , right, top, pr
-00007cd0: 6563 6973 696f 6e29 3a0a 2020 2020 2222  ecision):.    ""
-00007ce0: 2250 6172 7365 7320 6f75 7420 7768 6963  "Parses out whic
-00007cf0: 6820 706f 6c79 676f 6e73 2061 7265 2061  h polygons are a
-00007d00: 6c6f 6e67 2074 6865 2065 6467 6520 6f66  long the edge of
-00007d10: 2074 6865 2072 6563 7461 6e67 6c65 2061   the rectangle a
-00007d20: 6e64 206e 6565 640a 2020 2020 746f 2062  nd need.    to b
-00007d30: 6520 6372 6f70 7065 6420 616e 6420 7768  e cropped and wh
-00007d40: 6963 6820 6172 6520 6465 6570 2069 6e73  ich are deep ins
-00007d50: 6964 6520 7468 6520 7265 6374 616e 676c  ide the rectangl
-00007d60: 6520 7265 6769 6f6e 2061 6e64 2063 616e  e region and can
-00007d70: 2062 650a 2020 2020 6c65 6674 2061 6c6f   be.    left alo
-00007d80: 6e65 2c20 7468 656e 2063 726f 7073 206f  ne, then crops o
-00007d90: 6e6c 7920 7468 6f73 6520 706f 6c79 676f  nly those polygo
-00007da0: 6e73 2061 6c6f 6e67 2074 6865 2065 6467  ns along the edg
-00007db0: 652e 0a0a 2020 2020 5061 7261 6d65 7465  e...    Paramete
-00007dc0: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-00007dd0: 2d0a 2020 2020 616c 6c5f 706f 6c79 676f  -.    all_polygo
-00007de0: 6e73 203a 2050 6f6c 7967 6f6e 5365 7420  ns : PolygonSet 
-00007df0: 6f72 206c 6973 7420 6f66 2070 6f6c 7967  or list of polyg
-00007e00: 6f6e 730a 2020 2020 2020 2020 5365 7420  ons.        Set 
-00007e10: 6f72 206c 6973 7420 6f66 2070 6f6c 7967  or list of polyg
-00007e20: 6f6e 7320 746f 2062 6520 6372 6f70 7065  ons to be croppe
-00007e30: 642e 0a20 2020 2062 626f 7865 7320 3a20  d..    bboxes : 
-00007e40: 6c69 7374 0a20 2020 2020 2020 204c 6973  list.        Lis
-00007e50: 7420 6f66 2061 6c6c 2070 6f6c 7967 6f6e  t of all polygon
-00007e60: 2062 626f 7865 7320 696e 2061 6c6c 5f70   bboxes in all_p
-00007e70: 6f6c 7967 6f6e 732e 0a20 2020 206c 6566  olygons..    lef
-00007e80: 7420 3a20 696e 7420 6f72 2066 6c6f 6174  t : int or float
-00007e90: 0a20 2020 2020 2020 2054 6865 2078 2d63  .        The x-c
-00007ea0: 6f6f 7264 696e 6174 6520 6f66 2074 6865  oordinate of the
-00007eb0: 206c 6566 7468 616e 6420 626f 756e 6461   lefthand bounda
-00007ec0: 7279 2e0a 2020 2020 626f 7474 6f6d 203a  ry..    bottom :
-00007ed0: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
-00007ee0: 2020 2020 2020 5468 6520 792d 636f 6f72        The y-coor
-00007ef0: 6469 6e61 7465 206f 6620 7468 6520 626f  dinate of the bo
-00007f00: 7474 6f6d 2062 6f75 6e64 6172 792e 0a20  ttom boundary.. 
-00007f10: 2020 2072 6967 6874 203a 2069 6e74 206f     right : int o
-00007f20: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
-00007f30: 5468 6520 782d 636f 6f72 6469 6e61 7465  The x-coordinate
-00007f40: 206f 6620 7468 6520 7269 6768 7468 616e   of the righthan
-00007f50: 6420 626f 756e 6461 7279 2e0a 2020 2020  d boundary..    
-00007f60: 746f 7020 3a20 696e 7420 6f72 2066 6c6f  top : int or flo
-00007f70: 6174 0a20 2020 2020 2020 2054 6865 2079  at.        The y
-00007f80: 2d63 6f6f 7264 696e 6174 6520 6f66 2074  -coordinate of t
-00007f90: 6865 2074 6f70 2062 6f75 6e64 6172 792e  he top boundary.
-00007fa0: 0a20 2020 2070 7265 6369 7369 6f6e 203a  .    precision :
-00007fb0: 2066 6c6f 6174 0a20 2020 2020 2020 2044   float.        D
-00007fc0: 6573 6972 6564 2070 7265 6369 7369 6f6e  esired precision
-00007fd0: 2066 6f72 2072 6f75 6e64 696e 6720 7665   for rounding ve
-00007fe0: 7274 6578 2063 6f6f 7264 696e 6174 6573  rtex coordinates
-00007ff0: 2e0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
-00008000: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2070     -------.    p
-00008010: 6f6c 7967 6f6e 735f 746f 5f70 726f 6365  olygons_to_proce
-00008020: 7373 203a 2050 6f6c 7967 6f6e 5365 7420  ss : PolygonSet 
-00008030: 6f72 206c 6973 7420 6f66 2070 6f6c 7967  or list of polyg
-00008040: 6f6e 730a 2020 2020 2020 2020 5365 7420  ons.        Set 
-00008050: 6f72 206c 6973 7420 6f66 2070 6f6c 7967  or list of polyg
-00008060: 6f6e 7320 7769 7468 2063 726f 7020 6170  ons with crop ap
-00008070: 706c 6965 6420 746f 2065 6467 6520 706f  plied to edge po
-00008080: 6c79 676f 6e73 2e0a 2020 2020 2222 220a  lygons..    """.
-00008090: 2020 2020 706f 6c79 676f 6e73 5f69 6e5f      polygons_in_
-000080a0: 7265 6374 5f69 203d 205f 6669 6e64 5f62  rect_i = _find_b
-000080b0: 626f 7865 735f 696e 5f72 6563 7428 6262  boxes_in_rect(bb
-000080c0: 6f78 6573 2c20 6c65 6674 2c20 626f 7474  oxes, left, bott
-000080d0: 6f6d 2c20 7269 6768 742c 2074 6f70 290a  om, right, top).
-000080e0: 2020 2020 706f 6c79 676f 6e73 5f65 6467      polygons_edg
-000080f0: 655f 6920 3d20 5f66 696e 645f 6262 6f78  e_i = _find_bbox
-00008100: 6573 5f6f 6e5f 7265 6374 5f65 6467 6528  es_on_rect_edge(
-00008110: 6262 6f78 6573 2c20 6c65 6674 2c20 626f  bboxes, left, bo
-00008120: 7474 6f6d 2c20 7269 6768 742c 2074 6f70  ttom, right, top
-00008130: 290a 2020 2020 706f 6c79 676f 6e73 5f69  ).    polygons_i
-00008140: 6e5f 7265 6374 5f6e 6f5f 6564 6765 5f69  n_rect_no_edge_i
-00008150: 203d 2070 6f6c 7967 6f6e 735f 696e 5f72   = polygons_in_r
-00008160: 6563 745f 6920 2620 287e 706f 6c79 676f  ect_i & (~polygo
-00008170: 6e73 5f65 6467 655f 6929 0a0a 2020 2020  ns_edge_i)..    
-00008180: 2320 4372 6f70 2070 6f6c 7967 6f6e 7320  # Crop polygons 
-00008190: 616c 6f6e 6720 7468 6520 6564 6765 2061  along the edge a
-000081a0: 6e64 2072 6563 6f6d 6269 6e65 2074 6865  nd recombine the
-000081b0: 6d20 7769 7468 2070 6f6c 7967 6f6e 7320  m with polygons 
-000081c0: 696e 7369 6465 2074 6865 0a20 2020 2023  inside the.    #
-000081d0: 2072 6563 7461 6e67 6c65 0a20 2020 2070   rectangle.    p
-000081e0: 6f6c 7967 6f6e 735f 6564 6765 203d 2061  olygons_edge = a
-000081f0: 6c6c 5f70 6f6c 7967 6f6e 735b 706f 6c79  ll_polygons[poly
-00008200: 676f 6e73 5f65 6467 655f 695d 0a20 2020  gons_edge_i].   
-00008210: 2070 6f6c 7967 6f6e 735f 696e 5f72 6563   polygons_in_rec
-00008220: 745f 6e6f 5f65 6467 6520 3d20 616c 6c5f  t_no_edge = all_
-00008230: 706f 6c79 676f 6e73 5b70 6f6c 7967 6f6e  polygons[polygon
-00008240: 735f 696e 5f72 6563 745f 6e6f 5f65 6467  s_in_rect_no_edg
-00008250: 655f 695d 2e74 6f6c 6973 7428 290a 2020  e_i].tolist().  
-00008260: 2020 706f 6c79 676f 6e73 5f65 6467 655f    polygons_edge_
-00008270: 6372 6f70 7065 6420 3d20 5f63 726f 705f  cropped = _crop_
-00008280: 7265 6769 6f6e 280a 2020 2020 2020 2020  region(.        
-00008290: 706f 6c79 676f 6e73 5f65 6467 652c 206c  polygons_edge, l
-000082a0: 6566 742c 2062 6f74 746f 6d2c 2072 6967  eft, bottom, rig
-000082b0: 6874 2c20 746f 702c 2070 7265 6369 7369  ht, top, precisi
-000082c0: 6f6e 3d70 7265 6369 7369 6f6e 0a20 2020  on=precision.   
-000082d0: 2029 0a20 2020 2070 6f6c 7967 6f6e 735f   ).    polygons_
-000082e0: 746f 5f70 726f 6365 7373 203d 2070 6f6c  to_process = pol
-000082f0: 7967 6f6e 735f 696e 5f72 6563 745f 6e6f  ygons_in_rect_no
-00008300: 5f65 6467 6520 2b20 706f 6c79 676f 6e73  _edge + polygons
-00008310: 5f65 6467 655f 6372 6f70 7065 640a 0a20  _edge_cropped.. 
-00008320: 2020 2072 6574 7572 6e20 706f 6c79 676f     return polygo
-00008330: 6e73 5f74 6f5f 7072 6f63 6573 730a 0a0a  ns_to_process...
-00008340: 6465 6620 5f66 696e 645f 6262 6f78 6573  def _find_bboxes
-00008350: 5f69 6e5f 7265 6374 2862 626f 7865 732c  _in_rect(bboxes,
-00008360: 206c 6566 742c 2062 6f74 746f 6d2c 2072   left, bottom, r
-00008370: 6967 6874 2c20 746f 7029 3a0a 2020 2020  ight, top):.    
-00008380: 2222 2247 6976 656e 2061 206c 6973 7420  """Given a list 
-00008390: 6f66 2070 6f6c 7967 6f6e 2062 6f75 6e64  of polygon bound
-000083a0: 696e 6720 626f 7865 7320 616e 6420 6120  ing boxes and a 
-000083b0: 7265 6374 616e 676c 6520 6465 6669 6e65  rectangle define
-000083c0: 6420 6279 0a20 2020 206c 6566 742f 626f  d by.    left/bo
-000083d0: 7474 6f6d 2f72 6967 6874 2f74 6f70 2c20  ttom/right/top, 
-000083e0: 7468 6973 2066 756e 6374 696f 6e20 7265  this function re
-000083f0: 7475 726e 7320 7468 6f73 6520 706f 6c79  turns those poly
-00008400: 676f 6e73 2077 6869 6368 206f 7665 726c  gons which overl
-00008410: 6170 0a20 2020 2074 6865 2072 6563 7461  ap.    the recta
-00008420: 6e67 6c65 2e0a 0a20 2020 2050 6172 616d  ngle...    Param
-00008430: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
-00008440: 2d2d 2d2d 0a20 2020 2062 626f 7865 7320  ----.    bboxes 
-00008450: 3a20 6c69 7374 0a20 2020 2020 2020 204c  : list.        L
-00008460: 6973 7420 6f66 2061 6c6c 2070 6f6c 7967  ist of all polyg
-00008470: 6f6e 2062 626f 7865 732e 0a20 2020 206c  on bboxes..    l
-00008480: 6566 7420 3a20 696e 7420 6f72 2066 6c6f  eft : int or flo
-00008490: 6174 0a20 2020 2020 2020 2054 6865 2078  at.        The x
-000084a0: 2d63 6f6f 7264 696e 6174 6520 6f66 2074  -coordinate of t
-000084b0: 6865 206c 6566 7468 616e 6420 626f 756e  he lefthand boun
-000084c0: 6461 7279 2e0a 2020 2020 626f 7474 6f6d  dary..    bottom
-000084d0: 203a 2069 6e74 206f 7220 666c 6f61 740a   : int or float.
-000084e0: 2020 2020 2020 2020 5468 6520 792d 636f          The y-co
-000084f0: 6f72 6469 6e61 7465 206f 6620 7468 6520  ordinate of the 
-00008500: 626f 7474 6f6d 2062 6f75 6e64 6172 792e  bottom boundary.
-00008510: 0a20 2020 2072 6967 6874 203a 2069 6e74  .    right : int
-00008520: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
-00008530: 2020 5468 6520 782d 636f 6f72 6469 6e61    The x-coordina
-00008540: 7465 206f 6620 7468 6520 7269 6768 7468  te of the righth
-00008550: 616e 6420 626f 756e 6461 7279 2e0a 2020  and boundary..  
-00008560: 2020 746f 7020 3a20 696e 7420 6f72 2066    top : int or f
-00008570: 6c6f 6174 0a20 2020 2020 2020 2054 6865  loat.        The
-00008580: 2079 2d63 6f6f 7264 696e 6174 6520 6f66   y-coordinate of
-00008590: 2074 6865 2074 6f70 2062 6f75 6e64 6172   the top boundar
-000085a0: 792e 0a0a 2020 2020 5265 7475 726e 730a  y...    Returns.
-000085b0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-000085c0: 7265 7375 6c74 203a 206c 6973 740a 2020  result : list.  
-000085d0: 2020 2020 2020 4c69 7374 206f 6620 616c        List of al
-000085e0: 6c20 706f 6c79 676f 6e20 6262 6f78 6573  l polygon bboxes
-000085f0: 2074 6861 7420 6f76 6572 6c61 7020 7769   that overlap wi
-00008600: 7468 2074 6865 2064 6566 696e 6564 2072  th the defined r
-00008610: 6563 7461 6e67 6c65 2e0a 2020 2020 2222  ectangle..    ""
-00008620: 220a 2020 2020 7265 7375 6c74 203d 2028  ".    result = (
-00008630: 0a20 2020 2020 2020 2028 6262 6f78 6573  .        (bboxes
-00008640: 5b3a 2c20 305d 203c 3d20 7269 6768 7429  [:, 0] <= right)
-00008650: 0a20 2020 2020 2020 2026 2028 6262 6f78  .        & (bbox
-00008660: 6573 5b3a 2c20 325d 203e 3d20 6c65 6674  es[:, 2] >= left
-00008670: 290a 2020 2020 2020 2020 2620 2862 626f  ).        & (bbo
-00008680: 7865 735b 3a2c 2031 5d20 3c3d 2074 6f70  xes[:, 1] <= top
-00008690: 290a 2020 2020 2020 2020 2620 2862 626f  ).        & (bbo
-000086a0: 7865 735b 3a2c 2033 5d20 3e3d 2062 6f74  xes[:, 3] >= bot
-000086b0: 746f 6d29 0a20 2020 2029 0a20 2020 2072  tom).    ).    r
-000086c0: 6574 7572 6e20 7265 7375 6c74 0a0a 0a23  eturn result...#
-000086d0: 205f 6669 6e64 5f62 626f 7865 735f 6f6e   _find_bboxes_on
-000086e0: 5f72 6563 745f 6564 6765 0a64 6566 205f  _rect_edge.def _
-000086f0: 6669 6e64 5f62 626f 7865 735f 6f6e 5f72  find_bboxes_on_r
-00008700: 6563 745f 6564 6765 2862 626f 7865 732c  ect_edge(bboxes,
-00008710: 206c 6566 742c 2062 6f74 746f 6d2c 2072   left, bottom, r
-00008720: 6967 6874 2c20 746f 7029 3a0a 2020 2020  ight, top):.    
-00008730: 2222 2247 6976 656e 2061 206c 6973 7420  """Given a list 
-00008740: 6f66 2070 6f6c 7967 6f6e 2062 6f75 6e64  of polygon bound
-00008750: 696e 6720 626f 7865 7320 616e 6420 6120  ing boxes and a 
-00008760: 7265 6374 616e 6775 6c61 7220 626f 756e  rectangular boun
-00008770: 6461 7279 0a20 2020 2064 6566 696e 6564  dary.    defined
-00008780: 2062 7920 6c65 6674 2f62 6f74 746f 6d2f   by left/bottom/
-00008790: 7269 6768 742f 746f 702c 2074 6869 7320  right/top, this 
-000087a0: 6675 6e63 7469 6f6e 2072 6574 7572 6e73  function returns
-000087b0: 2074 686f 7365 2070 6f6c 7967 6f6e 730a   those polygons.
-000087c0: 2020 2020 7768 6963 6820 696e 7465 7273      which inters
-000087d0: 6563 7420 7468 6520 7265 6374 616e 6775  ect the rectangu
-000087e0: 6c61 7220 626f 756e 6461 7279 2e0a 0a20  lar boundary... 
-000087f0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00008800: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-00008810: 2062 626f 7865 7320 3a20 6c69 7374 0a20   bboxes : list. 
-00008820: 2020 2020 2020 204c 6973 7420 6f66 2061         List of a
-00008830: 6c6c 2070 6f6c 7967 6f6e 2062 626f 7865  ll polygon bboxe
-00008840: 732e 0a20 2020 206c 6566 7420 3a20 696e  s..    left : in
-00008850: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
-00008860: 2020 2054 6865 2078 2d63 6f6f 7264 696e     The x-coordin
-00008870: 6174 6520 6f66 2074 6865 206c 6566 7468  ate of the lefth
-00008880: 616e 6420 626f 756e 6461 7279 2e0a 2020  and boundary..  
-00008890: 2020 626f 7474 6f6d 203a 2069 6e74 206f    bottom : int o
-000088a0: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
-000088b0: 5468 6520 792d 636f 6f72 6469 6e61 7465  The y-coordinate
-000088c0: 206f 6620 7468 6520 626f 7474 6f6d 2062   of the bottom b
-000088d0: 6f75 6e64 6172 792e 0a20 2020 2072 6967  oundary..    rig
-000088e0: 6874 203a 2069 6e74 206f 7220 666c 6f61  ht : int or floa
-000088f0: 740a 2020 2020 2020 2020 5468 6520 782d  t.        The x-
-00008900: 636f 6f72 6469 6e61 7465 206f 6620 7468  coordinate of th
-00008910: 6520 7269 6768 7468 616e 6420 626f 756e  e righthand boun
-00008920: 6461 7279 2e0a 2020 2020 746f 7020 3a20  dary..    top : 
-00008930: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
-00008940: 2020 2020 2054 6865 2079 2d63 6f6f 7264       The y-coord
-00008950: 696e 6174 6520 6f66 2074 6865 2074 6f70  inate of the top
-00008960: 2062 6f75 6e64 6172 792e 0a0a 2020 2020   boundary...    
-00008970: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
-00008980: 2d2d 2d0a 2020 2020 7265 7375 6c74 203a  ---.    result :
-00008990: 206c 6973 740a 2020 2020 2020 2020 4c69   list.        Li
-000089a0: 7374 206f 6620 616c 6c20 706f 6c79 676f  st of all polygo
-000089b0: 6e20 6262 6f78 6573 2074 6861 7420 696e  n bboxes that in
-000089c0: 7465 7273 6563 7420 7468 6520 6465 6669  tersect the defi
-000089d0: 6e65 6420 7265 6374 616e 6775 6c61 720a  ned rectangular.
-000089e0: 2020 2020 2020 2020 626f 756e 6461 7279          boundary
-000089f0: 2e0a 2020 2020 2222 220a 2020 2020 6262  ..    """.    bb
-00008a00: 6f78 6573 5f6c 6566 7420 3d20 5f66 696e  oxes_left = _fin
-00008a10: 645f 6262 6f78 6573 5f69 6e5f 7265 6374  d_bboxes_in_rect
-00008a20: 2862 626f 7865 732c 206c 6566 742c 2062  (bboxes, left, b
-00008a30: 6f74 746f 6d2c 206c 6566 742c 2074 6f70  ottom, left, top
-00008a40: 290a 2020 2020 6262 6f78 6573 5f72 6967  ).    bboxes_rig
-00008a50: 6874 203d 205f 6669 6e64 5f62 626f 7865  ht = _find_bboxe
-00008a60: 735f 696e 5f72 6563 7428 6262 6f78 6573  s_in_rect(bboxes
-00008a70: 2c20 7269 6768 742c 2062 6f74 746f 6d2c  , right, bottom,
-00008a80: 2072 6967 6874 2c20 746f 7029 0a20 2020   right, top).   
-00008a90: 2062 626f 7865 735f 746f 7020 3d20 5f66   bboxes_top = _f
-00008aa0: 696e 645f 6262 6f78 6573 5f69 6e5f 7265  ind_bboxes_in_re
-00008ab0: 6374 2862 626f 7865 732c 206c 6566 742c  ct(bboxes, left,
-00008ac0: 2074 6f70 2c20 7269 6768 742c 2074 6f70   top, right, top
-00008ad0: 290a 2020 2020 6262 6f78 6573 5f62 6f74  ).    bboxes_bot
-00008ae0: 746f 6d20 3d20 5f66 696e 645f 6262 6f78  tom = _find_bbox
-00008af0: 6573 5f69 6e5f 7265 6374 2862 626f 7865  es_in_rect(bboxe
-00008b00: 732c 206c 6566 742c 2062 6f74 746f 6d2c  s, left, bottom,
-00008b10: 2072 6967 6874 2c20 626f 7474 6f6d 290a   right, bottom).
-00008b20: 2020 2020 7265 7375 6c74 203d 2062 626f      result = bbo
-00008b30: 7865 735f 6c65 6674 207c 2062 626f 7865  xes_left | bboxe
-00008b40: 735f 7269 6768 7420 7c20 6262 6f78 6573  s_right | bboxes
-00008b50: 5f74 6f70 207c 2062 626f 7865 735f 626f  _top | bboxes_bo
-00008b60: 7474 6f6d 0a20 2020 2072 6574 7572 6e20  ttom.    return 
-00008b70: 7265 7375 6c74 0a0a 0a64 6566 205f 6f66  result...def _of
-00008b80: 6673 6574 5f72 6567 696f 6e28 0a20 2020  fset_region(.   
-00008b90: 2061 6c6c 5f70 6f6c 7967 6f6e 732c 0a20   all_polygons,. 
-00008ba0: 2020 2062 626f 7865 732c 0a20 2020 206c     bboxes,.    l
-00008bb0: 6566 742c 0a20 2020 2062 6f74 746f 6d2c  eft,.    bottom,
-00008bc0: 0a20 2020 2072 6967 6874 2c0a 2020 2020  .    right,.    
-00008bd0: 746f 702c 0a20 2020 2064 6973 7461 6e63  top,.    distanc
-00008be0: 653d 352c 0a20 2020 206a 6f69 6e5f 6669  e=5,.    join_fi
-00008bf0: 7273 743d 5472 7565 2c0a 2020 2020 7072  rst=True,.    pr
-00008c00: 6563 6973 696f 6e3d 3165 2d34 2c0a 2020  ecision=1e-4,.  
-00008c10: 2020 6a6f 696e 3d22 6d69 7465 7222 2c0a    join="miter",.
-00008c20: 2020 2020 746f 6c65 7261 6e63 653d 322c      tolerance=2,
-00008c30: 0a29 3a0a 2020 2020 2222 2254 616b 696e  .):.    """Takin
-00008c40: 6720 6120 7265 6769 6f6e 206f 6620 652e  g a region of e.
-00008c50: 672e 2073 697a 6520 2878 2c20 7929 2077  g. size (x, y) w
-00008c60: 6869 6368 206e 6565 6473 2074 6f20 6265  hich needs to be
-00008c70: 206f 6666 7365 7420 6279 0a20 2020 2064   offset by.    d
-00008c80: 6973 7461 6e63 6520 642c 2074 6869 7320  istance d, this 
-00008c90: 6675 6e63 7469 6f6e 2063 726f 7073 206f  function crops o
-00008ca0: 7574 2061 2072 6567 696f 6e20 2878 2b32  ut a region (x+2
-00008cb0: 2a64 2c20 792b 322a 6429 206c 6172 6765  *d, y+2*d) large
-00008cc0: 2c20 6f66 6673 6574 730a 2020 2020 7468  , offsets.    th
-00008cd0: 6174 2072 6567 696f 6e2c 2074 6865 6e20  at region, then 
-00008ce0: 6372 6f70 7320 6974 2062 6163 6b20 746f  crops it back to
-00008cf0: 2073 697a 6520 2878 2c20 7929 2074 6f20   size (x, y) to 
-00008d00: 6372 6561 7465 2061 2076 616c 6964 2072  create a valid r
-00008d10: 6573 756c 742e 0a0a 2020 2020 5061 7261  esult...    Para
-00008d20: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
-00008d30: 2d2d 2d2d 2d0a 2020 2020 616c 6c5f 706f  -----.    all_po
-00008d40: 6c79 676f 6e73 203a 2050 6f6c 7967 6f6e  lygons : Polygon
-00008d50: 5365 7420 6f72 206c 6973 7420 6f66 2070  Set or list of p
-00008d60: 6f6c 7967 6f6e 730a 2020 2020 2020 2020  olygons.        
-00008d70: 5365 7420 6f72 206c 6973 7420 6f66 2070  Set or list of p
-00008d80: 6f6c 7967 6f6e 7320 746f 2062 6520 6372  olygons to be cr
-00008d90: 6f70 7065 6420 616e 6420 6f66 6673 6574  opped and offset
-00008da0: 2e0a 2020 2020 6262 6f78 6573 203a 206c  ..    bboxes : l
-00008db0: 6973 740a 2020 2020 2020 2020 4c69 7374  ist.        List
-00008dc0: 206f 6620 616c 6c20 706f 6c79 676f 6e20   of all polygon 
-00008dd0: 6262 6f78 6573 2069 6e20 616c 6c5f 706f  bboxes in all_po
-00008de0: 6c79 676f 6e73 2e0a 2020 2020 6c65 6674  lygons..    left
-00008df0: 203a 2069 6e74 206f 7220 666c 6f61 740a   : int or float.
-00008e00: 2020 2020 2020 2020 5468 6520 782d 636f          The x-co
-00008e10: 6f72 6469 6e61 7465 206f 6620 7468 6520  ordinate of the 
-00008e20: 6c65 6674 6861 6e64 2062 6f75 6e64 6172  lefthand boundar
-00008e30: 792e 0a20 2020 2062 6f74 746f 6d20 3a20  y..    bottom : 
-00008e40: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
-00008e50: 2020 2020 2054 6865 2079 2d63 6f6f 7264       The y-coord
-00008e60: 696e 6174 6520 6f66 2074 6865 2062 6f74  inate of the bot
-00008e70: 746f 6d20 626f 756e 6461 7279 2e0a 2020  tom boundary..  
-00008e80: 2020 7269 6768 7420 3a20 696e 7420 6f72    right : int or
-00008e90: 2066 6c6f 6174 0a20 2020 2020 2020 2054   float.        T
-00008ea0: 6865 2078 2d63 6f6f 7264 696e 6174 6520  he x-coordinate 
-00008eb0: 6f66 2074 6865 2072 6967 6874 6861 6e64  of the righthand
-00008ec0: 2062 6f75 6e64 6172 792e 0a20 2020 2074   boundary..    t
-00008ed0: 6f70 203a 2069 6e74 206f 7220 666c 6f61  op : int or floa
-00008ee0: 740a 2020 2020 2020 2020 5468 6520 792d  t.        The y-
-00008ef0: 636f 6f72 6469 6e61 7465 206f 6620 7468  coordinate of th
-00008f00: 6520 746f 7020 626f 756e 6461 7279 2e0a  e top boundary..
-00008f10: 2020 2020 6469 7374 616e 6365 203a 2069      distance : i
-00008f20: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
-00008f30: 2020 2020 4469 7374 616e 6365 2074 6f20      Distance to 
-00008f40: 6f66 6673 6574 2070 6f6c 7967 6f6e 732e  offset polygons.
-00008f50: 2050 6f73 6974 6976 6520 7661 6c75 6573   Positive values
-00008f60: 2065 7870 616e 642c 206e 6567 6174 6976   expand, negativ
-00008f70: 6520 7368 7269 6e6b 2e0a 2020 2020 6a6f  e shrink..    jo
-00008f80: 696e 5f66 6972 7374 203a 2062 6f6f 6c0a  in_first : bool.
-00008f90: 2020 2020 2020 2020 4a6f 696e 2061 6c6c          Join all
-00008fa0: 2070 6174 6873 2062 6566 6f72 6520 6f66   paths before of
-00008fb0: 6673 6574 7469 6e67 2074 6f20 6176 6f69  fsetting to avoi
-00008fc0: 6420 756e 6e65 6365 7373 6172 7920 6a6f  d unnecessary jo
-00008fd0: 696e 7320 696e 0a20 2020 2020 2020 2061  ins in.        a
-00008fe0: 646a 6163 656e 7420 706f 6c79 676f 6e20  djacent polygon 
-00008ff0: 7369 6465 732e 0a20 2020 2070 7265 6369  sides..    preci
-00009000: 7369 6f6e 203a 2066 6c6f 6174 0a20 2020  sion : float.   
-00009010: 2020 2020 2044 6573 6972 6564 2070 7265       Desired pre
-00009020: 6369 7369 6f6e 2066 6f72 2072 6f75 6e64  cision for round
-00009030: 696e 6720 7665 7274 6578 2063 6f6f 7264  ing vertex coord
-00009040: 696e 6174 6573 2e0a 2020 2020 6a6f 696e  inates..    join
-00009050: 203a 207b 276d 6974 6572 272c 2027 6265   : {'miter', 'be
-00009060: 7665 6c27 2c20 2772 6f75 6e64 277d 0a20  vel', 'round'}. 
-00009070: 2020 2020 2020 2054 7970 6520 6f66 206a         Type of j
-00009080: 6f69 6e20 7573 6564 2074 6f20 6372 6561  oin used to crea
-00009090: 7465 2074 6865 206f 6666 7365 7420 706f  te the offset po
-000090a0: 6c79 676f 6e2e 0a20 2020 2074 6f6c 6572  lygon..    toler
-000090b0: 616e 6365 203a 2069 6e74 206f 7220 666c  ance : int or fl
-000090c0: 6f61 740a 2020 2020 2020 2020 466f 7220  oat.        For 
-000090d0: 6d69 7465 7220 6a6f 696e 7473 2c20 7468  miter joints, th
-000090e0: 6973 206e 756d 6265 7220 6d75 7374 2062  is number must b
-000090f0: 6520 6174 206c 6561 7374 2032 2061 6e64  e at least 2 and
-00009100: 2069 7420 7265 7072 6573 656e 7473 2074   it represents t
-00009110: 6865 0a20 2020 2020 2020 206d 6178 696d  he.        maxim
-00009120: 616c 2064 6973 7461 6e63 6520 696e 206d  al distance in m
-00009130: 756c 7469 706c 6573 206f 6620 6f66 6673  ultiples of offs
-00009140: 6574 2062 6574 7765 656e 206e 6577 2076  et between new v
-00009150: 6572 7469 6365 7320 616e 6420 7468 6569  ertices and thei
-00009160: 720a 2020 2020 2020 2020 6f72 6967 696e  r.        origin
-00009170: 616c 2070 6f73 6974 696f 6e20 6265 666f  al position befo
-00009180: 7265 2062 6576 656c 696e 6720 746f 2061  re beveling to a
-00009190: 766f 6964 2073 7069 6b65 7320 6174 2061  void spikes at a
-000091a0: 6375 7465 206a 6f69 6e74 732e 2046 6f72  cute joints. For
-000091b0: 0a20 2020 2020 2020 2072 6f75 6e64 206a  .        round j
-000091c0: 6f69 6e74 732c 2069 7420 696e 6469 6361  oints, it indica
-000091d0: 7465 7320 7468 6520 6375 7276 6174 7572  tes the curvatur
-000091e0: 6520 7265 736f 6c75 7469 6f6e 2069 6e20  e resolution in 
-000091f0: 6e75 6d62 6572 206f 660a 2020 2020 2020  number of.      
-00009200: 2020 706f 696e 7473 2070 6572 2066 756c    points per ful
-00009210: 6c20 6369 7263 6c65 2e0a 0a20 2020 2052  l circle...    R
-00009220: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
-00009230: 2d2d 0a20 2020 2070 6f6c 7967 6f6e 735f  --.    polygons_
-00009240: 6f66 6673 6574 5f63 726f 7070 6564 203a  offset_cropped :
-00009250: 0a20 2020 2020 2020 2054 6865 2072 6573  .        The res
-00009260: 756c 7469 6e67 2069 6e70 7574 2070 6f6c  ulting input pol
-00009270: 7967 6f6e 7320 7468 6174 2061 7265 2063  ygons that are c
-00009280: 726f 7070 6564 2074 6f20 6265 2062 6574  ropped to be bet
-00009290: 7765 656e 2074 6865 0a20 2020 2020 2020  ween the.       
-000092a0: 2063 6f6f 7264 696e 6174 6573 2028 6c65   coordinates (le
-000092b0: 6674 2c20 626f 7474 6f6d 2c20 7269 6768  ft, bottom, righ
-000092c0: 742c 2074 6f70 290a 0a20 2020 2022 2222  t, top)..    """
-000092d0: 0a0a 2020 2020 2320 4d61 726b 206f 7574  ..    # Mark out
-000092e0: 2061 2072 6567 696f 6e20 736c 6967 6874   a region slight
-000092f0: 6c79 206c 6172 6765 7220 7468 616e 2074  ly larger than t
-00009300: 6865 2066 696e 616c 2064 6573 6972 6564  he final desired
-00009310: 2072 6567 696f 6e0a 2020 2020 6420 3d20   region.    d = 
-00009320: 6469 7374 616e 6365 202a 2031 2e30 310a  distance * 1.01.
-00009330: 0a20 2020 2070 6f6c 7967 6f6e 735f 746f  .    polygons_to
-00009340: 5f6f 6666 7365 7420 3d20 5f63 726f 705f  _offset = _crop_
-00009350: 6564 6765 5f70 6f6c 7967 6f6e 7328 0a20  edge_polygons(. 
-00009360: 2020 2020 2020 2061 6c6c 5f70 6f6c 7967         all_polyg
-00009370: 6f6e 732c 0a20 2020 2020 2020 2062 626f  ons,.        bbo
-00009380: 7865 732c 0a20 2020 2020 2020 206c 6566  xes,.        lef
-00009390: 7420 2d20 642c 0a20 2020 2020 2020 2062  t - d,.        b
-000093a0: 6f74 746f 6d20 2d20 642c 0a20 2020 2020  ottom - d,.     
-000093b0: 2020 2072 6967 6874 202b 2064 2c0a 2020     right + d,.  
-000093c0: 2020 2020 2020 746f 7020 2b20 642c 0a20        top + d,. 
-000093d0: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
-000093e0: 3d70 7265 6369 7369 6f6e 2c0a 2020 2020  =precision,.    
-000093f0: 290a 0a20 2020 2023 204f 6666 7365 7420  )..    # Offset 
-00009400: 7468 6520 7265 7375 6c74 696e 6720 6372  the resulting cr
-00009410: 6f70 7065 6420 706f 6c79 676f 6e73 2061  opped polygons a
-00009420: 6e64 2072 6563 726f 7020 746f 2066 696e  nd recrop to fin
-00009430: 616c 2064 6573 6972 6564 2073 697a 650a  al desired size.
-00009440: 2020 2020 706f 6c79 676f 6e73 5f6f 6666      polygons_off
-00009450: 7365 7420 3d20 636c 6970 7065 722e 6f66  set = clipper.of
-00009460: 6673 6574 280a 2020 2020 2020 2020 706f  fset(.        po
-00009470: 6c79 676f 6e73 5f74 6f5f 6f66 6673 6574  lygons_to_offset
-00009480: 2c20 6469 7374 616e 6365 2c20 6a6f 696e  , distance, join
-00009490: 2c20 746f 6c65 7261 6e63 652c 2031 202f  , tolerance, 1 /
-000094a0: 2070 7265 6369 7369 6f6e 2c20 696e 7428   precision, int(
-000094b0: 6a6f 696e 5f66 6972 7374 290a 2020 2020  join_first).    
-000094c0: 290a 2020 2020 706f 6c79 676f 6e73 5f6f  ).    polygons_o
-000094d0: 6666 7365 745f 6372 6f70 7065 6420 3d20  ffset_cropped = 
-000094e0: 5f63 726f 705f 7265 6769 6f6e 280a 2020  _crop_region(.  
-000094f0: 2020 2020 2020 706f 6c79 676f 6e73 5f6f        polygons_o
-00009500: 6666 7365 742c 206c 6566 742c 2062 6f74  ffset, left, bot
-00009510: 746f 6d2c 2072 6967 6874 2c20 746f 702c  tom, right, top,
-00009520: 2070 7265 6369 7369 6f6e 3d70 7265 6369   precision=preci
-00009530: 7369 6f6e 0a20 2020 2029 0a0a 2020 2020  sion.    )..    
-00009540: 7265 7475 726e 2070 6f6c 7967 6f6e 735f  return polygons_
-00009550: 6f66 6673 6574 5f63 726f 7070 6564 0a0a  offset_cropped..
-00009560: 0a64 6566 205f 706f 6c79 676f 6e73 5f74  .def _polygons_t
-00009570: 6f5f 6262 6f78 6573 2870 6f6c 7967 6f6e  o_bboxes(polygon
-00009580: 7329 3a0a 2020 2020 2222 2247 656e 6572  s):.    """Gener
-00009590: 6174 6573 2074 6865 2062 626f 7865 7320  ates the bboxes 
-000095a0: 6f66 2061 6c6c 2069 6e70 7574 2070 6f6c  of all input pol
-000095b0: 7967 6f6e 732e 0a0a 2020 2020 5061 7261  ygons...    Para
-000095c0: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
-000095d0: 2d2d 2d2d 2d0a 2020 2020 706f 6c79 676f  -----.    polygo
-000095e0: 6e73 203a 2050 6f6c 7967 6f6e 5365 7420  ns : PolygonSet 
-000095f0: 6f72 206c 6973 7420 6f66 2070 6f6c 7967  or list of polyg
-00009600: 6f6e 730a 2020 2020 2020 2020 5365 7420  ons.        Set 
-00009610: 6f72 206c 6973 7420 6f66 2070 6f6c 7967  or list of polyg
-00009620: 6f6e 7320 746f 2067 656e 6572 6174 6520  ons to generate 
-00009630: 6262 6f78 6573 206f 662e 0a0a 2020 2020  bboxes of...    
-00009640: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
-00009650: 2d2d 2d0a 2020 2020 6262 6f78 6573 203a  ---.    bboxes :
-00009660: 206c 6973 740a 2020 2020 2020 2020 4c69   list.        Li
-00009670: 7374 206f 6620 616c 6c20 706f 6c79 676f  st of all polygo
-00009680: 6e20 6262 6f78 6573 2069 6e20 706f 6c79  n bboxes in poly
-00009690: 676f 6e73 2e0a 2020 2020 2222 220a 2020  gons..    """.  
-000096a0: 2020 2320 2020 2042 7569 6c64 2062 6f75    #    Build bou
-000096b0: 6e64 696e 6720 626f 7865 730a 2020 2020  nding boxes.    
-000096c0: 6262 6f78 6573 203d 206e 702e 656d 7074  bboxes = np.empt
-000096d0: 7928 5b6c 656e 2870 6f6c 7967 6f6e 7329  y([len(polygons)
-000096e0: 2c20 345d 290a 2020 2020 666f 7220 6e2c  , 4]).    for n,
-000096f0: 2070 2069 6e20 656e 756d 6572 6174 6528   p in enumerate(
-00009700: 706f 6c79 676f 6e73 293a 0a20 2020 2020  polygons):.     
-00009710: 2020 206c 6566 742c 2062 6f74 746f 6d20     left, bottom 
-00009720: 3d20 6e70 2e6d 696e 2870 2c20 6178 6973  = np.min(p, axis
-00009730: 3d30 290a 2020 2020 2020 2020 7269 6768  =0).        righ
-00009740: 742c 2074 6f70 203d 206e 702e 6d61 7828  t, top = np.max(
-00009750: 702c 2061 7869 733d 3029 0a20 2020 2020  p, axis=0).     
-00009760: 2020 2062 626f 7865 735b 6e5d 203d 205b     bboxes[n] = [
-00009770: 6c65 6674 2c20 626f 7474 6f6d 2c20 7269  left, bottom, ri
-00009780: 6768 742c 2074 6f70 5d0a 2020 2020 7265  ght, top].    re
-00009790: 7475 726e 2062 626f 7865 730a 0a0a 6465  turn bboxes...de
-000097a0: 6620 5f6f 6666 7365 745f 706f 6c79 676f  f _offset_polygo
-000097b0: 6e73 5f70 6172 616c 6c65 6c28 0a20 2020  ns_parallel(.   
-000097c0: 2070 6f6c 7967 6f6e 732c 0a20 2020 2064   polygons,.    d
-000097d0: 6973 7461 6e63 653d 352c 0a20 2020 206e  istance=5,.    n
-000097e0: 756d 5f64 6976 6973 696f 6e73 3d5b 3130  um_divisions=[10
-000097f0: 2c20 3130 5d2c 0a20 2020 206a 6f69 6e5f  , 10],.    join_
-00009800: 6669 7273 743d 5472 7565 2c0a 2020 2020  first=True,.    
-00009810: 7072 6563 6973 696f 6e3d 3165 2d34 2c0a  precision=1e-4,.
-00009820: 2020 2020 6a6f 696e 3d22 6d69 7465 7222      join="miter"
-00009830: 2c0a 2020 2020 746f 6c65 7261 6e63 653d  ,.    tolerance=
-00009840: 322c 0a29 3a0a 2020 2020 2222 2250 6572  2,.):.    """Per
-00009850: 666f 726d 7320 7468 6520 6f66 6673 6574  forms the offset
-00009860: 2066 756e 6374 696f 6e20 6f6e 2061 206c   function on a l
-00009870: 6973 7420 6f66 2073 7562 7365 6374 696f  ist of subsectio
-00009880: 6e73 206f 6620 7468 6520 6f72 6967 696e  ns of the origin
-00009890: 616c 0a20 2020 2067 656f 6d65 7472 790a  al.    geometry.
-000098a0: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-000098b0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-000098c0: 2020 2070 6f6c 7967 6f6e 7320 3a20 506f     polygons : Po
-000098d0: 6c79 676f 6e53 6574 206f 7220 6c69 7374  lygonSet or list
-000098e0: 206f 6620 706f 6c79 676f 6e73 0a0a 2020   of polygons..  
-000098f0: 2020 6469 7374 616e 6365 203a 2069 6e74    distance : int
-00009900: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
-00009910: 2020 4469 7374 616e 6365 2074 6f20 6f66    Distance to of
-00009920: 6673 6574 2070 6f6c 7967 6f6e 732e 2050  fset polygons. P
-00009930: 6f73 6974 6976 6520 7661 6c75 6573 2065  ositive values e
-00009940: 7870 616e 642c 206e 6567 6174 6976 6520  xpand, negative 
-00009950: 7368 7269 6e6b 2e0a 2020 2020 6e75 6d5f  shrink..    num_
-00009960: 6469 7669 7369 6f6e 7320 3a20 6172 7261  divisions : arra
-00009970: 792d 6c69 6b65 5b32 5d20 6f66 2069 6e74  y-like[2] of int
-00009980: 0a20 2020 2020 2020 2054 6865 206e 756d  .        The num
-00009990: 6265 7220 6f66 2064 6976 6973 696f 6e73  ber of divisions
-000099a0: 2077 6974 6820 7768 6963 6820 7468 6520   with which the 
-000099b0: 6765 6f6d 6574 7279 2069 7320 6469 7669  geometry is divi
-000099c0: 6465 6420 696e 746f 0a20 2020 2020 2020  ded into.       
-000099d0: 206d 756c 7469 706c 6520 7265 6374 616e   multiple rectan
-000099e0: 6775 6c61 7220 7265 6769 6f6e 732e 2054  gular regions. T
-000099f0: 6869 7320 616c 6c6f 7773 2066 6f72 2065  his allows for e
-00009a00: 6163 6820 7265 6769 6f6e 2074 6f20 6265  ach region to be
-00009a10: 0a20 2020 2020 2020 2070 726f 6365 7373  .        process
-00009a20: 6564 2073 6571 7565 6e74 6961 6c6c 792c  ed sequentially,
-00009a30: 2077 6869 6368 2069 7320 6d6f 7265 2063   which is more c
-00009a40: 6f6d 7075 7461 7469 6f6e 616c 6c79 2065  omputationally e
-00009a50: 6666 6963 6965 6e74 2e0a 2020 2020 6a6f  fficient..    jo
-00009a60: 696e 5f66 6972 7374 203a 2062 6f6f 6c0a  in_first : bool.
-00009a70: 2020 2020 2020 2020 4a6f 696e 2061 6c6c          Join all
-00009a80: 2070 6174 6873 2062 6566 6f72 6520 6f66   paths before of
-00009a90: 6673 6574 7469 6e67 2074 6f20 6176 6f69  fsetting to avoi
-00009aa0: 6420 756e 6e65 6365 7373 6172 7920 6a6f  d unnecessary jo
-00009ab0: 696e 7320 696e 0a20 2020 2020 2020 2061  ins in.        a
-00009ac0: 646a 6163 656e 7420 706f 6c79 676f 6e20  djacent polygon 
-00009ad0: 7369 6465 732e 0a20 2020 2070 7265 6369  sides..    preci
-00009ae0: 7369 6f6e 203a 2066 6c6f 6174 0a20 2020  sion : float.   
-00009af0: 2020 2020 2044 6573 6972 6564 2070 7265       Desired pre
-00009b00: 6369 7369 6f6e 2066 6f72 2072 6f75 6e64  cision for round
-00009b10: 696e 6720 7665 7274 6578 2063 6f6f 7264  ing vertex coord
-00009b20: 696e 6174 6573 2e0a 2020 2020 6a6f 696e  inates..    join
-00009b30: 203a 207b 276d 6974 6572 272c 2027 6265   : {'miter', 'be
-00009b40: 7665 6c27 2c20 2772 6f75 6e64 277d 0a20  vel', 'round'}. 
-00009b50: 2020 2020 2020 2054 7970 6520 6f66 206a         Type of j
-00009b60: 6f69 6e20 7573 6564 2074 6f20 6372 6561  oin used to crea
-00009b70: 7465 2074 6865 206f 6666 7365 7420 706f  te the offset po
-00009b80: 6c79 676f 6e2e 0a20 2020 2074 6f6c 6572  lygon..    toler
-00009b90: 616e 6365 203a 2069 6e74 206f 7220 666c  ance : int or fl
-00009ba0: 6f61 740a 2020 2020 2020 2020 466f 7220  oat.        For 
-00009bb0: 6d69 7465 7220 6a6f 696e 7473 2c20 7468  miter joints, th
-00009bc0: 6973 206e 756d 6265 7220 6d75 7374 2062  is number must b
-00009bd0: 6520 6174 206c 6561 7374 2032 2061 6e64  e at least 2 and
-00009be0: 2069 7420 7265 7072 6573 656e 7473 2074   it represents t
-00009bf0: 6865 0a20 2020 2020 2020 206d 6178 696d  he.        maxim
-00009c00: 616c 2064 6973 7461 6e63 6520 696e 206d  al distance in m
-00009c10: 756c 7469 706c 6573 206f 6620 6f66 6673  ultiples of offs
-00009c20: 6574 2062 6574 7765 656e 206e 6577 2076  et between new v
-00009c30: 6572 7469 6365 7320 616e 6420 7468 6569  ertices and thei
-00009c40: 720a 2020 2020 2020 2020 6f72 6967 696e  r.        origin
-00009c50: 616c 2070 6f73 6974 696f 6e20 6265 666f  al position befo
-00009c60: 7265 2062 6576 656c 696e 6720 746f 2061  re beveling to a
-00009c70: 766f 6964 2073 7069 6b65 7320 6174 2061  void spikes at a
-00009c80: 6375 7465 206a 6f69 6e74 732e 2046 6f72  cute joints. For
-00009c90: 0a20 2020 2020 2020 2072 6f75 6e64 206a  .        round j
-00009ca0: 6f69 6e74 732c 2069 7420 696e 6469 6361  oints, it indica
-00009cb0: 7465 7320 7468 6520 6375 7276 6174 7572  tes the curvatur
-00009cc0: 6520 7265 736f 6c75 7469 6f6e 2069 6e20  e resolution in 
-00009cd0: 6e75 6d62 6572 206f 660a 2020 2020 2020  number of.      
-00009ce0: 2020 706f 696e 7473 2070 6572 2066 756c    points per ful
-00009cf0: 6c20 6369 7263 6c65 2e0a 0a20 2020 2052  l circle...    R
-00009d00: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
-00009d10: 2d2d 0a20 2020 206f 6666 7365 745f 706f  --.    offset_po
-00009d20: 6c79 676f 6e73 203a 0a0a 2020 2020 2222  lygons :..    ""
-00009d30: 220a 2020 2020 2320 4275 696c 6420 626f  ".    # Build bo
-00009d40: 756e 6469 6e67 2062 6f78 6573 0a20 2020  unding boxes.   
-00009d50: 2070 6f6c 7967 6f6e 7320 3d20 6e70 2e61   polygons = np.a
-00009d60: 7361 7272 6179 2870 6f6c 7967 6f6e 7329  sarray(polygons)
-00009d70: 0a20 2020 2062 626f 7865 7320 3d20 5f70  .    bboxes = _p
-00009d80: 6f6c 7967 6f6e 735f 746f 5f62 626f 7865  olygons_to_bboxe
-00009d90: 7328 706f 6c79 676f 6e73 290a 0a20 2020  s(polygons)..   
-00009da0: 2078 6d69 6e2c 2079 6d69 6e20 3d20 6e70   xmin, ymin = np
-00009db0: 2e6d 696e 2862 626f 7865 735b 3a2c 2030  .min(bboxes[:, 0
-00009dc0: 3a32 5d2c 2061 7869 733d 3029 202d 2064  :2], axis=0) - d
-00009dd0: 6973 7461 6e63 650a 2020 2020 786d 6178  istance.    xmax
-00009de0: 2c20 796d 6178 203d 206e 702e 6d61 7828  , ymax = np.max(
-00009df0: 6262 6f78 6573 5b3a 2c20 323a 345d 2c20  bboxes[:, 2:4], 
-00009e00: 6178 6973 3d30 2920 2b20 6469 7374 616e  axis=0) + distan
-00009e10: 6365 0a0a 2020 2020 7873 697a 6520 3d20  ce..    xsize = 
-00009e20: 786d 6178 202d 2078 6d69 6e0a 2020 2020  xmax - xmin.    
-00009e30: 7973 697a 6520 3d20 796d 6178 202d 2079  ysize = ymax - y
-00009e40: 6d69 6e0a 2020 2020 7864 656c 7461 203d  min.    xdelta =
-00009e50: 2078 7369 7a65 202f 206e 756d 5f64 6976   xsize / num_div
-00009e60: 6973 696f 6e73 5b30 5d0a 2020 2020 7964  isions[0].    yd
-00009e70: 656c 7461 203d 2079 7369 7a65 202f 206e  elta = ysize / n
-00009e80: 756d 5f64 6976 6973 696f 6e73 5b31 5d0a  um_divisions[1].
-00009e90: 2020 2020 7863 6f72 6e65 7273 203d 2078      xcorners = x
-00009ea0: 6d69 6e20 2b20 6e70 2e61 7261 6e67 6528  min + np.arange(
-00009eb0: 6e75 6d5f 6469 7669 7369 6f6e 735b 305d  num_divisions[0]
-00009ec0: 2920 2a20 7864 656c 7461 0a20 2020 2079  ) * xdelta.    y
-00009ed0: 636f 726e 6572 7320 3d20 796d 696e 202b  corners = ymin +
-00009ee0: 206e 702e 6172 616e 6765 286e 756d 5f64   np.arange(num_d
-00009ef0: 6976 6973 696f 6e73 5b31 5d29 202a 2079  ivisions[1]) * y
-00009f00: 6465 6c74 610a 0a20 2020 206f 6666 7365  delta..    offse
-00009f10: 745f 706f 6c79 676f 6e73 203d 205b 5d0a  t_polygons = [].
-00009f20: 2020 2020 666f 7220 6e2c 2078 6320 696e      for n, xc in
-00009f30: 2065 6e75 6d65 7261 7465 2878 636f 726e   enumerate(xcorn
-00009f40: 6572 7329 3a0a 2020 2020 2020 2020 666f  ers):.        fo
-00009f50: 7220 6d2c 2079 6320 696e 2065 6e75 6d65  r m, yc in enume
-00009f60: 7261 7465 2879 636f 726e 6572 7329 3a0a  rate(ycorners):.
-00009f70: 2020 2020 2020 2020 2020 2020 6c65 6674              left
-00009f80: 203d 2078 630a 2020 2020 2020 2020 2020   = xc.          
-00009f90: 2020 7269 6768 7420 3d20 7863 202b 2078    right = xc + x
-00009fa0: 6465 6c74 610a 2020 2020 2020 2020 2020  delta.          
-00009fb0: 2020 626f 7474 6f6d 203d 2079 630a 2020    bottom = yc.  
-00009fc0: 2020 2020 2020 2020 2020 746f 7020 3d20            top = 
-00009fd0: 7963 202b 2079 6465 6c74 610a 2020 2020  yc + ydelta.    
-00009fe0: 2020 2020 2020 2020 5f6f 6666 7365 745f          _offset_
-00009ff0: 7265 6769 6f6e 5f70 6f6c 7967 6f6e 7320  region_polygons 
-0000a000: 3d20 5f6f 6666 7365 745f 7265 6769 6f6e  = _offset_region
-0000a010: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000a020: 2020 706f 6c79 676f 6e73 2c0a 2020 2020    polygons,.    
-0000a030: 2020 2020 2020 2020 2020 2020 6262 6f78              bbox
-0000a040: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-0000a050: 2020 2020 6c65 6674 2c0a 2020 2020 2020      left,.      
-0000a060: 2020 2020 2020 2020 2020 626f 7474 6f6d            bottom
-0000a070: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000a080: 2020 7269 6768 742c 0a20 2020 2020 2020    right,.       
-0000a090: 2020 2020 2020 2020 2074 6f70 2c0a 2020           top,.  
-0000a0a0: 2020 2020 2020 2020 2020 2020 2020 6469                di
-0000a0b0: 7374 616e 6365 3d64 6973 7461 6e63 652c  stance=distance,
-0000a0c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a0d0: 206a 6f69 6e5f 6669 7273 743d 6a6f 696e   join_first=join
-0000a0e0: 5f66 6972 7374 2c0a 2020 2020 2020 2020  _first,.        
-0000a0f0: 2020 2020 2020 2020 7072 6563 6973 696f          precisio
-0000a100: 6e3d 7072 6563 6973 696f 6e2c 0a20 2020  n=precision,.   
-0000a110: 2020 2020 2020 2020 2020 2020 206a 6f69               joi
-0000a120: 6e3d 6a6f 696e 2c0a 2020 2020 2020 2020  n=join,.        
-0000a130: 2020 2020 2020 2020 746f 6c65 7261 6e63          toleranc
-0000a140: 653d 746f 6c65 7261 6e63 652c 0a20 2020  e=tolerance,.   
-0000a150: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000a160: 2020 2020 2020 206f 6666 7365 745f 706f         offset_po
-0000a170: 6c79 676f 6e73 202b 3d20 5f6f 6666 7365  lygons += _offse
-0000a180: 745f 7265 6769 6f6e 5f70 6f6c 7967 6f6e  t_region_polygon
-0000a190: 730a 0a20 2020 2072 6574 7572 6e20 6f66  s..    return of
-0000a1a0: 6673 6574 5f70 6f6c 7967 6f6e 730a 0a0a  fset_polygons...
-0000a1b0: 6465 6620 5f62 6f6f 6c65 616e 5f72 6567  def _boolean_reg
-0000a1c0: 696f 6e28 0a20 2020 2061 6c6c 5f70 6f6c  ion(.    all_pol
-0000a1d0: 7967 6f6e 735f 412c 0a20 2020 2061 6c6c  ygons_A,.    all
-0000a1e0: 5f70 6f6c 7967 6f6e 735f 422c 0a20 2020  _polygons_B,.   
-0000a1f0: 2062 626f 7865 735f 412c 0a20 2020 2062   bboxes_A,.    b
-0000a200: 626f 7865 735f 422c 0a20 2020 206c 6566  boxes_B,.    lef
-0000a210: 742c 0a20 2020 2062 6f74 746f 6d2c 0a20  t,.    bottom,. 
-0000a220: 2020 2072 6967 6874 2c0a 2020 2020 746f     right,.    to
-0000a230: 702c 0a20 2020 206f 7065 7261 7469 6f6e  p,.    operation
-0000a240: 3d22 616e 6422 2c0a 2020 2020 7072 6563  ="and",.    prec
-0000a250: 6973 696f 6e3d 3165 2d34 2c0a 293a 0a20  ision=1e-4,.):. 
-0000a260: 2020 2022 2222 5461 6b69 6e67 2061 2072     """Taking a r
-0000a270: 6567 696f 6e20 6f66 2065 2e67 2e20 7369  egion of e.g. si
-0000a280: 7a65 2028 782c 2079 2920 7768 6963 6820  ze (x, y) which 
-0000a290: 6e65 6564 7320 746f 2062 6520 626f 6f6c  needs to be bool
-0000a2a0: 6561 6e65 642c 0a20 2020 2074 6869 7320  eaned,.    this 
-0000a2b0: 6675 6e63 7469 6f6e 2063 726f 7073 206f  function crops o
-0000a2c0: 7574 2061 2072 6567 696f 6e20 2878 2c20  ut a region (x, 
-0000a2d0: 7929 206c 6172 6765 2066 726f 6d20 6561  y) large from ea
-0000a2e0: 6368 2073 6574 206f 6620 706f 6c79 676f  ch set of polygo
-0000a2f0: 6e73 0a20 2020 2028 4120 616e 6420 4229  ns.    (A and B)
-0000a300: 2c20 626f 6f6c 6561 6e73 2074 6861 7420  , booleans that 
-0000a310: 6372 6f70 7065 6420 7265 6769 6f6e 2061  cropped region a
-0000a320: 6e64 2072 6574 7572 6e73 2074 6865 2072  nd returns the r
-0000a330: 6573 756c 742e 0a0a 2020 2020 5061 7261  esult...    Para
-0000a340: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
-0000a350: 2d2d 2d2d 2d0a 2020 2020 616c 6c5f 706f  -----.    all_po
-0000a360: 6c79 676f 6e73 5f41 203a 2050 6f6c 7967  lygons_A : Polyg
-0000a370: 6f6e 5365 7420 6f72 206c 6973 7420 6f66  onSet or list of
-0000a380: 2070 6f6c 7967 6f6e 730a 2020 2020 2020   polygons.      
-0000a390: 2020 5365 7420 6f72 206c 6973 7420 6f66    Set or list of
-0000a3a0: 2070 6f6c 7967 6f6e 7320 746f 2062 6520   polygons to be 
-0000a3b0: 626f 6f6c 6561 6e65 642e 0a20 2020 2061  booleaned..    a
-0000a3c0: 6c6c 5f70 6f6c 7967 6f6e 735f 4220 3a20  ll_polygons_B : 
-0000a3d0: 506f 6c79 676f 6e53 6574 206f 7220 6c69  PolygonSet or li
-0000a3e0: 7374 206f 6620 706f 6c79 676f 6e73 0a20  st of polygons. 
-0000a3f0: 2020 2020 2020 2053 6574 206f 7220 6c69         Set or li
-0000a400: 7374 206f 6620 706f 6c79 676f 6e73 2074  st of polygons t
-0000a410: 6f20 6265 2062 6f6f 6c65 616e 6564 2e0a  o be booleaned..
-0000a420: 2020 2020 6262 6f78 6573 5f41 203a 206c      bboxes_A : l
-0000a430: 6973 740a 2020 2020 2020 2020 4c69 7374  ist.        List
-0000a440: 206f 6620 616c 6c20 706f 6c79 676f 6e20   of all polygon 
-0000a450: 6262 6f78 6573 2069 6e20 616c 6c5f 706f  bboxes in all_po
-0000a460: 6c79 676f 6e73 5f41 0a20 2020 2062 626f  lygons_A.    bbo
-0000a470: 7865 735f 4220 3a20 6c69 7374 0a20 2020  xes_B : list.   
-0000a480: 2020 2020 204c 6973 7420 6f66 2061 6c6c       List of all
-0000a490: 2070 6f6c 7967 6f6e 2062 626f 7865 7320   polygon bboxes 
-0000a4a0: 696e 2061 6c6c 5f70 6f6c 7967 6f6e 735f  in all_polygons_
-0000a4b0: 420a 2020 2020 6c65 6674 203a 2069 6e74  B.    left : int
-0000a4c0: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
-0000a4d0: 2020 5468 6520 782d 636f 6f72 6469 6e61    The x-coordina
-0000a4e0: 7465 206f 6620 7468 6520 6c65 6674 6861  te of the leftha
-0000a4f0: 6e64 2062 6f75 6e64 6172 792e 0a20 2020  nd boundary..   
-0000a500: 2062 6f74 746f 6d20 3a20 696e 7420 6f72   bottom : int or
-0000a510: 2066 6c6f 6174 0a20 2020 2020 2020 2054   float.        T
-0000a520: 6865 2079 2d63 6f6f 7264 696e 6174 6520  he y-coordinate 
-0000a530: 6f66 2074 6865 2062 6f74 746f 6d20 626f  of the bottom bo
-0000a540: 756e 6461 7279 2e0a 2020 2020 7269 6768  undary..    righ
-0000a550: 7420 3a20 696e 7420 6f72 2066 6c6f 6174  t : int or float
-0000a560: 0a20 2020 2020 2020 2054 6865 2078 2d63  .        The x-c
-0000a570: 6f6f 7264 696e 6174 6520 6f66 2074 6865  oordinate of the
-0000a580: 2072 6967 6874 6861 6e64 2062 6f75 6e64   righthand bound
-0000a590: 6172 792e 0a20 2020 2074 6f70 203a 2069  ary..    top : i
-0000a5a0: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
-0000a5b0: 2020 2020 5468 6520 792d 636f 6f72 6469      The y-coordi
-0000a5c0: 6e61 7465 206f 6620 7468 6520 746f 7020  nate of the top 
-0000a5d0: 626f 756e 6461 7279 2e0a 2020 2020 6f70  boundary..    op
-0000a5e0: 6572 6174 696f 6e20 3a20 7b27 6e6f 7427  eration : {'not'
-0000a5f0: 2c20 2761 6e64 272c 2027 6f72 272c 2027  , 'and', 'or', '
-0000a600: 786f 7227 2c20 2741 2d42 272c 2027 422d  xor', 'A-B', 'B-
-0000a610: 4127 2c20 2741 2b42 277d 0a20 2020 2020  A', 'A+B'}.     
-0000a620: 2020 2042 6f6f 6c65 616e 206f 7065 7261     Boolean opera
-0000a630: 7469 6f6e 2074 6f20 7065 7266 6f72 6d2e  tion to perform.
-0000a640: 0a20 2020 2070 7265 6369 7369 6f6e 203a  .    precision :
-0000a650: 2066 6c6f 6174 0a20 2020 2020 2020 2044   float.        D
-0000a660: 6573 6972 6564 2070 7265 6369 7369 6f6e  esired precision
-0000a670: 2066 6f72 2072 6f75 6e64 696e 6720 7665   for rounding ve
-0000a680: 7274 6578 2063 6f6f 7264 696e 6174 6573  rtex coordinates
-0000a690: 2e0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
-0000a6a0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2070     -------.    p
-0000a6b0: 6f6c 7967 6f6e 735f 626f 6f6c 6561 6e20  olygons_boolean 
-0000a6c0: 3a20 506f 6c79 676f 6e53 6574 206f 7220  : PolygonSet or 
-0000a6d0: 6c69 7374 206f 6620 706f 6c79 676f 6e73  list of polygons
-0000a6e0: 0a20 2020 2020 2020 2053 6574 206f 7220  .        Set or 
-0000a6f0: 6c69 7374 206f 6620 706f 6c79 676f 6e73  list of polygons
-0000a700: 2077 6974 6820 626f 6f6c 6561 6e20 6f70   with boolean op
-0000a710: 6572 6174 696f 6e20 6170 706c 6965 642e  eration applied.
-0000a720: 0a20 2020 2022 2222 0a0a 2020 2020 706f  .    """..    po
-0000a730: 6c79 676f 6e73 5f74 6f5f 626f 6f6c 6561  lygons_to_boolea
-0000a740: 6e5f 4120 3d20 5f63 726f 705f 6564 6765  n_A = _crop_edge
-0000a750: 5f70 6f6c 7967 6f6e 7328 0a20 2020 2020  _polygons(.     
-0000a760: 2020 2061 6c6c 5f70 6f6c 7967 6f6e 735f     all_polygons_
-0000a770: 412c 2062 626f 7865 735f 412c 206c 6566  A, bboxes_A, lef
-0000a780: 742c 2062 6f74 746f 6d2c 2072 6967 6874  t, bottom, right
-0000a790: 2c20 746f 702c 2070 7265 6369 7369 6f6e  , top, precision
-0000a7a0: 0a20 2020 2029 0a20 2020 2070 6f6c 7967  .    ).    polyg
-0000a7b0: 6f6e 735f 746f 5f62 6f6f 6c65 616e 5f42  ons_to_boolean_B
-0000a7c0: 203d 205f 6372 6f70 5f65 6467 655f 706f   = _crop_edge_po
-0000a7d0: 6c79 676f 6e73 280a 2020 2020 2020 2020  lygons(.        
-0000a7e0: 616c 6c5f 706f 6c79 676f 6e73 5f42 2c20  all_polygons_B, 
-0000a7f0: 6262 6f78 6573 5f42 2c20 6c65 6674 2c20  bboxes_B, left, 
-0000a800: 626f 7474 6f6d 2c20 7269 6768 742c 2074  bottom, right, t
-0000a810: 6f70 2c20 7072 6563 6973 696f 6e0a 2020  op, precision.  
-0000a820: 2020 290a 2020 2020 706f 6c79 676f 6e73    ).    polygons
-0000a830: 5f62 6f6f 6c65 616e 203d 2063 6c69 7070  _boolean = clipp
-0000a840: 6572 2e63 6c69 7028 0a20 2020 2020 2020  er.clip(.       
-0000a850: 2070 6f6c 7967 6f6e 735f 746f 5f62 6f6f   polygons_to_boo
-0000a860: 6c65 616e 5f41 2c20 706f 6c79 676f 6e73  lean_A, polygons
-0000a870: 5f74 6f5f 626f 6f6c 6561 6e5f 422c 206f  _to_boolean_B, o
-0000a880: 7065 7261 7469 6f6e 2c20 3120 2f20 7072  peration, 1 / pr
-0000a890: 6563 6973 696f 6e0a 2020 2020 290a 2020  ecision.    ).  
-0000a8a0: 2020 7265 7475 726e 2070 6f6c 7967 6f6e    return polygon
-0000a8b0: 735f 626f 6f6c 6561 6e0a 0a0a 6465 6620  s_boolean...def 
-0000a8c0: 5f62 6f6f 6c65 616e 5f70 6f6c 7967 6f6e  _boolean_polygon
-0000a8d0: 735f 7061 7261 6c6c 656c 280a 2020 2020  s_parallel(.    
-0000a8e0: 706f 6c79 676f 6e73 5f41 2c20 706f 6c79  polygons_A, poly
-0000a8f0: 676f 6e73 5f42 2c20 6e75 6d5f 6469 7669  gons_B, num_divi
-0000a900: 7369 6f6e 733d 5b31 302c 2031 305d 2c20  sions=[10, 10], 
-0000a910: 6f70 6572 6174 696f 6e3d 2261 6e64 222c  operation="and",
-0000a920: 2070 7265 6369 7369 6f6e 3d31 652d 340a   precision=1e-4.
-0000a930: 293a 0a20 2020 2022 2222 5065 7266 6f72  ):.    """Perfor
-0000a940: 6d73 2074 6865 2062 6f6f 6c65 616e 2066  ms the boolean f
-0000a950: 756e 6374 696f 6e20 6f6e 2061 206c 6973  unction on a lis
-0000a960: 7420 6f66 2073 7562 7365 6374 696f 6e73  t of subsections
-0000a970: 206f 6620 7468 6520 6f72 6967 696e 616c   of the original
-0000a980: 0a20 2020 2067 656f 6d65 7472 790a 0a20  .    geometry.. 
-0000a990: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-0000a9a0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-0000a9b0: 2070 6f6c 7967 6f6e 735f 4120 3a20 506f   polygons_A : Po
-0000a9c0: 6c79 676f 6e53 6574 206f 7220 6c69 7374  lygonSet or list
-0000a9d0: 206f 6620 706f 6c79 676f 6e73 0a20 2020   of polygons.   
-0000a9e0: 2020 2020 2053 6574 206f 7220 6c69 7374       Set or list
-0000a9f0: 206f 6620 706f 6c79 676f 6e73 2074 6f20   of polygons to 
-0000aa00: 6265 2062 6f6f 6c65 616e 6564 2e0a 2020  be booleaned..  
-0000aa10: 2020 706f 6c79 676f 6e73 5f42 203a 2050    polygons_B : P
-0000aa20: 6f6c 7967 6f6e 5365 7420 6f72 206c 6973  olygonSet or lis
-0000aa30: 7420 6f66 2070 6f6c 7967 6f6e 730a 2020  t of polygons.  
-0000aa40: 2020 2020 2020 5365 7420 6f72 206c 6973        Set or lis
-0000aa50: 7420 6f66 2070 6f6c 7967 6f6e 7320 746f  t of polygons to
-0000aa60: 2062 6520 626f 6f6c 6561 6e65 642e 0a20   be booleaned.. 
-0000aa70: 2020 206e 756d 5f64 6976 6973 696f 6e73     num_divisions
-0000aa80: 203a 2061 7272 6179 2d6c 696b 655b 325d   : array-like[2]
-0000aa90: 206f 6620 696e 740a 2020 2020 2020 2020   of int.        
-0000aaa0: 5468 6520 6e75 6d62 6572 206f 6620 6469  The number of di
-0000aab0: 7669 7369 6f6e 7320 7769 7468 2077 6869  visions with whi
-0000aac0: 6368 2074 6865 2067 656f 6d65 7472 7920  ch the geometry 
-0000aad0: 6973 2064 6976 6964 6564 2069 6e74 6f0a  is divided into.
-0000aae0: 2020 2020 2020 2020 6d75 6c74 6970 6c65          multiple
-0000aaf0: 2072 6563 7461 6e67 756c 6172 2072 6567   rectangular reg
-0000ab00: 696f 6e73 2e20 5468 6973 2061 6c6c 6f77  ions. This allow
-0000ab10: 7320 666f 7220 6561 6368 2072 6567 696f  s for each regio
-0000ab20: 6e20 746f 2062 650a 2020 2020 2020 2020  n to be.        
-0000ab30: 7072 6f63 6573 7365 6420 7365 7175 656e  processed sequen
-0000ab40: 7469 616c 6c79 2c20 7768 6963 6820 6973  tially, which is
-0000ab50: 206d 6f72 6520 636f 6d70 7574 6174 696f   more computatio
-0000ab60: 6e61 6c6c 7920 6566 6669 6369 656e 742e  nally efficient.
-0000ab70: 0a20 2020 206f 7065 7261 7469 6f6e 203a  .    operation :
-0000ab80: 207b 276e 6f74 272c 2027 616e 6427 2c20   {'not', 'and', 
-0000ab90: 276f 7227 2c20 2778 6f72 272c 2027 412d  'or', 'xor', 'A-
-0000aba0: 4227 2c20 2742 2d41 272c 2027 412b 4227  B', 'B-A', 'A+B'
-0000abb0: 7d0a 2020 2020 2020 2020 426f 6f6c 6561  }.        Boolea
-0000abc0: 6e20 6f70 6572 6174 696f 6e20 746f 2070  n operation to p
-0000abd0: 6572 666f 726d 2e0a 2020 2020 7072 6563  erform..    prec
-0000abe0: 6973 696f 6e20 3a20 666c 6f61 740a 2020  ision : float.  
-0000abf0: 2020 2020 2020 4465 7369 7265 6420 7072        Desired pr
-0000ac00: 6563 6973 696f 6e20 666f 7220 726f 756e  ecision for roun
-0000ac10: 6469 6e67 2076 6572 7465 7820 636f 6f72  ding vertex coor
-0000ac20: 6469 6e61 7465 732e 0a0a 2020 2020 5265  dinates...    Re
-0000ac30: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
-0000ac40: 2d0a 2020 2020 626f 6f6c 6561 6e5f 706f  -.    boolean_po
-0000ac50: 6c79 676f 6e73 203a 206c 6973 7420 6f66  lygons : list of
-0000ac60: 2070 6f6c 7967 6f6e 730a 2020 2020 2020   polygons.      
-0000ac70: 2020 416c 6c20 7468 6520 626f 6f6c 6561    All the boolea
-0000ac80: 6e65 6420 706f 6c79 676f 6e73 2066 726f  ned polygons fro
-0000ac90: 6d20 6561 6368 206f 6620 7468 6520 7375  m each of the su
-0000aca0: 6273 6563 7469 6f6e 730a 0a20 2020 2022  bsections..    "
-0000acb0: 2222 0a20 2020 2023 2042 7569 6c64 2062  "".    # Build b
-0000acc0: 6f75 6e64 696e 6720 626f 7865 730a 2020  ounding boxes.  
-0000acd0: 2020 706f 6c79 676f 6e73 5f41 203d 206e    polygons_A = n
-0000ace0: 702e 6173 6172 7261 7928 706f 6c79 676f  p.asarray(polygo
-0000acf0: 6e73 5f41 2c20 6474 7970 653d 6f62 6a65  ns_A, dtype=obje
-0000ad00: 6374 290a 2020 2020 706f 6c79 676f 6e73  ct).    polygons
-0000ad10: 5f42 203d 206e 702e 6173 6172 7261 7928  _B = np.asarray(
-0000ad20: 706f 6c79 676f 6e73 5f42 2c20 6474 7970  polygons_B, dtyp
-0000ad30: 653d 6f62 6a65 6374 290a 2020 2020 6262  e=object).    bb
-0000ad40: 6f78 6573 5f41 203d 205f 706f 6c79 676f  oxes_A = _polygo
-0000ad50: 6e73 5f74 6f5f 6262 6f78 6573 2870 6f6c  ns_to_bboxes(pol
-0000ad60: 7967 6f6e 735f 4129 0a20 2020 2062 626f  ygons_A).    bbo
-0000ad70: 7865 735f 4220 3d20 5f70 6f6c 7967 6f6e  xes_B = _polygon
-0000ad80: 735f 746f 5f62 626f 7865 7328 706f 6c79  s_to_bboxes(poly
-0000ad90: 676f 6e73 5f42 290a 0a20 2020 2078 6d69  gons_B)..    xmi
-0000ada0: 6e2c 2079 6d69 6e20 3d20 6e70 2e6d 696e  n, ymin = np.min
-0000adb0: 280a 2020 2020 2020 2020 5b6e 702e 6d69  (.        [np.mi
-0000adc0: 6e28 6262 6f78 6573 5f41 5b3a 2c20 303a  n(bboxes_A[:, 0:
-0000add0: 325d 2c20 6178 6973 3d30 292c 206e 702e  2], axis=0), np.
-0000ade0: 6d69 6e28 6262 6f78 6573 5f42 5b3a 2c20  min(bboxes_B[:, 
-0000adf0: 303a 325d 2c20 6178 6973 3d30 295d 2c20  0:2], axis=0)], 
-0000ae00: 6178 6973 3d30 0a20 2020 2029 0a20 2020  axis=0.    ).   
-0000ae10: 2078 6d61 782c 2079 6d61 7820 3d20 6e70   xmax, ymax = np
-0000ae20: 2e6d 6178 280a 2020 2020 2020 2020 5b6e  .max(.        [n
-0000ae30: 702e 6d61 7828 6262 6f78 6573 5f41 5b3a  p.max(bboxes_A[:
-0000ae40: 2c20 323a 345d 2c20 6178 6973 3d30 292c  , 2:4], axis=0),
-0000ae50: 206e 702e 6d61 7828 6262 6f78 6573 5f42   np.max(bboxes_B
-0000ae60: 5b3a 2c20 323a 345d 2c20 6178 6973 3d30  [:, 2:4], axis=0
-0000ae70: 295d 2c20 6178 6973 3d30 0a20 2020 2029  )], axis=0.    )
-0000ae80: 0a0a 2020 2020 7873 697a 6520 3d20 786d  ..    xsize = xm
-0000ae90: 6178 202d 2078 6d69 6e0a 2020 2020 7973  ax - xmin.    ys
-0000aea0: 697a 6520 3d20 796d 6178 202d 2079 6d69  ize = ymax - ymi
-0000aeb0: 6e0a 2020 2020 7864 656c 7461 203d 2078  n.    xdelta = x
-0000aec0: 7369 7a65 202f 206e 756d 5f64 6976 6973  size / num_divis
-0000aed0: 696f 6e73 5b30 5d0a 2020 2020 7964 656c  ions[0].    ydel
-0000aee0: 7461 203d 2079 7369 7a65 202f 206e 756d  ta = ysize / num
-0000aef0: 5f64 6976 6973 696f 6e73 5b31 5d0a 2020  _divisions[1].  
-0000af00: 2020 7863 6f72 6e65 7273 203d 2078 6d69    xcorners = xmi
-0000af10: 6e20 2b20 6e70 2e61 7261 6e67 6528 6e75  n + np.arange(nu
-0000af20: 6d5f 6469 7669 7369 6f6e 735b 305d 2920  m_divisions[0]) 
-0000af30: 2a20 7864 656c 7461 0a20 2020 2079 636f  * xdelta.    yco
-0000af40: 726e 6572 7320 3d20 796d 696e 202b 206e  rners = ymin + n
-0000af50: 702e 6172 616e 6765 286e 756d 5f64 6976  p.arange(num_div
-0000af60: 6973 696f 6e73 5b31 5d29 202a 2079 6465  isions[1]) * yde
-0000af70: 6c74 610a 0a20 2020 2062 6f6f 6c65 616e  lta..    boolean
-0000af80: 5f70 6f6c 7967 6f6e 7320 3d20 5b5d 0a20  _polygons = []. 
-0000af90: 2020 2066 6f72 206e 2c20 7863 2069 6e20     for n, xc in 
-0000afa0: 656e 756d 6572 6174 6528 7863 6f72 6e65  enumerate(xcorne
-0000afb0: 7273 293a 0a20 2020 2020 2020 2066 6f72  rs):.        for
-0000afc0: 206d 2c20 7963 2069 6e20 656e 756d 6572   m, yc in enumer
-0000afd0: 6174 6528 7963 6f72 6e65 7273 293a 0a20  ate(ycorners):. 
-0000afe0: 2020 2020 2020 2020 2020 206c 6566 7420             left 
-0000aff0: 3d20 7863 0a20 2020 2020 2020 2020 2020  = xc.           
-0000b000: 2072 6967 6874 203d 2078 6320 2b20 7864   right = xc + xd
-0000b010: 656c 7461 0a20 2020 2020 2020 2020 2020  elta.           
-0000b020: 2062 6f74 746f 6d20 3d20 7963 0a20 2020   bottom = yc.   
-0000b030: 2020 2020 2020 2020 2074 6f70 203d 2079           top = y
-0000b040: 6320 2b20 7964 656c 7461 0a20 2020 2020  c + ydelta.     
-0000b050: 2020 2020 2020 205f 626f 6f6c 6561 6e5f         _boolean_
-0000b060: 7265 6769 6f6e 5f70 6f6c 7967 6f6e 7320  region_polygons 
-0000b070: 3d20 5f62 6f6f 6c65 616e 5f72 6567 696f  = _boolean_regio
-0000b080: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-0000b090: 2020 2070 6f6c 7967 6f6e 735f 412c 0a20     polygons_A,. 
-0000b0a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000b0b0: 6f6c 7967 6f6e 735f 422c 0a20 2020 2020  olygons_B,.     
-0000b0c0: 2020 2020 2020 2020 2020 2062 626f 7865             bboxe
-0000b0d0: 735f 412c 0a20 2020 2020 2020 2020 2020  s_A,.           
-0000b0e0: 2020 2020 2062 626f 7865 735f 422c 0a20       bboxes_B,. 
-0000b0f0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0000b100: 6566 742c 0a20 2020 2020 2020 2020 2020  eft,.           
-0000b110: 2020 2020 2062 6f74 746f 6d2c 0a20 2020       bottom,.   
-0000b120: 2020 2020 2020 2020 2020 2020 2072 6967               rig
-0000b130: 6874 2c0a 2020 2020 2020 2020 2020 2020  ht,.            
-0000b140: 2020 2020 746f 702c 0a20 2020 2020 2020      top,.       
-0000b150: 2020 2020 2020 2020 206f 7065 7261 7469           operati
-0000b160: 6f6e 3d6f 7065 7261 7469 6f6e 2c0a 2020  on=operation,.  
-0000b170: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0000b180: 6563 6973 696f 6e3d 7072 6563 6973 696f  ecision=precisio
-0000b190: 6e2c 0a20 2020 2020 2020 2020 2020 2029  n,.            )
-0000b1a0: 0a20 2020 2020 2020 2020 2020 2062 6f6f  .            boo
-0000b1b0: 6c65 616e 5f70 6f6c 7967 6f6e 7320 2b3d  lean_polygons +=
-0000b1c0: 205f 626f 6f6c 6561 6e5f 7265 6769 6f6e   _boolean_region
-0000b1d0: 5f70 6f6c 7967 6f6e 730a 0a20 2020 2072  _polygons..    r
-0000b1e0: 6574 7572 6e20 626f 6f6c 6561 6e5f 706f  eturn boolean_po
-0000b1f0: 6c79 676f 6e73 0a0a 0a23 203d 3d3d 3d3d  lygons...# =====
-0000b200: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0000b210: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0000b220: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0000b230: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0000b240: 3d3d 3d3d 3d3d 3d3d 3d0a 230a 2320 4c69  =========.#.# Li
-0000b250: 7468 6f67 7261 7068 7920 7465 7374 2073  thography test s
-0000b260: 7472 7563 7475 7265 730a 230a 2320 3d3d  tructures.#.# ==
-0000b270: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0000b280: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0000b290: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0000b2a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0000b2b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a0a 0a64  ============...d
-0000b2c0: 6566 206c 6974 686f 5f73 7465 7073 286c  ef litho_steps(l
-0000b2d0: 696e 655f 7769 6474 6873 3d5b 312c 2032  ine_widths=[1, 2
-0000b2e0: 2c20 342c 2038 2c20 3136 5d2c 206c 696e  , 4, 8, 16], lin
-0000b2f0: 655f 7370 6163 696e 673d 3130 2c20 6865  e_spacing=10, he
-0000b300: 6967 6874 3d31 3030 2c20 6c61 7965 723d  ight=100, layer=
-0000b310: 3029 3a0a 2020 2020 2222 2250 726f 6475  0):.    """Produ
-0000b320: 6365 7320 6120 706f 7369 7469 7665 202b  ces a positive +
-0000b330: 206e 6567 6174 6976 6520 746f 6e65 206c   negative tone l
-0000b340: 696e 6577 6964 7468 2074 6573 742c 2075  inewidth test, u
-0000b350: 7365 6420 666f 720a 2020 2020 6c69 7468  sed for.    lith
-0000b360: 6f67 7261 7068 7920 7265 736f 6c75 7469  ography resoluti
-0000b370: 6f6e 2074 6573 7420 7061 7474 6572 6e69  on test patterni
-0000b380: 6e67 2e0a 0a20 2020 2050 6172 616d 6574  ng...    Paramet
-0000b390: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
-0000b3a0: 2d2d 0a20 2020 206c 696e 655f 7769 6474  --.    line_widt
-0000b3b0: 6873 203a 2061 7272 6179 2d6c 696b 655b  hs : array-like[
-0000b3c0: 4e5d 206f 6620 696e 7420 6f72 2066 6c6f  N] of int or flo
-0000b3d0: 6174 0a20 2020 2020 2020 2057 6964 7468  at.        Width
-0000b3e0: 7320 6f66 2074 6865 2073 7465 7073 2028  s of the steps (
-0000b3f0: 706f 7369 7469 7665 2073 6964 6529 2e0a  positive side)..
-0000b400: 2020 2020 6c69 6e65 5f73 7061 6369 6e67      line_spacing
-0000b410: 203a 2069 6e74 206f 7220 666c 6f61 740a   : int or float.
-0000b420: 2020 2020 2020 2020 5370 6163 6520 6265          Space be
-0000b430: 7477 6565 6e20 6561 6368 2073 7465 7020  tween each step 
-0000b440: 286e 6567 6174 6976 6520 7369 6465 292e  (negative side).
-0000b450: 0a20 2020 2068 6569 6768 7420 3a20 696e  .    height : in
-0000b460: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
-0000b470: 2020 2048 6569 6768 7420 6f66 2074 6865     Height of the
-0000b480: 2073 7465 7073 2e0a 2020 2020 6c61 7965   steps..    laye
-0000b490: 7220 3a20 696e 742c 2061 7272 6179 2d6c  r : int, array-l
-0000b4a0: 696b 655b 325d 2c20 6f72 2073 6574 0a20  ike[2], or set. 
-0000b4b0: 2020 2020 2020 2053 7065 6369 6669 6320         Specific 
-0000b4c0: 6c61 7965 7228 7329 2074 6f20 7075 7420  layer(s) to put 
-0000b4d0: 706f 6c79 676f 6e20 6765 6f6d 6574 7279  polygon geometry
-0000b4e0: 206f 6e2e 0a0a 2020 2020 5265 7475 726e   on...    Return
-0000b4f0: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-0000b500: 2020 4420 3a20 4465 7669 6365 0a20 2020    D : Device.   
-0000b510: 2020 2020 2041 2044 6576 6963 6520 636f       A Device co
-0000b520: 6e74 6169 6e69 6e67 2074 6865 206c 6974  ntaining the lit
-0000b530: 686f 6772 6170 6869 6320 6c69 6e65 7769  hographic linewi
-0000b540: 6474 6820 7265 736f 6c75 7469 6f6e 2074  dth resolution t
-0000b550: 6573 740a 2020 2020 2020 2020 6765 6f6d  est.        geom
-0000b560: 6574 7279 2e0a 2020 2020 2222 220a 2020  etry..    """.  
-0000b570: 2020 4420 3d20 4465 7669 6365 2822 6c69    D = Device("li
-0000b580: 7468 6f5f 7374 6570 7322 290a 0a20 2020  tho_steps")..   
-0000b590: 2068 6569 6768 7420 3d20 6865 6967 6874   height = height
-0000b5a0: 202f 2032 0a20 2020 2054 3120 3d20 7465   / 2.    T1 = te
-0000b5b0: 7874 280a 2020 2020 2020 2020 7465 7874  xt(.        text
-0000b5c0: 3d22 2573 2220 2520 7374 7228 6c69 6e65  ="%s" % str(line
-0000b5d0: 5f77 6964 7468 735b 2d31 5d29 2c20 7369  _widths[-1]), si
-0000b5e0: 7a65 3d68 6569 6768 742c 206a 7573 7469  ze=height, justi
-0000b5f0: 6679 3d22 6365 6e74 6572 222c 206c 6179  fy="center", lay
-0000b600: 6572 3d6c 6179 6572 0a20 2020 2029 0a20  er=layer.    ). 
-0000b610: 2020 205f 203d 2044 2e61 6464 5f72 6566     _ = D.add_ref
-0000b620: 2854 3129 2e72 6f74 6174 6528 3930 292e  (T1).rotate(90).
-0000b630: 6d6f 7665 7828 2d68 6569 6768 7420 2f20  movex(-height / 
-0000b640: 3130 290a 2020 2020 5231 203d 2072 6563  10).    R1 = rec
-0000b650: 7461 6e67 6c65 2873 697a 653d 286c 696e  tangle(size=(lin
-0000b660: 655f 7370 6163 696e 672c 2068 6569 6768  e_spacing, heigh
-0000b670: 7429 2c20 6c61 7965 723d 6c61 7965 7229  t), layer=layer)
-0000b680: 0a20 2020 2044 2e61 6464 5f72 6566 2852  .    D.add_ref(R
-0000b690: 3129 2e6d 6f76 6579 282d 6865 6967 6874  1).movey(-height
-0000b6a0: 290a 2020 2020 636f 756e 7420 3d20 300a  ).    count = 0.
-0000b6b0: 2020 2020 666f 7220 6920 696e 2072 6576      for i in rev
-0000b6c0: 6572 7365 6428 6c69 6e65 5f77 6964 7468  ersed(line_width
-0000b6d0: 7329 3a0a 2020 2020 2020 2020 636f 756e  s):.        coun
-0000b6e0: 7420 2b3d 206c 696e 655f 7370 6163 696e  t += line_spacin
-0000b6f0: 6720 2b20 690a 2020 2020 2020 2020 5232  g + i.        R2
-0000b700: 203d 2072 6563 7461 6e67 6c65 2873 697a   = rectangle(siz
-0000b710: 653d 2869 2c20 6865 6967 6874 292c 206c  e=(i, height), l
-0000b720: 6179 6572 3d6c 6179 6572 290a 2020 2020  ayer=layer).    
-0000b730: 2020 2020 442e 6164 645f 7265 6628 5231      D.add_ref(R1
-0000b740: 292e 6d6f 7665 7828 636f 756e 7429 2e6d  ).movex(count).m
-0000b750: 6f76 6579 282d 6865 6967 6874 290a 2020  ovey(-height).  
-0000b760: 2020 2020 2020 442e 6164 645f 7265 6628        D.add_ref(
-0000b770: 5232 292e 6d6f 7665 7828 636f 756e 7420  R2).movex(count 
-0000b780: 2d20 6929 0a0a 2020 2020 7265 7475 726e  - i)..    return
-0000b790: 2044 0a0a 0a64 6566 206c 6974 686f 5f73   D...def litho_s
-0000b7a0: 7461 7228 6e75 6d5f 6c69 6e65 733d 3230  tar(num_lines=20
-0000b7b0: 2c20 6c69 6e65 5f77 6964 7468 3d32 2c20  , line_width=2, 
-0000b7c0: 6469 616d 6574 6572 3d32 3030 2c20 6c61  diameter=200, la
-0000b7d0: 7965 723d 3029 3a0a 2020 2020 2222 2243  yer=0):.    """C
-0000b7e0: 7265 6174 6573 2061 2063 6972 6375 6c61  reates a circula
-0000b7f0: 722d 7374 6172 2073 6861 7065 2066 726f  r-star shape fro
-0000b800: 6d20 6c69 6e65 732c 2075 7365 6420 6173  m lines, used as
-0000b810: 2061 206c 6974 686f 6772 6170 6869 630a   a lithographic.
-0000b820: 2020 2020 7265 736f 6c75 7469 6f6e 2074      resolution t
-0000b830: 6573 7420 7061 7474 6572 6e2e 0a0a 2020  est pattern...  
-0000b840: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-0000b850: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-0000b860: 6e75 6d5f 6c69 6e65 7320 3a20 696e 740a  num_lines : int.
-0000b870: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
-0000b880: 6620 6c69 6e65 7320 696e 2074 6865 2063  f lines in the c
-0000b890: 6972 6375 6c61 722d 7374 6172 2073 6861  ircular-star sha
-0000b8a0: 7065 2e0a 2020 2020 6c69 6e65 5f77 6964  pe..    line_wid
-0000b8b0: 7468 203a 2069 6e74 206f 7220 666c 6f61  th : int or floa
-0000b8c0: 740a 2020 2020 2020 2020 5468 6963 6b6e  t.        Thickn
-0000b8d0: 6573 7320 6f66 2073 7461 7220 7370 696b  ess of star spik
-0000b8e0: 6520 6c69 6e65 732e 0a20 2020 2064 6961  e lines..    dia
-0000b8f0: 6d65 7465 7220 3a20 696e 7420 6f72 2066  meter : int or f
-0000b900: 6c6f 6174 0a20 2020 2020 2020 2044 6961  loat.        Dia
-0000b910: 6d65 7465 7220 6f66 2074 6865 2063 6972  meter of the cir
-0000b920: 6375 6c61 722d 7374 6172 2073 6861 7065  cular-star shape
-0000b930: 2028 746f 7461 6c20 6c65 6e67 7468 206f   (total length o
-0000b940: 6620 6561 6368 2073 7461 7220 7370 696b  f each star spik
-0000b950: 6529 2e0a 2020 2020 6c61 7965 7220 3a20  e)..    layer : 
-0000b960: 696e 742c 2061 7272 6179 2d6c 696b 655b  int, array-like[
-0000b970: 325d 2c20 6f72 2073 6574 0a20 2020 2020  2], or set.     
-0000b980: 2020 2053 7065 6369 6669 6320 6c61 7965     Specific laye
-0000b990: 7228 7329 2074 6f20 7075 7420 706f 6c79  r(s) to put poly
-0000b9a0: 676f 6e20 6765 6f6d 6574 7279 206f 6e2e  gon geometry on.
-0000b9b0: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
-0000b9c0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 4420    -------.    D 
-0000b9d0: 3a20 4465 7669 6365 0a20 2020 2020 2020  : Device.       
-0000b9e0: 2041 2044 6576 6963 6520 636f 6e74 6169   A Device contai
-0000b9f0: 6e69 6e67 2061 206c 696e 652d 6261 7365  ning a line-base
-0000ba00: 6420 6369 7263 756c 6172 2d73 7461 7220  d circular-star 
-0000ba10: 7368 6170 652e 0a20 2020 2022 2222 0a20  shape..    """. 
-0000ba20: 2020 2044 203d 2044 6576 6963 6528 226c     D = Device("l
-0000ba30: 6974 686f 5f73 7461 7222 290a 0a20 2020  itho_star")..   
-0000ba40: 2064 6567 7265 6520 3d20 3138 3020 2f20   degree = 180 / 
-0000ba50: 6e75 6d5f 6c69 6e65 730a 2020 2020 5231  num_lines.    R1
-0000ba60: 203d 2072 6563 7461 6e67 6c65 2873 697a   = rectangle(siz
-0000ba70: 653d 286c 696e 655f 7769 6474 682c 2064  e=(line_width, d
-0000ba80: 6961 6d65 7465 7229 2c20 6c61 7965 723d  iameter), layer=
-0000ba90: 6c61 7965 7229 0a20 2020 2066 6f72 2069  layer).    for i
-0000baa0: 2069 6e20 7261 6e67 6528 6e75 6d5f 6c69   in range(num_li
-0000bab0: 6e65 7329 3a0a 2020 2020 2020 2020 7231  nes):.        r1
-0000bac0: 203d 2044 2e61 6464 5f72 6566 2852 3129   = D.add_ref(R1)
-0000bad0: 2e72 6f74 6174 6528 6465 6772 6565 202a  .rotate(degree *
-0000bae0: 2069 290a 2020 2020 2020 2020 7231 2e63   i).        r1.c
-0000baf0: 656e 7465 7220 3d20 2830 2c20 3029 0a0a  enter = (0, 0)..
-0000bb00: 2020 2020 7265 7475 726e 2044 0a0a 0a64      return D...d
-0000bb10: 6566 206c 6974 686f 5f63 616c 6970 6572  ef litho_caliper
-0000bb20: 7328 0a20 2020 206e 6f74 6368 5f73 697a  s(.    notch_siz
-0000bb30: 653d 5b32 2c20 355d 2c0a 2020 2020 6e6f  e=[2, 5],.    no
-0000bb40: 7463 685f 7370 6163 696e 673d 322c 0a20  tch_spacing=2,. 
-0000bb50: 2020 206e 756d 5f6e 6f74 6368 6573 3d31     num_notches=1
-0000bb60: 312c 0a20 2020 206f 6666 7365 745f 7065  1,.    offset_pe
-0000bb70: 725f 6e6f 7463 683d 302e 312c 0a20 2020  r_notch=0.1,.   
-0000bb80: 2072 6f77 5f73 7061 6369 6e67 3d30 2c0a   row_spacing=0,.
-0000bb90: 2020 2020 6c61 7965 7231 3d31 2c0a 2020      layer1=1,.  
-0000bba0: 2020 6c61 7965 7232 3d32 2c0a 293a 0a20    layer2=2,.):. 
-0000bbb0: 2020 2022 2222 4372 6561 7465 7320 6120     """Creates a 
-0000bbc0: 7665 726e 6965 7220 6361 6c69 7065 7220  vernier caliper 
-0000bbd0: 7374 7275 6374 7572 6520 666f 7220 6c69  structure for li
-0000bbe0: 7468 6f67 7261 7068 7920 616c 6967 6e6d  thography alignm
-0000bbf0: 656e 740a 2020 2020 7465 7374 732e 2056  ent.    tests. V
-0000bc00: 6572 6e69 6572 2073 7472 7563 7475 7265  ernier structure
-0000bc10: 2069 7320 6d61 6465 2068 6f72 697a 6f6e   is made horizon
-0000bc20: 7461 6c6c 792e 0a0a 2020 2020 5061 7261  tally...    Para
-0000bc30: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
-0000bc40: 2d2d 2d2d 2d0a 2020 2020 6e6f 7463 685f  -----.    notch_
-0000bc50: 7369 7a65 203a 2061 7272 6179 2d6c 696b  size : array-lik
-0000bc60: 655b 325d 206f 6620 696e 7420 6f72 2066  e[2] of int or f
-0000bc70: 6c61 6f74 0a20 2020 2020 2020 2078 2c20  laot.        x, 
-0000bc80: 7920 7369 7a65 206f 6620 7468 6520 6e6f  y size of the no
-0000bc90: 7463 6865 732e 0a20 2020 206e 6f74 6368  tches..    notch
-0000bca0: 5f73 7061 6369 6e67 203a 2069 6e74 206f  _spacing : int o
-0000bcb0: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
-0000bcc0: 5370 6163 696e 6720 6265 7477 6565 6e20  Spacing between 
-0000bcd0: 6e6f 7463 6865 7320 6f6e 2074 6865 2063  notches on the c
-0000bce0: 6f6e 7472 6f6c 2073 7472 7563 7475 7265  ontrol structure
-0000bcf0: 2e0a 2020 2020 6e75 6d5f 6e6f 7463 6865  ..    num_notche
-0000bd00: 7320 3a20 696e 740a 2020 2020 2020 2020  s : int.        
-0000bd10: 4e75 6d62 6572 206f 6620 6e6f 7463 6865  Number of notche
-0000bd20: 7320 6f6e 206f 6e65 2073 6964 6520 6f66  s on one side of
-0000bd30: 2074 6865 2073 7472 7563 7475 7265 2028   the structure (
-0000bd40: 746f 7461 6c20 6e75 6d62 6572 206f 660a  total number of.
-0000bd50: 2020 2020 2020 2020 6e6f 7463 6865 7320          notches 
-0000bd60: 6973 2032 2a6e 756d 5f6e 6f74 6368 6573  is 2*num_notches
-0000bd70: 202b 2031 292e 0a20 2020 206f 6666 7365   + 1)..    offse
-0000bd80: 745f 7065 725f 6e6f 7463 6820 3a20 696e  t_per_notch : in
-0000bd90: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
-0000bda0: 2020 2054 6865 2061 6d6f 756e 7420 6f66     The amount of
-0000bdb0: 2068 6f72 697a 6f6e 7461 6c20 6f66 6673   horizontal offs
-0000bdc0: 6574 2074 6f20 6170 706c 7920 746f 2074  et to apply to t
-0000bdd0: 6865 206e 6f74 6368 2073 7061 6369 6e67  he notch spacing
-0000bde0: 2070 6572 0a20 2020 2020 2020 206e 6f74   per.        not
-0000bdf0: 6368 206f 6e20 7468 6520 6e6f 6e2d 636f  ch on the non-co
-0000be00: 6e74 726f 6c20 7374 7275 6374 7572 652e  ntrol structure.
-0000be10: 0a20 2020 2072 6f77 5f73 7061 6369 6e67  .    row_spacing
-0000be20: 203a 2069 6e74 206f 7220 666c 6f61 740a   : int or float.
-0000be30: 2020 2020 2020 2020 5468 6520 616d 6f75          The amou
-0000be40: 6e74 206f 6620 7665 7274 6963 616c 2073  nt of vertical s
-0000be50: 7061 6365 2062 6574 7765 656e 2074 6865  pace between the
-0000be60: 2063 6f6e 7472 6f6c 2061 6e64 206e 6f6e   control and non
-0000be70: 2d63 6f6e 7472 6f6c 0a20 2020 2020 2020  -control.       
-0000be80: 2073 7472 7563 7475 7265 732e 0a20 2020   structures..   
-0000be90: 206c 6179 6572 3120 3a20 696e 742c 2061   layer1 : int, a
-0000bea0: 7272 6179 2d6c 696b 655b 325d 2c20 6f72  rray-like[2], or
-0000beb0: 2073 6574 0a20 2020 2020 2020 2053 7065   set.        Spe
-0000bec0: 6369 6669 6320 6c61 7965 7228 7329 2074  cific layer(s) t
-0000bed0: 6f20 7075 7420 7468 6520 636f 6e74 726f  o put the contro
-0000bee0: 6c20 6765 6f6d 6574 7279 206f 6e2e 0a20  l geometry on.. 
-0000bef0: 2020 206c 6179 6572 3220 3a20 696e 742c     layer2 : int,
-0000bf00: 2061 7272 6179 2d6c 696b 655b 325d 2c20   array-like[2], 
-0000bf10: 6f72 2073 6574 0a20 2020 2020 2020 2053  or set.        S
-0000bf20: 7065 6369 6669 6320 6c61 7965 7228 7329  pecific layer(s)
-0000bf30: 2074 6f20 7075 7420 7468 6520 6e6f 6e2d   to put the non-
-0000bf40: 636f 6e74 726f 6c20 6765 6f6d 6574 7279  control geometry
-0000bf50: 206f 6e2e 0a0a 2020 2020 5265 7475 726e   on...    Return
-0000bf60: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-0000bf70: 2020 4465 7669 6365 0a20 2020 2020 2020    Device.       
-0000bf80: 2041 2044 6576 6963 6520 636f 6e74 6169   A Device contai
-0000bf90: 6e69 6e67 2074 6865 2063 616c 6970 6572  ning the caliper
-0000bfa0: 2073 7472 7563 7475 7265 732e 0a20 2020   structures..   
-0000bfb0: 2022 2222 0a20 2020 2044 203d 2044 6576   """.    D = Dev
-0000bfc0: 6963 6528 226c 6974 686f 5f63 616c 6970  ice("litho_calip
-0000bfd0: 6572 7322 290a 2020 2020 6e75 6d5f 6e6f  ers").    num_no
-0000bfe0: 7463 6865 735f 746f 7461 6c20 3d20 6e75  tches_total = nu
-0000bff0: 6d5f 6e6f 7463 6865 7320 2a20 3220 2b20  m_notches * 2 + 
-0000c000: 310a 2020 2020 6365 6e74 7265 5f6e 6f74  1.    centre_not
-0000c010: 6368 203d 206e 756d 5f6e 6f74 6368 6573  ch = num_notches
-0000c020: 0a20 2020 2052 3120 3d20 7265 6374 616e  .    R1 = rectan
-0000c030: 676c 6528 7369 7a65 3d28 6e6f 7463 685f  gle(size=(notch_
-0000c040: 7369 7a65 292c 206c 6179 6572 3d6c 6179  size), layer=lay
-0000c050: 6572 3129 0a20 2020 2052 3220 3d20 7265  er1).    R2 = re
-0000c060: 6374 616e 676c 6528 7369 7a65 3d28 6e6f  ctangle(size=(no
-0000c070: 7463 685f 7369 7a65 292c 206c 6179 6572  tch_size), layer
-0000c080: 3d6c 6179 6572 3229 0a20 2020 2066 6f72  =layer2).    for
-0000c090: 2069 2069 6e20 7261 6e67 6528 6e75 6d5f   i in range(num_
-0000c0a0: 6e6f 7463 6865 735f 746f 7461 6c29 3a0a  notches_total):.
-0000c0b0: 2020 2020 2020 2020 6966 2069 203d 3d20          if i == 
-0000c0c0: 6365 6e74 7265 5f6e 6f74 6368 3a0a 2020  centre_notch:.  
-0000c0d0: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
-0000c0e0: 2020 2020 2020 2020 2020 2020 442e 6164              D.ad
-0000c0f0: 645f 7265 6628 5231 290a 2020 2020 2020  d_ref(R1).      
-0000c100: 2020 2020 2020 2020 2020 2e6d 6f76 6578            .movex
-0000c110: 2869 202a 2028 6e6f 7463 685f 7369 7a65  (i * (notch_size
-0000c120: 5b30 5d20 2b20 6e6f 7463 685f 7370 6163  [0] + notch_spac
-0000c130: 696e 6729 290a 2020 2020 2020 2020 2020  ing)).          
-0000c140: 2020 2020 2020 2e6d 6f76 6579 286e 6f74        .movey(not
-0000c150: 6368 5f73 697a 655b 315d 290a 2020 2020  ch_size[1]).    
-0000c160: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000c170: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
-0000c180: 2020 2020 2020 2020 442e 6164 645f 7265          D.add_re
-0000c190: 6628 5232 290a 2020 2020 2020 2020 2020  f(R2).          
-0000c1a0: 2020 2020 2020 2e6d 6f76 6578 280a 2020        .movex(.  
-0000c1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c1c0: 2020 6920 2a20 286e 6f74 6368 5f73 697a    i * (notch_siz
-0000c1d0: 655b 305d 202b 206e 6f74 6368 5f73 7061  e[0] + notch_spa
-0000c1e0: 6369 6e67 290a 2020 2020 2020 2020 2020  cing).          
-0000c1f0: 2020 2020 2020 2020 2020 2b20 6f66 6673            + offs
-0000c200: 6574 5f70 6572 5f6e 6f74 6368 202a 2028  et_per_notch * (
-0000c210: 6365 6e74 7265 5f6e 6f74 6368 202d 2069  centre_notch - i
-0000c220: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000c230: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000c240: 2020 2020 2e6d 6f76 6579 282d 3220 2a20      .movey(-2 * 
-0000c250: 6e6f 7463 685f 7369 7a65 5b31 5d20 2d20  notch_size[1] - 
-0000c260: 726f 775f 7370 6163 696e 6729 0a20 2020  row_spacing).   
-0000c270: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000c280: 2020 2044 2e61 6464 5f72 6566 2852 3129     D.add_ref(R1)
-0000c290: 2e6d 6f76 6578 2869 202a 2028 6e6f 7463  .movex(i * (notc
-0000c2a0: 685f 7369 7a65 5b30 5d20 2b20 6e6f 7463  h_size[0] + notc
-0000c2b0: 685f 7370 6163 696e 6729 290a 2020 2020  h_spacing)).    
-0000c2c0: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
-0000c2d0: 2020 442e 6164 645f 7265 6628 5232 290a    D.add_ref(R2).
-0000c2e0: 2020 2020 2020 2020 2020 2020 2e6d 6f76              .mov
-0000c2f0: 6578 280a 2020 2020 2020 2020 2020 2020  ex(.            
-0000c300: 2020 2020 6920 2a20 286e 6f74 6368 5f73      i * (notch_s
-0000c310: 697a 655b 305d 202b 206e 6f74 6368 5f73  ize[0] + notch_s
-0000c320: 7061 6369 6e67 290a 2020 2020 2020 2020  pacing).        
-0000c330: 2020 2020 2020 2020 2b20 6f66 6673 6574          + offset
-0000c340: 5f70 6572 5f6e 6f74 6368 202a 2028 6365  _per_notch * (ce
-0000c350: 6e74 7265 5f6e 6f74 6368 202d 2069 290a  ntre_notch - i).
-0000c360: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000c370: 2020 2020 2020 2020 2020 2e6d 6f76 6579            .movey
-0000c380: 282d 6e6f 7463 685f 7369 7a65 5b31 5d20  (-notch_size[1] 
-0000c390: 2d20 726f 775f 7370 6163 696e 6729 0a20  - row_spacing). 
-0000c3a0: 2020 2020 2020 2029 0a0a 2020 2020 7265         )..    re
-0000c3b0: 7475 726e 2044 0a0a 0a64 6566 206c 6974  turn D...def lit
-0000c3c0: 686f 5f72 756c 6572 280a 2020 2020 6865  ho_ruler(.    he
-0000c3d0: 6967 6874 3d32 2c0a 2020 2020 7769 6474  ight=2,.    widt
-0000c3e0: 683d 302e 352c 0a20 2020 2073 7061 6369  h=0.5,.    spaci
-0000c3f0: 6e67 3d31 2e32 2c0a 2020 2020 7363 616c  ng=1.2,.    scal
-0000c400: 653d 5b33 2c20 312c 2031 2c20 312c 2031  e=[3, 1, 1, 1, 1
-0000c410: 2c20 322c 2031 2c20 312c 2031 2c20 315d  , 2, 1, 1, 1, 1]
-0000c420: 2c0a 2020 2020 6e75 6d5f 6d61 726b 733d  ,.    num_marks=
-0000c430: 3231 2c0a 2020 2020 6c61 7965 723d 302c  21,.    layer=0,
-0000c440: 0a29 3a0a 2020 2020 2222 2243 7265 6174  .):.    """Creat
-0000c450: 6573 2061 2072 756c 6572 2073 7472 7563  es a ruler struc
-0000c460: 7475 7265 2066 6f72 206c 6974 686f 6772  ture for lithogr
-0000c470: 6170 6869 6320 6d65 6173 7572 656d 656e  aphic measuremen
-0000c480: 7420 7769 7468 206d 6172 6b73 206f 660a  t with marks of.
-0000c490: 2020 2020 7661 7279 696e 6720 7363 616c      varying scal
-0000c4a0: 6573 2074 6f20 616c 6c6f 7720 666f 7220  es to allow for 
-0000c4b0: 6561 7379 2072 6561 6469 6e67 2062 7920  easy reading by 
-0000c4c0: 6579 652e 0a0a 2020 2020 5061 7261 6d65  eye...    Parame
-0000c4d0: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
-0000c4e0: 2d2d 2d0a 2020 2020 6865 6967 6874 203a  ---.    height :
-0000c4f0: 2066 6c6f 6174 0a20 2020 2020 2020 2048   float.        H
-0000c500: 6569 6768 7420 6f66 2074 6865 2072 756c  eight of the rul
-0000c510: 696e 6720 6d61 726b 732e 0a20 2020 2077  ing marks..    w
-0000c520: 6964 7468 203a 2066 6c6f 6174 0a20 2020  idth : float.   
-0000c530: 2020 2020 2057 6964 7468 206f 6620 7468       Width of th
-0000c540: 6520 7275 6c69 6e67 206d 6172 6b73 2e0a  e ruling marks..
-0000c550: 2020 2020 7370 6163 696e 6720 3a20 666c      spacing : fl
-0000c560: 6f61 740a 2020 2020 2020 2020 4365 6e74  oat.        Cent
-0000c570: 6572 2d74 6f2d 6365 6e74 6572 2073 7061  er-to-center spa
-0000c580: 6369 6e67 206f 6620 7468 6520 7275 6c69  cing of the ruli
-0000c590: 6e67 206d 6172 6b73 0a20 2020 2073 6361  ng marks.    sca
-0000c5a0: 6c65 203a 2061 7272 6179 2d6c 696b 650a  le : array-like.
-0000c5b0: 2020 2020 2020 2020 4865 6967 6874 2073          Height s
-0000c5c0: 6361 6c65 2070 6174 7465 726e 206f 6620  cale pattern of 
-0000c5d0: 6d61 726b 730a 2020 2020 6e75 6d5f 6d61  marks.    num_ma
-0000c5e0: 726b 7320 3a20 696e 740a 2020 2020 2020  rks : int.      
-0000c5f0: 2020 546f 7461 6c20 6e75 6d62 6572 206f    Total number o
-0000c600: 6620 6d61 726b 7320 746f 2067 656e 6572  f marks to gener
-0000c610: 6174 650a 2020 2020 6e75 6d5f 6d61 726b  ate.    num_mark
-0000c620: 7320 3a20 696e 740a 2020 2020 2020 2020  s : int.        
-0000c630: 546f 7461 6c20 6e75 6d62 6572 206f 6620  Total number of 
-0000c640: 6d61 726b 7320 746f 2067 656e 6572 6174  marks to generat
-0000c650: 650a 2020 2020 6c61 7965 7220 3a20 696e  e.    layer : in
-0000c660: 742c 2061 7272 6179 2d6c 696b 655b 325d  t, array-like[2]
-0000c670: 2c20 6f72 2073 6574 0a20 2020 2020 2020  , or set.       
-0000c680: 2053 7065 6369 6669 6320 6c61 7965 7228   Specific layer(
-0000c690: 7329 2074 6f20 7075 7420 7468 6520 7275  s) to put the ru
-0000c6a0: 6c65 7220 6765 6f6d 6574 7279 206f 6e2e  ler geometry on.
-0000c6b0: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
-0000c6c0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 4465    -------.    De
-0000c6d0: 7669 6365 0a20 2020 2020 2020 2041 2044  vice.        A D
-0000c6e0: 6576 6963 6520 636f 6e74 6169 6e69 6e67  evice containing
-0000c6f0: 2074 6865 2072 756c 6572 2073 7472 7563   the ruler struc
-0000c700: 7475 7265 0a20 2020 2022 2222 0a0a 2020  ture.    """..  
-0000c710: 2020 4420 3d20 4465 7669 6365 2822 6c69    D = Device("li
-0000c720: 7468 6f5f 7275 6c65 7222 290a 2020 2020  tho_ruler").    
-0000c730: 666f 7220 6e20 696e 2072 616e 6765 286e  for n in range(n
-0000c740: 756d 5f6d 6172 6b73 293a 0a20 2020 2020  um_marks):.     
-0000c750: 2020 2068 203d 2068 6569 6768 7420 2a20     h = height * 
-0000c760: 7363 616c 655b 6e20 2520 6c65 6e28 7363  scale[n % len(sc
-0000c770: 616c 6529 5d0a 2020 2020 2020 2020 4420  ale)].        D 
-0000c780: 3c3c 2072 6563 7461 6e67 6c65 2873 697a  << rectangle(siz
-0000c790: 653d 2877 6964 7468 2c20 6829 2c20 6c61  e=(width, h), la
-0000c7a0: 7965 723d 6c61 7965 7229 0a0a 2020 2020  yer=layer)..    
-0000c7b0: 442e 6469 7374 7269 6275 7465 2864 6972  D.distribute(dir
-0000c7c0: 6563 7469 6f6e 3d22 7822 2c20 7370 6163  ection="x", spac
-0000c7d0: 696e 673d 7370 6163 696e 672c 2073 6570  ing=spacing, sep
-0000c7e0: 6172 6174 696f 6e3d 4661 6c73 652c 2065  aration=False, e
-0000c7f0: 6467 653d 2278 2229 0a20 2020 2044 2e61  dge="x").    D.a
-0000c800: 6c69 676e 2861 6c69 676e 6d65 6e74 3d22  lign(alignment="
-0000c810: 796d 696e 2229 0a20 2020 2044 2e66 6c61  ymin").    D.fla
-0000c820: 7474 656e 2829 0a20 2020 2072 6574 7572  tten().    retur
-0000c830: 6e20 440a 0a0a 2320 3d3d 3d3d 3d3d 3d3d  n D...# ========
-0000c840: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0000c850: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0000c860: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0000c870: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0000c880: 3d3d 3d3d 3d3d 0a23 0a23 2055 7469 6c69  ======.#.# Utili
-0000c890: 7479 2066 756e 6374 696f 6e73 0a23 0a23  ty functions.#.#
-0000c8a0: 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d   ===============
-0000c8b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0000c8c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0000c8d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0000c8e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a  ===============.
-0000c8f0: 0a0a 6465 6620 6578 7472 6163 7428 442c  ..def extract(D,
-0000c900: 206c 6179 6572 733d 5b30 2c20 315d 293a   layers=[0, 1]):
-0000c910: 0a20 2020 2022 2222 4578 7472 6163 7473  .    """Extracts
-0000c920: 2070 6f6c 7967 6f6e 7320 6672 6f6d 2061   polygons from a
-0000c930: 2067 6976 656e 2044 6576 6963 652e 0a0a   given Device...
-0000c940: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-0000c950: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-0000c960: 2020 4420 3a20 4465 7669 6365 0a20 2020    D : Device.   
-0000c970: 2020 2020 2044 6576 6963 6520 746f 2065       Device to e
-0000c980: 7874 7261 6374 2070 6f6c 7967 6f6e 7320  xtract polygons 
-0000c990: 6672 6f6d 2e0a 2020 2020 6c61 7965 7273  from..    layers
-0000c9a0: 203a 2061 7272 6179 2d6c 696b 655b 325d   : array-like[2]
-0000c9b0: 206f 7220 7365 740a 2020 2020 2020 2020   or set.        
-0000c9c0: 5370 6563 6966 6963 206c 6179 6572 2873  Specific layer(s
-0000c9d0: 2920 746f 2065 7874 7261 6374 2070 6f6c  ) to extract pol
-0000c9e0: 7967 6f6e 2067 656f 6d65 7472 7920 6672  ygon geometry fr
-0000c9f0: 6f6d 2e0a 0a20 2020 2052 6574 7572 6e73  om...    Returns
-0000ca00: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
-0000ca10: 2044 6576 6963 650a 2020 2020 2020 2020   Device.        
-0000ca20: 4120 4465 7669 6365 2063 6f6e 7461 696e  A Device contain
-0000ca30: 696e 6720 7468 6520 6578 7472 6163 7465  ing the extracte
-0000ca40: 6420 706f 6c79 676f 6e73 2e0a 2020 2020  d polygons..    
-0000ca50: 2222 220a 2020 2020 445f 6578 7472 6163  """.    D_extrac
-0000ca60: 7465 6420 3d20 4465 7669 6365 2822 6578  ted = Device("ex
-0000ca70: 7472 6163 7422 290a 2020 2020 6966 206e  tract").    if n
-0000ca80: 6f74 2069 7369 6e73 7461 6e63 6528 6c61  ot isinstance(la
-0000ca90: 7965 7273 2c20 286c 6973 742c 2074 7570  yers, (list, tup
-0000caa0: 6c65 2929 3a0a 2020 2020 2020 2020 7261  le)):.        ra
-0000cab0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-0000cac0: 2020 2020 2020 2020 2020 2020 225b 5048              "[PH
-0000cad0: 4944 4c5d 2070 672e 6578 7472 6163 7428  IDL] pg.extract(
-0000cae0: 2920 4172 6775 6d65 6e74 2060 6c61 7965  ) Argument `laye
-0000caf0: 7273 6020 6e65 6564 7320 746f 2062 6520  rs` needs to be 
-0000cb00: 220a 2020 2020 2020 2020 2020 2020 2270  ".            "p
-0000cb10: 6173 7365 6420 6120 6c69 7374 206f 7220  assed a list or 
-0000cb20: 7475 706c 6522 0a20 2020 2020 2020 2029  tuple".        )
-0000cb30: 0a20 2020 2070 6f6c 795f 6469 6374 203d  .    poly_dict =
-0000cb40: 2044 2e67 6574 5f70 6f6c 7967 6f6e 7328   D.get_polygons(
-0000cb50: 6279 5f73 7065 633d 5472 7565 290a 2020  by_spec=True).  
-0000cb60: 2020 7061 7273 6564 5f6c 6179 6572 5f6c    parsed_layer_l
-0000cb70: 6973 7420 3d20 5b5f 7061 7273 655f 6c61  ist = [_parse_la
-0000cb80: 7965 7228 6c61 7965 7229 2066 6f72 206c  yer(layer) for l
-0000cb90: 6179 6572 2069 6e20 6c61 7965 7273 5d0a  ayer in layers].
-0000cba0: 2020 2020 666f 7220 6c61 7965 722c 2070      for layer, p
-0000cbb0: 6f6c 7973 2069 6e20 706f 6c79 5f64 6963  olys in poly_dic
-0000cbc0: 742e 6974 656d 7328 293a 0a20 2020 2020  t.items():.     
-0000cbd0: 2020 2069 6620 5f70 6172 7365 5f6c 6179     if _parse_lay
-0000cbe0: 6572 286c 6179 6572 2920 696e 2070 6172  er(layer) in par
-0000cbf0: 7365 645f 6c61 7965 725f 6c69 7374 3a0a  sed_layer_list:.
-0000cc00: 2020 2020 2020 2020 2020 2020 445f 6578              D_ex
-0000cc10: 7472 6163 7465 642e 6164 645f 706f 6c79  tracted.add_poly
-0000cc20: 676f 6e28 706f 6c79 732c 206c 6179 6572  gon(polys, layer
-0000cc30: 3d6c 6179 6572 290a 2020 2020 7265 7475  =layer).    retu
-0000cc40: 726e 2044 5f65 7874 7261 6374 6564 0a0a  rn D_extracted..
-0000cc50: 0a64 6566 2063 6f70 7928 4429 3a0a 2020  .def copy(D):.  
-0000cc60: 2020 2222 2243 6f70 6965 7320 6120 4465    """Copies a De
-0000cc70: 7669 6365 2e0a 0a20 2020 2050 6172 616d  vice...    Param
-0000cc80: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
-0000cc90: 2d2d 2d2d 0a20 2020 2044 203a 2044 6576  ----.    D : Dev
-0000cca0: 6963 650a 2020 2020 2020 2020 4465 7669  ice.        Devi
-0000ccb0: 6365 2074 6f20 6265 2063 6f70 6965 642e  ce to be copied.
-0000ccc0: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
-0000ccd0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 4465    -------.    De
-0000cce0: 7669 6365 0a20 2020 2020 2020 2043 6f70  vice.        Cop
-0000ccf0: 6965 6420 4465 7669 6365 2e0a 2020 2020  ied Device..    
-0000cd00: 2222 220a 2020 2020 445f 636f 7079 203d  """.    D_copy =
-0000cd10: 2044 6576 6963 6528 6e61 6d65 3d44 2e6e   Device(name=D.n
-0000cd20: 616d 6529 0a20 2020 2044 5f63 6f70 792e  ame).    D_copy.
-0000cd30: 696e 666f 203d 2070 7974 686f 6e5f 636f  info = python_co
-0000cd40: 7079 2e64 6565 7063 6f70 7928 442e 696e  py.deepcopy(D.in
-0000cd50: 666f 290a 2020 2020 666f 7220 7265 6620  fo).    for ref 
-0000cd60: 696e 2044 2e72 6566 6572 656e 6365 733a  in D.references:
-0000cd70: 0a20 2020 2020 2020 206e 6577 5f72 6566  .        new_ref
-0000cd80: 203d 2044 6576 6963 6552 6566 6572 656e   = DeviceReferen
-0000cd90: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
-0000cda0: 6465 7669 6365 3d72 6566 2e70 6172 656e  device=ref.paren
-0000cdb0: 742c 0a20 2020 2020 2020 2020 2020 206f  t,.            o
-0000cdc0: 7269 6769 6e3d 7265 662e 6f72 6967 696e  rigin=ref.origin
-0000cdd0: 2c0a 2020 2020 2020 2020 2020 2020 726f  ,.            ro
-0000cde0: 7461 7469 6f6e 3d72 6566 2e72 6f74 6174  tation=ref.rotat
-0000cdf0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
-0000ce00: 206d 6167 6e69 6669 6361 7469 6f6e 3d72   magnification=r
-0000ce10: 6566 2e6d 6167 6e69 6669 6361 7469 6f6e  ef.magnification
-0000ce20: 2c0a 2020 2020 2020 2020 2020 2020 785f  ,.            x_
-0000ce30: 7265 666c 6563 7469 6f6e 3d72 6566 2e78  reflection=ref.x
-0000ce40: 5f72 6566 6c65 6374 696f 6e2c 0a20 2020  _reflection,.   
-0000ce50: 2020 2020 2029 0a20 2020 2020 2020 206e       ).        n
-0000ce60: 6577 5f72 6566 2e6f 776e 6572 203d 2044  ew_ref.owner = D
-0000ce70: 5f63 6f70 790a 2020 2020 2020 2020 445f  _copy.        D_
-0000ce80: 636f 7079 2e61 6464 286e 6577 5f72 6566  copy.add(new_ref
-0000ce90: 290a 2020 2020 2020 2020 666f 7220 616c  ).        for al
-0000cea0: 6961 735f 6e61 6d65 2c20 616c 6961 735f  ias_name, alias_
-0000ceb0: 7265 6620 696e 2044 2e61 6c69 6173 6573  ref in D.aliases
-0000cec0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-0000ced0: 2020 2020 2020 6966 2061 6c69 6173 5f72        if alias_r
-0000cee0: 6566 203d 3d20 7265 663a 0a20 2020 2020  ef == ref:.     
-0000cef0: 2020 2020 2020 2020 2020 2044 5f63 6f70             D_cop
-0000cf00: 792e 616c 6961 7365 735b 616c 6961 735f  y.aliases[alias_
-0000cf10: 6e61 6d65 5d20 3d20 6e65 775f 7265 660a  name] = new_ref.
-0000cf20: 0a20 2020 2066 6f72 2070 6f72 7420 696e  .    for port in
-0000cf30: 2044 2e70 6f72 7473 2e76 616c 7565 7328   D.ports.values(
-0000cf40: 293a 0a20 2020 2020 2020 2044 5f63 6f70  ):.        D_cop
-0000cf50: 792e 6164 645f 706f 7274 2870 6f72 743d  y.add_port(port=
-0000cf60: 706f 7274 290a 2020 2020 666f 7220 706f  port).    for po
-0000cf70: 6c79 2069 6e20 442e 706f 6c79 676f 6e73  ly in D.polygons
-0000cf80: 3a0a 2020 2020 2020 2020 445f 636f 7079  :.        D_copy
-0000cf90: 2e61 6464 5f70 6f6c 7967 6f6e 2870 6f6c  .add_polygon(pol
-0000cfa0: 7929 0a20 2020 2066 6f72 206c 6162 656c  y).    for label
-0000cfb0: 2069 6e20 442e 6c61 6265 6c73 3a0a 2020   in D.labels:.  
-0000cfc0: 2020 2020 2020 445f 636f 7079 2e61 6464        D_copy.add
-0000cfd0: 5f6c 6162 656c 280a 2020 2020 2020 2020  _label(.        
-0000cfe0: 2020 2020 7465 7874 3d6c 6162 656c 2e74      text=label.t
-0000cff0: 6578 742c 0a20 2020 2020 2020 2020 2020  ext,.           
-0000d000: 2070 6f73 6974 696f 6e3d 6c61 6265 6c2e   position=label.
-0000d010: 706f 7369 7469 6f6e 2c0a 2020 2020 2020  position,.      
-0000d020: 2020 2020 2020 6c61 7965 723d 286c 6162        layer=(lab
-0000d030: 656c 2e6c 6179 6572 2c20 6c61 6265 6c2e  el.layer, label.
-0000d040: 7465 7874 7479 7065 292c 0a20 2020 2020  texttype),.     
-0000d050: 2020 2029 0a20 2020 2072 6574 7572 6e20     ).    return 
-0000d060: 445f 636f 7079 0a0a 0a64 6566 2064 6565  D_copy...def dee
-0000d070: 7063 6f70 7928 4429 3a0a 2020 2020 2222  pcopy(D):.    ""
-0000d080: 2244 6565 7020 636f 7069 6573 2061 2044  "Deep copies a D
-0000d090: 6576 6963 652e 0a0a 2020 2020 5061 7261  evice...    Para
-0000d0a0: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
-0000d0b0: 2d2d 2d2d 2d0a 2020 2020 4420 3a20 4465  -----.    D : De
-0000d0c0: 7669 6365 0a20 2020 2020 2020 2044 6576  vice.        Dev
-0000d0d0: 6963 6520 746f 2062 6520 6465 6570 2063  ice to be deep c
-0000d0e0: 6f70 6965 642e 0a0a 2020 2020 5265 7475  opied...    Retu
-0000d0f0: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
-0000d100: 2020 2020 4465 7669 6365 0a20 2020 2020      Device.     
-0000d110: 2020 2044 6565 7020 636f 7069 6564 2044     Deep copied D
-0000d120: 6576 6963 652e 0a20 2020 2022 2222 0a20  evice..    """. 
-0000d130: 2020 2044 5f63 6f70 7920 3d20 7079 7468     D_copy = pyth
-0000d140: 6f6e 5f63 6f70 792e 6465 6570 636f 7079  on_copy.deepcopy
-0000d150: 2844 290a 2020 2020 445f 636f 7079 2e75  (D).    D_copy.u
-0000d160: 6964 203d 2044 6576 6963 652e 5f6e 6578  id = Device._nex
-0000d170: 745f 7569 640a 2020 2020 4465 7669 6365  t_uid.    Device
-0000d180: 2e5f 6e65 7874 5f75 6964 202b 3d20 310a  ._next_uid += 1.
-0000d190: 2020 2020 445f 636f 7079 2e6e 616d 6520      D_copy.name 
-0000d1a0: 3d20 442e 6e61 6d65 0a20 2020 2023 204d  = D.name.    # M
-0000d1b0: 616b 6520 7375 7265 205f 6262 5f76 616c  ake sure _bb_val
-0000d1c0: 6964 2069 7320 7365 7420 746f 2066 616c  id is set to fal
-0000d1d0: 7365 2066 6f72 2074 6865 7365 206e 6577  se for these new
-0000d1e0: 206f 626a 6563 7473 2073 6f20 6e65 770a   objects so new.
-0000d1f0: 2020 2020 2320 626f 756e 6469 6e67 2062      # bounding b
-0000d200: 6f78 6573 2061 7265 2063 7265 6174 6564  oxes are created
-0000d210: 2069 6e20 7468 6520 6361 6368 650a 2020   in the cache.  
-0000d220: 2020 666f 7220 4420 696e 2044 5f63 6f70    for D in D_cop
-0000d230: 792e 6765 745f 6465 7065 6e64 656e 6369  y.get_dependenci
-0000d240: 6573 2854 7275 6529 3a0a 2020 2020 2020  es(True):.      
-0000d250: 2020 442e 5f62 625f 7661 6c69 6420 3d20    D._bb_valid = 
-0000d260: 4661 6c73 650a 2020 2020 445f 636f 7079  False.    D_copy
-0000d270: 2e5f 6262 5f76 616c 6964 203d 2046 616c  ._bb_valid = Fal
-0000d280: 7365 0a0a 2020 2020 7265 7475 726e 2044  se..    return D
-0000d290: 5f63 6f70 790a 0a0a 6465 6620 636f 7079  _copy...def copy
-0000d2a0: 5f6c 6179 6572 2844 2c20 6c61 7965 723d  _layer(D, layer=
-0000d2b0: 312c 206e 6577 5f6c 6179 6572 3d32 293a  1, new_layer=2):
-0000d2c0: 0a20 2020 2022 2222 436f 7069 6573 2061  .    """Copies a
-0000d2d0: 206c 6179 6572 2077 6974 6869 6e20 6120   layer within a 
-0000d2e0: 4465 7669 6365 2074 6f20 616e 6f74 6865  Device to anothe
-0000d2f0: 7220 6c61 7965 7220 696e 2074 6865 2073  r layer in the s
-0000d300: 616d 6520 4465 7669 6365 2e0a 0a20 2020  ame Device...   
-0000d310: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-0000d320: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2044  ----------.    D
-0000d330: 203a 2044 6576 6963 650a 2020 2020 2020   : Device.      
-0000d340: 2020 4465 7669 6365 2063 6f6e 7461 696e    Device contain
-0000d350: 696e 6720 6c61 7965 7220 746f 2062 6520  ing layer to be 
-0000d360: 636f 7069 6564 2e0a 2020 2020 6c61 7965  copied..    laye
-0000d370: 7220 3a20 696e 742c 2061 7272 6179 2d6c  r : int, array-l
-0000d380: 696b 655b 325d 2c20 6f72 2073 6574 0a20  ike[2], or set. 
-0000d390: 2020 2020 2020 2053 7065 6369 6669 6320         Specific 
-0000d3a0: 6c61 7965 7228 7329 2074 6f20 636f 7079  layer(s) to copy
-0000d3b0: 2e0a 2020 2020 6e65 775f 6c61 7965 7220  ..    new_layer 
-0000d3c0: 3a20 696e 742c 2061 7272 6179 2d6c 696b  : int, array-lik
-0000d3d0: 655b 325d 2c20 6f72 2073 6574 0a20 2020  e[2], or set.   
-0000d3e0: 2020 2020 2053 7065 6369 6669 6320 6c61       Specific la
-0000d3f0: 7965 7228 7329 2074 6f20 7075 7420 636f  yer(s) to put co
-0000d400: 7069 6564 206c 6179 6572 206f 6e2e 0a0a  pied layer on...
-0000d410: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-0000d420: 2d2d 2d2d 2d2d 2d0a 2020 2020 4465 7669  -------.    Devi
-0000d430: 6365 0a20 2020 2020 2020 2041 2044 6576  ce.        A Dev
-0000d440: 6963 6520 636f 6e74 6169 6e69 6e67 2074  ice containing t
-0000d450: 6865 206f 7269 6769 6e61 6c20 616e 6420  he original and 
-0000d460: 636f 7069 6564 206c 6179 6572 732e 0a20  copied layers.. 
-0000d470: 2020 2022 2222 0a20 2020 2044 5f63 6f70     """.    D_cop
-0000d480: 6965 645f 6c61 7965 7220 3d20 6578 7472  ied_layer = extr
-0000d490: 6163 7428 442c 206c 6179 6572 733d 5b6c  act(D, layers=[l
-0000d4a0: 6179 6572 5d29 0a20 2020 2044 5f63 6f70  ayer]).    D_cop
-0000d4b0: 6965 645f 6c61 7965 722e 666c 6174 7465  ied_layer.flatte
-0000d4c0: 6e28 7369 6e67 6c65 5f6c 6179 6572 3d6e  n(single_layer=n
-0000d4d0: 6577 5f6c 6179 6572 290a 2020 2020 7265  ew_layer).    re
-0000d4e0: 7475 726e 2044 5f63 6f70 6965 645f 6c61  turn D_copied_la
-0000d4f0: 7965 720a 0a0a 6465 6620 696d 706f 7274  yer...def import
-0000d500: 5f67 6473 2866 696c 656e 616d 652c 2063  _gds(filename, c
-0000d510: 656c 6c6e 616d 653d 4e6f 6e65 2c20 666c  ellname=None, fl
-0000d520: 6174 7465 6e3d 4661 6c73 6529 3a0a 2020  atten=False):.  
-0000d530: 2020 2222 2249 6d70 6f72 7473 2061 2047    """Imports a G
-0000d540: 4453 2066 696c 6520 616e 6420 7265 7475  DS file and retu
-0000d550: 726e 7320 6120 4465 7669 6365 2077 6974  rns a Device wit
-0000d560: 6820 616c 6c20 7468 6520 636f 7272 6573  h all the corres
-0000d570: 706f 6e64 696e 670a 2020 2020 6765 6f6d  ponding.    geom
-0000d580: 6574 7279 0a0a 2020 2020 5061 7261 6d65  etry..    Parame
-0000d590: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
-0000d5a0: 2d2d 2d0a 2020 2020 6669 6c65 6e61 6d65  ---.    filename
-0000d5b0: 203a 2073 7472 0a20 2020 2020 2020 2050   : str.        P
-0000d5c0: 6174 6820 6f72 206e 616d 6520 6f66 2066  ath or name of f
-0000d5d0: 696c 6520 746f 2062 6520 696d 706f 7274  ile to be import
-0000d5e0: 6564 0a20 2020 2063 656c 6c6e 616d 6520  ed.    cellname 
-0000d5f0: 3a20 7374 7220 6f72 204e 6f6e 650a 2020  : str or None.  
-0000d600: 2020 2020 2020 4e61 6d65 206f 6620 7468        Name of th
-0000d610: 6520 6365 6c6c 2074 6861 7420 7769 6c6c  e cell that will
-0000d620: 2062 6520 7265 7475 726e 6564 2061 7320   be returned as 
-0000d630: 6120 4465 7669 6365 2e20 2049 6620 4e6f  a Device.  If No
-0000d640: 6e65 2c0a 2020 2020 2020 2020 7769 6c6c  ne,.        will
-0000d650: 2061 7574 6f6d 6174 6963 616c 6c79 2073   automatically s
-0000d660: 656c 6563 7420 7468 6520 746f 706d 6f73  elect the topmos
-0000d670: 7420 6365 6c6c 0a20 2020 2066 6c61 7474  t cell.    flatt
-0000d680: 656e 203a 2062 6f6f 6c0a 2020 2020 2020  en : bool.      
-0000d690: 2020 5768 6574 6865 7220 746f 2066 6c61    Whether to fla
-0000d6a0: 7474 656e 2074 6865 2069 6d70 6f72 7465  tten the importe
-0000d6b0: 6420 6765 6f6d 6574 7279 2c20 7265 6d6f  d geometry, remo
-0000d6c0: 7669 6e67 2061 6c6c 2063 656c 6c20 6865  ving all cell he
-0000d6d0: 6972 6172 6368 790a 0a20 2020 2052 6574  irarchy..    Ret
-0000d6e0: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
-0000d6f0: 0a20 2020 2044 6576 6963 650a 2020 2020  .    Device.    
-0000d700: 2020 2020 4120 5048 4944 4c20 4465 7669      A PHIDL Devi
-0000d710: 6365 2077 6974 6820 616c 6c20 7468 6520  ce with all the 
-0000d720: 6765 6f6d 6574 7279 2f6c 6162 656c 732f  geometry/labels/
-0000d730: 6574 6320 696d 706f 7274 6564 2066 726f  etc imported fro
-0000d740: 6d20 7468 6520 4744 5320 6669 6c65 0a0a  m the GDS file..
-0000d750: 2020 2020 2222 220a 2020 2020 6764 7369      """.    gdsi
-0000d760: 695f 6c69 6220 3d20 6764 7370 792e 4764  i_lib = gdspy.Gd
-0000d770: 734c 6962 7261 7279 2829 0a20 2020 2067  sLibrary().    g
-0000d780: 6473 6969 5f6c 6962 2e72 6561 645f 6764  dsii_lib.read_gd
-0000d790: 7328 6669 6c65 6e61 6d65 290a 2020 2020  s(filename).    
-0000d7a0: 746f 705f 6c65 7665 6c5f 6365 6c6c 7320  top_level_cells 
-0000d7b0: 3d20 6764 7369 695f 6c69 622e 746f 705f  = gdsii_lib.top_
-0000d7c0: 6c65 7665 6c28 290a 2020 2020 6966 2063  level().    if c
-0000d7d0: 656c 6c6e 616d 6520 6973 206e 6f74 204e  ellname is not N
-0000d7e0: 6f6e 653a 0a20 2020 2020 2020 2069 6620  one:.        if 
-0000d7f0: 6365 6c6c 6e61 6d65 206e 6f74 2069 6e20  cellname not in 
-0000d800: 6764 7369 695f 6c69 622e 6365 6c6c 733a  gdsii_lib.cells:
-0000d810: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000d820: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-0000d830: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000d840: 5b50 4849 444c 5d20 696d 706f 7274 5f67  [PHIDL] import_g
-0000d850: 6473 2829 2054 6865 2072 6571 7565 7374  ds() The request
-0000d860: 6564 2063 656c 6c20 220a 2020 2020 2020  ed cell ".      
-0000d870: 2020 2020 2020 2020 2020 2228 6e61 6d65            "(name
-0000d880: 6420 2573 2920 6973 206e 6f74 2070 7265  d %s) is not pre
-0000d890: 7365 6e74 2069 6e20 6669 6c65 2025 7322  sent in file %s"
-0000d8a0: 2025 2028 6365 6c6c 6e61 6d65 2c20 6669   % (cellname, fi
-0000d8b0: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
-0000d8c0: 2020 2020 290a 2020 2020 2020 2020 746f      ).        to
-0000d8d0: 7063 656c 6c20 3d20 6764 7369 695f 6c69  pcell = gdsii_li
-0000d8e0: 622e 6365 6c6c 735b 6365 6c6c 6e61 6d65  b.cells[cellname
-0000d8f0: 5d0a 2020 2020 656c 6966 2063 656c 6c6e  ].    elif celln
-0000d900: 616d 6520 6973 204e 6f6e 6520 616e 6420  ame is None and 
-0000d910: 6c65 6e28 746f 705f 6c65 7665 6c5f 6365  len(top_level_ce
-0000d920: 6c6c 7329 203d 3d20 313a 0a20 2020 2020  lls) == 1:.     
-0000d930: 2020 2074 6f70 6365 6c6c 203d 2074 6f70     topcell = top
-0000d940: 5f6c 6576 656c 5f63 656c 6c73 5b30 5d0a  _level_cells[0].
-0000d950: 2020 2020 656c 6966 2063 656c 6c6e 616d      elif cellnam
-0000d960: 6520 6973 204e 6f6e 6520 616e 6420 6c65  e is None and le
-0000d970: 6e28 746f 705f 6c65 7665 6c5f 6365 6c6c  n(top_level_cell
-0000d980: 7329 203e 2031 3a0a 2020 2020 2020 2020  s) > 1:.        
-0000d990: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000d9a0: 280a 2020 2020 2020 2020 2020 2020 225b  (.            "[
-0000d9b0: 5048 4944 4c5d 2069 6d70 6f72 745f 6764  PHIDL] import_gd
-0000d9c0: 7328 2920 5468 6572 6520 6172 6520 6d75  s() There are mu
-0000d9d0: 6c74 6970 6c65 2074 6f70 2d6c 6576 656c  ltiple top-level
-0000d9e0: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-0000d9f0: 6365 6c6c 732c 2079 6f75 206d 7573 7420  cells, you must 
-0000da00: 7370 6563 6966 7920 6063 656c 6c6e 616d  specify `cellnam
-0000da10: 6560 2074 6f20 7365 6c65 6374 206f 6620  e` to select of 
-0000da20: 220a 2020 2020 2020 2020 2020 2020 226f  ".            "o
-0000da30: 6e65 206f 6620 7468 656d 220a 2020 2020  ne of them".    
-0000da40: 2020 2020 290a 0a20 2020 2069 6620 6e6f      )..    if no
-0000da50: 7420 666c 6174 7465 6e3a 0a20 2020 2020  t flatten:.     
-0000da60: 2020 2044 5f6c 6973 7420 3d20 5b5d 0a20     D_list = []. 
-0000da70: 2020 2020 2020 2063 3264 6d61 7020 3d20         c2dmap = 
-0000da80: 7b7d 0a20 2020 2020 2020 2066 6f72 2063  {}.        for c
-0000da90: 656c 6c20 696e 2067 6473 6969 5f6c 6962  ell in gdsii_lib
-0000daa0: 2e63 656c 6c73 2e76 616c 7565 7328 293a  .cells.values():
-0000dab0: 0a20 2020 2020 2020 2020 2020 2044 203d  .            D =
-0000dac0: 2044 6576 6963 6528 6e61 6d65 3d63 656c   Device(name=cel
-0000dad0: 6c2e 6e61 6d65 290a 2020 2020 2020 2020  l.name).        
-0000dae0: 2020 2020 442e 706f 6c79 676f 6e73 203d      D.polygons =
-0000daf0: 2063 656c 6c2e 706f 6c79 676f 6e73 0a20   cell.polygons. 
-0000db00: 2020 2020 2020 2020 2020 2044 2e72 6566             D.ref
-0000db10: 6572 656e 6365 7320 3d20 6365 6c6c 2e72  erences = cell.r
-0000db20: 6566 6572 656e 6365 730a 2020 2020 2020  eferences.      
-0000db30: 2020 2020 2020 442e 6e61 6d65 203d 2063        D.name = c
-0000db40: 656c 6c2e 6e61 6d65 0a20 2020 2020 2020  ell.name.       
-0000db50: 2020 2020 2044 2e70 6174 6873 203d 2063       D.paths = c
-0000db60: 656c 6c2e 7061 7468 730a 2020 2020 2020  ell.paths.      
-0000db70: 2020 2020 2020 666f 7220 6c61 6265 6c20        for label 
-0000db80: 696e 2063 656c 6c2e 6c61 6265 6c73 3a0a  in cell.labels:.
-0000db90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dba0: 726f 7461 7469 6f6e 203d 206c 6162 656c  rotation = label
-0000dbb0: 2e72 6f74 6174 696f 6e0a 2020 2020 2020  .rotation.      
-0000dbc0: 2020 2020 2020 2020 2020 6966 2072 6f74            if rot
-0000dbd0: 6174 696f 6e20 6973 204e 6f6e 653a 0a20  ation is None:. 
-0000dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dbf0: 2020 2072 6f74 6174 696f 6e20 3d20 300a     rotation = 0.
-0000dc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc10: 6c20 3d20 442e 6164 645f 6c61 6265 6c28  l = D.add_label(
-0000dc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dc30: 2020 2020 2074 6578 743d 6c61 6265 6c2e       text=label.
-0000dc40: 7465 7874 2c0a 2020 2020 2020 2020 2020  text,.          
-0000dc50: 2020 2020 2020 2020 2020 706f 7369 7469            positi
-0000dc60: 6f6e 3d6e 702e 6173 6661 7272 6179 286c  on=np.asfarray(l
-0000dc70: 6162 656c 2e70 6f73 6974 696f 6e29 2c0a  abel.position),.
-0000dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc90: 2020 2020 6d61 676e 6966 6963 6174 696f      magnificatio
-0000dca0: 6e3d 6c61 6265 6c2e 6d61 676e 6966 6963  n=label.magnific
-0000dcb0: 6174 696f 6e2c 0a20 2020 2020 2020 2020  ation,.         
-0000dcc0: 2020 2020 2020 2020 2020 2072 6f74 6174             rotat
-0000dcd0: 696f 6e3d 726f 7461 7469 6f6e 202a 2031  ion=rotation * 1
-0000dce0: 3830 202f 206e 702e 7069 2c0a 2020 2020  80 / np.pi,.    
-0000dcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd00: 6c61 7965 723d 286c 6162 656c 2e6c 6179  layer=(label.lay
-0000dd10: 6572 2c20 6c61 6265 6c2e 7465 7874 7479  er, label.textty
-0000dd20: 7065 292c 0a20 2020 2020 2020 2020 2020  pe),.           
-0000dd30: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000dd40: 2020 2020 2020 206c 2e61 6e63 686f 7220         l.anchor 
-0000dd50: 3d20 6c61 6265 6c2e 616e 6368 6f72 0a20  = label.anchor. 
-0000dd60: 2020 2020 2020 2020 2020 2063 3264 6d61             c2dma
-0000dd70: 705b 6365 6c6c 5d20 3d20 440a 2020 2020  p[cell] = D.    
-0000dd80: 2020 2020 2020 2020 445f 6c69 7374 2e61          D_list.a
-0000dd90: 7070 656e 6428 4429 0a0a 2020 2020 2020  ppend(D)..      
-0000dda0: 2020 666f 7220 4420 696e 2044 5f6c 6973    for D in D_lis
-0000ddb0: 743a 0a20 2020 2020 2020 2020 2020 2023  t:.            #
-0000ddc0: 2046 6972 7374 2063 6f6e 7665 7274 2065   First convert e
-0000ddd0: 6163 6820 7265 6665 7265 6e63 6520 736f  ach reference so
-0000dde0: 2069 7420 706f 696e 7473 2074 6f20 7468   it points to th
-0000ddf0: 6520 7269 6768 7420 4465 7669 6365 0a20  e right Device. 
-0000de00: 2020 2020 2020 2020 2020 2063 6f6e 7665             conve
-0000de10: 7274 6564 5f72 6566 6572 656e 6365 7320  rted_references 
-0000de20: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-0000de30: 2066 6f72 2065 2069 6e20 442e 7265 6665   for e in D.refe
-0000de40: 7265 6e63 6573 3a0a 2020 2020 2020 2020  rences:.        
-0000de50: 2020 2020 2020 2020 7265 665f 6465 7669          ref_devi
-0000de60: 6365 203d 2063 3264 6d61 705b 652e 7265  ce = c2dmap[e.re
-0000de70: 665f 6365 6c6c 5d0a 2020 2020 2020 2020  f_cell].        
-0000de80: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0000de90: 7461 6e63 6528 652c 2067 6473 7079 2e43  tance(e, gdspy.C
-0000dea0: 656c 6c52 6566 6572 656e 6365 293a 0a20  ellReference):. 
-0000deb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dec0: 2020 2064 7220 3d20 4465 7669 6365 5265     dr = DeviceRe
-0000ded0: 6665 7265 6e63 6528 0a20 2020 2020 2020  ference(.       
-0000dee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000def0: 2064 6576 6963 653d 7265 665f 6465 7669   device=ref_devi
-0000df00: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
-0000df10: 2020 2020 2020 2020 2020 2020 6f72 6967              orig
-0000df20: 696e 3d65 2e6f 7269 6769 6e2c 0a20 2020  in=e.origin,.   
-0000df30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000df40: 2020 2020 2072 6f74 6174 696f 6e3d 652e       rotation=e.
-0000df50: 726f 7461 7469 6f6e 2c0a 2020 2020 2020  rotation,.      
-0000df60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000df70: 2020 6d61 676e 6966 6963 6174 696f 6e3d    magnification=
-0000df80: 652e 6d61 676e 6966 6963 6174 696f 6e2c  e.magnification,
-0000df90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dfa0: 2020 2020 2020 2020 2078 5f72 6566 6c65           x_refle
-0000dfb0: 6374 696f 6e3d 652e 785f 7265 666c 6563  ction=e.x_reflec
-0000dfc0: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
-0000dfd0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dff0: 6472 2e70 726f 7065 7274 6965 7320 3d20  dr.properties = 
-0000e000: 652e 7072 6f70 6572 7469 6573 0a20 2020  e.properties.   
-0000e010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e020: 2064 722e 6f77 6e65 7220 3d20 440a 2020   dr.owner = D.  
-0000e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e040: 2020 636f 6e76 6572 7465 645f 7265 6665    converted_refe
-0000e050: 7265 6e63 6573 2e61 7070 656e 6428 6472  rences.append(dr
-0000e060: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000e070: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-0000e080: 6528 652c 2067 6473 7079 2e43 656c 6c41  e(e, gdspy.CellA
-0000e090: 7272 6179 293a 0a20 2020 2020 2020 2020  rray):.         
-0000e0a0: 2020 2020 2020 2020 2020 2064 7220 3d20             dr = 
-0000e0b0: 4365 6c6c 4172 7261 7928 0a20 2020 2020  CellArray(.     
-0000e0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e0d0: 2020 2064 6576 6963 653d 7265 665f 6465     device=ref_de
-0000e0e0: 7669 6365 2c0a 2020 2020 2020 2020 2020  vice,.          
-0000e0f0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000e100: 6c75 6d6e 733d 652e 636f 6c75 6d6e 732c  lumns=e.columns,
-0000e110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e120: 2020 2020 2020 2020 2072 6f77 733d 652e           rows=e.
-0000e130: 726f 7773 2c0a 2020 2020 2020 2020 2020  rows,.          
-0000e140: 2020 2020 2020 2020 2020 2020 2020 7370                sp
-0000e150: 6163 696e 673d 652e 7370 6163 696e 672c  acing=e.spacing,
-0000e160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e170: 2020 2020 2020 2020 206f 7269 6769 6e3d           origin=
-0000e180: 652e 6f72 6967 696e 2c0a 2020 2020 2020  e.origin,.      
-0000e190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e1a0: 2020 726f 7461 7469 6f6e 3d65 2e72 6f74    rotation=e.rot
-0000e1b0: 6174 696f 6e2c 0a20 2020 2020 2020 2020  ation,.         
-0000e1c0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000e1d0: 6167 6e69 6669 6361 7469 6f6e 3d65 2e6d  agnification=e.m
-0000e1e0: 6167 6e69 6669 6361 7469 6f6e 2c0a 2020  agnification,.  
-0000e1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e200: 2020 2020 2020 785f 7265 666c 6563 7469        x_reflecti
-0000e210: 6f6e 3d65 2e78 5f72 6566 6c65 6374 696f  on=e.x_reflectio
-0000e220: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-0000e230: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000e240: 2020 2020 2020 2020 2020 2020 2064 722e               dr.
-0000e250: 6f77 6e65 7220 3d20 440a 2020 2020 2020  owner = D.      
-0000e260: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000e270: 6e76 6572 7465 645f 7265 6665 7265 6e63  nverted_referenc
-0000e280: 6573 2e61 7070 656e 6428 6472 290a 2020  es.append(dr).  
-0000e290: 2020 2020 2020 2020 2020 442e 7265 6665            D.refe
-0000e2a0: 7265 6e63 6573 203d 2063 6f6e 7665 7274  rences = convert
-0000e2b0: 6564 5f72 6566 6572 656e 6365 730a 2020  ed_references.  
-0000e2c0: 2020 2020 2020 2020 2020 2320 4e65 7874            # Next
-0000e2d0: 2063 6f6e 7665 7274 2065 6163 6820 506f   convert each Po
-0000e2e0: 6c79 676f 6e0a 2020 2020 2020 2020 2020  lygon.          
-0000e2f0: 2020 7465 6d70 5f70 6f6c 7967 6f6e 7320    temp_polygons 
-0000e300: 3d20 6c69 7374 2844 2e70 6f6c 7967 6f6e  = list(D.polygon
-0000e310: 7329 0a20 2020 2020 2020 2020 2020 2044  s).            D
-0000e320: 2e70 6f6c 7967 6f6e 7320 3d20 5b5d 0a20  .polygons = []. 
-0000e330: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
-0000e340: 2069 6e20 7465 6d70 5f70 6f6c 7967 6f6e   in temp_polygon
-0000e350: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000e360: 2020 2044 2e61 6464 5f70 6f6c 7967 6f6e     D.add_polygon
-0000e370: 2870 290a 0a20 2020 2020 2020 2074 6f70  (p)..        top
-0000e380: 6465 7669 6365 203d 2063 3264 6d61 705b  device = c2dmap[
-0000e390: 746f 7063 656c 6c5d 0a20 2020 2020 2020  topcell].       
-0000e3a0: 2072 6574 7572 6e20 746f 7064 6576 6963   return topdevic
-0000e3b0: 650a 0a20 2020 2065 6c69 6620 666c 6174  e..    elif flat
-0000e3c0: 7465 6e3a 0a20 2020 2020 2020 2044 203d  ten:.        D =
-0000e3d0: 2044 6576 6963 6528 2269 6d70 6f72 745f   Device("import_
-0000e3e0: 6764 7322 290a 2020 2020 2020 2020 706f  gds").        po
-0000e3f0: 6c79 676f 6e73 203d 2074 6f70 6365 6c6c  lygons = topcell
-0000e400: 2e67 6574 5f70 6f6c 7967 6f6e 7328 6279  .get_polygons(by
-0000e410: 5f73 7065 633d 5472 7565 290a 0a20 2020  _spec=True)..   
-0000e420: 2020 2020 2066 6f72 206c 6179 6572 5f69       for layer_i
-0000e430: 6e5f 6764 732c 2070 6f6c 7973 2069 6e20  n_gds, polys in 
-0000e440: 706f 6c79 676f 6e73 2e69 7465 6d73 2829  polygons.items()
-0000e450: 3a0a 2020 2020 2020 2020 2020 2020 442e  :.            D.
-0000e460: 6164 645f 706f 6c79 676f 6e28 706f 6c79  add_polygon(poly
-0000e470: 732c 206c 6179 6572 3d6c 6179 6572 5f69  s, layer=layer_i
-0000e480: 6e5f 6764 7329 0a20 2020 2020 2020 2072  n_gds).        r
-0000e490: 6574 7572 6e20 440a 0a0a 6465 6620 5f74  eturn D...def _t
-0000e4a0: 7261 6e73 6c61 7465 5f63 656c 6c28 6329  ranslate_cell(c)
-0000e4b0: 3a0a 2020 2020 4420 3d20 4465 7669 6365  :.    D = Device
-0000e4c0: 286e 616d 653d 632e 6e61 6d65 290a 2020  (name=c.name).  
-0000e4d0: 2020 666f 7220 6520 696e 2063 2e65 6c65    for e in c.ele
-0000e4e0: 6d65 6e74 733a 0a20 2020 2020 2020 2069  ments:.        i
-0000e4f0: 6620 6973 696e 7374 616e 6365 2865 2c20  f isinstance(e, 
-0000e500: 6764 7370 792e 506f 6c79 676f 6e53 6574  gdspy.PolygonSet
-0000e510: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
-0000e520: 6f72 206e 2c20 706f 696e 7473 2069 6e20  or n, points in 
-0000e530: 656e 756d 6572 6174 6528 652e 706f 6c79  enumerate(e.poly
-0000e540: 676f 6e73 293a 0a20 2020 2020 2020 2020  gons):.         
-0000e550: 2020 2020 2020 2070 6f6c 7967 6f6e 5f6c         polygon_l
-0000e560: 6179 6572 203d 205f 7061 7273 655f 6c61  ayer = _parse_la
-0000e570: 7965 7228 2865 2e6c 6179 6572 735b 6e5d  yer((e.layers[n]
-0000e580: 2c20 652e 6461 7461 7479 7065 735b 6e5d  , e.datatypes[n]
-0000e590: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-0000e5a0: 2020 2044 2e61 6464 5f70 6f6c 7967 6f6e     D.add_polygon
-0000e5b0: 2870 6f69 6e74 733d 706f 696e 7473 2c20  (points=points, 
-0000e5c0: 6c61 7965 723d 706f 6c79 676f 6e5f 6c61  layer=polygon_la
-0000e5d0: 7965 7229 0a20 2020 2020 2020 2065 6c69  yer).        eli
-0000e5e0: 6620 6973 696e 7374 616e 6365 2865 2c20  f isinstance(e, 
-0000e5f0: 6764 7370 792e 4365 6c6c 5265 6665 7265  gdspy.CellRefere
-0000e600: 6e63 6529 3a0a 2020 2020 2020 2020 2020  nce):.          
-0000e610: 2020 6472 203d 2044 6576 6963 6552 6566    dr = DeviceRef
-0000e620: 6572 656e 6365 280a 2020 2020 2020 2020  erence(.        
-0000e630: 2020 2020 2020 2020 6465 7669 6365 3d5f          device=_
-0000e640: 7472 616e 736c 6174 655f 6365 6c6c 2865  translate_cell(e
-0000e650: 2e72 6566 5f63 656c 6c29 2c0a 2020 2020  .ref_cell),.    
-0000e660: 2020 2020 2020 2020 2020 2020 6f72 6967              orig
-0000e670: 696e 3d65 2e6f 7269 6769 6e2c 0a20 2020  in=e.origin,.   
-0000e680: 2020 2020 2020 2020 2020 2020 2072 6f74               rot
-0000e690: 6174 696f 6e3d 652e 726f 7461 7469 6f6e  ation=e.rotation
-0000e6a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000e6b0: 2020 6d61 676e 6966 6963 6174 696f 6e3d    magnification=
-0000e6c0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-0000e6d0: 2020 2020 2020 785f 7265 666c 6563 7469        x_reflecti
-0000e6e0: 6f6e 3d65 2e78 5f72 6566 6c65 6374 696f  on=e.x_reflectio
-0000e6f0: 6e2c 0a20 2020 2020 2020 2020 2020 2029  n,.            )
-0000e700: 0a20 2020 2020 2020 2020 2020 2044 2e65  .            D.e
-0000e710: 6c65 6d65 6e74 732e 6170 7065 6e64 2864  lements.append(d
-0000e720: 7229 0a20 2020 2044 2e6c 6162 656c 7320  r).    D.labels 
-0000e730: 3d20 632e 6c61 6265 6c73 0a20 2020 2072  = c.labels.    r
-0000e740: 6574 7572 6e20 440a 0a0a 6465 6620 7072  eturn D...def pr
-0000e750: 6576 6965 775f 6c61 7965 7273 6574 286c  eview_layerset(l
-0000e760: 732c 2073 697a 653d 3130 302c 2073 7061  s, size=100, spa
-0000e770: 6369 6e67 3d31 3030 293a 0a20 2020 2022  cing=100):.    "
-0000e780: 2222 4765 6e65 7261 7465 7320 6120 7072  ""Generates a pr
-0000e790: 6576 6965 7720 4465 7669 6365 2077 6974  eview Device wit
-0000e7a0: 6820 7265 7072 6573 656e 7461 7469 6f6e  h representation
-0000e7b0: 7320 6f66 2061 6c6c 2074 6865 206c 6179  s of all the lay
-0000e7c0: 6572 732c 0a20 2020 2075 7365 6420 666f  ers,.    used fo
-0000e7d0: 7220 7072 6576 6965 7769 6e67 204c 6179  r previewing Lay
-0000e7e0: 6572 5365 7420 636f 6c6f 7220 7363 6865  erSet color sche
-0000e7f0: 6d65 7320 696e 2071 7569 636b 706c 6f74  mes in quickplot
-0000e800: 206f 7220 7361 7665 6420 2e67 6473 0a20   or saved .gds. 
-0000e810: 2020 2066 696c 6573 2e0a 0a20 2020 2050     files...    P
-0000e820: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-0000e830: 2d2d 2d2d 2d2d 2d2d 0a20 2020 206c 7320  --------.    ls 
-0000e840: 3a20 4c61 7965 7253 6574 0a20 2020 2020  : LayerSet.     
-0000e850: 2020 2053 6574 206f 6620 6c61 7965 7273     Set of layers
-0000e860: 2074 6f20 7072 6576 6965 7720 636f 6c6f   to preview colo
-0000e870: 7220 7363 6865 6d65 732e 0a20 2020 2073  r schemes..    s
-0000e880: 697a 6520 3a20 696e 7420 6f72 2066 6c6f  ize : int or flo
-0000e890: 6174 0a20 2020 2020 2020 2052 6573 697a  at.        Resiz
-0000e8a0: 696e 6720 6661 6374 6f72 2066 6f72 2074  ing factor for t
-0000e8b0: 6865 2070 7265 7669 6577 2044 6576 6963  he preview Devic
-0000e8c0: 652e 0a20 2020 2073 7061 6369 6e67 203a  e..    spacing :
-0000e8d0: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
-0000e8e0: 2020 2020 2020 5468 6520 7370 6163 6520        The space 
-0000e8f0: 6265 7477 6565 6e20 6561 6368 206c 6179  between each lay
-0000e900: 6572 2072 6570 7265 7365 6e74 6174 696f  er representatio
-0000e910: 6e2e 0a0a 2020 2020 5265 7475 726e 730a  n...    Returns.
-0000e920: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-0000e930: 4420 3a20 4465 7669 6365 0a20 2020 2020  D : Device.     
-0000e940: 2020 2041 2044 6576 6963 6520 636f 6e74     A Device cont
-0000e950: 6169 6e69 6e67 2061 2072 6570 7265 7365  aining a represe
-0000e960: 6e74 6174 696f 6e20 6f66 2061 6c6c 2074  ntation of all t
-0000e970: 6865 206c 6179 6572 7320 696e 2074 6865  he layers in the
-0000e980: 2069 6e70 7574 0a20 2020 2020 2020 204c   input.        L
-0000e990: 6179 6572 5365 742e 0a20 2020 2022 2222  ayerSet..    """
-0000e9a0: 0a0a 2020 2020 4420 3d20 4465 7669 6365  ..    D = Device
-0000e9b0: 2822 6c61 7965 7273 6574 2229 0a20 2020  ("layerset").   
-0000e9c0: 2073 6361 6c65 203d 2073 697a 6520 2f20   scale = size / 
-0000e9d0: 3130 300a 2020 2020 6e75 6d5f 6c61 7965  100.    num_laye
-0000e9e0: 7273 203d 206c 656e 286c 732e 5f6c 6179  rs = len(ls._lay
-0000e9f0: 6572 7329 0a20 2020 206d 6174 7269 785f  ers).    matrix_
-0000ea00: 7369 7a65 203d 2069 6e74 286e 702e 6365  size = int(np.ce
-0000ea10: 696c 286e 702e 7371 7274 286e 756d 5f6c  il(np.sqrt(num_l
-0000ea20: 6179 6572 7329 2929 0a20 2020 2073 6f72  ayers))).    sor
-0000ea30: 7465 645f 6c61 7965 7273 203d 2073 6f72  ted_layers = sor
-0000ea40: 7465 6428 0a20 2020 2020 2020 206c 732e  ted(.        ls.
-0000ea50: 5f6c 6179 6572 732e 7661 6c75 6573 2829  _layers.values()
-0000ea60: 2c20 6b65 793d 6c61 6d62 6461 2078 3a20  , key=lambda x: 
-0000ea70: 2878 2e67 6473 5f6c 6179 6572 2c20 782e  (x.gds_layer, x.
-0000ea80: 6764 735f 6461 7461 7479 7065 290a 2020  gds_datatype).  
-0000ea90: 2020 290a 2020 2020 666f 7220 6e2c 206c    ).    for n, l
-0000eaa0: 6179 6572 2069 6e20 656e 756d 6572 6174  ayer in enumerat
-0000eab0: 6528 736f 7274 6564 5f6c 6179 6572 7329  e(sorted_layers)
-0000eac0: 3a0a 2020 2020 2020 2020 5220 3d20 7265  :.        R = re
-0000ead0: 6374 616e 676c 6528 7369 7a65 3d28 3130  ctangle(size=(10
-0000eae0: 3020 2a20 7363 616c 652c 2031 3030 202a  0 * scale, 100 *
-0000eaf0: 2073 6361 6c65 292c 206c 6179 6572 3d6c   scale), layer=l
-0000eb00: 6179 6572 290a 2020 2020 2020 2020 5420  ayer).        T 
-0000eb10: 3d20 7465 7874 280a 2020 2020 2020 2020  = text(.        
-0000eb20: 2020 2020 7465 7874 3d66 227b 6c61 7965      text=f"{laye
-0000eb30: 722e 6e61 6d65 7d5c 6e7b 6c61 7965 722e  r.name}\n{layer.
-0000eb40: 6764 735f 6c61 7965 727d 202f 207b 6c61  gds_layer} / {la
-0000eb50: 7965 722e 6764 735f 6461 7461 7479 7065  yer.gds_datatype
-0000eb60: 7d22 2c0a 2020 2020 2020 2020 2020 2020  }",.            
-0000eb70: 7369 7a65 3d32 3020 2a20 7363 616c 652c  size=20 * scale,
-0000eb80: 0a20 2020 2020 2020 2020 2020 206a 7573  .            jus
-0000eb90: 7469 6679 3d22 6365 6e74 6572 222c 0a20  tify="center",. 
-0000eba0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-0000ebb0: 3d6c 6179 6572 2c0a 2020 2020 2020 2020  =layer,.        
-0000ebc0: 290a 0a20 2020 2020 2020 2054 2e6d 6f76  )..        T.mov
-0000ebd0: 6528 2835 3020 2a20 7363 616c 652c 202d  e((50 * scale, -
-0000ebe0: 3230 202a 2073 6361 6c65 2929 0a20 2020  20 * scale)).   
-0000ebf0: 2020 2020 2078 6c6f 6320 3d20 6e20 2520       xloc = n % 
-0000ec00: 6d61 7472 6978 5f73 697a 650a 2020 2020  matrix_size.    
-0000ec10: 2020 2020 796c 6f63 203d 2069 6e74 286e      yloc = int(n
-0000ec20: 202f 2f20 6d61 7472 6978 5f73 697a 6529   // matrix_size)
-0000ec30: 0a20 2020 2020 2020 2044 2e61 6464 5f72  .        D.add_r
-0000ec40: 6566 2852 292e 6d6f 7665 7828 2831 3030  ef(R).movex((100
-0000ec50: 202b 2073 7061 6369 6e67 2920 2a20 786c   + spacing) * xl
-0000ec60: 6f63 202a 2073 6361 6c65 292e 6d6f 7665  oc * scale).move
-0000ec70: 7928 0a20 2020 2020 2020 2020 2020 202d  y(.            -
-0000ec80: 2831 3030 202b 2073 7061 6369 6e67 2920  (100 + spacing) 
-0000ec90: 2a20 796c 6f63 202a 2073 6361 6c65 0a20  * yloc * scale. 
-0000eca0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000ecb0: 2044 2e61 6464 5f72 6566 2854 292e 6d6f   D.add_ref(T).mo
-0000ecc0: 7665 7828 2831 3030 202b 2073 7061 6369  vex((100 + spaci
-0000ecd0: 6e67 2920 2a20 786c 6f63 202a 2073 6361  ng) * xloc * sca
-0000ece0: 6c65 292e 6d6f 7665 7928 0a20 2020 2020  le).movey(.     
-0000ecf0: 2020 2020 2020 202d 2831 3030 202b 2073         -(100 + s
-0000ed00: 7061 6369 6e67 2920 2a20 796c 6f63 202a  pacing) * yloc *
-0000ed10: 2073 6361 6c65 0a20 2020 2020 2020 2029   scale.        )
-0000ed20: 0a20 2020 2072 6574 7572 6e20 440a 0a0a  .    return D...
-0000ed30: 636c 6173 7320 6465 7669 6365 5f6c 7275  class device_lru
-0000ed40: 5f63 6163 6865 3a0a 2020 2020 2222 224c  _cache:.    """L
-0000ed50: 6561 7374 2d72 6563 656e 746c 792d 7573  east-recently-us
-0000ed60: 6564 2028 4c52 5529 2063 6163 6865 2066  ed (LRU) cache f
-0000ed70: 6f72 2044 6576 6963 6573 2222 220a 0a20  or Devices""".. 
-0000ed80: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-0000ed90: 7365 6c66 2c20 666e 293a 0a20 2020 2020  self, fn):.     
-0000eda0: 2020 2073 656c 662e 6d61 7873 697a 6520     self.maxsize 
-0000edb0: 3d20 3332 0a20 2020 2020 2020 2073 656c  = 32.        sel
-0000edc0: 662e 666e 203d 2066 6e0a 2020 2020 2020  f.fn = fn.      
-0000edd0: 2020 7365 6c66 2e6d 656d 6f20 3d20 4f72    self.memo = Or
-0000ede0: 6465 7265 6444 6963 7428 290a 2020 2020  deredDict().    
-0000edf0: 2020 2020 7570 6461 7465 5f77 7261 7070      update_wrapp
-0000ee00: 6572 2873 656c 662c 2066 6e29 0a0a 2020  er(self, fn)..  
-0000ee10: 2020 6465 6620 5f5f 6361 6c6c 5f5f 2873    def __call__(s
-0000ee20: 656c 662c 202a 6172 6773 2c20 2a2a 6b77  elf, *args, **kw
-0000ee30: 6172 6773 293a 0a20 2020 2020 2020 2070  args):.        p
-0000ee40: 6963 6b6c 655f 7374 7220 3d20 7069 636b  ickle_str = pick
-0000ee50: 6c65 2e64 756d 7073 2861 7267 732c 2031  le.dumps(args, 1
-0000ee60: 2920 2b20 7069 636b 6c65 2e64 756d 7073  ) + pickle.dumps
-0000ee70: 286b 7761 7267 732c 2031 290a 2020 2020  (kwargs, 1).    
-0000ee80: 2020 2020 6966 2070 6963 6b6c 655f 7374      if pickle_st
-0000ee90: 7220 6e6f 7420 696e 2073 656c 662e 6d65  r not in self.me
-0000eea0: 6d6f 2e6b 6579 7328 293a 0a20 2020 2020  mo.keys():.     
-0000eeb0: 2020 2020 2020 206e 6577 5f63 6163 6865         new_cache
-0000eec0: 5f69 7465 6d20 3d20 7365 6c66 2e66 6e28  _item = self.fn(
-0000eed0: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-0000eee0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000eef0: 6e6f 7420 6973 696e 7374 616e 6365 286e  not isinstance(n
-0000ef00: 6577 5f63 6163 6865 5f69 7465 6d2c 2044  ew_cache_item, D
-0000ef10: 6576 6963 6529 3a0a 2020 2020 2020 2020  evice):.        
-0000ef20: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0000ef30: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-0000ef40: 2020 2020 2020 2020 2020 2020 2020 225b                "[
-0000ef50: 5048 4944 4c5d 2040 6465 7669 6365 5f6c  PHIDL] @device_l
-0000ef60: 7275 5f63 6163 6865 2063 616e 206f 6e6c  ru_cache can onl
-0000ef70: 7920 6265 2022 0a20 2020 2020 2020 2020  y be ".         
-0000ef80: 2020 2020 2020 2020 2020 2022 7573 6564             "used
-0000ef90: 206f 6e20 6675 6e63 7469 6f6e 7320 7768   on functions wh
-0000efa0: 6963 6820 7265 7475 726e 2061 2044 6576  ich return a Dev
-0000efb0: 6963 6522 0a20 2020 2020 2020 2020 2020  ice".           
-0000efc0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000efd0: 2020 2069 6620 6c65 6e28 7365 6c66 2e6d     if len(self.m
-0000efe0: 656d 6f29 203e 2073 656c 662e 6d61 7873  emo) > self.maxs
-0000eff0: 697a 653a 0a20 2020 2020 2020 2020 2020  ize:.           
-0000f000: 2020 2020 2073 656c 662e 6d65 6d6f 2e70       self.memo.p
-0000f010: 6f70 6974 656d 286c 6173 743d 4661 6c73  opitem(last=Fals
-0000f020: 6529 2020 2320 5265 6d6f 7665 206f 6c64  e)  # Remove old
-0000f030: 6573 7420 6974 656d 2066 726f 6d20 6361  est item from ca
-0000f040: 6368 650a 2020 2020 2020 2020 2020 2020  che.            
-0000f050: 2320 4164 6420 6120 6465 6570 636f 7079  # Add a deepcopy
-0000f060: 206f 6620 6e65 7720 6974 656d 2074 6f20   of new item to 
-0000f070: 6361 6368 6520 736f 2074 6861 7420 6966  cache so that if
-0000f080: 2077 6520 6368 616e 6765 2074 6865 0a20   we change the. 
-0000f090: 2020 2020 2020 2020 2020 2023 2072 6574             # ret
-0000f0a0: 7572 6e65 6420 6465 7669 6365 2c20 6f75  urned device, ou
-0000f0b0: 7220 7374 6f72 6564 2063 6163 6865 2069  r stored cache i
-0000f0c0: 7465 6d20 6973 206e 6f74 2063 6861 6e67  tem is not chang
-0000f0d0: 6564 0a20 2020 2020 2020 2020 2020 2073  ed.            s
-0000f0e0: 656c 662e 6d65 6d6f 5b70 6963 6b6c 655f  elf.memo[pickle_
-0000f0f0: 7374 725d 203d 2070 7974 686f 6e5f 636f  str] = python_co
-0000f100: 7079 2e64 6565 7063 6f70 7928 6e65 775f  py.deepcopy(new_
-0000f110: 6361 6368 655f 6974 656d 290a 2020 2020  cache_item).    
-0000f120: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-0000f130: 6577 5f63 6163 6865 5f69 7465 6d0a 2020  ew_cache_item.  
-0000f140: 2020 2020 2020 656c 7365 3a20 2023 2069        else:  # i
-0000f150: 6620 666f 756e 6420 696e 2063 6163 6865  f found in cache
-0000f160: 0a20 2020 2020 2020 2020 2020 2023 2050  .            # P
-0000f170: 6f70 2063 6163 6865 2069 7465 6d20 6f75  op cache item ou
-0000f180: 7420 616e 6420 7075 7420 6974 2062 6163  t and put it bac
-0000f190: 6b20 6f6e 2074 6865 2074 6f70 206f 6620  k on the top of 
-0000f1a0: 7468 6520 6361 6368 650a 2020 2020 2020  the cache.      
-0000f1b0: 2020 2020 2020 6361 6368 6564 5f6f 7574        cached_out
-0000f1c0: 7075 7420 3d20 7365 6c66 2e6d 656d 6f2e  put = self.memo.
-0000f1d0: 706f 7028 7069 636b 6c65 5f73 7472 290a  pop(pickle_str).
-0000f1e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000f1f0: 2e6d 656d 6f5b 7069 636b 6c65 5f73 7472  .memo[pickle_str
-0000f200: 5d20 3d20 6361 6368 6564 5f6f 7574 7075  ] = cached_outpu
-0000f210: 740a 2020 2020 2020 2020 2020 2020 2320  t.            # 
-0000f220: 5468 656e 2072 6574 7572 6e20 6120 636f  Then return a co
-0000f230: 7079 206f 6620 7468 6520 6361 6368 6564  py of the cached
-0000f240: 2044 6576 6963 650a 2020 2020 2020 2020   Device.        
-0000f250: 2020 2020 7265 7475 726e 2064 6565 7063      return deepc
-0000f260: 6f70 7928 6361 6368 6564 5f6f 7574 7075  opy(cached_outpu
-0000f270: 7429 0a0a 0a64 6566 205f 636f 6e76 6572  t)...def _conver
-0000f280: 745f 706f 7274 5f74 6f5f 6765 6f6d 6574  t_port_to_geomet
-0000f290: 7279 2870 6f72 742c 206c 6179 6572 3d30  ry(port, layer=0
-0000f2a0: 293a 0a20 2020 2022 2222 436f 6e76 6572  ):.    """Conver
-0000f2b0: 7473 2061 2050 6f72 7420 746f 2061 206c  ts a Port to a l
-0000f2c0: 6162 656c 2061 6e64 2061 2074 7269 616e  abel and a trian
-0000f2d0: 676c 6520 4465 7669 6365 2074 6861 7420  gle Device that 
-0000f2e0: 6172 6520 7468 656e 2061 6464 6564 0a20  are then added. 
-0000f2f0: 2020 2074 6f20 7468 6520 7061 7265 6e74     to the parent
-0000f300: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-0000f310: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-0000f320: 0a20 2020 2070 6f72 7420 3a20 506f 7274  .    port : Port
-0000f330: 0a20 2020 2020 2020 2050 6f72 7420 746f  .        Port to
-0000f340: 2062 6520 636f 6e76 6572 7465 642e 0a20   be converted.. 
-0000f350: 2020 206c 6179 6572 203a 2069 6e74 2c20     layer : int, 
-0000f360: 6172 7261 792d 6c69 6b65 5b32 5d2c 206f  array-like[2], o
-0000f370: 7220 7365 740a 2020 2020 2020 2020 5370  r set.        Sp
-0000f380: 6563 6966 6963 206c 6179 6572 2873 2920  ecific layer(s) 
-0000f390: 746f 2070 7574 206c 6162 656c 2061 6e64  to put label and
-0000f3a0: 2067 656f 6d65 7472 7920 6f6e 2e0a 0a20   geometry on... 
-0000f3b0: 2020 204e 6f74 6573 0a20 2020 202d 2d2d     Notes.    ---
-0000f3c0: 2d2d 0a20 2020 2054 6865 2050 6f72 7420  --.    The Port 
-0000f3d0: 6d75 7374 2073 7461 7274 2077 6974 6820  must start with 
-0000f3e0: 6120 7061 7265 6e74 2e0a 2020 2020 2222  a parent..    ""
-0000f3f0: 220a 2020 2020 6966 2070 6f72 742e 7061  ".    if port.pa
-0000f400: 7265 6e74 2069 7320 4e6f 6e65 3a0a 2020  rent is None:.  
-0000f410: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0000f420: 6545 7272 6f72 2866 2250 6f72 7420 7b70  eError(f"Port {p
-0000f430: 6f72 742e 6e61 6d65 7d3a 2050 6f72 7420  ort.name}: Port 
-0000f440: 6e65 6564 7320 6120 7061 7265 6e74 2069  needs a parent i
-0000f450: 6e20 7768 6963 6820 746f 2064 7261 7722  n which to draw"
-0000f460: 290a 2020 2020 6966 2069 7369 6e73 7461  ).    if isinsta
-0000f470: 6e63 6528 706f 7274 2e70 6172 656e 742c  nce(port.parent,
-0000f480: 2044 6576 6963 6552 6566 6572 656e 6365   DeviceReference
-0000f490: 293a 0a20 2020 2020 2020 2064 6576 6963  ):.        devic
-0000f4a0: 6520 3d20 706f 7274 2e70 6172 656e 742e  e = port.parent.
-0000f4b0: 7061 7265 6e74 0a20 2020 2065 6c73 653a  parent.    else:
-0000f4c0: 0a20 2020 2020 2020 2064 6576 6963 6520  .        device 
-0000f4d0: 3d20 706f 7274 2e70 6172 656e 740a 0a20  = port.parent.. 
-0000f4e0: 2020 2023 2041 2076 6973 7561 6c20 6d61     # A visual ma
-0000f4f0: 726b 6572 0a20 2020 2074 7269 616e 676c  rker.    triangl
-0000f500: 655f 706f 696e 7473 203d 205b 5b30 2c20  e_points = [[0, 
-0000f510: 305d 5d20 2a20 330a 2020 2020 7472 6961  0]] * 3.    tria
-0000f520: 6e67 6c65 5f70 6f69 6e74 735b 305d 203d  ngle_points[0] =
-0000f530: 2070 6f72 742e 656e 6470 6f69 6e74 735b   port.endpoints[
-0000f540: 305d 0a20 2020 2074 7269 616e 676c 655f  0].    triangle_
-0000f550: 706f 696e 7473 5b31 5d20 3d20 706f 7274  points[1] = port
-0000f560: 2e65 6e64 706f 696e 7473 5b31 5d0a 2020  .endpoints[1].  
-0000f570: 2020 7472 6961 6e67 6c65 5f70 6f69 6e74    triangle_point
-0000f580: 735b 325d 203d 2028 0a20 2020 2020 2020  s[2] = (.       
-0000f590: 2070 6f72 742e 6d69 6470 6f69 6e74 202b   port.midpoint +
-0000f5a0: 2028 706f 7274 2e6e 6f72 6d61 6c20 2d20   (port.normal - 
-0000f5b0: 706f 7274 2e6d 6964 706f 696e 7429 202a  port.midpoint) *
-0000f5c0: 2070 6f72 742e 7769 6474 6820 2f20 3130   port.width / 10
-0000f5d0: 0a20 2020 2029 5b31 5d0a 2020 2020 6465  .    )[1].    de
-0000f5e0: 7669 6365 2e61 6464 5f70 6f6c 7967 6f6e  vice.add_polygon
-0000f5f0: 2874 7269 616e 676c 655f 706f 696e 7473  (triangle_points
-0000f600: 2c20 6c61 7965 7229 0a0a 2020 2020 2320  , layer)..    # 
-0000f610: 4c61 6265 6c20 6361 7272 7969 6e67 2061  Label carrying a
-0000f620: 6374 7561 6c20 696e 666f 726d 6174 696f  ctual informatio
-0000f630: 6e20 7468 6174 2077 696c 6c20 6265 2072  n that will be r
-0000f640: 6563 6f76 6572 6564 0a20 2020 206c 6162  ecovered.    lab
-0000f650: 656c 5f63 6f6e 7465 6e74 7320 3d20 280a  el_contents = (.
-0000f660: 2020 2020 2020 2020 7374 7228 706f 7274          str(port
-0000f670: 2e6e 616d 6529 2c0a 2020 2020 2020 2020  .name),.        
-0000f680: 2320 706f 7274 2e6d 6964 706f 696e 742c  # port.midpoint,
-0000f690: 0a20 2020 2020 2020 2023 2072 6174 6865  .        # rathe
-0000f6a0: 7220 7468 616e 2070 7574 2074 6869 7320  r than put this 
-0000f6b0: 696e 2074 6865 2074 6578 742c 2075 7365  in the text, use
-0000f6c0: 2074 6865 206c 6162 656c 0a20 2020 2020   the label.     
-0000f6d0: 2020 2023 2070 6f73 6974 696f 6e0a 2020     # position.  
-0000f6e0: 2020 2020 2020 2320 7468 6973 2063 616e        # this can
-0000f6f0: 2068 6176 6520 726f 756e 6469 6e67 2065   have rounding e
-0000f700: 7272 6f72 7320 7468 6174 2061 7265 206c  rrors that are l
-0000f710: 6573 7320 7468 616e 2061 0a20 2020 2020  ess than a.     
-0000f720: 2020 2023 206e 616e 6f6d 6574 6572 0a20     # nanometer. 
-0000f730: 2020 2020 2020 2066 6c6f 6174 286e 702e         float(np.
-0000f740: 726f 756e 6428 706f 7274 2e77 6964 7468  round(port.width
-0000f750: 2c20 6465 6369 6d61 6c73 3d33 2929 2c0a  , decimals=3)),.
-0000f760: 2020 2020 2020 2020 666c 6f61 7428 706f          float(po
-0000f770: 7274 2e6f 7269 656e 7461 7469 6f6e 292c  rt.orientation),
-0000f780: 0a20 2020 2020 2020 2023 2064 6576 6963  .        # devic
-0000f790: 652c 2023 2074 6869 7320 6973 2064 6566  e, # this is def
-0000f7a0: 696e 6974 656c 7920 6e6f 7420 7365 7269  initely not seri
-0000f7b0: 616c 697a 6162 6c65 0a20 2020 2020 2020  alizable.       
-0000f7c0: 2023 2070 6f72 742e 696e 666f 2c20 2320   # port.info, # 
-0000f7d0: 776f 756c 6420 6c69 6b65 2074 6f20 696e  would like to in
-0000f7e0: 636c 7564 652c 2062 7574 2069 7420 6d69  clude, but it mi
-0000f7f0: 6768 7420 676f 0a20 2020 2020 2020 2023  ght go.        #
-0000f800: 206c 6f6e 6765 7220 7468 616e 2031 3032   longer than 102
-0000f810: 3420 6368 6172 6163 7465 7273 0a20 2020  4 characters.   
-0000f820: 2020 2020 2023 2070 6f72 742e 7569 642c       # port.uid,
-0000f830: 2023 206e 6f74 2069 6e63 6c75 6469 6e67   # not including
-0000f840: 2062 6563 6175 7365 2069 7420 6973 2070   because it is p
-0000f850: 6172 7420 6f66 2074 6865 0a20 2020 2020  art of the.     
-0000f860: 2020 2023 2062 7569 6c64 2070 726f 6365     # build proce
-0000f870: 7373 2c20 6e6f 7420 7468 6520 706f 7274  ss, not the port
-0000f880: 2073 7461 7465 0a20 2020 2029 0a20 2020   state.    ).   
-0000f890: 206c 6162 656c 5f74 6578 7420 3d20 6a73   label_text = js
-0000f8a0: 6f6e 2e64 756d 7073 286c 6162 656c 5f63  on.dumps(label_c
-0000f8b0: 6f6e 7465 6e74 7329 0a20 2020 2064 6576  ontents).    dev
-0000f8c0: 6963 652e 6164 645f 6c61 6265 6c28 0a20  ice.add_label(. 
-0000f8d0: 2020 2020 2020 2074 6578 743d 6c61 6265         text=labe
-0000f8e0: 6c5f 7465 7874 2c0a 2020 2020 2020 2020  l_text,.        
-0000f8f0: 706f 7369 7469 6f6e 3d70 6f72 742e 6d69  position=port.mi
-0000f900: 6470 6f69 6e74 202b 205f 6361 6c63 756c  dpoint + _calcul
-0000f910: 6174 655f 6c61 6265 6c5f 6f66 6673 6574  ate_label_offset
-0000f920: 2870 6f72 7429 2c0a 2020 2020 2020 2020  (port),.        
-0000f930: 6d61 676e 6966 6963 6174 696f 6e3d 302e  magnification=0.
-0000f940: 3034 202a 2070 6f72 742e 7769 6474 682c  04 * port.width,
-0000f950: 0a20 2020 2020 2020 2072 6f74 6174 696f  .        rotatio
-0000f960: 6e3d 2839 3020 2b20 706f 7274 2e6f 7269  n=(90 + port.ori
-0000f970: 656e 7461 7469 6f6e 2920 2520 3336 302c  entation) % 360,
-0000f980: 0a20 2020 2020 2020 206c 6179 6572 3d6c  .        layer=l
-0000f990: 6179 6572 2c0a 2020 2020 290a 0a0a 6465  ayer,.    )...de
-0000f9a0: 6620 5f63 616c 6375 6c61 7465 5f6c 6162  f _calculate_lab
-0000f9b0: 656c 5f6f 6666 7365 7428 706f 7274 293a  el_offset(port):
-0000f9c0: 0a20 2020 2022 2222 5573 6564 2074 6f20  .    """Used to 
-0000f9d0: 7075 7420 7468 6520 6c61 6265 6c20 696e  put the label in
-0000f9e0: 2061 2070 7265 7474 7920 706f 7369 7469   a pretty positi
-0000f9f0: 6f6e 2e20 4974 2069 7320 6164 6465 6420  on. It is added 
-0000fa00: 7768 656e 2064 7261 7769 6e67 0a20 2020  when drawing.   
-0000fa10: 2061 6e64 2073 7562 7374 7261 6374 6564   and substracted
-0000fa20: 2077 6865 6e20 6578 7472 6163 7469 6e67   when extracting
-0000fa30: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-0000fa40: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-0000fa50: 0a20 2020 2070 6f72 7420 3a20 506f 7274  .    port : Port
-0000fa60: 0a20 2020 2020 2020 2050 6f72 742d 636f  .        Port-co
-0000fa70: 6e76 6572 7465 6420 6c61 6265 6c20 746f  nverted label to
-0000fa80: 206d 6f76 652e 0a0a 2020 2020 5265 7475   move...    Retu
-0000fa90: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
-0000faa0: 2020 2020 6f66 6673 6574 5f70 6f73 6974      offset_posit
-0000fab0: 696f 6e20 3a20 6172 7261 792d 6c69 6b65  ion : array-like
-0000fac0: 0a20 2020 2020 2020 2043 6f6f 7264 696e  .        Coordin
-0000fad0: 6174 6573 206f 6620 6e65 7720 706f 7274  ates of new port
-0000fae0: 2070 6f73 6974 696f 6e2e 0a20 2020 2022   position..    "
-0000faf0: 2222 0a20 2020 206f 6666 7365 745f 706f  "".    offset_po
-0000fb00: 7369 7469 6f6e 203d 206e 702e 6172 7261  sition = np.arra
-0000fb10: 7928 0a20 2020 2020 2020 2028 2d63 6f73  y(.        (-cos
-0000fb20: 2870 6920 2f20 3138 3020 2a20 706f 7274  (pi / 180 * port
-0000fb30: 2e6f 7269 656e 7461 7469 6f6e 292c 202d  .orientation), -
-0000fb40: 7369 6e28 7069 202f 2031 3830 202a 2070  sin(pi / 180 * p
-0000fb50: 6f72 742e 6f72 6965 6e74 6174 696f 6e29  ort.orientation)
-0000fb60: 290a 2020 2020 290a 2020 2020 6f66 6673  ).    ).    offs
-0000fb70: 6574 5f70 6f73 6974 696f 6e20 2a3d 2070  et_position *= p
-0000fb80: 6f72 742e 7769 6474 6820 2a20 302e 3035  ort.width * 0.05
-0000fb90: 0a20 2020 2072 6574 7572 6e20 6f66 6673  .    return offs
-0000fba0: 6574 5f70 6f73 6974 696f 6e0a 0a0a 6465  et_position...de
-0000fbb0: 6620 5f63 6f6e 7665 7274 5f67 656f 6d65  f _convert_geome
-0000fbc0: 7472 795f 746f 5f70 6f72 7428 6c61 6265  try_to_port(labe
-0000fbd0: 6c2c 206c 6179 6572 3d30 293a 0a20 2020  l, layer=0):.   
-0000fbe0: 2022 2222 436f 6e76 6572 7473 2061 206c   """Converts a l
-0000fbf0: 6162 656c 2069 6e74 6f20 6120 506f 7274  abel into a Port
-0000fc00: 2069 6e20 7468 6520 7061 7265 6e74 2044   in the parent D
-0000fc10: 6576 6963 652e 2054 6865 206c 6162 656c  evice. The label
-0000fc20: 2063 6f6e 7461 696e 730a 2020 2020 6e61   contains.    na
-0000fc30: 6d65 2c20 7769 6474 682c 206f 7269 656e  me, width, orien
-0000fc40: 7461 7469 6f6e 2e20 446f 6573 206e 6f74  tation. Does not
-0000fc50: 2072 656d 6f76 6520 7468 6174 206c 6162   remove that lab
-0000fc60: 656c 2066 726f 6d20 7468 6520 7061 7265  el from the pare
-0000fc70: 6e74 2e0a 2020 2020 5265 7475 726e 7320  nt..    Returns 
-0000fc80: 7468 6520 6e65 7720 706f 7274 2e0a 0a20  the new port... 
-0000fc90: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-0000fca0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-0000fcb0: 206c 6162 656c 203a 204c 6162 656c 0a20   label : Label. 
-0000fcc0: 2020 2020 2020 204c 6162 656c 2074 6f20         Label to 
-0000fcd0: 6265 2063 6f6e 7665 7274 6564 2069 6e74  be converted int
-0000fce0: 6f20 6120 506f 7274 2e0a 2020 2020 6c61  o a Port..    la
-0000fcf0: 7965 7220 3a20 696e 742c 2061 7272 6179  yer : int, array
-0000fd00: 2d6c 696b 655b 325d 2c20 6f72 2073 6574  -like[2], or set
-0000fd10: 0a20 2020 2020 2020 2053 7065 6369 6669  .        Specifi
-0000fd20: 6320 6c61 7965 7228 7329 2074 6f20 7075  c layer(s) to pu
-0000fd30: 7420 506f 7274 206f 6e2e 0a0a 2020 2020  t Port on...    
-0000fd40: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
-0000fd50: 2d2d 2d0a 2020 2020 6e65 775f 706f 7274  ---.    new_port
-0000fd60: 203a 2050 6f72 740a 2020 2020 2020 2020   : Port.        
-0000fd70: 506f 7274 2d63 6f6e 7665 7274 6564 206c  Port-converted l
-0000fd80: 6162 656c 2e0a 2020 2020 2222 220a 2020  abel..    """.  
-0000fd90: 2020 6e61 6d65 2c20 7769 6474 682c 206f    name, width, o
-0000fda0: 7269 656e 7461 7469 6f6e 203d 206a 736f  rientation = jso
-0000fdb0: 6e2e 6c6f 6164 7328 6c61 6265 6c2e 7465  n.loads(label.te
-0000fdc0: 7874 290a 2020 2020 6e65 775f 706f 7274  xt).    new_port
-0000fdd0: 203d 2050 6f72 7428 6e61 6d65 3d6e 616d   = Port(name=nam
-0000fde0: 652c 2077 6964 7468 3d77 6964 7468 2c20  e, width=width, 
-0000fdf0: 6f72 6965 6e74 6174 696f 6e3d 6f72 6965  orientation=orie
-0000fe00: 6e74 6174 696f 6e29 0a20 2020 206e 6577  ntation).    new
-0000fe10: 5f70 6f72 742e 6d69 6470 6f69 6e74 203d  _port.midpoint =
-0000fe20: 206c 6162 656c 2e70 6f73 6974 696f 6e20   label.position 
-0000fe30: 2d20 5f63 616c 6375 6c61 7465 5f6c 6162  - _calculate_lab
-0000fe40: 656c 5f6f 6666 7365 7428 6e65 775f 706f  el_offset(new_po
-0000fe50: 7274 290a 2020 2020 7265 7475 726e 206e  rt).    return n
-0000fe60: 6577 5f70 6f72 740a 0a0a 6465 6620 706f  ew_port...def po
-0000fe70: 7274 735f 746f 5f67 656f 6d65 7472 7928  rts_to_geometry(
-0000fe80: 6465 7669 6365 2c20 6c61 7965 723d 3029  device, layer=0)
-0000fe90: 3a0a 2020 2020 2222 2243 6f6e 7665 7274  :.    """Convert
-0000fea0: 7320 506f 7274 206f 626a 6563 7473 206f  s Port objects o
-0000feb0: 7665 7220 7468 6520 7768 6f6c 6520 4465  ver the whole De
-0000fec0: 7669 6365 2068 6965 7261 7263 6879 2074  vice hierarchy t
-0000fed0: 6f20 6765 6f6d 6574 7279 2061 6e64 0a20  o geometry and. 
-0000fee0: 2020 206c 6162 656c 732e 0a0a 2020 2020     labels...    
-0000fef0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-0000ff00: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6465  ---------.    de
-0000ff10: 7669 6365 203a 2044 6576 6963 650a 2020  vice : Device.  
-0000ff20: 2020 2020 2020 4465 7669 6365 2063 6f6e        Device con
-0000ff30: 7461 696e 696e 6720 506f 7274 206f 626a  taining Port obj
-0000ff40: 6563 7473 2074 6f20 636f 6e76 6572 742e  ects to convert.
-0000ff50: 0a20 2020 206c 6179 6572 203a 2069 6e74  .    layer : int
-0000ff60: 2c20 6172 7261 792d 6c69 6b65 5b32 5d2c  , array-like[2],
-0000ff70: 206f 7220 7365 740a 2020 2020 2020 2020   or set.        
-0000ff80: 5370 6563 6966 6963 206c 6179 6572 2873  Specific layer(s
-0000ff90: 2920 746f 2070 7574 2070 6f6c 7967 6f6e  ) to put polygon
-0000ffa0: 2067 656f 6d65 7472 7920 6f6e 2028 7468   geometry on (th
-0000ffb0: 6520 7370 6563 6961 6c20 706f 7274 2072  e special port r
-0000ffc0: 6563 6f72 640a 2020 2020 2020 2020 6c61  ecord.        la
-0000ffd0: 7965 7229 2e0a 0a20 2020 2052 6574 7572  yer)...    Retur
-0000ffe0: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
-0000fff0: 2020 2074 656d 705f 6465 7669 6365 203a     temp_device :
-00010000: 2044 6576 6963 650a 2020 2020 2020 2020   Device.        
-00010010: 4120 4465 7669 6365 2077 6974 6820 616c  A Device with al
-00010020: 6c20 506f 7274 7320 636f 6e76 6572 7465  l Ports converte
-00010030: 6420 746f 2067 656f 6d65 7472 792f 6c61  d to geometry/la
-00010040: 6265 6c73 2061 6e64 2072 656d 6f76 6564  bels and removed
-00010050: 2e0a 2020 2020 2222 220a 2020 2020 7465  ..    """.    te
-00010060: 6d70 5f64 6576 6963 6520 3d20 6465 6570  mp_device = deep
-00010070: 636f 7079 2864 6576 6963 6529 0a20 2020  copy(device).   
-00010080: 2061 6c6c 5f63 656c 6c73 203d 206c 6973   all_cells = lis
-00010090: 7428 7465 6d70 5f64 6576 6963 652e 6765  t(temp_device.ge
-000100a0: 745f 6465 7065 6e64 656e 6369 6573 2872  t_dependencies(r
-000100b0: 6563 7572 7369 7665 3d54 7275 6529 290a  ecursive=True)).
-000100c0: 2020 2020 616c 6c5f 6365 6c6c 732e 6170      all_cells.ap
-000100d0: 7065 6e64 2874 656d 705f 6465 7669 6365  pend(temp_device
-000100e0: 290a 2020 2020 666f 7220 7375 6263 656c  ).    for subcel
-000100f0: 6c20 696e 2061 6c6c 5f63 656c 6c73 3a0a  l in all_cells:.
-00010100: 2020 2020 2020 2020 666f 7220 706f 7274          for port
-00010110: 2069 6e20 7375 6263 656c 6c2e 706f 7274   in subcell.port
-00010120: 732e 7661 6c75 6573 2829 3a0a 2020 2020  s.values():.    
-00010130: 2020 2020 2020 2020 5f63 6f6e 7665 7274          _convert
-00010140: 5f70 6f72 745f 746f 5f67 656f 6d65 7472  _port_to_geometr
-00010150: 7928 706f 7274 2c20 6c61 7965 723d 6c61  y(port, layer=la
-00010160: 7965 7229 0a20 2020 2020 2020 2020 2020  yer).           
-00010170: 2073 7562 6365 6c6c 2e72 656d 6f76 6528   subcell.remove(
-00010180: 706f 7274 290a 2020 2020 7265 7475 726e  port).    return
-00010190: 2074 656d 705f 6465 7669 6365 0a0a 0a64   temp_device...d
-000101a0: 6566 2067 656f 6d65 7472 795f 746f 5f70  ef geometry_to_p
-000101b0: 6f72 7473 2864 6576 6963 652c 206c 6179  orts(device, lay
-000101c0: 6572 3d30 293a 0a20 2020 2022 2222 436f  er=0):.    """Co
-000101d0: 6e76 6572 7473 2067 656f 6d65 7472 7920  nverts geometry 
-000101e0: 7265 7072 6573 656e 7469 6e67 2070 6f72  representing por
-000101f0: 7473 206f 7665 7220 7468 6520 7768 6f6c  ts over the whol
-00010200: 6520 4465 7669 6365 2068 6965 7261 7263  e Device hierarc
-00010210: 6879 0a20 2020 2069 6e74 6f20 506f 7274  hy.    into Port
-00010220: 206f 626a 6563 7473 2e0a 0a20 2020 2050   objects...    P
-00010230: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-00010240: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2064 6576  --------.    dev
-00010250: 6963 6520 3a20 4465 7669 6365 0a20 2020  ice : Device.   
-00010260: 2020 2020 2044 6576 6963 6520 636f 6e74       Device cont
-00010270: 6169 6e69 6e67 2067 656f 6d65 7472 7920  aining geometry 
-00010280: 7265 7072 6573 656e 7469 6e67 2070 6f72  representing por
-00010290: 7473 2074 6f20 636f 6e76 6572 742e 0a20  ts to convert.. 
-000102a0: 2020 206c 6179 6572 203a 2069 6e74 2c20     layer : int, 
-000102b0: 6172 7261 792d 6c69 6b65 5b32 5d2c 206f  array-like[2], o
-000102c0: 7220 7365 740a 2020 2020 2020 2020 5370  r set.        Sp
-000102d0: 6563 6966 6963 206c 6179 6572 2873 2920  ecific layer(s) 
-000102e0: 746f 2070 7574 2070 6f6c 7967 6f6e 2067  to put polygon g
-000102f0: 656f 6d65 7472 7920 6f6e 2028 7468 6520  eometry on (the 
-00010300: 7370 6563 6961 6c20 706f 7274 2072 6563  special port rec
-00010310: 6f72 640a 2020 2020 2020 2020 6c61 7965  ord.        laye
-00010320: 7229 0a0a 2020 2020 5265 7475 726e 730a  r)..    Returns.
-00010330: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-00010340: 7465 6d70 5f64 6576 6963 6520 3a20 4465  temp_device : De
-00010350: 7669 6365 0a20 2020 2020 2020 2041 2044  vice.        A D
-00010360: 6576 6963 6520 7769 7468 2061 6c6c 2067  evice with all g
-00010370: 656f 6d65 7472 7920 7265 7072 6573 656e  eometry represen
-00010380: 7469 6e67 2070 6f72 7473 2063 6f6e 7665  ting ports conve
-00010390: 7274 6564 2074 6f20 506f 7274 7320 616e  rted to Ports an
-000103a0: 640a 2020 2020 2020 2020 7265 6d6f 7665  d.        remove
-000103b0: 642e 0a0a 2020 2020 4e6f 7465 730a 2020  d...    Notes.  
-000103c0: 2020 2d2d 2d2d 2d0a 2020 2020 446f 6573    -----.    Does
-000103d0: 206e 6f74 206d 7574 6174 6520 7468 6520   not mutate the 
-000103e0: 6465 7669 6365 2069 6e20 7468 6520 6172  device in the ar
-000103f0: 6775 6d65 6e74 2e20 5265 7475 726e 7320  gument. Returns 
-00010400: 6120 6e65 7720 6f6e 6520 6c61 636b 696e  a new one lackin
-00010410: 6720 616c 6c0a 2020 2020 706f 7274 2067  g all.    port g
-00010420: 656f 6d65 7472 7920 2869 6e63 6c2e 206c  eometry (incl. l
-00010430: 6162 656c 7329 0a20 2020 2022 2222 0a20  abels).    """. 
-00010440: 2020 2074 656d 705f 6465 7669 6365 203d     temp_device =
-00010450: 2064 6565 7063 6f70 7928 6465 7669 6365   deepcopy(device
-00010460: 290a 2020 2020 616c 6c5f 6365 6c6c 7320  ).    all_cells 
-00010470: 3d20 6c69 7374 2874 656d 705f 6465 7669  = list(temp_devi
-00010480: 6365 2e67 6574 5f64 6570 656e 6465 6e63  ce.get_dependenc
-00010490: 6965 7328 7265 6375 7273 6976 653d 5472  ies(recursive=Tr
-000104a0: 7565 2929 0a20 2020 2061 6c6c 5f63 656c  ue)).    all_cel
-000104b0: 6c73 2e61 7070 656e 6428 7465 6d70 5f64  ls.append(temp_d
-000104c0: 6576 6963 6529 0a20 2020 2066 6f72 2073  evice).    for s
-000104d0: 7562 6365 6c6c 2069 6e20 616c 6c5f 6365  ubcell in all_ce
-000104e0: 6c6c 733a 2020 2320 5761 6c6b 2074 6872  lls:  # Walk thr
-000104f0: 6f75 6768 2063 656c 6c73 0a20 2020 2020  ough cells.     
-00010500: 2020 2066 6f72 206c 6162 2069 6e20 7375     for lab in su
-00010510: 6263 656c 6c2e 6c61 6265 6c73 3a0a 2020  bcell.labels:.  
-00010520: 2020 2020 2020 2020 2020 6966 206c 6162            if lab
-00010530: 2e6c 6179 6572 203d 3d20 6c61 7965 723a  .layer == layer:
-00010540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010550: 2074 6865 5f70 6f72 7420 3d20 5f63 6f6e   the_port = _con
-00010560: 7665 7274 5f67 656f 6d65 7472 795f 746f  vert_geometry_to
-00010570: 5f70 6f72 7428 6c61 6229 0a20 2020 2020  _port(lab).     
-00010580: 2020 2020 2020 2020 2020 2073 7562 6365             subce
-00010590: 6c6c 2e61 6464 5f70 6f72 7428 6e61 6d65  ll.add_port(name
-000105a0: 3d74 6865 5f70 6f72 742e 6e61 6d65 2c20  =the_port.name, 
-000105b0: 706f 7274 3d74 6865 5f70 6f72 7429 0a20  port=the_port). 
-000105c0: 2020 2074 656d 705f 6465 7669 6365 2e72     temp_device.r
-000105d0: 656d 6f76 655f 6c61 7965 7273 286c 6179  emove_layers(lay
-000105e0: 6572 733d 5b6c 6179 6572 5d2c 2069 6e63  ers=[layer], inc
-000105f0: 6c75 6465 5f6c 6162 656c 733d 5472 7565  lude_labels=True
-00010600: 290a 2020 2020 7265 7475 726e 2074 656d  ).    return tem
-00010610: 705f 6465 7669 6365 0a0a 0a23 203d 3d3d  p_device...# ===
-00010620: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00010630: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00010640: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00010650: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00010660: 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 230a 2320  ===========.#.# 
-00010670: 436f 6e6e 6563 746f 7273 0a23 0a23 203d  Connectors.#.# =
-00010680: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00010690: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000106a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000106b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000106c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 0a0a  =============...
-000106d0: 6465 6620 636f 6e6e 6563 746f 7228 6d69  def connector(mi
-000106e0: 6470 6f69 6e74 3d28 302c 2030 292c 2077  dpoint=(0, 0), w
-000106f0: 6964 7468 3d31 2c20 6f72 6965 6e74 6174  idth=1, orientat
-00010700: 696f 6e3d 3029 3a0a 2020 2020 2222 2243  ion=0):.    """C
-00010710: 7265 6174 6573 2061 2044 6576 6963 6520  reates a Device 
-00010720: 7768 6963 6820 6861 7320 6261 636b 2d74  which has back-t
-00010730: 6f2d 6261 636b 2070 6f72 7473 2e0a 0a20  o-back ports... 
-00010740: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00010750: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-00010760: 206d 6964 706f 696e 7420 3a20 6172 7261   midpoint : arra
-00010770: 792d 6c69 6b65 0a20 2020 2020 2020 2043  y-like.        C
-00010780: 6f6f 7264 696e 6174 6573 206f 6620 4465  oordinates of De
-00010790: 7669 6365 206d 6964 706f 696e 742e 0a20  vice midpoint.. 
-000107a0: 2020 2077 6964 7468 203a 2069 6e74 206f     width : int o
-000107b0: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
-000107c0: 5769 6474 6820 6f66 2063 6f6e 6e65 6374  Width of connect
-000107d0: 6f72 206f 6e20 6e6f 6e2d 706f 7274 2061  or on non-port a
-000107e0: 7869 732e 0a20 2020 206f 7269 656e 7461  xis..    orienta
-000107f0: 7469 6f6e 203a 2069 6e74 206f 7220 666c  tion : int or fl
-00010800: 6f61 740a 2020 2020 2020 2020 4f72 6965  oat.        Orie
-00010810: 6e74 6174 696f 6e20 6f66 2074 6865 2070  ntation of the p
-00010820: 6f72 7473 2e0a 0a20 2020 2052 6574 7572  orts...    Retur
-00010830: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
-00010840: 2020 2044 203a 2044 6576 6963 650a 2020     D : Device.  
-00010850: 2020 2020 2020 4120 4465 7669 6365 2063        A Device c
-00010860: 6f6e 7461 696e 696e 6720 6120 6261 636b  ontaining a back
-00010870: 2d74 6f2d 6261 636b 2070 6f72 7420 6765  -to-back port ge
-00010880: 6f6d 6574 7279 2e0a 2020 2020 2222 220a  ometry..    """.
-00010890: 2020 2020 4420 3d20 4465 7669 6365 286e      D = Device(n
-000108a0: 616d 653d 2263 6f6e 6e65 6374 6f72 2229  ame="connector")
-000108b0: 0a20 2020 2044 2e61 6464 5f70 6f72 7428  .    D.add_port(
-000108c0: 0a20 2020 2020 2020 206e 616d 653d 312c  .        name=1,
-000108d0: 0a20 2020 2020 2020 206d 6964 706f 696e  .        midpoin
-000108e0: 743d 5b6d 6964 706f 696e 745b 305d 2c20  t=[midpoint[0], 
-000108f0: 6d69 6470 6f69 6e74 5b31 5d5d 2c0a 2020  midpoint[1]],.  
-00010900: 2020 2020 2020 7769 6474 683d 7769 6474        width=widt
-00010910: 682c 0a20 2020 2020 2020 206f 7269 656e  h,.        orien
-00010920: 7461 7469 6f6e 3d6f 7269 656e 7461 7469  tation=orientati
-00010930: 6f6e 2c0a 2020 2020 290a 2020 2020 442e  on,.    ).    D.
-00010940: 6164 645f 706f 7274 280a 2020 2020 2020  add_port(.      
-00010950: 2020 6e61 6d65 3d32 2c0a 2020 2020 2020    name=2,.      
-00010960: 2020 6d69 6470 6f69 6e74 3d5b 6d69 6470    midpoint=[midp
-00010970: 6f69 6e74 5b30 5d2c 206d 6964 706f 696e  oint[0], midpoin
-00010980: 745b 315d 5d2c 0a20 2020 2020 2020 2077  t[1]],.        w
-00010990: 6964 7468 3d77 6964 7468 2c0a 2020 2020  idth=width,.    
-000109a0: 2020 2020 6f72 6965 6e74 6174 696f 6e3d      orientation=
-000109b0: 6f72 6965 6e74 6174 696f 6e20 2d20 3138  orientation - 18
-000109c0: 302c 0a20 2020 2029 0a20 2020 2072 6574  0,.    ).    ret
-000109d0: 7572 6e20 440a 0a0a 2320 3d3d 3d3d 3d3d  urn D...# ======
-000109e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000109f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00010a00: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00010a10: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00010a20: 3d3d 3d3d 3d3d 3d3d 0a23 0a23 2043 6f6e  ========.#.# Con
-00010a30: 7461 6374 2070 6164 730a 230a 2320 3d3d  tact pads.#.# ==
-00010a40: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00010a50: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00010a60: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00010a70: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00010a80: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a0a 0a64  ============...d
-00010a90: 6566 2063 6f6d 7061 7373 2873 697a 653d  ef compass(size=
-00010aa0: 2834 2c20 3229 2c20 6c61 7965 723d 3029  (4, 2), layer=0)
-00010ab0: 3a0a 2020 2020 2222 2243 7265 6174 6573  :.    """Creates
-00010ac0: 2061 2072 6563 7461 6e67 756c 6172 2063   a rectangular c
-00010ad0: 6f6e 7461 6374 2070 6164 2077 6974 6820  ontact pad with 
-00010ae0: 6365 6e74 6572 6564 2070 6f72 7473 206f  centered ports o
-00010af0: 6e20 6564 6765 7320 6f66 2074 6865 0a20  n edges of the. 
-00010b00: 2020 2072 6563 7461 6e67 6c65 2028 6e6f     rectangle (no
-00010b10: 7274 682c 2073 6f75 7468 2c20 6561 7374  rth, south, east
-00010b20: 2c20 616e 6420 7765 7374 292e 0a0a 2020  , and west)...  
-00010b30: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00010b40: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00010b50: 7369 7a65 203a 2061 7272 6179 5f6c 696b  size : array_lik
-00010b60: 655b 325d 0a20 2020 2020 2020 2044 696d  e[2].        Dim
-00010b70: 656e 7369 6f6e 7320 6f66 2074 6865 2072  ensions of the r
-00010b80: 6563 7461 6e67 756c 6172 2063 6f6e 7461  ectangular conta
-00010b90: 6374 2070 6164 2e0a 2020 2020 6c61 7965  ct pad..    laye
-00010ba0: 7220 3a20 696e 742c 2061 7272 6179 2d6c  r : int, array-l
-00010bb0: 696b 655b 325d 2c20 6f72 2073 6574 0a20  ike[2], or set. 
-00010bc0: 2020 2020 2020 2053 7065 6369 6669 6320         Specific 
-00010bd0: 6c61 7965 7228 7329 2074 6f20 7075 7420  layer(s) to put 
-00010be0: 706f 6c79 676f 6e20 6765 6f6d 6574 7279  polygon geometry
-00010bf0: 206f 6e2e 0a0a 2020 2020 5265 7475 726e   on...    Return
-00010c00: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-00010c10: 2020 4420 3a20 4465 7669 6365 0a20 2020    D : Device.   
-00010c20: 2020 2020 2041 2044 6576 6963 6520 636f       A Device co
-00010c30: 6e74 6169 6e69 6e67 2061 2072 6563 7461  ntaining a recta
-00010c40: 6e67 756c 6172 2063 6f6e 7461 6374 2070  ngular contact p
-00010c50: 6164 2077 6974 6820 6365 6e74 6572 6564  ad with centered
-00010c60: 2070 6f72 7473 2e0a 2020 2020 2222 220a   ports..    """.
-00010c70: 2020 2020 4420 3d20 4465 7669 6365 286e      D = Device(n
-00010c80: 616d 653d 2263 6f6d 7061 7373 2229 0a20  ame="compass"). 
-00010c90: 2020 2072 203d 2044 2e61 6464 5f72 6566     r = D.add_ref
-00010ca0: 2872 6563 7461 6e67 6c65 2873 697a 652c  (rectangle(size,
-00010cb0: 206c 6179 6572 3d6c 6179 6572 2929 0a20   layer=layer)). 
-00010cc0: 2020 2072 2e63 656e 7465 7220 3d20 2830     r.center = (0
-00010cd0: 2c20 3029 0a0a 2020 2020 6478 203d 2073  , 0)..    dx = s
-00010ce0: 697a 655b 305d 0a20 2020 2064 7920 3d20  ize[0].    dy = 
-00010cf0: 7369 7a65 5b31 5d0a 2020 2020 442e 6164  size[1].    D.ad
-00010d00: 645f 706f 7274 286e 616d 653d 224e 222c  d_port(name="N",
-00010d10: 206d 6964 706f 696e 743d 5b30 2c20 6479   midpoint=[0, dy
-00010d20: 202f 2032 5d2c 2077 6964 7468 3d64 782c   / 2], width=dx,
-00010d30: 206f 7269 656e 7461 7469 6f6e 3d39 3029   orientation=90)
-00010d40: 0a20 2020 2044 2e61 6464 5f70 6f72 7428  .    D.add_port(
-00010d50: 6e61 6d65 3d22 5322 2c20 6d69 6470 6f69  name="S", midpoi
-00010d60: 6e74 3d5b 302c 202d 6479 202f 2032 5d2c  nt=[0, -dy / 2],
-00010d70: 2077 6964 7468 3d64 782c 206f 7269 656e   width=dx, orien
-00010d80: 7461 7469 6f6e 3d2d 3930 290a 2020 2020  tation=-90).    
-00010d90: 442e 6164 645f 706f 7274 286e 616d 653d  D.add_port(name=
-00010da0: 2245 222c 206d 6964 706f 696e 743d 5b64  "E", midpoint=[d
-00010db0: 7820 2f20 322c 2030 5d2c 2077 6964 7468  x / 2, 0], width
-00010dc0: 3d64 792c 206f 7269 656e 7461 7469 6f6e  =dy, orientation
-00010dd0: 3d30 290a 2020 2020 442e 6164 645f 706f  =0).    D.add_po
-00010de0: 7274 286e 616d 653d 2257 222c 206d 6964  rt(name="W", mid
-00010df0: 706f 696e 743d 5b2d 6478 202f 2032 2c20  point=[-dx / 2, 
-00010e00: 305d 2c20 7769 6474 683d 6479 2c20 6f72  0], width=dy, or
-00010e10: 6965 6e74 6174 696f 6e3d 3138 3029 0a0a  ientation=180)..
-00010e20: 2020 2020 7265 7475 726e 2044 0a0a 0a64      return D...d
-00010e30: 6566 2063 6f6d 7061 7373 5f6d 756c 7469  ef compass_multi
-00010e40: 2873 697a 653d 2834 2c20 3229 2c20 706f  (size=(4, 2), po
-00010e50: 7274 733d 7b22 4e22 3a20 332c 2022 5322  rts={"N": 3, "S"
-00010e60: 3a20 347d 2c20 6c61 7965 723d 3029 3a0a  : 4}, layer=0):.
-00010e70: 2020 2020 2222 2243 7265 6174 6573 2061      """Creates a
-00010e80: 2072 6563 7461 6e67 756c 6172 2063 6f6e   rectangular con
-00010e90: 7461 6374 2070 6164 2077 6974 6820 6d75  tact pad with mu
-00010ea0: 6c74 6970 6c65 2070 6f72 7473 2061 6c6f  ltiple ports alo
-00010eb0: 6e67 2074 6865 2065 6467 6573 0a20 2020  ng the edges.   
-00010ec0: 2072 6563 7461 6e67 6c65 2028 6e6f 7274   rectangle (nort
-00010ed0: 682c 2073 6f75 7468 2c20 6561 7374 2c20  h, south, east, 
-00010ee0: 616e 6420 7765 7374 292e 0a0a 2020 2020  and west)...    
-00010ef0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-00010f00: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 7369  ---------.    si
-00010f10: 7a65 203a 2061 7272 6179 5f6c 696b 650a  ze : array_like.
-00010f20: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
-00010f30: 6e73 206f 6620 7468 6520 7265 6374 616e  ns of the rectan
-00010f40: 6775 6c61 7220 636f 6e74 6163 7420 7061  gular contact pa
-00010f50: 642e 0a20 2020 2070 6f72 7473 203a 2064  d..    ports : d
-00010f60: 6963 740a 2020 2020 2020 2020 4e75 6d62  ict.        Numb
-00010f70: 6572 206f 6620 706f 7274 7320 6f6e 2065  er of ports on e
-00010f80: 6163 6820 6564 6765 206f 6620 7468 6520  ach edge of the 
-00010f90: 7265 6374 616e 676c 652e 0a20 2020 206c  rectangle..    l
-00010fa0: 6179 6572 203a 2069 6e74 2c20 6172 7261  ayer : int, arra
-00010fb0: 792d 6c69 6b65 5b32 5d2c 206f 7220 7365  y-like[2], or se
-00010fc0: 740a 2020 2020 2020 2020 5370 6563 6966  t.        Specif
-00010fd0: 6963 206c 6179 6572 2873 2920 746f 2070  ic layer(s) to p
-00010fe0: 7574 2070 6f6c 7967 6f6e 2067 656f 6d65  ut polygon geome
-00010ff0: 7472 7920 6f6e 2e0a 0a20 2020 2052 6574  try on...    Ret
-00011000: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
-00011010: 0a20 2020 2044 203a 2044 6576 6963 650a  .    D : Device.
-00011020: 2020 2020 2020 2020 4120 4465 7669 6365          A Device
-00011030: 2063 6f6e 7461 696e 696e 6720 6120 7265   containing a re
-00011040: 6374 616e 6775 6c61 7220 636f 6e74 6163  ctangular contac
-00011050: 7420 7061 6420 7769 7468 206d 756c 7469  t pad with multi
-00011060: 706c 6520 706f 7274 732e 0a20 2020 2022  ple ports..    "
-00011070: 2222 0a20 2020 2044 203d 2044 6576 6963  "".    D = Devic
-00011080: 6528 6e61 6d65 3d22 636f 6d70 6173 735f  e(name="compass_
-00011090: 6d75 6c74 6922 290a 2020 2020 7220 3d20  multi").    r = 
-000110a0: 442e 6164 645f 7265 6628 7265 6374 616e  D.add_ref(rectan
-000110b0: 676c 6528 7369 7a65 2c20 6c61 7965 723d  gle(size, layer=
-000110c0: 6c61 7965 7229 290a 2020 2020 722e 6365  layer)).    r.ce
-000110d0: 6e74 6572 203d 2028 302c 2030 290a 0a20  nter = (0, 0).. 
-000110e0: 2020 2064 7820 3d20 7369 7a65 5b30 5d20     dx = size[0] 
-000110f0: 2f20 320a 2020 2020 6479 203d 2073 697a  / 2.    dy = siz
-00011100: 655b 315d 202f 2032 0a0a 2020 2020 6966  e[1] / 2..    if
-00011110: 2022 4e22 2069 6e20 706f 7274 733a 0a20   "N" in ports:. 
-00011120: 2020 2020 2020 206e 756d 5f70 6f72 7473         num_ports
-00011130: 203d 2070 6f72 7473 5b22 4e22 5d0a 2020   = ports["N"].  
-00011140: 2020 2020 2020 6d20 3d20 6478 202d 2064        m = dx - d
-00011150: 7820 2f20 6e75 6d5f 706f 7274 730a 2020  x / num_ports.  
-00011160: 2020 2020 2020 705f 6c69 7374 203d 206e        p_list = n
-00011170: 702e 6c69 6e73 7061 6365 282d 6d2c 206d  p.linspace(-m, m
-00011180: 2c20 6e75 6d5f 706f 7274 7329 0a20 2020  , num_ports).   
-00011190: 2020 2020 205b 0a20 2020 2020 2020 2020       [.         
-000111a0: 2020 2044 2e61 6464 5f70 6f72 7428 0a20     D.add_port(. 
-000111b0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000111c0: 616d 653d 2822 4e25 7322 2025 2028 6e20  ame=("N%s" % (n 
-000111d0: 2b20 3129 292c 0a20 2020 2020 2020 2020  + 1)),.         
-000111e0: 2020 2020 2020 206d 6964 706f 696e 743d         midpoint=
-000111f0: 5b70 2c20 6479 5d2c 0a20 2020 2020 2020  [p, dy],.       
-00011200: 2020 2020 2020 2020 2077 6964 7468 3d64           width=d
-00011210: 7820 2f20 6e75 6d5f 706f 7274 7320 2a20  x / num_ports * 
-00011220: 322c 0a20 2020 2020 2020 2020 2020 2020  2,.             
-00011230: 2020 206f 7269 656e 7461 7469 6f6e 3d39     orientation=9
-00011240: 302c 0a20 2020 2020 2020 2020 2020 2029  0,.            )
-00011250: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00011260: 206e 2c20 7020 696e 2065 6e75 6d65 7261   n, p in enumera
-00011270: 7465 2870 5f6c 6973 7429 0a20 2020 2020  te(p_list).     
-00011280: 2020 205d 0a20 2020 2069 6620 2253 2220     ].    if "S" 
-00011290: 696e 2070 6f72 7473 3a0a 2020 2020 2020  in ports:.      
-000112a0: 2020 6e75 6d5f 706f 7274 7320 3d20 706f    num_ports = po
-000112b0: 7274 735b 2253 225d 0a20 2020 2020 2020  rts["S"].       
-000112c0: 206d 203d 2064 7820 2d20 6478 202f 206e   m = dx - dx / n
-000112d0: 756d 5f70 6f72 7473 0a20 2020 2020 2020  um_ports.       
-000112e0: 2070 5f6c 6973 7420 3d20 6e70 2e6c 696e   p_list = np.lin
-000112f0: 7370 6163 6528 2d6d 2c20 6d2c 206e 756d  space(-m, m, num
-00011300: 5f70 6f72 7473 290a 2020 2020 2020 2020  _ports).        
-00011310: 5b0a 2020 2020 2020 2020 2020 2020 442e  [.            D.
-00011320: 6164 645f 706f 7274 280a 2020 2020 2020  add_port(.      
-00011330: 2020 2020 2020 2020 2020 6e61 6d65 3d28            name=(
-00011340: 2253 2573 2220 2520 286e 202b 2031 2929  "S%s" % (n + 1))
-00011350: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00011360: 2020 6d69 6470 6f69 6e74 3d5b 702c 202d    midpoint=[p, -
-00011370: 6479 5d2c 0a20 2020 2020 2020 2020 2020  dy],.           
-00011380: 2020 2020 2077 6964 7468 3d64 7820 2f20       width=dx / 
-00011390: 6e75 6d5f 706f 7274 7320 2a20 322c 0a20  num_ports * 2,. 
-000113a0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-000113b0: 7269 656e 7461 7469 6f6e 3d2d 3930 2c0a  rientation=-90,.
-000113c0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-000113d0: 2020 2020 2020 2020 2020 666f 7220 6e2c            for n,
-000113e0: 2070 2069 6e20 656e 756d 6572 6174 6528   p in enumerate(
-000113f0: 705f 6c69 7374 290a 2020 2020 2020 2020  p_list).        
-00011400: 5d0a 2020 2020 6966 2022 4522 2069 6e20  ].    if "E" in 
-00011410: 706f 7274 733a 0a20 2020 2020 2020 206e  ports:.        n
-00011420: 756d 5f70 6f72 7473 203d 2070 6f72 7473  um_ports = ports
-00011430: 5b22 4522 5d0a 2020 2020 2020 2020 6d20  ["E"].        m 
-00011440: 3d20 6479 202d 2064 7920 2f20 6e75 6d5f  = dy - dy / num_
-00011450: 706f 7274 730a 2020 2020 2020 2020 705f  ports.        p_
-00011460: 6c69 7374 203d 206e 702e 6c69 6e73 7061  list = np.linspa
-00011470: 6365 282d 6d2c 206d 2c20 6e75 6d5f 706f  ce(-m, m, num_po
-00011480: 7274 7329 0a20 2020 2020 2020 205b 0a20  rts).        [. 
-00011490: 2020 2020 2020 2020 2020 2044 2e61 6464             D.add
-000114a0: 5f70 6f72 7428 0a20 2020 2020 2020 2020  _port(.         
-000114b0: 2020 2020 2020 206e 616d 653d 2822 4525         name=("E%
-000114c0: 7322 2025 2028 6e20 2b20 3129 292c 0a20  s" % (n + 1)),. 
-000114d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000114e0: 6964 706f 696e 743d 5b64 782c 2070 5d2c  idpoint=[dx, p],
-000114f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011500: 2077 6964 7468 3d64 7920 2f20 6e75 6d5f   width=dy / num_
-00011510: 706f 7274 7320 2a20 322c 0a20 2020 2020  ports * 2,.     
-00011520: 2020 2020 2020 2020 2020 206f 7269 656e             orien
-00011530: 7461 7469 6f6e 3d30 2c0a 2020 2020 2020  tation=0,.      
-00011540: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00011550: 2020 2020 666f 7220 6e2c 2070 2069 6e20      for n, p in 
-00011560: 656e 756d 6572 6174 6528 705f 6c69 7374  enumerate(p_list
-00011570: 290a 2020 2020 2020 2020 5d0a 2020 2020  ).        ].    
-00011580: 6966 2022 5722 2069 6e20 706f 7274 733a  if "W" in ports:
-00011590: 0a20 2020 2020 2020 206e 756d 5f70 6f72  .        num_por
-000115a0: 7473 203d 2070 6f72 7473 5b22 5722 5d0a  ts = ports["W"].
-000115b0: 2020 2020 2020 2020 6d20 3d20 6479 202d          m = dy -
-000115c0: 2064 7920 2f20 6e75 6d5f 706f 7274 730a   dy / num_ports.
-000115d0: 2020 2020 2020 2020 705f 6c69 7374 203d          p_list =
-000115e0: 206e 702e 6c69 6e73 7061 6365 282d 6d2c   np.linspace(-m,
-000115f0: 206d 2c20 6e75 6d5f 706f 7274 7329 0a20   m, num_ports). 
-00011600: 2020 2020 2020 205b 0a20 2020 2020 2020         [.       
-00011610: 2020 2020 2044 2e61 6464 5f70 6f72 7428       D.add_port(
-00011620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011630: 206e 616d 653d 2822 5725 7322 2025 2028   name=("W%s" % (
-00011640: 6e20 2b20 3129 292c 0a20 2020 2020 2020  n + 1)),.       
-00011650: 2020 2020 2020 2020 206d 6964 706f 696e           midpoin
-00011660: 743d 5b2d 6478 2c20 705d 2c0a 2020 2020  t=[-dx, p],.    
-00011670: 2020 2020 2020 2020 2020 2020 7769 6474              widt
-00011680: 683d 6479 202f 206e 756d 5f70 6f72 7473  h=dy / num_ports
-00011690: 202a 2032 2c0a 2020 2020 2020 2020 2020   * 2,.          
-000116a0: 2020 2020 2020 6f72 6965 6e74 6174 696f        orientatio
-000116b0: 6e3d 3138 302c 0a20 2020 2020 2020 2020  n=180,.         
-000116c0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-000116d0: 2066 6f72 206e 2c20 7020 696e 2065 6e75   for n, p in enu
-000116e0: 6d65 7261 7465 2870 5f6c 6973 7429 0a20  merate(p_list). 
-000116f0: 2020 2020 2020 205d 0a0a 2020 2020 7265         ]..    re
-00011700: 7475 726e 2044 0a0a 0a23 2054 4f44 4f3a  turn D...# TODO:
-00011710: 2046 6978 2074 6865 2066 696c 6c65 7420   Fix the fillet 
-00011720: 6865 7265 2c20 7269 6768 7420 6e6f 7720  here, right now 
-00011730: 6f6e 6c79 2067 6f65 7320 6861 6c66 7761  only goes halfwa
-00011740: 7920 646f 776e 0a64 6566 2066 6c61 6770  y down.def flagp
-00011750: 6f6c 6528 7369 7a65 3d28 342c 2032 292c  ole(size=(4, 2),
-00011760: 2073 7475 625f 7369 7a65 3d28 322c 2031   stub_size=(2, 1
-00011770: 292c 2073 6861 7065 3d22 7022 2c20 7461  ), shape="p", ta
-00011780: 7065 725f 7479 7065 3d22 7374 7261 6967  per_type="straig
-00011790: 6874 222c 206c 6179 6572 3d30 293a 0a20  ht", layer=0):. 
-000117a0: 2020 2022 2222 4372 6561 7465 7320 6120     """Creates a 
-000117b0: 666c 6167 706f 6c65 2067 656f 6d65 7472  flagpole geometr
-000117c0: 7920 6f66 206f 6e65 206f 6620 666f 7572  y of one of four
-000117d0: 2063 6f6e 6669 6775 7261 7469 6f6e 732c   configurations,
-000117e0: 2061 6c6c 0a20 2020 2069 6e76 6f6c 7669   all.    involvi
-000117f0: 6e67 2061 2076 6572 7469 6361 6c20 6365  ng a vertical ce
-00011800: 6e74 7261 6c20 636f 6c75 6d6e 2061 6e64  ntral column and
-00011810: 2061 206f 7574 7761 7264 2d70 6f69 6e74   a outward-point
-00011820: 696e 6720 666c 6167 2e0a 0a20 2020 2050  ing flag...    P
-00011830: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-00011840: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2073 697a  --------.    siz
-00011850: 6520 3a20 6172 7261 792d 6c69 6b65 0a20  e : array-like. 
-00011860: 2020 2020 2020 2028 7769 6474 682c 2068         (width, h
-00011870: 6569 6768 7429 206f 6620 7468 6520 666c  eight) of the fl
-00011880: 6167 2e0a 2020 2020 7374 7562 5f73 697a  ag..    stub_siz
-00011890: 6520 3a20 6172 7261 792d 6c69 6b65 0a20  e : array-like. 
-000118a0: 2020 2020 2020 2028 7769 6474 682c 2068         (width, h
-000118b0: 6569 6768 7429 206f 6620 7468 6520 706f  eight) of the po
-000118c0: 6c65 2073 7475 622e 0a20 2020 2073 6861  le stub..    sha
-000118d0: 7065 203a 207b 2770 272c 2027 7127 2c20  pe : {'p', 'q', 
-000118e0: 2762 272c 2027 6427 7d0a 2020 2020 2020  'b', 'd'}.      
-000118f0: 2020 436f 6e66 6967 7572 6174 696f 6e20    Configuration 
-00011900: 6f66 2074 6865 2066 6c61 6770 6f6c 652c  of the flagpole,
-00011910: 2077 6865 7265 2074 6865 2063 7572 7665   where the curve
-00011920: 6420 706f 7274 696f 6e20 6f66 2074 6865  d portion of the
-00011930: 0a20 2020 2020 2020 206c 6574 7465 7273  .        letters
-00011940: 2072 6570 7265 7365 6e74 7320 7468 6520   represents the 
-00011950: 666c 6167 2061 6e64 2074 6865 2073 7472  flag and the str
-00011960: 6169 6768 7420 706f 7274 696f 6e20 7468  aight portion th
-00011970: 6520 706f 6c65 2e0a 2020 2020 7461 7065  e pole..    tape
-00011980: 725f 7479 7065 203a 207b 2773 7472 6169  r_type : {'strai
-00011990: 6768 7427 2c20 2766 696c 6c65 7427 2c20  ght', 'fillet', 
-000119a0: 4e6f 6e65 7d0a 2020 2020 2020 2020 5479  None}.        Ty
-000119b0: 7065 206f 6620 7461 7065 7220 6265 7477  pe of taper betw
-000119c0: 6565 6e20 7468 6520 626f 7474 6f6d 2063  een the bottom c
-000119d0: 6f72 6e65 7220 6f66 2074 6865 2073 7475  orner of the stu
-000119e0: 6220 6f6e 2074 6865 2073 6964 6520 6f66  b on the side of
-000119f0: 0a20 2020 2020 2020 2074 6865 2066 6c61  .        the fla
-00011a00: 6720 616e 6420 7468 6520 636f 726e 6572  g and the corner
-00011a10: 206f 6620 7468 6520 666c 6167 2063 6c6f   of the flag clo
-00011a20: 7365 7374 2074 6f20 7468 6520 7374 7562  sest to the stub
-00011a30: 2e0a 2020 2020 6c61 7965 7220 3a20 696e  ..    layer : in
-00011a40: 742c 2061 7272 6179 2d6c 696b 655b 325d  t, array-like[2]
-00011a50: 2c20 6f72 2073 6574 0a20 2020 2020 2020  , or set.       
-00011a60: 2053 7065 6369 6669 6320 6c61 7965 7228   Specific layer(
-00011a70: 7329 2074 6f20 7075 7420 706f 6c79 676f  s) to put polygo
-00011a80: 6e20 6765 6f6d 6574 7279 206f 6e2e 0a0a  n geometry on...
-00011a90: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-00011aa0: 2d2d 2d2d 2d2d 2d0a 2020 2020 4420 3a20  -------.    D : 
-00011ab0: 4465 7669 6365 0a20 2020 2020 2020 2041  Device.        A
-00011ac0: 2044 6576 6963 6520 636f 6e74 6169 6e69   Device containi
-00011ad0: 6e67 2061 2066 6c61 6770 6f6c 6520 6765  ng a flagpole ge
-00011ae0: 6f6d 6574 7279 2e0a 2020 2020 2222 220a  ometry..    """.
-00011af0: 2020 2020 6620 3d20 6e70 2e61 7272 6179      f = np.array
-00011b00: 2873 697a 6529 0a20 2020 2070 203d 206e  (size).    p = n
-00011b10: 702e 6172 7261 7928 7374 7562 5f73 697a  p.array(stub_siz
-00011b20: 6529 0a20 2020 2073 6861 7065 203d 2073  e).    shape = s
-00011b30: 6861 7065 2e6c 6f77 6572 2829 0a0a 2020  hape.lower()..  
-00011b40: 2020 6173 7365 7274 2073 6861 7065 2069    assert shape i
-00011b50: 6e20 2270 7162 6422 2c20 225b 4445 5649  n "pqbd", "[DEVI
-00011b60: 4345 5d20 2066 6c61 6770 6f6c 6528 2920  CE]  flagpole() 
-00011b70: 7368 6170 6520 6d75 7374 2062 6520 702c  shape must be p,
-00011b80: 2071 2c20 622c 206f 7220 6422 0a20 2020   q, b, or d".   
-00011b90: 2061 7373 6572 7420 7461 7065 725f 7479   assert taper_ty
-00011ba0: 7065 2069 6e20 5b22 7374 7261 6967 6874  pe in ["straight
-00011bb0: 222c 2022 6669 6c6c 6574 222c 204e 6f6e  ", "fillet", Non
-00011bc0: 655d 2c20 280a 2020 2020 2020 2020 275b  e], (.        '[
-00011bd0: 4445 5649 4345 5d20 2066 6c61 6770 6f6c  DEVICE]  flagpol
-00011be0: 6528 2920 7461 7065 725f 7479 7065 206d  e() taper_type m
-00011bf0: 7573 7420 2273 7472 6169 6768 7422 2027  ust "straight" '
-00011c00: 2027 206f 7220 2266 696c 6c65 7422 206f   ' or "fillet" o
-00011c10: 7220 4e6f 6e65 270a 2020 2020 290a 0a20  r None'.    ).. 
-00011c20: 2020 2069 6620 7368 6170 6520 3d3d 2022     if shape == "
-00011c30: 7022 3a0a 2020 2020 2020 2020 6f72 6965  p":.        orie
-00011c40: 6e74 6174 696f 6e20 3d20 2d39 300a 2020  ntation = -90.  
-00011c50: 2020 656c 6966 2073 6861 7065 203d 3d20    elif shape == 
-00011c60: 2271 223a 0a20 2020 2020 2020 2066 5b30  "q":.        f[0
-00011c70: 5d2c 2070 5b30 5d20 3d20 2d73 697a 655b  ], p[0] = -size[
-00011c80: 305d 2c20 2d73 7475 625f 7369 7a65 5b30  0], -stub_size[0
-00011c90: 5d0a 2020 2020 2020 2020 6f72 6965 6e74  ].        orient
-00011ca0: 6174 696f 6e20 3d20 2d39 300a 2020 2020  ation = -90.    
-00011cb0: 656c 6966 2073 6861 7065 203d 3d20 2262  elif shape == "b
-00011cc0: 223a 0a20 2020 2020 2020 2066 5b31 5d2c  ":.        f[1],
-00011cd0: 2070 5b31 5d20 3d20 2d73 697a 655b 315d   p[1] = -size[1]
-00011ce0: 2c20 2d73 7475 625f 7369 7a65 5b31 5d0a  , -stub_size[1].
-00011cf0: 2020 2020 2020 2020 6f72 6965 6e74 6174          orientat
-00011d00: 696f 6e20 3d20 3930 0a20 2020 2065 6c69  ion = 90.    eli
-00011d10: 6620 7368 6170 6520 3d3d 2022 6422 3a0a  f shape == "d":.
-00011d20: 2020 2020 2020 2020 665b 315d 2c20 705b          f[1], p[
-00011d30: 315d 203d 202d 7369 7a65 5b31 5d2c 202d  1] = -size[1], -
-00011d40: 7374 7562 5f73 697a 655b 315d 0a20 2020  stub_size[1].   
-00011d50: 2020 2020 2066 5b30 5d2c 2070 5b30 5d20       f[0], p[0] 
-00011d60: 3d20 2d73 697a 655b 305d 2c20 2d73 7475  = -size[0], -stu
-00011d70: 625f 7369 7a65 5b30 5d0a 2020 2020 2020  b_size[0].      
-00011d80: 2020 6f72 6965 6e74 6174 696f 6e20 3d20    orientation = 
-00011d90: 3930 0a20 2020 2078 7074 7320 3d20 5b30  90.    xpts = [0
-00011da0: 2c20 302c 2066 5b30 5d2c 2066 5b30 5d2c  , 0, f[0], f[0],
-00011db0: 2070 5b30 5d2c 2070 5b30 5d2c 2030 5d0a   p[0], p[0], 0].
-00011dc0: 2020 2020 7970 7473 203d 205b 302c 2066      ypts = [0, f
-00011dd0: 5b31 5d2c 2066 5b31 5d2c 2030 2c20 302c  [1], f[1], 0, 0,
-00011de0: 202d 705b 315d 2c20 2d70 5b31 5d5d 0a0a   -p[1], -p[1]]..
-00011df0: 2020 2020 4420 3d20 4465 7669 6365 286e      D = Device(n
-00011e00: 616d 653d 2266 6c61 6770 6f6c 6522 290a  ame="flagpole").
-00011e10: 2020 2020 7061 645f 706f 6c79 203d 2044      pad_poly = D
-00011e20: 2e61 6464 5f70 6f6c 7967 6f6e 285b 7870  .add_polygon([xp
-00011e30: 7473 2c20 7970 7473 5d2c 206c 6179 6572  ts, ypts], layer
-00011e40: 3d6c 6179 6572 290a 2020 2020 6966 2074  =layer).    if t
-00011e50: 6170 6572 5f74 7970 6520 3d3d 2022 6669  aper_type == "fi
-00011e60: 6c6c 6574 223a 0a20 2020 2020 2020 2074  llet":.        t
-00011e70: 6170 6572 5f61 6d6f 756e 7420 3d20 6d69  aper_amount = mi
-00011e80: 6e28 5b61 6273 2866 5b30 5d20 2d20 705b  n([abs(f[0] - p[
-00011e90: 305d 292c 2061 6273 2870 5b31 5d29 5d29  0]), abs(p[1])])
-00011ea0: 0a20 2020 2020 2020 2070 6164 5f70 6f6c  .        pad_pol
-00011eb0: 792e 6669 6c6c 6574 285b 302c 2030 2c20  y.fillet([0, 0, 
-00011ec0: 302c 2030 2c20 7461 7065 725f 616d 6f75  0, 0, taper_amou
-00011ed0: 6e74 2c20 302c 2030 5d29 0a20 2020 2065  nt, 0, 0]).    e
-00011ee0: 6c69 6620 7461 7065 725f 7479 7065 203d  lif taper_type =
-00011ef0: 3d20 2273 7472 6169 6768 7422 3a0a 2020  = "straight":.  
-00011f00: 2020 2020 2020 442e 6164 645f 706f 6c79        D.add_poly
-00011f10: 676f 6e28 5b78 7074 735b 333a 365d 2c20  gon([xpts[3:6], 
-00011f20: 7970 7473 5b33 3a36 5d5d 2c20 6c61 7965  ypts[3:6]], laye
-00011f30: 723d 6c61 7965 7229 0a0a 2020 2020 442e  r=layer)..    D.
-00011f40: 6164 645f 706f 7274 280a 2020 2020 2020  add_port(.      
-00011f50: 2020 6e61 6d65 3d31 2c20 6d69 6470 6f69    name=1, midpoi
-00011f60: 6e74 3d5b 705b 305d 202f 2032 2c20 2d70  nt=[p[0] / 2, -p
-00011f70: 5b31 5d5d 2c20 7769 6474 683d 6162 7328  [1]], width=abs(
-00011f80: 705b 305d 292c 206f 7269 656e 7461 7469  p[0]), orientati
-00011f90: 6f6e 3d6f 7269 656e 7461 7469 6f6e 0a20  on=orientation. 
-00011fa0: 2020 2029 0a20 2020 2044 2e61 6464 5f70     ).    D.add_p
-00011fb0: 6f72 7428 0a20 2020 2020 2020 206e 616d  ort(.        nam
-00011fc0: 653d 322c 0a20 2020 2020 2020 206d 6964  e=2,.        mid
-00011fd0: 706f 696e 743d 5b66 5b30 5d20 2f20 322c  point=[f[0] / 2,
-00011fe0: 2066 5b31 5d5d 2c0a 2020 2020 2020 2020   f[1]],.        
-00011ff0: 7769 6474 683d 6162 7328 665b 305d 292c  width=abs(f[0]),
-00012000: 0a20 2020 2020 2020 206f 7269 656e 7461  .        orienta
-00012010: 7469 6f6e 3d6f 7269 656e 7461 7469 6f6e  tion=orientation
-00012020: 202d 2031 3830 2c0a 2020 2020 290a 2020   - 180,.    ).  
-00012030: 2020 7265 7475 726e 2044 0a0a 0a64 6566    return D...def
-00012040: 2074 6565 2873 697a 653d 2834 2c20 3229   tee(size=(4, 2)
-00012050: 2c20 7374 7562 5f73 697a 653d 2832 2c20  , stub_size=(2, 
-00012060: 3129 2c20 7461 7065 725f 7479 7065 3d4e  1), taper_type=N
-00012070: 6f6e 652c 206c 6179 6572 3d30 293a 0a20  one, layer=0):. 
-00012080: 2020 2022 2222 4372 6561 7465 7320 6120     """Creates a 
-00012090: 542d 7368 6170 6564 2067 656f 6d65 7472  T-shaped geometr
-000120a0: 792e 0a0a 2020 2020 5061 7261 6d65 7465  y...    Paramete
-000120b0: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-000120c0: 2d0a 2020 2020 7369 7a65 203a 2061 7272  -.    size : arr
-000120d0: 6179 2d6c 696b 650a 2020 2020 2020 2020  ay-like.        
-000120e0: 2877 6964 7468 2c20 6865 6967 6874 2920  (width, height) 
-000120f0: 6f66 2074 6865 2068 6f72 697a 6f6e 7461  of the horizonta
-00012100: 6c20 746f 7020 7061 7274 206f 6620 7468  l top part of th
-00012110: 6520 5420 7368 6170 652e 0a20 2020 2073  e T shape..    s
-00012120: 7475 625f 7369 7a65 203a 2061 7272 6179  tub_size : array
-00012130: 2d6c 696b 650a 2020 2020 2020 2020 2877  -like.        (w
-00012140: 6964 7468 2c20 6865 6967 6874 2920 6f66  idth, height) of
-00012150: 2074 6865 2076 6572 7469 6361 6c20 7374   the vertical st
-00012160: 7562 2070 6172 7420 6f66 2074 6865 2054  ub part of the T
-00012170: 2073 6861 7065 2e0a 2020 2020 7461 7065   shape..    tape
-00012180: 725f 7479 7065 203a 207b 2773 7472 6169  r_type : {'strai
-00012190: 6768 7427 2c20 2766 696c 6c65 7427 2c20  ght', 'fillet', 
-000121a0: 4e6f 6e65 7d0a 2020 2020 2020 2020 4966  None}.        If
-000121b0: 2073 7065 6369 6669 6564 2c20 7468 6520   specified, the 
-000121c0: 7479 7065 206f 6620 7461 7065 7220 6265  type of taper be
-000121d0: 7477 6565 6e20 7468 6520 626f 7474 6f6d  tween the bottom
-000121e0: 2063 6f72 6e65 7273 206f 6620 7468 6520   corners of the 
-000121f0: 7374 7562 0a20 2020 2020 2020 2061 6e64  stub.        and
-00012200: 2074 6865 2062 6f74 746f 6d20 636f 726e   the bottom corn
-00012210: 6572 7320 6f66 2074 6865 2054 2073 6861  ers of the T sha
-00012220: 7065 2e0a 2020 2020 6c61 7965 7220 3a20  pe..    layer : 
-00012230: 696e 742c 2061 7272 6179 2d6c 696b 655b  int, array-like[
-00012240: 325d 2c20 6f72 2073 6574 0a20 2020 2020  2], or set.     
-00012250: 2020 2053 7065 6369 6669 6320 6c61 7965     Specific laye
-00012260: 7228 7329 2074 6f20 7075 7420 706f 6c79  r(s) to put poly
-00012270: 676f 6e20 6765 6f6d 6574 7279 206f 6e2e  gon geometry on.
-00012280: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
-00012290: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 4420    -------.    D 
-000122a0: 3a20 4465 7669 6365 0a20 2020 2020 2020  : Device.       
-000122b0: 2041 2044 6576 6963 6520 636f 6e74 6169   A Device contai
-000122c0: 6e69 6e67 2061 2054 2d73 6861 7065 6420  ning a T-shaped 
-000122d0: 6765 6f6d 6574 7279 2e0a 2020 2020 2222  geometry..    ""
-000122e0: 220a 2020 2020 6620 3d20 6e70 2e61 7272  ".    f = np.arr
-000122f0: 6179 2873 697a 6529 0a20 2020 2070 203d  ay(size).    p =
-00012300: 206e 702e 6172 7261 7928 7374 7562 5f73   np.array(stub_s
-00012310: 697a 6529 0a0a 2020 2020 7870 7473 203d  ize)..    xpts =
-00012320: 206e 702e 6172 7261 7928 5b66 5b30 5d2c   np.array([f[0],
-00012330: 2066 5b30 5d2c 2070 5b30 5d2c 2070 5b30   f[0], p[0], p[0
-00012340: 5d2c 202d 705b 305d 2c20 2d70 5b30 5d2c  ], -p[0], -p[0],
-00012350: 202d 665b 305d 2c20 2d66 5b30 5d5d 2920   -f[0], -f[0]]) 
-00012360: 2f20 320a 2020 2020 7970 7473 203d 205b  / 2.    ypts = [
-00012370: 665b 315d 2c20 302c 2030 2c20 2d70 5b31  f[1], 0, 0, -p[1
-00012380: 5d2c 202d 705b 315d 2c20 302c 2030 2c20  ], -p[1], 0, 0, 
-00012390: 665b 315d 5d0a 0a20 2020 2044 203d 2044  f[1]]..    D = D
-000123a0: 6576 6963 6528 6e61 6d65 3d22 7465 6522  evice(name="tee"
-000123b0: 290a 2020 2020 7061 645f 706f 6c79 203d  ).    pad_poly =
-000123c0: 2044 2e61 6464 5f70 6f6c 7967 6f6e 285b   D.add_polygon([
-000123d0: 7870 7473 2c20 7970 7473 5d2c 206c 6179  xpts, ypts], lay
-000123e0: 6572 3d6c 6179 6572 290a 2020 2020 6966  er=layer).    if
-000123f0: 2074 6170 6572 5f74 7970 6520 3d3d 2022   taper_type == "
-00012400: 6669 6c6c 6574 223a 0a20 2020 2020 2020  fillet":.       
-00012410: 2074 6170 6572 5f61 6d6f 756e 7420 3d20   taper_amount = 
-00012420: 6d69 6e28 5b61 6273 2866 5b30 5d20 2d20  min([abs(f[0] - 
-00012430: 705b 305d 292c 2061 6273 2870 5b31 5d29  p[0]), abs(p[1])
-00012440: 5d29 0a20 2020 2020 2020 2070 6164 5f70  ]).        pad_p
-00012450: 6f6c 792e 6669 6c6c 6574 285b 302c 2030  oly.fillet([0, 0
-00012460: 2c20 7461 7065 725f 616d 6f75 6e74 2c20  , taper_amount, 
-00012470: 302c 2030 2c20 7461 7065 725f 616d 6f75  0, 0, taper_amou
-00012480: 6e74 2c20 302c 2030 5d29 0a20 2020 2065  nt, 0, 0]).    e
-00012490: 6c69 6620 7461 7065 725f 7479 7065 203d  lif taper_type =
-000124a0: 3d20 2273 7472 6169 6768 7422 3a0a 2020  = "straight":.  
-000124b0: 2020 2020 2020 442e 6164 645f 706f 6c79        D.add_poly
-000124c0: 676f 6e28 5b78 7074 735b 313a 345d 2c20  gon([xpts[1:4], 
-000124d0: 7970 7473 5b31 3a34 5d5d 2c20 6c61 7965  ypts[1:4]], laye
-000124e0: 723d 6c61 7965 7229 2020 2320 7461 7065  r=layer)  # tape
-000124f0: 725f 706f 6c79 310a 2020 2020 2020 2020  r_poly1.        
-00012500: 442e 6164 645f 706f 6c79 676f 6e28 5b78  D.add_polygon([x
-00012510: 7074 735b 343a 375d 2c20 7970 7473 5b34  pts[4:7], ypts[4
-00012520: 3a37 5d5d 2c20 6c61 7965 723d 6c61 7965  :7]], layer=laye
-00012530: 7229 2020 2320 7461 7065 725f 706f 6c79  r)  # taper_poly
-00012540: 320a 0a20 2020 2044 2e61 6464 5f70 6f72  2..    D.add_por
-00012550: 7428 6e61 6d65 3d31 2c20 6d69 6470 6f69  t(name=1, midpoi
-00012560: 6e74 3d5b 665b 305d 202f 2032 2c20 665b  nt=[f[0] / 2, f[
-00012570: 315d 202f 2032 5d2c 2077 6964 7468 3d66  1] / 2], width=f
-00012580: 5b31 5d2c 206f 7269 656e 7461 7469 6f6e  [1], orientation
-00012590: 3d30 290a 2020 2020 442e 6164 645f 706f  =0).    D.add_po
-000125a0: 7274 286e 616d 653d 322c 206d 6964 706f  rt(name=2, midpo
-000125b0: 696e 743d 5b2d 665b 305d 202f 2032 2c20  int=[-f[0] / 2, 
-000125c0: 665b 315d 202f 2032 5d2c 2077 6964 7468  f[1] / 2], width
-000125d0: 3d66 5b31 5d2c 206f 7269 656e 7461 7469  =f[1], orientati
-000125e0: 6f6e 3d31 3830 290a 2020 2020 442e 6164  on=180).    D.ad
-000125f0: 645f 706f 7274 286e 616d 653d 332c 206d  d_port(name=3, m
-00012600: 6964 706f 696e 743d 5b30 2c20 2d70 5b31  idpoint=[0, -p[1
-00012610: 5d5d 2c20 7769 6474 683d 705b 305d 2c20  ]], width=p[0], 
-00012620: 6f72 6965 6e74 6174 696f 6e3d 2d39 3029  orientation=-90)
-00012630: 0a20 2020 2072 6574 7572 6e20 440a 0a0a  .    return D...
-00012640: 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  # ==============
-00012650: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00012660: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00012670: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00012680: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00012690: 0a23 2045 7861 6d70 6c65 2063 6f64 650a  .# Example code.
-000126a0: 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  # ==============
-000126b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000126c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000126d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000126e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000126f0: 0a0a 2320 6370 203d 2063 6f6d 7061 7373  ..# cp = compass
-00012700: 2873 697a 6520 3d20 5b34 2c32 5d29 0a23  (size = [4,2]).#
-00012710: 2071 7569 636b 706c 6f74 2863 7029 0a0a   quickplot(cp)..
-00012720: 0a23 2063 706d 203d 2063 6f6d 7061 7373  .# cpm = compass
-00012730: 5f6d 756c 7469 2873 697a 6520 3d20 5b34  _multi(size = [4
-00012740: 302c 3230 5d2c 2070 6f72 7473 203d 207b  0,20], ports = {
-00012750: 274e 273a 332c 2753 273a 342c 2027 4527  'N':3,'S':4, 'E'
-00012760: 3a31 2c20 2757 273a 387d 2c20 6c61 7965  :1, 'W':8}, laye
-00012770: 7220 3d20 3029 0a23 2071 7569 636b 706c  r = 0).# quickpl
-00012780: 6f74 2863 706d 290a 0a0a 2320 6370 6d20  ot(cpm)...# cpm 
-00012790: 3d20 636f 6d70 6173 735f 6d75 6c74 6928  = compass_multi(
-000127a0: 7369 7a65 203d 205b 3430 2c32 305d 2c20  size = [40,20], 
-000127b0: 706f 7274 7320 3d20 7b27 4e27 3a33 2c27  ports = {'N':3,'
-000127c0: 5327 3a34 2c20 2745 273a 312c 2027 5727  S':4, 'E':1, 'W'
-000127d0: 3a38 7d2c 206c 6179 6572 203d 2030 290a  :8}, layer = 0).
-000127e0: 2320 696e 7365 745f 706f 6c79 676f 6e20  # inset_polygon 
-000127f0: 3d20 6f66 6673 6574 2863 706d 2c20 6469  = offset(cpm, di
-00012800: 7374 616e 6365 203d 202d 322c 206c 6179  stance = -2, lay
-00012810: 6572 203d 2031 290a 2320 6370 6d2e 6164  er = 1).# cpm.ad
-00012820: 645f 706f 6c79 676f 6e28 696e 7365 745f  d_polygon(inset_
-00012830: 706f 6c79 676f 6e29 0a23 2071 7569 636b  polygon).# quick
-00012840: 706c 6f74 2863 706d 290a 0a23 2066 7020  plot(cpm)..# fp 
-00012850: 3d20 666c 6167 706f 6c65 2873 697a 6520  = flagpole(size 
-00012860: 3d20 5b34 2c32 5d2c 2073 7475 625f 7369  = [4,2], stub_si
-00012870: 7a65 203d 205b 322c 315d 2c20 7368 6170  ze = [2,1], shap
-00012880: 6520 3d20 2770 272c 2074 6170 6572 5f74  e = 'p', taper_t
-00012890: 7970 6520 3d20 2773 7472 6169 6768 7427  ype = 'straight'
-000128a0: 2c20 6c61 7965 7220 3d20 3029 0a23 2071  , layer = 0).# q
-000128b0: 7569 636b 706c 6f74 2866 7029 0a0a 0a23  uickplot(fp)...#
-000128c0: 2074 7020 3d20 7465 6528 7369 7a65 203d   tp = tee(size =
-000128d0: 205b 342c 325d 2c20 7374 7562 5f73 697a   [4,2], stub_siz
-000128e0: 6520 3d20 5b32 2c31 5d2c 2074 6170 6572  e = [2,1], taper
-000128f0: 5f74 7970 6520 3d20 2766 696c 6c65 7427  _type = 'fillet'
-00012900: 2c20 6c61 7965 7220 3d20 3029 0a23 2071  , layer = 0).# q
-00012910: 7569 636b 706c 6f74 2874 7029 0a0a 0a23  uickplot(tp)...#
-00012920: 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d   ===============
-00012930: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00012940: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00012950: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00012960: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a  ===============.
-00012970: 230a 2320 5461 7065 7273 0a23 0a23 203d  #.# Tapers.#.# =
-00012980: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00012990: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000129a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000129b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000129c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 0a0a  =============...
-000129d0: 6465 6620 7461 7065 7228 6c65 6e67 7468  def taper(length
-000129e0: 3d31 302c 2077 6964 7468 313d 352c 2077  =10, width1=5, w
-000129f0: 6964 7468 323d 4e6f 6e65 2c20 706f 7274  idth2=None, port
-00012a00: 3d4e 6f6e 652c 206c 6179 6572 3d30 293a  =None, layer=0):
-00012a10: 0a20 2020 2022 2222 4372 6561 7465 7320  .    """Creates 
-00012a20: 6120 7461 7065 7265 6420 7472 6170 657a  a tapered trapez
-00012a30: 6f69 642f 7265 6374 616e 676c 6520 6765  oid/rectangle ge
-00012a40: 6f6d 6574 7279 2e0a 0a20 2020 2050 6172  ometry...    Par
-00012a50: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
-00012a60: 2d2d 2d2d 2d2d 0a20 2020 206c 656e 6774  ------.    lengt
-00012a70: 6820 3a20 696e 7420 6f72 2066 6c6f 6174  h : int or float
-00012a80: 0a20 2020 2020 2020 204c 656e 6774 6820  .        Length 
-00012a90: 6f66 2074 6865 2073 6861 7065 2e0a 2020  of the shape..  
-00012aa0: 2020 7769 6474 6831 203a 2069 6e74 2c20    width1 : int, 
-00012ab0: 666c 6f61 742c 206f 7220 4e6f 6e65 0a20  float, or None. 
-00012ac0: 2020 2020 2020 2057 6964 7468 206f 6620         Width of 
-00012ad0: 656e 6420 3120 6f66 2074 6865 2074 6170  end 1 of the tap
-00012ae0: 6572 2073 6563 7469 6f6e 2028 7769 6474  er section (widt
-00012af0: 6820 6973 2065 7175 616c 2074 6f20 7468  h is equal to th
-00012b00: 6520 706f 7274 2077 6964 7468 0a20 2020  e port width.   
-00012b10: 2020 2020 2069 6620 506f 7274 2069 7320       if Port is 
-00012b20: 6e6f 7420 4e6f 6e65 2061 6e64 2077 6964  not None and wid
-00012b30: 7468 3120 6973 204e 6f6e 6529 2e0a 2020  th1 is None)..  
-00012b40: 2020 7769 6474 6832 203a 2069 6e74 2c20    width2 : int, 
-00012b50: 666c 6f61 742c 206f 7220 4e6f 6e65 0a20  float, or None. 
-00012b60: 2020 2020 2020 2057 6964 7468 206f 6620         Width of 
-00012b70: 656e 6420 3220 6f66 2074 6865 2074 6170  end 2 of the tap
-00012b80: 6572 2073 6563 7469 6f6e 2028 7769 6474  er section (widt
-00012b90: 6820 6973 2065 7175 616c 2074 6f20 7468  h is equal to th
-00012ba0: 6520 706f 7274 2077 6964 7468 0a20 2020  e port width.   
-00012bb0: 2020 2020 2069 6620 506f 7274 2069 7320       if Port is 
-00012bc0: 6e6f 7420 4e6f 6e65 2061 6e64 2077 6964  not None and wid
-00012bd0: 7468 3220 6973 204e 6f6e 6529 2e0a 2020  th2 is None)..  
-00012be0: 2020 706f 7274 203a 2050 6f72 7420 6f72    port : Port or
-00012bf0: 204e 6f6e 650a 2020 2020 2020 2020 506f   None.        Po
-00012c00: 7274 2077 6974 6820 7768 6963 6820 746f  rt with which to
-00012c10: 206d 6174 6368 2074 6865 2077 6964 7468   match the width
-00012c20: 206f 6620 7468 6520 7461 7065 7220 656e   of the taper en
-00012c30: 6473 2e0a 2020 2020 6c61 7965 7220 3a20  ds..    layer : 
-00012c40: 696e 742c 2061 7272 6179 2d6c 696b 655b  int, array-like[
-00012c50: 325d 2c20 6f72 2073 6574 0a20 2020 2020  2], or set.     
-00012c60: 2020 2053 7065 6369 6669 6320 6c61 7965     Specific laye
-00012c70: 7228 7329 2074 6f20 7075 7420 706f 6c79  r(s) to put poly
-00012c80: 676f 6e20 6765 6f6d 6574 7279 206f 6e2e  gon geometry on.
-00012c90: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
-00012ca0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 443a    -------.    D:
-00012cb0: 2044 6576 6963 650a 2020 2020 2020 2020   Device.        
-00012cc0: 4120 4465 7669 6365 2063 6f6e 7461 696e  A Device contain
-00012cd0: 696e 6720 6120 7461 7065 7220 6765 6f6d  ing a taper geom
-00012ce0: 6574 7279 2e0a 2020 2020 2222 220a 2020  etry..    """.  
-00012cf0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00012d00: 706f 7274 2c20 506f 7274 2920 616e 6420  port, Port) and 
-00012d10: 7769 6474 6831 2069 7320 4e6f 6e65 3a0a  width1 is None:.
-00012d20: 2020 2020 2020 2020 7769 6474 6831 203d          width1 =
-00012d30: 2070 6f72 742e 7769 6474 680a 2020 2020   port.width.    
-00012d40: 6966 2077 6964 7468 3220 6973 204e 6f6e  if width2 is Non
-00012d50: 653a 0a20 2020 2020 2020 2077 6964 7468  e:.        width
-00012d60: 3220 3d20 7769 6474 6831 0a20 2020 2078  2 = width1.    x
-00012d70: 7074 7320 3d20 5b30 2c20 6c65 6e67 7468  pts = [0, length
-00012d80: 2c20 6c65 6e67 7468 2c20 305d 0a20 2020  , length, 0].   
-00012d90: 2079 7074 7320 3d20 5b77 6964 7468 3120   ypts = [width1 
-00012da0: 2f20 322c 2077 6964 7468 3220 2f20 322c  / 2, width2 / 2,
-00012db0: 202d 7769 6474 6832 202f 2032 2c20 2d77   -width2 / 2, -w
-00012dc0: 6964 7468 3120 2f20 325d 0a0a 2020 2020  idth1 / 2]..    
-00012dd0: 4420 3d20 4465 7669 6365 2822 7461 7065  D = Device("tape
-00012de0: 7222 290a 2020 2020 442e 6164 645f 706f  r").    D.add_po
-00012df0: 6c79 676f 6e28 5b78 7074 732c 2079 7074  lygon([xpts, ypt
-00012e00: 735d 2c20 6c61 7965 723d 6c61 7965 7229  s], layer=layer)
-00012e10: 0a20 2020 2044 2e61 6464 5f70 6f72 7428  .    D.add_port(
-00012e20: 6e61 6d65 3d31 2c20 6d69 6470 6f69 6e74  name=1, midpoint
-00012e30: 3d5b 302c 2030 5d2c 2077 6964 7468 3d77  =[0, 0], width=w
-00012e40: 6964 7468 312c 206f 7269 656e 7461 7469  idth1, orientati
-00012e50: 6f6e 3d31 3830 290a 2020 2020 442e 6164  on=180).    D.ad
-00012e60: 645f 706f 7274 286e 616d 653d 322c 206d  d_port(name=2, m
-00012e70: 6964 706f 696e 743d 5b6c 656e 6774 682c  idpoint=[length,
-00012e80: 2030 5d2c 2077 6964 7468 3d77 6964 7468   0], width=width
-00012e90: 322c 206f 7269 656e 7461 7469 6f6e 3d30  2, orientation=0
-00012ea0: 290a 2020 2020 6966 2069 7369 6e73 7461  ).    if isinsta
-00012eb0: 6e63 6528 706f 7274 2c20 506f 7274 293a  nce(port, Port):
-00012ec0: 0a20 2020 2020 2020 2044 2e72 6f74 6174  .        D.rotat
-00012ed0: 6528 616e 676c 653d 706f 7274 2e6f 7269  e(angle=port.ori
-00012ee0: 656e 7461 7469 6f6e 2c20 6365 6e74 6572  entation, center
-00012ef0: 3d5b 302c 2030 5d29 0a20 2020 2020 2020  =[0, 0]).       
-00012f00: 2044 2e6d 6f76 6528 6f72 6967 696e 3d5b   D.move(origin=[
-00012f10: 302c 2030 5d2c 2064 6573 7469 6e61 7469  0, 0], destinati
-00012f20: 6f6e 3d70 6f72 742e 6d69 6470 6f69 6e74  on=port.midpoint
-00012f30: 290a 2020 2020 7265 7475 726e 2044 0a0a  ).    return D..
-00012f40: 0a64 6566 2072 616d 7028 6c65 6e67 7468  .def ramp(length
-00012f50: 3d31 302c 2077 6964 7468 313d 352c 2077  =10, width1=5, w
-00012f60: 6964 7468 323d 382c 206c 6179 6572 3d30  idth2=8, layer=0
-00012f70: 293a 0a20 2020 2022 2222 4372 6561 7465  ):.    """Create
-00012f80: 7320 6120 7261 6d70 2067 656f 6d65 7472  s a ramp geometr
-00012f90: 792e 0a0a 2020 2020 5061 7261 6d65 7465  y...    Paramete
-00012fa0: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-00012fb0: 2d0a 2020 2020 6c65 6e67 7468 203a 2069  -.    length : i
-00012fc0: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
-00012fd0: 2020 2020 4c65 6e67 7468 206f 6620 7468      Length of th
-00012fe0: 6520 7261 6d70 2073 6563 7469 6f6e 2e0a  e ramp section..
-00012ff0: 2020 2020 7769 6474 6831 203a 2069 6e74      width1 : int
-00013000: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
-00013010: 2020 5769 6474 6820 6f66 2074 6865 2073    Width of the s
-00013020: 7461 7274 206f 6620 7468 6520 7261 6d70  tart of the ramp
-00013030: 2073 6563 7469 6f6e 2e0a 2020 2020 7769   section..    wi
-00013040: 6474 6832 203a 2069 6e74 2c20 666c 6f61  dth2 : int, floa
-00013050: 742c 206f 7220 4e6f 6e65 0a20 2020 2020  t, or None.     
-00013060: 2020 2057 6964 7468 206f 6620 7468 6520     Width of the 
-00013070: 656e 6420 6f66 2074 6865 2072 616d 7020  end of the ramp 
-00013080: 7365 6374 696f 6e20 2869 6620 7769 6474  section (if widt
-00013090: 6832 2069 7320 4e6f 6e65 2c20 7769 6474  h2 is None, widt
-000130a0: 6832 0a20 2020 2020 2020 2062 6563 6f6d  h2.        becom
-000130b0: 6573 2074 6865 2073 616d 6520 6173 2077  es the same as w
-000130c0: 6964 7468 3129 2e0a 2020 2020 6c61 7965  idth1)..    laye
-000130d0: 7220 3a20 696e 742c 2061 7272 6179 2d6c  r : int, array-l
-000130e0: 696b 655b 325d 2c20 6f72 2073 6574 0a20  ike[2], or set. 
-000130f0: 2020 2020 2020 2053 7065 6369 6669 6320         Specific 
-00013100: 6c61 7965 7228 7329 2074 6f20 7075 7420  layer(s) to put 
-00013110: 706f 6c79 676f 6e20 6765 6f6d 6574 7279  polygon geometry
-00013120: 206f 6e2e 0a0a 2020 2020 5265 7475 726e   on...    Return
-00013130: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-00013140: 2020 4420 3a20 4465 7669 6365 0a20 2020    D : Device.   
-00013150: 2020 2020 2041 2044 6576 6963 6520 636f       A Device co
-00013160: 6e74 6169 6e69 6e67 2061 2072 616d 7020  ntaining a ramp 
-00013170: 6765 6f6d 6574 7279 2e0a 2020 2020 2222  geometry..    ""
-00013180: 220a 2020 2020 6966 2077 6964 7468 3220  ".    if width2 
-00013190: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000131a0: 2077 6964 7468 3220 3d20 7769 6474 6831   width2 = width1
-000131b0: 0a20 2020 2078 7074 7320 3d20 5b30 2c20  .    xpts = [0, 
-000131c0: 6c65 6e67 7468 2c20 6c65 6e67 7468 2c20  length, length, 
-000131d0: 305d 0a20 2020 2079 7074 7320 3d20 5b77  0].    ypts = [w
-000131e0: 6964 7468 312c 2077 6964 7468 322c 2030  idth1, width2, 0
-000131f0: 2c20 305d 0a20 2020 2044 203d 2044 6576  , 0].    D = Dev
-00013200: 6963 6528 2272 616d 7022 290a 2020 2020  ice("ramp").    
-00013210: 442e 6164 645f 706f 6c79 676f 6e28 5b78  D.add_polygon([x
-00013220: 7074 732c 2079 7074 735d 2c20 6c61 7965  pts, ypts], laye
-00013230: 723d 6c61 7965 7229 0a20 2020 2044 2e61  r=layer).    D.a
-00013240: 6464 5f70 6f72 7428 6e61 6d65 3d31 2c20  dd_port(name=1, 
-00013250: 6d69 6470 6f69 6e74 3d5b 302c 2077 6964  midpoint=[0, wid
-00013260: 7468 3120 2f20 325d 2c20 7769 6474 683d  th1 / 2], width=
-00013270: 7769 6474 6831 2c20 6f72 6965 6e74 6174  width1, orientat
-00013280: 696f 6e3d 3138 3029 0a20 2020 2044 2e61  ion=180).    D.a
-00013290: 6464 5f70 6f72 7428 6e61 6d65 3d32 2c20  dd_port(name=2, 
-000132a0: 6d69 6470 6f69 6e74 3d5b 6c65 6e67 7468  midpoint=[length
-000132b0: 2c20 7769 6474 6832 202f 2032 5d2c 2077  , width2 / 2], w
-000132c0: 6964 7468 3d77 6964 7468 322c 206f 7269  idth=width2, ori
-000132d0: 656e 7461 7469 6f6e 3d30 290a 2020 2020  entation=0).    
-000132e0: 7265 7475 726e 2044 0a0a 0a64 6566 205f  return D...def _
-000132f0: 6d69 6372 6f73 7472 6970 5f5a 2877 6972  microstrip_Z(wir
-00013300: 655f 7769 6474 682c 2064 6965 6c65 6374  e_width, dielect
-00013310: 7269 635f 7468 6963 6b6e 6573 732c 2065  ric_thickness, e
-00013320: 7073 5f72 293a 0a20 2020 2022 2222 4361  ps_r):.    """Ca
-00013330: 6c63 756c 6174 6573 2074 6865 2069 6d70  lculates the imp
-00013340: 6564 616e 6365 206f 6620 6120 6d69 6372  edance of a micr
-00013350: 6f73 7472 6970 2067 6976 656e 2074 6865  ostrip given the
-00013360: 2077 6972 6520 7769 6474 6820 616e 640a   wire width and.
-00013370: 2020 2020 6469 656c 6563 7472 6963 2074      dielectric t
-00013380: 6869 636b 6e65 7373 2061 6e64 2063 6f6e  hickness and con
-00013390: 7374 616e 742e 0a0a 2020 2020 5061 7261  stant...    Para
-000133a0: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
-000133b0: 2d2d 2d2d 2d0a 2020 2020 7769 7265 5f77  -----.    wire_w
-000133c0: 6964 7468 203a 2069 6e74 206f 7220 666c  idth : int or fl
-000133d0: 6f61 740a 2020 2020 2020 2020 5769 6474  oat.        Widt
-000133e0: 6820 6f66 2074 6865 2063 6f6e 6475 6374  h of the conduct
-000133f0: 696e 6720 7374 7269 702e 0a20 2020 2064  ing strip..    d
-00013400: 6965 6c65 6374 7269 635f 7468 6963 6b6e  ielectric_thickn
-00013410: 6573 7320 3a20 696e 7420 6f72 2066 6c6f  ess : int or flo
-00013420: 6174 0a20 2020 2020 2020 2054 6869 636b  at.        Thick
-00013430: 6e65 7373 206f 6620 7468 6520 7375 6273  ness of the subs
-00013440: 7472 6174 652e 0a20 2020 2065 7073 5f72  trate..    eps_r
-00013450: 203a 2069 6e74 206f 7220 666c 6f61 740a   : int or float.
-00013460: 2020 2020 2020 2020 4469 656c 6563 7472          Dielectr
-00013470: 6963 2063 6f6e 7374 616e 7420 6f66 2074  ic constant of t
-00013480: 6865 2073 7562 7374 7261 7465 2e0a 0a20  he substrate... 
-00013490: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
-000134a0: 2d2d 2d2d 2d2d 0a20 2020 205a 203a 2066  ------.    Z : f
-000134b0: 6c6f 6174 0a20 2020 2020 2020 2049 6d70  loat.        Imp
-000134c0: 6564 616e 6365 206f 6620 7468 6520 6d69  edance of the mi
-000134d0: 6372 6f73 7472 6970 2e0a 2020 2020 6570  crostrip..    ep
-000134e0: 735f 6566 6620 3a20 666c 6f61 740a 2020  s_eff : float.  
-000134f0: 2020 2020 2020 4566 6665 6374 6976 6520        Effective 
-00013500: 6469 656c 6563 7472 6963 2063 6f6e 7374  dielectric const
-00013510: 616e 7420 6f66 2074 6865 206d 6963 726f  ant of the micro
-00013520: 7374 7269 702e 0a0a 2020 2020 4e6f 7465  strip...    Note
-00013530: 730a 2020 2020 2d2d 2d2d 2d0a 2020 2020  s.    -----.    
-00013540: 4571 7561 7469 6f6e 7320 7461 6b65 6e20  Equations taken 
-00013550: 6672 6f6d 205b 315d 5f2e 0a0a 2020 2020  from [1]_...    
-00013560: 5468 6573 6520 6571 7561 7469 6f6e 7320  These equations 
-00013570: 6361 6e20 6265 2066 7572 7468 6572 2063  can be further c
-00013580: 6f72 7265 6374 6564 2066 6f72 2074 6869  orrected for thi
-00013590: 636b 2066 696c 6d73 2028 4861 6d6d 6572  ck films (Hammer
-000135a0: 7374 6164 2045 7173 2e0a 2020 2020 362d  stad Eqs..    6-
-000135b0: 3929 2061 6e64 2061 6c73 6f20 666f 7220  9) and also for 
-000135c0: 6672 6571 7565 6e63 7920 7369 6e63 6520  frequency since 
-000135d0: 6d69 6372 6f73 7472 6970 7320 6172 6520  microstrips are 
-000135e0: 6469 7370 6572 7369 7665 2028 4861 6d6d  dispersive (Hamm
-000135f0: 6572 7374 6164 0a20 2020 2045 7173 2e20  erstad.    Eqs. 
-00013600: 3130 2d31 3229 0a0a 2020 2020 5265 6665  10-12)..    Refe
-00013610: 7265 6e63 6573 0a20 2020 202d 2d2d 2d2d  rences.    -----
-00013620: 2d2d 2d2d 2d0a 2020 2020 2e2e 205b 315d  -----.    .. [1]
-00013630: 2048 616d 6d65 7273 7461 642c 2045 2e2c   Hammerstad, E.,
-00013640: 2026 204a 656e 7365 6e2c 204f 2e20 2831   & Jensen, O. (1
-00013650: 3938 3029 2e20 4163 6375 7261 7465 204d  980). Accurate M
-00013660: 6f64 656c 7320 666f 7220 4d69 6372 6f73  odels for Micros
-00013670: 7472 6970 0a20 2020 2020 2020 436f 6d70  trip.       Comp
-00013680: 7574 6572 2d41 6964 6564 2044 6573 6967  uter-Aided Desig
-00013690: 6e2e 2020 6874 7470 3a2f 2f64 6f69 2e6f  n.  http://doi.o
-000136a0: 7267 2f31 302e 3131 3039 2f4d 5753 594d  rg/10.1109/MWSYM
-000136b0: 2e31 3938 302e 3131 3234 3330 330a 2020  .1980.1124303.  
-000136c0: 2020 2222 220a 2020 2020 7520 3d20 7769    """.    u = wi
-000136d0: 7265 5f77 6964 7468 202f 2064 6965 6c65  re_width / diele
-000136e0: 6374 7269 635f 7468 6963 6b6e 6573 730a  ctric_thickness.
-000136f0: 2020 2020 6574 6120 3d20 3337 362e 3733      eta = 376.73
-00013700: 2020 2320 5661 6375 756d 2069 6d70 6564    # Vacuum imped
-00013710: 616e 6365 0a0a 2020 2020 6120 3d20 280a  ance..    a = (.
-00013720: 2020 2020 2020 2020 310a 2020 2020 2020          1.      
-00013730: 2020 2b20 6c6f 6728 2875 2a2a 3420 2b20    + log((u**4 + 
-00013740: 2875 202f 2035 3229 202a 2a20 3229 202f  (u / 52) ** 2) /
-00013750: 2028 752a 2a34 202b 2030 2e34 3332 2929   (u**4 + 0.432))
-00013760: 202f 2034 390a 2020 2020 2020 2020 2b20   / 49.        + 
-00013770: 6c6f 6728 3120 2b20 2875 202f 2031 382e  log(1 + (u / 18.
-00013780: 3129 202a 2a20 3329 202f 2031 382e 370a  1) ** 3) / 18.7.
-00013790: 2020 2020 290a 2020 2020 6220 3d20 302e      ).    b = 0.
-000137a0: 3536 3420 2a20 2828 6570 735f 7220 2d20  564 * ((eps_r - 
-000137b0: 302e 3929 202f 2028 6570 735f 7220 2b20  0.9) / (eps_r + 
-000137c0: 3329 2920 2a2a 2030 2e30 3533 0a20 2020  3)) ** 0.053.   
-000137d0: 2046 203d 2036 202b 2028 3220 2a20 7069   F = 6 + (2 * pi
-000137e0: 202d 2036 2920 2a20 6578 7028 2d28 2833   - 6) * exp(-((3
-000137f0: 302e 3636 3620 2f20 7529 202a 2a20 302e  0.666 / u) ** 0.
-00013800: 3735 3238 2929 0a20 2020 2065 7073 5f65  7528)).    eps_e
-00013810: 6666 203d 2030 2e35 202a 2028 6570 735f  ff = 0.5 * (eps_
-00013820: 7220 2b20 3129 202b 2030 2e35 202a 2028  r + 1) + 0.5 * (
-00013830: 6570 735f 7220 2d20 3129 202a 2028 3120  eps_r - 1) * (1 
-00013840: 2b20 3130 202f 2075 2920 2a2a 2028 2d61  + 10 / u) ** (-a
-00013850: 202a 2062 290a 2020 2020 5a20 3d20 6574   * b).    Z = et
-00013860: 6120 2f20 2832 202a 2070 6929 202a 206c  a / (2 * pi) * l
-00013870: 6f67 2846 202f 2075 202b 2073 7172 7428  og(F / u + sqrt(
-00013880: 3120 2b20 2832 202f 2075 2920 2a2a 2032  1 + (2 / u) ** 2
-00013890: 2929 202f 2073 7172 7428 6570 735f 6566  )) / sqrt(eps_ef
-000138a0: 6629 0a20 2020 2072 6574 7572 6e20 5a2c  f).    return Z,
-000138b0: 2065 7073 5f65 6666 0a0a 0a64 6566 205f   eps_eff...def _
-000138c0: 6d69 6372 6f73 7472 6970 5f4c 435f 7065  microstrip_LC_pe
-000138d0: 725f 6d65 7465 7228 7769 7265 5f77 6964  r_meter(wire_wid
-000138e0: 7468 2c20 6469 656c 6563 7472 6963 5f74  th, dielectric_t
-000138f0: 6869 636b 6e65 7373 2c20 6570 735f 7229  hickness, eps_r)
-00013900: 3a0a 2020 2020 2222 2243 616c 6375 6c61  :.    """Calcula
-00013910: 7465 7320 7468 6520 696e 6475 6374 616e  tes the inductan
-00013920: 6365 2061 6e64 2063 6170 6163 6974 616e  ce and capacitan
-00013930: 6365 2070 6572 206d 6574 6572 206f 6620  ce per meter of 
-00013940: 6120 6d69 6372 6f73 7472 6970 0a20 2020  a microstrip.   
-00013950: 2067 6976 656e 2077 6972 6520 7769 6474   given wire widt
-00013960: 6820 616e 6420 6469 656c 6563 7472 6963  h and dielectric
-00013970: 2074 6869 636b 6e65 7373 2061 6e64 2063   thickness and c
-00013980: 6f6e 7374 616e 742e 0a0a 2020 2020 5061  onstant...    Pa
-00013990: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
-000139a0: 2d2d 2d2d 2d2d 2d0a 2020 2020 7769 7265  -------.    wire
-000139b0: 5f77 6964 7468 203a 2069 6e74 206f 7220  _width : int or 
-000139c0: 666c 6f61 740a 2020 2020 2020 2020 5769  float.        Wi
-000139d0: 6474 6820 6f66 2074 6865 2063 6f6e 6475  dth of the condu
-000139e0: 6374 696e 6720 7374 7269 702e 0a20 2020  cting strip..   
-000139f0: 2064 6965 6c65 6374 7269 635f 7468 6963   dielectric_thic
-00013a00: 6b6e 6573 7320 3a20 696e 7420 6f72 2066  kness : int or f
-00013a10: 6c6f 6174 0a20 2020 2020 2020 2054 6869  loat.        Thi
-00013a20: 636b 6e65 7373 206f 6620 7468 6520 7375  ckness of the su
-00013a30: 6273 7472 6174 652e 0a20 2020 2065 7073  bstrate..    eps
-00013a40: 5f72 203a 2069 6e74 206f 7220 666c 6f61  _r : int or floa
-00013a50: 740a 2020 2020 2020 2020 4469 656c 6563  t.        Dielec
-00013a60: 7472 6963 2063 6f6e 7374 616e 7420 6f66  tric constant of
-00013a70: 2074 6865 2073 7562 7374 7261 7465 2e0a   the substrate..
-00013a80: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
-00013a90: 202d 2d2d 2d2d 2d2d 0a20 2020 204c 5f6d   -------.    L_m
-00013aa0: 203a 2066 6c6f 6174 0a20 2020 2020 2020   : float.       
-00013ab0: 2049 6e64 7563 7461 6e63 6520 7065 7220   Inductance per 
-00013ac0: 6d65 7465 7220 6f66 2074 6865 206d 6963  meter of the mic
-00013ad0: 726f 7374 7269 702e 0a20 2020 2043 5f6d  rostrip..    C_m
-00013ae0: 203a 2066 6c6f 6174 0a20 2020 2020 2020   : float.       
-00013af0: 2043 6170 6163 6974 616e 6365 2070 6572   Capacitance per
-00013b00: 206d 6574 6572 206f 6620 7468 6520 6d69   meter of the mi
-00013b10: 6372 6f73 7472 6970 2e0a 0a20 2020 204e  crostrip...    N
-00013b20: 6f74 6573 0a20 2020 202d 2d2d 2d2d 0a20  otes.    -----. 
-00013b30: 2020 2045 7175 6174 696f 6e73 2074 616b     Equations tak
-00013b40: 656e 2066 726f 6d3a 0a20 2020 2020 2020  en from:.       
-00013b50: 2048 616d 6d65 7273 7461 642c 2045 2e2c   Hammerstad, E.,
-00013b60: 2026 204a 656e 7365 6e2c 204f 2e20 2831   & Jensen, O. (1
-00013b70: 3938 3029 2e20 4163 6375 7261 7465 204d  980). Accurate M
-00013b80: 6f64 656c 7320 666f 7220 4d69 6372 6f73  odels for Micros
-00013b90: 7472 6970 0a20 2020 2020 2020 2043 6f6d  trip.        Com
-00013ba0: 7075 7465 722d 4169 6465 6420 4465 7369  puter-Aided Desi
-00013bb0: 676e 2e20 2068 7474 703a 2f2f 646f 692e  gn.  http://doi.
-00013bc0: 6f72 672f 3130 2e31 3130 392f 4d57 5359  org/10.1109/MWSY
-00013bd0: 4d2e 3139 3830 2e31 3132 3433 3033 0a0a  M.1980.1124303..
-00013be0: 2020 2020 5468 6573 6520 6571 7561 7469      These equati
-00013bf0: 6f6e 7320 6361 6e20 6265 2066 7572 7468  ons can be furth
-00013c00: 6572 2063 6f72 7265 6374 6564 2066 6f72  er corrected for
-00013c10: 2074 6869 636b 2066 696c 6d73 2028 4861   thick films (Ha
-00013c20: 6d6d 6572 7374 6164 2045 7173 0a20 2020  mmerstad Eqs.   
-00013c30: 2036 2d39 2920 616e 6420 616c 736f 2066   6-9) and also f
-00013c40: 6f72 2066 7265 7175 656e 6379 2073 696e  or frequency sin
-00013c50: 6365 206d 6963 726f 7374 7269 7073 2061  ce microstrips a
-00013c60: 7265 2064 6973 7065 7273 6976 6520 2848  re dispersive (H
-00013c70: 616d 6d65 7273 7461 640a 2020 2020 4571  ammerstad.    Eq
-00013c80: 7320 3130 2d31 3229 0a20 2020 2022 2222  s 10-12).    """
-00013c90: 0a20 2020 2023 2055 7365 2074 6865 2066  .    # Use the f
-00013ca0: 6163 7420 7468 6174 2076 203d 2031 2f73  act that v = 1/s
-00013cb0: 7172 7428 4c5f 6d2a 435f 6d29 203d 2031  qrt(L_m*C_m) = 1
-00013cc0: 2f73 7172 7428 6570 732a 6d75 2920 616e  /sqrt(eps*mu) an
-00013cd0: 640a 2020 2020 2320 5a20 3d20 7371 7274  d.    # Z = sqrt
-00013ce0: 284c 5f6d 2f43 5f6d 2920 2020 5b57 6865  (L_m/C_m)   [Whe
-00013cf0: 7265 204c 5f6d 2069 7320 696e 6475 6374  re L_m is induct
-00013d00: 616e 6365 2070 6572 206d 6574 6572 5d0a  ance per meter].
-00013d10: 2020 2020 5a2c 2065 7073 5f65 6666 203d      Z, eps_eff =
-00013d20: 205f 6d69 6372 6f73 7472 6970 5f5a 2877   _microstrip_Z(w
-00013d30: 6972 655f 7769 6474 682c 2064 6965 6c65  ire_width, diele
-00013d40: 6374 7269 635f 7468 6963 6b6e 6573 732c  ctric_thickness,
-00013d50: 2065 7073 5f72 290a 2020 2020 6570 7330   eps_r).    eps0
-00013d60: 203d 2038 2e38 3534 652d 3132 0a20 2020   = 8.854e-12.   
-00013d70: 206d 7530 203d 2034 202a 2070 6920 2a20   mu0 = 4 * pi * 
-00013d80: 3165 2d37 0a0a 2020 2020 6570 7320 3d20  1e-7..    eps = 
-00013d90: 6570 735f 6566 6620 2a20 6570 7330 0a20  eps_eff * eps0. 
-00013da0: 2020 206d 7520 3d20 6d75 300a 2020 2020     mu = mu0.    
-00013db0: 4c5f 6d20 3d20 7371 7274 2865 7073 202a  L_m = sqrt(eps *
-00013dc0: 206d 7529 202a 205a 0a20 2020 2043 5f6d   mu) * Z.    C_m
-00013dd0: 203d 2073 7172 7428 6570 7320 2a20 6d75   = sqrt(eps * mu
-00013de0: 2920 2f20 5a0a 2020 2020 7265 7475 726e  ) / Z.    return
-00013df0: 204c 5f6d 2c20 435f 6d0a 0a0a 6465 6620   L_m, C_m...def 
-00013e00: 5f6d 6963 726f 7374 7269 705f 5a5f 7769  _microstrip_Z_wi
-00013e10: 7468 5f4c 6b28 7769 7265 5f77 6964 7468  th_Lk(wire_width
-00013e20: 2c20 6469 656c 6563 7472 6963 5f74 6869  , dielectric_thi
-00013e30: 636b 6e65 7373 2c20 6570 735f 722c 204c  ckness, eps_r, L
-00013e40: 6b5f 7065 725f 7371 293a 0a20 2020 2022  k_per_sq):.    "
-00013e50: 2222 4361 6c63 756c 6174 6573 2074 6865  ""Calculates the
-00013e60: 2069 6d70 6564 616e 6365 206f 6620 6120   impedance of a 
-00013e70: 6d69 6372 6f73 7472 6970 2067 6976 656e  microstrip given
-00013e80: 2077 6972 6520 7769 6474 682c 2064 6965   wire width, die
-00013e90: 6c65 6374 7269 630a 2020 2020 7468 6963  lectric.    thic
-00013ea0: 6b6e 6573 7320 616e 6420 636f 6e73 7461  kness and consta
-00013eb0: 6e74 2c20 616e 6420 6b69 6e65 7469 6320  nt, and kinetic 
-00013ec0: 696e 6475 6374 616e 6365 2070 6572 2073  inductance per s
-00013ed0: 7175 6172 652e 0a0a 2020 2020 5061 7261  quare...    Para
-00013ee0: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
-00013ef0: 2d2d 2d2d 2d0a 2020 2020 7769 7265 5f77  -----.    wire_w
-00013f00: 6964 7468 203a 2069 6e74 206f 7220 666c  idth : int or fl
-00013f10: 6f61 740a 2020 2020 2020 2020 5769 6474  oat.        Widt
-00013f20: 6820 6f66 2074 6865 2063 6f6e 6475 6374  h of the conduct
-00013f30: 696e 6720 7374 7269 702e 0a20 2020 2064  ing strip..    d
-00013f40: 6965 6c65 6374 7269 635f 7468 6963 6b6e  ielectric_thickn
-00013f50: 6573 7320 3a20 696e 7420 6f72 2066 6c6f  ess : int or flo
-00013f60: 6174 0a20 2020 2020 2020 2054 6869 636b  at.        Thick
-00013f70: 6e65 7373 206f 6620 7468 6520 7375 6273  ness of the subs
-00013f80: 7472 6174 652e 0a20 2020 2065 7073 5f72  trate..    eps_r
-00013f90: 203a 2069 6e74 206f 7220 666c 6f61 740a   : int or float.
-00013fa0: 2020 2020 2020 2020 4469 656c 6563 7472          Dielectr
-00013fb0: 6963 2063 6f6e 7374 616e 7420 6f66 2074  ic constant of t
-00013fc0: 6865 2073 7562 7374 7261 7465 2e0a 2020  he substrate..  
-00013fd0: 2020 4c6b 5f70 6572 5f73 7120 3a20 696e    Lk_per_sq : in
-00013fe0: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
-00013ff0: 2020 204b 696e 6574 6963 2069 6e64 7563     Kinetic induc
-00014000: 7461 6e63 6520 7065 7220 7371 7561 7265  tance per square
-00014010: 206f 6620 7468 6520 6d69 6372 6f73 7472   of the microstr
-00014020: 6970 2e0a 0a20 2020 2052 6574 7572 6e73  ip...    Returns
-00014030: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
-00014040: 205a 203a 2066 6c6f 6174 0a20 2020 2020   Z : float.     
-00014050: 2020 2049 6d70 6564 616e 6365 206f 6620     Impedance of 
-00014060: 7468 6520 6d69 6372 6f73 7472 6970 2e0a  the microstrip..
-00014070: 0a20 2020 204e 6f74 6573 0a20 2020 202d  .    Notes.    -
-00014080: 2d2d 2d2d 0a20 2020 2045 7175 6174 696f  ----.    Equatio
-00014090: 6e73 2074 616b 656e 2066 726f 6d3a 0a20  ns taken from:. 
-000140a0: 2020 2020 2020 2048 616d 6d65 7273 7461         Hammersta
-000140b0: 642c 2045 2e2c 2026 204a 656e 7365 6e2c  d, E., & Jensen,
-000140c0: 204f 2e20 2831 3938 3029 2e20 4163 6375   O. (1980). Accu
-000140d0: 7261 7465 204d 6f64 656c 7320 666f 7220  rate Models for 
-000140e0: 4d69 6372 6f73 7472 6970 0a20 2020 2020  Microstrip.     
-000140f0: 2020 2043 6f6d 7075 7465 722d 4169 6465     Computer-Aide
-00014100: 6420 4465 7369 676e 2e20 2068 7474 703a  d Design.  http:
-00014110: 2f2f 646f 692e 6f72 672f 3130 2e31 3130  //doi.org/10.110
-00014120: 392f 4d57 5359 4d2e 3139 3830 2e31 3132  9/MWSYM.1980.112
-00014130: 3433 3033 0a0a 2020 2020 5468 6573 6520  4303..    These 
-00014140: 6571 7561 7469 6f6e 7320 6361 6e20 6265  equations can be
-00014150: 2066 7572 7468 6572 2063 6f72 7265 6374   further correct
-00014160: 6564 2066 6f72 2074 6869 636b 2066 696c  ed for thick fil
-00014170: 6d73 2028 4861 6d6d 6572 7374 6164 2045  ms (Hammerstad E
-00014180: 7173 0a20 2020 2036 2d39 2920 616e 6420  qs.    6-9) and 
-00014190: 616c 736f 2066 6f72 2066 7265 7175 656e  also for frequen
-000141a0: 6379 2073 696e 6365 206d 6963 726f 7374  cy since microst
-000141b0: 7269 7073 2061 7265 2064 6973 7065 7273  rips are dispers
-000141c0: 6976 6520 2848 616d 6d65 7273 7461 640a  ive (Hammerstad.
-000141d0: 2020 2020 4571 7320 3130 2d31 3229 0a20      Eqs 10-12). 
-000141e0: 2020 2022 2222 0a20 2020 2023 2041 6464     """.    # Add
-000141f0: 2061 206b 696e 6574 6963 2069 6e64 7563   a kinetic induc
-00014200: 7461 6e63 6520 616e 6420 7265 6361 6c63  tance and recalc
-00014210: 756c 6174 6520 7468 6520 696d 7065 6461  ulate the impeda
-00014220: 6e63 652c 2062 6520 6361 7265 6675 6c0a  nce, be careful.
-00014230: 2020 2020 2320 746f 2069 6e70 7574 204c      # to input L
-00014240: 6b20 6173 2061 2070 6572 2d6d 6574 6572  k as a per-meter
-00014250: 2069 6e64 7563 7461 6e63 650a 2020 2020   inductance.    
-00014260: 4c5f 6d2c 2043 5f6d 203d 205f 6d69 6372  L_m, C_m = _micr
-00014270: 6f73 7472 6970 5f4c 435f 7065 725f 6d65  ostrip_LC_per_me
-00014280: 7465 7228 7769 7265 5f77 6964 7468 2c20  ter(wire_width, 
-00014290: 6469 656c 6563 7472 6963 5f74 6869 636b  dielectric_thick
-000142a0: 6e65 7373 2c20 6570 735f 7229 0a20 2020  ness, eps_r).   
-000142b0: 204c 6b5f 6d20 3d20 4c6b 5f70 6572 5f73   Lk_m = Lk_per_s
-000142c0: 7120 2a20 2831 2e30 202f 2077 6972 655f  q * (1.0 / wire_
-000142d0: 7769 6474 6829 0a20 2020 205a 203d 2073  width).    Z = s
-000142e0: 7172 7428 284c 5f6d 202b 204c 6b5f 6d29  qrt((L_m + Lk_m)
-000142f0: 202f 2043 5f6d 290a 2020 2020 7265 7475   / C_m).    retu
-00014300: 726e 205a 0a0a 0a64 6566 205f 6d69 6372  rn Z...def _micr
-00014310: 6f73 7472 6970 5f76 5f77 6974 685f 4c6b  ostrip_v_with_Lk
-00014320: 2877 6972 655f 7769 6474 682c 2064 6965  (wire_width, die
-00014330: 6c65 6374 7269 635f 7468 6963 6b6e 6573  lectric_thicknes
-00014340: 732c 2065 7073 5f72 2c20 4c6b 5f70 6572  s, eps_r, Lk_per
-00014350: 5f73 7129 3a0a 2020 2020 2222 2243 616c  _sq):.    """Cal
-00014360: 6375 6c61 7465 7320 7468 6520 7072 6f70  culates the prop
-00014370: 6167 6174 696f 6e20 7665 6c6f 6369 7479  agation velocity
-00014380: 2069 6e20 6120 6d69 6372 6f73 7472 6970   in a microstrip
-00014390: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-000143a0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-000143b0: 2020 2020 7769 7265 5f77 6964 7468 203a      wire_width :
-000143c0: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
-000143d0: 2020 2020 2020 5769 6474 6820 6f66 2074        Width of t
-000143e0: 6865 2063 6f6e 6475 6374 696e 6720 7374  he conducting st
-000143f0: 7269 702e 0a20 2020 2064 6965 6c65 6374  rip..    dielect
-00014400: 7269 635f 7468 6963 6b6e 6573 7320 3a20  ric_thickness : 
-00014410: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
-00014420: 2020 2020 2054 6869 636b 6e65 7373 206f       Thickness o
-00014430: 6620 7468 6520 7375 6273 7472 6174 652e  f the substrate.
-00014440: 0a20 2020 2065 7073 5f72 203a 2069 6e74  .    eps_r : int
-00014450: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
-00014460: 2020 4469 656c 6563 7472 6963 2063 6f6e    Dielectric con
-00014470: 7374 616e 7420 6f66 2074 6865 2073 7562  stant of the sub
-00014480: 7374 7261 7465 2e0a 2020 2020 4c6b 5f70  strate..    Lk_p
-00014490: 6572 5f73 7120 3a20 696e 7420 6f72 2066  er_sq : int or f
-000144a0: 6c6f 6174 0a20 2020 2020 2020 204b 696e  loat.        Kin
-000144b0: 6574 6963 2069 6e64 7563 7461 6e63 6520  etic inductance 
-000144c0: 7065 7220 7371 7561 7265 206f 6620 7468  per square of th
-000144d0: 6520 6d69 6372 6f73 7472 6970 2e0a 0a20  e microstrip... 
-000144e0: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
-000144f0: 2d2d 2d2d 2d2d 0a20 2020 2076 203a 2066  ------.    v : f
-00014500: 6c6f 6174 0a20 2020 2020 2020 2050 726f  loat.        Pro
-00014510: 7061 6761 7469 6f6e 2076 656c 6f63 6974  pagation velocit
-00014520: 7920 696e 2074 6865 206d 6963 726f 7374  y in the microst
-00014530: 7269 700a 0a20 2020 204e 6f74 6573 0a20  rip..    Notes. 
-00014540: 2020 202d 2d2d 2d2d 0a20 2020 2045 7175     -----.    Equ
-00014550: 6174 696f 6e73 2074 616b 656e 2066 726f  ations taken fro
-00014560: 6d3a 0a20 2020 2020 2020 2048 616d 6d65  m:.        Hamme
-00014570: 7273 7461 642c 2045 2e2c 2026 204a 656e  rstad, E., & Jen
-00014580: 7365 6e2c 204f 2e20 2831 3938 3029 2e20  sen, O. (1980). 
-00014590: 4163 6375 7261 7465 204d 6f64 656c 7320  Accurate Models 
-000145a0: 666f 7220 4d69 6372 6f73 7472 6970 0a20  for Microstrip. 
-000145b0: 2020 2020 2020 2043 6f6d 7075 7465 722d         Computer-
-000145c0: 4169 6465 6420 4465 7369 676e 2e20 2068  Aided Design.  h
-000145d0: 7474 703a 2f2f 646f 692e 6f72 672f 3130  ttp://doi.org/10
-000145e0: 2e31 3130 392f 4d57 5359 4d2e 3139 3830  .1109/MWSYM.1980
-000145f0: 2e31 3132 3433 3033 0a0a 2020 2020 5468  .1124303..    Th
-00014600: 6573 6520 6571 7561 7469 6f6e 7320 6361  ese equations ca
-00014610: 6e20 6265 2066 7572 7468 6572 2063 6f72  n be further cor
-00014620: 7265 6374 6564 2066 6f72 2074 6869 636b  rected for thick
-00014630: 2066 696c 6d73 2028 4861 6d6d 6572 7374   films (Hammerst
-00014640: 6164 2045 7173 0a20 2020 2036 2d39 2920  ad Eqs.    6-9) 
-00014650: 616e 6420 616c 736f 2066 6f72 2066 7265  and also for fre
-00014660: 7175 656e 6379 2073 696e 6365 206d 6963  quency since mic
-00014670: 726f 7374 7269 7073 2061 7265 2064 6973  rostrips are dis
-00014680: 7065 7273 6976 6520 2848 616d 6d65 7273  persive (Hammers
-00014690: 7461 640a 2020 2020 4571 7320 3130 2d31  tad.    Eqs 10-1
-000146a0: 3229 0a20 2020 2022 2222 0a20 2020 204c  2).    """.    L
-000146b0: 5f6d 2c20 435f 6d20 3d20 5f6d 6963 726f  _m, C_m = _micro
-000146c0: 7374 7269 705f 4c43 5f70 6572 5f6d 6574  strip_LC_per_met
-000146d0: 6572 2877 6972 655f 7769 6474 682c 2064  er(wire_width, d
-000146e0: 6965 6c65 6374 7269 635f 7468 6963 6b6e  ielectric_thickn
-000146f0: 6573 732c 2065 7073 5f72 290a 2020 2020  ess, eps_r).    
-00014700: 4c6b 5f6d 203d 204c 6b5f 7065 725f 7371  Lk_m = Lk_per_sq
-00014710: 202a 2028 312e 3020 2f20 7769 7265 5f77   * (1.0 / wire_w
-00014720: 6964 7468 290a 2020 2020 7620 3d20 3120  idth).    v = 1 
-00014730: 2f20 7371 7274 2828 4c5f 6d20 2b20 4c6b  / sqrt((L_m + Lk
-00014740: 5f6d 2920 2a20 435f 6d29 0a20 2020 2072  _m) * C_m).    r
-00014750: 6574 7572 6e20 760a 0a0a 6465 6620 5f66  eturn v...def _f
-00014760: 696e 645f 6d69 6372 6f73 7472 6970 5f77  ind_microstrip_w
-00014770: 6972 655f 7769 6474 6828 5a5f 7461 7267  ire_width(Z_targ
-00014780: 6574 2c20 6469 656c 6563 7472 6963 5f74  et, dielectric_t
-00014790: 6869 636b 6e65 7373 2c20 6570 735f 722c  hickness, eps_r,
-000147a0: 204c 6b5f 7065 725f 7371 293a 0a20 2020   Lk_per_sq):.   
-000147b0: 2022 2222 4361 6c63 756c 6174 6573 2074   """Calculates t
-000147c0: 6865 2077 6972 6520 7769 6474 6820 6f66  he wire width of
-000147d0: 2061 206d 6963 726f 7374 7269 7020 6769   a microstrip gi
-000147e0: 7665 6e20 6120 7461 7267 6574 2069 6d70  ven a target imp
-000147f0: 6564 616e 6365 2c0a 2020 2020 6469 656c  edance,.    diel
-00014800: 6563 7472 6963 2074 6869 636b 6e65 7373  ectric thickness
-00014810: 2061 6e64 2063 6f6e 7374 616e 742c 2061   and constant, a
-00014820: 6e64 206b 696e 6574 6963 2069 6e64 7563  nd kinetic induc
-00014830: 7461 6e63 6520 7065 7220 7371 7561 7265  tance per square
-00014840: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-00014850: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-00014860: 0a20 2020 205a 5f74 6172 6765 7420 3a20  .    Z_target : 
-00014870: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
-00014880: 2020 2020 2054 6172 6765 7420 696d 7065       Target impe
-00014890: 6461 6e63 6520 6f66 2074 6865 206d 6963  dance of the mic
-000148a0: 726f 7374 7269 702e 0a20 2020 2064 6965  rostrip..    die
-000148b0: 6c65 6374 7269 635f 7468 6963 6b6e 6573  lectric_thicknes
-000148c0: 7320 3a20 696e 7420 6f72 2066 6c6f 6174  s : int or float
-000148d0: 0a20 2020 2020 2020 2054 6869 636b 6e65  .        Thickne
-000148e0: 7373 206f 6620 7468 6520 7375 6273 7472  ss of the substr
-000148f0: 6174 652e 0a20 2020 2065 7073 5f72 203a  ate..    eps_r :
-00014900: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
-00014910: 2020 2020 2020 4469 656c 6563 7472 6963        Dielectric
-00014920: 2063 6f6e 7374 616e 7420 6f66 2074 6865   constant of the
-00014930: 2073 7562 7374 7261 7465 2e0a 2020 2020   substrate..    
-00014940: 4c6b 5f70 6572 5f73 7120 3a20 696e 7420  Lk_per_sq : int 
-00014950: 6f72 2066 6c6f 6174 0a20 2020 2020 2020  or float.       
-00014960: 204b 696e 6574 6963 2069 6e64 7563 7461   Kinetic inducta
-00014970: 6e63 6520 7065 7220 7371 7561 7265 206f  nce per square o
-00014980: 6620 7468 6520 6d69 6372 6f73 7472 6970  f the microstrip
-00014990: 2e0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
-000149a0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2077     -------.    w
-000149b0: 203a 2066 6c6f 6174 0a20 2020 2020 2020   : float.       
-000149c0: 2057 6972 6520 7769 6474 6820 6f66 2074   Wire width of t
-000149d0: 6865 206d 6963 726f 7374 7269 702e 0a0a  he microstrip...
-000149e0: 2020 2020 4e6f 7465 730a 2020 2020 2d2d      Notes.    --
-000149f0: 2d2d 2d0a 2020 2020 4571 7561 7469 6f6e  ---.    Equation
-00014a00: 7320 7461 6b65 6e20 6672 6f6d 3a0a 2020  s taken from:.  
-00014a10: 2020 2020 2020 4861 6d6d 6572 7374 6164        Hammerstad
-00014a20: 2c20 452e 2c20 2620 4a65 6e73 656e 2c20  , E., & Jensen, 
-00014a30: 4f2e 2028 3139 3830 292e 2041 6363 7572  O. (1980). Accur
-00014a40: 6174 6520 4d6f 6465 6c73 2066 6f72 204d  ate Models for M
-00014a50: 6963 726f 7374 7269 700a 2020 2020 2020  icrostrip.      
-00014a60: 2020 436f 6d70 7574 6572 2d41 6964 6564    Computer-Aided
-00014a70: 2044 6573 6967 6e2e 2020 6874 7470 3a2f   Design.  http:/
-00014a80: 2f64 6f69 2e6f 7267 2f31 302e 3131 3039  /doi.org/10.1109
-00014a90: 2f4d 5753 594d 2e31 3938 302e 3131 3234  /MWSYM.1980.1124
-00014aa0: 3330 330a 0a20 2020 2054 6865 7365 2065  303..    These e
-00014ab0: 7175 6174 696f 6e73 2063 616e 2062 6520  quations can be 
-00014ac0: 6675 7274 6865 7220 636f 7272 6563 7465  further correcte
-00014ad0: 6420 666f 7220 7468 6963 6b20 6669 6c6d  d for thick film
-00014ae0: 7320 2848 616d 6d65 7273 7461 6420 4571  s (Hammerstad Eq
-00014af0: 730a 2020 2020 362d 3929 2061 6e64 2061  s.    6-9) and a
-00014b00: 6c73 6f20 666f 7220 6672 6571 7565 6e63  lso for frequenc
-00014b10: 7920 7369 6e63 6520 6d69 6372 6f73 7472  y since microstr
-00014b20: 6970 7320 6172 6520 6469 7370 6572 7369  ips are dispersi
-00014b30: 7665 2028 4861 6d6d 6572 7374 6164 0a20  ve (Hammerstad. 
-00014b40: 2020 2045 7173 2031 302d 3132 290a 2020     Eqs 10-12).  
-00014b50: 2020 2222 220a 0a20 2020 2064 6566 2065    """..    def e
-00014b60: 7272 6f72 5f66 756e 2877 6972 655f 7769  rror_fun(wire_wi
-00014b70: 6474 6829 3a0a 2020 2020 2020 2020 5a5f  dth):.        Z_
-00014b80: 6775 6573 7365 6420 3d20 5f6d 6963 726f  guessed = _micro
-00014b90: 7374 7269 705f 5a5f 7769 7468 5f4c 6b28  strip_Z_with_Lk(
-00014ba0: 0a20 2020 2020 2020 2020 2020 2077 6972  .            wir
-00014bb0: 655f 7769 6474 682c 2064 6965 6c65 6374  e_width, dielect
-00014bc0: 7269 635f 7468 6963 6b6e 6573 732c 2065  ric_thickness, e
-00014bd0: 7073 5f72 2c20 4c6b 5f70 6572 5f73 710a  ps_r, Lk_per_sq.
-00014be0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00014bf0: 2020 7265 7475 726e 2028 5a5f 6775 6573    return (Z_gues
-00014c00: 7365 6420 2d20 5a5f 7461 7267 6574 2920  sed - Z_target) 
-00014c10: 2a2a 2032 2020 2320 5468 6520 6572 726f  ** 2  # The erro
-00014c20: 720a 0a20 2020 2078 3020 3d20 6469 656c  r..    x0 = diel
-00014c30: 6563 7472 6963 5f74 6869 636b 6e65 7373  ectric_thickness
-00014c40: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
-00014c50: 2020 6672 6f6d 2073 6369 7079 2e6f 7074    from scipy.opt
-00014c60: 696d 697a 6520 696d 706f 7274 2066 6d69  imize import fmi
-00014c70: 6e0a 2020 2020 6578 6365 7074 2045 7863  n.    except Exc
-00014c80: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-00014c90: 7261 6973 6520 496d 706f 7274 4572 726f  raise ImportErro
-00014ca0: 7228 0a20 2020 2020 2020 2020 2020 2022  r(.            "
-00014cb0: 205b 5048 4944 4c5d 2054 6f20 7275 6e20   [PHIDL] To run 
-00014cc0: 7468 6520 6d69 6372 6f73 7472 6970 2066  the microstrip f
-00014cd0: 756e 6374 696f 6e73 2079 6f75 2022 0a20  unctions you ". 
-00014ce0: 2020 2020 2020 2020 2020 2022 6e65 6564             "need
-00014cf0: 2073 6369 7079 2c20 706c 6561 7365 2069   scipy, please i
-00014d00: 6e73 7461 6c6c 2069 7420 7769 7468 2022  nstall it with "
-00014d10: 0a20 2020 2020 2020 2020 2020 2022 6070  .            "`p
-00014d20: 6970 2069 6e73 7461 6c6c 2073 6369 7079  ip install scipy
-00014d30: 6022 0a20 2020 2020 2020 2029 0a20 2020  `".        ).   
-00014d40: 2077 203d 2066 6d69 6e28 6572 726f 725f   w = fmin(error_
-00014d50: 6675 6e2c 2078 302c 2061 7267 733d 2829  fun, x0, args=()
-00014d60: 2c20 6469 7370 3d46 616c 7365 290a 2020  , disp=False).  
-00014d70: 2020 7265 7475 726e 2077 5b30 5d0a 0a0a    return w[0]...
-00014d80: 6465 6620 5f47 5f69 6e74 6567 7261 6e64  def _G_integrand
-00014d90: 2878 6970 2c20 4229 3a0a 2020 2020 2222  (xip, B):.    ""
-00014da0: 2253 7065 6369 616c 2066 756e 6374 696f  "Special functio
-00014db0: 6e20 666f 7220 6d69 6372 6f73 7472 6970  n for microstrip
-00014dc0: 2063 616c 6375 6c61 7469 6f6e 7322 2222   calculations"""
-00014dd0: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
-00014de0: 2020 6672 6f6d 2073 6369 7079 2e73 7065    from scipy.spe
-00014df0: 6369 616c 2069 6d70 6f72 7420 6976 2061  cial import iv a
-00014e00: 7320 6265 7373 656c 690a 2020 2020 6578  s besseli.    ex
-00014e10: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
-00014e20: 2020 2020 2020 2020 2222 225b 5048 4944          """[PHID
-00014e30: 4c5d 2054 6f20 7275 6e20 7468 6973 2066  L] To run this f
-00014e40: 756e 6374 696f 6e20 796f 7520 6e65 6564  unction you need
-00014e50: 2073 6369 7079 2c20 706c 6561 7365 2069   scipy, please i
-00014e60: 6e73 7461 6c6c 2069 7420 7769 7468 0a20  nstall it with. 
-00014e70: 2020 2020 2020 2070 6970 2069 6e73 7461         pip insta
-00014e80: 6c6c 2073 6369 7079 2222 220a 2020 2020  ll scipy""".    
-00014e90: 7265 7475 726e 2062 6573 7365 6c69 2830  return besseli(0
-00014ea0: 2c20 4220 2a20 7371 7274 2831 202d 2078  , B * sqrt(1 - x
-00014eb0: 6970 2a2a 3229 290a 0a0a 6465 6620 5f47  ip**2))...def _G
-00014ec0: 2878 692c 2042 293a 0a20 2020 2022 2222  (xi, B):.    """
-00014ed0: 5370 6563 6961 6c20 6675 6e63 7469 6f6e  Special function
-00014ee0: 2066 6f72 206d 6963 726f 7374 7269 7020   for microstrip 
-00014ef0: 6361 6c63 756c 6174 696f 6e73 2222 220a  calculations""".
-00014f00: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00014f10: 2069 6d70 6f72 7420 7363 6970 792e 696e   import scipy.in
-00014f20: 7465 6772 6174 650a 2020 2020 6578 6365  tegrate.    exce
-00014f30: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
-00014f40: 2020 2020 2020 7261 6973 6520 496d 706f        raise Impo
-00014f50: 7274 4572 726f 7228 0a20 2020 2020 2020  rtError(.       
-00014f60: 2020 2020 2022 205b 5048 4944 4c5d 2054       " [PHIDL] T
-00014f70: 6f20 7275 6e20 7468 6520 6d69 6372 6f73  o run the micros
-00014f80: 7472 6970 2066 756e 6374 696f 6e73 2079  trip functions y
-00014f90: 6f75 2022 0a20 2020 2020 2020 2020 2020  ou ".           
-00014fa0: 2022 6e65 6564 2073 6369 7079 2c20 706c   "need scipy, pl
-00014fb0: 6561 7365 2069 6e73 7461 6c6c 2069 7420  ease install it 
-00014fc0: 7769 7468 2022 0a20 2020 2020 2020 2020  with ".         
-00014fd0: 2020 2022 6070 6970 2069 6e73 7461 6c6c     "`pip install
-00014fe0: 2073 6369 7079 6022 0a20 2020 2020 2020   scipy`".       
-00014ff0: 2029 0a20 2020 2072 6574 7572 6e20 4220   ).    return B 
-00015000: 2f20 7369 6e68 2842 2920 2a20 7363 6970  / sinh(B) * scip
-00015010: 792e 696e 7465 6772 6174 652e 7175 6164  y.integrate.quad
-00015020: 285f 475f 696e 7465 6772 616e 642c 2030  (_G_integrand, 0
-00015030: 2c20 7869 2c20 6172 6773 3d28 4229 295b  , xi, args=(B))[
-00015040: 305d 0a0a 0a40 6465 7669 6365 5f6c 7275  0]...@device_lru
-00015050: 5f63 6163 6865 0a64 6566 2068 6563 6b65  _cache.def hecke
-00015060: 6e5f 7461 7065 7228 0a20 2020 206c 656e  n_taper(.    len
-00015070: 6774 683d 3230 302c 0a20 2020 2042 3d34  gth=200,.    B=4
-00015080: 2e30 3039 312c 0a20 2020 2064 6965 6c65  .0091,.    diele
-00015090: 6374 7269 635f 7468 6963 6b6e 6573 733d  ctric_thickness=
-000150a0: 302e 3235 2c0a 2020 2020 6570 735f 723d  0.25,.    eps_r=
-000150b0: 322c 0a20 2020 204c 6b5f 7065 725f 7371  2,.    Lk_per_sq
-000150c0: 3d32 3530 652d 3132 2c0a 2020 2020 5a31  =250e-12,.    Z1
-000150d0: 3d4e 6f6e 652c 0a20 2020 205a 323d 4e6f  =None,.    Z2=No
-000150e0: 6e65 2c0a 2020 2020 7769 6474 6831 3d4e  ne,.    width1=N
-000150f0: 6f6e 652c 0a20 2020 2077 6964 7468 323d  one,.    width2=
-00015100: 4e6f 6e65 2c0a 2020 2020 6e75 6d5f 7074  None,.    num_pt
-00015110: 733d 3130 302c 0a20 2020 206c 6179 6572  s=100,.    layer
-00015120: 3d30 2c0a 293a 0a20 2020 2022 2222 4372  =0,.):.    """Cr
-00015130: 6561 7465 7320 6120 4865 636b 656e 2d74  eates a Hecken-t
-00015140: 6170 6572 6564 206d 6963 726f 7374 7269  apered microstri
-00015150: 702e 0a0a 2020 2020 5061 7261 6d65 7465  p...    Paramete
-00015160: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-00015170: 2d0a 2020 2020 6c65 6e67 7468 203a 2069  -.    length : i
-00015180: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
-00015190: 2020 2020 4c65 6e67 7468 206f 6620 7468      Length of th
-000151a0: 6520 6d69 6372 6f73 7472 6970 2e0a 2020  e microstrip..  
-000151b0: 2020 4220 3a20 696e 7420 6f72 2066 6c6f    B : int or flo
-000151c0: 6174 0a20 2020 2020 2020 2043 6f6e 7472  at.        Contr
-000151d0: 6f6c 7320 7468 6520 696e 7465 6e73 6974  ols the intensit
-000151e0: 7920 6f66 2074 6865 2074 6170 6572 2e0a  y of the taper..
-000151f0: 2020 2020 6469 656c 6563 7472 6963 5f74      dielectric_t
-00015200: 6869 636b 6e65 7373 203a 2069 6e74 206f  hickness : int o
-00015210: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
-00015220: 5468 6963 6b6e 6573 7320 6f66 2074 6865  Thickness of the
-00015230: 2073 7562 7374 7261 7465 2e0a 2020 2020   substrate..    
-00015240: 6570 735f 7220 3a20 696e 7420 6f72 2066  eps_r : int or f
-00015250: 6c6f 6174 0a20 2020 2020 2020 2044 6965  loat.        Die
-00015260: 6c65 6374 7269 6320 636f 6e73 7461 6e74  lectric constant
-00015270: 206f 6620 7468 6520 7375 6273 7472 6174   of the substrat
-00015280: 652e 0a20 2020 204c 6b5f 7065 725f 7371  e..    Lk_per_sq
-00015290: 203a 2066 6c6f 6174 0a20 2020 2020 2020   : float.       
-000152a0: 204b 696e 6574 6963 2069 6e64 7563 7461   Kinetic inducta
-000152b0: 6e63 6520 7065 7220 7371 7561 7265 206f  nce per square o
-000152c0: 6620 7468 6520 6d69 6372 6f73 7472 6970  f the microstrip
-000152d0: 2e0a 2020 2020 5a31 203a 2069 6e74 2c20  ..    Z1 : int, 
-000152e0: 666c 6f61 742c 206f 7220 4e6f 6e65 0a20  float, or None. 
-000152f0: 2020 2020 2020 2049 6d70 6564 616e 6365         Impedance
-00015300: 206f 6620 7468 6520 6c65 6674 2073 6964   of the left sid
-00015310: 6520 7265 6769 6f6e 206f 6620 7468 6520  e region of the 
-00015320: 6d69 6372 6f73 7472 6970 2e0a 2020 2020  microstrip..    
-00015330: 5a32 203a 2069 6e74 2c20 666c 6f61 742c  Z2 : int, float,
-00015340: 206f 7220 4e6f 6e65 0a20 2020 2020 2020   or None.       
-00015350: 2049 6d70 6564 616e 6365 206f 6620 7468   Impedance of th
-00015360: 6520 7269 6768 7420 7369 6465 2072 6567  e right side reg
-00015370: 696f 6e20 6f66 2074 6865 206d 6963 726f  ion of the micro
-00015380: 7374 7269 702e 0a20 2020 2077 6964 7468  strip..    width
-00015390: 3120 3a20 696e 742c 2066 6c6f 6174 2c20  1 : int, float, 
-000153a0: 6f72 204e 6f6e 650a 2020 2020 2020 2020  or None.        
-000153b0: 5769 6474 6820 6f66 2074 6865 206c 6566  Width of the lef
-000153c0: 7420 7369 6465 206f 6620 7468 6520 6d69  t side of the mi
-000153d0: 6372 6f73 7472 6970 2e0a 2020 2020 7769  crostrip..    wi
-000153e0: 6474 6832 203a 2069 6e74 2c20 666c 6f61  dth2 : int, floa
-000153f0: 742c 206f 7220 4e6f 6e65 0a20 2020 2020  t, or None.     
-00015400: 2020 2057 6964 7468 206f 6620 7468 6520     Width of the 
-00015410: 7269 6768 7420 7369 6465 206f 6620 7468  right side of th
-00015420: 6520 6d69 6372 6f73 7472 6970 2e0a 2020  e microstrip..  
-00015430: 2020 6e75 6d5f 7074 7320 3a20 696e 740a    num_pts : int.
-00015440: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
-00015450: 6620 706f 696e 7473 2063 6f6d 7072 6973  f points compris
-00015460: 696e 6720 7468 6520 6375 7276 6520 6f66  ing the curve of
-00015470: 2074 6865 2065 6e74 6972 6520 6d69 6372   the entire micr
-00015480: 6f73 7472 6970 2e0a 2020 2020 6c61 7965  ostrip..    laye
-00015490: 7220 3a20 696e 742c 2061 7272 6179 2d6c  r : int, array-l
-000154a0: 696b 655b 325d 2c20 6f72 2073 6574 0a20  ike[2], or set. 
-000154b0: 2020 2020 2020 2053 7065 6369 6669 6320         Specific 
-000154c0: 6c61 7965 7228 7329 2074 6f20 7075 7420  layer(s) to put 
-000154d0: 706f 6c79 676f 6e20 6765 6f6d 6574 7279  polygon geometry
-000154e0: 206f 6e2e 0a0a 2020 2020 5265 7475 726e   on...    Return
-000154f0: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-00015500: 2020 4420 3a20 4465 7669 6365 0a20 2020    D : Device.   
-00015510: 2020 2020 2041 2044 6576 6963 6520 636f       A Device co
-00015520: 6e74 6169 6e69 6e67 2061 2048 6563 6b65  ntaining a Hecke
-00015530: 6e2d 7461 7065 7265 6420 6d69 6372 6f73  n-tapered micros
-00015540: 7472 6970 2e0a 2020 2020 2222 220a 2020  trip..    """.  
-00015550: 2020 6966 2077 6964 7468 3120 6973 206e    if width1 is n
-00015560: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00015570: 205a 3120 3d20 5f6d 6963 726f 7374 7269   Z1 = _microstri
-00015580: 705f 5a5f 7769 7468 5f4c 6b28 0a20 2020  p_Z_with_Lk(.   
-00015590: 2020 2020 2020 2020 2077 6964 7468 3120           width1 
-000155a0: 2a20 3165 2d36 2c20 6469 656c 6563 7472  * 1e-6, dielectr
-000155b0: 6963 5f74 6869 636b 6e65 7373 202a 2031  ic_thickness * 1
-000155c0: 652d 362c 2065 7073 5f72 2c20 4c6b 5f70  e-6, eps_r, Lk_p
-000155d0: 6572 5f73 710a 2020 2020 2020 2020 290a  er_sq.        ).
-000155e0: 2020 2020 6966 2077 6964 7468 3220 6973      if width2 is
-000155f0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00015600: 2020 205a 3220 3d20 5f6d 6963 726f 7374     Z2 = _microst
-00015610: 7269 705f 5a5f 7769 7468 5f4c 6b28 0a20  rip_Z_with_Lk(. 
-00015620: 2020 2020 2020 2020 2020 2077 6964 7468             width
-00015630: 3220 2a20 3165 2d36 2c20 6469 656c 6563  2 * 1e-6, dielec
-00015640: 7472 6963 5f74 6869 636b 6e65 7373 202a  tric_thickness *
-00015650: 2031 652d 362c 2065 7073 5f72 2c20 4c6b   1e-6, eps_r, Lk
-00015660: 5f70 6572 5f73 710a 2020 2020 2020 2020  _per_sq.        
-00015670: 290a 2020 2020 2320 4e6f 726d 616c 697a  ).    # Normaliz
-00015680: 6564 206c 656e 6774 6820 6f66 2074 6865  ed length of the
-00015690: 2077 6972 6520 5b2d 3120 746f 202b 315d   wire [-1 to +1]
-000156a0: 0a20 2020 2078 695f 6c69 7374 203d 206e  .    xi_list = n
-000156b0: 702e 6c69 6e73 7061 6365 282d 312c 2031  p.linspace(-1, 1
-000156c0: 2c20 6e75 6d5f 7074 7329 0a20 2020 205a  , num_pts).    Z
-000156d0: 203d 205b 6e70 2e65 7870 2830 2e35 202a   = [np.exp(0.5 *
-000156e0: 206c 6f67 285a 3120 2a20 5a32 2920 2b20   log(Z1 * Z2) + 
-000156f0: 302e 3520 2a20 6c6f 6728 5a32 202f 205a  0.5 * log(Z2 / Z
-00015700: 3129 202a 205f 4728 7869 2c20 4229 2920  1) * _G(xi, B)) 
-00015710: 666f 7220 7869 2069 6e20 7869 5f6c 6973  for xi in xi_lis
-00015720: 745d 0a20 2020 2077 6964 7468 7320 3d20  t].    widths = 
-00015730: 6e70 2e61 7272 6179 280a 2020 2020 2020  np.array(.      
-00015740: 2020 5b0a 2020 2020 2020 2020 2020 2020    [.            
-00015750: 5f66 696e 645f 6d69 6372 6f73 7472 6970  _find_microstrip
-00015760: 5f77 6972 655f 7769 6474 6828 0a20 2020  _wire_width(.   
-00015770: 2020 2020 2020 2020 2020 2020 207a 2c20               z, 
-00015780: 6469 656c 6563 7472 6963 5f74 6869 636b  dielectric_thick
-00015790: 6e65 7373 202a 2031 652d 362c 2065 7073  ness * 1e-6, eps
-000157a0: 5f72 2c20 4c6b 5f70 6572 5f73 710a 2020  _r, Lk_per_sq.  
-000157b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000157c0: 2020 2020 2020 2020 2a20 3165 360a 2020          * 1e6.  
-000157d0: 2020 2020 2020 2020 2020 666f 7220 7a20            for z 
-000157e0: 696e 205a 0a20 2020 2020 2020 205d 0a20  in Z.        ]. 
-000157f0: 2020 2029 0a20 2020 2078 203d 2028 7869     ).    x = (xi
-00015800: 5f6c 6973 7420 2f20 3229 202a 206c 656e  _list / 2) * len
-00015810: 6774 680a 0a20 2020 2023 2043 6f6d 7065  gth..    # Compe
-00015820: 6e73 6174 6520 666f 7220 7661 7279 696e  nsate for varyin
-00015830: 6720 7370 6565 6420 6f66 206c 6967 6874  g speed of light
-00015840: 2069 6e20 7468 6520 6d69 6372 6f73 7472   in the microstr
-00015850: 6970 2062 7920 7368 6f72 7465 6e69 6e67  ip by shortening
-00015860: 0a20 2020 2023 2061 6e64 206c 656e 6774  .    # and lengt
-00015870: 6865 6e69 6e67 2073 6563 7469 6f6e 7320  hening sections 
-00015880: 6163 636f 7264 696e 6720 746f 2074 6865  according to the
-00015890: 2073 7065 6564 206f 6620 6c69 6768 7420   speed of light 
-000158a0: 696e 2074 6861 7420 7365 6374 696f 6e0a  in that section.
-000158b0: 2020 2020 7620 3d20 6e70 2e61 7272 6179      v = np.array
-000158c0: 280a 2020 2020 2020 2020 5b0a 2020 2020  (.        [.    
-000158d0: 2020 2020 2020 2020 5f6d 6963 726f 7374          _microst
-000158e0: 7269 705f 765f 7769 7468 5f4c 6b28 0a20  rip_v_with_Lk(. 
-000158f0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00015900: 202a 2031 652d 362c 2064 6965 6c65 6374   * 1e-6, dielect
-00015910: 7269 635f 7468 6963 6b6e 6573 7320 2a20  ric_thickness * 
-00015920: 3165 2d36 2c20 6570 735f 722c 204c 6b5f  1e-6, eps_r, Lk_
-00015930: 7065 725f 7371 0a20 2020 2020 2020 2020  per_sq.         
-00015940: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00015950: 2066 6f72 2077 2069 6e20 7769 6474 6873   for w in widths
-00015960: 0a20 2020 2020 2020 205d 0a20 2020 2029  .        ].    )
-00015970: 0a20 2020 2064 7820 3d20 6e70 2e64 6966  .    dx = np.dif
-00015980: 6628 7829 0a20 2020 2064 785f 636f 6d70  f(x).    dx_comp
-00015990: 656e 7361 7465 6420 3d20 6478 202a 2076  ensated = dx * v
-000159a0: 5b3a 2d31 5d0a 2020 2020 785f 636f 6d70  [:-1].    x_comp
-000159b0: 656e 7361 7465 6420 3d20 6e70 2e63 756d  ensated = np.cum
-000159c0: 7375 6d28 6478 5f63 6f6d 7065 6e73 6174  sum(dx_compensat
-000159d0: 6564 290a 2020 2020 7820 3d20 6e70 2e68  ed).    x = np.h
-000159e0: 7374 6163 6b28 5b30 2c20 785f 636f 6d70  stack([0, x_comp
-000159f0: 656e 7361 7465 645d 2920 2f20 6d61 7828  ensated]) / max(
-00015a00: 785f 636f 6d70 656e 7361 7465 6429 202a  x_compensated) *
-00015a10: 206c 656e 6774 680a 0a20 2020 2023 2043   length..    # C
-00015a20: 7265 6174 6520 626c 616e 6b20 6465 7669  reate blank devi
-00015a30: 6365 2061 6e64 2061 6464 2074 6170 6572  ce and add taper
-00015a40: 2070 6f6c 7967 6f6e 0a20 2020 2044 203d   polygon.    D =
-00015a50: 2044 6576 6963 6528 2268 6563 6b65 6e22   Device("hecken"
-00015a60: 290a 2020 2020 7870 7473 203d 206e 702e  ).    xpts = np.
-00015a70: 636f 6e63 6174 656e 6174 6528 5b78 2c20  concatenate([x, 
-00015a80: 785b 3a3a 2d31 5d5d 290a 2020 2020 7970  x[::-1]]).    yp
-00015a90: 7473 203d 206e 702e 636f 6e63 6174 656e  ts = np.concaten
-00015aa0: 6174 6528 5b77 6964 7468 7320 2f20 322c  ate([widths / 2,
-00015ab0: 202d 7769 6474 6873 5b3a 3a2d 315d 202f   -widths[::-1] /
-00015ac0: 2032 5d29 0a20 2020 2044 2e61 6464 5f70   2]).    D.add_p
-00015ad0: 6f6c 7967 6f6e 2828 7870 7473 2c20 7970  olygon((xpts, yp
-00015ae0: 7473 292c 206c 6179 6572 3d6c 6179 6572  ts), layer=layer
-00015af0: 290a 2020 2020 442e 6164 645f 706f 7274  ).    D.add_port
-00015b00: 286e 616d 653d 312c 206d 6964 706f 696e  (name=1, midpoin
-00015b10: 743d 2830 2c20 3029 2c20 7769 6474 683d  t=(0, 0), width=
-00015b20: 7769 6474 6873 5b30 5d2c 206f 7269 656e  widths[0], orien
-00015b30: 7461 7469 6f6e 3d31 3830 290a 2020 2020  tation=180).    
-00015b40: 442e 6164 645f 706f 7274 286e 616d 653d  D.add_port(name=
-00015b50: 322c 206d 6964 706f 696e 743d 286c 656e  2, midpoint=(len
-00015b60: 6774 682c 2030 292c 2077 6964 7468 3d77  gth, 0), width=w
-00015b70: 6964 7468 735b 2d31 5d2c 206f 7269 656e  idths[-1], orien
-00015b80: 7461 7469 6f6e 3d30 290a 0a20 2020 2023  tation=0)..    #
-00015b90: 2041 6464 206d 6574 6120 696e 666f 726d   Add meta inform
-00015ba0: 6174 696f 6e20 6162 6f75 7420 7468 6520  ation about the 
-00015bb0: 7461 7065 720a 2020 2020 442e 696e 666f  taper.    D.info
-00015bc0: 5b22 6e75 6d5f 7371 7561 7265 7322 5d20  ["num_squares"] 
-00015bd0: 3d20 6e70 2e73 756d 286e 702e 6469 6666  = np.sum(np.diff
-00015be0: 2878 2920 2f20 7769 6474 6873 5b3a 2d31  (x) / widths[:-1
-00015bf0: 5d29 0a20 2020 2044 2e69 6e66 6f5b 2277  ]).    D.info["w
-00015c00: 6964 7468 3122 5d20 3d20 7769 6474 6873  idth1"] = widths
-00015c10: 5b30 5d0a 2020 2020 442e 696e 666f 5b22  [0].    D.info["
-00015c20: 7769 6474 6832 225d 203d 2077 6964 7468  width2"] = width
-00015c30: 735b 2d31 5d0a 2020 2020 442e 696e 666f  s[-1].    D.info
-00015c40: 5b22 5a31 225d 203d 205a 5b30 5d0a 2020  ["Z1"] = Z[0].  
-00015c50: 2020 442e 696e 666f 5b22 5a32 225d 203d    D.info["Z2"] =
-00015c60: 205a 5b2d 315d 0a20 2020 2023 204e 6f74   Z[-1].    # Not
-00015c70: 6520 7468 6572 6520 6172 6520 7477 6f20  e there are two 
-00015c80: 7661 6c75 6573 2066 6f72 2076 2f63 2028  values for v/c (
-00015c90: 616e 6420 665f 6375 746f 6666 2920 6265  and f_cutoff) be
-00015ca0: 6361 7573 6520 7468 6520 7370 6565 6420  cause the speed 
-00015cb0: 6f66 0a20 2020 2023 206c 6967 6874 2069  of.    # light i
-00015cc0: 7320 6469 6666 6572 656e 7420 6174 2074  s different at t
-00015cd0: 6865 2062 6567 696e 6e69 6e67 2061 6e64  he beginning and
-00015ce0: 2065 6e64 206f 6620 7468 6520 7461 7065   end of the tape
-00015cf0: 720a 2020 2020 442e 696e 666f 5b22 7722  r.    D.info["w"
-00015d00: 5d20 3d20 7769 6474 6873 0a20 2020 2044  ] = widths.    D
-00015d10: 2e69 6e66 6f5b 2278 225d 203d 2078 0a20  .info["x"] = x. 
-00015d20: 2020 2044 2e69 6e66 6f5b 225a 225d 203d     D.info["Z"] =
-00015d30: 205a 0a20 2020 2044 2e69 6e66 6f5b 2276   Z.    D.info["v
-00015d40: 2f63 225d 203d 2076 202f 2033 6538 0a20  /c"] = v / 3e8. 
-00015d50: 2020 2044 2e69 6e66 6f5b 2274 696d 655f     D.info["time_
-00015d60: 6c65 6e67 7468 225d 203d 206e 702e 7375  length"] = np.su
-00015d70: 6d28 0a20 2020 2020 2020 206e 702e 6469  m(.        np.di
-00015d80: 6666 2844 2e69 6e66 6f5b 2278 225d 202a  ff(D.info["x"] *
-00015d90: 2031 652d 3629 202f 2028 442e 696e 666f   1e-6) / (D.info
-00015da0: 5b22 762f 6322 5d5b 3a2d 315d 202a 2033  ["v/c"][:-1] * 3
-00015db0: 6538 290a 2020 2020 290a 2020 2020 442e  e8).    ).    D.
-00015dc0: 696e 666f 5b22 665f 6375 746f 6666 225d  info["f_cutoff"]
-00015dd0: 203d 2031 202f 2028 3220 2a20 442e 696e   = 1 / (2 * D.in
-00015de0: 666f 5b22 7469 6d65 5f6c 656e 6774 6822  fo["time_length"
-00015df0: 5d29 0a20 2020 2044 2e69 6e66 6f5b 226c  ]).    D.info["l
-00015e00: 656e 6774 6822 5d20 3d20 6c65 6e67 7468  ength"] = length
-00015e10: 0a0a 2020 2020 7265 7475 726e 2044 0a0a  ..    return D..
-00015e20: 0a40 6465 7669 6365 5f6c 7275 5f63 6163  .@device_lru_cac
-00015e30: 6865 0a64 6566 206d 6561 6e64 6572 5f74  he.def meander_t
-00015e40: 6170 6572 280a 2020 2020 785f 7461 7065  aper(.    x_tape
-00015e50: 722c 2077 5f74 6170 6572 2c20 6d65 616e  r, w_taper, mean
-00015e60: 6465 725f 6c65 6e67 7468 3d31 3030 302c  der_length=1000,
-00015e70: 2073 7061 6369 6e67 5f66 6163 746f 723d   spacing_factor=
-00015e80: 332c 206d 696e 5f73 7061 6369 6e67 3d30  3, min_spacing=0
-00015e90: 2e35 2c20 6c61 7965 723d 300a 293a 0a20  .5, layer=0.):. 
-00015ea0: 2020 2022 2222 5461 6b65 7320 696e 2061     """Takes in a
-00015eb0: 6e20 6172 7261 7920 6f66 2078 2d70 6f73  n array of x-pos
-00015ec0: 6974 696f 6e73 2061 6e64 2061 2061 7272  itions and a arr
-00015ed0: 6179 206f 6620 7769 6474 6873 2028 636f  ay of widths (co
-00015ee0: 7272 6573 706f 6e64 696e 6720 746f 0a20  rresponding to. 
-00015ef0: 2020 2065 6163 6820 782d 706f 7369 7469     each x-positi
-00015f00: 6f6e 2920 616e 6420 6372 6561 7465 7320  on) and creates 
-00015f10: 6120 6d65 616e 6465 722e 2020 5479 7069  a meander.  Typi
-00015f20: 6361 6c6c 7920 7573 6564 2066 6f72 2063  cally used for c
-00015f30: 7265 6174 696e 670a 2020 2020 6d65 616e  reating.    mean
-00015f40: 6465 7265 6420 7461 7065 7273 0a0a 2020  dered tapers..  
-00015f50: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00015f60: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00015f70: 785f 7461 7065 7220 3a20 6172 7261 792d  x_taper : array-
-00015f80: 6c69 6b65 5b4e 5d0a 2020 2020 2020 2020  like[N].        
-00015f90: 5468 6520 782d 636f 6f72 6469 6e61 7465  The x-coordinate
-00015fa0: 7320 6f66 2074 6865 2064 6174 6120 706f  s of the data po
-00015fb0: 696e 7473 2c20 6d75 7374 2062 6520 696e  ints, must be in
-00015fc0: 6372 6561 7369 6e67 2e0a 2020 2020 775f  creasing..    w_
-00015fd0: 7461 7065 7220 3a20 6172 7261 792d 6c69  taper : array-li
-00015fe0: 6b65 5b4e 5d0a 2020 2020 2020 2020 5468  ke[N].        Th
-00015ff0: 6520 792d 636f 6f72 6469 6e61 7465 7320  e y-coordinates 
-00016000: 6f66 2074 6865 2064 6174 6120 706f 696e  of the data poin
-00016010: 7473 2c20 7361 6d65 206c 656e 6774 6820  ts, same length 
-00016020: 6173 2060 6078 5f74 6170 6572 6060 2e0a  as ``x_taper``..
-00016030: 2020 2020 6d65 616e 6465 725f 6c65 6e67      meander_leng
-00016040: 7468 203a 2069 6e74 206f 7220 666c 6f61  th : int or floa
-00016050: 740a 2020 2020 2020 2020 4c65 6e67 7468  t.        Length
-00016060: 206f 6620 6561 6368 2073 6563 7469 6f6e   of each section
-00016070: 206f 6620 7468 6520 6d65 616e 6465 720a   of the meander.
-00016080: 2020 2020 7370 6163 696e 675f 6661 6374      spacing_fact
-00016090: 6f72 203a 2069 6e74 206f 7220 666c 6f61  or : int or floa
-000160a0: 740a 2020 2020 2020 2020 4d75 6c74 6970  t.        Multip
-000160b0: 6c69 6361 7469 7665 2073 7061 6369 6e67  licative spacing
-000160c0: 2066 6163 746f 7220 6265 7477 6565 6e20   factor between 
-000160d0: 6164 6a61 6365 6e74 206d 6561 6e64 6572  adjacent meander
-000160e0: 730a 2020 2020 6d69 6e5f 7370 6163 696e  s.    min_spacin
-000160f0: 6720 3a20 696e 7420 6f72 2066 6c6f 6174  g : int or float
-00016100: 0a20 2020 2020 2020 204d 696e 696d 756d  .        Minimum
-00016110: 2073 7061 6369 6e67 2062 6574 7765 656e   spacing between
-00016120: 2061 646a 6163 656e 7420 6d65 616e 6465   adjacent meande
-00016130: 7273 0a0a 2020 2020 6c61 7965 7220 3a20  rs..    layer : 
-00016140: 696e 742c 2061 7272 6179 2d6c 696b 655b  int, array-like[
-00016150: 325d 2c20 6f72 2073 6574 0a20 2020 2020  2], or set.     
-00016160: 2020 2053 7065 6369 6669 6320 6c61 7965     Specific laye
-00016170: 7228 7329 2074 6f20 7075 7420 706f 6c79  r(s) to put poly
-00016180: 676f 6e20 6765 6f6d 6574 7279 206f 6e2e  gon geometry on.
-00016190: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
-000161a0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 4420    -------.    D 
-000161b0: 3a20 4465 7669 6365 0a0a 2020 2020 2222  : Device..    ""
-000161c0: 220a 0a20 2020 2064 6566 2074 6170 6572  "..    def taper
-000161d0: 5f77 6964 7468 2878 293a 0a20 2020 2020  _width(x):.     
-000161e0: 2020 2072 6574 7572 6e20 6e70 2e69 6e74     return np.int
-000161f0: 6572 7028 782c 2078 5f74 6170 6572 2c20  erp(x, x_taper, 
-00016200: 775f 7461 7065 7229 0a0a 2020 2020 6465  w_taper)..    de
-00016210: 6620 7461 7065 725f 7365 6374 696f 6e28  f taper_section(
-00016220: 785f 7374 6172 742c 2078 5f65 6e64 2c20  x_start, x_end, 
-00016230: 6e75 6d5f 7074 733d 3330 2c20 6c61 7965  num_pts=30, laye
-00016240: 723d 3029 3a0a 2020 2020 2020 2020 4420  r=0):.        D 
-00016250: 3d20 4465 7669 6365 2822 7461 7065 7273  = Device("tapers
-00016260: 6563 2229 0a20 2020 2020 2020 206c 656e  ec").        len
-00016270: 6774 6820 3d20 785f 656e 6420 2d20 785f  gth = x_end - x_
-00016280: 7374 6172 740a 2020 2020 2020 2020 7820  start.        x 
-00016290: 3d20 6e70 2e6c 696e 7370 6163 6528 302c  = np.linspace(0,
-000162a0: 206c 656e 6774 682c 206e 756d 5f70 7473   length, num_pts
-000162b0: 290a 2020 2020 2020 2020 7769 6474 6873  ).        widths
-000162c0: 203d 206e 702e 6c69 6e73 7061 6365 2874   = np.linspace(t
-000162d0: 6170 6572 5f77 6964 7468 2878 5f73 7461  aper_width(x_sta
-000162e0: 7274 292c 2074 6170 6572 5f77 6964 7468  rt), taper_width
-000162f0: 2878 5f65 6e64 292c 206e 756d 5f70 7473  (x_end), num_pts
-00016300: 290a 2020 2020 2020 2020 7870 7473 203d  ).        xpts =
-00016310: 206e 702e 636f 6e63 6174 656e 6174 6528   np.concatenate(
-00016320: 5b78 2c20 785b 3a3a 2d31 5d5d 290a 2020  [x, x[::-1]]).  
-00016330: 2020 2020 2020 7970 7473 203d 206e 702e        ypts = np.
-00016340: 636f 6e63 6174 656e 6174 6528 5b77 6964  concatenate([wid
-00016350: 7468 7320 2f20 322c 202d 7769 6474 6873  ths / 2, -widths
-00016360: 5b3a 3a2d 315d 202f 2032 5d29 0a20 2020  [::-1] / 2]).   
-00016370: 2020 2020 2044 2e61 6464 5f70 6f6c 7967       D.add_polyg
-00016380: 6f6e 2828 7870 7473 2c20 7970 7473 292c  on((xpts, ypts),
-00016390: 206c 6179 6572 3d6c 6179 6572 290a 2020   layer=layer).  
-000163a0: 2020 2020 2020 442e 6164 645f 706f 7274        D.add_port
-000163b0: 286e 616d 653d 312c 206d 6964 706f 696e  (name=1, midpoin
-000163c0: 743d 2830 2c20 3029 2c20 7769 6474 683d  t=(0, 0), width=
-000163d0: 7769 6474 6873 5b30 5d2c 206f 7269 656e  widths[0], orien
-000163e0: 7461 7469 6f6e 3d31 3830 290a 2020 2020  tation=180).    
-000163f0: 2020 2020 442e 6164 645f 706f 7274 286e      D.add_port(n
-00016400: 616d 653d 322c 206d 6964 706f 696e 743d  ame=2, midpoint=
-00016410: 286c 656e 6774 682c 2030 292c 2077 6964  (length, 0), wid
-00016420: 7468 3d77 6964 7468 735b 2d31 5d2c 206f  th=widths[-1], o
-00016430: 7269 656e 7461 7469 6f6e 3d30 290a 2020  rientation=0).  
-00016440: 2020 2020 2020 7265 7475 726e 2044 0a0a        return D..
-00016450: 2020 2020 6465 6620 6172 635f 7461 7065      def arc_tape
-00016460: 7265 6428 0a20 2020 2020 2020 2072 6164  red(.        rad
-00016470: 6975 733d 3130 2c20 7769 6474 6831 3d31  ius=10, width1=1
-00016480: 2c20 7769 6474 6832 3d32 2c20 7468 6574  , width2=2, thet
-00016490: 613d 3435 2c20 616e 676c 655f 7265 736f  a=45, angle_reso
-000164a0: 6c75 7469 6f6e 3d32 2e35 2c20 6c61 7965  lution=2.5, laye
-000164b0: 723d 300a 2020 2020 293a 0a20 2020 2020  r=0.    ):.     
-000164c0: 2020 2044 203d 2044 6576 6963 6528 2261     D = Device("a
-000164d0: 7263 7461 7065 7222 290a 2020 2020 2020  rctaper").      
-000164e0: 2020 7061 7468 3120 3d20 6764 7370 792e    path1 = gdspy.
-000164f0: 5061 7468 2877 6964 7468 3d77 6964 7468  Path(width=width
-00016500: 312c 2069 6e69 7469 616c 5f70 6f69 6e74  1, initial_point
-00016510: 3d28 302c 2030 2929 0a20 2020 2020 2020  =(0, 0)).       
-00016520: 2070 6174 6831 2e74 7572 6e28 0a20 2020   path1.turn(.   
-00016530: 2020 2020 2020 2020 2072 6164 6975 733d           radius=
-00016540: 7261 6469 7573 2c0a 2020 2020 2020 2020  radius,.        
-00016550: 2020 2020 616e 676c 653d 7468 6574 6120      angle=theta 
-00016560: 2a20 7069 202f 2031 3830 2c0a 2020 2020  * pi / 180,.    
-00016570: 2020 2020 2020 2020 6e75 6d62 6572 5f6f          number_o
-00016580: 665f 706f 696e 7473 3d69 6e74 2861 6273  f_points=int(abs
-00016590: 2832 202a 2074 6865 7461 202f 2061 6e67  (2 * theta / ang
-000165a0: 6c65 5f72 6573 6f6c 7574 696f 6e29 292c  le_resolution)),
-000165b0: 0a20 2020 2020 2020 2020 2020 2066 696e  .            fin
-000165c0: 616c 5f77 6964 7468 3d77 6964 7468 322c  al_width=width2,
-000165d0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-000165e0: 2020 205b 442e 6164 645f 706f 6c79 676f     [D.add_polygo
-000165f0: 6e28 702c 206c 6179 6572 3d6c 6179 6572  n(p, layer=layer
-00016600: 2920 666f 7220 7020 696e 2070 6174 6831  ) for p in path1
-00016610: 2e70 6f6c 7967 6f6e 735d 0a20 2020 2020  .polygons].     
-00016620: 2020 2044 2e61 6464 5f70 6f72 7428 6e61     D.add_port(na
-00016630: 6d65 3d31 2c20 6d69 6470 6f69 6e74 3d28  me=1, midpoint=(
-00016640: 302c 2030 292c 2077 6964 7468 3d77 6964  0, 0), width=wid
-00016650: 7468 312c 206f 7269 656e 7461 7469 6f6e  th1, orientation
-00016660: 3d31 3830 290a 2020 2020 2020 2020 442e  =180).        D.
-00016670: 6164 645f 706f 7274 280a 2020 2020 2020  add_port(.      
-00016680: 2020 2020 2020 6e61 6d65 3d32 2c0a 2020        name=2,.  
-00016690: 2020 2020 2020 2020 2020 6d69 6470 6f69            midpoi
-000166a0: 6e74 3d28 7061 7468 312e 782c 2070 6174  nt=(path1.x, pat
-000166b0: 6831 2e79 292c 0a20 2020 2020 2020 2020  h1.y),.         
-000166c0: 2020 2077 6964 7468 3d77 6964 7468 322c     width=width2,
-000166d0: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
-000166e0: 656e 7461 7469 6f6e 3d70 6174 6831 2e64  entation=path1.d
-000166f0: 6972 6563 7469 6f6e 202a 2031 3830 202f  irection * 180 /
-00016700: 2070 692c 0a20 2020 2020 2020 2029 0a20   pi,.        ). 
-00016710: 2020 2020 2020 2072 6574 7572 6e20 440a         return D.
-00016720: 0a20 2020 2044 203d 2044 6576 6963 6528  .    D = Device(
-00016730: 226d 6561 6e64 6572 2d74 6170 6572 2229  "meander-taper")
-00016740: 0a20 2020 2078 706f 7331 203d 206d 696e  .    xpos1 = min
-00016750: 2878 5f74 6170 6572 290a 2020 2020 7870  (x_taper).    xp
-00016760: 6f73 3220 3d20 6d69 6e28 785f 7461 7065  os2 = min(x_tape
-00016770: 7229 202b 206d 6561 6e64 6572 5f6c 656e  r) + meander_len
-00016780: 6774 680a 2020 2020 7420 3d20 442e 6164  gth.    t = D.ad
-00016790: 645f 7265 6628 7461 7065 725f 7365 6374  d_ref(taper_sect
-000167a0: 696f 6e28 785f 7374 6172 743d 7870 6f73  ion(x_start=xpos
-000167b0: 312c 2078 5f65 6e64 3d78 706f 7332 2c20  1, x_end=xpos2, 
-000167c0: 6e75 6d5f 7074 733d 3530 2c20 6c61 7965  num_pts=50, laye
-000167d0: 723d 6c61 7965 7229 290a 2020 2020 442e  r=layer)).    D.
-000167e0: 6164 645f 706f 7274 2874 2e70 6f72 7473  add_port(t.ports
-000167f0: 5b31 5d29 0a20 2020 2064 6972 5f74 6f67  [1]).    dir_tog
-00016800: 676c 6520 3d20 2d31 0a20 2020 2077 6869  gle = -1.    whi
-00016810: 6c65 2078 706f 7332 203c 206d 6178 2878  le xpos2 < max(x
-00016820: 5f74 6170 6572 293a 0a20 2020 2020 2020  _taper):.       
-00016830: 2061 7263 5f77 6964 7468 3120 3d20 7461   arc_width1 = ta
-00016840: 7065 725f 7769 6474 6828 7870 6f73 3229  per_width(xpos2)
-00016850: 0a20 2020 2020 2020 2061 7263 5f72 6164  .        arc_rad
-00016860: 6975 7320 3d20 6d61 7828 7370 6163 696e  ius = max(spacin
-00016870: 675f 6661 6374 6f72 202a 2061 7263 5f77  g_factor * arc_w
-00016880: 6964 7468 312c 206d 696e 5f73 7061 6369  idth1, min_spaci
-00016890: 6e67 290a 2020 2020 2020 2020 6172 635f  ng).        arc_
-000168a0: 6c65 6e67 7468 203d 2070 6920 2a20 6172  length = pi * ar
-000168b0: 635f 7261 6469 7573 0a20 2020 2020 2020  c_radius.       
-000168c0: 2061 7263 5f77 6964 7468 3220 3d20 7461   arc_width2 = ta
-000168d0: 7065 725f 7769 6474 6828 7870 6f73 3220  per_width(xpos2 
-000168e0: 2b20 6172 635f 6c65 6e67 7468 290a 2020  + arc_length).  
-000168f0: 2020 2020 2020 4120 3d20 6172 635f 7461        A = arc_ta
-00016900: 7065 7265 6428 0a20 2020 2020 2020 2020  pered(.         
-00016910: 2020 2072 6164 6975 733d 6172 635f 7261     radius=arc_ra
-00016920: 6469 7573 2c0a 2020 2020 2020 2020 2020  dius,.          
-00016930: 2020 7769 6474 6831 3d61 7263 5f77 6964    width1=arc_wid
-00016940: 7468 312c 0a20 2020 2020 2020 2020 2020  th1,.           
-00016950: 2077 6964 7468 323d 6172 635f 7769 6474   width2=arc_widt
-00016960: 6832 2c0a 2020 2020 2020 2020 2020 2020  h2,.            
-00016970: 7468 6574 613d 3138 3020 2a20 6469 725f  theta=180 * dir_
-00016980: 746f 6767 6c65 2c0a 2020 2020 2020 2020  toggle,.        
-00016990: 2020 2020 6c61 7965 723d 6c61 7965 722c      layer=layer,
-000169a0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-000169b0: 2020 2061 203d 2044 2e61 6464 5f72 6566     a = D.add_ref
-000169c0: 2841 290a 2020 2020 2020 2020 612e 636f  (A).        a.co
-000169d0: 6e6e 6563 7428 706f 7274 3d31 2c20 6465  nnect(port=1, de
-000169e0: 7374 696e 6174 696f 6e3d 742e 706f 7274  stination=t.port
-000169f0: 735b 325d 290a 2020 2020 2020 2020 6469  s[2]).        di
-00016a00: 725f 746f 6767 6c65 203d 202d 6469 725f  r_toggle = -dir_
-00016a10: 746f 6767 6c65 0a20 2020 2020 2020 2078  toggle.        x
-00016a20: 706f 7331 203d 2078 706f 7332 202b 2061  pos1 = xpos2 + a
-00016a30: 7263 5f6c 656e 6774 680a 2020 2020 2020  rc_length.      
-00016a40: 2020 7870 6f73 3220 3d20 7870 6f73 3120    xpos2 = xpos1 
-00016a50: 2b20 6d65 616e 6465 725f 6c65 6e67 7468  + meander_length
-00016a60: 0a20 2020 2020 2020 2074 203d 2044 2e61  .        t = D.a
-00016a70: 6464 5f72 6566 280a 2020 2020 2020 2020  dd_ref(.        
-00016a80: 2020 2020 7461 7065 725f 7365 6374 696f      taper_sectio
-00016a90: 6e28 785f 7374 6172 743d 7870 6f73 312c  n(x_start=xpos1,
-00016aa0: 2078 5f65 6e64 3d78 706f 7332 2c20 6e75   x_end=xpos2, nu
-00016ab0: 6d5f 7074 733d 3330 2c20 6c61 7965 723d  m_pts=30, layer=
-00016ac0: 6c61 7965 7229 0a20 2020 2020 2020 2029  layer).        )
-00016ad0: 0a20 2020 2020 2020 2074 2e63 6f6e 6e65  .        t.conne
-00016ae0: 6374 2870 6f72 743d 312c 2064 6573 7469  ct(port=1, desti
-00016af0: 6e61 7469 6f6e 3d61 2e70 6f72 7473 5b32  nation=a.ports[2
-00016b00: 5d29 0a20 2020 2044 2e61 6464 5f70 6f72  ]).    D.add_por
-00016b10: 7428 742e 706f 7274 735b 325d 290a 0a20  t(t.ports[2]).. 
-00016b20: 2020 2072 6574 7572 6e20 440a 0a0a 2320     return D...# 
-00016b30: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00016b40: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00016b50: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00016b60: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00016b70: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a23  ==============.#
-00016b80: 2045 7861 6d70 6c65 2063 6f64 650a 2320   Example code.# 
-00016b90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00016ba0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00016bb0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00016bc0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00016bd0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a0a  ==============..
-00016be0: 2320 4420 3d20 7261 6365 7472 6163 6b5f  # D = racetrack_
-00016bf0: 6772 6164 7561 6c28 7769 6474 682c 2052  gradual(width, R
-00016c00: 203d 2035 2c20 4e3d 3329 0a23 2071 7569   = 5, N=3).# qui
-00016c10: 636b 706c 6f74 2844 290a 0a23 2044 203d  ckplot(D)..# D =
-00016c20: 2068 6563 6b65 6e5f 7461 7065 7228 6c65   hecken_taper(le
-00016c30: 6e67 7468 203d 2032 3030 2c20 4220 3d20  ngth = 200, B = 
-00016c40: 342e 3030 3931 2c20 6469 656c 6563 7472  4.0091, dielectr
-00016c50: 6963 5f74 6869 636b 6e65 7373 203d 2030  ic_thickness = 0
-00016c60: 2e32 352c 2065 7073 5f72 203d 2032 2c0a  .25, eps_r = 2,.
-00016c70: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00016c80: 2020 204c 6b5f 7065 725f 7371 203d 2032     Lk_per_sq = 2
-00016c90: 3530 652d 3132 2c20 5a31 203d 2035 302c  50e-12, Z1 = 50,
-00016ca0: 2077 6964 7468 3220 3d20 302e 332c 0a23   width2 = 0.3,.#
-00016cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016cc0: 2020 6e75 6d5f 7074 7320 3d20 3130 302c    num_pts = 100,
-00016cd0: 206c 6179 6572 203d 2030 290a 2320 7175   layer = 0).# qu
-00016ce0: 6963 6b70 6c6f 7428 4429 0a0a 2320 7420  ickplot(D)..# t 
-00016cf0: 3d20 6e70 2e6c 696e 7370 6163 6528 302c  = np.linspace(0,
-00016d00: 3129 0a23 2078 2c79 203d 205f 7261 6365  1).# x,y = _race
-00016d10: 7472 6163 6b5f 6772 6164 7561 6c5f 7061  track_gradual_pa
-00016d20: 7261 6d65 7472 6963 2874 2c20 5220 3d20  rametric(t, R = 
-00016d30: 352c 204e 203d 2033 290a 2320 706c 742e  5, N = 3).# plt.
-00016d40: 706c 6f74 2878 2c79 290a 2320 706c 742e  plot(x,y).# plt.
-00016d50: 6178 6973 2827 6571 7561 6c27 290a 0a0a  axis('equal')...
-00016d60: 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  # ==============
-00016d70: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00016d80: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00016d90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00016da0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00016db0: 0a23 0a23 2054 6578 740a 230a 2320 3d3d  .#.# Text.#.# ==
-00016dc0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00016dd0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00016de0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00016df0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00016e00: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a0a 0a64  ============...d
-00016e10: 6566 2074 6578 7428 7465 7874 3d22 6162  ef text(text="ab
-00016e20: 6364 222c 2073 697a 653d 3130 2c20 6a75  cd", size=10, ju
-00016e30: 7374 6966 793d 226c 6566 7422 2c20 6c61  stify="left", la
-00016e40: 7965 723d 302c 2066 6f6e 743d 2244 4550  yer=0, font="DEP
-00016e50: 4c4f 4622 293a 0a20 2020 2022 2222 4372  LOF"):.    """Cr
-00016e60: 6561 7465 7320 6765 6f6d 6574 7269 6573  eates geometries
-00016e70: 206f 6620 7465 7874 0a0a 2020 2020 5061   of text..    Pa
-00016e80: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
-00016e90: 2d2d 2d2d 2d2d 2d0a 2020 2020 7465 7874  -------.    text
-00016ea0: 203a 2073 7472 0a20 2020 2020 2020 2054   : str.        T
-00016eb0: 6578 7420 7374 7269 6e67 2074 6f20 6265  ext string to be
-00016ec0: 2077 7269 7474 656e 2e0a 2020 2020 7369   written..    si
-00016ed0: 7a65 203a 2069 6e74 206f 7220 666c 6f61  ze : int or floa
-00016ee0: 740a 2020 2020 2020 2020 5369 7a65 206f  t.        Size o
-00016ef0: 6620 7468 6520 7465 7874 0a20 2020 206a  f the text.    j
-00016f00: 7573 7469 6679 203a 207b 276c 6566 7427  ustify : {'left'
-00016f10: 2c20 2772 6967 6874 272c 2027 6365 6e74  , 'right', 'cent
-00016f20: 6572 277d 0a20 2020 2020 2020 204a 7573  er'}.        Jus
-00016f30: 7469 6669 6361 7469 6f6e 206f 6620 7468  tification of th
-00016f40: 6520 7465 7874 2e0a 2020 2020 6c61 7965  e text..    laye
-00016f50: 7220 3a20 696e 742c 2061 7272 6179 2d6c  r : int, array-l
-00016f60: 696b 655b 325d 2c20 6f72 2073 6574 0a20  ike[2], or set. 
-00016f70: 2020 2020 2020 2053 7065 6369 6669 6320         Specific 
-00016f80: 6c61 7965 7228 7329 2074 6f20 7075 7420  layer(s) to put 
-00016f90: 706f 6c79 676f 6e20 6765 6f6d 6574 7279  polygon geometry
-00016fa0: 206f 6e2e 0a20 2020 2066 6f6e 743a 2073   on..    font: s
-00016fb0: 7472 0a20 2020 2020 2020 2046 6f6e 7420  tr.        Font 
-00016fc0: 6661 6365 2074 6f20 7573 652e 2044 6566  face to use. Def
-00016fd0: 6175 6c74 2044 4550 4c4f 4620 646f 6573  ault DEPLOF does
-00016fe0: 206e 6f74 2072 6571 7569 7265 2061 6464   not require add
-00016ff0: 6974 696f 6e61 6c20 6c69 6272 6172 6965  itional librarie
-00017000: 732c 206f 7468 6572 7769 7365 0a20 2020  s, otherwise.   
-00017010: 2020 2020 2066 7265 6574 7970 6520 7769       freetype wi
-00017020: 6c6c 2062 6520 7573 6564 2074 6f20 6c6f  ll be used to lo
-00017030: 6164 2066 6f6e 7473 2e20 466f 6e74 2063  ad fonts. Font c
-00017040: 616e 2062 6520 6769 7665 6e20 6569 7468  an be given eith
-00017050: 6572 2062 7920 6e61 6d65 2028 652e 672e  er by name (e.g.
-00017060: 2022 5469 6d65 7320 4e65 7720 526f 6d61   "Times New Roma
-00017070: 6e22 292c 0a20 2020 2020 2020 206f 7220  n"),.        or 
-00017080: 6279 2066 696c 6520 7061 7468 2e20 4f54  by file path. OT
-00017090: 4620 6f72 2054 5446 2066 6f6e 7473 2061  F or TTF fonts a
-000170a0: 7265 2073 7570 706f 7274 6564 2e0a 0a20  re supported... 
-000170b0: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
-000170c0: 2d2d 2d2d 2d2d 0a20 2020 2074 203a 2044  ------.    t : D
-000170d0: 6576 6963 650a 2020 2020 2020 2020 4120  evice.        A 
-000170e0: 4465 7669 6365 2063 6f6e 7461 696e 696e  Device containin
-000170f0: 6720 7468 6520 7465 7874 2067 656f 6d65  g the text geome
-00017100: 7472 792e 0a20 2020 2022 2222 0a20 2020  try..    """.   
-00017110: 2074 203d 2044 6576 6963 6528 2274 6578   t = Device("tex
-00017120: 7422 290a 2020 2020 786f 6666 7365 7420  t").    xoffset 
-00017130: 3d20 300a 2020 2020 796f 6666 7365 7420  = 0.    yoffset 
-00017140: 3d20 300a 0a20 2020 2066 6163 6520 3d20  = 0..    face = 
-00017150: 666f 6e74 0a20 2020 2069 6620 6661 6365  font.    if face
-00017160: 203d 3d20 2244 4550 4c4f 4622 3a0a 2020   == "DEPLOF":.  
-00017170: 2020 2020 2020 7363 616c 696e 6720 3d20        scaling = 
-00017180: 7369 7a65 202f 2031 3030 300a 0a20 2020  size / 1000..   
-00017190: 2020 2020 2066 6f72 206c 696e 6520 696e       for line in
-000171a0: 2074 6578 742e 7370 6c69 7428 225c 6e22   text.split("\n"
-000171b0: 293a 0a20 2020 2020 2020 2020 2020 206c  ):.            l
-000171c0: 203d 2044 6576 6963 6528 6e61 6d65 3d22   = Device(name="
-000171d0: 7465 7874 6c69 6e65 2229 0a20 2020 2020  textline").     
-000171e0: 2020 2020 2020 2066 6f72 2063 2069 6e20         for c in 
-000171f0: 6c69 6e65 3a0a 2020 2020 2020 2020 2020  line:.          
-00017200: 2020 2020 2020 6173 6369 695f 7661 6c20        ascii_val 
-00017210: 3d20 6f72 6428 6329 0a20 2020 2020 2020  = ord(c).       
-00017220: 2020 2020 2020 2020 2069 6620 6320 3d3d           if c ==
-00017230: 2022 2022 3a0a 2020 2020 2020 2020 2020   " ":.          
-00017240: 2020 2020 2020 2020 2020 786f 6666 7365            xoffse
-00017250: 7420 2b3d 2035 3030 202a 2073 6361 6c69  t += 500 * scali
-00017260: 6e67 0a20 2020 2020 2020 2020 2020 2020  ng.             
-00017270: 2020 2065 6c69 6620 2833 3320 3c3d 2061     elif (33 <= a
-00017280: 7363 6969 5f76 616c 203c 3d20 3132 3629  scii_val <= 126)
-00017290: 206f 7220 2861 7363 6969 5f76 616c 203d   or (ascii_val =
-000172a0: 3d20 3138 3129 3a0a 2020 2020 2020 2020  = 181):.        
-000172b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000172c0: 706f 6c79 2069 6e20 5f67 6c79 7068 5b61  poly in _glyph[a
-000172d0: 7363 6969 5f76 616c 5d3a 0a20 2020 2020  scii_val]:.     
-000172e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000172f0: 2020 2078 7074 7320 3d20 6e70 2e61 7272     xpts = np.arr
-00017300: 6179 2870 6f6c 7929 5b3a 2c20 305d 202a  ay(poly)[:, 0] *
-00017310: 2073 6361 6c69 6e67 0a20 2020 2020 2020   scaling.       
-00017320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017330: 2079 7074 7320 3d20 6e70 2e61 7272 6179   ypts = np.array
-00017340: 2870 6f6c 7929 5b3a 2c20 315d 202a 2073  (poly)[:, 1] * s
-00017350: 6361 6c69 6e67 0a20 2020 2020 2020 2020  caling.         
-00017360: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00017370: 2e61 6464 5f70 6f6c 7967 6f6e 285b 7870  .add_polygon([xp
-00017380: 7473 202b 2078 6f66 6673 6574 2c20 7970  ts + xoffset, yp
-00017390: 7473 202b 2079 6f66 6673 6574 5d2c 206c  ts + yoffset], l
-000173a0: 6179 6572 3d6c 6179 6572 290a 2020 2020  ayer=layer).    
-000173b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173c0: 786f 6666 7365 7420 2b3d 2028 5f77 6964  xoffset += (_wid
-000173d0: 7468 5b61 7363 6969 5f76 616c 5d20 2b20  th[ascii_val] + 
-000173e0: 5f69 6e64 656e 745b 6173 6369 695f 7661  _indent[ascii_va
-000173f0: 6c5d 2920 2a20 7363 616c 696e 670a 2020  l]) * scaling.  
-00017400: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00017410: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00017420: 2020 2020 2020 2020 7661 6c69 645f 6368          valid_ch
-00017430: 6172 7320 3d20 2221 5c22 2324 2526 2728  ars = "!\"#$%&'(
-00017440: 292a 2b2c 2d2e 2f30 3132 3334 3536 3738  )*+,-./012345678
-00017450: 393a 3b3c 3d3e 3f40 4142 4344 4546 4748  9:;<=>?@ABCDEFGH
-00017460: 494a 4b4c 4d4e 4f50 5152 5354 5556 5758  IJKLMNOPQRSTUVWX
-00017470: 595a 5b5c 5c5d 5e5f 6061 6263 6465 6667  YZ[\\]^_`abcdefg
-00017480: 6869 6a6b 6c6d 6e6f 7071 7273 7475 7677  hijklmnopqrstuvw
-00017490: 7879 7a7b 7c7d 7ec2 b522 0a20 2020 2020  xyz{|}~..".     
-000174a0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-000174b0: 6172 6e69 6e67 732e 7761 726e 280a 2020  arnings.warn(.  
-000174c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174d0: 2020 2020 2020 275b 5048 4944 4c5d 2074        '[PHIDL] t
-000174e0: 6578 7428 293a 2057 6172 6e69 6e67 2c20  ext(): Warning, 
-000174f0: 736f 6d65 2063 6861 7261 6374 6572 7320  some characters 
-00017500: 6967 6e6f 7265 642c 206e 6f20 6765 6f6d  ignored, no geom
-00017510: 6574 7279 2066 6f72 2063 6861 7261 6374  etry for charact
-00017520: 6572 2022 2573 2220 7769 7468 2061 7363  er "%s" with asc
-00017530: 6969 2076 616c 7565 2025 732e 2027 0a20  ii value %s. '. 
-00017540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017550: 2020 2020 2020 2022 5661 6c69 6420 6368         "Valid ch
-00017560: 6172 6163 7465 7273 3a20 2573 220a 2020  aracters: %s".  
-00017570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017580: 2020 2020 2020 2520 2863 6872 2861 7363        % (chr(asc
-00017590: 6969 5f76 616c 292c 2061 7363 6969 5f76  ii_val), ascii_v
-000175a0: 616c 2c20 7661 6c69 645f 6368 6172 7329  al, valid_chars)
-000175b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000175c0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-000175d0: 2020 2074 2e61 6464 5f72 6566 286c 290a     t.add_ref(l).
-000175e0: 2020 2020 2020 2020 2020 2020 796f 6666              yoff
-000175f0: 7365 7420 2d3d 2031 3530 3020 2a20 7363  set -= 1500 * sc
-00017600: 616c 696e 670a 2020 2020 2020 2020 2020  aling.          
-00017610: 2020 786f 6666 7365 7420 3d20 300a 2020    xoffset = 0.  
-00017620: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00017630: 6672 6f6d 202e 666f 6e74 2069 6d70 6f72  from .font impor
-00017640: 7420 5f67 6574 5f66 6f6e 745f 6279 5f66  t _get_font_by_f
-00017650: 696c 652c 205f 6765 745f 666f 6e74 5f62  ile, _get_font_b
-00017660: 795f 6e61 6d65 2c20 5f67 6574 5f67 6c79  y_name, _get_gly
-00017670: 7068 0a0a 2020 2020 2020 2020 2320 4c6f  ph..        # Lo
-00017680: 6164 2074 6865 2066 6f6e 740a 2020 2020  ad the font.    
-00017690: 2020 2020 2320 4966 2077 6527 7665 2070      # If we've p
-000176a0: 6173 7365 6420 6120 7661 6c69 6420 6669  assed a valid fi
-000176b0: 6c65 2c20 7472 7920 746f 206c 6f61 6420  le, try to load 
-000176c0: 7468 6174 2c20 6f74 6865 7277 6973 6520  that, otherwise 
-000176d0: 7365 6172 6368 2073 7973 7465 6d20 666f  search system fo
-000176e0: 6e74 730a 2020 2020 2020 2020 666f 6e74  nts.        font
-000176f0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00017700: 6966 2028 6661 6365 2e65 6e64 7377 6974  if (face.endswit
-00017710: 6828 222e 6f74 6622 2920 6f72 2066 6163  h(".otf") or fac
-00017720: 652e 656e 6473 7769 7468 2822 2e74 7466  e.endswith(".ttf
-00017730: 2229 2920 616e 6420 6f73 2e70 6174 682e  ")) and os.path.
-00017740: 6578 6973 7473 2866 6163 6529 3a0a 2020  exists(face):.  
-00017750: 2020 2020 2020 2020 2020 666f 6e74 203d            font =
-00017760: 205f 6765 745f 666f 6e74 5f62 795f 6669   _get_font_by_fi
-00017770: 6c65 2866 6163 6529 0a20 2020 2020 2020  le(face).       
-00017780: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00017790: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-000177a0: 2020 2020 2020 2020 666f 6e74 203d 205f          font = _
-000177b0: 6765 745f 666f 6e74 5f62 795f 6e61 6d65  get_font_by_name
-000177c0: 2866 6163 6529 0a20 2020 2020 2020 2020  (face).         
-000177d0: 2020 2065 7863 6570 7420 5661 6c75 6545     except ValueE
-000177e0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-000177f0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
-00017800: 2020 2069 6620 666f 6e74 2069 7320 4e6f     if font is No
-00017810: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00017820: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00017830: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00017840: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
-00017850: 2020 2020 2020 2020 275b 5048 4944 4c5d          '[PHIDL]
-00017860: 2046 6169 6c65 6420 746f 2066 696e 6420   Failed to find 
-00017870: 666f 6e74 3a20 2225 7322 2e20 270a 2020  font: "%s". '.  
-00017880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017890: 2020 2b20 2254 7279 2073 7065 6369 6679    + "Try specify
-000178a0: 696e 6720 7468 6520 6578 6163 7420 2866  ing the exact (f
-000178b0: 756c 6c29 2070 6174 6820 746f 2074 6865  ull) path to the
-000178c0: 202e 7474 6620 6f72 202e 6f74 6620 6669   .ttf or .otf fi
-000178d0: 6c65 2e20 220a 2020 2020 2020 2020 2020  le. ".          
-000178e0: 2020 2020 2020 2020 2020 2b20 224f 7468            + "Oth
-000178f0: 6572 7769 7365 2c20 6974 206d 6967 6874  erwise, it might
-00017900: 2062 6520 7265 736f 6c76 6564 2062 7920   be resolved by 
-00017910: 7265 6275 696c 6469 6e67 2074 6865 206d  rebuilding the m
-00017920: 6174 706c 6f74 6c69 6220 666f 6e74 2063  atplotlib font c
-00017930: 6163 6865 220a 2020 2020 2020 2020 2020  ache".          
-00017940: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00017950: 2020 2020 2020 2020 2520 2866 6163 6529          % (face)
-00017960: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00017970: 2020 2020 2020 2020 2320 5265 6e64 6572          # Render
-00017980: 2065 6163 6820 6368 6172 6163 7465 720a   each character.
-00017990: 2020 2020 2020 2020 666f 7220 6c69 6e65          for line
-000179a0: 2069 6e20 7465 7874 2e73 706c 6974 2822   in text.split("
-000179b0: 5c6e 2229 3a0a 2020 2020 2020 2020 2020  \n"):.          
-000179c0: 2020 6c20 3d20 4465 7669 6365 2822 7465    l = Device("te
-000179d0: 7874 6c69 6e65 2229 0a20 2020 2020 2020  xtline").       
-000179e0: 2020 2020 2078 6f66 6673 6574 203d 2030       xoffset = 0
-000179f0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00017a00: 206c 6574 7465 7220 696e 206c 696e 653a   letter in line:
-00017a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017a20: 206c 6574 7465 725f 6465 7620 3d20 4465   letter_dev = De
-00017a30: 7669 6365 2822 6c65 7474 6572 2229 0a20  vice("letter"). 
-00017a40: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00017a50: 6574 7465 725f 7465 6d70 6c61 7465 2c20  etter_template, 
-00017a60: 6164 7661 6e63 655f 7820 3d20 5f67 6574  advance_x = _get
-00017a70: 5f67 6c79 7068 2866 6f6e 742c 206c 6574  _glyph(font, let
-00017a80: 7465 7229 0a20 2020 2020 2020 2020 2020  ter).           
-00017a90: 2020 2020 2066 6f72 2070 6f6c 7920 696e       for poly in
-00017aa0: 206c 6574 7465 725f 7465 6d70 6c61 7465   letter_template
-00017ab0: 2e70 6f6c 7967 6f6e 733a 0a20 2020 2020  .polygons:.     
-00017ac0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00017ad0: 6574 7465 725f 6465 762e 6164 645f 706f  etter_dev.add_po
-00017ae0: 6c79 676f 6e28 706f 6c79 2e70 6f6c 7967  lygon(poly.polyg
-00017af0: 6f6e 732c 206c 6179 6572 3d6c 6179 6572  ons, layer=layer
-00017b00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00017b10: 2020 7265 6620 3d20 6c2e 6164 645f 7265    ref = l.add_re
-00017b20: 6628 6c65 7474 6572 5f64 6576 290a 2020  f(letter_dev).  
-00017b30: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00017b40: 662e 6d6f 7665 2864 6573 7469 6e61 7469  f.move(destinati
-00017b50: 6f6e 3d28 786f 6666 7365 742c 2030 2929  on=(xoffset, 0))
-00017b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017b70: 2072 6566 2e6d 6167 6e69 6669 6361 7469   ref.magnificati
-00017b80: 6f6e 203d 2073 697a 650a 2020 2020 2020  on = size.      
-00017b90: 2020 2020 2020 2020 2020 786f 6666 7365            xoffse
-00017ba0: 7420 2b3d 2073 697a 6520 2a20 6164 7661  t += size * adva
-00017bb0: 6e63 655f 780a 0a20 2020 2020 2020 2020  nce_x..         
-00017bc0: 2020 2072 6566 203d 2074 2e61 6464 5f72     ref = t.add_r
-00017bd0: 6566 286c 290a 2020 2020 2020 2020 2020  ef(l).          
-00017be0: 2020 7265 662e 6d6f 7665 2864 6573 7469    ref.move(desti
-00017bf0: 6e61 7469 6f6e 3d28 302c 2079 6f66 6673  nation=(0, yoffs
-00017c00: 6574 2929 0a20 2020 2020 2020 2020 2020  et)).           
-00017c10: 2079 6f66 6673 6574 202d 3d20 7369 7a65   yoffset -= size
-00017c20: 0a0a 2020 2020 6a75 7374 6966 7920 3d20  ..    justify = 
-00017c30: 6a75 7374 6966 792e 6c6f 7765 7228 290a  justify.lower().
-00017c40: 2020 2020 666f 7220 6c20 696e 2074 2e72      for l in t.r
-00017c50: 6566 6572 656e 6365 733a 0a20 2020 2020  eferences:.     
-00017c60: 2020 2069 6620 6a75 7374 6966 7920 3d3d     if justify ==
-00017c70: 2022 6c65 6674 223a 0a20 2020 2020 2020   "left":.       
-00017c80: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-00017c90: 2020 6966 206a 7573 7469 6679 203d 3d20    if justify == 
-00017ca0: 2272 6967 6874 223a 0a20 2020 2020 2020  "right":.       
-00017cb0: 2020 2020 206c 2e78 6d61 7820 3d20 300a       l.xmax = 0.
-00017cc0: 2020 2020 2020 2020 6966 206a 7573 7469          if justi
-00017cd0: 6679 203d 3d20 2263 656e 7465 7222 3a0a  fy == "center":.
-00017ce0: 2020 2020 2020 2020 2020 2020 6c2e 6d6f              l.mo
-00017cf0: 7665 286f 7269 6769 6e3d 6c2e 6365 6e74  ve(origin=l.cent
-00017d00: 6572 2c20 6465 7374 696e 6174 696f 6e3d  er, destination=
-00017d10: 2830 2c20 3029 2c20 6178 6973 3d22 7822  (0, 0), axis="x"
-00017d20: 290a 0a20 2020 2074 2e66 6c61 7474 656e  )..    t.flatten
-00017d30: 2829 0a20 2020 2072 6574 7572 6e20 740a  ().    return t.
-00017d40: 0a0a 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ..# ============
-00017d50: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017d60: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017d70: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017d80: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017d90: 3d3d 0a23 2045 7861 6d70 6c65 2063 6f64  ==.# Example cod
-00017da0: 650a 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  e.# ============
-00017db0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017dc0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017dd0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017de0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017df0: 3d3d 0a0a 2320 4420 3d20 7465 7874 2827  ==..# D = text('
-00017e00: 7468 6520 7175 6963 6b20 6272 6f77 6e5c  the quick brown\
-00017e10: 6e20 666f 7820 6a75 6d70 6564 206f 7665  n fox jumped ove
-00017e20: 725c 6e74 6865 206c 617a 7920 646f 6727  r\nthe lazy dog'
-00017e30: 2c20 6a75 7374 6966 7920 3d20 2763 656e  , justify = 'cen
-00017e40: 7465 7227 2c20 7369 7a65 203d 2038 3030  ter', size = 800
-00017e50: 290a 2320 7175 6963 6b70 6c6f 7428 4429  ).# quickplot(D)
-00017e60: 0a0a 0a23 203d 3d3d 3d3d 3d3d 3d3d 3d3d  ...# ===========
-00017e70: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017e80: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017e90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017ea0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017eb0: 3d3d 3d0a 230a 2320 5761 6665 7220 616e  ===.#.# Wafer an
-00017ec0: 6420 6469 650a 230a 2320 3d3d 3d3d 3d3d  d die.#.# ======
-00017ed0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017ee0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017ef0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017f00: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017f10: 3d3d 3d3d 3d3d 3d3d 0a0a 0a64 6566 2062  ========...def b
-00017f20: 6173 6963 5f64 6965 280a 2020 2020 7369  asic_die(.    si
-00017f30: 7a65 3d28 3130 3030 302c 2031 3030 3030  ze=(10000, 10000
-00017f40: 292c 0a20 2020 2073 7472 6565 745f 7769  ),.    street_wi
-00017f50: 6474 683d 3130 302c 0a20 2020 2073 7472  dth=100,.    str
-00017f60: 6565 745f 6c65 6e67 7468 3d31 3030 302c  eet_length=1000,
-00017f70: 0a20 2020 2064 6965 5f6e 616d 653d 2263  .    die_name="c
-00017f80: 6869 7039 3922 2c0a 2020 2020 7465 7874  hip99",.    text
-00017f90: 5f73 697a 653d 3130 302c 0a20 2020 2074  _size=100,.    t
-00017fa0: 6578 745f 6c6f 6361 7469 6f6e 3d22 5357  ext_location="SW
-00017fb0: 222c 0a20 2020 206c 6179 6572 3d30 2c0a  ",.    layer=0,.
-00017fc0: 2020 2020 6472 6177 5f62 626f 783d 5472      draw_bbox=Tr
-00017fd0: 7565 2c0a 2020 2020 6262 6f78 5f6c 6179  ue,.    bbox_lay
-00017fe0: 6572 3d39 392c 0a29 3a0a 2020 2020 2222  er=99,.):.    ""
-00017ff0: 2243 7265 6174 6573 2061 2062 6173 6963  "Creates a basic
-00018000: 2063 6869 702f 6469 6520 7465 6d70 6c61   chip/die templa
-00018010: 7465 2c20 7769 7468 2034 2072 6967 6874  te, with 4 right
-00018020: 2061 6e67 6c65 2063 6f72 6e65 7273 206d   angle corners m
-00018030: 6172 6b69 6e67 0a20 2020 2074 6865 2062  arking.    the b
-00018040: 6f75 6e64 6172 7920 6f66 2074 6865 2063  oundary of the c
-00018050: 6869 702f 6469 6520 616e 6420 6120 6c61  hip/die and a la
-00018060: 6265 6c20 7769 7468 2074 6865 206e 616d  bel with the nam
-00018070: 6520 6f66 2074 6865 2064 6965 2e0a 0a20  e of the die... 
-00018080: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00018090: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-000180a0: 2073 697a 6520 3a20 6172 7261 795f 6c69   size : array_li
-000180b0: 6b65 5b32 5d20 6f66 2069 6e74 206f 7220  ke[2] of int or 
-000180c0: 666c 6f61 740a 2020 2020 2020 2020 782c  float.        x,
-000180d0: 2079 2064 696d 656e 7369 6f6e 7320 6f66   y dimensions of
-000180e0: 2074 6865 2064 6965 2e0a 2020 2020 7374   the die..    st
-000180f0: 7265 6574 5f77 6964 7468 203a 2069 6e74  reet_width : int
-00018100: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
-00018110: 2020 5769 6474 6820 6f66 2074 6865 2063    Width of the c
-00018120: 6f72 6e65 7220 6d61 726b 7320 666f 7220  orner marks for 
-00018130: 6469 652d 7361 7769 6e67 2e0a 2020 2020  die-sawing..    
-00018140: 7374 7265 6574 5f6c 656e 6774 6820 3a20  street_length : 
-00018150: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
-00018160: 2020 2020 204c 656e 6774 6820 6f66 2074       Length of t
-00018170: 6865 2063 6f72 6e65 7220 6d61 726b 7320  he corner marks 
-00018180: 666f 7220 6469 652d 7361 7769 6e67 2e0a  for die-sawing..
-00018190: 2020 2020 6469 655f 6e61 6d65 203a 2073      die_name : s
-000181a0: 7472 0a20 2020 2020 2020 204c 6162 656c  tr.        Label
-000181b0: 2074 6578 742e 0a20 2020 2074 6578 745f   text..    text_
-000181c0: 7369 7a65 203a 2069 6e74 206f 7220 666c  size : int or fl
-000181d0: 6f61 740a 2020 2020 2020 2020 4c61 6265  oat.        Labe
-000181e0: 6c20 7465 7874 2073 697a 652e 0a20 2020  l text size..   
-000181f0: 2074 6578 745f 6c6f 6361 7469 6f6e 203a   text_location :
-00018200: 207b 274e 5727 2c20 274e 272c 2027 4e45   {'NW', 'N', 'NE
-00018210: 272c 2027 5357 272c 2027 5327 2c20 2753  ', 'SW', 'S', 'S
-00018220: 4527 7d0a 2020 2020 2020 2020 4c61 6265  E'}.        Labe
-00018230: 6c20 7465 7874 2063 6f6d 7061 7373 206c  l text compass l
-00018240: 6f63 6174 696f 6e2e 0a20 2020 206c 6179  ocation..    lay
-00018250: 6572 203a 2069 6e74 0a20 2020 2020 2020  er : int.       
-00018260: 2053 7065 6369 6669 6320 6c61 7965 7228   Specific layer(
-00018270: 7329 2074 6f20 7075 7420 706f 6c79 676f  s) to put polygo
-00018280: 6e20 6765 6f6d 6574 7279 206f 6e2e 0a20  n geometry on.. 
-00018290: 2020 2064 7261 775f 6262 6f78 203a 2062     draw_bbox : b
-000182a0: 6f6f 6c0a 2020 2020 2020 2020 4966 2074  ool.        If t
-000182b0: 7275 652c 2064 7261 776e 7320 6120 6262  rue, drawns a bb
-000182c0: 6f78 2061 726f 756e 6420 7468 6520 6368  ox around the ch
-000182d0: 6970 2064 6965 2067 656f 6d65 7472 792e  ip die geometry.
-000182e0: 0a20 2020 2062 626f 785f 6c61 7965 7220  .    bbox_layer 
-000182f0: 3a20 696e 740a 2020 2020 2020 2020 4c61  : int.        La
-00018300: 7965 7220 6f6e 2077 6869 6368 2062 626f  yer on which bbo
-00018310: 7820 6973 2070 6c61 6365 6420 6966 2060  x is placed if `
-00018320: 6064 7261 775f 6262 6f78 6060 2069 7320  `draw_bbox`` is 
-00018330: 7472 7565 2e0a 0a20 2020 2052 6574 7572  true...    Retur
-00018340: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
-00018350: 2020 2044 203a 2044 6576 6963 650a 2020     D : Device.  
-00018360: 2020 2020 2020 4120 4465 7669 6365 2063        A Device c
-00018370: 6f6e 7461 696e 696e 6720 6120 6261 7369  ontaining a basi
-00018380: 6320 6469 6520 6765 6f6d 6574 7279 2e0a  c die geometry..
-00018390: 2020 2020 2222 220a 2020 2020 4420 3d20      """.    D = 
-000183a0: 4465 7669 6365 286e 616d 653d 2264 6965  Device(name="die
-000183b0: 2229 0a20 2020 2073 782c 2073 7920 3d20  ").    sx, sy = 
-000183c0: 7369 7a65 5b30 5d20 2f20 322c 2073 697a  size[0] / 2, siz
-000183d0: 655b 315d 202f 2032 0a20 2020 2078 7074  e[1] / 2.    xpt
-000183e0: 7320 3d20 6e70 2e61 7272 6179 280a 2020  s = np.array(.  
-000183f0: 2020 2020 2020 5b0a 2020 2020 2020 2020        [.        
-00018400: 2020 2020 7378 2c0a 2020 2020 2020 2020      sx,.        
-00018410: 2020 2020 7378 2c0a 2020 2020 2020 2020      sx,.        
-00018420: 2020 2020 7378 202d 2073 7472 6565 745f      sx - street_
-00018430: 7769 6474 682c 0a20 2020 2020 2020 2020  width,.         
-00018440: 2020 2073 7820 2d20 7374 7265 6574 5f77     sx - street_w
-00018450: 6964 7468 2c0a 2020 2020 2020 2020 2020  idth,.          
-00018460: 2020 7378 202d 2073 7472 6565 745f 6c65    sx - street_le
-00018470: 6e67 7468 2c0a 2020 2020 2020 2020 2020  ngth,.          
-00018480: 2020 7378 202d 2073 7472 6565 745f 6c65    sx - street_le
-00018490: 6e67 7468 2c0a 2020 2020 2020 2020 5d0a  ngth,.        ].
-000184a0: 2020 2020 290a 2020 2020 7970 7473 203d      ).    ypts =
-000184b0: 206e 702e 6172 7261 7928 0a20 2020 2020   np.array(.     
-000184c0: 2020 205b 0a20 2020 2020 2020 2020 2020     [.           
-000184d0: 2073 792c 0a20 2020 2020 2020 2020 2020   sy,.           
-000184e0: 2073 7920 2d20 7374 7265 6574 5f6c 656e   sy - street_len
-000184f0: 6774 682c 0a20 2020 2020 2020 2020 2020  gth,.           
-00018500: 2073 7920 2d20 7374 7265 6574 5f6c 656e   sy - street_len
-00018510: 6774 682c 0a20 2020 2020 2020 2020 2020  gth,.           
-00018520: 2073 7920 2d20 7374 7265 6574 5f77 6964   sy - street_wid
-00018530: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
-00018540: 7379 202d 2073 7472 6565 745f 7769 6474  sy - street_widt
-00018550: 682c 0a20 2020 2020 2020 2020 2020 2073  h,.            s
-00018560: 792c 0a20 2020 2020 2020 205d 0a20 2020  y,.        ].   
-00018570: 2029 0a20 2020 2044 2e61 6464 5f70 6f6c   ).    D.add_pol
-00018580: 7967 6f6e 285b 7870 7473 2c20 7970 7473  ygon([xpts, ypts
-00018590: 5d2c 206c 6179 6572 3d6c 6179 6572 290a  ], layer=layer).
-000185a0: 2020 2020 442e 6164 645f 706f 6c79 676f      D.add_polygo
-000185b0: 6e28 5b2d 7870 7473 2c20 7970 7473 5d2c  n([-xpts, ypts],
-000185c0: 206c 6179 6572 3d6c 6179 6572 290a 2020   layer=layer).  
-000185d0: 2020 442e 6164 645f 706f 6c79 676f 6e28    D.add_polygon(
-000185e0: 5b78 7074 732c 202d 7970 7473 5d2c 206c  [xpts, -ypts], l
-000185f0: 6179 6572 3d6c 6179 6572 290a 2020 2020  ayer=layer).    
-00018600: 442e 6164 645f 706f 6c79 676f 6e28 5b2d  D.add_polygon([-
-00018610: 7870 7473 2c20 2d79 7074 735d 2c20 6c61  xpts, -ypts], la
-00018620: 7965 723d 6c61 7965 7229 0a0a 2020 2020  yer=layer)..    
-00018630: 6966 2064 7261 775f 6262 6f78 2069 7320  if draw_bbox is 
-00018640: 5472 7565 3a0a 2020 2020 2020 2020 442e  True:.        D.
-00018650: 6164 645f 706f 6c79 676f 6e28 5b5b 7378  add_polygon([[sx
-00018660: 2c20 7379 5d2c 205b 7378 2c20 2d73 795d  , sy], [sx, -sy]
-00018670: 2c20 5b2d 7378 2c20 2d73 795d 2c20 5b2d  , [-sx, -sy], [-
-00018680: 7378 2c20 7379 5d5d 2c20 6c61 7965 723d  sx, sy]], layer=
-00018690: 6262 6f78 5f6c 6179 6572 290a 2020 2020  bbox_layer).    
-000186a0: 442e 6365 6e74 6572 203d 2028 302c 2030  D.center = (0, 0
-000186b0: 290a 2020 2020 7420 3d20 442e 6164 645f  ).    t = D.add_
-000186c0: 7265 6628 7465 7874 2874 6578 743d 6469  ref(text(text=di
-000186d0: 655f 6e61 6d65 2c20 7369 7a65 3d74 6578  e_name, size=tex
-000186e0: 745f 7369 7a65 2c20 6c61 7965 723d 6c61  t_size, layer=la
-000186f0: 7965 7229 290a 0a20 2020 2064 203d 2073  yer))..    d = s
-00018700: 7472 6565 745f 7769 6474 6820 2b20 3230  treet_width + 20
-00018710: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-00018720: 6365 2874 6578 745f 6c6f 6361 7469 6f6e  ce(text_location
-00018730: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
-00018740: 7465 7874 5f6c 6f63 6174 696f 6e20 3d20  text_location = 
-00018750: 7465 7874 5f6c 6f63 6174 696f 6e2e 7570  text_location.up
-00018760: 7065 7228 290a 2020 2020 2020 2020 6966  per().        if
-00018770: 2074 6578 745f 6c6f 6361 7469 6f6e 203d   text_location =
-00018780: 3d20 224e 5722 3a0a 2020 2020 2020 2020  = "NW":.        
-00018790: 2020 2020 742e 786d 696e 2c20 742e 796d      t.xmin, t.ym
-000187a0: 6178 203d 205b 2d73 7820 2b20 642c 2073  ax = [-sx + d, s
-000187b0: 7920 2d20 645d 0a20 2020 2020 2020 2065  y - d].        e
-000187c0: 6c69 6620 7465 7874 5f6c 6f63 6174 696f  lif text_locatio
-000187d0: 6e20 3d3d 2022 4e22 3a0a 2020 2020 2020  n == "N":.      
-000187e0: 2020 2020 2020 742e 782c 2074 2e79 6d61        t.x, t.yma
-000187f0: 7820 3d20 5b30 2c20 7379 202d 2064 5d0a  x = [0, sy - d].
-00018800: 2020 2020 2020 2020 656c 6966 2074 6578          elif tex
-00018810: 745f 6c6f 6361 7469 6f6e 203d 3d20 224e  t_location == "N
-00018820: 4522 3a0a 2020 2020 2020 2020 2020 2020  E":.            
-00018830: 742e 786d 6178 2c20 742e 796d 6178 203d  t.xmax, t.ymax =
-00018840: 205b 7378 202d 2064 2c20 7379 202d 2064   [sx - d, sy - d
-00018850: 5d0a 2020 2020 2020 2020 6966 2074 6578  ].        if tex
-00018860: 745f 6c6f 6361 7469 6f6e 203d 3d20 2253  t_location == "S
-00018870: 5722 3a0a 2020 2020 2020 2020 2020 2020  W":.            
-00018880: 742e 786d 696e 2c20 742e 796d 696e 203d  t.xmin, t.ymin =
-00018890: 205b 2d73 7820 2b20 642c 202d 7379 202b   [-sx + d, -sy +
-000188a0: 2064 5d0a 2020 2020 2020 2020 656c 6966   d].        elif
-000188b0: 2074 6578 745f 6c6f 6361 7469 6f6e 203d   text_location =
-000188c0: 3d20 2253 223a 0a20 2020 2020 2020 2020  = "S":.         
-000188d0: 2020 2074 2e78 2c20 742e 796d 696e 203d     t.x, t.ymin =
-000188e0: 205b 302c 202d 7379 202b 2064 5d0a 2020   [0, -sy + d].  
-000188f0: 2020 2020 2020 656c 6966 2074 6578 745f        elif text_
-00018900: 6c6f 6361 7469 6f6e 203d 3d20 2253 4522  location == "SE"
-00018910: 3a0a 2020 2020 2020 2020 2020 2020 742e  :.            t.
-00018920: 786d 6178 2c20 742e 796d 696e 203d 205b  xmax, t.ymin = [
-00018930: 7378 202d 2064 2c20 2d73 7920 2b20 645d  sx - d, -sy + d]
-00018940: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00018950: 2020 2074 2e78 2c20 742e 7920 3d20 7465     t.x, t.y = te
-00018960: 7874 5f6c 6f63 6174 696f 6e0a 0a20 2020  xt_location..   
-00018970: 2072 6574 7572 6e20 440a 0a0a 2320 3d3d   return D...# ==
-00018980: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00018990: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000189a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000189b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000189c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a23 2045  ============.# E
-000189d0: 7861 6d70 6c65 2063 6f64 650a 2320 3d3d  xample code.# ==
-000189e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000189f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00018a00: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00018a10: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00018a20: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a0a 2320  ============..# 
-00018a30: 4420 3d20 6261 7369 635f 6469 6528 7369  D = basic_die(si
-00018a40: 7a65 203d 2028 3130 3030 302c 2031 3030  ze = (10000, 100
-00018a50: 3030 292c 2073 7472 6565 745f 7769 6474  00), street_widt
-00018a60: 6820 3d20 3130 302c 2073 7472 6565 745f  h = 100, street_
-00018a70: 6c65 6e67 7468 203d 2031 3030 302c 0a23  length = 1000,.#
-00018a80: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00018a90: 6965 5f6e 616d 6520 3d20 2763 6869 7039  ie_name = 'chip9
-00018aa0: 3927 2c20 7465 7874 5f73 697a 6520 3d20  9', text_size = 
-00018ab0: 3330 302c 2074 6578 745f 6c6f 6361 7469  300, text_locati
-00018ac0: 6f6e 203d 2027 5357 272c 2020 6c61 7965  on = 'SW',  laye
-00018ad0: 7220 3d20 302c 0a23 2020 2020 2020 2020  r = 0,.#        
-00018ae0: 2020 2020 2020 2064 7261 775f 6262 6f78         draw_bbox
-00018af0: 203d 2054 7275 652c 2020 6262 6f78 5f6c   = True,  bbox_l
-00018b00: 6179 6572 203d 2039 3929 0a23 2071 7569  ayer = 99).# qui
-00018b10: 636b 706c 6f74 2844 290a 0a0a 2320 3d3d  ckplot(D)...# ==
-00018b20: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00018b30: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00018b40: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00018b50: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00018b60: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a23 0a23  ============.#.#
-00018b70: 2057 6176 6567 7569 6465 2063 7572 7665   Waveguide curve
-00018b80: 730a 230a 2320 3d3d 3d3d 3d3d 3d3d 3d3d  s.#.# ==========
-00018b90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00018ba0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00018bb0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00018bc0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00018bd0: 3d3d 3d3d 0a0a 0a64 6566 2072 6163 6574  ====...def racet
-00018be0: 7261 636b 5f67 7261 6475 616c 2877 6964  rack_gradual(wid
-00018bf0: 7468 3d30 2e33 2c20 523d 352c 204e 3d33  th=0.3, R=5, N=3
-00018c00: 2c20 6c61 7965 723d 3029 3a0a 2020 2020  , layer=0):.    
-00018c10: 2222 2243 7265 6174 6573 2061 2067 7261  """Creates a gra
-00018c20: 6475 616c 2072 6163 6574 7261 636b 2062  dual racetrack b
-00018c30: 656e 7420 6765 6f6d 6574 7279 2e0a 0a20  ent geometry... 
-00018c40: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00018c50: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-00018c60: 2077 6964 7468 203a 2069 6e74 206f 7220   width : int or 
-00018c70: 666c 6f61 740a 2020 2020 2020 2020 5769  float.        Wi
-00018c80: 6474 6820 6f66 2074 6865 2074 7261 636b  dth of the track
-00018c90: 2e0a 2020 2020 5220 3a20 696e 7420 6f72  ..    R : int or
-00018ca0: 2066 6c6f 6174 0a20 2020 2020 2020 2052   float.        R
-00018cb0: 6164 6975 7320 6f66 2074 6865 2074 7261  adius of the tra
-00018cc0: 636b 2061 7420 6974 7320 6d6f 7374 2063  ck at its most c
-00018cd0: 7572 7665 6420 706f 696e 742e 0a20 2020  urved point..   
-00018ce0: 204e 203a 2069 6e74 206f 7220 666c 6f61   N : int or floa
-00018cf0: 740a 2020 2020 2020 2020 5261 6469 7573  t.        Radius
-00018d00: 206f 6620 7468 6520 7472 6163 6b20 6174   of the track at
-00018d10: 2069 7473 206c 6561 7374 2063 7572 7665   its least curve
-00018d20: 6420 706f 696e 742e 0a20 2020 206c 6179  d point..    lay
-00018d30: 6572 203a 2069 6e74 2c20 6172 7261 792d  er : int, array-
-00018d40: 6c69 6b65 5b32 5d2c 206f 7220 7365 740a  like[2], or set.
-00018d50: 2020 2020 2020 2020 5370 6563 6966 6963          Specific
-00018d60: 206c 6179 6572 2873 2920 746f 2070 7574   layer(s) to put
-00018d70: 2070 6f6c 7967 6f6e 2067 656f 6d65 7472   polygon geometr
-00018d80: 7920 6f6e 2e0a 0a20 2020 2052 6574 7572  y on...    Retur
-00018d90: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
-00018da0: 2020 2044 203a 2044 6576 6963 650a 2020     D : Device.  
-00018db0: 2020 2020 2020 4120 4465 7669 6365 2063        A Device c
-00018dc0: 6f6e 7461 696e 696e 6720 6120 6772 6164  ontaining a grad
-00018dd0: 7561 6c20 7261 6365 7472 6163 6b20 6265  ual racetrack be
-00018de0: 6e74 2067 656f 6d65 7472 792e 0a20 2020  nt geometry..   
-00018df0: 2022 2222 0a20 2020 2063 7572 7665 5f66   """.    curve_f
-00018e00: 756e 203d 206c 616d 6264 6120 743a 205f  un = lambda t: _
-00018e10: 7261 6365 7472 6163 6b5f 6772 6164 7561  racetrack_gradua
-00018e20: 6c5f 7061 7261 6d65 7472 6963 2874 2c20  l_parametric(t, 
-00018e30: 523d 352c 204e 3d33 290a 2020 2020 726f  R=5, N=3).    ro
-00018e40: 7574 655f 7061 7468 203d 2067 6473 7079  ute_path = gdspy
-00018e50: 2e50 6174 6828 7769 6474 683d 7769 6474  .Path(width=widt
-00018e60: 682c 2069 6e69 7469 616c 5f70 6f69 6e74  h, initial_point
-00018e70: 3d5b 302c 2030 5d29 0a20 2020 2072 6f75  =[0, 0]).    rou
-00018e80: 7465 5f70 6174 682e 7061 7261 6d65 7472  te_path.parametr
-00018e90: 6963 280a 2020 2020 2020 2020 6375 7276  ic(.        curv
-00018ea0: 655f 6675 6e2c 0a20 2020 2020 2020 206e  e_fun,.        n
-00018eb0: 756d 6265 725f 6f66 5f65 7661 6c75 6174  umber_of_evaluat
-00018ec0: 696f 6e73 3d39 392c 0a20 2020 2020 2020  ions=99,.       
-00018ed0: 206d 6178 5f70 6f69 6e74 733d 3430 3030   max_points=4000
-00018ee0: 2c0a 2020 2020 2020 2020 6669 6e61 6c5f  ,.        final_
-00018ef0: 6469 7374 616e 6365 3d4e 6f6e 652c 0a20  distance=None,. 
-00018f00: 2020 2020 2020 206c 6179 6572 3d6c 6179         layer=lay
-00018f10: 6572 2c0a 2020 2020 290a 2020 2020 4420  er,.    ).    D 
-00018f20: 3d20 4465 7669 6365 2822 7261 6365 7472  = Device("racetr
-00018f30: 6163 6b22 290a 2020 2020 442e 6164 6428  ack").    D.add(
-00018f40: 726f 7574 655f 7061 7468 290a 2020 2020  route_path).    
-00018f50: 7265 7475 726e 2044 0a0a 0a64 6566 205f  return D...def _
-00018f60: 7261 6365 7472 6163 6b5f 6772 6164 7561  racetrack_gradua
-00018f70: 6c5f 7061 7261 6d65 7472 6963 2874 2c20  l_parametric(t, 
-00018f80: 522c 204e 293a 0a20 2020 2022 2222 5461  R, N):.    """Ta
-00018f90: 6b65 7320 696e 2061 2070 6172 616d 6574  kes in a paramet
-00018fa0: 7269 6320 7661 6c75 6520 6060 7460 6020  ric value ``t`` 
-00018fb0: 6f6e 2028 302c 3129 2c20 7265 7475 726e  on (0,1), return
-00018fc0: 7320 7468 6520 782c 7920 636f 6f72 6469  s the x,y coordi
-00018fd0: 6e61 7465 730a 2020 2020 6f66 2061 2072  nates.    of a r
-00018fe0: 6163 6574 7261 636b 2062 656e 7420 6163  acetrack bent ac
-00018ff0: 636f 7264 696e 6720 746f 0a20 2020 2032  cording to.    2
-00019000: 3030 3930 3831 305f 454f 5334 5f6d 6f64  0090810_EOS4_mod
-00019010: 756c 6174 6f72 5f64 6573 6967 6e73 5f65  ulator_designs_e
-00019020: 7863 6572 7074 466f 724a 6173 6f6e 4772  xcerptForJasonGr
-00019030: 6164 7561 6c42 656e 6473 2e70 7074 0a0a  adualBends.ppt..
-00019040: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00019050: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00019060: 2020 7420 3a20 6172 7261 792d 6c69 6b65    t : array-like
-00019070: 5b4e 5d0a 2020 2020 2020 2020 5061 7261  [N].        Para
-00019080: 6d65 7472 6963 2076 616c 7565 7320 666f  metric values fo
-00019090: 7220 7468 6520 7261 6365 7472 6163 6b2e  r the racetrack.
-000190a0: 0a20 2020 2052 203a 2069 6e74 206f 7220  .    R : int or 
-000190b0: 666c 6f61 740a 2020 2020 2020 2020 5261  float.        Ra
-000190c0: 6469 7573 206f 6620 7468 6520 7472 6163  dius of the trac
-000190d0: 6b20 6174 2069 7473 206d 6f73 7420 6375  k at its most cu
-000190e0: 7276 6564 2070 6f69 6e74 2e0a 2020 2020  rved point..    
-000190f0: 4e20 3a20 696e 7420 6f72 2066 6c6f 6174  N : int or float
-00019100: 0a20 2020 2020 2020 2052 6164 6975 7320  .        Radius 
-00019110: 6f66 2074 6865 2074 7261 636b 2061 7420  of the track at 
-00019120: 6974 7320 6c65 6173 7420 6375 7276 6564  its least curved
-00019130: 2070 6f69 6e74 2e0a 0a20 2020 2052 6574   point...    Ret
-00019140: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
-00019150: 0a20 2020 2078 203a 2061 7272 6179 2d6c  .    x : array-l
-00019160: 696b 655b 4e5d 0a20 2020 2020 2020 2078  ike[N].        x
-00019170: 2d63 6f6f 7264 696e 6174 6573 206f 6620  -coordinates of 
-00019180: 7468 6520 7261 6365 7472 6163 6b20 6375  the racetrack cu
-00019190: 7276 652e 0a20 2020 2079 203a 2061 7272  rve..    y : arr
-000191a0: 6179 2d6c 696b 655b 4e5d 0a20 2020 2020  ay-like[N].     
-000191b0: 2020 2079 2d63 6f6f 7264 696e 6174 6573     y-coordinates
-000191c0: 206f 6620 7468 6520 7261 6365 7472 6163   of the racetrac
-000191d0: 6b20 6375 7276 652e 0a20 2020 2022 2222  k curve..    """
-000191e0: 0a20 2020 2078 3020 3d20 5220 2f20 3220  .    x0 = R / 2 
-000191f0: 2a2a 2028 3120 2f20 4e29 0a20 2020 2052  ** (1 / N).    R
-00019200: 6d69 6e20 3d20 3220 2a2a 2028 302e 3520  min = 2 ** (0.5 
-00019210: 2d20 3120 2f20 4e29 202f 2028 4e20 2d20  - 1 / N) / (N - 
-00019220: 3129 202a 2052 0a20 2020 2052 3020 3d20  1) * R.    R0 = 
-00019230: 5220 2d20 2878 3020 2d20 526d 696e 202f  R - (x0 - Rmin /
-00019240: 2073 7172 7428 3229 290a 2020 2020 7420   sqrt(2)).    t 
-00019250: 3d20 6e70 2e61 7272 6179 2874 290a 2020  = np.array(t).  
-00019260: 2020 782c 2079 203d 206e 702e 7a65 726f    x, y = np.zero
-00019270: 7328 742e 7368 6170 6529 2c20 6e70 2e7a  s(t.shape), np.z
-00019280: 6572 6f73 2874 2e73 6861 7065 290a 0a20  eros(t.shape).. 
-00019290: 2020 2023 2044 6f69 6e67 2074 6865 206d     # Doing the m
-000192a0: 6174 680a 2020 2020 7820 3d20 636f 7328  ath.    x = cos(
-000192b0: 7420 2a20 7069 202f 2032 2920 2a20 5230  t * pi / 2) * R0
-000192c0: 2020 2320 7420 2830 2d31 2920 7768 696c    # t (0-1) whil
-000192d0: 6520 7820 2830 2074 6f20 5230 290a 2020  e x (0 to R0).  
-000192e0: 2020 6969 203d 2028 526d 696e 202f 2073    ii = (Rmin / s
-000192f0: 7172 7428 3229 203c 2078 2920 2620 2878  qrt(2) < x) & (x
-00019300: 203c 3d20 5230 290a 2020 2020 6a6a 203d   <= R0).    jj =
-00019310: 2028 3020 3c20 7829 2026 2028 7820 3c3d   (0 < x) & (x <=
-00019320: 2052 6d69 6e20 2f20 7371 7274 2832 2929   Rmin / sqrt(2))
-00019330: 0a20 2020 2079 5b69 695d 203d 2028 522a  .    y[ii] = (R*
-00019340: 2a4e 202d 2028 785b 6969 5d20 2b20 2878  *N - (x[ii] + (x
-00019350: 3020 2d20 526d 696e 202f 2073 7172 7428  0 - Rmin / sqrt(
-00019360: 3229 2929 202a 2a20 4e29 202a 2a20 2831  2))) ** N) ** (1
-00019370: 202f 204e 290a 2020 2020 795b 6a6a 5d20   / N).    y[jj] 
-00019380: 3d20 2878 3020 2d20 526d 696e 202f 2073  = (x0 - Rmin / s
-00019390: 7172 7428 3229 2920 2b20 7371 7274 2852  qrt(2)) + sqrt(R
-000193a0: 6d69 6e2a 2a32 202d 2078 5b6a 6a5d 202a  min**2 - x[jj] *
-000193b0: 2a20 3229 0a20 2020 2072 6574 7572 6e20  * 2).    return 
-000193c0: 782c 2079 0a0a 0a23 203d 3d3d 3d3d 3d3d  x, y...# =======
-000193d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000193e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000193f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00019400: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00019410: 3d3d 3d3d 3d3d 3d0a 2320 4578 616d 706c  =======.# Exampl
-00019420: 6520 636f 6465 0a23 203d 3d3d 3d3d 3d3d  e code.# =======
-00019430: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00019440: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00019450: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00019460: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00019470: 3d3d 3d3d 3d3d 3d0a 0a23 2044 203d 2072  =======..# D = r
-00019480: 6163 6574 7261 636b 5f67 7261 6475 616c  acetrack_gradual
-00019490: 2877 6964 7468 203d 2030 2e33 2c20 5220  (width = 0.3, R 
-000194a0: 3d20 352c 204e 203d 2033 290a 2320 7175  = 5, N = 3).# qu
-000194b0: 6963 6b70 6c6f 7428 4429 0a0a 0a23 2074  ickplot(D)...# t
-000194c0: 203d 206e 702e 6c69 6e73 7061 6365 2830   = np.linspace(0
-000194d0: 2c31 290a 2320 782c 7920 3d20 5f72 6163  ,1).# x,y = _rac
-000194e0: 6574 7261 636b 5f67 7261 6475 616c 5f70  etrack_gradual_p
-000194f0: 6172 616d 6574 7269 6328 742c 2052 203d  arametric(t, R =
-00019500: 2035 2c20 4e20 3d20 3329 0a23 2070 6c74   5, N = 3).# plt
-00019510: 2e70 6c6f 7428 782c 7929 0a23 2070 6c74  .plot(x,y).# plt
-00019520: 2e61 7869 7328 2765 7175 616c 2729 0a0a  .axis('equal')..
-00019530: 0a23 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  .# =============
-00019540: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00019550: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00019560: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00019570: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00019580: 3d0a 230a 2320 4172 616e 6765 2c20 7061  =.#.# Arange, pa
-00019590: 636b 696e 6720 616e 6420 6669 6c6c 0a23  cking and fill.#
-000195a0: 0a23 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  .# =============
-000195b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000195c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000195d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000195e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000195f0: 3d0a 0a0a 6465 6620 6772 6964 280a 2020  =...def grid(.  
-00019600: 2020 6465 7669 6365 5f6c 6973 742c 0a20    device_list,. 
-00019610: 2020 2073 7061 6369 6e67 3d28 352c 2031     spacing=(5, 1
-00019620: 3029 2c0a 2020 2020 7365 7061 7261 7469  0),.    separati
-00019630: 6f6e 3d54 7275 652c 0a20 2020 2073 6861  on=True,.    sha
-00019640: 7065 3d4e 6f6e 652c 0a20 2020 2061 6c69  pe=None,.    ali
-00019650: 676e 5f78 3d22 7822 2c0a 2020 2020 616c  gn_x="x",.    al
-00019660: 6967 6e5f 793d 2279 222c 0a20 2020 2065  ign_y="y",.    e
-00019670: 6467 655f 783d 2278 222c 0a20 2020 2065  dge_x="x",.    e
-00019680: 6467 655f 793d 2279 6d61 7822 2c0a 293a  dge_y="ymax",.):
-00019690: 0a20 2020 2022 2222 506c 6163 6573 2074  .    """Places t
-000196a0: 6865 2064 6576 6963 6573 2069 6e20 7468  he devices in th
-000196b0: 6520 6064 6576 6963 655f 6c69 7374 6020  e `device_list` 
-000196c0: 2831 4420 6f72 2032 4429 206f 6e20 6120  (1D or 2D) on a 
-000196d0: 6772 6964 2e0a 0a20 2020 2050 6172 616d  grid...    Param
-000196e0: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
-000196f0: 2d2d 2d2d 0a20 2020 2064 6576 6963 655f  ----.    device_
-00019700: 6c69 7374 203a 2061 7272 6179 2d6c 696b  list : array-lik
-00019710: 655b 4e5d 206f 6620 4465 7669 6365 0a20  e[N] of Device. 
-00019720: 2020 2020 2020 2044 6576 6963 6573 2074         Devices t
-00019730: 6f20 6265 2070 6c61 6365 6420 6f6e 746f  o be placed onto
-00019740: 2061 2067 7269 642e 0a20 2020 2073 7061   a grid..    spa
-00019750: 6369 6e67 203a 2069 6e74 2c20 666c 6f61  cing : int, floa
-00019760: 742c 206f 7220 6172 7261 792d 6c69 6b65  t, or array-like
-00019770: 5b32 5d20 6f66 2069 6e74 206f 7220 666c  [2] of int or fl
-00019780: 6f61 740a 2020 2020 2020 2020 5370 6163  oat.        Spac
-00019790: 696e 6720 6265 7477 6565 6e20 6164 6a61  ing between adja
-000197a0: 6365 6e74 2065 6c65 6d65 6e74 7320 6f6e  cent elements on
-000197b0: 2074 6865 2067 7269 642c 2063 616e 2062   the grid, can b
-000197c0: 6520 6120 7475 706c 6520 666f 720a 2020  e a tuple for.  
-000197d0: 2020 2020 2020 6469 6666 6572 656e 7420        different 
-000197e0: 6469 7374 616e 6365 7320 696e 2077 6964  distances in wid
-000197f0: 7468 2061 6e64 2068 6569 6768 7420 2878  th and height (x
-00019800: 2c79 292e 0a20 2020 2073 6570 6172 6174  ,y)..    separat
-00019810: 696f 6e20 3a20 626f 6f6c 0a20 2020 2020  ion : bool.     
-00019820: 2020 2049 6620 5472 7565 2c20 6775 6172     If True, guar
-00019830: 616e 7465 6573 2065 6c65 6d65 6e74 7320  antees elements 
-00019840: 6172 6520 7370 6570 6172 6174 6564 2077  are speparated w
-00019850: 6974 6820 6120 6669 7865 6420 7370 6163  ith a fixed spac
-00019860: 696e 670a 2020 2020 2020 2020 6265 7477  ing.        betw
-00019870: 6565 6e3b 2069 6620 2046 616c 7365 2c20  een; if  False, 
-00019880: 656c 656d 656e 7473 2061 7265 2073 7061  elements are spa
-00019890: 6365 6420 6576 656e 6c79 2061 6c6f 6e67  ced evenly along
-000198a0: 2061 2067 7269 642e 0a20 2020 2073 6861   a grid..    sha
-000198b0: 7065 203a 2061 7272 6179 2d6c 696b 655b  pe : array-like[
-000198c0: 325d 0a20 2020 2020 2020 2078 2c20 7920  2].        x, y 
-000198d0: 7368 6170 6520 6f66 2074 6865 2067 7269  shape of the gri
-000198e0: 6420 2861 7320 6966 206e 702e 7265 7368  d (as if np.resh
-000198f0: 6170 6528 2920 7765 7265 2072 756e 2077  ape() were run w
-00019900: 6974 6820 7368 6170 655b 3a3a 2d31 5d29  ith shape[::-1])
-00019910: 2e20 4966 206e 6f20 7368 6170 6520 6973  . If no shape is
-00019920: 2067 6976 656e 2061 6e64 2074 6865 0a20   given and the. 
-00019930: 2020 2020 2020 206c 6973 7420 6973 2031         list is 1
-00019940: 442c 2074 6865 206f 7574 7075 7420 6973  D, the output is
-00019950: 2061 7320 6966 206e 702e 7265 7368 6170   as if np.reshap
-00019960: 6520 7765 7265 2072 756e 2077 6974 6820  e were run with 
-00019970: 282d 312c 2073 697a 6520 6f66 206c 6973  (-1, size of lis
-00019980: 7429 2e0a 2020 2020 616c 6967 6e5f 7820  t)..    align_x 
-00019990: 3a20 7b27 7827 2c20 2778 6d69 6e27 2c20  : {'x', 'xmin', 
-000199a0: 2778 6d61 7827 7d0a 2020 2020 2020 2020  'xmax'}.        
-000199b0: 5768 6963 6820 6564 6765 2074 6f20 7065  Which edge to pe
-000199c0: 7266 6f72 6d20 7468 6520 7820 2863 6f6c  rform the x (col
-000199d0: 756d 6e29 2061 6c69 676e 6d65 6e74 2061  umn) alignment a
-000199e0: 6c6f 6e67 0a20 2020 2061 6c69 676e 5f79  long.    align_y
-000199f0: 203a 207b 2779 272c 2027 796d 696e 272c   : {'y', 'ymin',
-00019a00: 2027 796d 6178 277d 0a20 2020 2020 2020   'ymax'}.       
-00019a10: 2057 6869 6368 2065 6467 6520 746f 2070   Which edge to p
-00019a20: 6572 666f 726d 2074 6865 2079 2028 726f  erform the y (ro
-00019a30: 7729 2061 6c69 676e 6d65 6e74 2061 6c6f  w) alignment alo
-00019a40: 6e67 0a20 2020 2065 6467 655f 7820 3a20  ng.    edge_x : 
-00019a50: 7b27 7827 2c20 2778 6d69 6e27 2c20 2778  {'x', 'xmin', 'x
-00019a60: 6d61 7827 7d0a 2020 2020 2020 2020 5768  max'}.        Wh
-00019a70: 6963 6820 6564 6765 2074 6f20 7065 7266  ich edge to perf
-00019a80: 6f72 6d20 7468 6520 7820 2863 6f6c 756d  orm the x (colum
-00019a90: 6e29 2064 6973 7472 6962 7574 696f 6e20  n) distribution 
-00019aa0: 616c 6f6e 6720 2875 6e75 7365 6420 6966  along (unused if
-00019ab0: 0a20 2020 2020 2020 2073 6570 6172 6174  .        separat
-00019ac0: 696f 6e20 3d3d 2054 7275 6529 0a20 2020  ion == True).   
-00019ad0: 2065 6467 655f 7920 3a20 7b27 7927 2c20   edge_y : {'y', 
-00019ae0: 2779 6d69 6e27 2c20 2779 6d61 7827 7d0a  'ymin', 'ymax'}.
-00019af0: 2020 2020 2020 2020 5768 6963 6820 6564          Which ed
-00019b00: 6765 2074 6f20 7065 7266 6f72 6d20 7468  ge to perform th
-00019b10: 6520 7920 2872 6f77 2920 6469 7374 7269  e y (row) distri
-00019b20: 6275 7469 6f6e 2061 6c6f 6e67 2028 756e  bution along (un
-00019b30: 7573 6564 2069 660a 2020 2020 2020 2020  used if.        
-00019b40: 7365 7061 7261 7469 6f6e 203d 3d20 5472  separation == Tr
-00019b50: 7565 290a 0a20 2020 2052 6574 7572 6e73  ue)..    Returns
-00019b60: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
-00019b70: 2064 6576 6963 655f 6d61 7472 6978 203a   device_matrix :
-00019b80: 2044 6576 6963 650a 2020 2020 2020 2020   Device.        
-00019b90: 4120 4465 7669 6365 2063 6f6e 7461 696e  A Device contain
-00019ba0: 696e 6720 616c 6c20 7468 6520 4465 7669  ing all the Devi
-00019bb0: 6365 7320 696e 2060 6465 7669 6365 5f6c  ces in `device_l
-00019bc0: 6973 7460 2069 6e20 6120 6772 6964 2e0a  ist` in a grid..
-00019bd0: 2020 2020 2222 220a 0a20 2020 2064 6576      """..    dev
-00019be0: 6963 655f 6172 7261 7920 3d20 6e70 2e61  ice_array = np.a
-00019bf0: 7361 7272 6179 2864 6576 6963 655f 6c69  sarray(device_li
-00019c00: 7374 290a 2020 2020 7370 6163 696e 6720  st).    spacing 
-00019c10: 3d20 6e70 2e62 726f 6164 6361 7374 5f74  = np.broadcast_t
-00019c20: 6f28 7370 6163 696e 672c 2032 290a 2020  o(spacing, 2).  
-00019c30: 2020 2320 4368 6563 6b20 6172 6775 6d65    # Check argume
-00019c40: 6e74 730a 2020 2020 6966 2064 6576 6963  nts.    if devic
-00019c50: 655f 6172 7261 792e 6e64 696d 206e 6f74  e_array.ndim not
-00019c60: 2069 6e20 2831 2c20 3229 3a0a 2020 2020   in (1, 2):.    
-00019c70: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00019c80: 7272 6f72 2822 5b50 4849 444c 5d20 6772  rror("[PHIDL] gr
-00019c90: 6964 2829 2054 6865 2064 6576 6963 655f  id() The device_
-00019ca0: 6c69 7374 206e 6565 6473 2074 6f20 6265  list needs to be
-00019cb0: 2031 4420 6f72 2032 442e 2229 0a20 2020   1D or 2D.").   
-00019cc0: 2069 6620 7368 6170 6520 6973 206e 6f74   if shape is not
-00019cd0: 204e 6f6e 6520 616e 6420 6c65 6e28 7368   None and len(sh
-00019ce0: 6170 6529 2021 3d20 323a 0a20 2020 2020  ape) != 2:.     
-00019cf0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00019d00: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00019d10: 2022 5b50 4849 444c 5d20 6772 6964 2829   "[PHIDL] grid()
-00019d20: 2073 6861 7065 2061 7267 756d 656e 7420   shape argument 
-00019d30: 6d75 7374 2062 6520 4e6f 6e65 206f 7222  must be None or"
-00019d40: 0a20 2020 2020 2020 2020 2020 202b 2022  .            + "
-00019d50: 2068 6176 6520 6120 6c65 6e67 7468 206f   have a length o
-00019d60: 6620 322c 2066 6f72 2065 7861 6d70 6c65  f 2, for example
-00019d70: 2073 6861 7065 3d28 342c 3629 220a 2020   shape=(4,6)".  
-00019d80: 2020 2020 2020 290a 0a20 2020 2023 2043        )..    # C
-00019d90: 6865 636b 2074 6861 7420 7368 6170 6520  heck that shape 
-00019da0: 6973 2076 616c 6964 2061 6e64 2072 6573  is valid and res
-00019db0: 6861 7065 2061 7272 6179 2069 6620 6e65  hape array if ne
-00019dc0: 6564 6564 0a20 2020 2069 6620 2873 6861  eded.    if (sha
-00019dd0: 7065 2069 7320 4e6f 6e65 2920 616e 6420  pe is None) and 
-00019de0: 2864 6576 6963 655f 6172 7261 792e 6e64  (device_array.nd
-00019df0: 696d 203d 3d20 3229 3a20 2023 2041 6c72  im == 2):  # Alr
-00019e00: 6561 6479 2069 6e20 6465 7369 7265 6420  eady in desired 
-00019e10: 7368 6170 650a 2020 2020 2020 2020 7368  shape.        sh
-00019e20: 6170 6520 3d20 6465 7669 6365 5f61 7272  ape = device_arr
-00019e30: 6179 2e73 6861 7065 0a20 2020 2065 6c69  ay.shape.    eli
-00019e40: 6620 2873 6861 7065 2069 7320 4e6f 6e65  f (shape is None
-00019e50: 2920 616e 6420 2864 6576 6963 655f 6172  ) and (device_ar
-00019e60: 7261 792e 6e64 696d 203d 3d20 3129 3a0a  ray.ndim == 1):.
-00019e70: 2020 2020 2020 2020 7368 6170 6520 3d20          shape = 
-00019e80: 282d 312c 2064 6576 6963 655f 6172 7261  (-1, device_arra
-00019e90: 792e 7369 7a65 290a 2020 2020 656c 6966  y.size).    elif
-00019ea0: 2030 203c 2073 6861 7065 5b30 5d20 2a20   0 < shape[0] * 
-00019eb0: 7368 6170 655b 315d 203c 2064 6576 6963  shape[1] < devic
-00019ec0: 655f 6172 7261 792e 7369 7a65 3a0a 2020  e_array.size:.  
-00019ed0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00019ee0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00019ef0: 2020 2020 225b 5048 4944 4c5d 2067 7269      "[PHIDL] gri
-00019f00: 6428 2920 5468 6520 7368 6170 6520 6973  d() The shape is
-00019f10: 2074 6f6f 2073 6d61 6c6c 2066 6f72 2061   too small for a
-00019f20: 6c6c 2074 6865 2069 7465 6d73 2069 6e20  ll the items in 
-00019f30: 6465 7669 6365 5f6c 6973 7422 0a20 2020  device_list".   
-00019f40: 2020 2020 2029 0a20 2020 2065 6c73 653a       ).    else:
-00019f50: 0a20 2020 2020 2020 2023 2043 6861 6e67  .        # Chang
-00019f60: 6520 2878 2c79 2920 7368 6170 6520 746f  e (x,y) shape to
-00019f70: 2028 792c 7829 2073 6861 7065 2074 6f20   (y,x) shape to 
-00019f80: 666f 6c6c 6f77 2064 6566 6175 6c74 2072  follow default r
-00019f90: 6f77 2c20 636f 6c75 6d6e 2066 6f72 6d61  ow, column forma
-00019fa0: 7420 696e 206e 702e 7265 7368 6170 650a  t in np.reshape.
-00019fb0: 2020 2020 2020 2020 7368 6170 6520 3d20          shape = 
-00019fc0: 7368 6170 655b 3a3a 2d31 5d0a 0a20 2020  shape[::-1]..   
-00019fd0: 2020 2020 2069 6620 6e70 2e6d 696e 2873       if np.min(s
-00019fe0: 6861 7065 2920 3d3d 202d 313a 0a20 2020  hape) == -1:.   
-00019ff0: 2020 2020 2020 2020 206d 6178 5f73 6861           max_sha
-0001a000: 7065 203d 206e 702e 6d61 7828 7368 6170  pe = np.max(shap
-0001a010: 6529 0a20 2020 2020 2020 2020 2020 206d  e).            m
-0001a020: 696e 5f64 6576 6963 6573 203d 2069 6e74  in_devices = int
-0001a030: 286e 702e 6365 696c 2864 6576 6963 655f  (np.ceil(device_
-0001a040: 6172 7261 792e 7369 7a65 202f 206d 6178  array.size / max
-0001a050: 5f73 6861 7065 2920 2a20 6d61 785f 7368  _shape) * max_sh
-0001a060: 6170 6529 0a20 2020 2020 2020 2020 2020  ape).           
-0001a070: 2065 7874 7261 5f64 6576 6963 6573 203d   extra_devices =
-0001a080: 206d 696e 5f64 6576 6963 6573 202d 2064   min_devices - d
-0001a090: 6576 6963 655f 6172 7261 792e 7369 7a65  evice_array.size
-0001a0a0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0001a0b0: 2020 2020 2020 2020 2020 2065 7874 7261             extra
-0001a0c0: 5f64 6576 6963 6573 203d 2073 6861 7065  _devices = shape
-0001a0d0: 5b30 5d20 2a20 7368 6170 655b 315d 202d  [0] * shape[1] -
-0001a0e0: 2064 6576 6963 655f 6172 7261 792e 7369   device_array.si
-0001a0f0: 7a65 0a20 2020 2020 2020 2069 6620 6578  ze.        if ex
-0001a100: 7472 615f 6465 7669 6365 7320 213d 2030  tra_devices != 0
-0001a110: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
-0001a120: 7669 6365 5f61 7272 6179 203d 206e 702e  vice_array = np.
-0001a130: 6170 7065 6e64 280a 2020 2020 2020 2020  append(.        
-0001a140: 2020 2020 2020 2020 6465 7669 6365 5f61          device_a
-0001a150: 7272 6179 2c0a 2020 2020 2020 2020 2020  rray,.          
-0001a160: 2020 2020 2020 5b0a 2020 2020 2020 2020        [.        
-0001a170: 2020 2020 2020 2020 2020 2020 4e6f 6e65              None
-0001a180: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001a190: 2020 5d0a 2020 2020 2020 2020 2020 2020    ].            
-0001a1a0: 2020 2020 2a20 6578 7472 615f 6465 7669      * extra_devi
-0001a1b0: 6365 732c 0a20 2020 2020 2020 2020 2020  ces,.           
-0001a1c0: 2029 0a20 2020 2064 6576 6963 655f 6172   ).    device_ar
-0001a1d0: 7261 7920 3d20 6e70 2e72 6573 6861 7065  ray = np.reshape
-0001a1e0: 2864 6576 6963 655f 6172 7261 792c 2073  (device_array, s
-0001a1f0: 6861 7065 290a 0a20 2020 2023 2043 7265  hape)..    # Cre
-0001a200: 6174 6520 6120 626c 616e 6b20 4465 7669  ate a blank Devi
-0001a210: 6365 2061 6e64 2072 6566 6572 656e 6365  ce and reference
-0001a220: 2061 6c6c 2074 6865 2044 6576 6963 6573   all the Devices
-0001a230: 2069 6e20 6974 0a20 2020 2044 203d 2044   in it.    D = D
-0001a240: 6576 6963 6528 2267 7269 6422 290a 2020  evice("grid").  
-0001a250: 2020 7265 665f 6172 7261 7920 3d20 6e70    ref_array = np
-0001a260: 2e65 6d70 7479 2864 6576 6963 655f 6172  .empty(device_ar
-0001a270: 7261 792e 7368 6170 652c 2064 7479 7065  ray.shape, dtype
-0001a280: 3d6f 626a 6563 7429 0a20 2020 2064 756d  =object).    dum
-0001a290: 6d79 203d 2044 6576 6963 6528 290a 2020  my = Device().  
-0001a2a0: 2020 666f 7220 6964 782c 2064 2069 6e20    for idx, d in 
-0001a2b0: 6e70 2e6e 6465 6e75 6d65 7261 7465 2864  np.ndenumerate(d
-0001a2c0: 6576 6963 655f 6172 7261 7929 3a0a 2020  evice_array):.  
-0001a2d0: 2020 2020 2020 6966 2064 2069 7320 6e6f        if d is no
-0001a2e0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0001a2f0: 2020 2020 7265 665f 6172 7261 795b 6964      ref_array[id
-0001a300: 785d 203d 2044 203c 3c20 640a 2020 2020  x] = D << d.    
-0001a310: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001a320: 2020 2020 2020 7265 665f 6172 7261 795b        ref_array[
-0001a330: 6964 785d 203d 2044 203c 3c20 6475 6d6d  idx] = D << dumm
-0001a340: 7920 2023 2043 7265 6174 6520 6475 6d6d  y  # Create dumm
-0001a350: 7920 6465 7669 6365 730a 0a20 2020 2072  y devices..    r
-0001a360: 6f77 7320 3d20 5b47 726f 7570 2872 6566  ows = [Group(ref
-0001a370: 5f61 7272 6179 5b6e 2c20 3a5d 2920 666f  _array[n, :]) fo
-0001a380: 7220 6e20 696e 2072 616e 6765 2872 6566  r n in range(ref
-0001a390: 5f61 7272 6179 2e73 6861 7065 5b30 5d29  _array.shape[0])
-0001a3a0: 5d0a 2020 2020 636f 6c73 203d 205b 4772  ].    cols = [Gr
-0001a3b0: 6f75 7028 7265 665f 6172 7261 795b 3a2c  oup(ref_array[:,
-0001a3c0: 206e 5d29 2066 6f72 206e 2069 6e20 7261   n]) for n in ra
-0001a3d0: 6e67 6528 7265 665f 6172 7261 792e 7368  nge(ref_array.sh
-0001a3e0: 6170 655b 315d 295d 0a0a 2020 2020 2320  ape[1])]..    # 
-0001a3f0: 416c 6967 6e20 726f 7773 2061 6e64 2063  Align rows and c
-0001a400: 6f6c 756d 6e73 2069 6e64 6570 656e 6465  olumns independe
-0001a410: 6e74 6c79 0a20 2020 2066 6f72 206e 2c20  ntly.    for n, 
-0001a420: 7220 696e 2065 6e75 6d65 7261 7465 2872  r in enumerate(r
-0001a430: 6f77 7329 3a0a 2020 2020 2020 2020 722e  ows):.        r.
-0001a440: 616c 6967 6e28 616c 6967 6e6d 656e 743d  align(alignment=
-0001a450: 616c 6967 6e5f 7929 0a20 2020 2066 6f72  align_y).    for
-0001a460: 206e 2c20 6320 696e 2065 6e75 6d65 7261   n, c in enumera
-0001a470: 7465 2863 6f6c 7329 3a0a 2020 2020 2020  te(cols):.      
-0001a480: 2020 632e 616c 6967 6e28 616c 6967 6e6d    c.align(alignm
-0001a490: 656e 743d 616c 6967 6e5f 7829 0a0a 2020  ent=align_x)..  
-0001a4a0: 2020 2320 4469 7374 7269 6275 7465 2072    # Distribute r
-0001a4b0: 6f77 7320 616e 6420 636f 6c75 6d6e 730a  ows and columns.
-0001a4c0: 2020 2020 4772 6f75 7028 636f 6c73 292e      Group(cols).
-0001a4d0: 6469 7374 7269 6275 7465 280a 2020 2020  distribute(.    
-0001a4e0: 2020 2020 6469 7265 6374 696f 6e3d 2278      direction="x
-0001a4f0: 222c 2073 7061 6369 6e67 3d73 7061 6369  ", spacing=spaci
-0001a500: 6e67 5b30 5d2c 2073 6570 6172 6174 696f  ng[0], separatio
-0001a510: 6e3d 7365 7061 7261 7469 6f6e 2c20 6564  n=separation, ed
-0001a520: 6765 3d65 6467 655f 780a 2020 2020 290a  ge=edge_x.    ).
-0001a530: 2020 2020 4772 6f75 7028 726f 7773 5b3a      Group(rows[:
-0001a540: 3a2d 315d 292e 6469 7374 7269 6275 7465  :-1]).distribute
-0001a550: 280a 2020 2020 2020 2020 6469 7265 6374  (.        direct
-0001a560: 696f 6e3d 2279 222c 2073 7061 6369 6e67  ion="y", spacing
-0001a570: 3d73 7061 6369 6e67 5b31 5d2c 2073 6570  =spacing[1], sep
-0001a580: 6172 6174 696f 6e3d 7365 7061 7261 7469  aration=separati
-0001a590: 6f6e 2c20 6564 6765 3d65 6467 655f 790a  on, edge=edge_y.
-0001a5a0: 2020 2020 290a 0a20 2020 2023 2072 6574      )..    # ret
-0001a5b0: 7572 6e20 6465 7669 6365 5f6d 6174 7269  urn device_matri
-0001a5c0: 780a 2020 2020 7265 7475 726e 2044 0a0a  x.    return D..
-0001a5d0: 0a64 6566 205f 7061 7261 6d65 7465 725f  .def _parameter_
-0001a5e0: 636f 6d62 696e 6174 696f 6e73 2870 6172  combinations(par
-0001a5f0: 616d 6574 6572 735f 6469 6374 293a 0a20  ameters_dict):. 
-0001a600: 2020 2022 2222 4372 6561 7465 7320 7061     """Creates pa
-0001a610: 7261 6d65 7465 7220 636f 6d62 696e 6174  rameter combinat
-0001a620: 696f 6e73 2066 726f 6d20 6120 6469 6374  ions from a dict
-0001a630: 2066 696c 6c65 6420 7769 7468 206c 6973   filled with lis
-0001a640: 7420 7661 6c75 6573 2c20 652e 672e 0a20  t values, e.g.. 
-0001a650: 2020 2070 6172 616d 6574 6572 735f 6469     parameters_di
-0001a660: 6374 203d 207b 0a20 2020 2020 2020 2027  ct = {.        '
-0001a670: 7769 6474 6827 203a 205b 302e 312c 302e  width' : [0.1,0.
-0001a680: 325d 2c0a 2020 2020 2020 2020 276c 656e  2],.        'len
-0001a690: 6774 6827 203a 205b 342c 352c 365d 2c0a  gth' : [4,5,6],.
-0001a6a0: 2020 2020 2020 2020 2768 6569 6768 7427          'height'
-0001a6b0: 203a 205b 3232 5d0a 2020 2020 2020 2020   : [22].        
-0001a6c0: 7d0a 2020 2020 5769 6c6c 2070 726f 6475  }.    Will produ
-0001a6d0: 6365 2061 206c 6973 7420 6f66 2064 6963  ce a list of dic
-0001a6e0: 7469 6f6e 6172 6965 732c 2065 6163 6820  tionaries, each 
-0001a6f0: 6f66 2077 6869 6368 2063 616e 2062 6520  of which can be 
-0001a700: 7573 6564 2061 7320 6b77 6172 6773 2069  used as kwargs i
-0001a710: 6e70 7574 3a0a 2020 2020 2020 2020 5b7b  nput:.        [{
-0001a720: 2768 6569 6768 7427 3a20 3232 2c20 276c  'height': 22, 'l
-0001a730: 656e 6774 6827 3a20 342c 2027 7769 6474  ength': 4, 'widt
-0001a740: 6827 3a20 302e 317d 2c0a 2020 2020 2020  h': 0.1},.      
-0001a750: 2020 207b 2768 6569 6768 7427 3a20 3232     {'height': 22
-0001a760: 2c20 276c 656e 6774 6827 3a20 352c 2027  , 'length': 5, '
-0001a770: 7769 6474 6827 3a20 302e 317d 2c0a 2020  width': 0.1},.  
-0001a780: 2020 2020 2020 207b 2768 6569 6768 7427         {'height'
-0001a790: 3a20 3232 2c20 276c 656e 6774 6827 3a20  : 22, 'length': 
-0001a7a0: 362c 2027 7769 6474 6827 3a20 302e 317d  6, 'width': 0.1}
-0001a7b0: 2c0a 2020 2020 2020 2020 207b 2768 6569  ,.         {'hei
-0001a7c0: 6768 7427 3a20 3232 2c20 276c 656e 6774  ght': 22, 'lengt
-0001a7d0: 6827 3a20 342c 2027 7769 6474 6827 3a20  h': 4, 'width': 
-0001a7e0: 302e 327d 2c0a 2020 2020 2020 2020 207b  0.2},.         {
-0001a7f0: 2768 6569 6768 7427 3a20 3232 2c20 276c  'height': 22, 'l
-0001a800: 656e 6774 6827 3a20 352c 2027 7769 6474  ength': 5, 'widt
-0001a810: 6827 3a20 302e 327d 2c0a 2020 2020 2020  h': 0.2},.      
-0001a820: 2020 207b 2768 6569 6768 7427 3a20 3232     {'height': 22
-0001a830: 2c20 276c 656e 6774 6827 3a20 362c 2027  , 'length': 6, '
-0001a840: 7769 6474 6827 3a20 302e 327d 5d22 2222  width': 0.2}]"""
-0001a850: 0a20 2020 2076 616c 7565 5f63 6f6d 6269  .    value_combi
-0001a860: 6e61 7469 6f6e 7320 3d20 6c69 7374 2869  nations = list(i
-0001a870: 7465 7274 6f6f 6c73 2e70 726f 6475 6374  tertools.product
-0001a880: 282a 7061 7261 6d65 7465 7273 5f64 6963  (*parameters_dic
-0001a890: 742e 7661 6c75 6573 2829 2929 0a20 2020  t.values())).   
-0001a8a0: 206b 6579 7320 3d20 6c69 7374 2870 6172   keys = list(par
-0001a8b0: 616d 6574 6572 735f 6469 6374 2e6b 6579  ameters_dict.key
-0001a8c0: 7328 2929 0a20 2020 2072 6574 7572 6e20  s()).    return 
-0001a8d0: 5b0a 2020 2020 2020 2020 7b6b 6579 735b  [.        {keys[
-0001a8e0: 6e5d 3a20 7661 6c75 6573 5b6e 5d20 666f  n]: values[n] fo
-0001a8f0: 7220 6e20 696e 2072 616e 6765 286c 656e  r n in range(len
-0001a900: 286b 6579 7329 297d 2066 6f72 2076 616c  (keys))} for val
-0001a910: 7565 7320 696e 2076 616c 7565 5f63 6f6d  ues in value_com
-0001a920: 6269 6e61 7469 6f6e 730a 2020 2020 5d0a  binations.    ].
-0001a930: 0a0a 6465 6620 5f67 656e 5f70 6172 616d  ..def _gen_param
-0001a940: 5f76 6172 6961 7469 6f6e 7328 0a20 2020  _variations(.   
-0001a950: 2066 756e 6374 696f 6e2c 2070 6172 616d   function, param
-0001a960: 5f76 6172 6961 7469 6f6e 732c 2070 6172  _variations, par
-0001a970: 616d 5f64 6566 6175 6c74 733d 7b7d 2c20  am_defaults={}, 
-0001a980: 7061 7261 6d5f 6f76 6572 7269 6465 3d7b  param_override={
-0001a990: 7d2c 206c 6162 656c 5f6c 6179 6572 3d32  }, label_layer=2
-0001a9a0: 3535 0a29 3a0a 2020 2020 2222 2254 616b  55.):.    """Tak
-0001a9b0: 6573 2065 2e67 2e0a 0a20 2020 2070 6172  es e.g...    par
-0001a9c0: 616d 5f76 6172 6961 7469 6f6e 7320 3d20  am_variations = 
-0001a9d0: 7b0a 2020 2020 2020 2020 2020 2020 2763  {.            'c
-0001a9e0: 6861 6e6e 656c 5f77 6964 7468 2720 3a20  hannel_width' : 
-0001a9f0: 5b31 2c32 2c33 5d0a 2020 2020 2020 2020  [1,2,3].        
-0001aa00: 2020 2020 2767 6174 655f 7769 6474 6827      'gate_width'
-0001aa10: 203a 205b 302e 312c 302e 322c 302e 345d   : [0.1,0.2,0.4]
-0001aa20: 2c0a 2020 2020 2020 2020 2020 2020 7d0a  ,.            }.
-0001aa30: 2020 2020 2020 206f 7220 6571 7569 7661         or equiva
-0001aa40: 6c65 6e74 6c79 0a20 2020 2070 6172 616d  lently.    param
-0001aa50: 5f76 6172 6961 7469 6f6e 7320 3d20 6469  _variations = di
-0001aa60: 6374 280a 2020 2020 2020 2020 2020 2020  ct(.            
-0001aa70: 6368 616e 6e65 6c5f 7769 6474 6820 3d20  channel_width = 
-0001aa80: 5b31 2c32 2c33 5d2c 0a20 2020 2020 2020  [1,2,3],.       
-0001aa90: 2020 2020 2067 6174 655f 7769 6474 6820       gate_width 
-0001aaa0: 3d20 5b30 2e31 2c30 2e32 2c30 2e34 5d2c  = [0.1,0.2,0.4],
-0001aab0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0001aac0: 2020 2022 2222 0a20 2020 2070 6172 616d     """.    param
-0001aad0: 6574 6572 5f6c 6973 7420 3d20 5f70 6172  eter_list = _par
-0001aae0: 616d 6574 6572 5f63 6f6d 6269 6e61 7469  ameter_combinati
-0001aaf0: 6f6e 7328 7061 7261 6d5f 7661 7269 6174  ons(param_variat
-0001ab00: 696f 6e73 290a 0a20 2020 2044 5f6c 6973  ions)..    D_lis
-0001ab10: 7420 3d20 5b5d 0a20 2020 2066 6f72 2070  t = [].    for p
-0001ab20: 6172 616d 7320 696e 2070 6172 616d 6574  arams in paramet
-0001ab30: 6572 5f6c 6973 743a 0a20 2020 2020 2020  er_list:.       
-0001ab40: 206e 6577 5f70 6172 616d 7320 3d20 6469   new_params = di
-0001ab50: 6374 2829 0a20 2020 2020 2020 206e 6577  ct().        new
-0001ab60: 5f70 6172 616d 732e 7570 6461 7465 2870  _params.update(p
-0001ab70: 6172 616d 7329 0a20 2020 2020 2020 206e  arams).        n
-0001ab80: 6577 5f70 6172 616d 732e 7570 6461 7465  ew_params.update
-0001ab90: 2870 6172 616d 5f6f 7665 7272 6964 6529  (param_override)
-0001aba0: 0a20 2020 2020 2020 2044 5f6e 6577 203d  .        D_new =
-0001abb0: 206d 616b 655f 6465 7669 6365 2866 756e   make_device(fun
-0001abc0: 6374 696f 6e2c 2063 6f6e 6669 673d 7061  ction, config=pa
-0001abd0: 7261 6d5f 6465 6661 756c 7473 2c20 2a2a  ram_defaults, **
-0001abe0: 6e65 775f 7061 7261 6d73 290a 2020 2020  new_params).    
-0001abf0: 2020 2020 6c61 6265 6c5f 7465 7874 203d      label_text =
-0001ac00: 2022 220a 2020 2020 2020 2020 666f 7220   "".        for 
-0001ac10: 6e61 6d65 2c20 7661 6c75 6520 696e 2070  name, value in p
-0001ac20: 6172 616d 732e 6974 656d 7328 293a 0a20  arams.items():. 
-0001ac30: 2020 2020 2020 2020 2020 206c 6162 656c             label
-0001ac40: 5f74 6578 7420 2b3d 2028 6622 7b6e 616d  _text += (f"{nam
-0001ac50: 657d 3d7b 7661 6c75 657d 2229 202b 2022  e}={value}") + "
-0001ac60: 5c6e 220a 2020 2020 2020 2020 6966 206c  \n".        if l
-0001ac70: 6162 656c 5f6c 6179 6572 2069 7320 6e6f  abel_layer is no
-0001ac80: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0001ac90: 2020 2020 445f 6e65 772e 6164 645f 6c61      D_new.add_la
-0001aca0: 6265 6c28 7465 7874 3d6c 6162 656c 5f74  bel(text=label_t
-0001acb0: 6578 742c 2070 6f73 6974 696f 6e3d 445f  ext, position=D_
-0001acc0: 6e65 772e 6365 6e74 6572 2c20 6c61 7965  new.center, laye
-0001acd0: 723d 6c61 6265 6c5f 6c61 7965 7229 0a0a  r=label_layer)..
-0001ace0: 2020 2020 2020 2020 445f 6c69 7374 2e61          D_list.a
-0001acf0: 7070 656e 6428 445f 6e65 7729 0a20 2020  ppend(D_new).   
-0001ad00: 2072 6574 7572 6e20 445f 6c69 7374 0a0a   return D_list..
-0001ad10: 0a64 6566 2067 7269 6473 7765 6570 280a  .def gridsweep(.
-0001ad20: 2020 2020 6675 6e63 7469 6f6e 2c0a 2020      function,.  
-0001ad30: 2020 7061 7261 6d5f 783d 7b22 7769 6474    param_x={"widt
-0001ad40: 6822 3a20 5b31 2c20 352c 2036 2c20 375d  h": [1, 5, 6, 7]
-0001ad50: 7d2c 0a20 2020 2070 6172 616d 5f79 3d7b  },.    param_y={
-0001ad60: 226c 656e 6774 6822 3a20 5b31 2e31 2c20  "length": [1.1, 
-0001ad70: 322c 2037 305d 7d2c 0a20 2020 2070 6172  2, 70]},.    par
-0001ad80: 616d 5f64 6566 6175 6c74 733d 7b7d 2c0a  am_defaults={},.
-0001ad90: 2020 2020 7061 7261 6d5f 6f76 6572 7269      param_overri
-0001ada0: 6465 3d7b 7d2c 0a20 2020 2073 7061 6369  de={},.    spaci
-0001adb0: 6e67 3d28 3530 2c20 3130 3029 2c0a 2020  ng=(50, 100),.  
-0001adc0: 2020 7365 7061 7261 7469 6f6e 3d54 7275    separation=Tru
-0001add0: 652c 0a20 2020 2061 6c69 676e 5f78 3d22  e,.    align_x="
-0001ade0: 7822 2c0a 2020 2020 616c 6967 6e5f 793d  x",.    align_y=
-0001adf0: 2279 222c 0a20 2020 2065 6467 655f 783d  "y",.    edge_x=
-0001ae00: 2278 222c 0a20 2020 2065 6467 655f 793d  "x",.    edge_y=
-0001ae10: 2279 6d69 6e22 2c0a 2020 2020 6c61 6265  "ymin",.    labe
-0001ae20: 6c5f 6c61 7965 723d 3235 352c 0a29 3a0a  l_layer=255,.):.
-0001ae30: 2020 2020 2222 2243 7265 6174 6573 2061      """Creates a
-0001ae40: 2070 6172 616d 6574 6572 2073 7765 6570   parameter sweep
-0001ae50: 206f 6620 6465 7669 6365 7320 616e 6420   of devices and 
-0001ae60: 706c 6163 6573 2074 6865 6d20 6f6e 2061  places them on a
-0001ae70: 2067 7269 6420 7769 7468 0a20 2020 206c   grid with.    l
-0001ae80: 6162 656c 7320 666f 7220 6561 6368 2064  abels for each d
-0001ae90: 6576 6963 652e 2046 6f72 2069 6e73 7461  evice. For insta
-0001aea0: 6e63 652c 2067 6976 656e 2061 2066 756e  nce, given a fun
-0001aeb0: 6374 696f 6e20 6465 6669 6e65 6420 6c69  ction defined li
-0001aec0: 6b65 0a20 2020 2060 6d79 7368 6170 6528  ke.    `myshape(
-0001aed0: 7769 6474 682c 2068 6569 6768 742c 206f  width, height, o
-0001aee0: 6666 7365 742c 206c 6179 6572 2960 2061  ffset, layer)` a
-0001aef0: 6e64 2074 6865 2066 6f6c 6c6f 7769 6e67  nd the following
-0001af00: 2070 6172 616d 6574 6572 733a 0a20 2020   parameters:.   
-0001af10: 2020 2020 2070 6172 616d 5f78 203d 207b       param_x = {
-0001af20: 2777 6964 7468 2720 3a20 205b 342c 2035  'width' :  [4, 5
-0001af30: 2c20 365d 2020 7d2c 0a20 2020 2020 2020  , 6]  },.       
-0001af40: 2070 6172 616d 5f79 203d 207b 2768 6569   param_y = {'hei
-0001af50: 6768 7427 203a 205b 372c 2039 5d2c 0a20  ght' : [7, 9],. 
-0001af60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af70: 2020 276c 6179 6572 2720 3a20 205b 312c    'layer' :  [1,
-0001af80: 2032 2c20 335d 2020 7d2c 0a20 2020 2020   2, 3]  },.     
-0001af90: 2020 2070 6172 616d 5f64 6566 6175 6c74     param_default
-0001afa0: 7320 3d20 7b27 7363 616c 6527 203a 2031  s = {'scale' : 1
-0001afb0: 7d0a 0a20 2020 2067 7269 6473 7765 6570  }..    gridsweep
-0001afc0: 2829 2070 726f 6475 6365 2061 2067 7269  () produce a gri
-0001afd0: 6420 6f66 2064 6576 6963 6573 2077 6974  d of devices wit
-0001afe0: 6820 7468 6520 666f 6c6c 6f77 696e 6720  h the following 
-0001aff0: 6c61 796f 7574 2f70 6172 616d 6574 6572  layout/parameter
-0001b000: 733a 0a20 2020 2020 2020 2028 773d 342c  s:.        (w=4,
-0001b010: 2068 3d37 2c20 733d 312c 206c 3d31 2920   h=7, s=1, l=1) 
-0001b020: 2020 2028 773d 352c 2068 3d37 2c20 733d     (w=5, h=7, s=
-0001b030: 312c 206c 3d31 2920 2020 2028 773d 362c  1, l=1)    (w=6,
-0001b040: 2068 3d37 2c20 733d 312c 206c 3d31 290a   h=7, s=1, l=1).
-0001b050: 2020 2020 2020 2020 2877 3d34 2c20 683d          (w=4, h=
-0001b060: 372c 2073 3d31 2c20 6c3d 3229 2020 2020  7, s=1, l=2)    
-0001b070: 2877 3d35 2c20 683d 372c 2073 3d31 2c20  (w=5, h=7, s=1, 
-0001b080: 6c3d 3229 2020 2020 2877 3d36 2c20 683d  l=2)    (w=6, h=
-0001b090: 372c 2073 3d31 2c20 6c3d 3229 0a20 2020  7, s=1, l=2).   
-0001b0a0: 2020 2020 2028 773d 342c 2068 3d37 2c20       (w=4, h=7, 
-0001b0b0: 733d 312c 206c 3d33 2920 2020 2028 773d  s=1, l=3)    (w=
-0001b0c0: 352c 2068 3d37 2c20 733d 312c 206c 3d33  5, h=7, s=1, l=3
-0001b0d0: 2920 2020 2028 773d 362c 2068 3d37 2c20  )    (w=6, h=7, 
-0001b0e0: 733d 312c 206c 3d33 290a 2020 2020 2020  s=1, l=3).      
-0001b0f0: 2020 2877 3d34 2c20 683d 392c 2073 3d31    (w=4, h=9, s=1
-0001b100: 2c20 6c3d 3129 2020 2020 2877 3d35 2c20  , l=1)    (w=5, 
-0001b110: 683d 392c 2073 3d31 2c20 6c3d 3129 2020  h=9, s=1, l=1)  
-0001b120: 2020 2877 3d36 2c20 683d 392c 2073 3d31    (w=6, h=9, s=1
-0001b130: 2c20 6c3d 3129 0a20 2020 2020 2020 2028  , l=1).        (
-0001b140: 773d 342c 2068 3d39 2c20 733d 312c 206c  w=4, h=9, s=1, l
-0001b150: 3d32 2920 2020 2028 773d 352c 2068 3d39  =2)    (w=5, h=9
-0001b160: 2c20 733d 312c 206c 3d32 2920 2020 2028  , s=1, l=2)    (
-0001b170: 773d 362c 2068 3d39 2c20 733d 312c 206c  w=6, h=9, s=1, l
-0001b180: 3d32 290a 2020 2020 2020 2020 2877 3d34  =2).        (w=4
-0001b190: 2c20 683d 392c 2073 3d31 2c20 6c3d 3329  , h=9, s=1, l=3)
-0001b1a0: 2020 2020 2877 3d35 2c20 683d 392c 2073      (w=5, h=9, s
-0001b1b0: 3d31 2c20 6c3d 3329 2020 2020 2877 3d36  =1, l=3)    (w=6
-0001b1c0: 2c20 683d 392c 2073 3d31 2c20 6c3d 3329  , h=9, s=1, l=3)
-0001b1d0: 0a0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-0001b1e0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-0001b1f0: 0a20 2020 2066 756e 6374 696f 6e20 3a20  .    function : 
-0001b200: 6675 6e63 7469 6f6e 2074 6861 7420 7072  function that pr
-0001b210: 6f64 7563 6573 2061 2044 6576 6963 650a  oduces a Device.
-0001b220: 2020 2020 2020 2020 5468 6520 6675 6e63          The func
-0001b230: 7469 6f6e 2077 6869 6368 2077 696c 6c20  tion which will 
-0001b240: 6265 2075 7365 6420 746f 2063 7265 6174  be used to creat
-0001b250: 6520 7468 6520 696e 6469 7669 6475 616c  e the individual
-0001b260: 2064 6576 6963 6573 2069 6e20 7468 650a   devices in the.
-0001b270: 2020 2020 2020 2020 6772 6964 2e20 204d          grid.  M
-0001b280: 7573 7420 6f6e 6c79 2072 6574 7572 6e20  ust only return 
-0001b290: 6120 7369 6e67 6c65 2044 6576 6963 6520  a single Device 
-0001b2a0: 2865 2e67 2e20 616e 7920 6f66 2074 6865  (e.g. any of the
-0001b2b0: 2066 756e 6374 696f 6e73 2069 6e0a 2020   functions in.  
-0001b2c0: 2020 2020 2020 7067 2e67 656f 6d65 7472        pg.geometr
-0001b2d0: 7929 0a20 2020 2070 6172 616d 5f78 203a  y).    param_x :
-0001b2e0: 2064 6963 740a 2020 2020 2020 2020 4120   dict.        A 
-0001b2f0: 6469 6374 696f 6e61 7279 206f 6620 6f6e  dictionary of on
-0001b300: 6520 6f72 206d 6f72 6520 7061 7261 6d65  e or more parame
-0001b310: 7465 7273 2074 6f20 7377 6565 7020 696e  ters to sweep in
-0001b320: 2074 6865 2078 2d64 6972 6563 7469 6f6e   the x-direction
-0001b330: 0a20 2020 2070 6172 616d 5f79 203a 2064  .    param_y : d
-0001b340: 6963 740a 2020 2020 2020 2020 4120 6469  ict.        A di
-0001b350: 6374 696f 6e61 7279 206f 6620 6f6e 6520  ctionary of one 
-0001b360: 6f72 206d 6f72 6520 7061 7261 6d65 7465  or more paramete
-0001b370: 7273 2074 6f20 7377 6565 7020 696e 2074  rs to sweep in t
-0001b380: 6865 2079 2d64 6972 6563 7469 6f6e 0a20  he y-direction. 
-0001b390: 2020 2070 6172 616d 5f64 6566 6175 6c74     param_default
-0001b3a0: 7320 3a20 6469 6374 0a20 2020 2020 2020  s : dict.       
-0001b3b0: 2044 6566 6175 6c74 2070 6172 616d 6574   Default paramet
-0001b3c0: 6572 7320 746f 2070 6173 7320 746f 2065  ers to pass to e
-0001b3d0: 7665 7279 2064 6576 6963 6520 696e 2074  very device in t
-0001b3e0: 6865 2067 7269 640a 2020 2020 7061 7261  he grid.    para
-0001b3f0: 6d5f 6f76 6572 7269 6465 203a 2064 6963  m_override : dic
-0001b400: 740a 2020 2020 2020 2020 5061 7261 6d65  t.        Parame
-0001b410: 7465 7273 2074 6861 7420 7769 6c6c 206f  ters that will o
-0001b420: 7665 7272 6964 6520 6070 6172 616d 5f64  verride `param_d
-0001b430: 6566 6175 6c74 7360 2c20 6571 7569 7661  efaults`, equiva
-0001b440: 6c65 6e74 2074 6f20 6368 616e 6769 6e67  lent to changing
-0001b450: 0a20 2020 2020 2020 2070 6172 616d 5f64  .        param_d
-0001b460: 6566 6175 6c74 7320 2875 7365 6675 6c20  efaults (useful 
-0001b470: 290a 2020 2020 7370 6163 696e 6720 3a20  ).    spacing : 
-0001b480: 696e 742c 2066 6c6f 6174 2c20 6f72 2061  int, float, or a
-0001b490: 7272 6179 2d6c 696b 655b 325d 206f 6620  rray-like[2] of 
-0001b4a0: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
-0001b4b0: 2020 2020 2053 7061 6369 6e67 2062 6574       Spacing bet
-0001b4c0: 7765 656e 2061 646a 6163 656e 7420 656c  ween adjacent el
-0001b4d0: 656d 656e 7473 206f 6e20 7468 6520 6772  ements on the gr
-0001b4e0: 6964 2c20 6361 6e20 6265 2061 2074 7570  id, can be a tup
-0001b4f0: 6c65 2066 6f72 0a20 2020 2020 2020 2064  le for.        d
-0001b500: 6966 6665 7265 6e74 2064 6973 7461 6e63  ifferent distanc
-0001b510: 6573 2069 6e20 7769 6474 6820 616e 6420  es in width and 
-0001b520: 6865 6967 6874 2028 782c 7929 2e0a 2020  height (x,y)..  
-0001b530: 2020 7365 7061 7261 7469 6f6e 203a 2062    separation : b
-0001b540: 6f6f 6c0a 2020 2020 2020 2020 4966 2054  ool.        If T
-0001b550: 7275 652c 2067 7561 7261 6e74 6565 7320  rue, guarantees 
-0001b560: 656c 656d 656e 7473 2061 7265 2073 6570  elements are sep
-0001b570: 6172 6174 6564 2077 6974 6820 6120 6669  arated with a fi
-0001b580: 7865 6420 7370 6163 696e 670a 2020 2020  xed spacing.    
-0001b590: 2020 2020 6265 7477 6565 6e3b 2069 6620      between; if 
-0001b5a0: 4661 6c73 652c 2065 6c65 6d65 6e74 7320  False, elements 
-0001b5b0: 6172 6520 7370 6163 6564 2065 7665 6e6c  are spaced evenl
-0001b5c0: 7920 616c 6f6e 6720 6120 6772 6964 2e0a  y along a grid..
-0001b5d0: 2020 2020 7368 6170 6520 3a20 6172 7261      shape : arra
-0001b5e0: 792d 6c69 6b65 5b32 5d0a 2020 2020 2020  y-like[2].      
-0001b5f0: 2020 782c 2079 2073 6861 7065 206f 6620    x, y shape of 
-0001b600: 7468 6520 6772 6964 2028 7365 6520 6e70  the grid (see np
-0001b610: 2e72 6573 6861 7065 292e 2049 6620 6e6f  .reshape). If no
-0001b620: 2073 6861 7065 2069 7320 6769 7665 6e20   shape is given 
-0001b630: 616e 6420 7468 650a 2020 2020 2020 2020  and the.        
-0001b640: 6c69 7374 2069 7320 3144 2c20 7468 6520  list is 1D, the 
-0001b650: 6f75 7470 7574 2069 7320 6173 2069 6620  output is as if 
-0001b660: 6e70 2e72 6573 6861 7065 2077 6572 6520  np.reshape were 
-0001b670: 7275 6e20 7769 7468 2028 312c 202d 3129  run with (1, -1)
-0001b680: 2e0a 2020 2020 616c 6967 6e5f 7820 3a20  ..    align_x : 
-0001b690: 7b27 7827 2c20 2778 6d69 6e27 2c20 2778  {'x', 'xmin', 'x
-0001b6a0: 6d61 7827 7d0a 2020 2020 2020 2020 5768  max'}.        Wh
-0001b6b0: 6963 6820 6564 6765 2074 6f20 7065 7266  ich edge to perf
-0001b6c0: 6f72 6d20 7468 6520 7820 2863 6f6c 756d  orm the x (colum
-0001b6d0: 6e29 2061 6c69 676e 6d65 6e74 2061 6c6f  n) alignment alo
-0001b6e0: 6e67 0a20 2020 2061 6c69 676e 5f79 203a  ng.    align_y :
-0001b6f0: 207b 2779 272c 2027 796d 696e 272c 2027   {'y', 'ymin', '
-0001b700: 796d 6178 277d 0a20 2020 2020 2020 2057  ymax'}.        W
-0001b710: 6869 6368 2065 6467 6520 746f 2070 6572  hich edge to per
-0001b720: 666f 726d 2074 6865 2079 2028 726f 7729  form the y (row)
-0001b730: 2061 6c69 676e 6d65 6e74 2061 6c6f 6e67   alignment along
-0001b740: 0a20 2020 2065 6467 655f 7820 3a20 7b27  .    edge_x : {'
-0001b750: 7827 2c20 2778 6d69 6e27 2c20 2778 6d61  x', 'xmin', 'xma
-0001b760: 7827 7d0a 2020 2020 2020 2020 5768 6963  x'}.        Whic
-0001b770: 6820 6564 6765 2074 6f20 7065 7266 6f72  h edge to perfor
-0001b780: 6d20 7468 6520 7820 2863 6f6c 756d 6e29  m the x (column)
-0001b790: 2064 6973 7472 6962 7574 696f 6e20 616c   distribution al
-0001b7a0: 6f6e 6720 2875 6e75 7365 6420 6966 0a20  ong (unused if. 
-0001b7b0: 2020 2020 2020 2073 6570 6172 6174 696f         separatio
-0001b7c0: 6e20 3d3d 2054 7275 6529 0a20 2020 2065  n == True).    e
-0001b7d0: 6467 655f 7920 3a20 7b27 7927 2c20 2779  dge_y : {'y', 'y
-0001b7e0: 6d69 6e27 2c20 2779 6d61 7827 7d0a 2020  min', 'ymax'}.  
-0001b7f0: 2020 2020 2020 5768 6963 6820 6564 6765        Which edge
-0001b800: 2074 6f20 7065 7266 6f72 6d20 7468 6520   to perform the 
-0001b810: 7920 2872 6f77 2920 6469 7374 7269 6275  y (row) distribu
-0001b820: 7469 6f6e 2061 6c6f 6e67 2028 756e 7573  tion along (unus
-0001b830: 6564 2069 660a 2020 2020 2020 2020 7365  ed if.        se
-0001b840: 7061 7261 7469 6f6e 203d 3d20 5472 7565  paration == True
-0001b850: 290a 2020 2020 6c61 6265 6c5f 6c61 7965  ).    label_laye
-0001b860: 7220 3a20 4e6f 6e65 206f 7220 6c61 7965  r : None or laye
-0001b870: 720a 2020 2020 2020 2020 4966 206e 6f74  r.        If not
-0001b880: 204e 6f6e 652c 2077 696c 6c20 706c 6163   None, will plac
-0001b890: 6520 6120 6c61 6265 6c20 7468 6174 2064  e a label that d
-0001b8a0: 6573 6372 6962 6573 2074 6865 2070 6172  escribes the par
-0001b8b0: 616d 6574 6572 7320 6f6e 2074 6865 2064  ameters on the d
-0001b8c0: 6576 6963 650a 0a20 2020 2052 6574 7572  evice..    Retur
-0001b8d0: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
-0001b8e0: 2020 2064 6576 6963 655f 6d61 7472 6978     device_matrix
-0001b8f0: 203a 2044 6576 6963 650a 2020 2020 2020   : Device.      
-0001b900: 2020 4120 4465 7669 6365 2063 6f6e 7461    A Device conta
-0001b910: 696e 696e 6720 616c 6c20 7468 6520 4465  ining all the De
-0001b920: 7669 6365 7320 696e 2060 6465 7669 6365  vices in `device
-0001b930: 5f6c 6973 7460 2069 6e20 6120 6772 6964  _list` in a grid
-0001b940: 2e0a 2020 2020 2222 220a 0a20 2020 2070  ..    """..    p
-0001b950: 6172 616d 5f76 6172 6961 7469 6f6e 7320  aram_variations 
-0001b960: 3d20 4f72 6465 7265 6444 6963 7428 290a  = OrderedDict().
-0001b970: 2020 2020 7061 7261 6d5f 7661 7269 6174      param_variat
-0001b980: 696f 6e73 2e75 7064 6174 6528 7061 7261  ions.update(para
-0001b990: 6d5f 7929 0a20 2020 2070 6172 616d 5f76  m_y).    param_v
-0001b9a0: 6172 6961 7469 6f6e 732e 7570 6461 7465  ariations.update
-0001b9b0: 2870 6172 616d 5f78 290a 0a20 2020 2044  (param_x)..    D
-0001b9c0: 5f6c 6973 7420 3d20 5f67 656e 5f70 6172  _list = _gen_par
-0001b9d0: 616d 5f76 6172 6961 7469 6f6e 7328 0a20  am_variations(. 
-0001b9e0: 2020 2020 2020 2066 756e 6374 696f 6e3d         function=
-0001b9f0: 6675 6e63 7469 6f6e 2c0a 2020 2020 2020  function,.      
-0001ba00: 2020 7061 7261 6d5f 7661 7269 6174 696f    param_variatio
-0001ba10: 6e73 3d70 6172 616d 5f76 6172 6961 7469  ns=param_variati
-0001ba20: 6f6e 732c 0a20 2020 2020 2020 2070 6172  ons,.        par
-0001ba30: 616d 5f64 6566 6175 6c74 733d 7061 7261  am_defaults=para
-0001ba40: 6d5f 6465 6661 756c 7473 2c0a 2020 2020  m_defaults,.    
-0001ba50: 2020 2020 7061 7261 6d5f 6f76 6572 7269      param_overri
-0001ba60: 6465 3d70 6172 616d 5f6f 7665 7272 6964  de=param_overrid
-0001ba70: 652c 0a20 2020 2020 2020 206c 6162 656c  e,.        label
-0001ba80: 5f6c 6179 6572 3d6c 6162 656c 5f6c 6179  _layer=label_lay
-0001ba90: 6572 2c0a 2020 2020 290a 0a20 2020 206e  er,.    )..    n
-0001baa0: 756d 5f78 5f70 6172 616d 6574 6572 7320  um_x_parameters 
-0001bab0: 3d20 6c65 6e28 5f70 6172 616d 6574 6572  = len(_parameter
-0001bac0: 5f63 6f6d 6269 6e61 7469 6f6e 7328 7061  _combinations(pa
-0001bad0: 7261 6d5f 7829 290a 2020 2020 6e75 6d5f  ram_x)).    num_
-0001bae0: 795f 7061 7261 6d65 7465 7273 203d 206c  y_parameters = l
-0001baf0: 656e 285f 7061 7261 6d65 7465 725f 636f  en(_parameter_co
-0001bb00: 6d62 696e 6174 696f 6e73 2870 6172 616d  mbinations(param
-0001bb10: 5f79 2929 0a20 2020 2044 203d 2067 7269  _y)).    D = gri
-0001bb20: 6428 0a20 2020 2020 2020 2044 5f6c 6973  d(.        D_lis
-0001bb30: 742c 0a20 2020 2020 2020 2073 7061 6369  t,.        spaci
-0001bb40: 6e67 3d73 7061 6369 6e67 2c0a 2020 2020  ng=spacing,.    
-0001bb50: 2020 2020 7365 7061 7261 7469 6f6e 3d73      separation=s
-0001bb60: 6570 6172 6174 696f 6e2c 0a20 2020 2020  eparation,.     
-0001bb70: 2020 2073 6861 7065 3d28 6e75 6d5f 785f     shape=(num_x_
-0001bb80: 7061 7261 6d65 7465 7273 2c20 6e75 6d5f  parameters, num_
-0001bb90: 795f 7061 7261 6d65 7465 7273 292c 0a20  y_parameters),. 
-0001bba0: 2020 2020 2020 2061 6c69 676e 5f78 3d61         align_x=a
-0001bbb0: 6c69 676e 5f78 2c0a 2020 2020 2020 2020  lign_x,.        
-0001bbc0: 616c 6967 6e5f 793d 616c 6967 6e5f 792c  align_y=align_y,
-0001bbd0: 0a20 2020 2020 2020 2065 6467 655f 783d  .        edge_x=
-0001bbe0: 6564 6765 5f78 2c0a 2020 2020 2020 2020  edge_x,.        
-0001bbf0: 6564 6765 5f79 3d65 6467 655f 792c 0a20  edge_y=edge_y,. 
-0001bc00: 2020 2029 0a0a 2020 2020 6c61 6265 6c5f     )..    label_
-0001bc10: 7465 7874 203d 207b 7d0a 2020 2020 6c61  text = {}.    la
-0001bc20: 6265 6c5f 7465 7874 2e75 7064 6174 6528  bel_text.update(
-0001bc30: 7061 7261 6d5f 6465 6661 756c 7473 290a  param_defaults).
-0001bc40: 2020 2020 6c61 6265 6c5f 7465 7874 2e75      label_text.u
-0001bc50: 7064 6174 6528 7061 7261 6d5f 6f76 6572  pdate(param_over
-0001bc60: 7269 6465 290a 2020 2020 6966 206c 6162  ride).    if lab
-0001bc70: 656c 5f6c 6179 6572 2069 7320 6e6f 7420  el_layer is not 
-0001bc80: 4e6f 6e65 3a0a 2020 2020 2020 2020 442e  None:.        D.
-0001bc90: 6164 645f 6c61 6265 6c28 7465 7874 3d73  add_label(text=s
-0001bca0: 7472 286c 6162 656c 5f74 6578 7429 2c20  tr(label_text), 
-0001bcb0: 706f 7369 7469 6f6e 3d28 442e 786d 696e  position=(D.xmin
-0001bcc0: 2c20 442e 796d 696e 292c 206c 6179 6572  , D.ymin), layer
-0001bcd0: 3d6c 6162 656c 5f6c 6179 6572 290a 0a20  =label_layer).. 
-0001bce0: 2020 2072 6574 7572 6e20 440a 0a0a 6465     return D...de
-0001bcf0: 6620 5f70 6163 6b5f 7369 6e67 6c65 5f62  f _pack_single_b
-0001bd00: 696e 280a 2020 2020 7265 6374 5f64 6963  in(.    rect_dic
-0001bd10: 742c 2061 7370 6563 745f 7261 7469 6f2c  t, aspect_ratio,
-0001bd20: 206d 6178 5f73 697a 652c 2073 6f72 745f   max_size, sort_
-0001bd30: 6279 5f61 7265 612c 2064 656e 7369 7479  by_area, density
-0001bd40: 2c20 7072 6563 6973 696f 6e2c 2076 6572  , precision, ver
-0001bd50: 626f 7365 0a29 3a0a 2020 2020 2222 2254  bose.):.    """T
-0001bd60: 616b 6573 2061 2060 7265 6374 5f64 6963  akes a `rect_dic
-0001bd70: 7460 2061 7267 756d 656e 7420 6f66 2074  t` argument of t
-0001bd80: 6865 2066 6f72 6d20 7b69 643a 2877 2c20  he form {id:(w, 
-0001bd90: 6829 7d20 616e 6420 7472 6965 7320 746f  h)} and tries to
-0001bda0: 0a20 2020 2070 6163 6b20 6974 2069 6e74  .    pack it int
-0001bdb0: 6f20 6120 6269 6e20 6173 2073 6d61 6c6c  o a bin as small
-0001bdc0: 2061 7320 706f 7373 6962 6c65 2077 6974   as possible wit
-0001bdd0: 6820 6173 7065 6374 2072 6174 696f 2060  h aspect ratio `
-0001bde0: 6173 7065 6374 5f72 6174 696f 602e 0a20  aspect_ratio`.. 
-0001bdf0: 2020 2057 696c 6c20 6974 6572 6174 6976     Will iterativ
-0001be00: 656c 7920 6772 6f77 2074 6865 2062 696e  ely grow the bin
-0001be10: 2073 697a 6520 756e 7469 6c20 6576 6572   size until ever
-0001be20: 7974 6869 6e67 2066 6974 7320 6f72 2074  ything fits or t
-0001be30: 6865 2062 696e 2073 697a 650a 2020 2020  he bin size.    
-0001be40: 7265 6163 6865 7320 606d 6178 5f73 697a  reaches `max_siz
-0001be50: 6560 2e20 5265 7475 726e 7320 6120 6469  e`. Returns a di
-0001be60: 6374 696f 6e61 7279 206f 6620 7468 6520  ctionary of the 
-0001be70: 7061 636b 6564 2072 6563 7461 6e67 6c65  packed rectangle
-0001be80: 736e 2069 6e20 7468 650a 2020 2020 666f  sn in the.    fo
-0001be90: 726d 207b 6964 3a28 782c 2079 2c20 772c  rm {id:(x, y, w,
-0001bea0: 2068 297d 2c20 616e 6420 6120 6469 6374   h)}, and a dict
-0001beb0: 696f 6e61 7279 206f 6620 7265 6d61 696e  ionary of remain
-0001bec0: 696e 6720 756e 7061 636b 6564 2072 6563  ing unpacked rec
-0001bed0: 7473 2e0a 2020 2020 2222 220a 2020 2020  ts..    """.    
-0001bee0: 7472 793a 0a20 2020 2020 2020 2069 6d70  try:.        imp
-0001bef0: 6f72 7420 7265 6374 7061 636b 0a20 2020  ort rectpack.   
-0001bf00: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-0001bf10: 6e3a 0a20 2020 2020 2020 2072 6169 7365  n:.        raise
-0001bf20: 2049 6d70 6f72 7445 7272 6f72 280a 2020   ImportError(.  
-0001bf30: 2020 2020 2020 2020 2020 225b 5048 4944            "[PHID
-0001bf40: 4c5d 2054 6865 2070 6163 6b65 7228 2920  L] The packer() 
-0001bf50: 6675 6e63 7469 6f6e 2072 6571 7569 7265  function require
-0001bf60: 7320 7468 6520 220a 2020 2020 2020 2020  s the ".        
-0001bf70: 2020 2020 276d 6f64 756c 6520 2272 6563      'module "rec
-0001bf80: 7470 6163 6b22 2074 6f20 6f70 6572 6174  tpack" to operat
-0001bf90: 652e 2020 506c 6561 7365 2072 6574 7279  e.  Please retry
-0001bfa0: 2027 0a20 2020 2020 2020 2020 2020 2022   '.            "
-0001bfb0: 6166 7465 7220 696e 7374 616c 6c69 6e67  after installing
-0001bfc0: 2072 6563 7470 6163 6b3a 5c6e 5c6e 220a   rectpack:\n\n".
-0001bfd0: 2020 2020 2020 2020 2020 2020 2224 2070              "$ p
-0001bfe0: 6970 2069 6e73 7461 6c6c 2072 6563 7470  ip install rectp
-0001bff0: 6163 6b22 0a20 2020 2020 2020 2029 0a0a  ack".        )..
-0001c000: 2020 2020 2320 436f 6d70 7574 6520 746f      # Compute to
-0001c010: 7461 6c20 6172 6561 2061 6e64 2075 7365  tal area and use
-0001c020: 2069 7420 666f 7220 616e 2069 6e69 7469   it for an initi
-0001c030: 616c 2065 7374 696d 6174 6520 6f66 2074  al estimate of t
-0001c040: 6865 2062 696e 2073 697a 650a 2020 2020  he bin size.    
-0001c050: 746f 7461 6c5f 6172 6561 203d 2030 0a20  total_area = 0. 
-0001c060: 2020 2066 6f72 2072 2069 6e20 7265 6374     for r in rect
-0001c070: 5f64 6963 742e 7661 6c75 6573 2829 3a0a  _dict.values():.
-0001c080: 2020 2020 2020 2020 746f 7461 6c5f 6172          total_ar
-0001c090: 6561 202b 3d20 725b 305d 202a 2072 5b31  ea += r[0] * r[1
-0001c0a0: 5d0a 2020 2020 2320 4e6f 726d 616c 697a  ].    # Normaliz
-0001c0b0: 650a 2020 2020 6173 7065 6374 5f72 6174  e.    aspect_rat
-0001c0c0: 696f 203d 206e 702e 6173 6172 7261 7928  io = np.asarray(
-0001c0d0: 6173 7065 6374 5f72 6174 696f 2920 2f20  aspect_ratio) / 
-0001c0e0: 6e70 2e6c 696e 616c 672e 6e6f 726d 2861  np.linalg.norm(a
-0001c0f0: 7370 6563 745f 7261 7469 6f29 0a0a 2020  spect_ratio)..  
-0001c100: 2020 2320 5365 7475 7020 7661 7269 6162    # Setup variab
-0001c110: 6c65 730a 2020 2020 626f 785f 7369 7a65  les.    box_size
-0001c120: 203d 206e 702e 6173 6172 7261 7928 6173   = np.asarray(as
-0001c130: 7065 6374 5f72 6174 696f 202a 206e 702e  pect_ratio * np.
-0001c140: 7371 7274 2874 6f74 616c 5f61 7265 6129  sqrt(total_area)
-0001c150: 2c20 6474 7970 653d 6e70 2e66 6c6f 6174  , dtype=np.float
-0001c160: 3634 290a 2020 2020 626f 785f 7369 7a65  64).    box_size
-0001c170: 203d 206e 702e 636c 6970 2862 6f78 5f73   = np.clip(box_s
-0001c180: 697a 652c 204e 6f6e 652c 206d 6178 5f73  ize, None, max_s
-0001c190: 697a 6529 0a20 2020 2069 6620 736f 7274  ize).    if sort
-0001c1a0: 5f62 795f 6172 6561 3a0a 2020 2020 2020  _by_area:.      
-0001c1b0: 2020 7270 5f73 6f72 7420 3d20 7265 6374    rp_sort = rect
-0001c1c0: 7061 636b 2e53 4f52 545f 4152 4541 0a20  pack.SORT_AREA. 
-0001c1d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001c1e0: 2072 705f 736f 7274 203d 2072 6563 7470   rp_sort = rectp
-0001c1f0: 6163 6b2e 534f 5254 5f4e 4f4e 450a 0a20  ack.SORT_NONE.. 
-0001c200: 2020 2023 2052 6570 6561 7465 646c 7920     # Repeatedly 
-0001c210: 7275 6e20 7468 6520 7265 6374 616e 676c  run the rectangl
-0001c220: 652d 7061 636b 696e 6720 616c 676f 7269  e-packing algori
-0001c230: 7468 6d20 7769 7468 2069 6e63 7265 6173  thm with increas
-0001c240: 696e 676c 7920 6c61 7267 6572 0a20 2020  ingly larger.   
-0001c250: 2023 2061 7265 6173 2075 6e74 696c 2065   # areas until e
-0001c260: 7665 7279 7468 696e 6720 6669 7473 206f  verything fits o
-0001c270: 7220 7765 2776 6520 7265 6163 6865 6420  r we've reached 
-0001c280: 7468 6520 6d61 7869 6d75 6d20 7369 7a65  the maximum size
-0001c290: 0a20 2020 2077 6869 6c65 2054 7275 653a  .    while True:
-0001c2a0: 0a20 2020 2020 2020 2023 2043 7265 6174  .        # Creat
-0001c2b0: 6520 7468 6520 7061 636b 6572 206f 626a  e the packer obj
-0001c2c0: 6563 740a 2020 2020 2020 2020 7265 6374  ect.        rect
-0001c2d0: 5f70 6163 6b65 7220 3d20 7265 6374 7061  _packer = rectpa
-0001c2e0: 636b 2e6e 6577 5061 636b 6572 280a 2020  ck.newPacker(.  
-0001c2f0: 2020 2020 2020 2020 2020 6d6f 6465 3d72            mode=r
-0001c300: 6563 7470 6163 6b2e 5061 636b 696e 674d  ectpack.PackingM
-0001c310: 6f64 652e 4f66 666c 696e 652c 0a20 2020  ode.Offline,.   
-0001c320: 2020 2020 2020 2020 2070 6163 6b5f 616c           pack_al
-0001c330: 676f 3d72 6563 7470 6163 6b2e 4d61 7852  go=rectpack.MaxR
-0001c340: 6563 7473 426c 7366 2c0a 2020 2020 2020  ectsBlsf,.      
-0001c350: 2020 2020 2020 736f 7274 5f61 6c67 6f3d        sort_algo=
-0001c360: 7270 5f73 6f72 742c 0a20 2020 2020 2020  rp_sort,.       
-0001c370: 2020 2020 2062 696e 5f61 6c67 6f3d 7265       bin_algo=re
-0001c380: 6374 7061 636b 2e50 6163 6b69 6e67 4269  ctpack.PackingBi
-0001c390: 6e2e 4242 462c 0a20 2020 2020 2020 2020  n.BBF,.         
-0001c3a0: 2020 2072 6f74 6174 696f 6e3d 4661 6c73     rotation=Fals
-0001c3b0: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
-0001c3c0: 2020 2020 2020 2320 4164 6420 6561 6368        # Add each
-0001c3d0: 2072 6563 7461 6e67 6c65 2074 6f20 7468   rectangle to th
-0001c3e0: 6520 7061 636b 6572 2c20 6372 6561 7465  e packer, create
-0001c3f0: 2061 2073 696e 676c 6520 6269 6e2c 2061   a single bin, a
-0001c400: 6e64 2070 6163 6b0a 2020 2020 2020 2020  nd pack.        
-0001c410: 666f 7220 7269 642c 2072 2069 6e20 7265  for rid, r in re
-0001c420: 6374 5f64 6963 742e 6974 656d 7328 293a  ct_dict.items():
-0001c430: 0a20 2020 2020 2020 2020 2020 2072 6563  .            rec
-0001c440: 745f 7061 636b 6572 2e61 6464 5f72 6563  t_packer.add_rec
-0001c450: 7428 7769 6474 683d 725b 305d 2c20 6865  t(width=r[0], he
-0001c460: 6967 6874 3d72 5b31 5d2c 2072 6964 3d72  ight=r[1], rid=r
-0001c470: 6964 290a 2020 2020 2020 2020 7265 6374  id).        rect
-0001c480: 5f70 6163 6b65 722e 6164 645f 6269 6e28  _packer.add_bin(
-0001c490: 7769 6474 683d 626f 785f 7369 7a65 5b30  width=box_size[0
-0001c4a0: 5d2c 2068 6569 6768 743d 626f 785f 7369  ], height=box_si
-0001c4b0: 7a65 5b31 5d29 0a20 2020 2020 2020 2072  ze[1]).        r
-0001c4c0: 6563 745f 7061 636b 6572 2e70 6163 6b28  ect_packer.pack(
-0001c4d0: 290a 0a20 2020 2020 2020 2023 2041 646a  )..        # Adj
-0001c4e0: 7573 7420 7468 6520 626f 7820 7369 7a65  ust the box size
-0001c4f0: 2066 6f72 206e 6578 7420 7469 6d65 0a20   for next time. 
-0001c500: 2020 2020 2020 2062 6f78 5f73 697a 6520         box_size 
-0001c510: 2a3d 2064 656e 7369 7479 2020 2320 496e  *= density  # In
-0001c520: 6372 6561 7365 2061 7265 6120 746f 2074  crease area to t
-0001c530: 7279 2074 6f20 6669 740a 2020 2020 2020  ry to fit.      
-0001c540: 2020 626f 785f 7369 7a65 203d 206e 702e    box_size = np.
-0001c550: 636c 6970 2862 6f78 5f73 697a 652c 204e  clip(box_size, N
-0001c560: 6f6e 652c 206d 6178 5f73 697a 6529 0a20  one, max_size). 
-0001c570: 2020 2020 2020 2069 6620 7665 7262 6f73         if verbos
-0001c580: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-0001c590: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
-0001c5a0: 2020 2020 2020 2254 7279 696e 6720 746f        "Trying to
-0001c5b0: 2070 6163 6b20 696e 2062 696e 2073 697a   pack in bin siz
-0001c5c0: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
-0001c5d0: 2020 2020 2228 2530 2e32 662c 2025 302e      "(%0.2f, %0.
-0001c5e0: 3266 2922 2025 2074 7570 6c65 2862 6f78  2f)" % tuple(box
-0001c5f0: 5f73 697a 6520 2a20 7072 6563 6973 696f  _size * precisio
-0001c600: 6e29 0a20 2020 2020 2020 2020 2020 2029  n).            )
-0001c610: 0a0a 2020 2020 2020 2020 2320 5175 6974  ..        # Quit
-0001c620: 2074 6865 206c 6f6f 7020 6966 2077 6527   the loop if we'
-0001c630: 7665 2070 6163 6b65 6420 616c 6c20 7468  ve packed all th
-0001c640: 6520 7265 6374 616e 676c 6573 0a20 2020  e rectangles.   
-0001c650: 2020 2020 2023 206f 7220 7265 6163 6865       # or reache
-0001c660: 6420 7468 6520 6d61 7820 7369 7a65 0a20  d the max size. 
-0001c670: 2020 2020 2020 2069 6620 6c65 6e28 7265         if len(re
-0001c680: 6374 5f70 6163 6b65 722e 7265 6374 5f6c  ct_packer.rect_l
-0001c690: 6973 7428 2929 203d 3d20 6c65 6e28 7265  ist()) == len(re
-0001c6a0: 6374 5f64 6963 7429 3a0a 2020 2020 2020  ct_dict):.      
-0001c6b0: 2020 2020 2020 6966 2076 6572 626f 7365        if verbose
-0001c6c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c6d0: 2020 7072 696e 7428 2253 7563 6365 7373    print("Success
-0001c6e0: 2122 290a 2020 2020 2020 2020 2020 2020  !").            
-0001c6f0: 6272 6561 6b0a 2020 2020 2020 2020 656c  break.        el
-0001c700: 6966 2061 6c6c 2862 6f78 5f73 697a 6520  if all(box_size 
-0001c710: 3e3d 206d 6178 5f73 697a 6529 3a0a 2020  >= max_size):.  
-0001c720: 2020 2020 2020 2020 2020 6966 2076 6572            if ver
-0001c730: 626f 7365 3a0a 2020 2020 2020 2020 2020  bose:.          
-0001c740: 2020 2020 2020 7072 696e 7428 2252 6561        print("Rea
-0001c750: 6368 6564 206d 6178 5f73 697a 652c 2063  ched max_size, c
-0001c760: 7265 6174 696e 6720 2220 2261 6e20 6164  reating " "an ad
-0001c770: 6469 7469 6f6e 616c 2062 696e 2229 0a20  ditional bin"). 
-0001c780: 2020 2020 2020 2020 2020 2062 7265 616b             break
-0001c790: 0a0a 2020 2020 2320 5365 7061 7261 7465  ..    # Separate
-0001c7a0: 2070 6163 6b65 6420 6672 6f6d 2075 6e70   packed from unp
-0001c7b0: 6163 6b65 6420 7265 6374 616e 676c 6573  acked rectangles
-0001c7c0: 2c20 6d61 6b65 2064 6963 7473 206f 6620  , make dicts of 
-0001c7d0: 666f 726d 0a20 2020 2023 207b 6964 3a28  form.    # {id:(
-0001c7e0: 782c 792c 772c 6829 7d0a 2020 2020 7061  x,y,w,h)}.    pa
-0001c7f0: 636b 6564 5f72 6563 745f 6469 6374 203d  cked_rect_dict =
-0001c800: 207b 725b 2d31 5d3a 2072 5b3a 2d31 5d20   {r[-1]: r[:-1] 
-0001c810: 666f 7220 7220 696e 2072 6563 745f 7061  for r in rect_pa
-0001c820: 636b 6572 5b30 5d2e 7265 6374 5f6c 6973  cker[0].rect_lis
-0001c830: 7428 297d 0a20 2020 2075 6e70 6163 6b65  t()}.    unpacke
-0001c840: 645f 7265 6374 5f64 6963 7420 3d20 7b7d  d_rect_dict = {}
-0001c850: 0a20 2020 2066 6f72 206b 2c20 7620 696e  .    for k, v in
-0001c860: 2072 6563 745f 6469 6374 2e69 7465 6d73   rect_dict.items
-0001c870: 2829 3a0a 2020 2020 2020 2020 6966 206b  ():.        if k
-0001c880: 206e 6f74 2069 6e20 7061 636b 6564 5f72   not in packed_r
-0001c890: 6563 745f 6469 6374 3a0a 2020 2020 2020  ect_dict:.      
-0001c8a0: 2020 2020 2020 756e 7061 636b 6564 5f72        unpacked_r
-0001c8b0: 6563 745f 6469 6374 5b6b 5d20 3d20 760a  ect_dict[k] = v.
-0001c8c0: 0a20 2020 2072 6574 7572 6e20 2870 6163  .    return (pac
-0001c8d0: 6b65 645f 7265 6374 5f64 6963 742c 2075  ked_rect_dict, u
-0001c8e0: 6e70 6163 6b65 645f 7265 6374 5f64 6963  npacked_rect_dic
-0001c8f0: 7429 0a0a 0a64 6566 2070 6163 6b65 7228  t)...def packer(
-0001c900: 0a20 2020 2044 5f6c 6973 742c 0a20 2020  .    D_list,.   
-0001c910: 2073 7061 6369 6e67 3d31 302c 0a20 2020   spacing=10,.   
-0001c920: 2061 7370 6563 745f 7261 7469 6f3d 2831   aspect_ratio=(1
-0001c930: 2c20 3129 2c0a 2020 2020 6d61 785f 7369  , 1),.    max_si
-0001c940: 7a65 3d28 4e6f 6e65 2c20 4e6f 6e65 292c  ze=(None, None),
-0001c950: 0a20 2020 2073 6f72 745f 6279 5f61 7265  .    sort_by_are
-0001c960: 613d 5472 7565 2c0a 2020 2020 6465 6e73  a=True,.    dens
-0001c970: 6974 793d 312e 312c 0a20 2020 2070 7265  ity=1.1,.    pre
-0001c980: 6369 7369 6f6e 3d31 652d 322c 0a20 2020  cision=1e-2,.   
-0001c990: 2076 6572 626f 7365 3d46 616c 7365 2c0a   verbose=False,.
-0001c9a0: 293a 0a20 2020 2022 2222 5061 636b 7320  ):.    """Packs 
-0001c9b0: 6765 6f6d 6574 7269 6573 2074 6f67 6574  geometries toget
-0001c9c0: 6865 7220 696e 746f 2072 6563 7461 6e67  her into rectang
-0001c9d0: 756c 6172 2062 696e 732e 0a0a 2020 2020  ular bins...    
-0001c9e0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-0001c9f0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 445f  ---------.    D_
-0001ca00: 6c69 7374 203a 2061 7272 6179 2d6c 696b  list : array-lik
-0001ca10: 6520 6f66 2044 6576 6963 6573 0a20 2020  e of Devices.   
-0001ca20: 2020 2020 2049 6e70 7574 2044 6576 6963       Input Devic
-0001ca30: 6573 2074 6f20 6265 2070 6163 6b65 642e  es to be packed.
-0001ca40: 0a20 2020 2073 7061 6369 6e67 203a 2069  .    spacing : i
-0001ca50: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
-0001ca60: 2020 2020 5468 6520 6d69 6e69 6d75 6d20      The minimum 
-0001ca70: 6469 7374 616e 6365 2062 6574 7765 656e  distance between
-0001ca80: 2061 646a 6163 656e 7420 7368 6170 6573   adjacent shapes
-0001ca90: 2e0a 2020 2020 6173 7065 6374 5f72 6174  ..    aspect_rat
-0001caa0: 696f 203a 2061 7272 6179 2d6c 696b 650a  io : array-like.
-0001cab0: 2020 2020 2020 2020 5468 6520 2877 6964          The (wid
-0001cac0: 7468 2c20 6865 6967 6874 2920 7261 7469  th, height) rati
-0001cad0: 6f20 6f66 2074 6865 2072 6563 7461 6e67  o of the rectang
-0001cae0: 756c 6172 2062 696e 2e0a 2020 2020 6d61  ular bin..    ma
-0001caf0: 785f 7369 7a65 203a 2061 7272 6179 2d6c  x_size : array-l
-0001cb00: 696b 650a 2020 2020 2020 2020 4c69 6d69  ike.        Limi
-0001cb10: 7473 2074 6865 2073 697a 6520 696e 746f  ts the size into
-0001cb20: 2077 6869 6368 2074 6865 2073 6861 7065   which the shape
-0001cb30: 7320 7769 6c6c 2062 6520 7061 636b 6564  s will be packed
-0001cb40: 2e0a 2020 2020 736f 7274 5f62 795f 6172  ..    sort_by_ar
-0001cb50: 6561 203a 2062 6f6f 6c0a 2020 2020 2020  ea : bool.      
-0001cb60: 2020 4966 2074 7275 652c 2070 7265 2d73    If true, pre-s
-0001cb70: 6f72 7473 2074 6865 2073 6861 7065 7320  orts the shapes 
-0001cb80: 6279 2061 7265 612e 0a20 2020 2064 656e  by area..    den
-0001cb90: 7369 7479 203a 2069 6e74 206f 7220 666c  sity : int or fl
-0001cba0: 6f61 740a 2020 2020 2020 2020 4465 6e73  oat.        Dens
-0001cbb0: 6974 7920 6f66 2070 6163 6b69 6e67 2e20  ity of packing. 
-0001cbc0: 5661 6c75 6573 2063 6c6f 7365 7220 746f  Values closer to
-0001cbd0: 2031 2070 6163 6b20 7469 6768 7465 7220   1 pack tighter 
-0001cbe0: 6275 7420 7265 7175 6972 6520 6d6f 7265  but require more
-0001cbf0: 0a20 2020 2020 2020 2063 6f6d 7075 7461  .        computa
-0001cc00: 7469 6f6e 2e0a 2020 2020 7072 6563 6973  tion..    precis
-0001cc10: 696f 6e20 3a20 666c 6f61 740a 2020 2020  ion : float.    
-0001cc20: 2020 2020 4465 7369 7265 6420 7072 6563      Desired prec
-0001cc30: 6973 696f 6e20 666f 7220 726f 756e 6469  ision for roundi
-0001cc40: 6e67 2076 6572 7465 7820 636f 6f72 6469  ng vertex coordi
-0001cc50: 6e61 7465 732e 0a20 2020 2076 6572 626f  nates..    verbo
-0001cc60: 7365 203a 2062 6f6f 6c0a 2020 2020 2020  se : bool.      
-0001cc70: 2020 5768 6574 6865 7220 746f 2064 6973    Whether to dis
-0001cc80: 706c 6179 2072 6573 756c 7473 206f 6620  play results of 
-0001cc90: 7061 636b 696e 6720 6174 7465 6d70 7473  packing attempts
-0001cca0: 0a0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
-0001ccb0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2044     -------.    D
-0001ccc0: 5f70 6163 6b65 645f 6c69 7374 203a 2044  _packed_list : D
-0001ccd0: 6576 6963 6520 6f72 206c 6973 7420 6f66  evice or list of
-0001cce0: 2044 6576 6963 6573 0a20 2020 2020 2020   Devices.       
-0001ccf0: 2041 2044 6576 6963 6520 6f72 206c 6973   A Device or lis
-0001cd00: 7420 6f66 2044 6576 6963 6573 2063 6f6e  t of Devices con
-0001cd10: 7461 696e 696e 6720 616c 6c20 7468 6520  taining all the 
-0001cd20: 7061 636b 6564 2072 6563 7461 6e67 756c  packed rectangul
-0001cd30: 6172 0a20 2020 2020 2020 2062 696e 7320  ar.        bins 
-0001cd40: 6765 6e65 7261 7465 642e 0a0a 2020 2020  generated...    
-0001cd50: 4e6f 7465 730a 2020 2020 2d2d 2d2d 2d0a  Notes.    -----.
-0001cd60: 2020 2020 4966 2061 206d 6178 2d73 697a      If a max-siz
-0001cd70: 6520 6973 2073 7065 6369 6669 6564 2c20  e is specified, 
-0001cd80: 7468 6520 6675 6e63 7469 6f6e 2077 696c  the function wil
-0001cd90: 6c20 6372 6561 7465 2061 7320 6d61 6e79  l create as many
-0001cda0: 2062 696e 7320 6173 0a20 2020 206e 6563   bins as.    nec
-0001cdb0: 6573 7361 7279 2074 6f20 7061 636b 2061  essary to pack a
-0001cdc0: 6c6c 2074 6865 2067 656f 6d65 7472 6965  ll the geometrie
-0001cdd0: 7320 616e 6420 7468 656e 2072 6574 7572  s and then retur
-0001cde0: 6e20 6120 6c69 7374 206f 6620 7468 650a  n a list of the.
-0001cdf0: 2020 2020 6669 6c6c 6564 2d62 696e 2044      filled-bin D
-0001ce00: 6576 6963 6573 2e0a 2020 2020 2222 220a  evices..    """.
-0001ce10: 2020 2020 6966 2064 656e 7369 7479 203c      if density <
-0001ce20: 2031 2e30 313a 0a20 2020 2020 2020 2072   1.01:.        r
-0001ce30: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-0001ce40: 0a20 2020 2020 2020 2020 2020 2022 5b50  .            "[P
-0001ce50: 4849 444c 5d20 7061 636b 6572 2829 2077  HIDL] packer() w
-0001ce60: 6173 2067 6976 656e 2061 2060 6465 6e73  as given a `dens
-0001ce70: 6974 7960 2061 7267 756d 656e 7420 220a  ity` argument ".
-0001ce80: 2020 2020 2020 2020 2020 2020 2274 6861              "tha
-0001ce90: 7420 6973 2074 6f6f 2073 6d61 6c6c 2e20  t is too small. 
-0001cea0: 2054 6865 2064 656e 7369 7479 2061 7267   The density arg
-0001ceb0: 756d 656e 7420 6d75 7374 2062 6520 220a  ument must be ".
-0001cec0: 2020 2020 2020 2020 2020 2020 223e 3d20              ">= 
-0001ced0: 312e 3031 220a 2020 2020 2020 2020 290a  1.01".        ).
-0001cee0: 0a20 2020 2023 2053 616e 7469 7a65 206d  .    # Santize m
-0001cef0: 6178 5f73 697a 6520 7661 7269 6162 6c65  ax_size variable
-0001cf00: 0a20 2020 206d 6178 5f73 697a 6520 3d20  .    max_size = 
-0001cf10: 5b6e 702e 696e 6620 6966 2076 2069 7320  [np.inf if v is 
-0001cf20: 4e6f 6e65 2065 6c73 6520 7620 666f 7220  None else v for 
-0001cf30: 7620 696e 206d 6178 5f73 697a 655d 0a20  v in max_size]. 
-0001cf40: 2020 206d 6178 5f73 697a 6520 3d20 6e70     max_size = np
-0001cf50: 2e61 7361 7272 6179 286d 6178 5f73 697a  .asarray(max_siz
-0001cf60: 652c 2064 7479 7065 3d6e 702e 666c 6f61  e, dtype=np.floa
-0001cf70: 7436 3429 2020 2320 496e 2063 6173 6520  t64)  # In case 
-0001cf80: 6974 2773 2069 6e74 6567 6572 730a 2020  it's integers.  
-0001cf90: 2020 6d61 785f 7369 7a65 203d 206d 6178    max_size = max
-0001cfa0: 5f73 697a 6520 2f20 7072 6563 6973 696f  _size / precisio
-0001cfb0: 6e0a 0a20 2020 2023 2043 6f6e 7665 7274  n..    # Convert
-0001cfc0: 2044 6576 6963 6573 2074 6f20 7265 6374   Devices to rect
-0001cfd0: 616e 676c 6573 0a20 2020 2072 6563 745f  angles.    rect_
-0001cfe0: 6469 6374 203d 207b 7d0a 2020 2020 666f  dict = {}.    fo
-0001cff0: 7220 6e2c 2044 2069 6e20 656e 756d 6572  r n, D in enumer
-0001d000: 6174 6528 445f 6c69 7374 293a 0a20 2020  ate(D_list):.   
-0001d010: 2020 2020 2077 2c20 6820 3d20 2844 2e73       w, h = (D.s
-0001d020: 697a 6520 2b20 7370 6163 696e 6729 202f  ize + spacing) /
-0001d030: 2070 7265 6369 7369 6f6e 0a20 2020 2020   precision.     
-0001d040: 2020 2077 2c20 6820 3d20 696e 7428 7729     w, h = int(w)
-0001d050: 2c20 696e 7428 6829 0a20 2020 2020 2020  , int(h).       
-0001d060: 2069 6620 2877 203e 206d 6178 5f73 697a   if (w > max_siz
-0001d070: 655b 305d 2920 6f72 2028 6820 3e20 6d61  e[0]) or (h > ma
-0001d080: 785f 7369 7a65 5b31 5d29 3a0a 2020 2020  x_size[1]):.    
-0001d090: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0001d0a0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-0001d0b0: 2020 2020 2020 2020 2020 225b 5048 4944            "[PHID
-0001d0c0: 4c5d 2070 6163 6b65 7228 2920 6661 696c  L] packer() fail
-0001d0d0: 6564 2062 6563 6175 7365 206f 6e65 206f  ed because one o
-0001d0e0: 6620 220a 2020 2020 2020 2020 2020 2020  f ".            
-0001d0f0: 2020 2020 2274 6865 206f 626a 6563 7473      "the objects
-0001d100: 2069 6e20 6044 5f6c 6973 7460 2069 7320   in `D_list` is 
-0001d110: 6861 7320 616e 2078 206f 7220 220a 2020  has an x or ".  
-0001d120: 2020 2020 2020 2020 2020 2020 2020 2279                "y
-0001d130: 2064 696d 656e 7369 6f6e 206c 6172 6765   dimension large
-0001d140: 7220 7468 616e 2060 6d61 785f 7369 7a65  r than `max_size
-0001d150: 6020 616e 6420 220a 2020 2020 2020 2020  ` and ".        
-0001d160: 2020 2020 2020 2020 2273 6f20 6361 6e6e          "so cann
-0001d170: 6f74 2062 6520 7061 636b 6564 220a 2020  ot be packed".  
-0001d180: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0001d190: 2020 2020 7265 6374 5f64 6963 745b 6e5d      rect_dict[n]
-0001d1a0: 203d 2028 772c 2068 290a 0a20 2020 2070   = (w, h)..    p
-0001d1b0: 6163 6b65 645f 6c69 7374 203d 205b 5d0a  acked_list = [].
-0001d1c0: 2020 2020 7768 696c 6520 6c65 6e28 7265      while len(re
-0001d1d0: 6374 5f64 6963 7429 203e 2030 3a0a 2020  ct_dict) > 0:.  
-0001d1e0: 2020 2020 2020 2870 6163 6b65 645f 7265        (packed_re
-0001d1f0: 6374 5f64 6963 742c 2072 6563 745f 6469  ct_dict, rect_di
-0001d200: 6374 2920 3d20 5f70 6163 6b5f 7369 6e67  ct) = _pack_sing
-0001d210: 6c65 5f62 696e 280a 2020 2020 2020 2020  le_bin(.        
-0001d220: 2020 2020 7265 6374 5f64 6963 742c 0a20      rect_dict,. 
-0001d230: 2020 2020 2020 2020 2020 2061 7370 6563             aspec
-0001d240: 745f 7261 7469 6f3d 6173 7065 6374 5f72  t_ratio=aspect_r
-0001d250: 6174 696f 2c0a 2020 2020 2020 2020 2020  atio,.          
-0001d260: 2020 6d61 785f 7369 7a65 3d6d 6178 5f73    max_size=max_s
-0001d270: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
-0001d280: 2073 6f72 745f 6279 5f61 7265 613d 736f   sort_by_area=so
-0001d290: 7274 5f62 795f 6172 6561 2c0a 2020 2020  rt_by_area,.    
-0001d2a0: 2020 2020 2020 2020 6465 6e73 6974 793d          density=
-0001d2b0: 6465 6e73 6974 792c 0a20 2020 2020 2020  density,.       
-0001d2c0: 2020 2020 2070 7265 6369 7369 6f6e 3d70       precision=p
-0001d2d0: 7265 6369 7369 6f6e 2c0a 2020 2020 2020  recision,.      
-0001d2e0: 2020 2020 2020 7665 7262 6f73 653d 7665        verbose=ve
-0001d2f0: 7262 6f73 652c 0a20 2020 2020 2020 2029  rbose,.        )
-0001d300: 0a20 2020 2020 2020 2070 6163 6b65 645f  .        packed_
-0001d310: 6c69 7374 2e61 7070 656e 6428 7061 636b  list.append(pack
-0001d320: 6564 5f72 6563 745f 6469 6374 290a 0a20  ed_rect_dict).. 
-0001d330: 2020 2044 5f70 6163 6b65 645f 6c69 7374     D_packed_list
-0001d340: 203d 205b 5d0a 2020 2020 666f 7220 7265   = [].    for re
-0001d350: 6374 5f64 6963 7420 696e 2070 6163 6b65  ct_dict in packe
-0001d360: 645f 6c69 7374 3a0a 2020 2020 2020 2020  d_list:.        
-0001d370: 445f 7061 636b 6564 203d 2044 6576 6963  D_packed = Devic
-0001d380: 6528 290a 2020 2020 2020 2020 666f 7220  e().        for 
-0001d390: 6e2c 2072 6563 7420 696e 2072 6563 745f  n, rect in rect_
-0001d3a0: 6469 6374 2e69 7465 6d73 2829 3a0a 2020  dict.items():.  
-0001d3b0: 2020 2020 2020 2020 2020 782c 2079 2c20            x, y, 
-0001d3c0: 772c 2068 203d 2072 6563 740a 2020 2020  w, h = rect.    
-0001d3d0: 2020 2020 2020 2020 7863 656e 7465 7220          xcenter 
-0001d3e0: 3d20 7820 2b20 7720 2f20 3220 2b20 7370  = x + w / 2 + sp
-0001d3f0: 6163 696e 6720 2f20 320a 2020 2020 2020  acing / 2.      
-0001d400: 2020 2020 2020 7963 656e 7465 7220 3d20        ycenter = 
-0001d410: 7920 2b20 6820 2f20 3220 2b20 7370 6163  y + h / 2 + spac
-0001d420: 696e 6720 2f20 320a 2020 2020 2020 2020  ing / 2.        
-0001d430: 2020 2020 6420 3d20 445f 7061 636b 6564      d = D_packed
-0001d440: 2e61 6464 5f72 6566 2844 5f6c 6973 745b  .add_ref(D_list[
-0001d450: 6e5d 290a 2020 2020 2020 2020 2020 2020  n]).            
-0001d460: 642e 6365 6e74 6572 203d 2028 7863 656e  d.center = (xcen
-0001d470: 7465 7220 2a20 7072 6563 6973 696f 6e2c  ter * precision,
-0001d480: 2079 6365 6e74 6572 202a 2070 7265 6369   ycenter * preci
-0001d490: 7369 6f6e 290a 2020 2020 2020 2020 445f  sion).        D_
-0001d4a0: 7061 636b 6564 5f6c 6973 742e 6170 7065  packed_list.appe
-0001d4b0: 6e64 2844 5f70 6163 6b65 6429 0a0a 2020  nd(D_packed)..  
-0001d4c0: 2020 7265 7475 726e 2044 5f70 6163 6b65    return D_packe
-0001d4d0: 645f 6c69 7374 0a0a 0a64 6566 205f 7261  d_list...def _ra
-0001d4e0: 7374 6572 697a 655f 706f 6c79 676f 6e73  sterize_polygons
-0001d4f0: 2870 6f6c 7967 6f6e 732c 2062 6f75 6e64  (polygons, bound
-0001d500: 733d 5b5b 2d31 3030 2c20 2d31 3030 5d2c  s=[[-100, -100],
-0001d510: 205b 3130 302c 2031 3030 5d5d 2c20 6478   [100, 100]], dx
-0001d520: 3d31 2c20 6479 3d31 293a 0a20 2020 2022  =1, dy=1):.    "
-0001d530: 2222 436f 6e76 6572 7473 2070 6f6c 7967  ""Converts polyg
-0001d540: 6f6e 7320 746f 2061 2062 6c61 636b 2f77  ons to a black/w
-0001d550: 6869 7465 2028 312f 3029 206d 6174 7269  hite (1/0) matri
-0001d560: 7822 2222 0a20 2020 2074 7279 3a0a 2020  x""".    try:.  
-0001d570: 2020 2020 2020 6672 6f6d 2073 6b69 6d61        from skima
-0001d580: 6765 2069 6d70 6f72 7420 6472 6177 0a20  ge import draw. 
-0001d590: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-0001d5a0: 696f 6e3a 0a20 2020 2020 2020 2072 6169  ion:.        rai
-0001d5b0: 7365 2049 6d70 6f72 7445 7272 6f72 280a  se ImportError(.
-0001d5c0: 2020 2020 2020 2020 2020 2020 2254 6865              "The
-0001d5d0: 2066 696c 6c20 6675 6e63 7469 6f6e 2072   fill function r
-0001d5e0: 6571 7569 7265 7320 7468 6520 6d6f 6475  equires the modu
-0001d5f0: 6c65 2022 0a20 2020 2020 2020 2020 2020  le ".           
-0001d600: 2027 2273 6369 6b69 742d 696d 6167 6522   '"scikit-image"
-0001d610: 2074 6f20 6f70 6572 6174 652e 2020 506c   to operate.  Pl
-0001d620: 6561 7365 2072 6574 7279 2027 0a20 2020  ease retry '.   
-0001d630: 2020 2020 2020 2020 2022 6166 7465 7220           "after 
-0001d640: 696e 7374 616c 6c69 6e67 2073 6369 6b69  installing sciki
-0001d650: 742d 696d 6167 653a 5c6e 5c6e 220a 2020  t-image:\n\n".  
-0001d660: 2020 2020 2020 2020 2020 2224 2070 6970            "$ pip
-0001d670: 2069 6e73 7461 6c6c 202d 2d75 7067 7261   install --upgra
-0001d680: 6465 2073 6369 6b69 742d 696d 6167 6522  de scikit-image"
-0001d690: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0001d6a0: 2320 5072 6570 6172 6520 706f 6c79 676f  # Prepare polygo
-0001d6b0: 6e20 6172 7261 7920 6279 2073 6869 6674  n array by shift
-0001d6c0: 696e 6720 616c 6c20 706f 696e 7473 2069  ing all points i
-0001d6d0: 6e74 6f20 7468 6520 6669 7273 7420 7175  nto the first qu
-0001d6e0: 6164 7261 6e74 2061 6e64 0a20 2020 2023  adrant and.    #
-0001d6f0: 2073 6570 6172 6174 696e 6720 706f 696e   separating poin
-0001d700: 7473 2069 6e74 6f20 7820 616e 6420 7920  ts into x and y 
-0001d710: 6c69 7374 730a 2020 2020 7870 7473 203d  lists.    xpts =
-0001d720: 205b 5d0a 2020 2020 7970 7473 203d 205b   [].    ypts = [
-0001d730: 5d0a 2020 2020 666f 7220 7020 696e 2070  ].    for p in p
-0001d740: 6f6c 7967 6f6e 733a 0a20 2020 2020 2020  olygons:.       
-0001d750: 2070 5f61 7272 6179 203d 206e 702e 6173   p_array = np.as
-0001d760: 6172 7261 7928 7029 0a20 2020 2020 2020  array(p).       
-0001d770: 2078 203d 2070 5f61 7272 6179 5b3a 2c20   x = p_array[:, 
-0001d780: 305d 0a20 2020 2020 2020 2079 203d 2070  0].        y = p
-0001d790: 5f61 7272 6179 5b3a 2c20 315d 0a20 2020  _array[:, 1].   
-0001d7a0: 2020 2020 2078 7074 732e 6170 7065 6e64       xpts.append
-0001d7b0: 2828 7820 2d20 626f 756e 6473 5b30 5d5b  ((x - bounds[0][
-0001d7c0: 305d 2920 2f20 6478 202d 2030 2e35 290a  0]) / dx - 0.5).
-0001d7d0: 2020 2020 2020 2020 7970 7473 2e61 7070          ypts.app
-0001d7e0: 656e 6428 2879 202d 2062 6f75 6e64 735b  end((y - bounds[
-0001d7f0: 305d 5b31 5d29 202f 2064 7920 2d20 302e  0][1]) / dy - 0.
-0001d800: 3529 0a0a 2020 2020 2320 496e 6974 6961  5)..    # Initia
-0001d810: 6c69 7a65 2074 6865 2072 6173 7465 7220  lize the raster 
-0001d820: 6d61 7472 6978 2077 6527 6c6c 2062 6520  matrix we'll be 
-0001d830: 7772 6974 696e 6720 746f 0a20 2020 2078  writing to.    x
-0001d840: 7369 7a65 203d 2069 6e74 286e 702e 6365  size = int(np.ce
-0001d850: 696c 2862 6f75 6e64 735b 315d 5b30 5d20  il(bounds[1][0] 
-0001d860: 2d20 626f 756e 6473 5b30 5d5b 305d 2920  - bounds[0][0]) 
-0001d870: 2f20 6478 290a 2020 2020 7973 697a 6520  / dx).    ysize 
-0001d880: 3d20 696e 7428 6e70 2e63 6569 6c28 626f  = int(np.ceil(bo
-0001d890: 756e 6473 5b31 5d5b 315d 202d 2062 6f75  unds[1][1] - bou
-0001d8a0: 6e64 735b 305d 5b31 5d29 202f 2064 7929  nds[0][1]) / dy)
-0001d8b0: 0a20 2020 2072 6173 7465 7220 3d20 6e70  .    raster = np
-0001d8c0: 2e7a 6572 6f73 2828 7973 697a 652c 2078  .zeros((ysize, x
-0001d8d0: 7369 7a65 292c 2064 7479 7065 3d62 6f6f  size), dtype=boo
-0001d8e0: 6c29 0a0a 2020 2020 2320 544f 444f 3a20  l)..    # TODO: 
-0001d8f0: 5265 706c 6163 6520 706f 6c79 676f 6e5f  Replace polygon_
-0001d900: 7065 7269 6d65 7465 7220 7769 7468 2074  perimeter with t
-0001d910: 6865 2073 7570 6572 636f 7665 7220 7665  he supercover ve
-0001d920: 7273 696f 6e0a 2020 2020 666f 7220 6e20  rsion.    for n 
-0001d930: 696e 2072 616e 6765 286c 656e 2878 7074  in range(len(xpt
-0001d940: 7329 293a 0a20 2020 2020 2020 2072 722c  s)):.        rr,
-0001d950: 2063 6320 3d20 6472 6177 2e70 6f6c 7967   cc = draw.polyg
-0001d960: 6f6e 2879 7074 735b 6e5d 2c20 7870 7473  on(ypts[n], xpts
-0001d970: 5b6e 5d2c 2073 6861 7065 3d72 6173 7465  [n], shape=raste
-0001d980: 722e 7368 6170 6529 0a20 2020 2020 2020  r.shape).       
-0001d990: 2072 7270 2c20 6363 7020 3d20 6472 6177   rrp, ccp = draw
-0001d9a0: 2e70 6f6c 7967 6f6e 5f70 6572 696d 6574  .polygon_perimet
-0001d9b0: 6572 280a 2020 2020 2020 2020 2020 2020  er(.            
-0001d9c0: 7970 7473 5b6e 5d2c 2078 7074 735b 6e5d  ypts[n], xpts[n]
-0001d9d0: 2c20 7368 6170 653d 7261 7374 6572 2e73  , shape=raster.s
-0001d9e0: 6861 7065 2c20 636c 6970 3d46 616c 7365  hape, clip=False
-0001d9f0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-0001da00: 2020 2072 6173 7465 725b 7272 2c20 6363     raster[rr, cc
-0001da10: 5d20 3d20 310a 2020 2020 2020 2020 7261  ] = 1.        ra
-0001da20: 7374 6572 5b72 7270 2c20 6363 705d 203d  ster[rrp, ccp] =
-0001da30: 2031 0a0a 2020 2020 7265 7475 726e 2072   1..    return r
-0001da40: 6173 7465 720a 0a0a 6465 6620 5f72 6173  aster...def _ras
-0001da50: 7465 725f 696e 6465 785f 746f 5f63 6f6f  ter_index_to_coo
-0001da60: 7264 7328 692c 206a 2c20 626f 756e 6473  rds(i, j, bounds
-0001da70: 3d5b 5b2d 3130 302c 202d 3130 305d 2c20  =[[-100, -100], 
-0001da80: 5b31 3030 2c20 3130 305d 5d2c 2064 783d  [100, 100]], dx=
-0001da90: 312c 2064 793d 3129 3a0a 2020 2020 2222  1, dy=1):.    ""
-0001daa0: 2243 6f6e 7665 7274 7320 2869 2c6a 2920  "Converts (i,j) 
-0001dab0: 696e 6465 7820 6f66 2072 6173 7465 7220  index of raster 
-0001dac0: 6d61 7472 6978 2074 6f20 7265 616c 2063  matrix to real c
-0001dad0: 6f6f 7264 696e 6174 6573 2222 220a 2020  oordinates""".  
-0001dae0: 2020 7820 3d20 286a 202b 2030 2e35 2920    x = (j + 0.5) 
-0001daf0: 2a20 6478 202b 2062 6f75 6e64 735b 305d  * dx + bounds[0]
-0001db00: 5b30 5d0a 2020 2020 7920 3d20 2869 202b  [0].    y = (i +
-0001db10: 2030 2e35 2920 2a20 6479 202b 2062 6f75   0.5) * dy + bou
-0001db20: 6e64 735b 305d 5b31 5d0a 2020 2020 7265  nds[0][1].    re
-0001db30: 7475 726e 2078 2c20 790a 0a0a 6465 6620  turn x, y...def 
-0001db40: 5f65 7870 616e 645f 7261 7374 6572 2872  _expand_raster(r
-0001db50: 6173 7465 722c 2064 6973 7461 6e63 653d  aster, distance=
-0001db60: 2834 2c20 3229 293a 0a20 2020 2022 2222  (4, 2)):.    """
-0001db70: 4578 7061 6e64 7320 616c 6c20 626c 6163  Expands all blac
-0001db80: 6b20 2831 2920 7069 7865 6c73 2069 6e20  k (1) pixels in 
-0001db90: 7468 6520 7261 7374 6572 2222 220a 2020  the raster""".  
-0001dba0: 2020 7472 793a 0a20 2020 2020 2020 2066    try:.        f
-0001dbb0: 726f 6d20 736b 696d 6167 6520 696d 706f  rom skimage impo
-0001dbc0: 7274 2064 7261 772c 206d 6f72 7068 6f6c  rt draw, morphol
-0001dbd0: 6f67 790a 2020 2020 6578 6365 7074 2045  ogy.    except E
-0001dbe0: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
-0001dbf0: 2020 7261 6973 6520 496d 706f 7274 4572    raise ImportEr
-0001dc00: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0001dc10: 2022 5468 6520 6669 6c6c 2066 756e 6374   "The fill funct
-0001dc20: 696f 6e20 7265 7175 6972 6573 2074 6865  ion requires the
-0001dc30: 206d 6f64 756c 6520 220a 2020 2020 2020   module ".      
-0001dc40: 2020 2020 2020 2722 7363 696b 6974 2d69        '"scikit-i
-0001dc50: 6d61 6765 2220 746f 206f 7065 7261 7465  mage" to operate
-0001dc60: 2e20 2050 6c65 6173 6520 7265 7472 7920  .  Please retry 
-0001dc70: 270a 2020 2020 2020 2020 2020 2020 2261  '.            "a
-0001dc80: 6674 6572 2069 6e73 7461 6c6c 696e 6720  fter installing 
-0001dc90: 7363 696b 6974 2d69 6d61 6765 3a5c 6e5c  scikit-image:\n\
-0001dca0: 6e22 0a20 2020 2020 2020 2020 2020 2022  n".            "
-0001dcb0: 2420 7069 7020 696e 7374 616c 6c20 2d2d  $ pip install --
-0001dcc0: 7570 6772 6164 6520 7363 696b 6974 2d69  upgrade scikit-i
-0001dcd0: 6d61 6765 220a 2020 2020 2020 2020 290a  mage".        ).
-0001dce0: 2020 2020 6966 2064 6973 7461 6e63 655b      if distance[
-0001dcf0: 305d 203c 3d20 302e 3520 616e 6420 6469  0] <= 0.5 and di
-0001dd00: 7374 616e 6365 5b31 5d20 3c3d 2030 2e35  stance[1] <= 0.5
-0001dd10: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0001dd20: 2072 6173 7465 720a 0a20 2020 206e 756d   raster..    num
-0001dd30: 5f70 6978 656c 7320 3d20 6e70 2e61 7272  _pixels = np.arr
-0001dd40: 6179 286e 702e 6365 696c 2864 6973 7461  ay(np.ceil(dista
-0001dd50: 6e63 6529 2c20 6474 7970 653d 696e 7429  nce), dtype=int)
-0001dd60: 0a20 2020 206e 6569 6768 626f 7268 6f6f  .    neighborhoo
-0001dd70: 6420 3d20 6e70 2e7a 6572 6f73 2828 6e75  d = np.zeros((nu
-0001dd80: 6d5f 7069 7865 6c73 5b31 5d20 2a20 3220  m_pixels[1] * 2 
-0001dd90: 2b20 312c 206e 756d 5f70 6978 656c 735b  + 1, num_pixels[
-0001dda0: 305d 202a 2032 202b 2031 292c 2064 7479  0] * 2 + 1), dty
-0001ddb0: 7065 3d62 6f6f 6c29 0a20 2020 2072 722c  pe=bool).    rr,
-0001ddc0: 2063 6320 3d20 6472 6177 2e65 6c6c 6970   cc = draw.ellip
-0001ddd0: 7365 280a 2020 2020 2020 2020 6e75 6d5f  se(.        num_
-0001dde0: 7069 7865 6c73 5b31 5d2c 206e 756d 5f70  pixels[1], num_p
-0001ddf0: 6978 656c 735b 305d 2c20 6469 7374 616e  ixels[0], distan
-0001de00: 6365 5b31 5d20 2b20 302e 352c 2064 6973  ce[1] + 0.5, dis
-0001de10: 7461 6e63 655b 305d 202b 2030 2e35 0a20  tance[0] + 0.5. 
-0001de20: 2020 2029 0a20 2020 206e 6569 6768 626f     ).    neighbo
-0001de30: 7268 6f6f 645b 7272 2c20 6363 5d20 3d20  rhood[rr, cc] = 
-0001de40: 310a 0a20 2020 2072 6574 7572 6e20 6d6f  1..    return mo
-0001de50: 7270 686f 6c6f 6779 2e62 696e 6172 795f  rphology.binary_
-0001de60: 6469 6c61 7469 6f6e 2869 6d61 6765 3d72  dilation(image=r
-0001de70: 6173 7465 722c 2066 6f6f 7470 7269 6e74  aster, footprint
-0001de80: 3d6e 6569 6768 626f 7268 6f6f 6429 0a0a  =neighborhood)..
-0001de90: 0a64 6566 205f 6669 6c6c 5f63 656c 6c5f  .def _fill_cell_
-0001dea0: 7265 6374 616e 676c 6528 0a20 2020 2073  rectangle(.    s
-0001deb0: 697a 653d 2832 302c 2032 3029 2c0a 2020  ize=(20, 20),.  
-0001dec0: 2020 6c61 7965 7273 3d28 302c 2031 2c20    layers=(0, 1, 
-0001ded0: 3329 2c0a 2020 2020 6465 6e73 6974 6965  3),.    densitie
-0001dee0: 733d 2830 2e35 2c20 302e 3235 2c20 302e  s=(0.5, 0.25, 0.
-0001def0: 3729 2c0a 2020 2020 696e 7665 7274 6564  7),.    inverted
-0001df00: 3d28 4661 6c73 652c 2046 616c 7365 2c20  =(False, False, 
-0001df10: 4661 6c73 6529 2c0a 293a 0a20 2020 2022  False),.):.    "
-0001df20: 2222 4372 6561 7465 7320 6120 7369 6e67  ""Creates a sing
-0001df30: 6c65 2044 6576 6963 6520 6f6e 206d 756c  le Device on mul
-0001df40: 7469 706c 6520 6c61 7965 7273 2074 6f20  tiple layers to 
-0001df50: 6265 2075 7365 6420 6173 2066 696c 6c0a  be used as fill.
-0001df60: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-0001df70: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-0001df80: 2020 2073 697a 6520 3a20 6172 7261 792d     size : array-
-0001df90: 6c69 6b65 206f 6620 696e 7420 6f72 2066  like of int or f
-0001dfa0: 6c6f 6174 0a20 2020 2020 2020 2078 2c20  loat.        x, 
-0001dfb0: 7920 6469 6d65 6e73 696f 6e73 206f 6620  y dimensions of 
-0001dfc0: 7468 6520 6669 6c6c 2061 7265 6120 666f  the fill area fo
-0001dfd0: 7220 616c 6c20 6c61 7965 7273 2e0a 2020  r all layers..  
-0001dfe0: 2020 6c61 7965 7273 203a 2069 6e74 2c20    layers : int, 
-0001dff0: 6172 7261 792d 6c69 6b65 5b32 5d2c 206f  array-like[2], o
-0001e000: 7220 7365 740a 2020 2020 2020 2020 5370  r set.        Sp
-0001e010: 6563 6966 6963 206c 6179 6572 2873 2920  ecific layer(s) 
-0001e020: 746f 2070 7574 2066 696c 6c20 6365 6c6c  to put fill cell
-0001e030: 2072 6563 7461 6e67 6c65 2067 656f 6d65   rectangle geome
-0001e040: 7472 7920 6f6e 2e0a 2020 2020 6465 6e73  try on..    dens
-0001e050: 6974 6965 7320 3a20 6172 7261 792d 6c69  ities : array-li
-0001e060: 6b65 206f 6620 696e 7420 6f72 2066 6c6f  ke of int or flo
-0001e070: 6174 0a20 2020 2020 2020 2046 696c 6c20  at.        Fill 
-0001e080: 6465 6e73 6974 6965 7320 666f 7220 6561  densities for ea
-0001e090: 6368 206c 6179 6572 2073 7065 6369 6669  ch layer specifi
-0001e0a0: 6564 2069 6e20 6060 6c61 7965 7273 6060  ed in ``layers``
-0001e0b0: 2e20 4d75 7374 2062 6520 7468 6520 7361  . Must be the sa
-0001e0c0: 6d65 0a20 2020 2020 2020 2073 697a 6520  me.        size 
-0001e0d0: 6173 2060 606c 6179 6572 7360 602e 0a20  as ``layers``.. 
-0001e0e0: 2020 2069 6e76 6572 7465 6420 3a20 6172     inverted : ar
-0001e0f0: 7261 792d 6c69 6b65 206f 7220 626f 6f6c  ray-like or bool
-0001e100: 0a20 2020 2020 2020 2049 6620 7472 7565  .        If true
-0001e110: 2c20 696e 7665 7274 7320 7468 6520 6669  , inverts the fi
-0001e120: 6c6c 2061 7265 6120 666f 7220 636f 7272  ll area for corr
-0001e130: 6573 706f 6e64 696e 6720 6c61 7965 722e  esponding layer.
-0001e140: 204d 7573 7420 6265 2074 6865 0a20 2020   Must be the.   
-0001e150: 2020 2020 2073 616d 6520 7369 7a65 2061       same size a
-0001e160: 7320 6060 6c61 7965 7273 6060 2e0a 0a20  s ``layers``... 
-0001e170: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
-0001e180: 2d2d 2d2d 2d2d 0a20 2020 2044 203a 2044  ------.    D : D
-0001e190: 6576 6963 650a 2020 2020 2020 2020 4120  evice.        A 
-0001e1a0: 4465 7669 6365 2063 6f6e 7461 696e 696e  Device containin
-0001e1b0: 6720 6669 6c6c 6564 2063 656c 6c20 7265  g filled cell re
-0001e1c0: 6374 616e 676c 6573 2e0a 2020 2020 2222  ctangles..    ""
-0001e1d0: 220a 2020 2020 4420 3d20 4465 7669 6365  ".    D = Device
-0001e1e0: 2822 6669 6c6c 6365 6c6c 2229 0a20 2020  ("fillcell").   
-0001e1f0: 2066 6f72 206c 6179 6572 2c20 6465 6e73   for layer, dens
-0001e200: 6974 792c 2069 6e76 2069 6e20 7a69 7028  ity, inv in zip(
-0001e210: 6c61 7965 7273 2c20 6465 6e73 6974 6965  layers, densitie
-0001e220: 732c 2069 6e76 6572 7465 6429 3a0a 2020  s, inverted):.  
-0001e230: 2020 2020 2020 7265 6374 616e 676c 655f        rectangle_
-0001e240: 7369 7a65 203d 206e 702e 6172 7261 7928  size = np.array(
-0001e250: 7369 7a65 2920 2a20 7371 7274 2864 656e  size) * sqrt(den
-0001e260: 7369 7479 290a 2020 2020 2020 2020 2320  sity).        # 
-0001e270: 7220 3d20 442e 6164 645f 7265 6628 7265  r = D.add_ref(re
-0001e280: 6374 616e 676c 6528 7369 7a65 203d 2072  ctangle(size = r
-0001e290: 6563 7461 6e67 6c65 5f73 697a 652c 206c  ectangle_size, l
-0001e2a0: 6179 6572 203d 206c 6179 6572 2929 0a20  ayer = layer)). 
-0001e2b0: 2020 2020 2020 2052 203d 2072 6563 7461         R = recta
-0001e2c0: 6e67 6c65 2873 697a 653d 7265 6374 616e  ngle(size=rectan
-0001e2d0: 676c 655f 7369 7a65 2c20 6c61 7965 723d  gle_size, layer=
-0001e2e0: 6c61 7965 7229 0a20 2020 2020 2020 2052  layer).        R
-0001e2f0: 2e63 656e 7465 7220 3d20 2830 2c20 3029  .center = (0, 0)
-0001e300: 0a20 2020 2020 2020 2069 6620 696e 7620  .        if inv 
-0001e310: 6973 2054 7275 653a 0a20 2020 2020 2020  is True:.       
-0001e320: 2020 2020 2041 203d 2072 6563 7461 6e67       A = rectang
-0001e330: 6c65 2873 697a 653d 7369 7a65 290a 2020  le(size=size).  
-0001e340: 2020 2020 2020 2020 2020 412e 6365 6e74            A.cent
-0001e350: 6572 203d 2028 302c 2030 290a 2020 2020  er = (0, 0).    
-0001e360: 2020 2020 2020 2020 4120 3d20 412e 6765          A = A.ge
-0001e370: 745f 706f 6c79 676f 6e73 2829 0a20 2020  t_polygons().   
-0001e380: 2020 2020 2020 2020 2042 203d 2052 2e67           B = R.g
-0001e390: 6574 5f70 6f6c 7967 6f6e 7328 290a 2020  et_polygons().  
-0001e3a0: 2020 2020 2020 2020 2020 7020 3d20 6764            p = gd
-0001e3b0: 7370 792e 626f 6f6c 6561 6e28 412c 2042  spy.boolean(A, B
-0001e3c0: 2c20 6f70 6572 6174 696f 6e3d 226e 6f74  , operation="not
-0001e3d0: 2229 0a20 2020 2020 2020 2020 2020 2044  ").            D
-0001e3e0: 2e61 6464 5f70 6f6c 7967 6f6e 2870 2c20  .add_polygon(p, 
-0001e3f0: 6c61 7965 723d 6c61 7965 7229 0a20 2020  layer=layer).   
-0001e400: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001e410: 2020 2020 2020 2044 2e61 6464 5f72 6566         D.add_ref
-0001e420: 2852 290a 2020 2020 7265 7475 726e 2044  (R).    return D
-0001e430: 0a0a 0a64 6566 205f 6c6f 6f70 5f6f 7665  ...def _loop_ove
-0001e440: 7228 7661 7229 3a0a 2020 2020 2222 2243  r(var):.    """C
-0001e450: 6865 636b 7320 6966 2061 2076 6172 6961  hecks if a varia
-0001e460: 626c 6520 6973 2069 6e20 7468 6520 666f  ble is in the fo
-0001e470: 726d 206f 6620 616e 2069 7465 7261 626c  rm of an iterabl
-0001e480: 6520 286c 6973 742f 7475 706c 6529 0a20  e (list/tuple). 
-0001e490: 2020 2061 6e64 2069 6620 6e6f 742c 2072     and if not, r
-0001e4a0: 6574 7572 6e73 2069 7420 6173 2061 206c  eturns it as a l
-0001e4b0: 6973 742e 2020 5573 6566 756c 2066 6f72  ist.  Useful for
-0001e4c0: 2061 6c6c 6f77 696e 6720 6172 6775 6d65   allowing argume
-0001e4d0: 6e74 0a20 2020 2069 6e70 7574 7320 746f  nt.    inputs to
-0001e4e0: 2062 6520 6569 7468 6572 206c 6973 7473   be either lists
-0001e4f0: 2028 652e 672e 205b 312c 2033 2c20 345d   (e.g. [1, 3, 4]
-0001e500: 2920 6f72 2073 696e 676c 652d 7661 6c75  ) or single-valu
-0001e510: 6564 2028 652e 672e 2033 292e 0a0a 2020  ed (e.g. 3)...  
-0001e520: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-0001e530: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-0001e540: 7661 7220 3a20 696e 7420 6f72 2066 6c6f  var : int or flo
-0001e550: 6174 206f 7220 6c69 7374 0a20 2020 2020  at or list.     
-0001e560: 2020 2056 6172 6961 626c 6520 746f 2063     Variable to c
-0001e570: 6865 636b 2066 6f72 2069 7465 7261 6269  heck for iterabi
-0001e580: 6c69 7479 2e0a 0a20 2020 2052 6574 7572  lity...    Retur
-0001e590: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
-0001e5a0: 2020 2076 6172 203a 206c 6973 740a 2020     var : list.  
-0001e5b0: 2020 2020 2020 5661 7269 6162 6c65 2063        Variable c
-0001e5c0: 6f6e 7665 7274 6564 2074 6f20 6c69 7374  onverted to list
-0001e5d0: 2069 6620 7369 6e67 6c65 2d76 616c 7565   if single-value
-0001e5e0: 6420 696e 7075 742e 0a20 2020 2022 2222  d input..    """
-0001e5f0: 0a0a 2020 2020 6966 2068 6173 6174 7472  ..    if hasattr
-0001e600: 2876 6172 2c20 225f 5f69 7465 725f 5f22  (var, "__iter__"
-0001e610: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0001e620: 6e20 7661 720a 2020 2020 656c 7365 3a0a  n var.    else:.
-0001e630: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-0001e640: 7661 725d 0a0a 0a64 6566 2066 696c 6c5f  var]...def fill_
-0001e650: 7265 6374 616e 676c 6528 0a20 2020 2044  rectangle(.    D
-0001e660: 2c0a 2020 2020 6669 6c6c 5f73 697a 653d  ,.    fill_size=
-0001e670: 2834 302c 2031 3029 2c0a 2020 2020 6176  (40, 10),.    av
-0001e680: 6f69 645f 6c61 7965 7273 3d22 616c 6c22  oid_layers="all"
-0001e690: 2c0a 2020 2020 696e 636c 7564 655f 6c61  ,.    include_la
-0001e6a0: 7965 7273 3d4e 6f6e 652c 0a20 2020 206d  yers=None,.    m
-0001e6b0: 6172 6769 6e3d 3130 302c 0a20 2020 2066  argin=100,.    f
-0001e6c0: 696c 6c5f 6c61 7965 7273 3d28 302c 2031  ill_layers=(0, 1
-0001e6d0: 2c20 3329 2c0a 2020 2020 6669 6c6c 5f64  , 3),.    fill_d
-0001e6e0: 656e 7369 7469 6573 3d28 302e 352c 2030  ensities=(0.5, 0
-0001e6f0: 2e32 352c 2030 2e37 292c 0a20 2020 2066  .25, 0.7),.    f
-0001e700: 696c 6c5f 696e 7665 7274 6564 3d4e 6f6e  ill_inverted=Non
-0001e710: 652c 0a20 2020 2062 626f 783d 4e6f 6e65  e,.    bbox=None
-0001e720: 2c0a 293a 0a20 2020 2022 2222 4372 6561  ,.):.    """Crea
-0001e730: 7465 7320 6120 7265 6374 616e 6775 6c61  tes a rectangula
-0001e740: 7220 6669 6c6c 2070 6174 7465 726e 2061  r fill pattern a
-0001e750: 6e64 2066 696c 6c73 2061 6c6c 2065 6d70  nd fills all emp
-0001e760: 7479 2061 7265 6173 0a20 2020 2069 6e20  ty areas.    in 
-0001e770: 7468 6520 696e 7075 7420 6465 7669 6365  the input device
-0001e780: 2044 0a0a 2020 2020 5061 7261 6d65 7465   D..    Paramete
-0001e790: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-0001e7a0: 2d0a 2020 2020 4420 3a20 4465 7669 6365  -.    D : Device
-0001e7b0: 0a20 2020 2020 2020 2044 6576 6963 6520  .        Device 
-0001e7c0: 746f 2062 6520 6669 6c6c 6564 0a20 2020  to be filled.   
-0001e7d0: 2066 696c 6c5f 7369 7a65 203a 2061 7272   fill_size : arr
-0001e7e0: 6179 2d6c 696b 655b 325d 0a20 2020 2020  ay-like[2].     
-0001e7f0: 2020 2052 6563 7461 6e67 756c 6172 2073     Rectangular s
-0001e800: 697a 6520 6f66 2074 6865 2066 696c 6c20  ize of the fill 
-0001e810: 656c 656d 656e 740a 2020 2020 6176 6f69  element.    avoi
-0001e820: 645f 6c61 7965 7273 203a 2027 616c 6c27  d_layers : 'all'
-0001e830: 206f 7220 6c69 7374 206f 6620 6c61 7965   or list of laye
-0001e840: 7273 0a20 2020 2020 2020 204c 6179 6572  rs.        Layer
-0001e850: 7320 746f 2062 6520 6176 6f69 6465 6420  s to be avoided 
-0001e860: 286e 6f74 2066 696c 6c65 6429 2069 6e20  (not filled) in 
-0001e870: 440a 2020 2020 696e 636c 7564 655f 6c61  D.    include_la
-0001e880: 7965 7273 203a 0a20 2020 2020 2020 204c  yers :.        L
-0001e890: 6179 6572 7320 746f 2062 6520 696e 636c  ayers to be incl
-0001e8a0: 7564 6564 2028 6669 6c6c 6564 2920 696e  uded (filled) in
-0001e8b0: 2044 2c20 7375 7065 7263 6564 6573 2061   D, supercedes a
-0001e8c0: 766f 6964 5f6c 6179 6572 730a 2020 2020  void_layers.    
-0001e8d0: 6d61 7267 696e 203a 2069 6e74 206f 7220  margin : int or 
-0001e8e0: 666c 6f61 740a 2020 2020 2020 2020 4d61  float.        Ma
-0001e8f0: 7267 696e 2073 7061 6369 6e67 2061 726f  rgin spacing aro
-0001e900: 756e 6420 6176 6f69 6465 6420 6172 6561  und avoided area
-0001e910: 7320 2d2d 2066 696c 6c20 7769 6c6c 206e  s -- fill will n
-0001e920: 6f74 2063 6f6d 6520 7769 7468 696e 0a20  ot come within. 
-0001e930: 2020 2020 2020 2060 6d61 7267 696e 6020         `margin` 
-0001e940: 6f66 2074 6865 2067 656f 6d65 7472 7920  of the geometry 
-0001e950: 696e 2044 0a20 2020 2066 696c 6c5f 6c61  in D.    fill_la
-0001e960: 7965 7273 203a 206c 6973 7420 6f66 206c  yers : list of l
-0001e970: 6179 6572 730a 2020 2020 2020 2020 4465  ayers.        De
-0001e980: 6669 6e65 7320 7468 6520 6669 6c6c 2070  fines the fill p
-0001e990: 6174 7465 726e 206c 6179 6572 730a 2020  attern layers.  
-0001e9a0: 2020 6669 6c6c 5f64 656e 7369 7469 6573    fill_densities
-0001e9b0: 203a 2066 6c6f 6174 2062 6574 7765 656e   : float between
-0001e9c0: 2030 2061 6e64 2031 0a20 2020 2020 2020   0 and 1.       
-0001e9d0: 2044 6566 696e 6573 2074 6865 2066 696c   Defines the fil
-0001e9e0: 6c20 7061 7474 6572 6e20 6465 6e73 6974  l pattern densit
-0001e9f0: 7920 2831 2e30 203d 3d20 6675 6c6c 7920  y (1.0 == fully 
-0001ea00: 6669 6c6c 6564 290a 2020 2020 6669 6c6c  filled).    fill
-0001ea10: 5f69 6e76 6572 7465 6420 3a20 626f 6f6c  _inverted : bool
-0001ea20: 0a20 2020 2020 2020 2049 6e76 6572 7473  .        Inverts
-0001ea30: 2074 6865 2066 696c 6c20 7061 7474 6572   the fill patter
-0001ea40: 6e0a 2020 2020 6262 6f78 203a 2061 7272  n.    bbox : arr
-0001ea50: 6179 2d6c 696b 655b 325d 5b32 5d0a 2020  ay-like[2][2].  
-0001ea60: 2020 2020 2020 4c69 6d69 7420 7468 6520        Limit the 
-0001ea70: 6669 6c6c 2070 6174 7465 726e 2074 6f20  fill pattern to 
-0001ea80: 7468 6520 6172 6561 2064 6566 696e 6564  the area defined
-0001ea90: 2062 7920 7468 6973 2062 6f75 6e64 696e   by this boundin
-0001eaa0: 6720 626f 780a 0a20 2020 2052 6574 7572  g box..    Retur
-0001eab0: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
-0001eac0: 2020 2046 203a 2044 6576 6963 650a 0a20     F : Device.. 
-0001ead0: 2020 2022 2222 0a20 2020 2023 2043 7265     """.    # Cre
-0001eae0: 6174 6520 7468 6520 6669 6c6c 2063 656c  ate the fill cel
-0001eaf0: 6c2e 0a20 2020 2023 2049 6620 6669 6c6c  l..    # If fill
-0001eb00: 5f69 6e76 6572 7465 6420 6973 206e 6f74  _inverted is not
-0001eb10: 2073 7065 6369 6669 6564 2c20 6173 7375   specified, assu
-0001eb20: 6d65 2061 6c6c 2046 616c 7365 0a20 2020  me all False.   
-0001eb30: 2066 696c 6c5f 6c61 7965 7273 203d 205f   fill_layers = _
-0001eb40: 6c6f 6f70 5f6f 7665 7228 6669 6c6c 5f6c  loop_over(fill_l
-0001eb50: 6179 6572 7329 0a20 2020 2066 696c 6c5f  ayers).    fill_
-0001eb60: 6465 6e73 6974 6965 7320 3d20 5f6c 6f6f  densities = _loo
-0001eb70: 705f 6f76 6572 2866 696c 6c5f 6465 6e73  p_over(fill_dens
-0001eb80: 6974 6965 7329 0a20 2020 2069 6620 6669  ities).    if fi
-0001eb90: 6c6c 5f69 6e76 6572 7465 6420 6973 204e  ll_inverted is N
-0001eba0: 6f6e 653a 0a20 2020 2020 2020 2066 696c  one:.        fil
-0001ebb0: 6c5f 696e 7665 7274 6564 203d 205b 4661  l_inverted = [Fa
-0001ebc0: 6c73 655d 202a 206c 656e 2866 696c 6c5f  lse] * len(fill_
-0001ebd0: 6c61 7965 7273 290a 2020 2020 6669 6c6c  layers).    fill
-0001ebe0: 5f69 6e76 6572 7465 6420 3d20 5f6c 6f6f  _inverted = _loo
-0001ebf0: 705f 6f76 6572 2866 696c 6c5f 696e 7665  p_over(fill_inve
-0001ec00: 7274 6564 290a 2020 2020 6966 206c 656e  rted).    if len
-0001ec10: 2866 696c 6c5f 6c61 7965 7273 2920 213d  (fill_layers) !=
-0001ec20: 206c 656e 2866 696c 6c5f 6465 6e73 6974   len(fill_densit
-0001ec30: 6965 7329 3a0a 2020 2020 2020 2020 7261  ies):.        ra
-0001ec40: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-0001ec50: 2020 2020 2020 2020 2020 2020 225b 5048              "[PH
-0001ec60: 4944 4c5d 2070 6869 646c 2e67 656f 6d65  IDL] phidl.geome
-0001ec70: 7472 792e 6669 6c6c 5f72 6563 7461 6e67  try.fill_rectang
-0001ec80: 6c65 2829 2022 0a20 2020 2020 2020 2020  le() ".         
-0001ec90: 2020 2022 6066 696c 6c5f 6c61 7965 7273     "`fill_layers
-0001eca0: 6020 616e 6420 6066 696c 6c5f 6465 6e73  ` and `fill_dens
-0001ecb0: 6974 6965 7360 2070 6172 616d 6574 6572  ities` parameter
-0001ecc0: 7320 220a 2020 2020 2020 2020 2020 2020  s ".            
-0001ecd0: 226d 7573 7420 6265 206c 6973 7473 206f  "must be lists o
-0001ece0: 6620 7468 6520 7361 6d65 206c 656e 6774  f the same lengt
-0001ecf0: 6822 0a20 2020 2020 2020 2029 0a20 2020  h".        ).   
-0001ed00: 2069 6620 6c65 6e28 6669 6c6c 5f6c 6179   if len(fill_lay
-0001ed10: 6572 7329 2021 3d20 6c65 6e28 6669 6c6c  ers) != len(fill
-0001ed20: 5f69 6e76 6572 7465 6429 3a0a 2020 2020  _inverted):.    
-0001ed30: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0001ed40: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0001ed50: 2020 225b 5048 4944 4c5d 2070 6869 646c    "[PHIDL] phidl
-0001ed60: 2e67 656f 6d65 7472 792e 6669 6c6c 5f72  .geometry.fill_r
-0001ed70: 6563 7461 6e67 6c65 2829 2022 0a20 2020  ectangle() ".   
-0001ed80: 2020 2020 2020 2020 2022 6066 696c 6c5f           "`fill_
-0001ed90: 6c61 7965 7273 6020 616e 6420 6066 696c  layers` and `fil
-0001eda0: 6c5f 696e 7665 7274 6564 6020 7061 7261  l_inverted` para
-0001edb0: 6d65 7465 7273 206d 7573 7420 220a 2020  meters must ".  
-0001edc0: 2020 2020 2020 2020 2020 2262 6520 6c69            "be li
-0001edd0: 7374 7320 6f66 2074 6865 2073 616d 6520  sts of the same 
-0001ede0: 6c65 6e67 7468 220a 2020 2020 2020 2020  length".        
-0001edf0: 290a 0a20 2020 2066 696c 6c5f 6365 6c6c  )..    fill_cell
-0001ee00: 203d 205f 6669 6c6c 5f63 656c 6c5f 7265   = _fill_cell_re
-0001ee10: 6374 616e 676c 6528 0a20 2020 2020 2020  ctangle(.       
-0001ee20: 2073 697a 653d 6669 6c6c 5f73 697a 652c   size=fill_size,
-0001ee30: 0a20 2020 2020 2020 206c 6179 6572 733d  .        layers=
-0001ee40: 6669 6c6c 5f6c 6179 6572 732c 0a20 2020  fill_layers,.   
-0001ee50: 2020 2020 2064 656e 7369 7469 6573 3d66       densities=f
-0001ee60: 696c 6c5f 6465 6e73 6974 6965 732c 0a20  ill_densities,. 
-0001ee70: 2020 2020 2020 2069 6e76 6572 7465 643d         inverted=
-0001ee80: 6669 6c6c 5f69 6e76 6572 7465 642c 0a20  fill_inverted,. 
-0001ee90: 2020 2029 0a20 2020 2046 203d 2044 6576     ).    F = Dev
-0001eea0: 6963 6528 6e61 6d65 3d22 6669 6c6c 5f70  ice(name="fill_p
-0001eeb0: 6174 7465 726e 2229 0a0a 2020 2020 6966  attern")..    if
-0001eec0: 2061 766f 6964 5f6c 6179 6572 7320 3d3d   avoid_layers ==
-0001eed0: 2022 616c 6c22 3a0a 2020 2020 2020 2020   "all":.        
-0001eee0: 6578 636c 7564 655f 706f 6c79 7320 3d20  exclude_polys = 
-0001eef0: 442e 6765 745f 706f 6c79 676f 6e73 2862  D.get_polygons(b
-0001ef00: 795f 7370 6563 3d46 616c 7365 2c20 6465  y_spec=False, de
-0001ef10: 7074 683d 4e6f 6e65 290a 2020 2020 656c  pth=None).    el
-0001ef20: 7365 3a0a 2020 2020 2020 2020 6176 6f69  se:.        avoi
-0001ef30: 645f 6c61 7965 7273 203d 205b 5f70 6172  d_layers = [_par
-0001ef40: 7365 5f6c 6179 6572 286c 2920 666f 7220  se_layer(l) for 
-0001ef50: 6c20 696e 205f 6c6f 6f70 5f6f 7665 7228  l in _loop_over(
-0001ef60: 6176 6f69 645f 6c61 7965 7273 295d 0a20  avoid_layers)]. 
-0001ef70: 2020 2020 2020 2065 7863 6c75 6465 5f70         exclude_p
-0001ef80: 6f6c 7973 203d 2044 2e67 6574 5f70 6f6c  olys = D.get_pol
-0001ef90: 7967 6f6e 7328 6279 5f73 7065 633d 5472  ygons(by_spec=Tr
-0001efa0: 7565 2c20 6465 7074 683d 4e6f 6e65 290a  ue, depth=None).
-0001efb0: 2020 2020 2020 2020 6578 636c 7564 655f          exclude_
-0001efc0: 706f 6c79 7320 3d20 7b0a 2020 2020 2020  polys = {.      
-0001efd0: 2020 2020 2020 6b65 793a 2065 7863 6c75        key: exclu
-0001efe0: 6465 5f70 6f6c 7973 5b6b 6579 5d20 666f  de_polys[key] fo
-0001eff0: 7220 6b65 7920 696e 2065 7863 6c75 6465  r key in exclude
-0001f000: 5f70 6f6c 7973 2069 6620 6b65 7920 696e  _polys if key in
-0001f010: 2061 766f 6964 5f6c 6179 6572 730a 2020   avoid_layers.  
-0001f020: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-0001f030: 6578 636c 7564 655f 706f 6c79 7320 3d20  exclude_polys = 
-0001f040: 6974 6572 746f 6f6c 732e 6368 6169 6e2e  itertools.chain.
-0001f050: 6672 6f6d 5f69 7465 7261 626c 6528 6578  from_iterable(ex
-0001f060: 636c 7564 655f 706f 6c79 732e 7661 6c75  clude_polys.valu
-0001f070: 6573 2829 290a 0a20 2020 2069 6620 696e  es())..    if in
-0001f080: 636c 7564 655f 6c61 7965 7273 2069 7320  clude_layers is 
-0001f090: 4e6f 6e65 3a0a 2020 2020 2020 2020 696e  None:.        in
-0001f0a0: 636c 7564 655f 706f 6c79 7320 3d20 5b5d  clude_polys = []
-0001f0b0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-0001f0c0: 2020 2069 6e63 6c75 6465 5f6c 6179 6572     include_layer
-0001f0d0: 7320 3d20 5b5f 7061 7273 655f 6c61 7965  s = [_parse_laye
-0001f0e0: 7228 6c29 2066 6f72 206c 2069 6e20 5f6c  r(l) for l in _l
-0001f0f0: 6f6f 705f 6f76 6572 2869 6e63 6c75 6465  oop_over(include
-0001f100: 5f6c 6179 6572 7329 5d0a 2020 2020 2020  _layers)].      
-0001f110: 2020 696e 636c 7564 655f 706f 6c79 7320    include_polys 
-0001f120: 3d20 442e 6765 745f 706f 6c79 676f 6e73  = D.get_polygons
-0001f130: 2862 795f 7370 6563 3d54 7275 652c 2064  (by_spec=True, d
-0001f140: 6570 7468 3d4e 6f6e 6529 0a20 2020 2020  epth=None).     
-0001f150: 2020 2069 6e63 6c75 6465 5f70 6f6c 7973     include_polys
-0001f160: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-0001f170: 206b 6579 3a20 696e 636c 7564 655f 706f   key: include_po
-0001f180: 6c79 735b 6b65 795d 2066 6f72 206b 6579  lys[key] for key
-0001f190: 2069 6e20 696e 636c 7564 655f 706f 6c79   in include_poly
-0001f1a0: 7320 6966 206b 6579 2069 6e20 696e 636c  s if key in incl
-0001f1b0: 7564 655f 6c61 7965 7273 0a20 2020 2020  ude_layers.     
-0001f1c0: 2020 207d 0a20 2020 2020 2020 2069 6e63     }.        inc
-0001f1d0: 6c75 6465 5f70 6f6c 7973 203d 2069 7465  lude_polys = ite
-0001f1e0: 7274 6f6f 6c73 2e63 6861 696e 2e66 726f  rtools.chain.fro
-0001f1f0: 6d5f 6974 6572 6162 6c65 2869 6e63 6c75  m_iterable(inclu
-0001f200: 6465 5f70 6f6c 7973 2e76 616c 7565 7328  de_polys.values(
-0001f210: 2929 0a0a 2020 2020 6966 2062 626f 7820  ))..    if bbox 
-0001f220: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0001f230: 2062 626f 7820 3d20 442e 6262 6f78 0a0a   bbox = D.bbox..
-0001f240: 2020 2020 7261 7374 6572 203d 205f 7261      raster = _ra
-0001f250: 7374 6572 697a 655f 706f 6c79 676f 6e73  sterize_polygons
-0001f260: 280a 2020 2020 2020 2020 706f 6c79 676f  (.        polygo
-0001f270: 6e73 3d65 7863 6c75 6465 5f70 6f6c 7973  ns=exclude_polys
-0001f280: 2c20 626f 756e 6473 3d62 626f 782c 2064  , bounds=bbox, d
-0001f290: 783d 6669 6c6c 5f73 697a 655b 305d 2c20  x=fill_size[0], 
-0001f2a0: 6479 3d66 696c 6c5f 7369 7a65 5b31 5d0a  dy=fill_size[1].
-0001f2b0: 2020 2020 290a 2020 2020 7261 7374 6572      ).    raster
-0001f2c0: 203d 2072 6173 7465 7220 2620 7e5f 7261   = raster & ~_ra
-0001f2d0: 7374 6572 697a 655f 706f 6c79 676f 6e73  sterize_polygons
-0001f2e0: 280a 2020 2020 2020 2020 706f 6c79 676f  (.        polygo
-0001f2f0: 6e73 3d69 6e63 6c75 6465 5f70 6f6c 7973  ns=include_polys
-0001f300: 2c20 626f 756e 6473 3d62 626f 782c 2064  , bounds=bbox, d
-0001f310: 783d 6669 6c6c 5f73 697a 655b 305d 2c20  x=fill_size[0], 
-0001f320: 6479 3d66 696c 6c5f 7369 7a65 5b31 5d0a  dy=fill_size[1].
-0001f330: 2020 2020 290a 2020 2020 7261 7374 6572      ).    raster
-0001f340: 203d 205f 6578 7061 6e64 5f72 6173 7465   = _expand_raste
-0001f350: 7228 7261 7374 6572 2c20 6469 7374 616e  r(raster, distan
-0001f360: 6365 3d6d 6172 6769 6e20 2f20 6e70 2e61  ce=margin / np.a
-0001f370: 7272 6179 2866 696c 6c5f 7369 7a65 2929  rray(fill_size))
-0001f380: 0a0a 2020 2020 666f 7220 6920 696e 2072  ..    for i in r
-0001f390: 616e 6765 286e 702e 7369 7a65 2872 6173  ange(np.size(ras
-0001f3a0: 7465 722c 2030 2929 3a0a 2020 2020 2020  ter, 0)):.      
-0001f3b0: 2020 7375 625f 7261 7374 6572 7320 3d20    sub_rasters = 
-0001f3c0: 5b6c 6973 7428 6729 2066 6f72 206b 2c20  [list(g) for k, 
-0001f3d0: 6720 696e 2069 7465 7274 6f6f 6c73 2e67  g in itertools.g
-0001f3e0: 726f 7570 6279 2872 6173 7465 725b 695d  roupby(raster[i]
-0001f3f0: 295d 0a20 2020 2020 2020 206a 203d 2030  )].        j = 0
-0001f400: 0a20 2020 2020 2020 2066 6f72 2073 2069  .        for s i
-0001f410: 6e20 7375 625f 7261 7374 6572 733a 0a20  n sub_rasters:. 
-0001f420: 2020 2020 2020 2020 2020 2069 6620 735b             if s[
-0001f430: 305d 203d 3d20 303a 0a20 2020 2020 2020  0] == 0:.       
-0001f440: 2020 2020 2020 2020 2078 2c20 7920 3d20           x, y = 
-0001f450: 5f72 6173 7465 725f 696e 6465 785f 746f  _raster_index_to
-0001f460: 5f63 6f6f 7264 7328 692c 206a 2c20 6262  _coords(i, j, bb
-0001f470: 6f78 2c20 6669 6c6c 5f73 697a 655b 305d  ox, fill_size[0]
-0001f480: 2c20 6669 6c6c 5f73 697a 655b 315d 290a  , fill_size[1]).
-0001f490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f4a0: 2320 462e 6164 6428 6764 7370 792e 4365  # F.add(gdspy.Ce
-0001f4b0: 6c6c 4172 7261 7928 7265 665f 6365 6c6c  llArray(ref_cell
-0001f4c0: 203d 2066 696c 6c5f 6365 6c6c 2c0a 2020   = fill_cell,.  
-0001f4d0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001f4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f4f0: 2020 2020 2020 636f 6c75 6d6e 7320 3d20        columns = 
-0001f500: 6c65 6e28 7329 2c20 726f 7773 203d 2031  len(s), rows = 1
-0001f510: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001f520: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0001f530: 2020 2020 2020 2020 2020 7370 6163 696e            spacin
-0001f540: 6720 3d20 6669 6c6c 5f73 697a 652c 2029  g = fill_size, )
-0001f550: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001f560: 2020 6120 3d20 462e 6164 645f 6172 7261    a = F.add_arra
-0001f570: 7928 6669 6c6c 5f63 656c 6c2c 2063 6f6c  y(fill_cell, col
-0001f580: 756d 6e73 3d6c 656e 2873 292c 2072 6f77  umns=len(s), row
-0001f590: 733d 312c 2073 7061 6369 6e67 3d66 696c  s=1, spacing=fil
-0001f5a0: 6c5f 7369 7a65 290a 2020 2020 2020 2020  l_size).        
-0001f5b0: 2020 2020 2020 2020 612e 6d6f 7665 2828          a.move((
-0001f5c0: 782c 2079 2929 0a20 2020 2020 2020 2020  x, y)).         
-0001f5d0: 2020 206a 202b 3d20 6c65 6e28 7329 0a0a     j += len(s)..
-0001f5e0: 2020 2020 7265 7475 726e 2046 0a0a 0a23      return F...#
-0001f5f0: 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d   ===============
-0001f600: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001f610: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001f620: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001f630: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a  ===============.
-0001f640: 230a 2320 5068 6f74 6f6e 6963 730a 230a  #.# Photonics.#.
-0001f650: 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  # ==============
-0001f660: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001f670: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001f680: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001f690: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001f6a0: 0a0a 0a64 6566 2070 6f6c 7967 6f6e 5f70  ...def polygon_p
-0001f6b0: 6f72 7473 2878 7074 733d 5b2d 312c 202d  orts(xpts=[-1, -
-0001f6c0: 312c 2030 2c20 305d 2c20 7970 7473 3d5b  1, 0, 0], ypts=[
-0001f6d0: 302c 2031 2c20 312c 2030 5d2c 206c 6179  0, 1, 1, 0], lay
-0001f6e0: 6572 3d30 293a 0a20 2020 2022 2222 4372  er=0):.    """Cr
-0001f6f0: 6561 7465 7320 6120 706f 6c79 676f 6e20  eates a polygon 
-0001f700: 7769 7468 2070 6f72 7473 206f 6e20 616c  with ports on al
-0001f710: 6c20 6564 6765 732e 0a0a 2020 2020 5061  l edges...    Pa
-0001f720: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
-0001f730: 2d2d 2d2d 2d2d 2d0a 2020 2020 7870 7473  -------.    xpts
-0001f740: 203a 2061 7272 6179 2d6c 696b 650a 2020   : array-like.  
-0001f750: 2020 2020 2020 782d 636f 6f72 6469 6e61        x-coordina
-0001f760: 7465 2076 616c 7565 7320 6f66 2074 6865  te values of the
-0001f770: 2070 6f6c 7967 6f6e 2076 6572 7469 6365   polygon vertice
-0001f780: 732e 0a20 2020 2079 7074 7320 3a20 6172  s..    ypts : ar
-0001f790: 7261 792d 6c69 6b65 0a20 2020 2020 2020  ray-like.       
-0001f7a0: 2079 2d63 6f6f 7264 696e 6174 6520 7661   y-coordinate va
-0001f7b0: 6c75 6573 206f 6620 7468 6520 706f 6c79  lues of the poly
-0001f7c0: 676f 6e20 7665 7274 6963 6573 2e0a 2020  gon vertices..  
-0001f7d0: 2020 6c61 7965 7220 3a20 696e 742c 2061    layer : int, a
-0001f7e0: 7272 6179 2d6c 696b 655b 325d 2c20 6f72  rray-like[2], or
-0001f7f0: 2073 6574 0a20 2020 2020 2020 2053 7065   set.        Spe
-0001f800: 6369 6669 6320 6c61 7965 7228 7329 2074  cific layer(s) t
-0001f810: 6f20 7075 7420 706f 6c79 676f 6e20 6765  o put polygon ge
-0001f820: 6f6d 6574 7279 206f 6e2e 0a0a 2020 2020  ometry on...    
-0001f830: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
-0001f840: 2d2d 2d0a 2020 2020 5020 3a20 4465 7669  ---.    P : Devi
-0001f850: 6365 0a20 2020 2020 2020 2041 2044 6576  ce.        A Dev
-0001f860: 6963 6520 636f 6e74 6169 6e69 6e67 2061  ice containing a
-0001f870: 2070 6f6c 7967 6f6e 2077 6974 6820 706f   polygon with po
-0001f880: 7274 7320 6f6e 2061 6c6c 2065 6467 6573  rts on all edges
-0001f890: 2e0a 2020 2020 2222 220a 2020 2020 2320  ..    """.    # 
-0001f8a0: 7265 7475 726e 7320 6120 706f 6c79 676f  returns a polygo
-0001f8b0: 6e20 7769 7468 2070 6f72 7473 206f 6e20  n with ports on 
-0001f8c0: 616c 6c20 6564 6765 730a 2020 2020 5020  all edges.    P 
-0001f8d0: 3d20 4465 7669 6365 2822 706f 6c79 676f  = Device("polygo
-0001f8e0: 6e22 290a 2020 2020 502e 6164 645f 706f  n").    P.add_po
-0001f8f0: 6c79 676f 6e28 5b78 7074 732c 2079 7074  lygon([xpts, ypt
-0001f900: 735d 2c20 6c61 7965 723d 6c61 7965 7229  s], layer=layer)
-0001f910: 0a20 2020 206e 203d 206c 656e 2878 7074  .    n = len(xpt
-0001f920: 7329 0a20 2020 2078 7074 732e 6170 7065  s).    xpts.appe
-0001f930: 6e64 2878 7074 735b 305d 290a 2020 2020  nd(xpts[0]).    
-0001f940: 7970 7473 2e61 7070 656e 6428 7970 7473  ypts.append(ypts
-0001f950: 5b30 5d29 0a20 2020 2023 2064 6574 6572  [0]).    # deter
-0001f960: 6d69 6e65 2069 6620 636c 6f63 6b77 6973  mine if clockwis
-0001f970: 6520 6f72 2063 6f75 6e74 6572 636c 6f63  e or countercloc
-0001f980: 6b77 6973 650a 2020 2020 6363 203d 2030  kwise.    cc = 0
-0001f990: 0a20 2020 2066 6f72 2069 2069 6e20 7261  .    for i in ra
-0001f9a0: 6e67 6528 302c 206e 293a 0a20 2020 2020  nge(0, n):.     
-0001f9b0: 2020 2063 6320 2b3d 2028 7870 7473 5b69     cc += (xpts[i
-0001f9c0: 202b 2031 5d20 2d20 7870 7473 5b69 5d29   + 1] - xpts[i])
-0001f9d0: 202a 2028 7970 7473 5b69 202b 2031 5d20   * (ypts[i + 1] 
-0001f9e0: 2b20 7970 7473 5b69 5d29 0a0a 2020 2020  + ypts[i])..    
-0001f9f0: 666f 7220 6920 696e 2072 616e 6765 2830  for i in range(0
-0001fa00: 2c20 6e29 3a0a 2020 2020 2020 2020 6d69  , n):.        mi
-0001fa10: 6470 6f69 6e74 5f6e 203d 205b 2878 7074  dpoint_n = [(xpt
-0001fa20: 735b 6920 2b20 315d 202b 2078 7074 735b  s[i + 1] + xpts[
-0001fa30: 695d 2920 2f20 322c 2028 7970 7473 5b69  i]) / 2, (ypts[i
-0001fa40: 202b 2031 5d20 2b20 7970 7473 5b69 5d29   + 1] + ypts[i])
-0001fa50: 202f 2032 5d0a 2020 2020 2020 2020 6f72   / 2].        or
-0001fa60: 6965 6e74 6174 696f 6e5f 6e20 3d20 280a  ientation_n = (.
-0001fa70: 2020 2020 2020 2020 2020 2020 6e70 2e61              np.a
-0001fa80: 7263 7461 6e32 280a 2020 2020 2020 2020  rctan2(.        
-0001fa90: 2020 2020 2020 2020 6e70 2e73 6967 6e28          np.sign(
-0001faa0: 6363 2920 2a20 2878 7074 735b 6920 2b20  cc) * (xpts[i + 
-0001fab0: 315d 202d 2078 7074 735b 695d 292c 0a20  1] - xpts[i]),. 
-0001fac0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0001fad0: 702e 7369 676e 2863 6329 202a 2028 7970  p.sign(cc) * (yp
-0001fae0: 7473 5b69 5d20 2d20 7970 7473 5b69 202b  ts[i] - ypts[i +
-0001faf0: 2031 5d29 2c0a 2020 2020 2020 2020 2020   1]),.          
-0001fb00: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0001fb10: 2a20 3138 300a 2020 2020 2020 2020 2020  * 180.          
-0001fb20: 2020 2f20 7069 0a20 2020 2020 2020 2029    / pi.        )
-0001fb30: 0a20 2020 2020 2020 2077 6964 7468 5f6e  .        width_n
-0001fb40: 203d 206e 702e 6162 7328 0a20 2020 2020   = np.abs(.     
-0001fb50: 2020 2020 2020 2073 7172 7428 2878 7074         sqrt((xpt
-0001fb60: 735b 6920 2b20 315d 202d 2078 7074 735b  s[i + 1] - xpts[
-0001fb70: 695d 2920 2a2a 2032 202b 2028 7970 7473  i]) ** 2 + (ypts
-0001fb80: 5b69 202b 2031 5d20 2d20 7970 7473 5b69  [i + 1] - ypts[i
-0001fb90: 5d29 202a 2a20 3229 0a20 2020 2020 2020  ]) ** 2).       
-0001fba0: 2029 0a20 2020 2020 2020 2050 2e61 6464   ).        P.add
-0001fbb0: 5f70 6f72 7428 0a20 2020 2020 2020 2020  _port(.         
-0001fbc0: 2020 206e 616d 653d 7374 7228 6920 2b20     name=str(i + 
-0001fbd0: 3129 2c0a 2020 2020 2020 2020 2020 2020  1),.            
-0001fbe0: 6d69 6470 6f69 6e74 3d6d 6964 706f 696e  midpoint=midpoin
-0001fbf0: 745f 6e2c 0a20 2020 2020 2020 2020 2020  t_n,.           
-0001fc00: 2077 6964 7468 3d77 6964 7468 5f6e 2c0a   width=width_n,.
-0001fc10: 2020 2020 2020 2020 2020 2020 6f72 6965              orie
-0001fc20: 6e74 6174 696f 6e3d 6f72 6965 6e74 6174  ntation=orientat
-0001fc30: 696f 6e5f 6e2c 0a20 2020 2020 2020 2029  ion_n,.        )
-0001fc40: 0a0a 2020 2020 7265 7475 726e 2050 0a0a  ..    return P..
-0001fc50: 0a23 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  .# =============
-0001fc60: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001fc70: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001fc80: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001fc90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001fca0: 3d0a 2320 4578 616d 706c 6520 636f 6465  =.# Example code
-0001fcb0: 0a23 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  .# =============
-0001fcc0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001fcd0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001fce0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001fcf0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0001fd00: 3d0a 0a23 2050 203d 2070 6f6c 7967 6f6e  =..# P = polygon
-0001fd10: 2878 7074 733d 5b2d 312c 2d33 2c20 302c  (xpts=[-1,-3, 0,
-0001fd20: 2030 5d2c 2079 7074 7320 3d20 5b30 2c20   0], ypts = [0, 
-0001fd30: 312c 2032 2c20 305d 2c20 6c61 7965 7220  1, 2, 0], layer 
-0001fd40: 3d20 3329 0a23 2071 7569 636b 706c 6f74  = 3).# quickplot
-0001fd50: 2850 290a 0a0a 4064 6576 6963 655f 6c72  (P)...@device_lr
-0001fd60: 755f 6361 6368 650a 6465 6620 6772 6174  u_cache.def grat
-0001fd70: 696e 6728 0a20 2020 206e 756d 5f70 6572  ing(.    num_per
-0001fd80: 696f 6473 3d32 302c 0a20 2020 2070 6572  iods=20,.    per
-0001fd90: 696f 643d 302e 3735 2c0a 2020 2020 6669  iod=0.75,.    fi
-0001fda0: 6c6c 5f66 6163 746f 723d 302e 352c 0a20  ll_factor=0.5,. 
-0001fdb0: 2020 2077 6964 7468 5f67 7261 7469 6e67     width_grating
-0001fdc0: 3d35 2c0a 2020 2020 6c65 6e67 7468 5f74  =5,.    length_t
-0001fdd0: 6170 6572 3d31 302c 0a20 2020 2077 6964  aper=10,.    wid
-0001fde0: 7468 3d30 2e34 2c0a 2020 2020 7061 7274  th=0.4,.    part
-0001fdf0: 6961 6c5f 6574 6368 3d46 616c 7365 2c0a  ial_etch=False,.
-0001fe00: 293a 0a20 2020 2022 2222 5369 6d70 6c65  ):.    """Simple
-0001fe10: 2067 7261 7469 6e67 2073 7472 7563 7475   grating structu
-0001fe20: 7265 2066 6f72 2070 686f 746f 6e69 6373  re for photonics
-0001fe30: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-0001fe40: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-0001fe50: 2020 2020 6e75 6d5f 7065 7269 6f64 7320      num_periods 
-0001fe60: 3a20 696e 740a 2020 2020 2020 2020 4e75  : int.        Nu
-0001fe70: 6d62 6572 206f 6620 6772 6174 696e 6773  mber of gratings
-0001fe80: 2e0a 2020 2020 7065 7269 6f64 203a 2069  ..    period : i
-0001fe90: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
-0001fea0: 2020 2020 4469 7374 616e 6365 2062 6574      Distance bet
-0001feb0: 7765 656e 2067 7261 7469 6e67 732e 0a20  ween gratings.. 
-0001fec0: 2020 2066 696c 6c5f 6661 6374 6f72 203a     fill_factor :
-0001fed0: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
-0001fee0: 2020 2020 2020 5468 6963 6b6e 6573 7320        Thickness 
-0001fef0: 6f66 2074 6865 2067 7261 7469 6e67 732e  of the gratings.
-0001ff00: 0a20 2020 2077 6964 7468 5f67 7261 7469  .    width_grati
-0001ff10: 6e67 203a 2069 6e74 206f 7220 666c 6f61  ng : int or floa
-0001ff20: 740a 2020 2020 2020 2020 5769 6474 6820  t.        Width 
-0001ff30: 6f66 2074 6865 2067 7261 7469 6e67 732e  of the gratings.
-0001ff40: 0a20 2020 206c 656e 6774 685f 7461 7065  .    length_tape
-0001ff50: 7220 3a20 696e 7420 6f72 2066 6c6f 6174  r : int or float
-0001ff60: 0a20 2020 2020 2020 204c 656e 6774 6820  .        Length 
-0001ff70: 6f66 2074 6865 2074 6170 6572 2073 6563  of the taper sec
-0001ff80: 7469 6f6e 2e0a 2020 2020 7769 6474 6820  tion..    width 
-0001ff90: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
-0001ffa0: 2020 2020 2020 2057 6964 7468 206f 6620         Width of 
-0001ffb0: 7468 6520 656e 6420 6f66 2074 6865 2074  the end of the t
-0001ffc0: 6170 6572 2073 6563 7469 6f6e 2e0a 2020  aper section..  
-0001ffd0: 2020 7061 7274 6961 6c5f 6574 6368 203a    partial_etch :
-0001ffe0: 2062 6f6f 6c0a 2020 2020 2020 2020 4966   bool.        If
-0001fff0: 2054 7275 652c 206d 616b 6573 2061 6e20   True, makes an 
-00020000: 756e 7461 7065 7265 642c 2070 6172 7469  untapered, parti
-00020010: 616c 6c79 2d65 7463 6865 6420 6772 6174  ally-etched grat
-00020020: 696e 672e 0a0a 2020 2020 5265 7475 726e  ing...    Return
-00020030: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-00020040: 2020 4720 3a20 4465 7669 6365 0a20 2020    G : Device.   
-00020050: 2020 2020 2041 2044 6576 6963 6520 636f       A Device co
-00020060: 6e74 6169 6e69 6e67 2061 2066 6962 6572  ntaining a fiber
-00020070: 2067 7261 7469 6e67 2067 656f 6d65 7472   grating geometr
-00020080: 792e 0a20 2020 2022 2222 0a20 2020 2023  y..    """.    #
-00020090: 2072 6574 7572 6e73 2061 2066 6962 6572   returns a fiber
-000200a0: 2067 7261 7469 6e67 0a20 2020 2047 203d   grating.    G =
-000200b0: 2044 6576 6963 6528 2267 7261 7469 6e67   Device("grating
-000200c0: 2229 0a0a 2020 2020 2320 6d61 6b65 2074  ")..    # make t
-000200d0: 6865 2064 6565 7020 6574 6368 6564 2067  he deep etched g
-000200e0: 7261 7469 6e67 0a20 2020 2069 6620 7061  rating.    if pa
-000200f0: 7274 6961 6c5f 6574 6368 2069 7320 4661  rtial_etch is Fa
-00020100: 6c73 653a 0a20 2020 2020 2020 2023 206d  lse:.        # m
-00020110: 616b 6520 7468 6520 6772 6174 696e 6720  ake the grating 
-00020120: 7465 6574 680a 2020 2020 2020 2020 666f  teeth.        fo
-00020130: 7220 6920 696e 2072 616e 6765 286e 756d  r i in range(num
-00020140: 5f70 6572 696f 6473 293a 0a20 2020 2020  _periods):.     
-00020150: 2020 2020 2020 2063 6772 6174 696e 6720         cgrating 
-00020160: 3d20 472e 6164 645f 7265 6628 0a20 2020  = G.add_ref(.   
-00020170: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-00020180: 7061 7373 2873 697a 653d 5b70 6572 696f  pass(size=[perio
-00020190: 6420 2a20 6669 6c6c 5f66 6163 746f 722c  d * fill_factor,
-000201a0: 2077 6964 7468 5f67 7261 7469 6e67 5d2c   width_grating],
-000201b0: 206c 6179 6572 3d30 290a 2020 2020 2020   layer=0).      
-000201c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000201d0: 2020 2020 6367 7261 7469 6e67 2e78 202b      cgrating.x +
-000201e0: 3d20 6920 2a20 7065 7269 6f64 0a0a 2020  = i * period..  
-000201f0: 2020 2020 2020 2320 6d61 6b65 2074 6865        # make the
-00020200: 2074 6170 6572 0a20 2020 2020 2020 2074   taper.        t
-00020210: 6772 6174 696e 6720 3d20 472e 6164 645f  grating = G.add_
-00020220: 7265 6628 0a20 2020 2020 2020 2020 2020  ref(.           
-00020230: 2074 6170 6572 280a 2020 2020 2020 2020   taper(.        
-00020240: 2020 2020 2020 2020 6c65 6e67 7468 3d6c          length=l
-00020250: 656e 6774 685f 7461 7065 722c 0a20 2020  ength_taper,.   
-00020260: 2020 2020 2020 2020 2020 2020 2077 6964               wid
-00020270: 7468 313d 7769 6474 685f 6772 6174 696e  th1=width_gratin
-00020280: 672c 0a20 2020 2020 2020 2020 2020 2020  g,.             
-00020290: 2020 2077 6964 7468 323d 7769 6474 682c     width2=width,
-000202a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000202b0: 2070 6f72 743d 4e6f 6e65 2c0a 2020 2020   port=None,.    
-000202c0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-000202d0: 723d 302c 0a20 2020 2020 2020 2020 2020  r=0,.           
-000202e0: 2029 0a20 2020 2020 2020 2029 0a20 2020   ).        ).   
-000202f0: 2020 2020 2074 6772 6174 696e 672e 786d       tgrating.xm
-00020300: 696e 203d 2063 6772 6174 696e 672e 786d  in = cgrating.xm
-00020310: 6178 0a20 2020 2020 2020 2023 2064 6566  ax.        # def
-00020320: 696e 6520 7468 6520 706f 7274 206f 6620  ine the port of 
-00020330: 7468 6520 6772 6174 696e 670a 2020 2020  the grating.    
-00020340: 2020 2020 7020 3d20 472e 6164 645f 706f      p = G.add_po
-00020350: 7274 2870 6f72 743d 7467 7261 7469 6e67  rt(port=tgrating
-00020360: 2e70 6f72 7473 5b32 5d2c 206e 616d 653d  .ports[2], name=
-00020370: 3129 0a20 2020 2023 206d 616b 6520 6120  1).    # make a 
-00020380: 7061 7274 6961 6c6c 7920 6574 6368 6564  partially etched
-00020390: 2067 7261 7469 6e67 0a20 2020 2069 6620   grating.    if 
-000203a0: 7061 7274 6961 6c5f 6574 6368 2069 7320  partial_etch is 
-000203b0: 5472 7565 3a0a 2020 2020 2020 2020 2320  True:.        # 
-000203c0: 6861 7264 2063 6f64 6564 206f 7665 726c  hard coded overl
-000203d0: 6170 0a20 2020 2020 2020 2070 6172 7465  ap.        parte
-000203e0: 7463 685f 6f76 6572 6861 6e67 203d 2035  tch_overhang = 5
-000203f0: 0a20 2020 2020 2020 2023 206d 616b 6520  .        # make 
-00020400: 7468 6520 6574 6368 6564 2061 7265 6173  the etched areas
-00020410: 2028 6f70 706f 7369 7465 2074 6f20 7465   (opposite to te
-00020420: 6574 6829 0a20 2020 2020 2020 2066 6f72  eth).        for
-00020430: 2069 2069 6e20 7261 6e67 6528 6e75 6d5f   i in range(num_
-00020440: 7065 7269 6f64 7329 3a0a 2020 2020 2020  periods):.      
-00020450: 2020 2020 2020 6367 7261 7469 6e67 203d        cgrating =
-00020460: 2047 2e61 6464 5f72 6566 280a 2020 2020   G.add_ref(.    
-00020470: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00020480: 6173 7328 0a20 2020 2020 2020 2020 2020  ass(.           
-00020490: 2020 2020 2020 2020 2073 697a 653d 5b0a           size=[.
-000204a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000204b0: 2020 2020 2020 2020 7065 7269 6f64 202a          period *
-000204c0: 2028 3120 2d20 6669 6c6c 5f66 6163 746f   (1 - fill_facto
-000204d0: 7229 2c0a 2020 2020 2020 2020 2020 2020  r),.            
-000204e0: 2020 2020 2020 2020 2020 2020 7769 6474              widt
-000204f0: 685f 6772 6174 696e 6720 2b20 7061 7274  h_grating + part
-00020500: 6574 6368 5f6f 7665 7268 616e 6720 2a20  etch_overhang * 
-00020510: 322c 0a20 2020 2020 2020 2020 2020 2020  2,.             
-00020520: 2020 2020 2020 205d 2c0a 2020 2020 2020         ],.      
-00020530: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00020540: 7965 723d 312c 0a20 2020 2020 2020 2020  yer=1,.         
-00020550: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00020560: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00020570: 2020 2063 6772 6174 696e 672e 7820 2b3d     cgrating.x +=
-00020580: 2069 202a 2070 6572 696f 640a 2020 2020   i * period.    
-00020590: 2020 2020 2320 6465 6669 6e65 2074 6865      # define the
-000205a0: 2070 6f72 7420 6f66 2074 6865 2067 7261   port of the gra
-000205b0: 7469 6e67 0a20 2020 2020 2020 2070 203d  ting.        p =
-000205c0: 2047 2e61 6464 5f70 6f72 7428 706f 7274   G.add_port(port
-000205d0: 3d63 6772 6174 696e 672e 706f 7274 735b  =cgrating.ports[
-000205e0: 2245 225d 2c20 6e61 6d65 3d31 290a 2020  "E"], name=1).  
-000205f0: 2020 2020 2020 702e 6d69 6470 6f69 6e74        p.midpoint
-00020600: 203d 2070 2e6d 6964 706f 696e 7420 2b20   = p.midpoint + 
-00020610: 6e70 2e61 7272 6179 285b 2831 202d 2066  np.array([(1 - f
-00020620: 696c 6c5f 6661 6374 6f72 2920 2a20 7065  ill_factor) * pe
-00020630: 7269 6f64 2c20 305d 290a 0a20 2020 2020  riod, 0])..     
-00020640: 2020 2023 2064 7261 7720 7468 6520 6465     # draw the de
-00020650: 6570 2065 7463 6865 6420 7371 7561 7265  ep etched square
-00020660: 2061 726f 756e 6420 7468 6520 6772 6174   around the grat
-00020670: 696e 670a 2020 2020 2020 2020 472e 6164  ing.        G.ad
-00020680: 645f 7265 6628 2020 2320 6465 6570 626f  d_ref(  # deepbo
-00020690: 780a 2020 2020 2020 2020 2020 2020 636f  x.            co
-000206a0: 6d70 6173 7328 7369 7a65 3d5b 6e75 6d5f  mpass(size=[num_
-000206b0: 7065 7269 6f64 7320 2a20 7065 7269 6f64  periods * period
-000206c0: 2c20 7769 6474 685f 6772 6174 696e 675d  , width_grating]
-000206d0: 2c20 6c61 7965 723d 3029 0a20 2020 2020  , layer=0).     
-000206e0: 2020 2029 0a20 2020 2072 6574 7572 6e20     ).    return 
-000206f0: 470a 0a0a 2320 3d3d 3d3d 3d3d 3d3d 3d3d  G...# ==========
-00020700: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020710: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020720: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020730: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020740: 3d3d 3d3d 0a23 2045 7861 6d70 6c65 2063  ====.# Example c
-00020750: 6f64 650a 2320 3d3d 3d3d 3d3d 3d3d 3d3d  ode.# ==========
-00020760: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020770: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020780: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020790: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000207a0: 3d3d 3d3d 0a0a 2320 4720 3d20 6772 6174  ====..# G = grat
-000207b0: 696e 6728 6e75 6d5f 7065 7269 6f64 7320  ing(num_periods 
-000207c0: 3d20 3230 2c20 7065 7269 6f64 203d 2030  = 20, period = 0
-000207d0: 2e37 352c 2066 696c 6c5f 6661 6374 6f72  .75, fill_factor
-000207e0: 203d 2030 2e35 2c0a 2320 2020 2020 2020   = 0.5,.#       
-000207f0: 2020 2020 2020 7769 6474 685f 6772 6174        width_grat
-00020800: 696e 6720 3d20 3230 2c20 6c65 6e67 7468  ing = 20, length
-00020810: 5f74 6170 6572 203d 2031 302c 2077 6964  _taper = 10, wid
-00020820: 7468 203d 2030 2e34 2c0a 2320 2020 2020  th = 0.4,.#     
-00020830: 2020 2020 2020 2020 7061 7274 6961 6c5f          partial_
-00020840: 6574 6368 203d 2046 616c 7365 290a 2320  etch = False).# 
-00020850: 7175 6963 6b70 6c6f 7428 4729 0a0a 0a23  quickplot(G)...#
-00020860: 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d   ===============
-00020870: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020880: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020890: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000208a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a  ===============.
-000208b0: 230a 2320 5465 7374 2053 7472 7563 7475  #.# Test Structu
-000208c0: 7265 730a 230a 2320 3d3d 3d3d 3d3d 3d3d  res.#.# ========
-000208d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000208e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000208f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020900: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020910: 3d3d 3d3d 3d3d 0a0a 2320 5669 6120 526f  ======..# Via Ro
-00020920: 7574 6520 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ute ------------
-00020930: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00020940: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a64 6566  ------------.def
-00020950: 205f 7669 615f 6974 6572 6162 6c65 280a   _via_iterable(.
-00020960: 2020 2020 7669 615f 7370 6163 696e 672c      via_spacing,
-00020970: 2077 6972 655f 7769 6474 682c 2077 6972   wire_width, wir
-00020980: 696e 6731 5f6c 6179 6572 2c20 7769 7269  ing1_layer, wiri
-00020990: 6e67 325f 6c61 7965 722c 2076 6961 5f6c  ng2_layer, via_l
-000209a0: 6179 6572 2c20 7669 615f 7769 6474 680a  ayer, via_width.
-000209b0: 293a 0a20 2020 2022 2222 4865 6c70 6572  ):.    """Helper
-000209c0: 2066 756e 6374 696f 6e20 666f 7220 7465   function for te
-000209d0: 7374 5f76 6961 0a0a 2020 2020 5061 7261  st_via..    Para
-000209e0: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
-000209f0: 2d2d 2d2d 2d0a 2020 2020 7669 615f 7370  -----.    via_sp
-00020a00: 6163 696e 6720 3a20 696e 7420 6f72 2066  acing : int or f
-00020a10: 6c6f 6174 0a20 2020 2020 2020 2044 6973  loat.        Dis
-00020a20: 7461 6e63 6520 6265 7477 6565 6e20 7669  tance between vi
-00020a30: 6173 2e0a 2020 2020 7769 7265 5f77 6964  as..    wire_wid
-00020a40: 7468 203a 2069 6e74 206f 7220 666c 6f61  th : int or floa
-00020a50: 740a 2020 2020 2020 2020 5468 6520 7769  t.        The wi
-00020a60: 6474 6820 6f66 2074 6865 2077 6972 6573  dth of the wires
-00020a70: 2e0a 2020 2020 7769 7269 6e67 315f 6c61  ..    wiring1_la
-00020a80: 7965 7220 3a20 696e 740a 2020 2020 2020  yer : int.      
-00020a90: 2020 5370 6563 6966 6963 206c 6179 6572    Specific layer
-00020aa0: 2074 6f20 7075 7420 7468 6520 746f 7020   to put the top 
-00020ab0: 7769 7269 6e67 206f 6e2e 0a20 2020 2077  wiring on..    w
-00020ac0: 6972 696e 6732 5f6c 6179 6572 203a 2069  iring2_layer : i
-00020ad0: 6e74 0a20 2020 2020 2020 2053 7065 6369  nt.        Speci
-00020ae0: 6669 6320 6c61 7965 7220 746f 2070 7574  fic layer to put
-00020af0: 2074 6865 2062 6f74 746f 6d20 7769 7269   the bottom wiri
-00020b00: 6e67 206f 6e2e 0a20 2020 2076 6961 5f6c  ng on..    via_l
-00020b10: 6179 6572 203a 2069 6e74 0a20 2020 2020  ayer : int.     
-00020b20: 2020 2053 7065 6369 6669 6320 6c61 7965     Specific laye
-00020b30: 7220 746f 2070 7574 2074 6865 2076 6961  r to put the via
-00020b40: 7320 6f6e 2e0a 2020 2020 7669 615f 7769  s on..    via_wi
-00020b50: 6474 6820 3a20 696e 7420 6f72 2066 6c6f  dth : int or flo
-00020b60: 6174 0a20 2020 2020 2020 2044 6961 6d65  at.        Diame
-00020b70: 7465 7220 6f66 2074 6865 2076 6961 732e  ter of the vias.
-00020b80: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
-00020b90: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 5649    -------.    VI
-00020ba0: 203a 2044 6576 6963 650a 0a20 2020 2022   : Device..    "
-00020bb0: 2222 0a20 2020 2056 4920 3d20 4465 7669  "".    VI = Devi
-00020bc0: 6365 2822 7465 7374 5f76 6961 5f69 7465  ce("test_via_ite
-00020bd0: 7222 290a 2020 2020 7769 7265 3120 3d20  r").    wire1 = 
-00020be0: 5649 2e61 6464 5f72 6566 2863 6f6d 7061  VI.add_ref(compa
-00020bf0: 7373 2873 697a 653d 2876 6961 5f73 7061  ss(size=(via_spa
-00020c00: 6369 6e67 2c20 7769 7265 5f77 6964 7468  cing, wire_width
-00020c10: 292c 206c 6179 6572 3d77 6972 696e 6731  ), layer=wiring1
-00020c20: 5f6c 6179 6572 2929 0a20 2020 2077 6972  _layer)).    wir
-00020c30: 6532 203d 2056 492e 6164 645f 7265 6628  e2 = VI.add_ref(
-00020c40: 636f 6d70 6173 7328 7369 7a65 3d28 7669  compass(size=(vi
-00020c50: 615f 7370 6163 696e 672c 2077 6972 655f  a_spacing, wire_
-00020c60: 7769 6474 6829 2c20 6c61 7965 723d 7769  width), layer=wi
-00020c70: 7269 6e67 325f 6c61 7965 7229 290a 2020  ring2_layer)).  
-00020c80: 2020 7669 6131 203d 2056 492e 6164 645f    via1 = VI.add_
-00020c90: 7265 6628 636f 6d70 6173 7328 7369 7a65  ref(compass(size
-00020ca0: 3d28 7669 615f 7769 6474 682c 2076 6961  =(via_width, via
-00020cb0: 5f77 6964 7468 292c 206c 6179 6572 3d76  _width), layer=v
-00020cc0: 6961 5f6c 6179 6572 2929 0a20 2020 2076  ia_layer)).    v
-00020cd0: 6961 3220 3d20 5649 2e61 6464 5f72 6566  ia2 = VI.add_ref
-00020ce0: 2863 6f6d 7061 7373 2873 697a 653d 2876  (compass(size=(v
-00020cf0: 6961 5f77 6964 7468 2c20 7669 615f 7769  ia_width, via_wi
-00020d00: 6474 6829 2c20 6c61 7965 723d 7669 615f  dth), layer=via_
-00020d10: 6c61 7965 7229 290a 2020 2020 7769 7265  layer)).    wire
-00020d20: 312e 636f 6e6e 6563 7428 706f 7274 3d22  1.connect(port="
-00020d30: 4522 2c20 6465 7374 696e 6174 696f 6e3d  E", destination=
-00020d40: 7769 7265 322e 706f 7274 735b 2257 225d  wire2.ports["W"]
-00020d50: 2c20 6f76 6572 6c61 703d 7769 7265 5f77  , overlap=wire_w
-00020d60: 6964 7468 290a 2020 2020 7669 6131 2e63  idth).    via1.c
-00020d70: 6f6e 6e65 6374 280a 2020 2020 2020 2020  onnect(.        
-00020d80: 706f 7274 3d22 5722 2c20 6465 7374 696e  port="W", destin
-00020d90: 6174 696f 6e3d 7769 7265 312e 706f 7274  ation=wire1.port
-00020da0: 735b 2245 225d 2c20 6f76 6572 6c61 703d  s["E"], overlap=
-00020db0: 2877 6972 655f 7769 6474 6820 2b20 7669  (wire_width + vi
-00020dc0: 615f 7769 6474 6829 202f 2032 0a20 2020  a_width) / 2.   
-00020dd0: 2029 0a20 2020 2076 6961 322e 636f 6e6e   ).    via2.conn
-00020de0: 6563 7428 0a20 2020 2020 2020 2070 6f72  ect(.        por
-00020df0: 743d 2257 222c 2064 6573 7469 6e61 7469  t="W", destinati
-00020e00: 6f6e 3d77 6972 6532 2e70 6f72 7473 5b22  on=wire2.ports["
-00020e10: 4522 5d2c 206f 7665 726c 6170 3d28 7769  E"], overlap=(wi
-00020e20: 7265 5f77 6964 7468 202b 2076 6961 5f77  re_width + via_w
-00020e30: 6964 7468 2920 2f20 320a 2020 2020 290a  idth) / 2.    ).
-00020e40: 2020 2020 5649 2e61 6464 5f70 6f72 7428      VI.add_port(
-00020e50: 6e61 6d65 3d22 5722 2c20 706f 7274 3d77  name="W", port=w
-00020e60: 6972 6531 2e70 6f72 7473 5b22 5722 5d29  ire1.ports["W"])
-00020e70: 0a20 2020 2056 492e 6164 645f 706f 7274  .    VI.add_port
-00020e80: 286e 616d 653d 2245 222c 2070 6f72 743d  (name="E", port=
-00020e90: 7769 7265 322e 706f 7274 735b 2245 225d  wire2.ports["E"]
-00020ea0: 290a 2020 2020 5649 2e61 6464 5f70 6f72  ).    VI.add_por
-00020eb0: 7428 0a20 2020 2020 2020 206e 616d 653d  t(.        name=
-00020ec0: 2253 222c 0a20 2020 2020 2020 206d 6964  "S",.        mid
-00020ed0: 706f 696e 743d 5b28 3120 2a20 7769 7265  point=[(1 * wire
-00020ee0: 5f77 6964 7468 2920 2b20 7769 7265 5f77  _width) + wire_w
-00020ef0: 6964 7468 202f 2032 2c20 2d77 6972 655f  idth / 2, -wire_
-00020f00: 7769 6474 6820 2f20 325d 2c0a 2020 2020  width / 2],.    
-00020f10: 2020 2020 7769 6474 683d 7769 7265 5f77      width=wire_w
-00020f20: 6964 7468 2c0a 2020 2020 2020 2020 6f72  idth,.        or
-00020f30: 6965 6e74 6174 696f 6e3d 2d39 302c 0a20  ientation=-90,. 
-00020f40: 2020 2029 0a20 2020 2056 492e 6164 645f     ).    VI.add_
-00020f50: 706f 7274 280a 2020 2020 2020 2020 6e61  port(.        na
-00020f60: 6d65 3d22 4e22 2c0a 2020 2020 2020 2020  me="N",.        
-00020f70: 6d69 6470 6f69 6e74 3d5b 2831 202a 2077  midpoint=[(1 * w
-00020f80: 6972 655f 7769 6474 6829 202b 2077 6972  ire_width) + wir
-00020f90: 655f 7769 6474 6820 2f20 322c 2077 6972  e_width / 2, wir
-00020fa0: 655f 7769 6474 6820 2f20 325d 2c0a 2020  e_width / 2],.  
-00020fb0: 2020 2020 2020 7769 6474 683d 7769 7265        width=wire
-00020fc0: 5f77 6964 7468 2c0a 2020 2020 2020 2020  _width,.        
-00020fd0: 6f72 6965 6e74 6174 696f 6e3d 3930 2c0a  orientation=90,.
-00020fe0: 2020 2020 290a 0a20 2020 2072 6574 7572      )..    retur
-00020ff0: 6e20 5649 0a0a 0a64 6566 2074 6573 745f  n VI...def test_
-00021000: 7669 6128 0a20 2020 206e 756d 5f76 6961  via(.    num_via
-00021010: 733d 3130 302c 0a20 2020 2077 6972 655f  s=100,.    wire_
-00021020: 7769 6474 683d 3130 2c0a 2020 2020 7669  width=10,.    vi
-00021030: 615f 7769 6474 683d 3135 2c0a 2020 2020  a_width=15,.    
-00021040: 7669 615f 7370 6163 696e 673d 3430 2c0a  via_spacing=40,.
-00021050: 2020 2020 7061 645f 7369 7a65 3d28 3330      pad_size=(30
-00021060: 302c 2033 3030 292c 0a20 2020 206d 696e  0, 300),.    min
-00021070: 5f70 6164 5f73 7061 6369 6e67 3d30 2c0a  _pad_spacing=0,.
-00021080: 2020 2020 7061 645f 6c61 7965 723d 302c      pad_layer=0,
-00021090: 0a20 2020 2077 6972 696e 6731 5f6c 6179  .    wiring1_lay
-000210a0: 6572 3d31 2c0a 2020 2020 7769 7269 6e67  er=1,.    wiring
-000210b0: 325f 6c61 7965 723d 322c 0a20 2020 2076  2_layer=2,.    v
-000210c0: 6961 5f6c 6179 6572 3d33 2c0a 293a 0a20  ia_layer=3,.):. 
-000210d0: 2020 2022 2222 5669 6120 6368 6169 6e20     """Via chain 
-000210e0: 7465 7374 2073 7472 7563 7475 7265 0a0a  test structure..
-000210f0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00021100: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00021110: 2020 6e75 6d5f 7669 6173 203a 2069 6e74    num_vias : int
-00021120: 0a20 2020 2020 2020 2054 6865 2074 6f74  .        The tot
-00021130: 616c 206e 756d 6265 7220 6f66 2072 6571  al number of req
-00021140: 7565 7374 6564 2076 6961 7320 286d 7573  uested vias (mus
-00021150: 7420 6265 2061 6e20 6576 656e 206e 756d  t be an even num
-00021160: 6265 7229 2e0a 2020 2020 7769 7265 5f77  ber)..    wire_w
-00021170: 6964 7468 203a 2069 6e74 206f 7220 666c  idth : int or fl
-00021180: 6f61 740a 2020 2020 2020 2020 5468 6520  oat.        The 
-00021190: 7769 6474 6820 6f66 2074 6865 2077 6972  width of the wir
-000211a0: 6573 2e0a 2020 2020 7669 615f 7769 6474  es..    via_widt
-000211b0: 6820 3a20 696e 7420 6f72 2066 6c6f 6174  h : int or float
-000211c0: 0a20 2020 2020 2020 2044 6961 6d65 7465  .        Diamete
-000211d0: 7220 6f66 2074 6865 2076 6961 732e 0a20  r of the vias.. 
-000211e0: 2020 2076 6961 5f73 7061 6369 6e67 203a     via_spacing :
-000211f0: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
-00021200: 2020 2020 2020 4469 7374 616e 6365 2062        Distance b
-00021210: 6574 7765 656e 2076 6961 732e 0a20 2020  etween vias..   
-00021220: 2070 6164 5f73 697a 6520 3a20 6172 7261   pad_size : arra
-00021230: 792d 6c69 6b65 5b32 5d0a 2020 2020 2020  y-like[2].      
-00021240: 2020 2877 6964 7468 2c20 6865 6967 6874    (width, height
-00021250: 2920 6f66 2074 6865 2070 6164 732e 0a20  ) of the pads.. 
-00021260: 2020 206d 696e 5f70 6164 5f73 7061 6369     min_pad_spaci
-00021270: 6e67 203a 2069 6e74 206f 7220 666c 6f61  ng : int or floa
-00021280: 740a 2020 2020 2020 2020 4465 6669 6e65  t.        Define
-00021290: 7320 7468 6520 6d69 6e69 6d75 6d20 6469  s the minimum di
-000212a0: 7374 616e 6365 2062 6574 7765 656e 2074  stance between t
-000212b0: 6865 2074 776f 2070 6164 732e 0a20 2020  he two pads..   
-000212c0: 2070 6164 5f6c 6179 6572 203a 2069 6e74   pad_layer : int
-000212d0: 0a20 2020 2020 2020 2053 7065 6369 6669  .        Specifi
-000212e0: 6320 6c61 7965 7220 746f 2070 7574 2074  c layer to put t
-000212f0: 6865 2070 6164 7320 6f6e 2e0a 2020 2020  he pads on..    
-00021300: 7769 7269 6e67 315f 6c61 7965 7220 3a20  wiring1_layer : 
-00021310: 696e 740a 2020 2020 2020 2020 5370 6563  int.        Spec
-00021320: 6966 6963 206c 6179 6572 2074 6f20 7075  ific layer to pu
-00021330: 7420 7468 6520 746f 7020 7769 7269 6e67  t the top wiring
-00021340: 206f 6e2e 0a20 2020 2077 6972 696e 6732   on..    wiring2
-00021350: 5f6c 6179 6572 203a 2069 6e74 0a20 2020  _layer : int.   
-00021360: 2020 2020 2053 7065 6369 6669 6320 6c61       Specific la
-00021370: 7965 7220 746f 2070 7574 2074 6865 2062  yer to put the b
-00021380: 6f74 746f 6d20 7769 7269 6e67 206f 6e2e  ottom wiring on.
-00021390: 0a20 2020 2076 6961 5f6c 6179 6572 203a  .    via_layer :
-000213a0: 2069 6e74 0a20 2020 2020 2020 2053 7065   int.        Spe
-000213b0: 6369 6669 6320 6c61 7965 7220 746f 2070  cific layer to p
-000213c0: 7574 2074 6865 2076 6961 7320 6f6e 2e0a  ut the vias on..
-000213d0: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
-000213e0: 202d 2d2d 2d2d 2d2d 0a20 2020 2056 5220   -------.    VR 
-000213f0: 3a20 4465 7669 6365 0a20 2020 2020 2020  : Device.       
-00021400: 2041 2044 6576 6963 6520 636f 6e74 6169   A Device contai
-00021410: 6e69 6e67 2074 6865 2074 6573 7420 7669  ning the test vi
-00021420: 6120 7374 7275 6374 7572 6573 2e0a 0a20  a structures... 
-00021430: 2020 2055 7361 6765 0a20 2020 202d 2d2d     Usage.    ---
-00021440: 2d2d 0a20 2020 2043 616c 6c20 7669 615f  --.    Call via_
-00021450: 726f 7574 655f 7465 7374 5f73 7472 7563  route_test_struc
-00021460: 7475 7265 2829 2062 7920 696e 6469 6361  ture() by indica
-00021470: 7469 6e67 2074 6865 206e 756d 6265 7220  ting the number 
-00021480: 6f66 2076 6961 7320 796f 7520 7761 6e74  of vias you want
-00021490: 0a20 2020 2064 7261 776e 2e20 596f 7520  .    drawn. You 
-000214a0: 6361 6e20 616c 736f 2063 6861 6e67 6520  can also change 
-000214b0: 7468 6520 6f74 6865 7220 7061 7261 6d65  the other parame
-000214c0: 7465 7273 2068 6f77 6576 6572 2069 6620  ters however if 
-000214d0: 796f 7520 646f 206e 6f74 0a20 2020 2073  you do not.    s
-000214e0: 7065 6369 6669 7920 6120 7661 6c75 6520  pecifiy a value 
-000214f0: 666f 7220 6120 7061 7261 6d65 7465 7220  for a parameter 
-00021500: 6974 2077 696c 6c20 6a75 7374 2075 7365  it will just use
-00021510: 2074 6865 2064 6566 6175 6c74 2076 616c   the default val
-00021520: 7565 0a20 2020 2045 783a 3a0a 0a20 2020  ue.    Ex::..   
-00021530: 2020 2020 2076 6961 5f72 6f75 7465 5f74       via_route_t
-00021540: 6573 745f 7374 7275 6374 7572 6528 6e75  est_structure(nu
-00021550: 6d5f 7669 6173 3d35 3429 0a0a 2020 2020  m_vias=54)..    
-00021560: 2d20 6f72 202d 3a3a 0a0a 2020 2020 2020  - or -::..      
-00021570: 2020 7669 615f 726f 7574 655f 7465 7374    via_route_test
-00021580: 5f73 7472 7563 7475 7265 286e 756d 5f76  _structure(num_v
-00021590: 6961 733d 3132 2c20 7061 645f 7369 7a65  ias=12, pad_size
-000215a0: 3d28 3130 302c 3130 3029 2c77 6972 655f  =(100,100),wire_
-000215b0: 7769 6474 683d 3829 0a0a 2020 2020 6578  width=8)..    ex
-000215c0: 3a20 7669 615f 726f 7574 6528 3534 2c20  : via_route(54, 
-000215d0: 6d69 6e5f 7061 645f 7370 6163 696e 673d  min_pad_spacing=
-000215e0: 3330 3029 0a20 2020 2022 2222 0a20 2020  300).    """.   
-000215f0: 2056 5220 3d20 4465 7669 6365 2822 7465   VR = Device("te
-00021600: 7374 5f76 6961 2229 0a20 2020 2070 6164  st_via").    pad
-00021610: 3120 3d20 5652 2e61 6464 5f72 6566 2872  1 = VR.add_ref(r
-00021620: 6563 7461 6e67 6c65 2873 697a 653d 7061  ectangle(size=pa
-00021630: 645f 7369 7a65 2c20 6c61 7965 723d 7061  d_size, layer=pa
-00021640: 645f 6c61 7965 7229 290a 2020 2020 7061  d_layer)).    pa
-00021650: 6431 5f6f 7665 726c 6179 203d 2056 522e  d1_overlay = VR.
-00021660: 6164 645f 7265 6628 7265 6374 616e 676c  add_ref(rectangl
-00021670: 6528 7369 7a65 3d70 6164 5f73 697a 652c  e(size=pad_size,
-00021680: 206c 6179 6572 3d77 6972 696e 6731 5f6c   layer=wiring1_l
-00021690: 6179 6572 2929 0a20 2020 2070 6164 3220  ayer)).    pad2 
-000216a0: 3d20 5652 2e61 6464 5f72 6566 2872 6563  = VR.add_ref(rec
-000216b0: 7461 6e67 6c65 2873 697a 653d 7061 645f  tangle(size=pad_
-000216c0: 7369 7a65 2c20 6c61 7965 723d 7061 645f  size, layer=pad_
-000216d0: 6c61 7965 7229 290a 2020 2020 7061 6432  layer)).    pad2
-000216e0: 5f6f 7665 726c 6179 203d 2056 522e 6164  _overlay = VR.ad
-000216f0: 645f 7265 6628 7265 6374 616e 676c 6528  d_ref(rectangle(
-00021700: 7369 7a65 3d70 6164 5f73 697a 652c 206c  size=pad_size, l
-00021710: 6179 6572 3d77 6972 696e 6731 5f6c 6179  ayer=wiring1_lay
-00021720: 6572 2929 0a20 2020 206e 7562 203d 2056  er)).    nub = V
-00021730: 522e 6164 645f 7265 6628 636f 6d70 6173  R.add_ref(compas
-00021740: 7328 7369 7a65 3d28 3320 2a20 7769 7265  s(size=(3 * wire
-00021750: 5f77 6964 7468 2c20 7769 7265 5f77 6964  _width, wire_wid
-00021760: 7468 292c 206c 6179 6572 3d70 6164 5f6c  th), layer=pad_l
-00021770: 6179 6572 2929 0a20 2020 206e 7562 5f6f  ayer)).    nub_o
-00021780: 7665 726c 6179 203d 2056 522e 6164 645f  verlay = VR.add_
-00021790: 7265 6628 0a20 2020 2020 2020 2063 6f6d  ref(.        com
-000217a0: 7061 7373 2873 697a 653d 2833 202a 2077  pass(size=(3 * w
-000217b0: 6972 655f 7769 6474 682c 2077 6972 655f  ire_width, wire_
-000217c0: 7769 6474 6829 2c20 6c61 7965 723d 7769  width), layer=wi
-000217d0: 7269 6e67 315f 6c61 7965 7229 0a20 2020  ring1_layer).   
-000217e0: 2029 0a20 2020 2068 6561 6420 3d20 5652   ).    head = VR
-000217f0: 2e61 6464 5f72 6566 2863 6f6d 7061 7373  .add_ref(compass
-00021800: 2873 697a 653d 2877 6972 655f 7769 6474  (size=(wire_widt
-00021810: 682c 2077 6972 655f 7769 6474 6829 2c20  h, wire_width), 
-00021820: 6c61 7965 723d 7061 645f 6c61 7965 7229  layer=pad_layer)
-00021830: 290a 2020 2020 6865 6164 5f6f 7665 726c  ).    head_overl
-00021840: 6179 203d 2056 522e 6164 645f 7265 6628  ay = VR.add_ref(
-00021850: 0a20 2020 2020 2020 2063 6f6d 7061 7373  .        compass
-00021860: 2873 697a 653d 2877 6972 655f 7769 6474  (size=(wire_widt
-00021870: 682c 2077 6972 655f 7769 6474 6829 2c20  h, wire_width), 
-00021880: 6c61 7965 723d 7769 7269 6e67 315f 6c61  layer=wiring1_la
-00021890: 7965 7229 0a20 2020 2029 0a20 2020 206e  yer).    ).    n
-000218a0: 7562 2e79 6d61 7820 3d20 7061 6431 2e79  ub.ymax = pad1.y
-000218b0: 6d61 7820 2d20 350a 2020 2020 6e75 622e  max - 5.    nub.
-000218c0: 786d 696e 203d 2070 6164 312e 786d 6178  xmin = pad1.xmax
-000218d0: 0a20 2020 206e 7562 5f6f 7665 726c 6179  .    nub_overlay
-000218e0: 2e79 6d61 7820 3d20 7061 6431 2e79 6d61  .ymax = pad1.yma
-000218f0: 7820 2d20 350a 2020 2020 6e75 625f 6f76  x - 5.    nub_ov
-00021900: 6572 6c61 792e 786d 696e 203d 2070 6164  erlay.xmin = pad
-00021910: 312e 786d 6178 0a20 2020 2068 6561 642e  1.xmax.    head.
-00021920: 636f 6e6e 6563 7428 706f 7274 3d22 5722  connect(port="W"
-00021930: 2c20 6465 7374 696e 6174 696f 6e3d 6e75  , destination=nu
-00021940: 622e 706f 7274 735b 2245 225d 290a 2020  b.ports["E"]).  
-00021950: 2020 6865 6164 5f6f 7665 726c 6179 2e63    head_overlay.c
-00021960: 6f6e 6e65 6374 2870 6f72 743d 2257 222c  onnect(port="W",
-00021970: 2064 6573 7469 6e61 7469 6f6e 3d6e 7562   destination=nub
-00021980: 5f6f 7665 726c 6179 2e70 6f72 7473 5b22  _overlay.ports["
-00021990: 4522 5d29 0a20 2020 2070 6164 315f 6f76  E"]).    pad1_ov
-000219a0: 6572 6c61 792e 786d 696e 203d 2070 6164  erlay.xmin = pad
-000219b0: 312e 786d 696e 0a20 2020 2070 6164 315f  1.xmin.    pad1_
-000219c0: 6f76 6572 6c61 792e 796d 696e 203d 2070  overlay.ymin = p
-000219d0: 6164 312e 796d 696e 0a0a 2020 2020 6f6c  ad1.ymin..    ol
-000219e0: 645f 706f 7274 203d 2068 6561 642e 706f  d_port = head.po
-000219f0: 7274 735b 2253 225d 0a20 2020 2063 6f75  rts["S"].    cou
-00021a00: 6e74 203d 2030 0a20 2020 2077 6964 7468  nt = 0.    width
-00021a10: 5f76 6961 5f69 7465 7220 3d20 3220 2a20  _via_iter = 2 * 
-00021a20: 7669 615f 7370 6163 696e 6720 2d20 3220  via_spacing - 2 
-00021a30: 2a20 7769 7265 5f77 6964 7468 0a0a 2020  * wire_width..  
-00021a40: 2020 7061 6432 2e78 6d69 6e20 3d20 7061    pad2.xmin = pa
-00021a50: 6431 2e78 6d61 7820 2b20 6d69 6e5f 7061  d1.xmax + min_pa
-00021a60: 645f 7370 6163 696e 670a 2020 2020 7570  d_spacing.    up
-00021a70: 203d 2046 616c 7365 0a20 2020 2064 6f77   = False.    dow
-00021a80: 6e20 3d20 5472 7565 0a20 2020 2065 6467  n = True.    edg
-00021a90: 6520 3d20 5472 7565 0a20 2020 2063 7572  e = True.    cur
-00021aa0: 7265 6e74 5f77 6964 7468 203d 2033 202a  rent_width = 3 *
-00021ab0: 2077 6972 655f 7769 6474 6820 2b20 7769   wire_width + wi
-00021ac0: 7265 5f77 6964 7468 2020 2320 7769 6474  re_width  # widt
-00021ad0: 6820 6f66 206e 7562 2061 6e64 2031 206f  h of nub and 1 o
-00021ae0: 7665 726c 6170 0a20 2020 206f 626a 5f6f  verlap.    obj_o
-00021af0: 6c64 203d 2068 6561 640a 2020 2020 6f62  ld = head.    ob
-00021b00: 6a20 3d20 6865 6164 0a20 2020 2076 6961  j = head.    via
-00021b10: 5f69 7465 7261 626c 6520 3d20 5f76 6961  _iterable = _via
-00021b20: 5f69 7465 7261 626c 6528 0a20 2020 2020  _iterable(.     
-00021b30: 2020 2076 6961 5f73 7061 6369 6e67 2c20     via_spacing, 
-00021b40: 7769 7265 5f77 6964 7468 2c20 7769 7269  wire_width, wiri
-00021b50: 6e67 315f 6c61 7965 722c 2077 6972 696e  ng1_layer, wirin
-00021b60: 6732 5f6c 6179 6572 2c20 7669 615f 6c61  g2_layer, via_la
-00021b70: 7965 722c 2076 6961 5f77 6964 7468 0a20  yer, via_width. 
-00021b80: 2020 2029 0a20 2020 2077 6869 6c65 2028     ).    while (
-00021b90: 636f 756e 7420 2b20 3229 203c 3d20 6e75  count + 2) <= nu
-00021ba0: 6d5f 7669 6173 3a0a 2020 2020 2020 2020  m_vias:.        
-00021bb0: 6f62 6a20 3d20 5652 2e61 6464 5f72 6566  obj = VR.add_ref
-00021bc0: 2876 6961 5f69 7465 7261 626c 6529 0a20  (via_iterable). 
-00021bd0: 2020 2020 2020 206f 626a 2e63 6f6e 6e65         obj.conne
-00021be0: 6374 2870 6f72 743d 2257 222c 2064 6573  ct(port="W", des
-00021bf0: 7469 6e61 7469 6f6e 3d6f 6c64 5f70 6f72  tination=old_por
-00021c00: 742c 206f 7665 726c 6170 3d77 6972 655f  t, overlap=wire_
-00021c10: 7769 6474 6829 0a20 2020 2020 2020 206f  width).        o
-00021c20: 6c64 5f70 6f72 7420 3d20 6f62 6a2e 706f  ld_port = obj.po
-00021c30: 7274 735b 2245 225d 0a20 2020 2020 2020  rts["E"].       
-00021c40: 2065 6467 6520 3d20 4661 6c73 650a 2020   edge = False.  
-00021c50: 2020 2020 2020 6966 206f 626a 2e79 6d61        if obj.yma
-00021c60: 7820 3e20 7061 6431 2e79 6d61 783a 0a20  x > pad1.ymax:. 
-00021c70: 2020 2020 2020 2020 2020 206f 626a 2e63             obj.c
-00021c80: 6f6e 6e65 6374 2870 6f72 743d 2257 222c  onnect(port="W",
-00021c90: 2064 6573 7469 6e61 7469 6f6e 3d6f 626a   destination=obj
-00021ca0: 5f6f 6c64 2e70 6f72 7473 5b22 5322 5d2c  _old.ports["S"],
-00021cb0: 206f 7665 726c 6170 3d77 6972 655f 7769   overlap=wire_wi
-00021cc0: 6474 6829 0a20 2020 2020 2020 2020 2020  dth).           
-00021cd0: 206f 6c64 5f70 6f72 7420 3d20 6f62 6a2e   old_port = obj.
-00021ce0: 706f 7274 735b 2253 225d 0a20 2020 2020  ports["S"].     
-00021cf0: 2020 2020 2020 2063 7572 7265 6e74 5f77         current_w
-00021d00: 6964 7468 202b 3d20 7769 6474 685f 7669  idth += width_vi
-00021d10: 615f 6974 6572 0a20 2020 2020 2020 2020  a_iter.         
-00021d20: 2020 2064 6f77 6e20 3d20 5472 7565 0a20     down = True. 
-00021d30: 2020 2020 2020 2020 2020 2075 7020 3d20             up = 
-00021d40: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00021d50: 2020 6564 6765 203d 2054 7275 650a 0a20    edge = True.. 
-00021d60: 2020 2020 2020 2065 6c69 6620 6f62 6a2e         elif obj.
-00021d70: 796d 696e 203c 2070 6164 312e 796d 696e  ymin < pad1.ymin
-00021d80: 3a0a 2020 2020 2020 2020 2020 2020 6f62  :.            ob
-00021d90: 6a2e 636f 6e6e 6563 7428 706f 7274 3d22  j.connect(port="
-00021da0: 5722 2c20 6465 7374 696e 6174 696f 6e3d  W", destination=
-00021db0: 6f62 6a5f 6f6c 642e 706f 7274 735b 224e  obj_old.ports["N
-00021dc0: 225d 2c20 6f76 6572 6c61 703d 7769 7265  "], overlap=wire
-00021dd0: 5f77 6964 7468 290a 2020 2020 2020 2020  _width).        
-00021de0: 2020 2020 6f6c 645f 706f 7274 203d 206f      old_port = o
-00021df0: 626a 2e70 6f72 7473 5b22 4e22 5d0a 2020  bj.ports["N"].  
-00021e00: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-00021e10: 745f 7769 6474 6820 2b3d 2077 6964 7468  t_width += width
-00021e20: 5f76 6961 5f69 7465 720a 2020 2020 2020  _via_iter.      
-00021e30: 2020 2020 2020 7570 203d 2054 7275 650a        up = True.
-00021e40: 2020 2020 2020 2020 2020 2020 646f 776e              down
-00021e50: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00021e60: 2020 2020 2065 6467 6520 3d20 5472 7565       edge = True
-00021e70: 0a20 2020 2020 2020 2063 6f75 6e74 203d  .        count =
-00021e80: 2063 6f75 6e74 202b 2032 0a20 2020 2020   count + 2.     
-00021e90: 2020 206f 626a 5f6f 6c64 203d 206f 626a     obj_old = obj
-00021ea0: 0a0a 2020 2020 6966 2028 0a20 2020 2020  ..    if (.     
-00021eb0: 2020 2063 7572 7265 6e74 5f77 6964 7468     current_width
-00021ec0: 203c 206d 696e 5f70 6164 5f73 7061 6369   < min_pad_spaci
-00021ed0: 6e67 0a20 2020 2020 2020 2061 6e64 2028  ng.        and (
-00021ee0: 6d69 6e5f 7061 645f 7370 6163 696e 6720  min_pad_spacing 
-00021ef0: 2d20 6375 7272 656e 745f 7769 6474 6829  - current_width)
-00021f00: 203e 2033 202a 2077 6972 655f 7769 6474   > 3 * wire_widt
-00021f10: 680a 2020 2020 293a 0a20 2020 2020 2020  h.    ):.       
-00021f20: 2074 6169 6c20 3d20 5652 2e61 6464 5f72   tail = VR.add_r
-00021f30: 6566 280a 2020 2020 2020 2020 2020 2020  ef(.            
-00021f40: 636f 6d70 6173 7328 0a20 2020 2020 2020  compass(.       
-00021f50: 2020 2020 2020 2020 2073 697a 653d 286d           size=(m
-00021f60: 696e 5f70 6164 5f73 7061 6369 6e67 202d  in_pad_spacing -
-00021f70: 2063 7572 7265 6e74 5f77 6964 7468 202b   current_width +
-00021f80: 2077 6972 655f 7769 6474 682c 2077 6972   wire_width, wir
-00021f90: 655f 7769 6474 6829 2c0a 2020 2020 2020  e_width),.      
-00021fa0: 2020 2020 2020 2020 2020 6c61 7965 723d            layer=
-00021fb0: 7769 7269 6e67 315f 6c61 7965 722c 0a20  wiring1_layer,. 
-00021fc0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00021fd0: 2020 2020 2029 0a20 2020 2020 2020 2074       ).        t
-00021fe0: 6169 6c5f 6f76 6572 6c61 7920 3d20 5652  ail_overlay = VR
-00021ff0: 2e61 6464 5f72 6566 280a 2020 2020 2020  .add_ref(.      
-00022000: 2020 2020 2020 636f 6d70 6173 7328 0a20        compass(. 
-00022010: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00022020: 697a 653d 286d 696e 5f70 6164 5f73 7061  ize=(min_pad_spa
-00022030: 6369 6e67 202d 2063 7572 7265 6e74 5f77  cing - current_w
-00022040: 6964 7468 202b 2077 6972 655f 7769 6474  idth + wire_widt
-00022050: 682c 2077 6972 655f 7769 6474 6829 2c0a  h, wire_width),.
-00022060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022070: 6c61 7965 723d 7061 645f 6c61 7965 722c  layer=pad_layer,
-00022080: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00022090: 2020 2020 2020 2029 0a20 2020 2065 6c73         ).    els
-000220a0: 653a 0a20 2020 2020 2020 2074 6169 6c20  e:.        tail 
-000220b0: 3d20 5652 2e61 6464 5f72 6566 280a 2020  = VR.add_ref(.  
-000220c0: 2020 2020 2020 2020 2020 636f 6d70 6173            compas
-000220d0: 7328 7369 7a65 3d28 3320 2a20 7769 7265  s(size=(3 * wire
-000220e0: 5f77 6964 7468 2c20 7769 7265 5f77 6964  _width, wire_wid
-000220f0: 7468 292c 206c 6179 6572 3d77 6972 696e  th), layer=wirin
-00022100: 6731 5f6c 6179 6572 290a 2020 2020 2020  g1_layer).      
-00022110: 2020 290a 2020 2020 2020 2020 7461 696c    ).        tail
-00022120: 5f6f 7665 726c 6179 203d 2056 522e 6164  _overlay = VR.ad
-00022130: 645f 7265 6628 0a20 2020 2020 2020 2020  d_ref(.         
-00022140: 2020 2063 6f6d 7061 7373 2873 697a 653d     compass(size=
-00022150: 2833 202a 2077 6972 655f 7769 6474 682c  (3 * wire_width,
-00022160: 2077 6972 655f 7769 6474 6829 2c20 6c61   wire_width), la
-00022170: 7965 723d 7769 7269 6e67 315f 6c61 7965  yer=wiring1_laye
-00022180: 7229 0a20 2020 2020 2020 2029 0a0a 2020  r).        )..  
-00022190: 2020 6966 2075 7020 616e 6420 6e6f 7420    if up and not 
-000221a0: 6564 6765 3a0a 2020 2020 2020 2020 7461  edge:.        ta
-000221b0: 696c 2e63 6f6e 6e65 6374 2870 6f72 743d  il.connect(port=
-000221c0: 2257 222c 2064 6573 7469 6e61 7469 6f6e  "W", destination
-000221d0: 3d6f 626a 2e70 6f72 7473 5b22 5322 5d2c  =obj.ports["S"],
-000221e0: 206f 7665 726c 6170 3d77 6972 655f 7769   overlap=wire_wi
-000221f0: 6474 6829 0a20 2020 2020 2020 2074 6169  dth).        tai
-00022200: 6c5f 6f76 6572 6c61 792e 636f 6e6e 6563  l_overlay.connec
-00022210: 7428 706f 7274 3d22 5722 2c20 6465 7374  t(port="W", dest
-00022220: 696e 6174 696f 6e3d 6f62 6a2e 706f 7274  ination=obj.port
-00022230: 735b 2253 225d 2c20 6f76 6572 6c61 703d  s["S"], overlap=
-00022240: 7769 7265 5f77 6964 7468 290a 2020 2020  wire_width).    
-00022250: 656c 6966 2064 6f77 6e20 616e 6420 6e6f  elif down and no
-00022260: 7420 6564 6765 3a0a 2020 2020 2020 2020  t edge:.        
-00022270: 7461 696c 2e63 6f6e 6e65 6374 2870 6f72  tail.connect(por
-00022280: 743d 2257 222c 2064 6573 7469 6e61 7469  t="W", destinati
-00022290: 6f6e 3d6f 626a 2e70 6f72 7473 5b22 4e22  on=obj.ports["N"
-000222a0: 5d2c 206f 7665 726c 6170 3d77 6972 655f  ], overlap=wire_
-000222b0: 7769 6474 6829 0a20 2020 2020 2020 2074  width).        t
-000222c0: 6169 6c5f 6f76 6572 6c61 792e 636f 6e6e  ail_overlay.conn
-000222d0: 6563 7428 706f 7274 3d22 5722 2c20 6465  ect(port="W", de
-000222e0: 7374 696e 6174 696f 6e3d 6f62 6a2e 706f  stination=obj.po
-000222f0: 7274 735b 224e 225d 2c20 6f76 6572 6c61  rts["N"], overla
-00022300: 703d 7769 7265 5f77 6964 7468 290a 2020  p=wire_width).  
-00022310: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00022320: 7461 696c 2e63 6f6e 6e65 6374 2870 6f72  tail.connect(por
-00022330: 743d 2257 222c 2064 6573 7469 6e61 7469  t="W", destinati
-00022340: 6f6e 3d6f 626a 2e70 6f72 7473 5b22 4522  on=obj.ports["E"
-00022350: 5d2c 206f 7665 726c 6170 3d77 6972 655f  ], overlap=wire_
-00022360: 7769 6474 6829 0a20 2020 2020 2020 2074  width).        t
-00022370: 6169 6c5f 6f76 6572 6c61 792e 636f 6e6e  ail_overlay.conn
-00022380: 6563 7428 706f 7274 3d22 5722 2c20 6465  ect(port="W", de
-00022390: 7374 696e 6174 696f 6e3d 6f62 6a2e 706f  stination=obj.po
-000223a0: 7274 735b 2245 225d 2c20 6f76 6572 6c61  rts["E"], overla
-000223b0: 703d 7769 7265 5f77 6964 7468 290a 0a20  p=wire_width).. 
-000223c0: 2020 2070 6164 322e 786d 696e 203d 2074     pad2.xmin = t
-000223d0: 6169 6c2e 786d 6178 0a20 2020 2070 6164  ail.xmax.    pad
-000223e0: 325f 6f76 6572 6c61 792e 786d 696e 203d  2_overlay.xmin =
-000223f0: 2070 6164 322e 786d 696e 0a20 2020 2070   pad2.xmin.    p
-00022400: 6164 325f 6f76 6572 6c61 792e 796d 696e  ad2_overlay.ymin
-00022410: 203d 2070 6164 322e 796d 696e 0a0a 2020   = pad2.ymin..  
-00022420: 2020 7265 7475 726e 2056 520a 0a0a 6465    return VR...de
-00022430: 6620 7465 7374 5f63 6f6d 6228 0a20 2020  f test_comb(.   
-00022440: 2070 6164 5f73 697a 653d 2832 3030 2c20   pad_size=(200, 
-00022450: 3230 3029 2c0a 2020 2020 7769 7265 5f77  200),.    wire_w
-00022460: 6964 7468 3d31 2c0a 2020 2020 7769 7265  idth=1,.    wire
-00022470: 5f67 6170 3d33 2c0a 2020 2020 636f 6d62  _gap=3,.    comb
-00022480: 5f6c 6179 6572 3d30 2c0a 2020 2020 6f76  _layer=0,.    ov
-00022490: 6572 6c61 705f 7a69 677a 6167 5f6c 6179  erlap_zigzag_lay
-000224a0: 6572 3d31 2c0a 2020 2020 636f 6d62 5f70  er=1,.    comb_p
-000224b0: 6164 5f6c 6179 6572 3d32 2c0a 2020 2020  ad_layer=2,.    
-000224c0: 636f 6d62 5f67 6e64 5f6c 6179 6572 3d33  comb_gnd_layer=3
-000224d0: 2c0a 2020 2020 6f76 6572 6c61 705f 7061  ,.    overlap_pa
-000224e0: 645f 6c61 7965 723d 342c 0a29 3a0a 2020  d_layer=4,.):.  
-000224f0: 2020 2222 224f 7665 726c 6170 2063 6f6d    """Overlap com
-00022500: 6220 7465 7374 2073 7472 7563 7475 7265  b test structure
-00022510: 2066 6f72 2063 6865 636b 696e 6720 7768   for checking wh
-00022520: 6574 6865 7220 7477 6f20 6c61 7965 7273  ether two layers
-00022530: 0a20 2020 2061 7265 2065 6c65 6374 7269  .    are electri
-00022540: 6361 6c6c 7920 6973 6f6c 6174 6564 0a0a  cally isolated..
-00022550: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00022560: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00022570: 2020 7061 645f 7369 7a65 203a 2061 7272    pad_size : arr
-00022580: 6179 2d6c 696b 650a 2020 2020 2020 2020  ay-like.        
-00022590: 7820 616e 6420 7920 6469 6d65 6e73 696f  x and y dimensio
-000225a0: 6e73 206f 6620 7468 6520 636f 6d62 2070  ns of the comb p
-000225b0: 6164 732e 0a20 2020 2077 6972 655f 7769  ads..    wire_wi
-000225c0: 6474 6820 3a20 696e 7420 6f72 2066 6c6f  dth : int or flo
-000225d0: 6174 0a20 2020 2020 2020 2057 6964 7468  at.        Width
-000225e0: 206f 6620 7468 6520 7465 7374 2063 6f6d   of the test com
-000225f0: 6220 7465 6574 682e 0a20 2020 2077 6972  b teeth..    wir
-00022600: 655f 6761 7020 3a20 696e 7420 6f72 2066  e_gap : int or f
-00022610: 6c6f 6174 0a20 2020 2020 2020 2053 697a  loat.        Siz
-00022620: 6520 6f66 2074 6865 2067 6170 2062 6574  e of the gap bet
-00022630: 7765 656e 2063 6f6d 6220 7465 6574 682e  ween comb teeth.
-00022640: 0a20 2020 2063 6f6d 625f 6c61 7965 7220  .    comb_layer 
-00022650: 3a20 696e 742c 2061 7272 6179 2d6c 696b  : int, array-lik
-00022660: 655b 325d 2c20 6f72 2073 6574 0a20 2020  e[2], or set.   
-00022670: 2020 2020 2053 7065 6369 6669 6320 6c61       Specific la
-00022680: 7965 7228 7329 2074 6f20 7075 7420 636f  yer(s) to put co
-00022690: 6d62 2067 656f 6d65 7472 7920 6f6e 2e0a  mb geometry on..
-000226a0: 2020 2020 6f76 6572 6c61 705f 7a69 677a      overlap_zigz
-000226b0: 6167 5f6c 6179 6572 203a 2069 6e74 2c20  ag_layer : int, 
-000226c0: 6172 7261 792d 6c69 6b65 5b32 5d2c 206f  array-like[2], o
-000226d0: 7220 7365 740a 2020 2020 2020 2020 5370  r set.        Sp
-000226e0: 6563 6966 6963 206c 6179 6572 2873 2920  ecific layer(s) 
-000226f0: 746f 2070 7574 206f 7665 726c 6170 207a  to put overlap z
-00022700: 6967 7a61 6720 6765 6f6d 6574 7279 206f  igzag geometry o
-00022710: 6e2e 0a20 2020 2063 6f6d 625f 7061 645f  n..    comb_pad_
-00022720: 6c61 7965 7220 3a20 696e 742c 2061 7272  layer : int, arr
-00022730: 6179 2d6c 696b 655b 325d 2c20 6f72 2073  ay-like[2], or s
-00022740: 6574 0a20 2020 2020 2020 2053 7065 6369  et.        Speci
-00022750: 6669 6320 6c61 7965 7228 7329 2074 6f20  fic layer(s) to 
-00022760: 7075 7420 636f 6d62 2070 6164 7320 6f6e  put comb pads on
-00022770: 2e0a 2020 2020 636f 6d62 5f67 6e64 5f6c  ..    comb_gnd_l
-00022780: 6179 6572 203a 2069 6e74 2c20 6172 7261  ayer : int, arra
-00022790: 792d 6c69 6b65 5b32 5d2c 206f 7220 7365  y-like[2], or se
-000227a0: 740a 2020 2020 2020 2020 5370 6563 6966  t.        Specif
-000227b0: 6963 206c 6179 6572 2873 2920 746f 2070  ic layer(s) to p
-000227c0: 7574 2074 6865 2063 6f6d 6220 6772 6f75  ut the comb grou
-000227d0: 6e64 206f 6e2e 0a20 2020 206f 7665 726c  nd on..    overl
-000227e0: 6170 5f70 6164 5f6c 6179 6572 203a 2069  ap_pad_layer : i
-000227f0: 6e74 2c20 6172 7261 792d 6c69 6b65 5b32  nt, array-like[2
-00022800: 5d2c 206f 7220 7365 740a 2020 2020 2020  ], or set.      
-00022810: 2020 5370 6563 6966 6963 206c 6179 6572    Specific layer
-00022820: 2873 2920 746f 2070 7574 206f 7665 726c  (s) to put overl
-00022830: 6170 2070 6164 7320 6f6e 2e0a 0a20 2020  ap pads on...   
-00022840: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
-00022850: 2d2d 2d2d 0a20 2020 2043 4920 3a20 4465  ----.    CI : De
-00022860: 7669 6365 0a20 2020 2020 2020 2041 2044  vice.        A D
-00022870: 6576 6963 6520 636f 6e74 6169 6e69 6e67  evice containing
-00022880: 2061 2074 6573 7420 636f 6d62 2067 656f   a test comb geo
-00022890: 6d65 7472 792e 0a0a 2020 2020 4e6f 7465  metry...    Note
-000228a0: 730a 2020 2020 2d2d 2d2d 2d0a 2020 2020  s.    -----.    
-000228b0: 4361 6c6c 2063 6f6d 625f 696e 7375 6c61  Call comb_insula
-000228c0: 7469 6f6e 5f74 6573 745f 7374 7275 6374  tion_test_struct
-000228d0: 7572 6528 2920 7769 7468 2061 6e79 206f  ure() with any o
-000228e0: 6620 7468 6520 7061 7261 6d65 7465 7273  f the parameters
-000228f0: 2073 686f 776e 0a20 2020 2062 656c 6f77   shown.    below
-00022900: 2077 6869 6368 2079 6f75 2764 206c 696b   which you'd lik
-00022910: 6520 746f 2063 6861 6e67 652e 2059 6f75  e to change. You
-00022920: 206f 6e6c 7920 6e65 6564 2074 6f20 7375   only need to su
-00022930: 7070 6c79 2074 6865 2070 6172 616d 6574  pply the paramet
-00022940: 6572 730a 2020 2020 7768 6963 6820 796f  ers.    which yo
-00022950: 7520 696e 7465 6e64 206f 6e20 6368 616e  u intend on chan
-00022960: 6769 6e67 2059 6f75 2063 616e 2061 6c74  ging You can alt
-00022970: 6572 6e61 7469 7665 6c79 2063 616c 6c20  ernatively call 
-00022980: 6974 2077 6974 6820 6e6f 0a20 2020 2070  it with no.    p
-00022990: 6172 616d 6574 6572 7320 616e 6420 6974  arameters and it
-000229a0: 2077 696c 6c20 7461 6b65 2061 6c6c 2074   will take all t
-000229b0: 6865 2064 6566 6175 6c74 2076 616c 7565  he default value
-000229c0: 7320 7368 6f77 6e20 6265 6c6f 772e 0a0a  s shown below...
-000229d0: 2020 2020 4578 3a3a 0a20 2020 2020 2020      Ex::.       
-000229e0: 2063 6f6d 625f 696e 7375 6c61 7469 6f6e   comb_insulation
-000229f0: 5f74 6573 745f 7374 7275 6374 7572 6528  _test_structure(
-00022a00: 7061 645f 7369 7a65 3d28 3137 352c 3137  pad_size=(175,17
-00022a10: 3529 2c20 7769 7265 5f77 6964 7468 3d32  5), wire_width=2
-00022a20: 2c20 7769 7265 5f67 6170 3d35 290a 2020  , wire_gap=5).  
-00022a30: 2020 2d20 6f72 202d 3a3a 0a20 2020 2020    - or -::.     
-00022a40: 2020 2063 6f6d 625f 696e 7375 6c61 7469     comb_insulati
-00022a50: 6f6e 5f74 6573 745f 7374 7275 6374 7572  on_test_structur
-00022a60: 6528 290a 2020 2020 2222 220a 2020 2020  e().    """.    
-00022a70: 4349 203d 2044 6576 6963 6528 2274 6573  CI = Device("tes
-00022a80: 745f 636f 6d62 2229 0a0a 2020 2020 2320  t_comb")..    # 
-00022a90: 6966 2063 6f6d 625f 7061 645f 6c61 7965  if comb_pad_laye
-00022aa0: 7220 6973 204e 6f6e 653a 2063 6f6d 625f  r is None: comb_
-00022ab0: 7061 645f 6c61 7965 7220 3d20 636f 6d62  pad_layer = comb
-00022ac0: 5f6c 6179 6572 0a20 2020 2023 2069 6620  _layer.    # if 
-00022ad0: 636f 6d62 5f67 6e64 5f6c 6179 6572 2069  comb_gnd_layer i
-00022ae0: 7320 4e6f 6e65 3a20 636f 6d62 5f67 6e64  s None: comb_gnd
-00022af0: 5f6c 6179 6572 203d 2063 6f6d 625f 6c61  _layer = comb_la
-00022b00: 7965 720a 2020 2020 2320 6966 206f 7665  yer.    # if ove
-00022b10: 726c 6170 5f70 6164 5f6c 6179 6572 2069  rlap_pad_layer i
-00022b20: 7320 4e6f 6e65 3a20 6f76 6572 6c61 705f  s None: overlap_
-00022b30: 7061 645f 6c61 7965 7220 3d20 6f76 6572  pad_layer = over
-00022b40: 6c61 705f 7a69 677a 6167 5f6c 6179 6572  lap_zigzag_layer
-00022b50: 0a20 2020 2077 6972 655f 7370 6163 696e  .    wire_spacin
-00022b60: 6720 3d20 7769 7265 5f77 6964 7468 202b  g = wire_width +
-00022b70: 2077 6972 655f 6761 7020 2a20 320a 0a20   wire_gap * 2.. 
-00022b80: 2020 2023 2070 6164 206f 7665 726c 6179     # pad overlay
-00022b90: 730a 2020 2020 6f76 6572 6c61 795f 7061  s.    overlay_pa
-00022ba0: 6462 203d 2043 492e 6164 645f 7265 6628  db = CI.add_ref(
-00022bb0: 0a20 2020 2020 2020 2072 6563 7461 6e67  .        rectang
-00022bc0: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
-00022bd0: 7369 7a65 3d28 7061 645f 7369 7a65 5b30  size=(pad_size[0
-00022be0: 5d20 2a20 3920 2f20 3130 2c20 7061 645f  ] * 9 / 10, pad_
-00022bf0: 7369 7a65 5b31 5d20 2a20 3920 2f20 3130  size[1] * 9 / 10
-00022c00: 292c 206c 6179 6572 3d6f 7665 726c 6170  ), layer=overlap
-00022c10: 5f70 6164 5f6c 6179 6572 0a20 2020 2020  _pad_layer.     
-00022c20: 2020 2029 0a20 2020 2029 0a20 2020 206f     ).    ).    o
-00022c30: 7665 726c 6179 5f70 6164 6c20 3d20 4349  verlay_padl = CI
-00022c40: 2e61 6464 5f72 6566 280a 2020 2020 2020  .add_ref(.      
-00022c50: 2020 7265 6374 616e 676c 6528 0a20 2020    rectangle(.   
-00022c60: 2020 2020 2020 2020 2073 697a 653d 2870           size=(p
-00022c70: 6164 5f73 697a 655b 305d 202a 2039 202f  ad_size[0] * 9 /
-00022c80: 2031 302c 2070 6164 5f73 697a 655b 315d   10, pad_size[1]
-00022c90: 202a 2039 202f 2031 3029 2c20 6c61 7965   * 9 / 10), laye
-00022ca0: 723d 636f 6d62 5f70 6164 5f6c 6179 6572  r=comb_pad_layer
-00022cb0: 0a20 2020 2020 2020 2029 0a20 2020 2029  .        ).    )
-00022cc0: 0a20 2020 206f 7665 726c 6179 5f70 6164  .    overlay_pad
-00022cd0: 7420 3d20 4349 2e61 6464 5f72 6566 280a  t = CI.add_ref(.
-00022ce0: 2020 2020 2020 2020 7265 6374 616e 676c          rectangl
-00022cf0: 6528 0a20 2020 2020 2020 2020 2020 2073  e(.            s
-00022d00: 697a 653d 2870 6164 5f73 697a 655b 305d  ize=(pad_size[0]
-00022d10: 202a 2039 202f 2031 302c 2070 6164 5f73   * 9 / 10, pad_s
-00022d20: 697a 655b 315d 202a 2039 202f 2031 3029  ize[1] * 9 / 10)
-00022d30: 2c20 6c61 7965 723d 636f 6d62 5f70 6164  , layer=comb_pad
-00022d40: 5f6c 6179 6572 0a20 2020 2020 2020 2029  _layer.        )
-00022d50: 0a20 2020 2029 0a20 2020 206f 7665 726c  .    ).    overl
-00022d60: 6179 5f70 6164 7220 3d20 4349 2e61 6464  ay_padr = CI.add
-00022d70: 5f72 6566 280a 2020 2020 2020 2020 7265  _ref(.        re
-00022d80: 6374 616e 676c 6528 0a20 2020 2020 2020  ctangle(.       
-00022d90: 2020 2020 2073 697a 653d 2870 6164 5f73       size=(pad_s
-00022da0: 697a 655b 305d 202a 2039 202f 2031 302c  ize[0] * 9 / 10,
-00022db0: 2070 6164 5f73 697a 655b 315d 202a 2039   pad_size[1] * 9
-00022dc0: 202f 2031 3029 2c20 6c61 7965 723d 636f   / 10), layer=co
-00022dd0: 6d62 5f67 6e64 5f6c 6179 6572 0a20 2020  mb_gnd_layer.   
-00022de0: 2020 2020 2029 0a20 2020 2029 0a20 2020       ).    ).   
-00022df0: 206f 7665 726c 6179 5f70 6164 6c2e 786d   overlay_padl.xm
-00022e00: 696e 203d 2030 0a20 2020 206f 7665 726c  in = 0.    overl
-00022e10: 6179 5f70 6164 6c2e 796d 696e 203d 2030  ay_padl.ymin = 0
-00022e20: 0a20 2020 206f 7665 726c 6179 5f70 6164  .    overlay_pad
-00022e30: 622e 796d 6178 203d 2030 0a20 2020 206f  b.ymax = 0.    o
-00022e40: 7665 726c 6179 5f70 6164 622e 786d 696e  verlay_padb.xmin
-00022e50: 203d 206f 7665 726c 6179 5f70 6164 6c2e   = overlay_padl.
-00022e60: 786d 6178 202b 2070 6164 5f73 697a 655b  xmax + pad_size[
-00022e70: 315d 202f 2035 0a20 2020 206f 7665 726c  1] / 5.    overl
-00022e80: 6179 5f70 6164 722e 796d 696e 203d 206f  ay_padr.ymin = o
-00022e90: 7665 726c 6179 5f70 6164 6c2e 796d 696e  verlay_padl.ymin
-00022ea0: 0a20 2020 206f 7665 726c 6179 5f70 6164  .    overlay_pad
-00022eb0: 722e 786d 696e 203d 206f 7665 726c 6179  r.xmin = overlay
-00022ec0: 5f70 6164 622e 786d 6178 202b 2070 6164  _padb.xmax + pad
-00022ed0: 5f73 697a 655b 315d 202f 2035 0a20 2020  _size[1] / 5.   
-00022ee0: 206f 7665 726c 6179 5f70 6164 742e 786d   overlay_padt.xm
-00022ef0: 696e 203d 206f 7665 726c 6179 5f70 6164  in = overlay_pad
-00022f00: 6c2e 786d 6178 202b 2070 6164 5f73 697a  l.xmax + pad_siz
-00022f10: 655b 315d 202f 2035 0a20 2020 206f 7665  e[1] / 5.    ove
-00022f20: 726c 6179 5f70 6164 742e 796d 696e 203d  rlay_padt.ymin =
-00022f30: 206f 7665 726c 6179 5f70 6164 6c2e 796d   overlay_padl.ym
-00022f40: 6178 0a0a 2020 2020 2320 7061 6473 0a20  ax..    # pads. 
-00022f50: 2020 2070 6164 6c20 3d20 4349 2e61 6464     padl = CI.add
-00022f60: 5f72 6566 2872 6563 7461 6e67 6c65 2873  _ref(rectangle(s
-00022f70: 697a 653d 7061 645f 7369 7a65 2c20 6c61  ize=pad_size, la
-00022f80: 7965 723d 636f 6d62 5f6c 6179 6572 2929  yer=comb_layer))
-00022f90: 0a20 2020 2070 6164 7420 3d20 4349 2e61  .    padt = CI.a
-00022fa0: 6464 5f72 6566 2872 6563 7461 6e67 6c65  dd_ref(rectangle
-00022fb0: 2873 697a 653d 7061 645f 7369 7a65 2c20  (size=pad_size, 
-00022fc0: 6c61 7965 723d 636f 6d62 5f6c 6179 6572  layer=comb_layer
-00022fd0: 2929 0a20 2020 2070 6164 7220 3d20 4349  )).    padr = CI
-00022fe0: 2e61 6464 5f72 6566 2872 6563 7461 6e67  .add_ref(rectang
-00022ff0: 6c65 2873 697a 653d 7061 645f 7369 7a65  le(size=pad_size
-00023000: 2c20 6c61 7965 723d 636f 6d62 5f6c 6179  , layer=comb_lay
-00023010: 6572 2929 0a20 2020 2070 6164 6220 3d20  er)).    padb = 
-00023020: 4349 2e61 6464 5f72 6566 2872 6563 7461  CI.add_ref(recta
-00023030: 6e67 6c65 2873 697a 653d 7061 645f 7369  ngle(size=pad_si
-00023040: 7a65 2c20 6c61 7965 723d 6f76 6572 6c61  ze, layer=overla
-00023050: 705f 7a69 677a 6167 5f6c 6179 6572 2929  p_zigzag_layer))
-00023060: 0a20 2020 2070 6164 6c5f 6e75 6220 3d20  .    padl_nub = 
-00023070: 4349 2e61 6464 5f72 6566 280a 2020 2020  CI.add_ref(.    
-00023080: 2020 2020 7265 6374 616e 676c 6528 7369      rectangle(si
-00023090: 7a65 3d28 7061 645f 7369 7a65 5b30 5d20  ze=(pad_size[0] 
-000230a0: 2f20 342c 2070 6164 5f73 697a 655b 315d  / 4, pad_size[1]
-000230b0: 202f 2032 292c 206c 6179 6572 3d63 6f6d   / 2), layer=com
-000230c0: 625f 6c61 7965 7229 0a20 2020 2029 0a20  b_layer).    ). 
-000230d0: 2020 2070 6164 725f 6e75 6220 3d20 4349     padr_nub = CI
-000230e0: 2e61 6464 5f72 6566 280a 2020 2020 2020  .add_ref(.      
-000230f0: 2020 7265 6374 616e 676c 6528 7369 7a65    rectangle(size
-00023100: 3d28 7061 645f 7369 7a65 5b30 5d20 2f20  =(pad_size[0] / 
-00023110: 342c 2070 6164 5f73 697a 655b 315d 202f  4, pad_size[1] /
-00023120: 2032 292c 206c 6179 6572 3d63 6f6d 625f   2), layer=comb_
-00023130: 6c61 7965 7229 0a20 2020 2029 0a20 2020  layer).    ).   
-00023140: 2070 6164 6c2e 786d 696e 203d 206f 7665   padl.xmin = ove
-00023150: 726c 6179 5f70 6164 6c2e 786d 696e 0a20  rlay_padl.xmin. 
-00023160: 2020 2070 6164 6c2e 6365 6e74 6572 203d     padl.center =
-00023170: 205b 7061 646c 2e63 656e 7465 725b 305d   [padl.center[0]
-00023180: 2c20 6f76 6572 6c61 795f 7061 646c 2e63  , overlay_padl.c
-00023190: 656e 7465 725b 315d 5d0a 2020 2020 7061  enter[1]].    pa
-000231a0: 6474 2e79 6d61 7820 3d20 6f76 6572 6c61  dt.ymax = overla
-000231b0: 795f 7061 6474 2e79 6d61 780a 2020 2020  y_padt.ymax.    
-000231c0: 7061 6474 2e63 656e 7465 7220 3d20 5b6f  padt.center = [o
-000231d0: 7665 726c 6179 5f70 6164 742e 6365 6e74  verlay_padt.cent
-000231e0: 6572 5b30 5d2c 2070 6164 742e 6365 6e74  er[0], padt.cent
-000231f0: 6572 5b31 5d5d 0a20 2020 2070 6164 722e  er[1]].    padr.
-00023200: 786d 6178 203d 206f 7665 726c 6179 5f70  xmax = overlay_p
-00023210: 6164 722e 786d 6178 0a20 2020 2070 6164  adr.xmax.    pad
-00023220: 722e 6365 6e74 6572 203d 205b 7061 6472  r.center = [padr
-00023230: 2e63 656e 7465 725b 305d 2c20 6f76 6572  .center[0], over
-00023240: 6c61 795f 7061 6472 2e63 656e 7465 725b  lay_padr.center[
-00023250: 315d 5d0a 2020 2020 7061 6462 2e79 6d69  1]].    padb.ymi
-00023260: 6e20 3d20 6f76 6572 6c61 795f 7061 6462  n = overlay_padb
-00023270: 2e79 6d69 6e0a 2020 2020 7061 6462 2e63  .ymin.    padb.c
-00023280: 656e 7465 7220 3d20 5b6f 7665 726c 6179  enter = [overlay
-00023290: 5f70 6164 622e 6365 6e74 6572 5b30 5d2c  _padb.center[0],
-000232a0: 2070 6164 622e 6365 6e74 6572 5b31 5d5d   padb.center[1]]
-000232b0: 0a20 2020 2070 6164 6c5f 6e75 622e 786d  .    padl_nub.xm
-000232c0: 696e 203d 2070 6164 6c2e 786d 6178 0a20  in = padl.xmax. 
-000232d0: 2020 2070 6164 6c5f 6e75 622e 6365 6e74     padl_nub.cent
-000232e0: 6572 203d 205b 7061 646c 5f6e 7562 2e63  er = [padl_nub.c
-000232f0: 656e 7465 725b 305d 2c20 7061 646c 2e63  enter[0], padl.c
-00023300: 656e 7465 725b 315d 5d0a 2020 2020 7061  enter[1]].    pa
-00023310: 6472 5f6e 7562 2e78 6d61 7820 3d20 7061  dr_nub.xmax = pa
-00023320: 6472 2e78 6d69 6e0a 2020 2020 7061 6472  dr.xmin.    padr
-00023330: 5f6e 7562 2e63 656e 7465 7220 3d20 5b70  _nub.center = [p
-00023340: 6164 725f 6e75 622e 6365 6e74 6572 5b30  adr_nub.center[0
-00023350: 5d2c 2070 6164 722e 6365 6e74 6572 5b31  ], padr.center[1
-00023360: 5d5d 0a0a 2020 2020 2320 636f 6e6e 6563  ]]..    # connec
-00023370: 7465 6420 7a69 670a 2020 2020 6865 6164  ted zig.    head
-00023380: 203d 2043 492e 6164 645f 7265 6628 636f   = CI.add_ref(co
-00023390: 6d70 6173 7328 7369 7a65 3d28 7061 645f  mpass(size=(pad_
-000233a0: 7369 7a65 5b30 5d20 2f20 3132 2c20 7769  size[0] / 12, wi
-000233b0: 7265 5f77 6964 7468 292c 206c 6179 6572  re_width), layer
-000233c0: 3d63 6f6d 625f 6c61 7965 7229 290a 2020  =comb_layer)).  
-000233d0: 2020 6865 6164 2e78 6d69 6e20 3d20 7061    head.xmin = pa
-000233e0: 646c 5f6e 7562 2e78 6d61 780a 2020 2020  dl_nub.xmax.    
-000233f0: 6865 6164 2e79 6d61 7820 3d20 7061 646c  head.ymax = padl
-00023400: 5f6e 7562 2e79 6d61 780a 2020 2020 636f  _nub.ymax.    co
-00023410: 6e6e 6563 746f 7220 3d20 4349 2e61 6464  nnector = CI.add
-00023420: 5f72 6566 2863 6f6d 7061 7373 2873 697a  _ref(compass(siz
-00023430: 653d 2877 6972 655f 7769 6474 682c 2077  e=(wire_width, w
-00023440: 6972 655f 7769 6474 6829 2c20 6c61 7965  ire_width), laye
-00023450: 723d 636f 6d62 5f6c 6179 6572 2929 0a20  r=comb_layer)). 
-00023460: 2020 2063 6f6e 6e65 6374 6f72 2e63 6f6e     connector.con
-00023470: 6e65 6374 2870 6f72 743d 2257 222c 2064  nect(port="W", d
-00023480: 6573 7469 6e61 7469 6f6e 3d68 6561 642e  estination=head.
-00023490: 706f 7274 735b 2245 225d 290a 2020 2020  ports["E"]).    
-000234a0: 6f6c 645f 706f 7274 203d 2063 6f6e 6e65  old_port = conne
-000234b0: 6374 6f72 2e70 6f72 7473 5b22 5322 5d0a  ctor.ports["S"].
-000234c0: 2020 2020 746f 7020 3d20 5472 7565 0a20      top = True. 
-000234d0: 2020 206f 626a 203d 2063 6f6e 6e65 6374     obj = connect
-000234e0: 6f72 0a20 2020 2077 6869 6c65 206f 626a  or.    while obj
-000234f0: 2e78 6d61 7820 2b20 7061 645f 7369 7a65  .xmax + pad_size
-00023500: 5b30 5d20 2f20 3132 203c 2070 6164 725f  [0] / 12 < padr_
-00023510: 6e75 622e 786d 696e 3a0a 2020 2020 2020  nub.xmin:.      
-00023520: 2020 2320 6c6f 6e67 207a 6967 207a 6167    # long zig zag
-00023530: 2072 6563 7461 6e67 6c65 0a20 2020 2020   rectangle.     
-00023540: 2020 206f 626a 203d 2043 492e 6164 645f     obj = CI.add_
-00023550: 7265 6628 0a20 2020 2020 2020 2020 2020  ref(.           
-00023560: 2063 6f6d 7061 7373 280a 2020 2020 2020   compass(.      
-00023570: 2020 2020 2020 2020 2020 7369 7a65 3d28            size=(
-00023580: 7061 645f 7369 7a65 5b31 5d20 2f20 3220  pad_size[1] / 2 
-00023590: 2d20 3220 2a20 7769 7265 5f77 6964 7468  - 2 * wire_width
-000235a0: 2c20 7769 7265 5f77 6964 7468 292c 206c  , wire_width), l
-000235b0: 6179 6572 3d63 6f6d 625f 6c61 7965 720a  ayer=comb_layer.
-000235c0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-000235d0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000235e0: 6f62 6a2e 636f 6e6e 6563 7428 706f 7274  obj.connect(port
-000235f0: 3d22 5722 2c20 6465 7374 696e 6174 696f  ="W", destinatio
-00023600: 6e3d 6f6c 645f 706f 7274 290a 2020 2020  n=old_port).    
-00023610: 2020 2020 6f6c 645f 706f 7274 203d 206f      old_port = o
-00023620: 626a 2e70 6f72 7473 5b22 4522 5d0a 2020  bj.ports["E"].  
-00023630: 2020 2020 2020 6966 2074 6f70 3a0a 2020        if top:.  
-00023640: 2020 2020 2020 2020 2020 2320 7a69 6720            # zig 
-00023650: 7a61 6720 6564 6765 2072 6563 7461 6e67  zag edge rectang
-00023660: 6c65 0a20 2020 2020 2020 2020 2020 206f  le.            o
-00023670: 626a 203d 2043 492e 6164 645f 7265 6628  bj = CI.add_ref(
-00023680: 636f 6d70 6173 7328 7369 7a65 3d28 7769  compass(size=(wi
-00023690: 7265 5f77 6964 7468 2c20 7769 7265 5f77  re_width, wire_w
-000236a0: 6964 7468 292c 206c 6179 6572 3d63 6f6d  idth), layer=com
-000236b0: 625f 6c61 7965 7229 290a 2020 2020 2020  b_layer)).      
-000236c0: 2020 2020 2020 6f62 6a2e 636f 6e6e 6563        obj.connec
-000236d0: 7428 706f 7274 3d22 4e22 2c20 6465 7374  t(port="N", dest
-000236e0: 696e 6174 696f 6e3d 6f6c 645f 706f 7274  ination=old_port
-000236f0: 290a 2020 2020 2020 2020 2020 2020 746f  ).            to
-00023700: 7020 3d20 4661 6c73 650a 2020 2020 2020  p = False.      
-00023710: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00023720: 2020 2020 2320 7a69 6720 7a61 6720 6564      # zig zag ed
-00023730: 6765 2072 6563 7461 6e67 6c65 0a20 2020  ge rectangle.   
-00023740: 2020 2020 2020 2020 206f 626a 203d 2043           obj = C
-00023750: 492e 6164 645f 7265 6628 636f 6d70 6173  I.add_ref(compas
-00023760: 7328 7369 7a65 3d28 7769 7265 5f77 6964  s(size=(wire_wid
-00023770: 7468 2c20 7769 7265 5f77 6964 7468 292c  th, wire_width),
-00023780: 206c 6179 6572 3d63 6f6d 625f 6c61 7965   layer=comb_laye
-00023790: 7229 290a 2020 2020 2020 2020 2020 2020  r)).            
-000237a0: 6f62 6a2e 636f 6e6e 6563 7428 706f 7274  obj.connect(port
-000237b0: 3d22 5322 2c20 6465 7374 696e 6174 696f  ="S", destinatio
-000237c0: 6e3d 6f6c 645f 706f 7274 290a 2020 2020  n=old_port).    
-000237d0: 2020 2020 2020 2020 746f 7020 3d20 5472          top = Tr
-000237e0: 7565 0a20 2020 2020 2020 2020 2020 2023  ue.            #
-000237f0: 2063 6f6d 6220 7265 6374 616e 6765 0a20   comb rectange. 
-00023800: 2020 2020 2020 2020 2020 2063 6f6d 6220             comb 
-00023810: 3d20 4349 2e61 6464 5f72 6566 280a 2020  = CI.add_ref(.  
-00023820: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00023830: 6374 616e 676c 6528 0a20 2020 2020 2020  ctangle(.       
-00023840: 2020 2020 2020 2020 2020 2020 2073 697a               siz
-00023850: 653d 280a 2020 2020 2020 2020 2020 2020  e=(.            
-00023860: 2020 2020 2020 2020 2020 2020 2870 6164              (pad
-00023870: 742e 796d 696e 202d 2068 6561 642e 796d  t.ymin - head.ym
-00023880: 6178 290a 2020 2020 2020 2020 2020 2020  ax).            
-00023890: 2020 2020 2020 2020 2020 2020 2b20 7061              + pa
-000238a0: 645f 7369 7a65 5b31 5d20 2f20 320a 2020  d_size[1] / 2.  
-000238b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000238c0: 2020 2020 2020 2d20 2877 6972 655f 7370        - (wire_sp
-000238d0: 6163 696e 6720 2b20 7769 7265 5f77 6964  acing + wire_wid
-000238e0: 7468 2920 2f20 322c 0a20 2020 2020 2020  th) / 2,.       
-000238f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023900: 2077 6972 655f 7769 6474 682c 0a20 2020   wire_width,.   
-00023910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023920: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
-00023930: 2020 2020 2020 2020 6c61 7965 723d 636f          layer=co
-00023940: 6d62 5f6c 6179 6572 2c0a 2020 2020 2020  mb_layer,.      
-00023950: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00023960: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00023970: 2020 2020 2020 636f 6d62 2e72 6f74 6174        comb.rotat
-00023980: 6528 3930 290a 2020 2020 2020 2020 2020  e(90).          
-00023990: 2020 636f 6d62 2e79 6d61 7820 3d20 7061    comb.ymax = pa
-000239a0: 6474 2e79 6d69 6e0a 2020 2020 2020 2020  dt.ymin.        
-000239b0: 2020 2020 636f 6d62 2e78 6d61 7820 3d20      comb.xmax = 
-000239c0: 6f62 6a2e 786d 6178 202d 2028 7769 7265  obj.xmax - (wire
-000239d0: 5f73 7061 6369 6e67 202b 2077 6972 655f  _spacing + wire_
-000239e0: 7769 6474 6829 202f 2032 0a20 2020 2020  width) / 2.     
-000239f0: 2020 206f 6c64 5f70 6f72 7420 3d20 6f62     old_port = ob
-00023a00: 6a2e 706f 7274 735b 2245 225d 0a20 2020  j.ports["E"].   
-00023a10: 2020 2020 206f 626a 203d 2043 492e 6164       obj = CI.ad
-00023a20: 645f 7265 6628 636f 6d70 6173 7328 7369  d_ref(compass(si
-00023a30: 7a65 3d28 7769 7265 5f73 7061 6369 6e67  ze=(wire_spacing
-00023a40: 2c20 7769 7265 5f77 6964 7468 292c 206c  , wire_width), l
-00023a50: 6179 6572 3d63 6f6d 625f 6c61 7965 7229  ayer=comb_layer)
-00023a60: 290a 2020 2020 2020 2020 6f62 6a2e 636f  ).        obj.co
-00023a70: 6e6e 6563 7428 706f 7274 3d22 5722 2c20  nnect(port="W", 
-00023a80: 6465 7374 696e 6174 696f 6e3d 6f6c 645f  destination=old_
-00023a90: 706f 7274 290a 2020 2020 2020 2020 6f6c  port).        ol
-00023aa0: 645f 706f 7274 203d 206f 626a 2e70 6f72  d_port = obj.por
-00023ab0: 7473 5b22 4522 5d0a 2020 2020 2020 2020  ts["E"].        
-00023ac0: 6f62 6a20 3d20 4349 2e61 6464 5f72 6566  obj = CI.add_ref
-00023ad0: 2863 6f6d 7061 7373 2873 697a 653d 2877  (compass(size=(w
-00023ae0: 6972 655f 7769 6474 682c 2077 6972 655f  ire_width, wire_
-00023af0: 7769 6474 6829 2c20 6c61 7965 723d 636f  width), layer=co
-00023b00: 6d62 5f6c 6179 6572 2929 0a20 2020 2020  mb_layer)).     
-00023b10: 2020 206f 626a 2e63 6f6e 6e65 6374 2870     obj.connect(p
-00023b20: 6f72 743d 2257 222c 2064 6573 7469 6e61  ort="W", destina
-00023b30: 7469 6f6e 3d6f 6c64 5f70 6f72 7429 0a20  tion=old_port). 
-00023b40: 2020 2020 2020 2069 6620 746f 703a 0a20         if top:. 
-00023b50: 2020 2020 2020 2020 2020 206f 6c64 5f70             old_p
-00023b60: 6f72 7420 3d20 6f62 6a2e 706f 7274 735b  ort = obj.ports[
-00023b70: 2253 225d 0a20 2020 2020 2020 2065 6c73  "S"].        els
-00023b80: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
-00023b90: 6c64 5f70 6f72 7420 3d20 6f62 6a2e 706f  ld_port = obj.po
-00023ba0: 7274 735b 224e 225d 0a20 2020 206f 6c64  rts["N"].    old
-00023bb0: 5f70 6f72 7420 3d20 6f62 6a2e 706f 7274  _port = obj.port
-00023bc0: 735b 2245 225d 0a20 2020 2069 6620 7061  s["E"].    if pa
-00023bd0: 6472 5f6e 7562 2e78 6d69 6e20 2d20 6f62  dr_nub.xmin - ob
-00023be0: 6a2e 786d 6178 203e 2030 3a0a 2020 2020  j.xmax > 0:.    
-00023bf0: 2020 2020 7461 696c 203d 2043 492e 6164      tail = CI.ad
-00023c00: 645f 7265 6628 0a20 2020 2020 2020 2020  d_ref(.         
-00023c10: 2020 2063 6f6d 7061 7373 2873 697a 653d     compass(size=
-00023c20: 2870 6164 725f 6e75 622e 786d 696e 202d  (padr_nub.xmin -
-00023c30: 206f 626a 2e78 6d61 782c 2077 6972 655f   obj.xmax, wire_
-00023c40: 7769 6474 6829 2c20 6c61 7965 723d 636f  width), layer=co
-00023c50: 6d62 5f6c 6179 6572 290a 2020 2020 2020  mb_layer).      
-00023c60: 2020 290a 2020 2020 656c 7365 3a0a 2020    ).    else:.  
-00023c70: 2020 2020 2020 7461 696c 203d 2043 492e        tail = CI.
-00023c80: 6164 645f 7265 6628 636f 6d70 6173 7328  add_ref(compass(
-00023c90: 7369 7a65 3d28 7769 7265 5f77 6964 7468  size=(wire_width
-00023ca0: 2c20 7769 7265 5f77 6964 7468 292c 206c  , wire_width), l
-00023cb0: 6179 6572 3d63 6f6d 625f 6c61 7965 7229  ayer=comb_layer)
-00023cc0: 290a 2020 2020 7461 696c 2e63 6f6e 6e65  ).    tail.conne
-00023cd0: 6374 2870 6f72 743d 2257 222c 2064 6573  ct(port="W", des
-00023ce0: 7469 6e61 7469 6f6e 3d6f 6c64 5f70 6f72  tination=old_por
-00023cf0: 7429 0a0a 2020 2020 2320 6469 7363 6f6e  t)..    # discon
-00023d00: 6e65 6374 6564 207a 6967 0a20 2020 2064  nected zig.    d
-00023d10: 6865 6164 203d 2043 492e 6164 645f 7265  head = CI.add_re
-00023d20: 6628 0a20 2020 2020 2020 2063 6f6d 7061  f(.        compa
-00023d30: 7373 280a 2020 2020 2020 2020 2020 2020  ss(.            
-00023d40: 7369 7a65 3d28 7061 6472 5f6e 7562 2e79  size=(padr_nub.y
-00023d50: 6d69 6e20 2d20 7061 6462 2e79 6d61 7820  min - padb.ymax 
-00023d60: 2d20 7769 7265 5f77 6964 7468 2c20 7769  - wire_width, wi
-00023d70: 7265 5f77 6964 7468 292c 0a20 2020 2020  re_width),.     
-00023d80: 2020 2020 2020 206c 6179 6572 3d6f 7665         layer=ove
-00023d90: 726c 6170 5f7a 6967 7a61 675f 6c61 7965  rlap_zigzag_laye
-00023da0: 722c 0a20 2020 2020 2020 2029 0a20 2020  r,.        ).   
-00023db0: 2029 0a20 2020 2064 6865 6164 2e72 6f74   ).    dhead.rot
-00023dc0: 6174 6528 3930 290a 2020 2020 6468 6561  ate(90).    dhea
-00023dd0: 642e 796d 696e 203d 2070 6164 622e 796d  d.ymin = padb.ym
-00023de0: 6178 0a20 2020 2064 6865 6164 2e78 6d61  ax.    dhead.xma
-00023df0: 7820 3d20 7461 696c 2e78 6d69 6e20 2d20  x = tail.xmin - 
-00023e00: 2877 6972 655f 7370 6163 696e 6720 2b20  (wire_spacing + 
-00023e10: 7769 7265 5f77 6964 7468 2920 2f20 320a  wire_width) / 2.
-00023e20: 2020 2020 636f 6e6e 6563 746f 7220 3d20      connector = 
-00023e30: 4349 2e61 6464 5f72 6566 280a 2020 2020  CI.add_ref(.    
-00023e40: 2020 2020 636f 6d70 6173 7328 7369 7a65      compass(size
-00023e50: 3d28 7769 7265 5f77 6964 7468 2c20 7769  =(wire_width, wi
-00023e60: 7265 5f77 6964 7468 292c 206c 6179 6572  re_width), layer
-00023e70: 3d6f 7665 726c 6170 5f7a 6967 7a61 675f  =overlap_zigzag_
-00023e80: 6c61 7965 7229 0a20 2020 2029 0a20 2020  layer).    ).   
-00023e90: 2063 6f6e 6e65 6374 6f72 2e63 6f6e 6e65   connector.conne
-00023ea0: 6374 2870 6f72 743d 2253 222c 2064 6573  ct(port="S", des
-00023eb0: 7469 6e61 7469 6f6e 3d64 6865 6164 2e70  tination=dhead.p
-00023ec0: 6f72 7473 5b22 4522 5d29 0a20 2020 206f  orts["E"]).    o
-00023ed0: 6c64 5f70 6f72 7420 3d20 636f 6e6e 6563  ld_port = connec
-00023ee0: 746f 722e 706f 7274 735b 224e 225d 0a20  tor.ports["N"]. 
-00023ef0: 2020 2072 6967 6874 203d 2054 7275 650a     right = True.
-00023f00: 2020 2020 6f62 6a20 3d20 636f 6e6e 6563      obj = connec
-00023f10: 746f 720a 2020 2020 7768 696c 6520 6f62  tor.    while ob
-00023f20: 6a2e 796d 6178 202b 2077 6972 655f 7370  j.ymax + wire_sp
-00023f30: 6163 696e 6720 2b20 7769 7265 5f77 6964  acing + wire_wid
-00023f40: 7468 203c 2068 6561 642e 796d 6178 3a0a  th < head.ymax:.
-00023f50: 2020 2020 2020 2020 6f62 6a20 3d20 4349          obj = CI
-00023f60: 2e61 6464 5f72 6566 280a 2020 2020 2020  .add_ref(.      
-00023f70: 2020 2020 2020 636f 6d70 6173 7328 7369        compass(si
-00023f80: 7a65 3d28 7769 7265 5f73 7061 6369 6e67  ze=(wire_spacing
-00023f90: 2c20 7769 7265 5f77 6964 7468 292c 206c  , wire_width), l
-00023fa0: 6179 6572 3d6f 7665 726c 6170 5f7a 6967  ayer=overlap_zig
-00023fb0: 7a61 675f 6c61 7965 7229 0a20 2020 2020  zag_layer).     
-00023fc0: 2020 2029 0a20 2020 2020 2020 206f 626a     ).        obj
-00023fd0: 2e63 6f6e 6e65 6374 2870 6f72 743d 2257  .connect(port="W
-00023fe0: 222c 2064 6573 7469 6e61 7469 6f6e 3d6f  ", destination=o
-00023ff0: 6c64 5f70 6f72 7429 0a20 2020 2020 2020  ld_port).       
-00024000: 206f 6c64 5f70 6f72 7420 3d20 6f62 6a2e   old_port = obj.
-00024010: 706f 7274 735b 2245 225d 0a20 2020 2020  ports["E"].     
-00024020: 2020 2069 6620 7269 6768 743a 0a20 2020     if right:.   
-00024030: 2020 2020 2020 2020 206f 626a 203d 2043           obj = C
-00024040: 492e 6164 645f 7265 6628 0a20 2020 2020  I.add_ref(.     
-00024050: 2020 2020 2020 2020 2020 2063 6f6d 7061             compa
-00024060: 7373 2873 697a 653d 2877 6972 655f 7769  ss(size=(wire_wi
-00024070: 6474 682c 2077 6972 655f 7769 6474 6829  dth, wire_width)
-00024080: 2c20 6c61 7965 723d 6f76 6572 6c61 705f  , layer=overlap_
-00024090: 7a69 677a 6167 5f6c 6179 6572 290a 2020  zigzag_layer).  
-000240a0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000240b0: 2020 2020 2020 2020 6f62 6a2e 636f 6e6e          obj.conn
-000240c0: 6563 7428 706f 7274 3d22 5722 2c20 6465  ect(port="W", de
-000240d0: 7374 696e 6174 696f 6e3d 6f6c 645f 706f  stination=old_po
-000240e0: 7274 290a 2020 2020 2020 2020 2020 2020  rt).            
-000240f0: 7269 6768 7420 3d20 4661 6c73 650a 2020  right = False.  
-00024100: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00024110: 2020 2020 2020 2020 6f62 6a20 3d20 4349          obj = CI
-00024120: 2e61 6464 5f72 6566 280a 2020 2020 2020  .add_ref(.      
-00024130: 2020 2020 2020 2020 2020 636f 6d70 6173            compas
-00024140: 7328 7369 7a65 3d28 7769 7265 5f77 6964  s(size=(wire_wid
-00024150: 7468 2c20 7769 7265 5f77 6964 7468 292c  th, wire_width),
-00024160: 206c 6179 6572 3d6f 7665 726c 6170 5f7a   layer=overlap_z
-00024170: 6967 7a61 675f 6c61 7965 7229 0a20 2020  igzag_layer).   
-00024180: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00024190: 2020 2020 2020 206f 626a 2e63 6f6e 6e65         obj.conne
-000241a0: 6374 2870 6f72 743d 2245 222c 2064 6573  ct(port="E", des
-000241b0: 7469 6e61 7469 6f6e 3d6f 6c64 5f70 6f72  tination=old_por
-000241c0: 7429 0a20 2020 2020 2020 2020 2020 2072  t).            r
-000241d0: 6967 6874 203d 2054 7275 650a 2020 2020  ight = True.    
-000241e0: 2020 2020 6f6c 645f 706f 7274 203d 206f      old_port = o
-000241f0: 626a 2e70 6f72 7473 5b22 4e22 5d0a 2020  bj.ports["N"].  
-00024200: 2020 2020 2020 6f62 6a20 3d20 4349 2e61        obj = CI.a
-00024210: 6464 5f72 6566 280a 2020 2020 2020 2020  dd_ref(.        
-00024220: 2020 2020 636f 6d70 6173 7328 0a20 2020      compass(.   
-00024230: 2020 2020 2020 2020 2020 2020 2073 697a               siz
-00024240: 653d 280a 2020 2020 2020 2020 2020 2020  e=(.            
-00024250: 2020 2020 2020 2020 6468 6561 642e 786d          dhead.xm
-00024260: 696e 202d 2028 6865 6164 2e78 6d61 7820  in - (head.xmax 
-00024270: 2b20 6865 6164 2e78 6d69 6e20 2b20 7769  + head.xmin + wi
-00024280: 7265 5f77 6964 7468 2920 2f20 322c 0a20  re_width) / 2,. 
-00024290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000242a0: 2020 2077 6972 655f 7769 6474 682c 0a20     wire_width,. 
-000242b0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000242c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000242d0: 2020 6c61 7965 723d 6f76 6572 6c61 705f    layer=overlap_
-000242e0: 7a69 677a 6167 5f6c 6179 6572 2c0a 2020  zigzag_layer,.  
-000242f0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00024300: 2020 2020 290a 2020 2020 2020 2020 6f62      ).        ob
-00024310: 6a2e 636f 6e6e 6563 7428 706f 7274 3d22  j.connect(port="
-00024320: 4522 2c20 6465 7374 696e 6174 696f 6e3d  E", destination=
-00024330: 6f6c 645f 706f 7274 290a 2020 2020 2020  old_port).      
-00024340: 2020 6f6c 645f 706f 7274 203d 206f 626a    old_port = obj
-00024350: 2e70 6f72 7473 5b22 5722 5d0a 2020 2020  .ports["W"].    
-00024360: 2020 2020 6f62 6a20 3d20 4349 2e61 6464      obj = CI.add
-00024370: 5f72 6566 280a 2020 2020 2020 2020 2020  _ref(.          
-00024380: 2020 636f 6d70 6173 7328 7369 7a65 3d28    compass(size=(
-00024390: 7769 7265 5f77 6964 7468 2c20 7769 7265  wire_width, wire
-000243a0: 5f77 6964 7468 292c 206c 6179 6572 3d6f  _width), layer=o
-000243b0: 7665 726c 6170 5f7a 6967 7a61 675f 6c61  verlap_zigzag_la
-000243c0: 7965 7229 0a20 2020 2020 2020 2029 0a20  yer).        ). 
-000243d0: 2020 2020 2020 206f 626a 2e63 6f6e 6e65         obj.conne
-000243e0: 6374 2870 6f72 743d 2253 222c 2064 6573  ct(port="S", des
-000243f0: 7469 6e61 7469 6f6e 3d6f 6c64 5f70 6f72  tination=old_por
-00024400: 7429 0a20 2020 2020 2020 2069 6620 7269  t).        if ri
-00024410: 6768 743a 0a20 2020 2020 2020 2020 2020  ght:.           
-00024420: 206f 6c64 5f70 6f72 7420 3d20 6f62 6a2e   old_port = obj.
-00024430: 706f 7274 735b 2257 225d 0a20 2020 2020  ports["W"].     
-00024440: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00024450: 2020 2020 206f 6c64 5f70 6f72 7420 3d20       old_port = 
-00024460: 6f62 6a2e 706f 7274 735b 2245 225d 0a0a  obj.ports["E"]..
-00024470: 2020 2020 7265 7475 726e 2043 490a 0a0a      return CI...
-00024480: 6465 6620 5f74 6573 745f 6963 5f77 6972  def _test_ic_wir
-00024490: 655f 7374 6570 2874 6869 636b 5f77 6964  e_step(thick_wid
-000244a0: 7468 3d31 302c 2074 6869 6e5f 7769 6474  th=10, thin_widt
-000244b0: 683d 312c 2077 6972 655f 6c61 7965 723d  h=1, wire_layer=
-000244c0: 3229 3a0a 2020 2020 2222 2248 656c 7065  2):.    """Helpe
-000244d0: 7220 6675 6e63 7469 6f6e 2075 7365 6420  r function used 
-000244e0: 746f 206d 616b 6520 7468 6520 4943 2073  to make the IC s
-000244f0: 7465 7020 7769 7265 2073 7472 7563 7475  tep wire structu
-00024500: 7265 2e22 2222 0a20 2020 2057 5334 203d  re.""".    WS4 =
-00024510: 2044 6576 6963 6528 2274 6573 745f 6963   Device("test_ic
-00024520: 5f73 7465 7022 290a 2020 2020 7769 7265  _step").    wire
-00024530: 5f73 7465 7061 203d 2057 5334 2e61 6464  _stepa = WS4.add
-00024540: 5f72 6566 280a 2020 2020 2020 2020 6f70  _ref(.        op
-00024550: 7469 6d61 6c5f 7374 6570 2874 6869 636b  timal_step(thick
-00024560: 5f77 6964 7468 202f 2032 2c20 7468 696e  _width / 2, thin
-00024570: 5f77 6964 7468 202f 2032 2c20 6c61 7965  _width / 2, laye
-00024580: 723d 7769 7265 5f6c 6179 6572 290a 2020  r=wire_layer).  
-00024590: 2020 290a 2020 2020 7769 7265 5f73 7465    ).    wire_ste
-000245a0: 7062 203d 2057 5334 2e61 6464 5f72 6566  pb = WS4.add_ref
-000245b0: 280a 2020 2020 2020 2020 6f70 7469 6d61  (.        optima
-000245c0: 6c5f 7374 6570 2874 6869 6e5f 7769 6474  l_step(thin_widt
-000245d0: 6820 2f20 322c 2074 6869 636b 5f77 6964  h / 2, thick_wid
-000245e0: 7468 202f 2032 2c20 6c61 7965 723d 7769  th / 2, layer=wi
-000245f0: 7265 5f6c 6179 6572 290a 2020 2020 290a  re_layer).    ).
-00024600: 2020 2020 7769 7265 5f73 7465 7063 203d      wire_stepc =
-00024610: 2057 5334 2e61 6464 5f72 6566 280a 2020   WS4.add_ref(.  
-00024620: 2020 2020 2020 6f70 7469 6d61 6c5f 7374        optimal_st
-00024630: 6570 2874 6869 636b 5f77 6964 7468 202f  ep(thick_width /
-00024640: 2032 2c20 7468 696e 5f77 6964 7468 202f   2, thin_width /
-00024650: 2032 2c20 6c61 7965 723d 7769 7265 5f6c   2, layer=wire_l
-00024660: 6179 6572 290a 2020 2020 290a 2020 2020  ayer).    ).    
-00024670: 7769 7265 5f73 7465 7064 203d 2057 5334  wire_stepd = WS4
-00024680: 2e61 6464 5f72 6566 280a 2020 2020 2020  .add_ref(.      
-00024690: 2020 6f70 7469 6d61 6c5f 7374 6570 2874    optimal_step(t
-000246a0: 6869 6e5f 7769 6474 6820 2f20 322c 2074  hin_width / 2, t
-000246b0: 6869 636b 5f77 6964 7468 202f 2032 2c20  hick_width / 2, 
-000246c0: 6c61 7965 723d 7769 7265 5f6c 6179 6572  layer=wire_layer
-000246d0: 290a 2020 2020 290a 2020 2020 7769 7265  ).    ).    wire
-000246e0: 5f73 7465 7062 2e72 6f74 6174 6528 3138  _stepb.rotate(18
-000246f0: 3029 0a20 2020 2077 6972 655f 7374 6570  0).    wire_step
-00024700: 622e 786d 696e 203d 2077 6972 655f 7374  b.xmin = wire_st
-00024710: 6570 612e 786d 696e 0a20 2020 2077 6972  epa.xmin.    wir
-00024720: 655f 7374 6570 632e 726f 7461 7465 2831  e_stepc.rotate(1
-00024730: 3830 290a 2020 2020 7769 7265 5f73 7465  80).    wire_ste
-00024740: 7063 2e78 6d69 6e20 3d20 7769 7265 5f73  pc.xmin = wire_s
-00024750: 7465 7061 2e78 6d61 780a 2020 2020 7769  tepa.xmax.    wi
-00024760: 7265 5f73 7465 7064 2e78 6d69 6e20 3d20  re_stepd.xmin = 
-00024770: 7769 7265 5f73 7465 7063 2e78 6d69 6e0a  wire_stepc.xmin.
-00024780: 2020 2020 7265 7475 726e 2057 5334 0a0a      return WS4..
-00024790: 0a64 6566 2074 6573 745f 6963 280a 2020  .def test_ic(.  
-000247a0: 2020 7769 7265 5f77 6964 7468 733d 5b30    wire_widths=[0
-000247b0: 2e32 352c 2030 2e35 2c20 312c 2032 2c20  .25, 0.5, 1, 2, 
-000247c0: 345d 2c0a 2020 2020 7769 7265 5f77 6964  4],.    wire_wid
-000247d0: 7468 735f 7769 6465 3d5b 302e 3735 2c20  ths_wide=[0.75, 
-000247e0: 312e 352c 2033 2c20 342c 2036 5d2c 0a20  1.5, 3, 4, 6],. 
-000247f0: 2020 2070 6164 5f73 697a 653d 2832 3030     pad_size=(200
-00024800: 2c20 3230 3029 2c0a 2020 2020 7061 645f  , 200),.    pad_
-00024810: 6761 703d 3735 2c0a 2020 2020 7769 7265  gap=75,.    wire
-00024820: 5f6c 6179 6572 3d30 2c0a 2020 2020 7061  _layer=0,.    pa
-00024830: 645f 6c61 7965 723d 312c 0a20 2020 2067  d_layer=1,.    g
-00024840: 6e64 5f6c 6179 6572 3d31 2c0a 293a 0a20  nd_layer=1,.):. 
-00024850: 2020 2022 2222 4372 6974 6963 616c 2063     """Critical c
-00024860: 7572 7265 6e74 2074 6573 7420 7374 7275  urrent test stru
-00024870: 6374 7572 6520 666f 7220 7375 7065 7263  cture for superc
-00024880: 6f6e 6475 6374 696e 6720 7769 7265 732e  onducting wires.
-00024890: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-000248a0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-000248b0: 2020 2020 7769 7265 5f77 6964 7468 7320      wire_widths 
-000248c0: 3a20 6172 7261 792d 6c69 6b65 5b4e 5d0a  : array-like[N].
-000248d0: 2020 2020 2020 2020 5468 6520 7769 6474          The widt
-000248e0: 6873 206f 6620 7468 6520 7468 696e 6e65  hs of the thinne
-000248f0: 7374 2070 6172 7473 206f 6620 7468 6520  st parts of the 
-00024900: 7465 7374 2077 6972 6573 2e0a 2020 2020  test wires..    
-00024910: 7769 7265 5f77 6964 7468 735f 7769 6465  wire_widths_wide
-00024920: 203a 2061 7272 6179 2d6c 696b 655b 4e5d   : array-like[N]
-00024930: 0a20 2020 2020 2020 2054 6865 2077 6964  .        The wid
-00024940: 7468 7320 6f66 2074 6865 2074 6869 636b  ths of the thick
-00024950: 6573 7420 7061 7274 7320 6f66 2074 6865  est parts of the
-00024960: 2074 6573 7420 7769 7265 732e 0a20 2020   test wires..   
-00024970: 2070 6164 5f73 697a 6520 3a20 6172 7261   pad_size : arra
-00024980: 792d 6c69 6b65 5b32 5d20 6f66 2069 6e74  y-like[2] of int
-00024990: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
-000249a0: 2020 2877 6964 7468 2c20 6865 6967 6874    (width, height
-000249b0: 2920 6f66 2074 6865 2070 6164 732e 0a20  ) of the pads.. 
-000249c0: 2020 2070 6164 5f67 6170 203a 2069 6e74     pad_gap : int
-000249d0: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
-000249e0: 2020 4469 7374 616e 6365 2062 6574 7765    Distance betwe
-000249f0: 656e 2074 6865 2070 6164 7320 616e 6420  en the pads and 
-00024a00: 7468 6520 6772 6f75 6e64 2070 6c61 6e65  the ground plane
-00024a10: 2e0a 2020 2020 7769 7265 5f6c 6179 6572  ..    wire_layer
-00024a20: 203a 2069 6e74 0a20 2020 2020 2020 2053   : int.        S
-00024a30: 7065 6369 6669 6320 6c61 7965 7228 7329  pecific layer(s)
-00024a40: 2074 6f20 7075 7420 7468 6520 7769 7265   to put the wire
-00024a50: 7320 6f6e 2e0a 2020 2020 7061 645f 6c61  s on..    pad_la
-00024a60: 7965 7220 3a20 696e 740a 2020 2020 2020  yer : int.      
-00024a70: 2020 5370 6563 6966 6963 206c 6179 6572    Specific layer
-00024a80: 2873 2920 746f 2070 7574 2074 6865 2070  (s) to put the p
-00024a90: 6164 7320 6f6e 2e0a 2020 2020 676e 645f  ads on..    gnd_
-00024aa0: 6c61 7965 7220 3a20 696e 7420 6f72 204e  layer : int or N
-00024ab0: 6f6e 650a 2020 2020 2020 2020 5370 6563  one.        Spec
-00024ac0: 6966 6963 206c 6179 6572 2873 2920 746f  ific layer(s) to
-00024ad0: 2070 7574 2074 6865 2067 726f 756e 6420   put the ground 
-00024ae0: 706c 616e 6520 6f6e 2e0a 0a20 2020 2052  plane on...    R
-00024af0: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
-00024b00: 2d2d 0a20 2020 2044 6576 6963 650a 2020  --.    Device.  
-00024b10: 2020 2020 2020 4120 4465 7669 6365 2063        A Device c
-00024b20: 6f6e 7461 696e 696e 6720 7468 6520 6372  ontaining the cr
-00024b30: 6974 6963 616c 2d63 7572 7265 6e74 2074  itical-current t
-00024b40: 6573 7420 7374 7275 6374 7572 652e 0a20  est structure.. 
-00024b50: 2020 2022 2222 0a20 2020 2049 4353 203d     """.    ICS =
-00024b60: 2044 6576 6963 6528 2274 6573 745f 6963   Device("test_ic
-00024b70: 2229 0a0a 2020 2020 2320 6966 2067 6e64  ")..    # if gnd
-00024b80: 5f6c 6179 6572 2069 7320 4e6f 6e65 3a20  _layer is None: 
-00024b90: 676e 645f 6c61 7965 7220 3d20 7061 645f  gnd_layer = pad_
-00024ba0: 6c61 7965 720a 2020 2020 7472 616e 736c  layer.    transl
-00024bb0: 6174 696f 6e20 3d20 300a 2020 2020 7061  ation = 0.    pa
-00024bc0: 6462 203d 2049 4353 2e61 6464 5f72 6566  db = ICS.add_ref
-00024bd0: 280a 2020 2020 2020 2020 7265 6374 616e  (.        rectan
-00024be0: 676c 6528 0a20 2020 2020 2020 2020 2020  gle(.           
-00024bf0: 2073 697a 653d 286e 702e 7369 7a65 2877   size=(np.size(w
-00024c00: 6972 655f 7769 6474 6873 2920 2a20 2870  ire_widths) * (p
-00024c10: 6164 5f73 697a 655b 305d 202a 2036 202f  ad_size[0] * 6 /
-00024c20: 2035 292c 2070 6164 5f73 697a 655b 315d   5), pad_size[1]
-00024c30: 292c 0a20 2020 2020 2020 2020 2020 206c  ),.            l
-00024c40: 6179 6572 3d77 6972 655f 6c61 7965 722c  ayer=wire_layer,
-00024c50: 0a20 2020 2020 2020 2029 0a20 2020 2029  .        ).    )
-00024c60: 0a0a 2020 2020 7061 6462 5f6f 7665 726c  ..    padb_overl
-00024c70: 6179 203d 2049 4353 2e61 6464 5f72 6566  ay = ICS.add_ref
-00024c80: 280a 2020 2020 2020 2020 7265 6374 616e  (.        rectan
-00024c90: 676c 6528 0a20 2020 2020 2020 2020 2020  gle(.           
-00024ca0: 2073 697a 653d 280a 2020 2020 2020 2020   size=(.        
-00024cb0: 2020 2020 2020 2020 286e 702e 7369 7a65          (np.size
-00024cc0: 2877 6972 655f 7769 6474 6873 2920 2a20  (wire_widths) * 
-00024cd0: 2870 6164 5f73 697a 655b 305d 202a 2036  (pad_size[0] * 6
-00024ce0: 202f 2035 2929 202a 2039 202f 2031 302c   / 5)) * 9 / 10,
-00024cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024d00: 2070 6164 5f73 697a 655b 315d 202a 2039   pad_size[1] * 9
-00024d10: 202f 2031 302c 0a20 2020 2020 2020 2020   / 10,.         
-00024d20: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
-00024d30: 2020 6c61 7965 723d 676e 645f 6c61 7965    layer=gnd_laye
-00024d40: 722c 0a20 2020 2020 2020 2029 0a20 2020  r,.        ).   
-00024d50: 2029 0a20 2020 2070 6164 625f 6f76 6572   ).    padb_over
-00024d60: 6c61 792e 6365 6e74 6572 203d 2070 6164  lay.center = pad
-00024d70: 622e 6365 6e74 6572 0a20 2020 2070 6164  b.center.    pad
-00024d80: 625f 6f76 6572 6c61 792e 796d 696e 203d  b_overlay.ymin =
-00024d90: 2070 6164 622e 796d 696e 0a20 2020 2066   padb.ymin.    f
-00024da0: 6f72 2069 2c20 7820 696e 2065 6e75 6d65  or i, x in enume
-00024db0: 7261 7465 2877 6972 655f 7769 6474 6873  rate(wire_widths
-00024dc0: 5f77 6964 6529 3a0a 2020 2020 2020 2020  _wide):.        
-00024dd0: 7061 6474 203d 2049 4353 2e61 6464 5f72  padt = ICS.add_r
-00024de0: 6566 2872 6563 7461 6e67 6c65 2870 6164  ef(rectangle(pad
-00024df0: 5f73 697a 652c 2077 6972 655f 6c61 7965  _size, wire_laye
-00024e00: 7229 290a 2020 2020 2020 2020 7061 6474  r)).        padt
-00024e10: 2e78 6d69 6e20 3d20 7061 6462 2e78 6d69  .xmin = padb.xmi
-00024e20: 6e20 2b20 7472 616e 736c 6174 696f 6e0a  n + translation.
-00024e30: 2020 2020 2020 2020 7061 6474 2e79 6d69          padt.ymi
-00024e40: 6e20 3d20 7061 6462 2e79 6d61 7820 2b20  n = padb.ymax + 
-00024e50: 7061 645f 6761 700a 2020 2020 2020 2020  pad_gap.        
-00024e60: 7061 6474 5f6f 7665 726c 6179 203d 2049  padt_overlay = I
-00024e70: 4353 2e61 6464 5f72 6566 280a 2020 2020  CS.add_ref(.    
-00024e80: 2020 2020 2020 2020 7265 6374 616e 676c          rectangl
-00024e90: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-00024ea0: 2020 2073 697a 653d 2870 6164 5f73 697a     size=(pad_siz
-00024eb0: 655b 305d 202a 2039 202f 2031 302c 2070  e[0] * 9 / 10, p
-00024ec0: 6164 5f73 697a 655b 315d 202a 2039 202f  ad_size[1] * 9 /
-00024ed0: 2031 3029 2c20 6c61 7965 723d 7061 645f   10), layer=pad_
-00024ee0: 6c61 7965 720a 2020 2020 2020 2020 2020  layer.          
-00024ef0: 2020 290a 2020 2020 2020 2020 290a 2020    ).        ).  
-00024f00: 2020 2020 2020 7061 6474 5f6f 7665 726c        padt_overl
-00024f10: 6179 2e63 656e 7465 7220 3d20 7061 6474  ay.center = padt
-00024f20: 2e63 656e 7465 720a 2020 2020 2020 2020  .center.        
-00024f30: 7061 6474 5f6f 7665 726c 6179 2e79 6d61  padt_overlay.yma
-00024f40: 7820 3d20 7061 6474 2e79 6d61 780a 2020  x = padt.ymax.  
-00024f50: 2020 2020 2020 6469 6666 6572 656e 6365        difference
-00024f60: 203d 2070 6164 742e 796d 696e 202d 2070   = padt.ymin - p
-00024f70: 6164 622e 796d 6178 0a20 2020 2020 2020  adb.ymax.       
-00024f80: 2077 6972 655f 7374 6570 203d 2049 4353   wire_step = ICS
-00024f90: 2e61 6464 5f72 6566 280a 2020 2020 2020  .add_ref(.      
-00024fa0: 2020 2020 2020 5f74 6573 745f 6963 5f77        _test_ic_w
-00024fb0: 6972 655f 7374 6570 280a 2020 2020 2020  ire_step(.      
-00024fc0: 2020 2020 2020 2020 2020 7769 7265 5f77            wire_w
-00024fd0: 6964 7468 735f 7769 6465 5b69 5d2c 2077  idths_wide[i], w
-00024fe0: 6972 655f 7769 6474 6873 5b69 5d2c 2077  ire_widths[i], w
-00024ff0: 6972 655f 6c61 7965 723d 7769 7265 5f6c  ire_layer=wire_l
-00025000: 6179 6572 0a20 2020 2020 2020 2020 2020  ayer.           
-00025010: 2029 0a20 2020 2020 2020 2029 0a20 2020   ).        ).   
-00025020: 2020 2020 2077 6972 655f 7374 6570 2e72       wire_step.r
-00025030: 6f74 6174 6528 3930 290a 2020 2020 2020  otate(90).      
-00025040: 2020 7769 7265 5f73 7465 702e 6365 6e74    wire_step.cent
-00025050: 6572 203d 2028 7061 6474 2e63 656e 7465  er = (padt.cente
-00025060: 725b 305d 2c20 7061 6462 2e79 6d61 7820  r[0], padb.ymax 
-00025070: 2b20 6469 6666 6572 656e 6365 202f 2032  + difference / 2
-00025080: 290a 2020 2020 2020 2020 7472 616e 736c  ).        transl
-00025090: 6174 696f 6e20 3d20 7472 616e 736c 6174  ation = translat
-000250a0: 696f 6e20 2b20 7061 645f 7369 7a65 5b30  ion + pad_size[0
-000250b0: 5d20 2a20 3132 202f 2031 300a 2020 2020  ] * 12 / 10.    
-000250c0: 2020 2020 636f 6e6e 5f77 6972 655f 746f      conn_wire_to
-000250d0: 7020 3d20 4943 532e 6164 645f 7265 6628  p = ICS.add_ref(
-000250e0: 0a20 2020 2020 2020 2020 2020 2072 6563  .            rec
-000250f0: 7461 6e67 6c65 280a 2020 2020 2020 2020  tangle(.        
-00025100: 2020 2020 2020 2020 7369 7a65 3d28 7769          size=(wi
-00025110: 7265 5f77 6964 7468 735f 7769 6465 5b69  re_widths_wide[i
-00025120: 5d2c 2070 6164 742e 796d 696e 202d 2077  ], padt.ymin - w
-00025130: 6972 655f 7374 6570 2e79 6d61 7829 2c20  ire_step.ymax), 
-00025140: 6c61 7965 723d 7769 7265 5f6c 6179 6572  layer=wire_layer
-00025150: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00025160: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00025170: 2063 6f6e 6e5f 7769 7265 5f62 6f74 746f   conn_wire_botto
-00025180: 6d20 3d20 4943 532e 6164 645f 7265 6628  m = ICS.add_ref(
-00025190: 0a20 2020 2020 2020 2020 2020 2072 6563  .            rec
-000251a0: 7461 6e67 6c65 280a 2020 2020 2020 2020  tangle(.        
-000251b0: 2020 2020 2020 2020 7369 7a65 3d28 7769          size=(wi
-000251c0: 7265 5f77 6964 7468 735f 7769 6465 5b69  re_widths_wide[i
-000251d0: 5d2c 2077 6972 655f 7374 6570 2e79 6d69  ], wire_step.ymi
-000251e0: 6e20 2d20 7061 6462 2e79 6d61 7829 2c20  n - padb.ymax), 
-000251f0: 6c61 7965 723d 7769 7265 5f6c 6179 6572  layer=wire_layer
-00025200: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00025210: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00025220: 2063 6f6e 6e5f 7769 7265 5f74 6f70 2e79   conn_wire_top.y
-00025230: 6d61 7820 3d20 7061 6474 2e79 6d69 6e0a  max = padt.ymin.
-00025240: 2020 2020 2020 2020 636f 6e6e 5f77 6972          conn_wir
-00025250: 655f 746f 702e 786d 696e 203d 2077 6972  e_top.xmin = wir
-00025260: 655f 7374 6570 2e78 6d69 6e0a 2020 2020  e_step.xmin.    
-00025270: 2020 2020 636f 6e6e 5f77 6972 655f 626f      conn_wire_bo
-00025280: 7474 6f6d 2e79 6d69 6e20 3d20 7061 6462  ttom.ymin = padb
-00025290: 2e79 6d61 780a 2020 2020 2020 2020 636f  .ymax.        co
-000252a0: 6e6e 5f77 6972 655f 626f 7474 6f6d 2e78  nn_wire_bottom.x
-000252b0: 6d69 6e20 3d20 7769 7265 5f73 7465 702e  min = wire_step.
-000252c0: 786d 696e 0a0a 2020 2020 7265 7475 726e  xmin..    return
-000252d0: 2049 4353 0a0a 0a64 6566 2074 6573 745f   ICS...def test_
-000252e0: 7265 7328 0a20 2020 2070 6164 5f73 697a  res(.    pad_siz
-000252f0: 653d 5b35 302c 2035 305d 2c20 6e75 6d5f  e=[50, 50], num_
-00025300: 7371 7561 7265 733d 3130 3030 2c20 7769  squares=1000, wi
-00025310: 6474 683d 312c 2072 6573 5f6c 6179 6572  dth=1, res_layer
-00025320: 3d30 2c20 7061 645f 6c61 7965 723d 312c  =0, pad_layer=1,
-00025330: 2067 6e64 5f6c 6179 6572 3d32 0a29 3a0a   gnd_layer=2.):.
-00025340: 2020 2020 2222 2243 7265 6174 6573 2061      """Creates a
-00025350: 6e20 6566 6669 6369 656e 7420 7265 736f  n efficient reso
-00025360: 6e61 746f 7220 7374 7275 6374 7572 6520  nator structure 
-00025370: 666f 7220 6120 7761 6665 7220 6c61 796f  for a wafer layo
-00025380: 7574 2e0a 0a20 2020 2050 6172 616d 6574  ut...    Paramet
-00025390: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
-000253a0: 2d2d 0a20 2020 2070 6164 5f73 697a 6520  --.    pad_size 
-000253b0: 3a20 6172 7261 792d 6c69 6b65 5b32 5d20  : array-like[2] 
-000253c0: 6f66 2069 6e74 206f 7220 666c 6f61 740a  of int or float.
-000253d0: 2020 2020 2020 2020 2877 6964 7468 2c20          (width, 
-000253e0: 6865 6967 6874 2920 6f66 2074 6865 2074  height) of the t
-000253f0: 776f 206d 6174 6368 6564 2069 6d70 6564  wo matched imped
-00025400: 616e 6365 2070 6164 7320 696e 206d 6963  ance pads in mic
-00025410: 726f 6e73 2e0a 2020 2020 6e75 6d5f 7371  rons..    num_sq
-00025420: 7561 7265 7320 3a20 696e 7420 6f72 2066  uares : int or f
-00025430: 6c6f 6174 0a20 2020 2020 2020 204e 756d  loat.        Num
-00025440: 6265 7220 6f66 2073 7175 6172 6573 2063  ber of squares c
-00025450: 6f6d 7072 6973 696e 6720 7468 6520 7265  omprising the re
-00025460: 736f 6e61 746f 7220 7769 7265 2e0a 2020  sonator wire..  
-00025470: 2020 7769 6474 6820 3a20 696e 7420 6f72    width : int or
-00025480: 2066 6c6f 6174 0a20 2020 2020 2020 2054   float.        T
-00025490: 6865 2077 6964 7468 206f 6620 7468 6520  he width of the 
-000254a0: 7371 7561 7265 7320 696e 206d 6963 726f  squares in micro
-000254b0: 6e73 2e0a 2020 2020 7265 735f 6c61 7965  ns..    res_laye
-000254c0: 7220 3a20 696e 740a 2020 2020 2020 2020  r : int.        
-000254d0: 5370 6563 6966 6963 206c 6179 6572 2873  Specific layer(s
-000254e0: 2920 746f 2070 7574 2074 6865 2072 6573  ) to put the res
-000254f0: 6f6e 6174 6f72 2073 7472 7563 7475 7265  onator structure
-00025500: 206f 6e2e 0a20 2020 2070 6164 5f6c 6179   on..    pad_lay
-00025510: 6572 203a 2069 6e74 206f 7220 4e6f 6e65  er : int or None
-00025520: 0a20 2020 2020 2020 2053 7065 6369 6669  .        Specifi
-00025530: 6320 6c61 7965 7228 7329 2074 6f20 7075  c layer(s) to pu
-00025540: 7420 7468 6520 7061 6473 206f 6e2e 0a20  t the pads on.. 
-00025550: 2020 2067 6e64 5f6c 6179 6572 203a 2020     gnd_layer :  
-00025560: 696e 7420 6f72 204e 6f6e 650a 2020 2020  int or None.    
-00025570: 2020 2020 5370 6563 6966 6963 206c 6179      Specific lay
-00025580: 6572 2873 2920 746f 2070 7574 2074 6865  er(s) to put the
-00025590: 2067 726f 756e 6420 706c 616e 6520 6f6e   ground plane on
-000255a0: 2e0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
-000255b0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2050     -------.    P
-000255c0: 203a 2044 6576 6963 650a 2020 2020 2020   : Device.      
-000255d0: 2020 4120 4465 7669 6365 2063 6f6e 7461    A Device conta
-000255e0: 696e 696e 6720 616e 2065 6666 6963 6965  ining an efficie
-000255f0: 6e74 2072 6573 6f6e 6174 6f72 2073 7472  nt resonator str
-00025600: 7563 7475 7265 2e0a 2020 2020 2222 220a  ucture..    """.
-00025610: 2020 2020 7820 3d20 7061 645f 7369 7a65      x = pad_size
-00025620: 5b30 5d0a 2020 2020 7a20 3d20 7061 645f  [0].    z = pad_
-00025630: 7369 7a65 5b31 5d0a 0a20 2020 2023 2043  size[1]..    # C
-00025640: 6865 636b 696e 6720 7661 6c69 6469 7479  hecking validity
-00025650: 206f 6620 696e 7075 740a 2020 2020 6966   of input.    if
-00025660: 2078 203c 3d20 3020 6f72 207a 203c 3d20   x <= 0 or z <= 
-00025670: 303a 0a20 2020 2020 2020 2072 6169 7365  0:.        raise
-00025680: 2056 616c 7565 4572 726f 7228 2250 6164   ValueError("Pad
-00025690: 206d 7573 7420 6861 7665 2070 6f73 6974   must have posit
-000256a0: 6976 652c 2072 6561 6c20 6469 6d65 6e73  ive, real dimens
-000256b0: 696f 6e73 2229 0a20 2020 2065 6c69 6620  ions").    elif 
-000256c0: 7769 6474 6820 3e20 7a3a 0a20 2020 2020  width > z:.     
-000256d0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-000256e0: 726f 7228 2257 6964 7468 206f 6620 6365  ror("Width of ce
-000256f0: 6c6c 2063 616e 6e6f 7420 6265 2067 7265  ll cannot be gre
-00025700: 6174 6572 2074 6861 6e20 6865 6967 6874  ater than height
-00025710: 206f 6620 7061 6422 290a 2020 2020 656c   of pad").    el
-00025720: 6966 206e 756d 5f73 7175 6172 6573 203c  if num_squares <
-00025730: 3d20 303a 0a20 2020 2020 2020 2072 6169  = 0:.        rai
-00025740: 7365 2056 616c 7565 4572 726f 7228 224e  se ValueError("N
-00025750: 756d 6265 7220 6f66 2073 7175 6172 6573  umber of squares
-00025760: 206d 7573 7420 6265 2061 2070 6f73 6974   must be a posit
-00025770: 6976 6520 7265 616c 206e 756d 6265 7222  ive real number"
-00025780: 290a 2020 2020 656c 6966 2077 6964 7468  ).    elif width
-00025790: 203c 3d20 303a 0a20 2020 2020 2020 2072   <= 0:.        r
-000257a0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-000257b0: 2257 6964 7468 206f 6620 6365 6c6c 206d  "Width of cell m
-000257c0: 7573 7420 6265 2061 2070 6f73 6974 6976  ust be a positiv
-000257d0: 6520 7265 616c 206e 756d 6265 7222 290a  e real number").
-000257e0: 0a20 2020 2023 2050 6572 666f 726d 696e  .    # Performin
-000257f0: 6720 7072 656c 696d 696e 6172 7920 6361  g preliminary ca
-00025800: 6c63 756c 6174 696f 6e73 0a20 2020 206e  lculations.    n
-00025810: 756d 5f72 6f77 7320 3d20 696e 7428 6e70  um_rows = int(np
-00025820: 2e66 6c6f 6f72 287a 202f 2028 3220 2a20  .floor(z / (2 * 
-00025830: 7769 6474 6829 2929 0a20 2020 2069 6620  width))).    if 
-00025840: 6e75 6d5f 726f 7773 2025 2032 203d 3d20  num_rows % 2 == 
-00025850: 303a 0a20 2020 2020 2020 206e 756d 5f72  0:.        num_r
-00025860: 6f77 7320 2d3d 2031 0a20 2020 206e 756d  ows -= 1.    num
-00025870: 5f63 6f6c 756d 6e73 203d 206e 756d 5f72  _columns = num_r
-00025880: 6f77 7320 2d20 310a 2020 2020 7371 7561  ows - 1.    squa
-00025890: 7265 735f 696e 5f72 6f77 203d 2028 6e75  res_in_row = (nu
-000258a0: 6d5f 7371 7561 7265 7320 2d20 6e75 6d5f  m_squares - num_
-000258b0: 636f 6c75 6d6e 7320 2d20 3229 202f 206e  columns - 2) / n
-000258c0: 756d 5f72 6f77 730a 0a20 2020 2023 2043  um_rows..    # C
-000258d0: 6f6d 7065 6e73 6174 696e 6720 666f 7220  ompensating for 
-000258e0: 7765 6972 6420 6564 6765 2063 6173 6573  weird edge cases
-000258f0: 0a20 2020 2069 6620 7371 7561 7265 735f  .    if squares_
-00025900: 696e 5f72 6f77 203c 2031 3a0a 2020 2020  in_row < 1:.    
-00025910: 2020 2020 6e75 6d5f 726f 7773 203d 2069      num_rows = i
-00025920: 6e74 2872 6f75 6e64 286e 756d 5f72 6f77  nt(round(num_row
-00025930: 7320 2f20 3229 202d 2032 290a 2020 2020  s / 2) - 2).    
-00025940: 2020 2020 7371 7561 7265 735f 696e 5f72      squares_in_r
-00025950: 6f77 203d 2031 0a20 2020 2069 6620 7769  ow = 1.    if wi
-00025960: 6474 6820 2a20 3220 3e20 7a3a 0a20 2020  dth * 2 > z:.   
-00025970: 2020 2020 206e 756d 5f72 6f77 7320 3d20       num_rows = 
-00025980: 310a 2020 2020 2020 2020 7371 7561 7265  1.        square
-00025990: 735f 696e 5f72 6f77 203d 206e 756d 5f73  s_in_row = num_s
-000259a0: 7175 6172 6573 202d 2032 0a0a 2020 2020  quares - 2..    
-000259b0: 6c65 6e67 7468 5f72 6f77 203d 2073 7175  length_row = squ
-000259c0: 6172 6573 5f69 6e5f 726f 7720 2a20 7769  ares_in_row * wi
-000259d0: 6474 680a 0a20 2020 2023 2043 7265 6174  dth..    # Creat
-000259e0: 696e 6720 726f 772f 636f 6c75 6d6e 2063  ing row/column c
-000259f0: 6f72 6e65 7220 636f 6d62 696e 6174 696f  orner combinatio
-00025a00: 6e20 7374 7275 6374 7572 650a 2020 2020  n structure.    
-00025a10: 5420 3d20 4465 7669 6365 2829 0a20 2020  T = Device().   
-00025a20: 2052 6f77 203d 2072 6563 7461 6e67 6c65   Row = rectangle
-00025a30: 2873 697a 653d 286c 656e 6774 685f 726f  (size=(length_ro
-00025a40: 772c 2077 6964 7468 292c 206c 6179 6572  w, width), layer
-00025a50: 3d72 6573 5f6c 6179 6572 290a 2020 2020  =res_layer).    
-00025a60: 436f 6c20 3d20 7265 6374 616e 676c 6528  Col = rectangle(
-00025a70: 7369 7a65 3d28 7769 6474 682c 2077 6964  size=(width, wid
-00025a80: 7468 292c 206c 6179 6572 3d72 6573 5f6c  th), layer=res_l
-00025a90: 6179 6572 290a 0a20 2020 2054 2e61 6464  ayer)..    T.add
-00025aa0: 5f72 6566 2852 6f77 290a 2020 2020 636f  _ref(Row).    co
-00025ab0: 6c20 3d20 542e 6164 645f 7265 6628 436f  l = T.add_ref(Co
-00025ac0: 6c29 0a20 2020 2063 6f6c 2e6d 6f76 6528  l).    col.move(
-00025ad0: 5b6c 656e 6774 685f 726f 7720 2d20 7769  [length_row - wi
-00025ae0: 6474 682c 202d 7769 6474 685d 290a 0a20  dth, -width]).. 
-00025af0: 2020 2023 2043 7265 6174 696e 6720 656e     # Creating en
-00025b00: 7469 7265 2077 6176 6567 7569 6465 206e  tire waveguide n
-00025b10: 6574 0a20 2020 204e 203d 2044 6576 6963  et.    N = Devic
-00025b20: 6528 226e 6574 2229 0a20 2020 206e 203d  e("net").    n =
-00025b30: 2031 0a20 2020 2066 6f72 2069 2069 6e20   1.    for i in 
-00025b40: 7261 6e67 6528 6e75 6d5f 726f 7773 293a  range(num_rows):
-00025b50: 0a20 2020 2020 2020 2069 6620 6920 213d  .        if i !=
-00025b60: 206e 756d 5f72 6f77 7320 2d20 313a 0a20   num_rows - 1:. 
-00025b70: 2020 2020 2020 2020 2020 2064 203d 204e             d = N
-00025b80: 2e61 6464 5f72 6566 2854 290a 2020 2020  .add_ref(T).    
-00025b90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00025ba0: 2020 2020 2020 6420 3d20 4e2e 6164 645f        d = N.add_
-00025bb0: 7265 6628 526f 7729 0a20 2020 2020 2020  ref(Row).       
-00025bc0: 2069 6620 6e20 2520 3220 3d3d 2030 3a0a   if n % 2 == 0:.
-00025bd0: 2020 2020 2020 2020 2020 2020 642e 6d69              d.mi
-00025be0: 7272 6f72 2870 313d 2864 2e78 2c20 642e  rror(p1=(d.x, d.
-00025bf0: 796d 6178 292c 2070 323d 2864 2e78 2c20  ymax), p2=(d.x, 
-00025c00: 642e 796d 696e 2929 0a20 2020 2020 2020  d.ymin)).       
-00025c10: 2064 2e6d 6f76 6579 282d 286e 202d 2031   d.movey(-(n - 1
-00025c20: 2920 2a20 542e 7973 697a 6529 0a20 2020  ) * T.ysize).   
-00025c30: 2020 2020 206e 202b 3d20 310a 2020 2020       n += 1.    
-00025c40: 6420 3d20 4e2e 6164 645f 7265 6628 436f  d = N.add_ref(Co
-00025c50: 6c29 2e6d 6f76 6578 282d 7769 6474 6829  l).movex(-width)
-00025c60: 0a20 2020 2064 203d 204e 2e61 6464 5f72  .    d = N.add_r
-00025c70: 6566 2843 6f6c 292e 6d6f 7665 285b 6c65  ef(Col).move([le
-00025c80: 6e67 7468 5f72 6f77 2c20 2d28 6e20 2d20  ngth_row, -(n - 
-00025c90: 3229 202a 2054 2e79 7369 7a65 5d29 0a0a  2) * T.ysize])..
-00025ca0: 2020 2020 2320 4372 6561 7469 6e67 2070      # Creating p
-00025cb0: 6164 730a 2020 2020 5020 3d20 4465 7669  ads.    P = Devi
-00025cc0: 6365 2822 7465 7374 5f72 6573 2229 0a20  ce("test_res"). 
-00025cd0: 2020 2050 6164 3120 3d20 7265 6374 616e     Pad1 = rectan
-00025ce0: 676c 6528 7369 7a65 3d28 782c 207a 292c  gle(size=(x, z),
-00025cf0: 206c 6179 6572 3d70 6164 5f6c 6179 6572   layer=pad_layer
-00025d00: 290a 2020 2020 5061 6432 203d 2072 6563  ).    Pad2 = rec
-00025d10: 7461 6e67 6c65 2873 697a 653d 2878 202b  tangle(size=(x +
-00025d20: 2035 2c20 7a29 2c20 6c61 7965 723d 7061   5, z), layer=pa
-00025d30: 645f 6c61 7965 7229 0a20 2020 2047 6e64  d_layer).    Gnd
-00025d40: 3120 3d20 6f66 6673 6574 2850 6164 312c  1 = offset(Pad1,
-00025d50: 2064 6973 7461 6e63 653d 2d35 2c20 6c61   distance=-5, la
-00025d60: 7965 723d 676e 645f 6c61 7965 7229 0a20  yer=gnd_layer). 
-00025d70: 2020 2047 6e64 3220 3d20 6f66 6673 6574     Gnd2 = offset
-00025d80: 2850 6164 322c 2064 6973 7461 6e63 653d  (Pad2, distance=
-00025d90: 2d35 2c20 6c61 7965 723d 676e 645f 6c61  -5, layer=gnd_la
-00025da0: 7965 7229 0a20 2020 2070 6164 3120 3d20  yer).    pad1 = 
-00025db0: 502e 6164 645f 7265 6628 5061 6431 292e  P.add_ref(Pad1).
-00025dc0: 6d6f 7665 7828 2d78 202d 2077 6964 7468  movex(-x - width
-00025dd0: 290a 2020 2020 7061 6432 203d 2050 2e61  ).    pad2 = P.a
-00025de0: 6464 5f72 6566 2850 6164 3129 2e6d 6f76  dd_ref(Pad1).mov
-00025df0: 6578 286c 656e 6774 685f 726f 7720 2b20  ex(length_row + 
-00025e00: 7769 6474 6829 0a20 2020 2050 2e61 6464  width).    P.add
-00025e10: 5f72 6566 2847 6e64 3129 2e63 656e 7465  _ref(Gnd1).cente
-00025e20: 7220 3d20 7061 6431 2e63 656e 7465 7220  r = pad1.center 
-00025e30: 2023 2067 6e64 310a 2020 2020 676e 6432   # gnd1.    gnd2
-00025e40: 203d 2050 2e61 6464 5f72 6566 2847 6e64   = P.add_ref(Gnd
-00025e50: 3229 0a20 2020 2050 2e61 6464 5f72 6566  2).    P.add_ref
-00025e60: 284e 292e 7920 3d20 7061 6431 2e79 2020  (N).y = pad1.y  
-00025e70: 2320 6e65 7473 0a20 2020 2067 6e64 322e  # nets.    gnd2.
-00025e80: 6365 6e74 6572 203d 2070 6164 322e 6365  center = pad2.ce
-00025e90: 6e74 6572 0a20 2020 2067 6e64 322e 6d6f  nter.    gnd2.mo
-00025ea0: 7665 7828 322e 3529 0a0a 2020 2020 7265  vex(2.5)..    re
-00025eb0: 7475 726e 2050 0a0a 0a23 203d 3d3d 3d3d  turn P...# =====
-00025ec0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00025ed0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00025ee0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00025ef0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00025f00: 3d3d 3d3d 3d3d 3d3d 3d0a 230a 2320 4f70  =========.#.# Op
-00025f10: 7469 6d61 6c20 6375 7272 656e 742d 6372  timal current-cr
-00025f20: 6f77 6469 6e67 2073 7570 6572 636f 6e64  owding supercond
-00025f30: 7563 7469 6e67 2073 7472 7563 7475 7265  ucting structure
-00025f40: 730a 230a 2320 3d3d 3d3d 3d3d 3d3d 3d3d  s.#.# ==========
-00025f50: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00025f60: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00025f70: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00025f80: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00025f90: 3d3d 3d3d 0a0a 0a40 6465 7669 6365 5f6c  ====...@device_l
-00025fa0: 7275 5f63 6163 6865 0a64 6566 206f 7074  ru_cache.def opt
-00025fb0: 696d 616c 5f68 6169 7270 696e 2877 6964  imal_hairpin(wid
-00025fc0: 7468 3d30 2e32 2c20 7069 7463 683d 302e  th=0.2, pitch=0.
-00025fd0: 362c 206c 656e 6774 683d 3130 2c20 7475  6, length=10, tu
-00025fe0: 726e 5f72 6174 696f 3d34 2c20 6e75 6d5f  rn_ratio=4, num_
-00025ff0: 7074 733d 3530 2c20 6c61 7965 723d 3029  pts=50, layer=0)
-00026000: 3a0a 2020 2020 2222 2243 7265 6174 6573  :.    """Creates
-00026010: 2061 6e20 6f70 7469 6d61 6c6c 792d 726f   an optimally-ro
-00026020: 756e 6465 6420 6861 6972 7069 6e20 6765  unded hairpin ge
-00026030: 6f6d 6574 7279 2c20 7769 7468 2061 2031  ometry, with a 1
-00026040: 3830 2064 6567 7265 6520 7475 726e 0a20  80 degree turn. 
-00026050: 2020 206f 6e20 7468 6520 7269 6768 7420     on the right 
-00026060: 656e 6420 6f66 2074 6865 2070 6f6c 7967  end of the polyg
-00026070: 6f6e 2063 6f6e 6e65 6374 6564 2074 6f20  on connected to 
-00026080: 7477 6f20 7072 6f6e 6773 2065 7874 656e  two prongs exten
-00026090: 6469 6e67 2074 6f77 6172 6473 0a20 2020  ding towards.   
-000260a0: 2070 6f72 7473 206f 6e20 7468 6520 6c65   ports on the le
-000260b0: 6674 2065 6e64 2e0a 0a20 2020 2050 6172  ft end...    Par
-000260c0: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
-000260d0: 2d2d 2d2d 2d2d 0a20 2020 2077 6964 7468  ------.    width
-000260e0: 203a 2069 6e74 206f 7220 666c 6f61 740a   : int or float.
-000260f0: 2020 2020 2020 2020 5769 6474 6820 6f66          Width of
-00026100: 2074 6865 2068 6169 7270 696e 206c 6561   the hairpin lea
-00026110: 6473 2e0a 2020 2020 7069 7463 6820 3a20  ds..    pitch : 
-00026120: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
-00026130: 2020 2020 2044 6973 7461 6e63 6520 6265       Distance be
-00026140: 7477 6565 6e20 7468 6520 7477 6f20 6861  tween the two ha
-00026150: 6972 7069 6e20 6c65 6164 732e 204d 7573  irpin leads. Mus
-00026160: 7420 6265 2067 7265 6174 6572 2074 6861  t be greater tha
-00026170: 6e20 7769 6474 682e 0a20 2020 206c 656e  n width..    len
-00026180: 6774 6820 3a20 696e 7420 6f72 2066 6c6f  gth : int or flo
-00026190: 6174 0a20 2020 2020 2020 204c 656e 6774  at.        Lengt
-000261a0: 6820 6f66 2074 6865 2068 6169 7270 696e  h of the hairpin
-000261b0: 2066 726f 6d20 7468 6520 636f 6e6e 6563   from the connec
-000261c0: 746f 7273 2074 6f20 7468 6520 6f70 706f  tors to the oppo
-000261d0: 7369 7465 2065 6e64 206f 6620 7468 650a  site end of the.
-000261e0: 2020 2020 2020 2020 6375 7276 652e 0a20          curve.. 
-000261f0: 2020 2074 7572 6e5f 7261 7469 6f20 3a20     turn_ratio : 
-00026200: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
-00026210: 2020 2020 2053 7065 6369 6669 6573 2068       Specifies h
-00026220: 6f77 206d 7563 6820 6f66 2074 6865 2068  ow much of the h
-00026230: 6169 7270 696e 2069 7320 6465 6469 6361  airpin is dedica
-00026240: 7465 6420 746f 2074 6865 2031 3830 2064  ted to the 180 d
-00026250: 6567 7265 6520 7475 726e 2e0a 2020 2020  egree turn..    
-00026260: 2020 2020 4120 7475 726e 5f72 6174 696f      A turn_ratio
-00026270: 206f 6620 3130 2077 696c 6c20 7265 7375   of 10 will resu
-00026280: 6c74 2069 6e20 3230 2520 6f66 2074 6865  lt in 20% of the
-00026290: 2068 6169 7270 696e 2062 6569 6e67 2063   hairpin being c
-000262a0: 6f6d 7072 6973 6564 206f 6620 7468 6520  omprised of the 
-000262b0: 7475 726e 2e0a 2020 2020 6e75 6d5f 7074  turn..    num_pt
-000262c0: 7320 3a20 696e 740a 2020 2020 2020 2020  s : int.        
-000262d0: 4e75 6d62 6572 206f 6620 706f 696e 7473  Number of points
-000262e0: 2063 6f6e 7374 6974 7574 696e 6720 7468   constituting th
-000262f0: 6520 3138 3020 6465 6772 6565 2074 7572  e 180 degree tur
-00026300: 6e2e 0a20 2020 206c 6179 6572 203a 2069  n..    layer : i
-00026310: 6e74 2c20 6172 7261 792d 6c69 6b65 5b32  nt, array-like[2
-00026320: 5d2c 206f 7220 7365 740a 2020 2020 2020  ], or set.      
-00026330: 2020 5370 6563 6966 6963 206c 6179 6572    Specific layer
-00026340: 2873 2920 746f 2070 7574 2070 6f6c 7967  (s) to put polyg
-00026350: 6f6e 2067 656f 6d65 7472 7920 6f6e 2e0a  on geometry on..
-00026360: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
-00026370: 202d 2d2d 2d2d 2d2d 0a20 2020 2044 203a   -------.    D :
-00026380: 2044 6576 6963 650a 2020 2020 2020 2020   Device.        
-00026390: 4120 4465 7669 6365 2063 6f6e 7461 696e  A Device contain
-000263a0: 696e 6720 616e 206f 7074 696d 616c 6c79  ing an optimally
-000263b0: 2d72 6f75 6e64 6564 2068 6169 7270 696e  -rounded hairpin
-000263c0: 2067 656f 6d65 7472 792e 0a0a 2020 2020   geometry...    
-000263d0: 4e6f 7465 730a 2020 2020 2d2d 2d2d 2d0a  Notes.    -----.
-000263e0: 2020 2020 4861 6972 7069 6e20 7069 7463      Hairpin pitc
-000263f0: 6820 6d75 7374 2062 6520 6772 6561 7465  h must be greate
-00026400: 7220 7468 616e 2077 6964 7468 2e0a 0a20  r than width... 
-00026410: 2020 204f 7074 696d 616c 2073 7472 7563     Optimal struc
-00026420: 7475 7265 2066 726f 6d20 6874 7470 733a  ture from https:
-00026430: 2f2f 646f 692e 6f72 672f 3130 2e31 3130  //doi.org/10.110
-00026440: 332f 5068 7973 5265 7642 2e38 342e 3137  3/PhysRevB.84.17
-00026450: 3435 3130 0a20 2020 2043 6c65 6d2c 204a  4510.    Clem, J
-00026460: 2e2c 2026 2042 6572 6767 7265 6e2c 204b  ., & Berggren, K
-00026470: 2e20 2832 3031 3129 2e20 4765 6f6d 6574  . (2011). Geomet
-00026480: 7279 2d64 6570 656e 6465 6e74 2063 7269  ry-dependent cri
-00026490: 7469 6361 6c20 6375 7272 656e 7473 2069  tical currents i
-000264a0: 6e0a 2020 2020 7375 7065 7263 6f6e 6475  n.    supercondu
-000264b0: 6374 696e 6720 6e61 6e6f 6369 7263 7569  cting nanocircui
-000264c0: 7473 2e20 5068 7973 6963 616c 2052 6576  ts. Physical Rev
-000264d0: 6965 7720 422c 2038 3428 3137 292c 2031  iew B, 84(17), 1
-000264e0: e280 9332 372e 0a20 2020 2022 2222 0a20  ...27..    """. 
-000264f0: 2020 2023 203d 3d3d 3d3d 3d3d 3d3d 3d3d     # ===========
-00026500: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00026510: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00026520: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00026530: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a  ===============.
-00026540: 2020 2020 2320 2043 7265 6174 6520 7468      #  Create th
-00026550: 6520 6261 7369 6320 6765 6f6d 6574 7279  e basic geometry
-00026560: 0a20 2020 2023 203d 3d3d 3d3d 3d3d 3d3d  .    # =========
-00026570: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00026580: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00026590: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000265a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000265b0: 3d0a 2020 2020 6120 3d20 2870 6974 6368  =.    a = (pitch
-000265c0: 202b 2077 6964 7468 2920 2f20 320a 2020   + width) / 2.  
-000265d0: 2020 7920 3d20 2d28 7069 7463 6820 2d20    y = -(pitch - 
-000265e0: 7769 6474 6829 202f 2032 0a20 2020 2078  width) / 2.    x
-000265f0: 203d 202d 7069 7463 680a 2020 2020 646c   = -pitch.    dl
-00026600: 203d 2077 6964 7468 202f 2028 6e75 6d5f   = width / (num_
-00026610: 7074 7320 2a20 3229 0a20 2020 206e 203d  pts * 2).    n =
-00026620: 2030 0a0a 2020 2020 2320 4765 7420 706f   0..    # Get po
-00026630: 696e 7473 206f 6620 6964 6561 6c20 6375  ints of ideal cu
-00026640: 7276 6520 6672 6f6d 2063 6f6e 666f 726d  rve from conform
-00026650: 616c 206d 6170 7069 6e67 0a20 2020 2023  al mapping.    #
-00026660: 2054 4f44 4f20 5468 6973 2069 7320 616e   TODO This is an
-00026670: 2069 6e65 6666 6963 6965 6e74 2077 6179   inefficient way
-00026680: 206f 6620 6669 6e64 696e 6720 706f 696e   of finding poin
-00026690: 7473 2074 6861 7420 796f 7520 6e65 6564  ts that you need
-000266a0: 0a20 2020 2078 7074 7320 3d20 5b78 5d0a  .    xpts = [x].
-000266b0: 2020 2020 7970 7473 203d 205b 795d 0a20      ypts = [y]. 
-000266c0: 2020 2077 6869 6c65 2028 7920 3c20 3029     while (y < 0)
-000266d0: 2026 2028 6e20 3c20 3165 3629 3a0a 2020   & (n < 1e6):.  
-000266e0: 2020 2020 2020 7320 3d20 7820 2b20 316a        s = x + 1j
-000266f0: 202a 2079 0a20 2020 2020 2020 2077 203d   * y.        w =
-00026700: 2073 7172 7428 3120 2d20 6e70 2e65 7870   sqrt(1 - np.exp
-00026710: 2870 6920 2a20 7320 2f20 6129 290a 2020  (pi * s / a)).  
-00026720: 2020 2020 2020 7778 203d 206e 702e 7265        wx = np.re
-00026730: 616c 2877 290a 2020 2020 2020 2020 7779  al(w).        wy
-00026740: 203d 206e 702e 696d 6167 2877 290a 2020   = np.imag(w).  
-00026750: 2020 2020 2020 7778 203d 2077 7820 2f20        wx = wx / 
-00026760: 7371 7274 2877 782a 2a32 202b 2077 792a  sqrt(wx**2 + wy*
-00026770: 2a32 290a 2020 2020 2020 2020 7779 203d  *2).        wy =
-00026780: 2077 7920 2f20 7371 7274 2877 782a 2a32   wy / sqrt(wx**2
-00026790: 202b 2077 792a 2a32 290a 2020 2020 2020   + wy**2).      
-000267a0: 2020 7820 3d20 7820 2b20 7778 202a 2064    x = x + wx * d
-000267b0: 6c0a 2020 2020 2020 2020 7920 3d20 7920  l.        y = y 
-000267c0: 2b20 7779 202a 2064 6c0a 2020 2020 2020  + wy * dl.      
-000267d0: 2020 7870 7473 2e61 7070 656e 6428 7829    xpts.append(x)
-000267e0: 0a20 2020 2020 2020 2079 7074 732e 6170  .        ypts.ap
-000267f0: 7065 6e64 2879 290a 2020 2020 2020 2020  pend(y).        
-00026800: 6e20 3d20 6e20 2b20 310a 2020 2020 7970  n = n + 1.    yp
-00026810: 7473 5b2d 315d 203d 2030 2020 2320 5365  ts[-1] = 0  # Se
-00026820: 7420 6c61 7374 2070 6f69 6e74 2062 6520  t last point be 
-00026830: 6f6e 2074 6865 2078 3d30 2061 7869 7320  on the x=0 axis 
-00026840: 666f 7220 7361 6b65 206f 6620 636c 6561  for sake of clea
-00026850: 6e6c 696e 6573 730a 2020 2020 6473 5f66  nliness.    ds_f
-00026860: 6163 746f 7220 3d20 696e 7428 6c65 6e28  actor = int(len(
-00026870: 7870 7473 2920 2f20 6e75 6d5f 7074 7329  xpts) / num_pts)
-00026880: 2020 2320 446f 776e 7361 6d70 6c65 2074    # Downsample t
-00026890: 6865 2074 6f74 616c 206e 756d 6265 7220  he total number 
-000268a0: 6f66 2070 6f69 6e74 730a 2020 2020 7870  of points.    xp
-000268b0: 7473 203d 2078 7074 735b 3a3a 2d64 735f  ts = xpts[::-ds_
-000268c0: 6661 6374 6f72 5d0a 2020 2020 7870 7473  factor].    xpts
-000268d0: 203d 2078 7074 735b 3a3a 2d31 5d20 2023   = xpts[::-1]  #
-000268e0: 2054 6869 7320 6c6f 6f6b 7320 636f 6e66   This looks conf
-000268f0: 7573 696e 672c 2062 7574 2069 7427 7320  using, but it's 
-00026900: 6a75 7374 2066 6c69 7070 696e 6720 7468  just flipping th
-00026910: 6520 6172 7261 7973 2061 726f 756e 640a  e arrays around.
-00026920: 2020 2020 7970 7473 203d 2079 7074 735b      ypts = ypts[
-00026930: 3a3a 2d64 735f 6661 6374 6f72 5d0a 2020  ::-ds_factor].  
-00026940: 2020 7970 7473 203d 2079 7074 735b 3a3a    ypts = ypts[::
-00026950: 2d31 5d20 2023 2073 6f20 7468 6520 6c61  -1]  # so the la
-00026960: 7374 2070 6f69 6e74 2069 7320 6775 6172  st point is guar
-00026970: 616e 7465 6564 2074 6f20 6265 2069 6e63  anteed to be inc
-00026980: 6c75 6465 6420 7768 656e 2064 6f77 6e73  luded when downs
-00026990: 616d 706c 6564 0a0a 2020 2020 2320 4164  ampled..    # Ad
-000269a0: 6420 706f 696e 7473 2066 6f72 2074 6865  d points for the
-000269b0: 2072 6573 7420 6f66 206d 6561 6e64 6572   rest of meander
-000269c0: 0a20 2020 2078 7074 732e 6170 7065 6e64  .    xpts.append
-000269d0: 2878 7074 735b 2d31 5d20 2b20 7475 726e  (xpts[-1] + turn
-000269e0: 5f72 6174 696f 202a 2077 6964 7468 290a  _ratio * width).
-000269f0: 2020 2020 7970 7473 2e61 7070 656e 6428      ypts.append(
-00026a00: 3029 0a20 2020 2078 7074 732e 6170 7065  0).    xpts.appe
-00026a10: 6e64 2878 7074 735b 2d31 5d29 0a20 2020  nd(xpts[-1]).   
-00026a20: 2079 7074 732e 6170 7065 6e64 282d 6129   ypts.append(-a)
-00026a30: 0a20 2020 2078 7074 732e 6170 7065 6e64  .    xpts.append
-00026a40: 2878 7074 735b 305d 290a 2020 2020 7970  (xpts[0]).    yp
-00026a50: 7473 2e61 7070 656e 6428 2d61 290a 2020  ts.append(-a).  
-00026a60: 2020 7870 7473 2e61 7070 656e 6428 6d61    xpts.append(ma
-00026a70: 7828 7870 7473 2920 2d20 6c65 6e67 7468  x(xpts) - length
-00026a80: 290a 2020 2020 7970 7473 2e61 7070 656e  ).    ypts.appen
-00026a90: 6428 2d61 290a 2020 2020 7870 7473 2e61  d(-a).    xpts.a
-00026aa0: 7070 656e 6428 7870 7473 5b2d 315d 290a  ppend(xpts[-1]).
-00026ab0: 2020 2020 7970 7473 2e61 7070 656e 6428      ypts.append(
-00026ac0: 2d61 202b 2077 6964 7468 290a 2020 2020  -a + width).    
-00026ad0: 7870 7473 2e61 7070 656e 6428 7870 7473  xpts.append(xpts
-00026ae0: 5b30 5d29 0a20 2020 2079 7074 732e 6170  [0]).    ypts.ap
-00026af0: 7065 6e64 2879 7074 735b 305d 290a 0a20  pend(ypts[0]).. 
-00026b00: 2020 2078 7074 7320 3d20 6e70 2e61 7272     xpts = np.arr
-00026b10: 6179 2878 7074 7329 0a20 2020 2079 7074  ay(xpts).    ypt
-00026b20: 7320 3d20 6e70 2e61 7272 6179 2879 7074  s = np.array(ypt
-00026b30: 7329 0a0a 2020 2020 2320 3d3d 3d3d 3d3d  s)..    # ======
-00026b40: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00026b50: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00026b60: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00026b70: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00026b80: 3d3d 3d3d 0a20 2020 2023 2020 4372 6561  ====.    #  Crea
-00026b90: 7465 2061 2062 6c61 6e6b 2064 6576 6963  te a blank devic
-00026ba0: 652c 2061 6464 2074 6865 2067 656f 6d65  e, add the geome
-00026bb0: 7472 792c 2061 6e64 2064 6566 696e 6520  try, and define 
-00026bc0: 7468 6520 706f 7274 730a 2020 2020 2320  the ports.    # 
-00026bd0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00026be0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00026bf0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00026c00: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00026c10: 3d3d 3d3d 3d3d 3d3d 3d3d 0a20 2020 2044  ==========.    D
-00026c20: 203d 2044 6576 6963 6528 6e61 6d65 3d22   = Device(name="
-00026c30: 6861 6972 7069 6e22 290a 2020 2020 442e  hairpin").    D.
-00026c40: 6164 645f 706f 6c79 676f 6e28 5b78 7074  add_polygon([xpt
-00026c50: 732c 2079 7074 735d 2c20 6c61 7965 723d  s, ypts], layer=
-00026c60: 6c61 7965 7229 0a20 2020 2044 2e61 6464  layer).    D.add
-00026c70: 5f70 6f6c 7967 6f6e 285b 7870 7473 2c20  _polygon([xpts, 
-00026c80: 2d79 7074 735d 2c20 6c61 7965 723d 6c61  -ypts], layer=la
-00026c90: 7965 7229 0a0a 2020 2020 7870 6f72 7473  yer)..    xports
-00026ca0: 203d 206d 696e 2878 7074 7329 0a20 2020   = min(xpts).   
-00026cb0: 2079 706f 7274 7320 3d20 2d61 202b 2077   yports = -a + w
-00026cc0: 6964 7468 202f 2032 0a20 2020 2044 2e61  idth / 2.    D.a
-00026cd0: 6464 5f70 6f72 7428 6e61 6d65 3d31 2c20  dd_port(name=1, 
-00026ce0: 6d69 6470 6f69 6e74 3d5b 7870 6f72 7473  midpoint=[xports
-00026cf0: 2c20 2d79 706f 7274 735d 2c20 7769 6474  , -yports], widt
-00026d00: 683d 7769 6474 682c 206f 7269 656e 7461  h=width, orienta
-00026d10: 7469 6f6e 3d31 3830 290a 2020 2020 442e  tion=180).    D.
-00026d20: 6164 645f 706f 7274 286e 616d 653d 322c  add_port(name=2,
-00026d30: 206d 6964 706f 696e 743d 5b78 706f 7274   midpoint=[xport
-00026d40: 732c 2079 706f 7274 735d 2c20 7769 6474  s, yports], widt
-00026d50: 683d 7769 6474 682c 206f 7269 656e 7461  h=width, orienta
-00026d60: 7469 6f6e 3d31 3830 290a 0a20 2020 2072  tion=180)..    r
-00026d70: 6574 7572 6e20 440a 0a0a 4064 6576 6963  eturn D...@devic
-00026d80: 655f 6c72 755f 6361 6368 650a 6465 6620  e_lru_cache.def 
-00026d90: 6f70 7469 6d61 6c5f 7374 6570 280a 2020  optimal_step(.  
-00026da0: 2020 7374 6172 745f 7769 6474 683d 3130    start_width=10
-00026db0: 2c0a 2020 2020 656e 645f 7769 6474 683d  ,.    end_width=
-00026dc0: 3232 2c0a 2020 2020 6e75 6d5f 7074 733d  22,.    num_pts=
-00026dd0: 3530 2c0a 2020 2020 7769 6474 685f 746f  50,.    width_to
-00026de0: 6c3d 3165 2d33 2c0a 2020 2020 616e 7469  l=1e-3,.    anti
-00026df0: 6372 6f77 6469 6e67 5f66 6163 746f 723d  crowding_factor=
-00026e00: 312e 322c 0a20 2020 2073 796d 6d65 7472  1.2,.    symmetr
-00026e10: 6963 3d46 616c 7365 2c0a 2020 2020 6c61  ic=False,.    la
-00026e20: 7965 723d 302c 0a29 3a0a 2020 2020 2222  yer=0,.):.    ""
-00026e30: 2243 7265 6174 6573 2061 6e20 6f70 7469  "Creates an opti
-00026e40: 6d61 6c6c 792d 726f 756e 6465 6420 7374  mally-rounded st
-00026e50: 6570 2067 656f 6d65 7472 792e 0a0a 2020  ep geometry...  
-00026e60: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00026e70: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00026e80: 7374 6172 745f 7769 6474 6820 3a20 696e  start_width : in
-00026e90: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
-00026ea0: 2020 2057 6964 7468 206f 6620 7468 6520     Width of the 
-00026eb0: 636f 6e6e 6563 746f 7220 6f6e 2074 6865  connector on the
-00026ec0: 206c 6566 7420 656e 6420 6f66 2074 6865   left end of the
-00026ed0: 2073 7465 702e 0a20 2020 2065 6e64 5f77   step..    end_w
-00026ee0: 6964 7468 203a 2069 6e74 206f 7220 666c  idth : int or fl
-00026ef0: 6f61 740a 2020 2020 2020 2020 5769 6474  oat.        Widt
-00026f00: 6820 6f66 2074 6865 2063 6f6e 6e65 6374  h of the connect
-00026f10: 6f72 206f 6e20 7468 6520 7269 6768 7420  or on the right 
-00026f20: 656e 6420 6f66 2074 6865 2073 7465 702e  end of the step.
-00026f30: 0a20 2020 206e 756d 5f70 7473 203a 2069  .    num_pts : i
-00026f40: 6e74 0a20 2020 2020 2020 2054 6865 206e  nt.        The n
-00026f50: 756d 6265 7220 6f66 2070 6f69 6e74 7320  umber of points 
-00026f60: 636f 6d70 7269 7369 6e67 2074 6865 2065  comprising the e
-00026f70: 6e74 6972 6520 7374 6570 2067 656f 6d65  ntire step geome
-00026f80: 7472 792e 0a20 2020 2077 6964 7468 5f74  try..    width_t
-00026f90: 6f6c 203a 2066 6c6f 6174 0a20 2020 2020  ol : float.     
-00026fa0: 2020 2050 6f69 6e74 2061 7420 7768 6963     Point at whic
-00026fb0: 6820 746f 2074 6572 6d69 6e61 7465 2074  h to terminate t
-00026fc0: 6865 2063 616c 6375 6c61 7469 6f6e 206f  he calculation o
-00026fd0: 6620 7468 6520 6f70 7469 6d61 6c20 7374  f the optimal st
-00026fe0: 6570 0a20 2020 2061 6e74 6963 726f 7764  ep.    anticrowd
-00026ff0: 696e 675f 6661 6374 6f72 203a 2069 6e74  ing_factor : int
-00027000: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
-00027010: 2020 4661 6374 6f72 2074 6f20 7265 6475    Factor to redu
-00027020: 6365 2063 7572 7265 6e74 2063 726f 7764  ce current crowd
-00027030: 696e 6720 6279 2065 6c6f 6e67 6174 696e  ing by elongatin
-00027040: 670a 2020 2020 2020 2020 7468 6520 7374  g.        the st
-00027050: 7275 6374 7572 6520 616e 6420 7265 6475  ructure and redu
-00027060: 6369 6e67 2074 6865 2063 7572 7661 7475  cing the curvatu
-00027070: 7265 0a20 2020 2073 796d 6d65 7472 6963  re.    symmetric
-00027080: 203a 2062 6f6f 6c0a 2020 2020 2020 2020   : bool.        
-00027090: 4966 2054 7275 652c 2061 6464 7320 6120  If True, adds a 
-000270a0: 6d69 7272 6f72 6564 2063 6f70 7920 6f66  mirrored copy of
-000270b0: 2074 6865 2073 7465 7020 6163 726f 7373   the step across
-000270c0: 2074 6865 2078 2d61 7869 7320 746f 2074   the x-axis to t
-000270d0: 6865 0a20 2020 2020 2020 2067 656f 6d65  he.        geome
-000270e0: 7472 7920 616e 6420 6164 6a75 7374 7320  try and adjusts 
-000270f0: 7468 6520 7769 6474 6820 6f66 2074 6865  the width of the
-00027100: 2070 6f72 7473 2e0a 2020 2020 6c61 7965   ports..    laye
-00027110: 7220 3a20 696e 742c 2061 7272 6179 2d6c  r : int, array-l
-00027120: 696b 655b 325d 2c20 6f72 2073 6574 0a20  ike[2], or set. 
-00027130: 2020 2020 2020 2053 7065 6369 6669 6320         Specific 
-00027140: 6c61 7965 7228 7329 2074 6f20 7075 7420  layer(s) to put 
-00027150: 706f 6c79 676f 6e20 6765 6f6d 6574 7279  polygon geometry
-00027160: 206f 6e2e 0a0a 2020 2020 5265 7475 726e   on...    Return
-00027170: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-00027180: 2020 4420 3a20 4465 7669 6365 0a20 2020    D : Device.   
-00027190: 2020 2020 2041 2044 6576 6963 6520 636f       A Device co
-000271a0: 6e74 6169 6e69 6e67 2061 6e20 6f70 7469  ntaining an opti
-000271b0: 6d61 6c6c 792d 726f 756e 6465 6420 7374  mally-rounded st
-000271c0: 6570 2e0a 0a20 2020 204e 6f74 6573 0a20  ep...    Notes. 
-000271d0: 2020 202d 2d2d 2d2d 0a20 2020 204f 7074     -----.    Opt
-000271e0: 696d 616c 2073 7472 7563 7475 7265 2066  imal structure f
-000271f0: 726f 6d20 6874 7470 733a 2f2f 646f 692e  rom https://doi.
-00027200: 6f72 672f 3130 2e31 3130 332f 5068 7973  org/10.1103/Phys
-00027210: 5265 7642 2e38 342e 3137 3435 3130 0a20  RevB.84.174510. 
-00027220: 2020 2043 6c65 6d2c 204a 2e2c 2026 2042     Clem, J., & B
-00027230: 6572 6767 7265 6e2c 204b 2e20 2832 3031  erggren, K. (201
-00027240: 3129 2e20 4765 6f6d 6574 7279 2d64 6570  1). Geometry-dep
-00027250: 656e 6465 6e74 2063 7269 7469 6361 6c20  endent critical 
-00027260: 6375 7272 656e 7473 2069 6e0a 2020 2020  currents in.    
-00027270: 7375 7065 7263 6f6e 6475 6374 696e 6720  superconducting 
-00027280: 6e61 6e6f 6369 7263 7569 7473 2e20 5068  nanocircuits. Ph
-00027290: 7973 6963 616c 2052 6576 6965 7720 422c  ysical Review B,
-000272a0: 2038 3428 3137 292c 2031 e280 9332 372e   84(17), 1...27.
-000272b0: 0a20 2020 2022 2222 0a20 2020 2023 203d  .    """.    # =
-000272c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000272d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000272e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000272f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00027300: 3d3d 3d3d 3d3d 3d3d 3d0a 2020 2020 2320  =========.    # 
-00027310: 2043 7265 6174 6520 7468 6520 6261 7369   Create the basi
-00027320: 6320 6765 6f6d 6574 7279 0a20 2020 2023  c geometry.    #
-00027330: 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d   ===============
-00027340: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00027350: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00027360: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00027370: 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 2020 2020  ===========.    
-00027380: 6465 6620 7374 6570 5f70 6f69 6e74 7328  def step_points(
-00027390: 6574 612c 2057 2c20 6129 3a0a 2020 2020  eta, W, a):.    
-000273a0: 2020 2020 2320 5265 7475 726e 7320 706f      # Returns po
-000273b0: 696e 7473 2066 726f 6d20 6120 756e 6974  ints from a unit
-000273c0: 2073 656d 6963 6972 636c 6520 696e 2074   semicircle in t
-000273d0: 6865 2077 2028 3d20 7520 2b20 6976 2920  he w (= u + iv) 
-000273e0: 706c 616e 6520 746f 0a20 2020 2020 2020  plane to.       
-000273f0: 2023 2074 6865 206f 7074 696d 616c 2063   # the optimal c
-00027400: 7572 7665 2069 6e20 7468 6520 7a65 7461  urve in the zeta
-00027410: 2028 3d20 7820 2b20 6979 2920 706c 616e   (= x + iy) plan
-00027420: 6520 7768 6963 6820 7472 616e 7369 7469  e which transiti
-00027430: 6f6e 730a 2020 2020 2020 2020 2320 6120  ons.        # a 
-00027440: 7769 7265 2066 726f 6d20 6120 7769 6474  wire from a widt
-00027450: 6820 6f66 2027 5727 2074 6f20 6120 7769  h of 'W' to a wi
-00027460: 6474 6820 6f66 2027 6127 0a20 2020 2020  dth of 'a'.     
-00027470: 2020 2023 2065 7461 2074 616b 6573 2076     # eta takes v
-00027480: 616c 7565 2030 2074 6f20 7069 0a0a 2020  alue 0 to pi..  
-00027490: 2020 2020 2020 5720 3d20 6e70 2e61 7272        W = np.arr
-000274a0: 6179 2857 2c20 6474 7970 653d 636f 6d70  ay(W, dtype=comp
-000274b0: 6c65 7829 0a20 2020 2020 2020 2061 203d  lex).        a =
-000274c0: 206e 702e 6172 7261 7928 612c 2064 7479   np.array(a, dty
-000274d0: 7065 3d63 6f6d 706c 6578 290a 0a20 2020  pe=complex)..   
-000274e0: 2020 2020 2067 616d 6d61 203d 2028 6120       gamma = (a 
-000274f0: 2a20 6120 2b20 5720 2a20 5729 202f 2028  * a + W * W) / (
-00027500: 6120 2a20 6120 2d20 5720 2a20 5729 0a0a  a * a - W * W)..
-00027510: 2020 2020 2020 2020 7720 3d20 6e70 2e65          w = np.e
-00027520: 7870 2831 6a20 2a20 6574 6129 0a0a 2020  xp(1j * eta)..  
-00027530: 2020 2020 2020 7a65 7461 203d 2028 0a20        zeta = (. 
-00027540: 2020 2020 2020 2020 2020 2034 0a20 2020             4.   
-00027550: 2020 2020 2020 2020 202a 2031 6a0a 2020           * 1j.  
-00027560: 2020 2020 2020 2020 2020 2f20 7069 0a20            / pi. 
-00027570: 2020 2020 2020 2020 2020 202a 2028 0a20             * (. 
-00027580: 2020 2020 2020 2020 2020 2020 2020 2057                 W
-00027590: 202a 206e 702e 6172 6374 616e 2873 7172   * np.arctan(sqr
-000275a0: 7428 2877 202d 2067 616d 6d61 2920 2f20  t((w - gamma) / 
-000275b0: 2867 616d 6d61 202b 2031 2929 290a 2020  (gamma + 1))).  
-000275c0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-000275d0: 6120 2a20 6e70 2e61 7263 7461 6e28 7371  a * np.arctan(sq
-000275e0: 7274 2828 6761 6d6d 6120 2d20 3129 202f  rt((gamma - 1) /
-000275f0: 2028 7720 2d20 6761 6d6d 6129 2929 0a20   (w - gamma))). 
-00027600: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00027610: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00027620: 7820 3d20 6e70 2e72 6561 6c28 7a65 7461  x = np.real(zeta
-00027630: 290a 2020 2020 2020 2020 7920 3d20 6e70  ).        y = np
-00027640: 2e69 6d61 6728 7a65 7461 290a 2020 2020  .imag(zeta).    
-00027650: 2020 2020 7265 7475 726e 2078 2c20 790a      return x, y.
-00027660: 0a20 2020 2064 6566 2069 6e76 6572 745f  .    def invert_
-00027670: 7374 6570 5f70 6f69 6e74 2878 5f64 6573  step_point(x_des
-00027680: 6972 6564 3d2d 3130 2c20 795f 6465 7369  ired=-10, y_desi
-00027690: 7265 643d 4e6f 6e65 2c20 573d 312c 2061  red=None, W=1, a
-000276a0: 3d32 293a 0a20 2020 2020 2020 2023 2046  =2):.        # F
-000276b0: 696e 6473 2074 6865 2065 7461 2061 7373  inds the eta ass
-000276c0: 6f63 6961 7465 6420 7769 7468 2074 6865  ociated with the
-000276d0: 2076 616c 7565 2078 5f64 6573 6972 6564   value x_desired
-000276e0: 2061 6c6f 6e67 2074 6865 0a20 2020 2020   along the.     
-000276f0: 2020 2023 206f 7074 696d 616c 2063 7572     # optimal cur
-00027700: 7665 0a20 2020 2020 2020 2064 6566 2066  ve.        def f
-00027710: 6828 6574 6129 3a0a 2020 2020 2020 2020  h(eta):.        
-00027720: 2020 2020 6775 6573 7365 645f 782c 2067      guessed_x, g
-00027730: 7565 7373 6564 5f79 203d 2073 7465 705f  uessed_y = step_
-00027740: 706f 696e 7473 2865 7461 2c20 573d 572c  points(eta, W=W,
-00027750: 2061 3d61 290a 2020 2020 2020 2020 2020   a=a).          
-00027760: 2020 6966 2079 5f64 6573 6972 6564 2069    if y_desired i
-00027770: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00027780: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-00027790: 6775 6573 7365 645f 7820 2d20 785f 6465  guessed_x - x_de
-000277a0: 7369 7265 6429 202a 2a20 3220 2023 2054  sired) ** 2  # T
-000277b0: 6865 2065 7272 6f72 0a20 2020 2020 2020  he error.       
-000277c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000277d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000277e0: 6e20 2867 7565 7373 6564 5f79 202d 2079  n (guessed_y - y
-000277f0: 5f64 6573 6972 6564 2920 2a2a 2032 0a0a  _desired) ** 2..
-00027800: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00027810: 2020 2020 2020 2020 2066 726f 6d20 7363           from sc
-00027820: 6970 792e 6f70 7469 6d69 7a65 2069 6d70  ipy.optimize imp
-00027830: 6f72 7420 666d 696e 626f 756e 640a 2020  ort fminbound.  
-00027840: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00027850: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-00027860: 2020 2020 7261 6973 6520 496d 706f 7274      raise Import
-00027870: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00027880: 2020 2020 2020 2022 205b 5048 4944 4c5d         " [PHIDL]
-00027890: 2054 6f20 7275 6e20 7468 6520 6f70 7469   To run the opti
-000278a0: 6d61 6c2d 6375 7276 6520 6765 6f6d 6574  mal-curve geomet
-000278b0: 7279 2022 0a20 2020 2020 2020 2020 2020  ry ".           
-000278c0: 2020 2020 2022 6675 6e63 7469 6f6e 7320       "functions 
-000278d0: 796f 7520 6e65 6564 2073 6369 7079 2c20  you need scipy, 
-000278e0: 706c 6561 7365 2069 6e73 7461 6c6c 2022  please install "
-000278f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027900: 2022 6974 2077 6974 6820 6070 6970 2069   "it with `pip i
-00027910: 6e73 7461 6c6c 2073 6369 7079 6022 0a20  nstall scipy`". 
-00027920: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00027930: 2020 2020 2066 6f75 6e64 5f65 7461 203d       found_eta =
-00027940: 2066 6d69 6e62 6f75 6e64 2866 682c 2078   fminbound(fh, x
-00027950: 313d 302c 2078 323d 7069 2c20 6172 6773  1=0, x2=pi, args
-00027960: 3d28 2929 0a20 2020 2020 2020 2072 6574  =()).        ret
-00027970: 7572 6e20 7374 6570 5f70 6f69 6e74 7328  urn step_points(
-00027980: 666f 756e 645f 6574 612c 2057 3d57 2c20  found_eta, W=W, 
-00027990: 613d 6129 0a0a 2020 2020 6966 2073 7461  a=a)..    if sta
-000279a0: 7274 5f77 6964 7468 203e 2065 6e64 5f77  rt_width > end_w
-000279b0: 6964 7468 3a0a 2020 2020 2020 2020 7265  idth:.        re
-000279c0: 7665 7273 6520 3d20 5472 7565 0a20 2020  verse = True.   
-000279d0: 2020 2020 2073 7461 7274 5f77 6964 7468       start_width
-000279e0: 2c20 656e 645f 7769 6474 6820 3d20 656e  , end_width = en
-000279f0: 645f 7769 6474 682c 2073 7461 7274 5f77  d_width, start_w
-00027a00: 6964 7468 0a20 2020 2065 6c73 653a 0a20  idth.    else:. 
-00027a10: 2020 2020 2020 2072 6576 6572 7365 203d         reverse =
-00027a20: 2046 616c 7365 0a0a 2020 2020 4420 3d20   False..    D = 
-00027a30: 4465 7669 6365 286e 616d 653d 2273 7465  Device(name="ste
-00027a40: 7022 290a 2020 2020 6966 2073 7461 7274  p").    if start
-00027a50: 5f77 6964 7468 203d 3d20 656e 645f 7769  _width == end_wi
-00027a60: 6474 683a 2020 2320 4a75 7374 2072 6574  dth:  # Just ret
-00027a70: 7572 6e20 6120 7371 7561 7265 0a20 2020  urn a square.   
-00027a80: 2020 2020 2069 6620 7379 6d6d 6574 7269       if symmetri
-00027a90: 633a 0a20 2020 2020 2020 2020 2020 2079  c:.            y
-00027aa0: 7074 7320 3d20 5b0a 2020 2020 2020 2020  pts = [.        
-00027ab0: 2020 2020 2020 2020 2d73 7461 7274 5f77          -start_w
-00027ac0: 6964 7468 202f 2032 2c0a 2020 2020 2020  idth / 2,.      
-00027ad0: 2020 2020 2020 2020 2020 7374 6172 745f            start_
-00027ae0: 7769 6474 6820 2f20 322c 0a20 2020 2020  width / 2,.     
-00027af0: 2020 2020 2020 2020 2020 2073 7461 7274             start
-00027b00: 5f77 6964 7468 202f 2032 2c0a 2020 2020  _width / 2,.    
-00027b10: 2020 2020 2020 2020 2020 2020 2d73 7461              -sta
-00027b20: 7274 5f77 6964 7468 202f 2032 2c0a 2020  rt_width / 2,.  
-00027b30: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
-00027b40: 2020 2020 2020 2020 7870 7473 203d 205b          xpts = [
-00027b50: 302c 2030 2c20 7374 6172 745f 7769 6474  0, 0, start_widt
-00027b60: 682c 2073 7461 7274 5f77 6964 7468 5d0a  h, start_width].
-00027b70: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00027b80: 796d 6d65 7472 6963 3a0a 2020 2020 2020  ymmetric:.      
-00027b90: 2020 2020 2020 7970 7473 203d 205b 302c        ypts = [0,
-00027ba0: 2073 7461 7274 5f77 6964 7468 2c20 7374   start_width, st
-00027bb0: 6172 745f 7769 6474 682c 2030 5d0a 2020  art_width, 0].  
-00027bc0: 2020 2020 2020 2020 2020 7870 7473 203d            xpts =
-00027bd0: 205b 302c 2030 2c20 7374 6172 745f 7769   [0, 0, start_wi
-00027be0: 6474 682c 2073 7461 7274 5f77 6964 7468  dth, start_width
-00027bf0: 5d0a 2020 2020 2020 2020 442e 696e 666f  ].        D.info
-00027c00: 5b22 6e75 6d5f 7371 7561 7265 7322 5d20  ["num_squares"] 
-00027c10: 3d20 310a 2020 2020 656c 7365 3a0a 2020  = 1.    else:.  
-00027c20: 2020 2020 2020 786d 696e 2c20 796d 696e        xmin, ymin
-00027c30: 203d 2069 6e76 6572 745f 7374 6570 5f70   = invert_step_p
-00027c40: 6f69 6e74 280a 2020 2020 2020 2020 2020  oint(.          
-00027c50: 2020 795f 6465 7369 7265 643d 7374 6172    y_desired=star
-00027c60: 745f 7769 6474 6820 2a20 2831 202b 2077  t_width * (1 + w
-00027c70: 6964 7468 5f74 6f6c 292c 2057 3d73 7461  idth_tol), W=sta
-00027c80: 7274 5f77 6964 7468 2c20 613d 656e 645f  rt_width, a=end_
-00027c90: 7769 6474 680a 2020 2020 2020 2020 290a  width.        ).
-00027ca0: 2020 2020 2020 2020 786d 6178 2c20 796d          xmax, ym
-00027cb0: 6178 203d 2069 6e76 6572 745f 7374 6570  ax = invert_step
-00027cc0: 5f70 6f69 6e74 280a 2020 2020 2020 2020  _point(.        
-00027cd0: 2020 2020 795f 6465 7369 7265 643d 656e      y_desired=en
-00027ce0: 645f 7769 6474 6820 2a20 2831 202d 2077  d_width * (1 - w
-00027cf0: 6964 7468 5f74 6f6c 292c 2057 3d73 7461  idth_tol), W=sta
-00027d00: 7274 5f77 6964 7468 2c20 613d 656e 645f  rt_width, a=end_
-00027d10: 7769 6474 680a 2020 2020 2020 2020 290a  width.        ).
-00027d20: 0a20 2020 2020 2020 2078 7074 7320 3d20  .        xpts = 
-00027d30: 6e70 2e6c 696e 7370 6163 6528 786d 696e  np.linspace(xmin
-00027d40: 2c20 786d 6178 2c20 6e75 6d5f 7074 7329  , xmax, num_pts)
-00027d50: 2e74 6f6c 6973 7428 290a 2020 2020 2020  .tolist().      
-00027d60: 2020 7970 7473 203d 205b 5d0a 2020 2020    ypts = [].    
-00027d70: 2020 2020 666f 7220 7820 696e 2078 7074      for x in xpt
-00027d80: 733a 0a20 2020 2020 2020 2020 2020 2078  s:.            x
-00027d90: 2c20 7920 3d20 696e 7665 7274 5f73 7465  , y = invert_ste
-00027da0: 705f 706f 696e 7428 785f 6465 7369 7265  p_point(x_desire
-00027db0: 643d 782c 2057 3d73 7461 7274 5f77 6964  d=x, W=start_wid
-00027dc0: 7468 2c20 613d 656e 645f 7769 6474 6829  th, a=end_width)
-00027dd0: 0a20 2020 2020 2020 2020 2020 2079 7074  .            ypt
-00027de0: 732e 6170 7065 6e64 2879 290a 0a20 2020  s.append(y)..   
-00027df0: 2020 2020 2079 7074 735b 2d31 5d20 3d20       ypts[-1] = 
-00027e00: 656e 645f 7769 6474 680a 2020 2020 2020  end_width.      
-00027e10: 2020 7970 7473 5b30 5d20 3d20 7374 6172    ypts[0] = star
-00027e20: 745f 7769 6474 680a 2020 2020 2020 2020  t_width.        
-00027e30: 795f 6e75 6d5f 7371 203d 206e 702e 6172  y_num_sq = np.ar
-00027e40: 7261 7928 7970 7473 290a 2020 2020 2020  ray(ypts).      
-00027e50: 2020 785f 6e75 6d5f 7371 203d 206e 702e    x_num_sq = np.
-00027e60: 6172 7261 7928 7870 7473 290a 0a20 2020  array(xpts)..   
-00027e70: 2020 2020 2069 6620 6e6f 7420 7379 6d6d       if not symm
-00027e80: 6574 7269 633a 0a20 2020 2020 2020 2020  etric:.         
-00027e90: 2020 2078 7074 732e 6170 7065 6e64 2878     xpts.append(x
-00027ea0: 7074 735b 2d31 5d29 0a20 2020 2020 2020  pts[-1]).       
-00027eb0: 2020 2020 2079 7074 732e 6170 7065 6e64       ypts.append
-00027ec0: 2830 290a 2020 2020 2020 2020 2020 2020  (0).            
-00027ed0: 7870 7473 2e61 7070 656e 6428 7870 7473  xpts.append(xpts
-00027ee0: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
-00027ef0: 2079 7074 732e 6170 7065 6e64 2830 290a   ypts.append(0).
-00027f00: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00027f10: 2020 2020 2020 2020 2020 7870 7473 202b            xpts +
-00027f20: 3d20 5b78 2066 6f72 2078 2069 6e20 7870  = [x for x in xp
-00027f30: 7473 5b3a 3a2d 315d 5d0a 2020 2020 2020  ts[::-1]].      
-00027f40: 2020 2020 2020 7970 7473 202b 3d20 5b2d        ypts += [-
-00027f50: 7920 666f 7220 7920 696e 2079 7074 735b  y for y in ypts[
-00027f60: 3a3a 2d31 5d5d 0a20 2020 2020 2020 2020  ::-1]].         
-00027f70: 2020 2078 7074 7320 3d20 5b78 202f 2032     xpts = [x / 2
-00027f80: 2066 6f72 2078 2069 6e20 7870 7473 5d0a   for x in xpts].
-00027f90: 2020 2020 2020 2020 2020 2020 7970 7473              ypts
-00027fa0: 203d 205b 7920 2f20 3220 666f 7220 7920   = [y / 2 for y 
-00027fb0: 696e 2079 7074 735d 0a0a 2020 2020 2020  in ypts]..      
-00027fc0: 2020 2320 616e 7469 6372 6f77 6469 6e67    # anticrowding
-00027fd0: 5f66 6163 746f 7220 7374 7265 7463 6865  _factor stretche
-00027fe0: 7320 7468 6520 7769 7265 206f 7574 3b20  s the wire out; 
-00027ff0: 6120 7374 7265 7463 6865 6420 7769 7265  a stretched wire
-00028000: 2069 7320 610a 2020 2020 2020 2020 2320   is a.        # 
-00028010: 6765 6e74 6c65 7220 7472 616e 7369 7469  gentler transiti
-00028020: 6f6e 2c20 736f 2074 6865 7265 2773 206c  on, so there's l
-00028030: 6573 7320 6368 616e 6365 206f 6620 6375  ess chance of cu
-00028040: 7272 656e 7420 6372 6f77 6469 6e67 2069  rrent crowding i
-00028050: 660a 2020 2020 2020 2020 2320 7468 6520  f.        # the 
-00028060: 6661 6272 6963 6174 696f 6e20 6973 6e27  fabrication isn'
-00028070: 7420 7065 7266 6563 7420 6275 7420 6173  t perfect but as
-00028080: 2061 2072 6573 756c 742c 2074 6865 2077   a result, the w
-00028090: 6972 6520 6973 6e27 7420 6173 0a20 2020  ire isn't as.   
-000280a0: 2020 2020 2023 2073 686f 7274 2061 7320       # short as 
-000280b0: 6974 2063 6f75 6c64 2062 650a 2020 2020  it could be.    
-000280c0: 2020 2020 7870 7473 203d 2028 6e70 2e61      xpts = (np.a
-000280d0: 7272 6179 2878 7074 7329 202a 2061 6e74  rray(xpts) * ant
-000280e0: 6963 726f 7764 696e 675f 6661 6374 6f72  icrowding_factor
-000280f0: 292e 746f 6c69 7374 2829 0a0a 2020 2020  ).tolist()..    
-00028100: 2020 2020 6966 2072 6576 6572 7365 2069      if reverse i
-00028110: 7320 5472 7565 3a0a 2020 2020 2020 2020  s True:.        
-00028120: 2020 2020 7870 7473 203d 2028 2d6e 702e      xpts = (-np.
-00028130: 6172 7261 7928 7870 7473 2929 2e74 6f6c  array(xpts)).tol
-00028140: 6973 7428 290a 2020 2020 2020 2020 2020  ist().          
-00028150: 2020 7374 6172 745f 7769 6474 682c 2065    start_width, e
-00028160: 6e64 5f77 6964 7468 203d 2065 6e64 5f77  nd_width = end_w
-00028170: 6964 7468 2c20 7374 6172 745f 7769 6474  idth, start_widt
-00028180: 680a 0a20 2020 2020 2020 2044 2e69 6e66  h..        D.inf
-00028190: 6f5b 226e 756d 5f73 7175 6172 6573 225d  o["num_squares"]
-000281a0: 203d 206e 702e 7375 6d28 0a20 2020 2020   = np.sum(.     
-000281b0: 2020 2020 2020 206e 702e 6469 6666 2878         np.diff(x
-000281c0: 5f6e 756d 5f73 7129 202f 2028 2879 5f6e  _num_sq) / ((y_n
-000281d0: 756d 5f73 715b 3a2d 315d 202b 2079 5f6e  um_sq[:-1] + y_n
-000281e0: 756d 5f73 715b 313a 5d29 202f 2032 290a  um_sq[1:]) / 2).
-000281f0: 2020 2020 2020 2020 290a 0a20 2020 2023          )..    #
-00028200: 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d   ===============
-00028210: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028220: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028230: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028240: 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 2020 2020  ===========.    
-00028250: 2320 2043 7265 6174 6520 6120 626c 616e  #  Create a blan
-00028260: 6b20 6465 7669 6365 2c20 6164 6420 7468  k device, add th
-00028270: 6520 6765 6f6d 6574 7279 2c20 616e 6420  e geometry, and 
-00028280: 6465 6669 6e65 2074 6865 2070 6f72 7473  define the ports
-00028290: 0a20 2020 2023 203d 3d3d 3d3d 3d3d 3d3d  .    # =========
-000282a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000282b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000282c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000282d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000282e0: 3d0a 2020 2020 442e 6164 645f 706f 6c79  =.    D.add_poly
-000282f0: 676f 6e28 5b78 7074 732c 2079 7074 735d  gon([xpts, ypts]
-00028300: 2c20 6c61 7965 723d 6c61 7965 7229 0a0a  , layer=layer)..
-00028310: 2020 2020 6966 206e 6f74 2073 796d 6d65      if not symme
-00028320: 7472 6963 3a0a 2020 2020 2020 2020 442e  tric:.        D.
-00028330: 6164 645f 706f 7274 280a 2020 2020 2020  add_port(.      
-00028340: 2020 2020 2020 6e61 6d65 3d31 2c0a 2020        name=1,.  
-00028350: 2020 2020 2020 2020 2020 6d69 6470 6f69            midpoi
-00028360: 6e74 3d5b 6d69 6e28 7870 7473 292c 2073  nt=[min(xpts), s
-00028370: 7461 7274 5f77 6964 7468 202f 2032 5d2c  tart_width / 2],
-00028380: 0a20 2020 2020 2020 2020 2020 2077 6964  .            wid
-00028390: 7468 3d73 7461 7274 5f77 6964 7468 2c0a  th=start_width,.
-000283a0: 2020 2020 2020 2020 2020 2020 6f72 6965              orie
-000283b0: 6e74 6174 696f 6e3d 3138 302c 0a20 2020  ntation=180,.   
-000283c0: 2020 2020 2029 0a20 2020 2020 2020 2044       ).        D
-000283d0: 2e61 6464 5f70 6f72 7428 0a20 2020 2020  .add_port(.     
-000283e0: 2020 2020 2020 206e 616d 653d 322c 206d         name=2, m
-000283f0: 6964 706f 696e 743d 5b6d 6178 2878 7074  idpoint=[max(xpt
-00028400: 7329 2c20 656e 645f 7769 6474 6820 2f20  s), end_width / 
-00028410: 325d 2c20 7769 6474 683d 656e 645f 7769  2], width=end_wi
-00028420: 6474 682c 206f 7269 656e 7461 7469 6f6e  dth, orientation
-00028430: 3d30 0a20 2020 2020 2020 2029 0a20 2020  =0.        ).   
-00028440: 2069 6620 7379 6d6d 6574 7269 633a 0a20   if symmetric:. 
-00028450: 2020 2020 2020 2044 2e61 6464 5f70 6f72         D.add_por
-00028460: 7428 6e61 6d65 3d31 2c20 6d69 6470 6f69  t(name=1, midpoi
-00028470: 6e74 3d5b 6d69 6e28 7870 7473 292c 2030  nt=[min(xpts), 0
-00028480: 5d2c 2077 6964 7468 3d73 7461 7274 5f77  ], width=start_w
-00028490: 6964 7468 2c20 6f72 6965 6e74 6174 696f  idth, orientatio
-000284a0: 6e3d 3138 3029 0a20 2020 2020 2020 2044  n=180).        D
-000284b0: 2e61 6464 5f70 6f72 7428 6e61 6d65 3d32  .add_port(name=2
-000284c0: 2c20 6d69 6470 6f69 6e74 3d5b 6d61 7828  , midpoint=[max(
-000284d0: 7870 7473 292c 2030 5d2c 2077 6964 7468  xpts), 0], width
-000284e0: 3d65 6e64 5f77 6964 7468 2c20 6f72 6965  =end_width, orie
-000284f0: 6e74 6174 696f 6e3d 3029 0a0a 2020 2020  ntation=0)..    
-00028500: 7265 7475 726e 2044 0a0a 0a64 6566 206f  return D...def o
-00028510: 7074 696d 616c 5f39 3064 6567 2877 6964  ptimal_90deg(wid
-00028520: 7468 3d31 3030 2e30 2c20 6e75 6d5f 7074  th=100.0, num_pt
-00028530: 733d 3135 2c20 6c65 6e67 7468 5f61 646a  s=15, length_adj
-00028540: 7573 743d 312c 206c 6179 6572 3d30 293a  ust=1, layer=0):
-00028550: 0a20 2020 2022 2222 4372 6561 7465 7320  .    """Creates 
-00028560: 616e 206f 7074 696d 616c 6c79 2d72 6f75  an optimally-rou
-00028570: 6e64 6564 2039 3020 6465 6772 6565 2062  nded 90 degree b
-00028580: 656e 6420 7468 6174 2069 7320 7368 6172  end that is shar
-00028590: 7020 6f6e 2074 6865 206f 7574 6572 0a20  p on the outer. 
-000285a0: 2020 2063 6f72 6e65 722e 0a0a 2020 2020     corner...    
-000285b0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-000285c0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 7769  ---------.    wi
-000285d0: 6474 6820 3a20 696e 7420 6f72 2066 6c6f  dth : int or flo
-000285e0: 6174 0a20 2020 2020 2020 2057 6964 7468  at.        Width
-000285f0: 206f 6620 7468 6520 706f 7274 7320 6f6e   of the ports on
-00028600: 2065 6974 6865 7220 7369 6465 206f 6620   either side of 
-00028610: 7468 6520 6265 6e64 2e0a 2020 2020 6e75  the bend..    nu
-00028620: 6d5f 7074 7320 3a20 696e 740a 2020 2020  m_pts : int.    
-00028630: 2020 2020 5468 6520 6e75 6d62 6572 206f      The number o
-00028640: 6620 706f 696e 7473 2063 6f6d 7072 6973  f points compris
-00028650: 696e 6720 7468 6520 6375 7276 6564 2073  ing the curved s
-00028660: 6563 7469 6f6e 206f 6620 7468 6520 6265  ection of the be
-00028670: 6e64 2e0a 2020 2020 6c65 6e67 7468 5f61  nd..    length_a
-00028680: 646a 7573 7420 3a20 696e 7420 6f72 2066  djust : int or f
-00028690: 6c6f 6174 0a20 2020 2020 2020 2041 646a  loat.        Adj
-000286a0: 7573 7473 2074 6865 206c 656e 6774 6820  usts the length 
-000286b0: 6f66 2074 6865 206e 6f6e 2d63 7572 7665  of the non-curve
-000286c0: 6420 706f 7274 696f 6e20 6f66 2074 6865  d portion of the
-000286d0: 2062 656e 642e 0a20 2020 206c 6179 6572   bend..    layer
-000286e0: 203a 2069 6e74 2c20 6172 7261 792d 6c69   : int, array-li
-000286f0: 6b65 5b32 5d2c 206f 7220 7365 740a 2020  ke[2], or set.  
-00028700: 2020 2020 2020 5370 6563 6966 6963 206c        Specific l
-00028710: 6179 6572 2873 2920 746f 2070 7574 2070  ayer(s) to put p
-00028720: 6f6c 7967 6f6e 2067 656f 6d65 7472 7920  olygon geometry 
-00028730: 6f6e 2e0a 0a20 2020 2052 6574 7572 6e73  on...    Returns
-00028740: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
-00028750: 2044 203a 2044 6576 6963 650a 2020 2020   D : Device.    
-00028760: 2020 2020 4120 4465 7669 6365 2063 6f6e      A Device con
-00028770: 7461 696e 696e 6720 616e 206f 7074 696d  taining an optim
-00028780: 616c 6c79 2d72 6f75 6e64 6564 2039 3020  ally-rounded 90 
-00028790: 6465 6772 6565 2062 656e 642e 0a0a 2020  degree bend...  
-000287a0: 2020 4e6f 7465 730a 2020 2020 2d2d 2d2d    Notes.    ----
-000287b0: 2d0a 2020 2020 4f70 7469 6d61 6c20 7374  -.    Optimal st
-000287c0: 7275 6374 7572 6520 6672 6f6d 2068 7474  ructure from htt
-000287d0: 7073 3a2f 2f64 6f69 2e6f 7267 2f31 302e  ps://doi.org/10.
-000287e0: 3131 3033 2f50 6879 7352 6576 422e 3834  1103/PhysRevB.84
-000287f0: 2e31 3734 3531 300a 2020 2020 436c 656d  .174510.    Clem
-00028800: 2c20 4a2e 2c20 2620 4265 7267 6772 656e  , J., & Berggren
-00028810: 2c20 4b2e 2028 3230 3131 292e 2047 656f  , K. (2011). Geo
-00028820: 6d65 7472 792d 6465 7065 6e64 656e 7420  metry-dependent 
-00028830: 6372 6974 6963 616c 2063 7572 7265 6e74  critical current
-00028840: 7320 696e 0a20 2020 2073 7570 6572 636f  s in.    superco
-00028850: 6e64 7563 7469 6e67 206e 616e 6f63 6972  nducting nanocir
-00028860: 6375 6974 732e 2050 6879 7369 6361 6c20  cuits. Physical 
-00028870: 5265 7669 6577 2042 2c20 3834 2831 3729  Review B, 84(17)
-00028880: 2c20 31e2 8093 3237 2e0a 2020 2020 2222  , 1...27..    ""
-00028890: 220a 2020 2020 4420 3d20 4465 7669 6365  ".    D = Device
-000288a0: 2822 3930 6465 6722 290a 0a20 2020 2023  ("90deg")..    #
-000288b0: 2047 6574 2070 6f69 6e74 7320 6f66 2069   Get points of i
-000288c0: 6465 616c 2063 7572 7665 0a20 2020 2061  deal curve.    a
-000288d0: 203d 2032 202a 2077 6964 7468 0a20 2020   = 2 * width.   
-000288e0: 2076 203d 206e 702e 6c6f 6773 7061 6365   v = np.logspace
-000288f0: 282d 6c65 6e67 7468 5f61 646a 7573 742c  (-length_adjust,
-00028900: 206c 656e 6774 685f 6164 6a75 7374 2c20   length_adjust, 
-00028910: 6e75 6d5f 7074 7329 0a20 2020 2078 6920  num_pts).    xi 
-00028920: 3d20 280a 2020 2020 2020 2020 6120 2f20  = (.        a / 
-00028930: 322e 3020 2a20 2828 3120 2b20 3220 2f20  2.0 * ((1 + 2 / 
-00028940: 7069 202a 206e 702e 6172 6373 696e 6828  pi * np.arcsinh(
-00028950: 3120 2f20 7629 2920 2b20 316a 202a 2028  1 / v)) + 1j * (
-00028960: 3120 2b20 3220 2f20 7069 202a 206e 702e  1 + 2 / pi * np.
-00028970: 6172 6373 696e 6828 7629 2929 0a20 2020  arcsinh(v))).   
-00028980: 2029 0a20 2020 2078 7074 7320 3d20 6c69   ).    xpts = li
-00028990: 7374 286e 702e 7265 616c 2878 6929 290a  st(np.real(xi)).
-000289a0: 2020 2020 7970 7473 203d 206c 6973 7428      ypts = list(
-000289b0: 6e70 2e69 6d61 6728 7869 2929 0a0a 2020  np.imag(xi))..  
-000289c0: 2020 2320 4164 6420 706f 696e 7473 2066    # Add points f
-000289d0: 6f72 2074 6865 2072 6573 7420 6f66 2063  or the rest of c
-000289e0: 7572 7665 0a20 2020 2064 203d 2032 202a  urve.    d = 2 *
-000289f0: 2078 7074 735b 305d 2020 2320 4661 7274   xpts[0]  # Fart
-00028a00: 6865 7374 2070 6f69 6e74 206f 7574 202a  hest point out *
-00028a10: 2032 2c20 726f 756e 6465 6420 746f 206e   2, rounded to n
-00028a20: 6561 7265 7374 2031 3030 0a20 2020 2078  earest 100.    x
-00028a30: 7074 732e 6170 7065 6e64 2877 6964 7468  pts.append(width
-00028a40: 290a 2020 2020 7970 7473 2e61 7070 656e  ).    ypts.appen
-00028a50: 6428 6429 0a20 2020 2078 7074 732e 6170  d(d).    xpts.ap
-00028a60: 7065 6e64 2830 290a 2020 2020 7970 7473  pend(0).    ypts
-00028a70: 2e61 7070 656e 6428 6429 0a20 2020 2078  .append(d).    x
-00028a80: 7074 732e 6170 7065 6e64 2830 290a 2020  pts.append(0).  
-00028a90: 2020 7970 7473 2e61 7070 656e 6428 3029    ypts.append(0)
-00028aa0: 0a20 2020 2078 7074 732e 6170 7065 6e64  .    xpts.append
-00028ab0: 2864 290a 2020 2020 7970 7473 2e61 7070  (d).    ypts.app
-00028ac0: 656e 6428 3029 0a20 2020 2078 7074 732e  end(0).    xpts.
-00028ad0: 6170 7065 6e64 2864 290a 2020 2020 7970  append(d).    yp
-00028ae0: 7473 2e61 7070 656e 6428 7769 6474 6829  ts.append(width)
-00028af0: 0a20 2020 2078 7074 732e 6170 7065 6e64  .    xpts.append
-00028b00: 2878 7074 735b 305d 290a 2020 2020 7970  (xpts[0]).    yp
-00028b10: 7473 2e61 7070 656e 6428 7970 7473 5b30  ts.append(ypts[0
-00028b20: 5d29 0a0a 2020 2020 442e 6164 645f 706f  ])..    D.add_po
-00028b30: 6c79 676f 6e28 5b78 7074 732c 2079 7074  lygon([xpts, ypt
-00028b40: 735d 2c20 6c61 7965 723d 6c61 7965 7229  s], layer=layer)
-00028b50: 0a0a 2020 2020 442e 6164 645f 706f 7274  ..    D.add_port
-00028b60: 286e 616d 653d 312c 206d 6964 706f 696e  (name=1, midpoin
-00028b70: 743d 5b61 202f 2034 2c20 645d 2c20 7769  t=[a / 4, d], wi
-00028b80: 6474 683d 6120 2f20 322c 206f 7269 656e  dth=a / 2, orien
-00028b90: 7461 7469 6f6e 3d39 3029 0a20 2020 2044  tation=90).    D
-00028ba0: 2e61 6464 5f70 6f72 7428 6e61 6d65 3d32  .add_port(name=2
-00028bb0: 2c20 6d69 6470 6f69 6e74 3d5b 642c 2061  , midpoint=[d, a
-00028bc0: 202f 2034 5d2c 2077 6964 7468 3d61 202f   / 4], width=a /
-00028bd0: 2032 2c20 6f72 6965 6e74 6174 696f 6e3d   2, orientation=
-00028be0: 3029 0a20 2020 2072 6574 7572 6e20 440a  0).    return D.
-00028bf0: 0a0a 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ..# ============
-00028c00: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028c10: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028c20: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028c30: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028c40: 3d3d 0a23 2045 7861 6d70 6c65 2063 6f64  ==.# Example cod
-00028c50: 650a 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  e.# ============
-00028c60: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028c70: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028c80: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028c90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028ca0: 3d3d 0a0a 2320 6861 6972 7069 6e20 3d20  ==..# hairpin = 
-00028cb0: 6f70 7469 6d61 6c5f 6861 6972 7069 6e28  optimal_hairpin(
-00028cc0: 7769 6474 6820 3d20 312c 2070 6974 6368  width = 1, pitch
-00028cd0: 203d 2033 2c20 6c65 6e67 7468 203d 2033   = 3, length = 3
-00028ce0: 302c 206e 756d 5f70 7473 203d 2032 3029  0, num_pts = 20)
-00028cf0: 0a23 2071 7569 636b 706c 6f74 2868 6169  .# quickplot(hai
-00028d00: 7270 696e 290a 0a0a 2320 7374 6570 203d  rpin)...# step =
-00028d10: 206f 7074 696d 616c 5f73 7465 7028 7374   optimal_step(st
-00028d20: 6172 745f 7769 6474 6820 3d20 352c 2065  art_width = 5, e
-00028d30: 6e64 5f77 6964 7468 203d 2031 2c20 6e75  nd_width = 1, nu
-00028d40: 6d5f 7074 7320 3d20 3830 2c20 7769 6474  m_pts = 80, widt
-00028d50: 685f 746f 6c20 3d20 3165 2d33 290a 2320  h_tol = 1e-3).# 
-00028d60: 7175 6963 6b70 6c6f 7428 7374 6570 290a  quickplot(step).
-00028d70: 0a0a 2320 7475 726e 203d 206f 7074 696d  ..# turn = optim
-00028d80: 616c 5f39 3064 6567 2877 6964 7468 203d  al_90deg(width =
-00028d90: 2039 302c 206c 656e 6774 685f 6164 6a75   90, length_adju
-00028da0: 7374 203d 2031 290a 2320 7175 6963 6b70  st = 1).# quickp
-00028db0: 6c6f 7428 7475 726e 290a 0a0a 2320 3d3d  lot(turn)...# ==
-00028dc0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028dd0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028de0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028df0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028e00: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a23 0a23  ============.#.#
-00028e10: 2053 7570 6572 636f 6e64 7563 7469 6e67   Superconducting
-00028e20: 2064 6576 6963 6573 0a23 0a23 203d 3d3d   devices.#.# ===
-00028e30: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028e40: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028e50: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028e60: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00028e70: 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 0a0a 4064  ===========...@d
-00028e80: 6576 6963 655f 6c72 755f 6361 6368 650a  evice_lru_cache.
-00028e90: 6465 6620 736e 7370 6428 0a20 2020 2077  def snspd(.    w
-00028ea0: 6972 655f 7769 6474 683d 302e 322c 0a20  ire_width=0.2,. 
-00028eb0: 2020 2077 6972 655f 7069 7463 683d 302e     wire_pitch=0.
-00028ec0: 362c 0a20 2020 2073 697a 653d 2831 302c  6,.    size=(10,
-00028ed0: 2038 292c 0a20 2020 206e 756d 5f73 7175   8),.    num_squ
-00028ee0: 6172 6573 3d4e 6f6e 652c 0a20 2020 2074  ares=None,.    t
-00028ef0: 7572 6e5f 7261 7469 6f3d 342c 0a20 2020  urn_ratio=4,.   
-00028f00: 2074 6572 6d69 6e61 6c73 5f73 616d 655f   terminals_same_
-00028f10: 7369 6465 3d46 616c 7365 2c0a 2020 2020  side=False,.    
-00028f20: 6c61 7965 723d 302c 0a29 3a0a 2020 2020  layer=0,.):.    
-00028f30: 2222 2243 7265 6174 6573 2061 6e20 6f70  """Creates an op
-00028f40: 7469 6d61 6c6c 792d 726f 756e 6465 6420  timally-rounded 
-00028f50: 534e 5350 442e 0a0a 2020 2020 5061 7261  SNSPD...    Para
-00028f60: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
-00028f70: 2d2d 2d2d 2d0a 2020 2020 7769 6474 6820  -----.    width 
-00028f80: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
-00028f90: 2020 2020 2020 2057 6964 7468 206f 6620         Width of 
-00028fa0: 7468 6520 7769 7265 2e0a 2020 2020 7069  the wire..    pi
-00028fb0: 7463 6820 3a20 696e 7420 6f72 2066 6c6f  tch : int or flo
-00028fc0: 6174 0a20 2020 2020 2020 2044 6973 7461  at.        Dista
-00028fd0: 6e63 6520 6265 7477 6565 6e20 7477 6f20  nce between two 
-00028fe0: 6164 6a61 6365 6e74 2077 6972 6573 2e20  adjacent wires. 
-00028ff0: 4d75 7374 2062 6520 6772 6561 7465 7220  Must be greater 
-00029000: 7468 616e 2060 7769 6474 6860 2e0a 2020  than `width`..  
-00029010: 2020 7369 7a65 203a 204e 6f6e 6520 6f72    size : None or
-00029020: 2061 7272 6179 2d6c 696b 655b 325d 206f   array-like[2] o
-00029030: 6620 696e 7420 6f72 2066 6c6f 6174 0a20  f int or float. 
-00029040: 2020 2020 2020 2028 7769 6474 682c 2068         (width, h
-00029050: 6569 6768 7429 206f 6620 7468 6520 7265  eight) of the re
-00029060: 6374 616e 676c 6520 666f 726d 6564 2062  ctangle formed b
-00029070: 7920 7468 6520 6f75 7465 7220 626f 756e  y the outer boun
-00029080: 6461 7279 206f 6620 7468 650a 2020 2020  dary of the.    
-00029090: 2020 2020 534e 5350 442e 204d 7573 7420      SNSPD. Must 
-000290a0: 6265 206e 6f6e 6520 6966 2060 6e75 6d5f  be none if `num_
-000290b0: 7371 7561 7265 7360 2069 7320 7370 6563  squares` is spec
-000290c0: 6966 6965 642e 0a20 2020 206e 756d 5f73  ified..    num_s
-000290d0: 7175 6172 6573 203a 2069 6e74 206f 7220  quares : int or 
-000290e0: 4e6f 6e65 0a20 2020 2020 2020 2054 6f74  None.        Tot
-000290f0: 616c 206e 756d 6265 7220 6f66 2073 7175  al number of squ
-00029100: 6172 6573 2069 6e73 6964 6520 7468 6520  ares inside the 
-00029110: 534e 5350 4420 6c65 6e67 7468 2e20 4d75  SNSPD length. Mu
-00029120: 7374 2062 6520 6e6f 6e65 2069 660a 2020  st be none if.  
-00029130: 2020 2020 2020 6073 697a 6560 2069 7320        `size` is 
-00029140: 7370 6563 6966 6965 642e 0a20 2020 2074  specified..    t
-00029150: 7572 6e5f 7261 7469 6f20 3a20 696e 7420  urn_ratio : int 
-00029160: 6f72 2066 6c6f 6174 0a20 2020 2020 2020  or float.       
-00029170: 2053 7065 6369 6669 6573 2068 6f77 206d   Specifies how m
-00029180: 7563 6820 6f66 2074 6865 2053 4e53 5044  uch of the SNSPD
-00029190: 2077 6964 7468 2069 7320 6465 6469 6361   width is dedica
-000291a0: 7465 6420 746f 2074 6865 2031 3830 2064  ted to the 180 d
-000291b0: 6567 7265 650a 2020 2020 2020 2020 7475  egree.        tu
-000291c0: 726e 2e20 4120 6074 7572 6e5f 7261 7469  rn. A `turn_rati
-000291d0: 6f60 206f 6620 3130 2077 696c 6c20 7265  o` of 10 will re
-000291e0: 7375 6c74 2069 6e20 3230 2520 6f66 2074  sult in 20% of t
-000291f0: 6865 2077 6964 7468 2062 6569 6e67 0a20  he width being. 
-00029200: 2020 2020 2020 2063 6f6d 7072 6973 6564         comprised
-00029210: 206f 6620 7468 6520 7475 726e 2e0a 2020   of the turn..  
-00029220: 2020 7465 726d 696e 616c 735f 7361 6d65    terminals_same
-00029230: 5f73 6964 6520 3a20 626f 6f6c 0a20 2020  _side : bool.   
-00029240: 2020 2020 2049 6620 5472 7565 2c20 626f       If True, bo
-00029250: 7468 2070 6f72 7473 2077 696c 6c20 6265  th ports will be
-00029260: 206c 6f63 6174 6564 206f 6e20 7468 6520   located on the 
-00029270: 7361 6d65 2073 6964 6520 6f66 2074 6865  same side of the
-00029280: 2053 4e53 5044 2e0a 2020 2020 6c61 7965   SNSPD..    laye
-00029290: 7220 3a20 696e 742c 2061 7272 6179 2d6c  r : int, array-l
-000292a0: 696b 655b 325d 2c20 6f72 2073 6574 0a20  ike[2], or set. 
-000292b0: 2020 2020 2020 2053 7065 6369 6669 6320         Specific 
-000292c0: 6c61 7965 7228 7329 2074 6f20 7075 7420  layer(s) to put 
-000292d0: 706f 6c79 676f 6e20 6765 6f6d 6574 7279  polygon geometry
-000292e0: 206f 6e2e 0a0a 2020 2020 5265 7475 726e   on...    Return
-000292f0: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-00029300: 2020 4420 3a20 4465 7669 6365 0a20 2020    D : Device.   
-00029310: 2020 2020 2041 2044 6576 6963 6520 636f       A Device co
-00029320: 6e74 6169 6e69 6e67 2061 6e20 6f70 7469  ntaining an opti
-00029330: 6d61 6c6c 792d 726f 756e 6465 6420 534e  mally-rounded SN
-00029340: 5350 442e 0a20 2020 2022 2222 0a20 2020  SPD..    """.   
-00029350: 2023 2043 6f6e 7665 6e69 656e 6365 2074   # Convenience t
-00029360: 6573 7473 2074 6f20 6175 746f 2d73 6861  ests to auto-sha
-00029370: 7065 2074 6865 2073 697a 6520 6261 7365  pe the size base
-00029380: 640a 2020 2020 2320 6f6e 2074 6865 206e  d.    # on the n
-00029390: 756d 6265 7220 6f66 2073 7175 6172 6573  umber of squares
-000293a0: 0a20 2020 2069 6620 6e75 6d5f 7371 7561  .    if num_squa
-000293b0: 7265 7320 6973 206e 6f74 204e 6f6e 6520  res is not None 
-000293c0: 616e 6420 280a 2020 2020 2020 2020 2873  and (.        (s
-000293d0: 697a 6520 6973 204e 6f6e 6529 206f 7220  ize is None) or 
-000293e0: 2828 7369 7a65 5b30 5d20 6973 204e 6f6e  ((size[0] is Non
-000293f0: 6529 2061 6e64 2028 7369 7a65 5b31 5d29  e) and (size[1])
-00029400: 2069 7320 4e6f 6e65 290a 2020 2020 293a   is None).    ):
-00029410: 0a20 2020 2020 2020 2078 7920 3d20 6e70  .        xy = np
-00029420: 2e73 7172 7428 6e75 6d5f 7371 7561 7265  .sqrt(num_square
-00029430: 7320 2a20 7769 7265 5f70 6974 6368 202a  s * wire_pitch *
-00029440: 2077 6972 655f 7769 6474 6829 0a20 2020   wire_width).   
-00029450: 2020 2020 2073 697a 6520 3d20 5b78 792c       size = [xy,
-00029460: 2078 795d 0a20 2020 2020 2020 206e 756d   xy].        num
-00029470: 5f73 7175 6172 6573 203d 204e 6f6e 650a  _squares = None.
-00029480: 2020 2020 6966 205b 7369 7a65 5b30 5d2c      if [size[0],
-00029490: 2073 697a 655b 315d 2c20 6e75 6d5f 7371   size[1], num_sq
-000294a0: 7561 7265 735d 2e63 6f75 6e74 284e 6f6e  uares].count(Non
-000294b0: 6529 2021 3d20 313a 0a20 2020 2020 2020  e) != 1:.       
-000294c0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-000294d0: 7228 0a20 2020 2020 2020 2020 2020 2022  r(.            "
-000294e0: 5b50 4849 444c 5d20 736e 7370 6428 2920  [PHIDL] snspd() 
-000294f0: 7265 7175 6972 6573 2074 6861 7420 6578  requires that ex
-00029500: 6163 746c 7920 4f4e 4520 7661 6c75 6520  actly ONE value 
-00029510: 6f66 2022 0a20 2020 2020 2020 2020 2020  of ".           
-00029520: 2022 7468 6520 6172 6775 6d65 6e74 7320   "the arguments 
-00029530: 6060 6e75 6d5f 7371 7561 7265 7360 6020  ``num_squares`` 
-00029540: 616e 6420 6060 7369 7a65 6060 2062 6520  and ``size`` be 
-00029550: 4e6f 6e65 2022 0a20 2020 2020 2020 2020  None ".         
-00029560: 2020 2022 746f 2070 7265 7665 6e74 206f     "to prevent o
-00029570: 7665 7263 6f6e 7374 7261 696e 696e 672c  verconstraining,
-00029580: 2066 6f72 2065 7861 6d70 6c65 3a5c 6e22   for example:\n"
-00029590: 0a20 2020 2020 2020 2020 2020 2022 3e3e  .            ">>
-000295a0: 3e20 736e 7370 6428 7369 7a65 203d 2028  > snspd(size = (
-000295b0: 332c 204e 6f6e 6529 2c20 6e75 6d5f 7371  3, None), num_sq
-000295c0: 7561 7265 7320 3d20 3230 3030 2922 0a20  uares = 2000)". 
-000295d0: 2020 2020 2020 2029 0a20 2020 2069 6620         ).    if 
-000295e0: 7369 7a65 5b30 5d20 6973 204e 6f6e 653a  size[0] is None:
-000295f0: 0a20 2020 2020 2020 2079 7369 7a65 203d  .        ysize =
-00029600: 2073 697a 655b 315d 0a20 2020 2020 2020   size[1].       
-00029610: 2078 7369 7a65 203d 206e 756d 5f73 7175   xsize = num_squ
-00029620: 6172 6573 202a 2077 6972 655f 7069 7463  ares * wire_pitc
-00029630: 6820 2a20 7769 7265 5f77 6964 7468 202f  h * wire_width /
-00029640: 2079 7369 7a65 0a20 2020 2065 6c69 6620   ysize.    elif 
-00029650: 7369 7a65 5b31 5d20 6973 204e 6f6e 653a  size[1] is None:
-00029660: 0a20 2020 2020 2020 2078 7369 7a65 203d  .        xsize =
-00029670: 2073 697a 655b 305d 0a20 2020 2020 2020   size[0].       
-00029680: 2079 7369 7a65 203d 206e 756d 5f73 7175   ysize = num_squ
-00029690: 6172 6573 202a 2077 6972 655f 7069 7463  ares * wire_pitc
-000296a0: 6820 2a20 7769 7265 5f77 6964 7468 202f  h * wire_width /
-000296b0: 2078 7369 7a65 0a20 2020 2065 6c73 653a   xsize.    else:
-000296c0: 0a20 2020 2020 2020 2078 7369 7a65 203d  .        xsize =
-000296d0: 2073 697a 655b 305d 0a20 2020 2020 2020   size[0].       
-000296e0: 2079 7369 7a65 203d 2073 697a 655b 315d   ysize = size[1]
-000296f0: 0a0a 2020 2020 6e75 6d5f 6d65 616e 6465  ..    num_meande
-00029700: 7273 203d 2069 6e74 286e 702e 6365 696c  rs = int(np.ceil
-00029710: 2879 7369 7a65 202f 2077 6972 655f 7069  (ysize / wire_pi
-00029720: 7463 6829 290a 0a20 2020 2044 203d 2044  tch))..    D = D
-00029730: 6576 6963 6528 6e61 6d65 3d22 736e 7370  evice(name="snsp
-00029740: 6422 290a 2020 2020 6861 6972 7069 6e20  d").    hairpin 
-00029750: 3d20 6f70 7469 6d61 6c5f 6861 6972 7069  = optimal_hairpi
-00029760: 6e28 0a20 2020 2020 2020 2077 6964 7468  n(.        width
-00029770: 3d77 6972 655f 7769 6474 682c 0a20 2020  =wire_width,.   
-00029780: 2020 2020 2070 6974 6368 3d77 6972 655f       pitch=wire_
-00029790: 7069 7463 682c 0a20 2020 2020 2020 2074  pitch,.        t
-000297a0: 7572 6e5f 7261 7469 6f3d 7475 726e 5f72  urn_ratio=turn_r
-000297b0: 6174 696f 2c0a 2020 2020 2020 2020 6c65  atio,.        le
-000297c0: 6e67 7468 3d78 7369 7a65 202f 2032 2c0a  ngth=xsize / 2,.
-000297d0: 2020 2020 2020 2020 6e75 6d5f 7074 733d          num_pts=
-000297e0: 3230 2c0a 2020 2020 2020 2020 6c61 7965  20,.        laye
-000297f0: 723d 6c61 7965 722c 0a20 2020 2029 0a0a  r=layer,.    )..
-00029800: 2020 2020 6966 2028 7465 726d 696e 616c      if (terminal
-00029810: 735f 7361 6d65 5f73 6964 6520 6973 2046  s_same_side is F
-00029820: 616c 7365 2920 616e 6420 2828 6e75 6d5f  alse) and ((num_
-00029830: 6d65 616e 6465 7273 2025 2032 2920 3d3d  meanders % 2) ==
-00029840: 2030 293a 0a20 2020 2020 2020 206e 756d   0):.        num
-00029850: 5f6d 6561 6e64 6572 7320 2b3d 2031 0a20  _meanders += 1. 
-00029860: 2020 2065 6c69 6620 2874 6572 6d69 6e61     elif (termina
-00029870: 6c73 5f73 616d 655f 7369 6465 2069 7320  ls_same_side is 
-00029880: 5472 7565 2920 616e 6420 2828 6e75 6d5f  True) and ((num_
-00029890: 6d65 616e 6465 7273 2025 2032 2920 3d3d  meanders % 2) ==
-000298a0: 2031 293a 0a20 2020 2020 2020 206e 756d   1):.        num
-000298b0: 5f6d 6561 6e64 6572 7320 2b3d 2031 0a0a  _meanders += 1..
-000298c0: 2020 2020 7374 6172 745f 6e77 203d 2044      start_nw = D
-000298d0: 2e61 6464 5f72 6566 2863 6f6d 7061 7373  .add_ref(compass
-000298e0: 2873 697a 653d 5b78 7369 7a65 202f 2032  (size=[xsize / 2
-000298f0: 2c20 7769 7265 5f77 6964 7468 5d2c 206c  , wire_width], l
-00029900: 6179 6572 3d6c 6179 6572 2929 0a0a 2020  ayer=layer))..  
-00029910: 2020 6870 5f70 7265 7620 3d20 442e 6164    hp_prev = D.ad
-00029920: 645f 7265 6628 6861 6972 7069 6e29 0a20  d_ref(hairpin). 
-00029930: 2020 2068 705f 7072 6576 2e63 6f6e 6e65     hp_prev.conne
-00029940: 6374 2831 2c20 7374 6172 745f 6e77 2e70  ct(1, start_nw.p
-00029950: 6f72 7473 5b22 4522 5d29 0a20 2020 2061  orts["E"]).    a
-00029960: 6c74 6572 6e61 7465 203d 2054 7275 650a  lternate = True.
-00029970: 2020 2020 666f 7220 6e20 696e 2072 616e      for n in ran
-00029980: 6765 2832 2c20 6e75 6d5f 6d65 616e 6465  ge(2, num_meande
-00029990: 7273 293a 0a20 2020 2020 2020 2068 7020  rs):.        hp 
-000299a0: 3d20 442e 6164 645f 7265 6628 6861 6972  = D.add_ref(hair
-000299b0: 7069 6e29 0a20 2020 2020 2020 2069 6620  pin).        if 
-000299c0: 616c 7465 726e 6174 653a 0a20 2020 2020  alternate:.     
-000299d0: 2020 2020 2020 2068 702e 636f 6e6e 6563         hp.connec
-000299e0: 7428 322c 2068 705f 7072 6576 2e70 6f72  t(2, hp_prev.por
-000299f0: 7473 5b32 5d29 0a20 2020 2020 2020 2020  ts[2]).         
-00029a00: 2020 206c 6173 745f 706f 7274 203d 2068     last_port = h
-00029a10: 702e 706f 7274 735b 315d 0a20 2020 2020  p.ports[1].     
-00029a20: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00029a30: 2020 2020 2068 702e 636f 6e6e 6563 7428       hp.connect(
-00029a40: 312c 2068 705f 7072 6576 2e70 6f72 7473  1, hp_prev.ports
-00029a50: 5b31 5d29 0a20 2020 2020 2020 2020 2020  [1]).           
-00029a60: 206c 6173 745f 706f 7274 203d 2068 702e   last_port = hp.
-00029a70: 706f 7274 735b 325d 0a20 2020 2020 2020  ports[2].       
-00029a80: 2068 705f 7072 6576 203d 2068 700a 2020   hp_prev = hp.  
-00029a90: 2020 2020 2020 616c 7465 726e 6174 6520        alternate 
-00029aa0: 3d20 6e6f 7420 616c 7465 726e 6174 650a  = not alternate.
-00029ab0: 0a20 2020 2066 696e 6973 685f 7365 203d  .    finish_se =
-00029ac0: 2044 2e61 6464 5f72 6566 2863 6f6d 7061   D.add_ref(compa
-00029ad0: 7373 2873 697a 653d 5b78 7369 7a65 202f  ss(size=[xsize /
-00029ae0: 2032 2c20 7769 7265 5f77 6964 7468 5d2c   2, wire_width],
-00029af0: 206c 6179 6572 3d6c 6179 6572 2929 0a20   layer=layer)). 
-00029b00: 2020 2066 696e 6973 685f 7365 2e63 6f6e     finish_se.con
-00029b10: 6e65 6374 2822 4522 2c20 6c61 7374 5f70  nect("E", last_p
-00029b20: 6f72 7429 0a0a 2020 2020 442e 6164 645f  ort)..    D.add_
-00029b30: 706f 7274 2870 6f72 743d 7374 6172 745f  port(port=start_
-00029b40: 6e77 2e70 6f72 7473 5b22 5722 5d2c 206e  nw.ports["W"], n
-00029b50: 616d 653d 3129 0a20 2020 2044 2e61 6464  ame=1).    D.add
-00029b60: 5f70 6f72 7428 706f 7274 3d66 696e 6973  _port(port=finis
-00029b70: 685f 7365 2e70 6f72 7473 5b22 5722 5d2c  h_se.ports["W"],
-00029b80: 206e 616d 653d 3229 0a0a 2020 2020 442e   name=2)..    D.
-00029b90: 696e 666f 5b22 6e75 6d5f 7371 7561 7265  info["num_square
-00029ba0: 7322 5d20 3d20 6e75 6d5f 6d65 616e 6465  s"] = num_meande
-00029bb0: 7273 202a 2028 7873 697a 6520 2f20 7769  rs * (xsize / wi
-00029bc0: 7265 5f77 6964 7468 290a 2020 2020 442e  re_width).    D.
-00029bd0: 696e 666f 5b22 6172 6561 225d 203d 2078  info["area"] = x
-00029be0: 7369 7a65 202a 2079 7369 7a65 0a20 2020  size * ysize.   
-00029bf0: 2044 2e69 6e66 6f5b 2273 697a 6522 5d20   D.info["size"] 
-00029c00: 3d20 2878 7369 7a65 2c20 7973 697a 6529  = (xsize, ysize)
-00029c10: 0a0a 2020 2020 7265 7475 726e 2044 0a0a  ..    return D..
-00029c20: 0a64 6566 2073 6e73 7064 5f65 7870 616e  .def snspd_expan
-00029c30: 6465 6428 0a20 2020 2077 6972 655f 7769  ded(.    wire_wi
-00029c40: 6474 683d 302e 322c 0a20 2020 2077 6972  dth=0.2,.    wir
-00029c50: 655f 7069 7463 683d 302e 362c 0a20 2020  e_pitch=0.6,.   
-00029c60: 2073 697a 653d 2831 302c 2038 292c 0a20   size=(10, 8),. 
-00029c70: 2020 206e 756d 5f73 7175 6172 6573 3d4e     num_squares=N
-00029c80: 6f6e 652c 0a20 2020 2063 6f6e 6e65 6374  one,.    connect
-00029c90: 6f72 5f77 6964 7468 3d31 2c0a 2020 2020  or_width=1,.    
-00029ca0: 636f 6e6e 6563 746f 725f 7379 6d6d 6574  connector_symmet
-00029cb0: 7269 633d 4661 6c73 652c 0a20 2020 2074  ric=False,.    t
-00029cc0: 7572 6e5f 7261 7469 6f3d 342c 0a20 2020  urn_ratio=4,.   
-00029cd0: 2074 6572 6d69 6e61 6c73 5f73 616d 655f   terminals_same_
-00029ce0: 7369 6465 3d46 616c 7365 2c0a 2020 2020  side=False,.    
-00029cf0: 6c61 7965 723d 302c 0a29 3a0a 2020 2020  layer=0,.):.    
-00029d00: 2222 2243 7265 6174 6573 2061 6e20 6f70  """Creates an op
-00029d10: 7469 6d61 6c6c 792d 726f 756e 6465 6420  timally-rounded 
-00029d20: 534e 5350 4420 7769 7468 2077 6972 6573  SNSPD with wires
-00029d30: 2063 6f6d 696e 6720 6f75 7420 6f66 2069   coming out of i
-00029d40: 7420 7468 6174 0a20 2020 2065 7870 616e  t that.    expan
-00029d50: 642e 0a0a 2020 2020 5061 7261 6d65 7465  d...    Paramete
-00029d60: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-00029d70: 2d0a 2020 2020 7769 6474 6820 3a20 696e  -.    width : in
-00029d80: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
-00029d90: 2020 2057 6964 7468 206f 6620 7468 6520     Width of the 
-00029da0: 7769 7265 2e0a 2020 2020 7069 7463 6820  wire..    pitch 
-00029db0: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
-00029dc0: 2020 2020 2020 2044 6973 7461 6e63 6520         Distance 
-00029dd0: 6265 7477 6565 6e20 7477 6f20 6164 6a61  between two adja
-00029de0: 6365 6e74 2077 6972 6573 2e20 4d75 7374  cent wires. Must
-00029df0: 2062 6520 6772 6561 7465 7220 7468 616e   be greater than
-00029e00: 2060 7769 6474 6860 2e0a 2020 2020 7369   `width`..    si
-00029e10: 7a65 203a 204e 6f6e 6520 6f72 2061 7272  ze : None or arr
-00029e20: 6179 2d6c 696b 655b 325d 206f 6620 696e  ay-like[2] of in
-00029e30: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
-00029e40: 2020 2028 7769 6474 682c 2068 6569 6768     (width, heigh
-00029e50: 7429 206f 6620 7468 6520 7265 6374 616e  t) of the rectan
-00029e60: 676c 6520 666f 726d 6564 2062 7920 7468  gle formed by th
-00029e70: 6520 6f75 7465 7220 626f 756e 6461 7279  e outer boundary
-00029e80: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
-00029e90: 534e 5350 442e 204d 7573 7420 6265 206e  SNSPD. Must be n
-00029ea0: 6f6e 6520 6966 2060 6e75 6d5f 7371 7561  one if `num_squa
-00029eb0: 7265 7360 2069 7320 7370 6563 6966 6965  res` is specifie
-00029ec0: 642e 0a20 2020 206e 756d 5f73 7175 6172  d..    num_squar
-00029ed0: 6573 203a 2069 6e74 206f 7220 4e6f 6e65  es : int or None
-00029ee0: 0a20 2020 2020 2020 2054 6f74 616c 206e  .        Total n
-00029ef0: 756d 6265 7220 6f66 2073 7175 6172 6573  umber of squares
-00029f00: 2069 6e73 6964 6520 7468 6520 534e 5350   inside the SNSP
-00029f10: 4420 6c65 6e67 7468 2e20 4d75 7374 2062  D length. Must b
-00029f20: 6520 6e6f 6e65 2069 660a 2020 2020 2020  e none if.      
-00029f30: 2020 6073 697a 6560 2069 7320 7370 6563    `size` is spec
-00029f40: 6966 6965 642e 0a20 2020 2063 6f6e 6e65  ified..    conne
-00029f50: 6374 6f72 5f77 6964 7468 203a 2069 6e74  ctor_width : int
-00029f60: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
-00029f70: 2020 5769 6474 6820 6f66 2074 6865 2063    Width of the c
-00029f80: 6f6e 6e65 6374 6f72 732e 0a20 2020 2063  onnectors..    c
-00029f90: 6f6e 6e65 6374 6f72 5f73 796d 6d65 7472  onnector_symmetr
-00029fa0: 6963 203a 2062 6f6f 6c0a 2020 2020 2020  ic : bool.      
-00029fb0: 2020 4966 2054 7275 652c 206d 6972 726f    If True, mirro
-00029fc0: 7273 2074 6865 2063 6f6e 6e65 6374 6f72  rs the connector
-00029fd0: 7320 6163 726f 7373 2074 6865 6972 2066  s across their f
-00029fe0: 6c61 7420 6564 6765 2061 6e64 2061 6464  lat edge and add
-00029ff0: 7320 7468 656d 0a20 2020 2020 2020 2074  s them.        t
-0002a000: 6f20 7468 6520 636f 6e6e 6563 746f 7220  o the connector 
-0002a010: 6765 6f6d 6574 7279 2e0a 2020 2020 7475  geometry..    tu
-0002a020: 726e 5f72 6174 696f 203a 2069 6e74 206f  rn_ratio : int o
-0002a030: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
-0002a040: 5370 6563 6966 6965 7320 686f 7720 6d75  Specifies how mu
-0002a050: 6368 206f 6620 7468 6520 534e 5350 4420  ch of the SNSPD 
-0002a060: 7769 6474 6820 6973 2064 6564 6963 6174  width is dedicat
-0002a070: 6564 2074 6f20 7468 6520 3138 3020 6465  ed to the 180 de
-0002a080: 6772 6565 0a20 2020 2020 2020 2074 7572  gree.        tur
-0002a090: 6e2e 2041 2060 7475 726e 5f72 6174 696f  n. A `turn_ratio
-0002a0a0: 6020 6f66 2031 3020 7769 6c6c 2072 6573  ` of 10 will res
-0002a0b0: 756c 7420 696e 2032 3025 206f 6620 7468  ult in 20% of th
-0002a0c0: 6520 7769 6474 6820 6265 696e 670a 2020  e width being.  
-0002a0d0: 2020 2020 2020 636f 6d70 7269 7365 6420        comprised 
-0002a0e0: 6f66 2074 6865 2074 7572 6e2e 0a20 2020  of the turn..   
-0002a0f0: 2074 6572 6d69 6e61 6c73 5f73 616d 655f   terminals_same_
-0002a100: 7369 6465 203a 2062 6f6f 6c0a 2020 2020  side : bool.    
-0002a110: 2020 2020 4966 2054 7275 652c 2062 6f74      If True, bot
-0002a120: 6820 706f 7274 7320 7769 6c6c 2062 6520  h ports will be 
-0002a130: 6c6f 6361 7465 6420 6f6e 2074 6865 2073  located on the s
-0002a140: 616d 6520 7369 6465 206f 6620 7468 6520  ame side of the 
-0002a150: 534e 5350 442e 0a20 2020 206c 6179 6572  SNSPD..    layer
-0002a160: 203a 2069 6e74 2c20 6172 7261 792d 6c69   : int, array-li
-0002a170: 6b65 5b32 5d2c 206f 7220 7365 740a 2020  ke[2], or set.  
-0002a180: 2020 2020 2020 5370 6563 6966 6963 206c        Specific l
-0002a190: 6179 6572 2873 2920 746f 2070 7574 2070  ayer(s) to put p
-0002a1a0: 6f6c 7967 6f6e 2067 656f 6d65 7472 7920  olygon geometry 
-0002a1b0: 6f6e 2e0a 0a20 2020 2052 6574 7572 6e73  on...    Returns
-0002a1c0: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
-0002a1d0: 2044 203a 2044 6576 6963 650a 2020 2020   D : Device.    
-0002a1e0: 2020 2020 4120 4465 7669 6365 2063 6f6e      A Device con
-0002a1f0: 7461 696e 696e 6720 616e 206f 7074 696d  taining an optim
-0002a200: 616c 6c79 2d72 6f75 6e64 6564 2053 4e53  ally-rounded SNS
-0002a210: 5044 2077 6974 6820 6578 7061 6e64 696e  PD with expandin
-0002a220: 6720 696e 7075 742f 0a20 2020 2020 2020  g input/.       
-0002a230: 206f 7574 7075 7420 7769 7265 732e 0a20   output wires.. 
-0002a240: 2020 2022 2222 0a20 2020 2044 203d 2044     """.    D = D
-0002a250: 6576 6963 6528 2273 6e73 7064 5f65 7870  evice("snspd_exp
-0002a260: 616e 6465 6422 290a 2020 2020 5320 3d20  anded").    S = 
-0002a270: 736e 7370 6428 0a20 2020 2020 2020 2077  snspd(.        w
-0002a280: 6972 655f 7769 6474 683d 7769 7265 5f77  ire_width=wire_w
-0002a290: 6964 7468 2c0a 2020 2020 2020 2020 7769  idth,.        wi
-0002a2a0: 7265 5f70 6974 6368 3d77 6972 655f 7069  re_pitch=wire_pi
-0002a2b0: 7463 682c 0a20 2020 2020 2020 2073 697a  tch,.        siz
-0002a2c0: 653d 7369 7a65 2c0a 2020 2020 2020 2020  e=size,.        
-0002a2d0: 6e75 6d5f 7371 7561 7265 733d 6e75 6d5f  num_squares=num_
-0002a2e0: 7371 7561 7265 732c 0a20 2020 2020 2020  squares,.       
-0002a2f0: 2074 7572 6e5f 7261 7469 6f3d 7475 726e   turn_ratio=turn
-0002a300: 5f72 6174 696f 2c0a 2020 2020 2020 2020  _ratio,.        
-0002a310: 7465 726d 696e 616c 735f 7361 6d65 5f73  terminals_same_s
-0002a320: 6964 653d 7465 726d 696e 616c 735f 7361  ide=terminals_sa
-0002a330: 6d65 5f73 6964 652c 0a20 2020 2020 2020  me_side,.       
-0002a340: 206c 6179 6572 3d6c 6179 6572 2c0a 2020   layer=layer,.  
-0002a350: 2020 290a 2020 2020 7320 3d20 442e 6164    ).    s = D.ad
-0002a360: 645f 7265 6628 5329 0a20 2020 2073 7465  d_ref(S).    ste
-0002a370: 705f 6465 7669 6365 203d 206f 7074 696d  p_device = optim
-0002a380: 616c 5f73 7465 7028 0a20 2020 2020 2020  al_step(.       
-0002a390: 2073 7461 7274 5f77 6964 7468 3d77 6972   start_width=wir
-0002a3a0: 655f 7769 6474 682c 0a20 2020 2020 2020  e_width,.       
-0002a3b0: 2065 6e64 5f77 6964 7468 3d63 6f6e 6e65   end_width=conne
-0002a3c0: 6374 6f72 5f77 6964 7468 2c0a 2020 2020  ctor_width,.    
-0002a3d0: 2020 2020 6e75 6d5f 7074 733d 3130 302c      num_pts=100,
-0002a3e0: 0a20 2020 2020 2020 2061 6e74 6963 726f  .        anticro
-0002a3f0: 7764 696e 675f 6661 6374 6f72 3d32 2c0a  wding_factor=2,.
-0002a400: 2020 2020 2020 2020 7769 6474 685f 746f          width_to
-0002a410: 6c3d 3165 2d33 2c0a 2020 2020 2020 2020  l=1e-3,.        
-0002a420: 7379 6d6d 6574 7269 633d 636f 6e6e 6563  symmetric=connec
-0002a430: 746f 725f 7379 6d6d 6574 7269 632c 0a20  tor_symmetric,. 
-0002a440: 2020 2020 2020 206c 6179 6572 3d6c 6179         layer=lay
-0002a450: 6572 2c0a 2020 2020 290a 2020 2020 7374  er,.    ).    st
-0002a460: 6570 3120 3d20 442e 6164 645f 7265 6628  ep1 = D.add_ref(
-0002a470: 7374 6570 5f64 6576 6963 6529 0a20 2020  step_device).   
-0002a480: 2073 7465 7032 203d 2044 2e61 6464 5f72   step2 = D.add_r
-0002a490: 6566 2873 7465 705f 6465 7669 6365 290a  ef(step_device).
-0002a4a0: 2020 2020 7374 6570 312e 636f 6e6e 6563      step1.connec
-0002a4b0: 7428 706f 7274 3d31 2c20 6465 7374 696e  t(port=1, destin
-0002a4c0: 6174 696f 6e3d 732e 706f 7274 735b 315d  ation=s.ports[1]
-0002a4d0: 290a 2020 2020 7374 6570 322e 636f 6e6e  ).    step2.conn
-0002a4e0: 6563 7428 706f 7274 3d31 2c20 6465 7374  ect(port=1, dest
-0002a4f0: 696e 6174 696f 6e3d 732e 706f 7274 735b  ination=s.ports[
-0002a500: 325d 290a 2020 2020 442e 6164 645f 706f  2]).    D.add_po
-0002a510: 7274 286e 616d 653d 312c 2070 6f72 743d  rt(name=1, port=
-0002a520: 7374 6570 312e 706f 7274 735b 325d 290a  step1.ports[2]).
-0002a530: 2020 2020 442e 6164 645f 706f 7274 286e      D.add_port(n
-0002a540: 616d 653d 322c 2070 6f72 743d 7374 6570  ame=2, port=step
-0002a550: 322e 706f 7274 735b 325d 290a 0a20 2020  2.ports[2])..   
-0002a560: 2044 2e69 6e66 6f20 3d20 532e 696e 666f   D.info = S.info
-0002a570: 0a20 2020 2053 2e69 6e66 6f20 3d20 7b7d  .    S.info = {}
-0002a580: 0a0a 2020 2020 7265 7475 726e 2044 0a0a  ..    return D..
-0002a590: 0a23 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  .# =============
-0002a5a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002a5b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002a5c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002a5d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002a5e0: 3d0a 2320 4578 616d 706c 6520 636f 6465  =.# Example code
-0002a5f0: 0a23 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  .# =============
-0002a600: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002a610: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002a620: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002a630: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002a640: 3d0a 0a23 2073 203d 2073 6e73 7064 2877  =..# s = snspd(w
-0002a650: 6972 655f 7769 6474 6820 3d20 302e 322c  ire_width = 0.2,
-0002a660: 2077 6972 655f 7069 7463 6820 3d20 302e   wire_pitch = 0.
-0002a670: 362c 2073 697a 6520 3d20 5b31 302c 335d  6, size = [10,3]
-0002a680: 2c20 7465 726d 696e 616c 735f 7361 6d65  , terminals_same
-0002a690: 5f73 6964 6520 3d20 5472 7565 290a 2320  _side = True).# 
-0002a6a0: 7175 6963 6b70 6c6f 7428 7329 0a0a 2320  quickplot(s)..# 
-0002a6b0: 7320 3d20 736e 7370 6428 7769 7265 5f77  s = snspd(wire_w
-0002a6c0: 6964 7468 203d 2030 2e32 2c20 7769 7265  idth = 0.2, wire
-0002a6d0: 5f70 6974 6368 203d 2030 2e36 2c20 7369  _pitch = 0.6, si
-0002a6e0: 7a65 203d 205b 3130 2c20 4e6f 6e65 5d2c  ze = [10, None],
-0002a6f0: 0a23 2020 2020 2020 2020 2020 6e75 6d5f  .#          num_
-0002a700: 7371 7561 7265 7320 3d20 3130 3030 2c20  squares = 1000, 
-0002a710: 7465 726d 696e 616c 735f 7361 6d65 5f73  terminals_same_s
-0002a720: 6964 6520 3d20 5472 7565 290a 2320 7175  ide = True).# qu
-0002a730: 6963 6b70 6c6f 7428 7329 0a0a 0a64 6566  ickplot(s)...def
-0002a740: 2073 6e73 7064 5f63 616e 6465 6c61 6272   snspd_candelabr
-0002a750: 6128 2020 2320 6e6f 7161 3a20 4339 3031  a(  # noqa: C901
-0002a760: 0a20 2020 2077 6972 655f 7769 6474 683d  .    wire_width=
-0002a770: 302e 3532 2c0a 2020 2020 7769 7265 5f70  0.52,.    wire_p
-0002a780: 6974 6368 3d30 2e35 362c 0a20 2020 2068  itch=0.56,.    h
-0002a790: 6178 6973 3d39 302c 0a20 2020 2076 6178  axis=90,.    vax
-0002a7a0: 6973 3d35 302c 0a20 2020 2065 7175 616c  is=50,.    equal
-0002a7b0: 697a 655f 7061 7468 5f6c 656e 6774 6873  ize_path_lengths
-0002a7c0: 3d46 616c 7365 2c0a 2020 2020 7877 696e  =False,.    xwin
-0002a7d0: 673d 4661 6c73 652c 0a20 2020 206c 6179  g=False,.    lay
-0002a7e0: 6572 3d30 2c0a 293a 0a20 2020 2022 2222  er=0,.):.    """
-0002a7f0: 4372 6561 7465 7320 616e 206f 7074 696d  Creates an optim
-0002a800: 616c 6c79 2d72 6f75 6e64 6564 2053 4e53  ally-rounded SNS
-0002a810: 5044 2077 6974 6820 6c6f 7720 6375 7272  PD with low curr
-0002a820: 656e 7420 6372 6f77 6469 6e67 2061 6e64  ent crowding and
-0002a830: 0a20 2020 2061 7262 7469 7472 6172 696c  .    arbtitraril
-0002a840: 792d 6869 6768 2066 696c 6c20 6661 6374  y-high fill fact
-0002a850: 6f72 2061 7320 6465 7363 7269 6265 6420  or as described 
-0002a860: 6279 2052 6564 6479 2065 742e 2061 6c2e  by Reddy et. al.
-0002a870: 2c0a 2020 2020 4150 4c20 5068 6f74 6f6e  ,.    APL Photon
-0002a880: 6963 7320 372c 2030 3531 3330 3220 2832  ics 7, 051302 (2
-0002a890: 3032 3229 2020 6874 7470 733a 2f2f 646f  022)  https://do
-0002a8a0: 692e 6f72 672f 3130 2e31 3036 332f 352e  i.org/10.1063/5.
-0002a8b0: 3030 3838 3030 370a 0a20 2020 2050 6172  0088007..    Par
-0002a8c0: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
-0002a8d0: 2d2d 2d2d 2d2d 0a20 2020 2077 6972 655f  ------.    wire_
-0002a8e0: 7769 6474 6820 3a20 696e 7420 6f72 2066  width : int or f
-0002a8f0: 6c6f 6174 0a20 2020 2020 2020 2057 6964  loat.        Wid
-0002a900: 7468 206f 6620 7468 6520 7769 7265 2e0a  th of the wire..
-0002a910: 2020 2020 7769 7265 5f70 6974 6368 203a      wire_pitch :
-0002a920: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
-0002a930: 2020 2020 2020 4469 7374 616e 6365 2062        Distance b
-0002a940: 6574 7765 656e 2074 776f 2061 646a 6163  etween two adjac
-0002a950: 656e 7420 7769 7265 732e 204d 7573 7420  ent wires. Must 
-0002a960: 6265 2067 7265 6174 6572 2074 6861 6e20  be greater than 
-0002a970: 6077 6964 7468 602e 0a20 2020 2068 6178  `width`..    hax
-0002a980: 6973 203a 2069 6e74 206f 7220 666c 6f61  is : int or floa
-0002a990: 740a 2020 2020 2020 2020 4c65 6e67 7468  t.        Length
-0002a9a0: 206f 6620 686f 7269 7a6f 6e74 616c 2064   of horizontal d
-0002a9b0: 6961 676f 6e61 6c20 6f66 2074 6865 2072  iagonal of the r
-0002a9c0: 686f 6d62 6f69 6461 6c20 6163 7469 7665  homboidal active
-0002a9d0: 2061 7265 612e 0a20 2020 2020 2020 2054   area..        T
-0002a9e0: 6865 2070 6172 616d 6574 6572 2060 6861  he parameter `ha
-0002a9f0: 7869 7360 2069 7320 7072 696f 7269 7469  xis` is prioriti
-0002aa00: 7a65 6420 6f76 6572 2060 7661 7869 7360  zed over `vaxis`
-0002aa10: 2e0a 2020 2020 7661 7869 7320 3a20 696e  ..    vaxis : in
-0002aa20: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
-0002aa30: 2020 204c 656e 6774 6820 6f66 2076 6572     Length of ver
-0002aa40: 7469 6361 6c20 6469 6167 6f6e 616c 206f  tical diagonal o
-0002aa50: 6620 7468 6520 7268 6f6d 626f 6964 616c  f the rhomboidal
-0002aa60: 2061 6374 6976 6520 6172 6561 2e0a 2020   active area..  
-0002aa70: 2020 6571 7561 6c69 7a65 5f70 6174 685f    equalize_path_
-0002aa80: 6c65 6e67 7468 7320 3a20 626f 6f6c 0a20  lengths : bool. 
-0002aa90: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-0002aaa0: 6164 6473 2077 6972 6520 7365 676d 656e  adds wire segmen
-0002aab0: 7473 2074 6f20 6861 6972 7069 6e20 6265  ts to hairpin be
-0002aac0: 6e64 7320 746f 2065 7175 616c 697a 6520  nds to equalize 
-0002aad0: 7061 7468 206c 656e 6774 6873 0a20 2020  path lengths.   
-0002aae0: 2020 2020 2066 726f 6d20 6365 6e74 6572       from center
-0002aaf0: 2074 6f20 6365 6e74 6572 2066 6f72 2061   to center for a
-0002ab00: 6c6c 2070 6172 616c 6c65 6c20 7769 7265  ll parallel wire
-0002ab10: 7320 696e 2061 6374 6976 6520 6172 6561  s in active area
-0002ab20: 2e0a 2020 2020 7877 696e 6720 3a20 626f  ..    xwing : bo
-0002ab30: 6f6c 0a20 2020 2020 2020 2049 6620 5472  ol.        If Tr
-0002ab40: 7565 2c20 7265 706c 6163 6573 2039 302d  ue, replaces 90-
-0002ab50: 6465 6772 6565 2062 656e 6473 2077 6974  degree bends wit
-0002ab60: 6820 3133 352d 6465 6772 6565 2062 656e  h 135-degree ben
-0002ab70: 6473 2e0a 2020 2020 6c61 7965 7220 3a20  ds..    layer : 
-0002ab80: 696e 740a 2020 2020 2020 2020 5370 6563  int.        Spec
-0002ab90: 6966 6963 206c 6179 6572 2074 6f20 7075  ific layer to pu
-0002aba0: 7420 706f 6c79 676f 6e20 6765 6f6d 6574  t polygon geomet
-0002abb0: 7279 206f 6e2e 0a0a 2020 2020 5265 7475  ry on...    Retu
-0002abc0: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
-0002abd0: 2020 2020 4420 3a20 4465 7669 6365 0a20      D : Device. 
-0002abe0: 2020 2020 2020 2041 2044 6576 6963 6520         A Device 
-0002abf0: 636f 6e74 6169 6e69 6e67 2061 6e20 6f70  containing an op
-0002ac00: 7469 6d61 6c6c 792d 726f 756e 6465 6420  timally-rounded 
-0002ac10: 534e 5350 4420 7769 7468 206d 696e 696d  SNSPD with minim
-0002ac20: 697a 6564 2063 7572 7265 6e74 0a20 2020  ized current.   
-0002ac30: 2020 2020 2063 726f 7764 696e 6720 666f       crowding fo
-0002ac40: 7220 616e 7920 6669 6c6c 2066 6163 746f  r any fill facto
-0002ac50: 722e 0a20 2020 2022 2222 0a0a 2020 2020  r..    """..    
-0002ac60: 6465 6620 6f66 665f 6178 6973 5f75 7475  def off_axis_utu
-0002ac70: 726e 280a 2020 2020 2020 2020 7769 7265  rn(.        wire
-0002ac80: 5f77 6964 7468 3d30 2e35 322c 0a20 2020  _width=0.52,.   
-0002ac90: 2020 2020 2077 6972 655f 7069 7463 683d       wire_pitch=
-0002aca0: 302e 3536 2c0a 2020 2020 2020 2020 7066  0.56,.        pf
-0002acb0: 6163 743d 3130 2e30 202f 2033 2c0a 2020  act=10.0 / 3,.  
-0002acc0: 2020 2020 2020 7368 6172 703d 4661 6c73        sharp=Fals
-0002acd0: 652c 0a20 2020 2020 2020 2070 6164 5f6c  e,.        pad_l
-0002ace0: 656e 6774 683d 302c 0a20 2020 2020 2020  ength=0,.       
-0002acf0: 206c 6179 6572 3d30 2c0a 2020 2020 293a   layer=0,.    ):
-0002ad00: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-0002ad10: 726e 7320 7068 6964 6c20 6465 7669 6365  rns phidl device
-0002ad20: 206c 6f77 2d63 726f 7764 696e 6720 752d   low-crowding u-
-0002ad30: 7475 726e 2066 6f72 2063 616e 6465 6c61  turn for candela
-0002ad40: 6272 6120 6d65 616e 6465 722e 2222 220a  bra meander.""".
-0002ad50: 2020 2020 2020 2020 6261 7263 203d 206f          barc = o
-0002ad60: 7074 696d 616c 5f39 3064 6567 2877 6964  ptimal_90deg(wid
-0002ad70: 7468 3d77 6972 655f 7769 6474 682c 206c  th=wire_width, l
-0002ad80: 6179 6572 3d6c 6179 6572 290a 2020 2020  ayer=layer).    
-0002ad90: 2020 2020 6966 206e 6f74 2073 6861 7270      if not sharp
-0002ada0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0002adb0: 466f 7220 6e6f 6e2d 726f 756e 6465 6420  For non-rounded 
-0002adc0: 6f75 7465 7220 7261 6469 690a 2020 2020  outer radii.    
-0002add0: 2020 2020 2020 2020 2320 4e6f 7420 6675          # Not fu
-0002ade0: 6c6c 7920 696d 706c 656d 656e 7465 640a  lly implemented.
-0002adf0: 2020 2020 2020 2020 2020 2020 706f 7274              port
-0002ae00: 316d 7020 3d20 5b62 6172 632e 706f 7274  1mp = [barc.port
-0002ae10: 735b 315d 2e78 2c20 6261 7263 2e70 6f72  s[1].x, barc.por
-0002ae20: 7473 5b31 5d2e 795d 0a20 2020 2020 2020  ts[1].y].       
-0002ae30: 2020 2020 2070 6f72 7431 6f72 203d 2062       port1or = b
-0002ae40: 6172 632e 706f 7274 735b 315d 2e6f 7269  arc.ports[1].ori
-0002ae50: 656e 7461 7469 6f6e 0a20 2020 2020 2020  entation.       
-0002ae60: 2020 2020 2070 6f72 7432 6d70 203d 205b       port2mp = [
-0002ae70: 6261 7263 2e70 6f72 7473 5b32 5d2e 782c  barc.ports[2].x,
-0002ae80: 2062 6172 632e 706f 7274 735b 325d 2e79   barc.ports[2].y
-0002ae90: 5d0a 2020 2020 2020 2020 2020 2020 706f  ].            po
-0002aea0: 7274 326f 7220 3d20 6261 7263 2e70 6f72  rt2or = barc.por
-0002aeb0: 7473 5b32 5d2e 6f72 6965 6e74 6174 696f  ts[2].orientatio
-0002aec0: 6e0a 2020 2020 2020 2020 2020 2020 6261  n.            ba
-0002aed0: 7263 203d 2062 6f6f 6c65 616e 280a 2020  rc = boolean(.  
-0002aee0: 2020 2020 2020 2020 2020 2020 2020 413d                A=
-0002aef0: 6261 7263 2c0a 2020 2020 2020 2020 2020  barc,.          
-0002af00: 2020 2020 2020 423d 636f 7079 2862 6172        B=copy(bar
-0002af10: 6329 2e6d 6f76 6528 5b2d 7769 7265 5f77  c).move([-wire_w
-0002af20: 6964 7468 2c20 2d77 6972 655f 7769 6474  idth, -wire_widt
-0002af30: 685d 292c 0a20 2020 2020 2020 2020 2020  h]),.           
-0002af40: 2020 2020 206f 7065 7261 7469 6f6e 3d22       operation="
-0002af50: 6e6f 7422 2c0a 2020 2020 2020 2020 2020  not",.          
-0002af60: 2020 2020 2020 6c61 7965 723d 6c61 7965        layer=laye
-0002af70: 722c 0a20 2020 2020 2020 2020 2020 2029  r,.            )
-0002af80: 0a20 2020 2020 2020 2020 2020 2062 6172  .            bar
-0002af90: 632e 6164 645f 706f 7274 280a 2020 2020  c.add_port(.    
-0002afa0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-0002afb0: 3d31 2c20 6d69 6470 6f69 6e74 3d70 6f72  =1, midpoint=por
-0002afc0: 7431 6d70 2c20 7769 6474 683d 7769 7265  t1mp, width=wire
-0002afd0: 5f77 6964 7468 2c20 6f72 6965 6e74 6174  _width, orientat
-0002afe0: 696f 6e3d 706f 7274 316f 720a 2020 2020  ion=port1or.    
-0002aff0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0002b000: 2020 2020 2020 6261 7263 2e61 6464 5f70        barc.add_p
-0002b010: 6f72 7428 0a20 2020 2020 2020 2020 2020  ort(.           
-0002b020: 2020 2020 206e 616d 653d 322c 206d 6964       name=2, mid
-0002b030: 706f 696e 743d 706f 7274 326d 702c 2077  point=port2mp, w
-0002b040: 6964 7468 3d77 6972 655f 7769 6474 682c  idth=wire_width,
-0002b050: 206f 7269 656e 7461 7469 6f6e 3d70 6f72   orientation=por
-0002b060: 7432 6f72 0a20 2020 2020 2020 2020 2020  t2or.           
-0002b070: 2029 0a20 2020 2020 2020 2070 696e 203d   ).        pin =
-0002b080: 206f 7074 696d 616c 5f68 6169 7270 696e   optimal_hairpin
-0002b090: 280a 2020 2020 2020 2020 2020 2020 7769  (.            wi
-0002b0a0: 6474 683d 7769 7265 5f77 6964 7468 2c0a  dth=wire_width,.
-0002b0b0: 2020 2020 2020 2020 2020 2020 7069 7463              pitc
-0002b0c0: 683d 7066 6163 7420 2a20 7769 7265 5f77  h=pfact * wire_w
-0002b0d0: 6964 7468 2c0a 2020 2020 2020 2020 2020  idth,.          
-0002b0e0: 2020 6c65 6e67 7468 3d38 202a 2077 6972    length=8 * wir
-0002b0f0: 655f 7769 6474 682c 0a20 2020 2020 2020  e_width,.       
-0002b100: 2020 2020 206c 6179 6572 3d6c 6179 6572       layer=layer
-0002b110: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-0002b120: 2020 2020 7061 7320 3d20 636f 6d70 6173      pas = compas
-0002b130: 7328 7369 7a65 3d28 7769 7265 5f77 6964  s(size=(wire_wid
-0002b140: 7468 2c20 7769 7265 5f70 6974 6368 292c  th, wire_pitch),
-0002b150: 206c 6179 6572 3d6c 6179 6572 290a 2020   layer=layer).  
-0002b160: 2020 2020 2020 4420 3d20 4465 7669 6365        D = Device
-0002b170: 2829 0a20 2020 2020 2020 2061 7263 3120  ().        arc1 
-0002b180: 3d20 442e 6164 645f 7265 6628 6261 7263  = D.add_ref(barc
-0002b190: 290a 2020 2020 2020 2020 6172 6331 2e72  ).        arc1.r
-0002b1a0: 6f74 6174 6528 3930 290a 2020 2020 2020  otate(90).      
-0002b1b0: 2020 7069 6e31 203d 2044 2e61 6464 5f72    pin1 = D.add_r
-0002b1c0: 6566 2870 696e 290a 2020 2020 2020 2020  ef(pin).        
-0002b1d0: 7069 6e31 2e63 6f6e 6e65 6374 2831 2c20  pin1.connect(1, 
-0002b1e0: 6172 6331 2e70 6f72 7473 5b32 5d29 0a20  arc1.ports[2]). 
-0002b1f0: 2020 2020 2020 2070 6173 3120 3d20 442e         pas1 = D.
-0002b200: 6164 645f 7265 6628 7061 7329 0a20 2020  add_ref(pas).   
-0002b210: 2020 2020 2070 6173 312e 636f 6e6e 6563       pas1.connec
-0002b220: 7428 7061 7331 2e70 6f72 7473 5b22 4e22  t(pas1.ports["N"
-0002b230: 5d2c 2070 696e 312e 706f 7274 735b 325d  ], pin1.ports[2]
-0002b240: 290a 2020 2020 2020 2020 6172 6332 203d  ).        arc2 =
-0002b250: 2044 2e61 6464 5f72 6566 2862 6172 6329   D.add_ref(barc)
-0002b260: 0a20 2020 2020 2020 2061 7263 322e 636f  .        arc2.co
-0002b270: 6e6e 6563 7428 322c 2070 6173 312e 706f  nnect(2, pas1.po
-0002b280: 7274 735b 2253 225d 290a 2020 2020 2020  rts["S"]).      
-0002b290: 2020 6966 2070 6164 5f6c 656e 6774 6820    if pad_length 
-0002b2a0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-0002b2b0: 2070 696e 312e 6d6f 7665 7928 7061 645f   pin1.movey(pad_
-0002b2c0: 6c65 6e67 7468 202a 2030 2e35 290a 2020  length * 0.5).  
-0002b2d0: 2020 2020 2020 2020 2020 7465 6d70 6320            tempc 
-0002b2e0: 3d20 442e 6164 645f 7265 6628 0a20 2020  = D.add_ref(.   
-0002b2f0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-0002b300: 7061 7373 280a 2020 2020 2020 2020 2020  pass(.          
-0002b310: 2020 2020 2020 2020 2020 7369 7a65 3d28            size=(
-0002b320: 7069 6e31 2e70 6f72 7473 5b31 5d2e 7769  pin1.ports[1].wi
-0002b330: 6474 682c 2070 696e 312e 706f 7274 735b  dth, pin1.ports[
-0002b340: 315d 2e79 202d 2061 7263 312e 706f 7274  1].y - arc1.port
-0002b350: 735b 325d 2e79 292c 0a20 2020 2020 2020  s[2].y),.       
-0002b360: 2020 2020 2020 2020 2020 2020 206c 6179               lay
-0002b370: 6572 3d6c 6179 6572 2c0a 2020 2020 2020  er=layer,.      
-0002b380: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0002b390: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0002b3a0: 2020 2020 2020 7465 6d70 632e 636f 6e6e        tempc.conn
-0002b3b0: 6563 7428 224e 222c 2070 696e 312e 706f  ect("N", pin1.po
-0002b3c0: 7274 735b 315d 290a 2020 2020 2020 2020  rts[1]).        
-0002b3d0: 2020 2020 7465 6d70 6320 3d20 442e 6164      tempc = D.ad
-0002b3e0: 645f 7265 6628 0a20 2020 2020 2020 2020  d_ref(.         
-0002b3f0: 2020 2020 2020 2063 6f6d 7061 7373 280a         compass(.
-0002b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b410: 2020 2020 7369 7a65 3d28 7069 6e31 2e70      size=(pin1.p
-0002b420: 6f72 7473 5b32 5d2e 7769 6474 682c 2070  orts[2].width, p
-0002b430: 696e 312e 706f 7274 735b 325d 2e79 202d  in1.ports[2].y -
-0002b440: 2070 6173 312e 706f 7274 735b 224e 225d   pas1.ports["N"]
-0002b450: 2e79 292c 0a20 2020 2020 2020 2020 2020  .y),.           
-0002b460: 2020 2020 2020 2020 206c 6179 6572 3d6c           layer=l
-0002b470: 6179 6572 2c0a 2020 2020 2020 2020 2020  ayer,.          
-0002b480: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0002b490: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0002b4a0: 2020 7465 6d70 632e 636f 6e6e 6563 7428    tempc.connect(
-0002b4b0: 224e 222c 2070 696e 312e 706f 7274 735b  "N", pin1.ports[
-0002b4c0: 325d 290a 2020 2020 2020 2020 442e 6164  2]).        D.ad
-0002b4d0: 645f 706f 7274 280a 2020 2020 2020 2020  d_port(.        
-0002b4e0: 2020 2020 6e61 6d65 3d31 2c0a 2020 2020      name=1,.    
-0002b4f0: 2020 2020 2020 2020 6d69 6470 6f69 6e74          midpoint
-0002b500: 3d61 7263 312e 706f 7274 735b 315d 2e6d  =arc1.ports[1].m
-0002b510: 6964 706f 696e 742c 0a20 2020 2020 2020  idpoint,.       
-0002b520: 2020 2020 2077 6964 7468 3d77 6972 655f       width=wire_
-0002b530: 7769 6474 682c 0a20 2020 2020 2020 2020  width,.         
-0002b540: 2020 206f 7269 656e 7461 7469 6f6e 3d61     orientation=a
-0002b550: 7263 312e 706f 7274 735b 315d 2e6f 7269  rc1.ports[1].ori
-0002b560: 656e 7461 7469 6f6e 2c0a 2020 2020 2020  entation,.      
-0002b570: 2020 290a 2020 2020 2020 2020 442e 6164    ).        D.ad
-0002b580: 645f 706f 7274 280a 2020 2020 2020 2020  d_port(.        
-0002b590: 2020 2020 6e61 6d65 3d32 2c0a 2020 2020      name=2,.    
-0002b5a0: 2020 2020 2020 2020 6d69 6470 6f69 6e74          midpoint
-0002b5b0: 3d61 7263 322e 706f 7274 735b 315d 2e6d  =arc2.ports[1].m
-0002b5c0: 6964 706f 696e 742c 0a20 2020 2020 2020  idpoint,.       
-0002b5d0: 2020 2020 2077 6964 7468 3d77 6972 655f       width=wire_
-0002b5e0: 7769 6474 682c 0a20 2020 2020 2020 2020  width,.         
-0002b5f0: 2020 206f 7269 656e 7461 7469 6f6e 3d61     orientation=a
-0002b600: 7263 322e 706f 7274 735b 315d 2e6f 7269  rc2.ports[1].ori
-0002b610: 656e 7461 7469 6f6e 2c0a 2020 2020 2020  entation,.      
-0002b620: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
-0002b630: 726e 2044 0a0a 2020 2020 6465 6620 7877  rn D..    def xw
-0002b640: 696e 675f 7574 7572 6e28 0a20 2020 2020  ing_uturn(.     
-0002b650: 2020 2077 6972 655f 7769 6474 683d 302e     wire_width=0.
-0002b660: 3532 2c20 7769 7265 5f70 6974 6368 3d30  52, wire_pitch=0
-0002b670: 2e35 362c 2070 6661 6374 3d31 302e 3020  .56, pfact=10.0 
-0002b680: 2f20 332c 2070 6164 5f6c 656e 6774 683d  / 3, pad_length=
-0002b690: 302c 206c 6179 6572 3d30 0a20 2020 2029  0, layer=0.    )
-0002b6a0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-0002b6b0: 7572 6e73 2070 6869 646c 2064 6576 6963  urns phidl devic
-0002b6c0: 6520 6c6f 772d 6372 6f77 6469 6e67 2075  e low-crowding u
-0002b6d0: 2d74 7572 6e20 666f 7220 582d 7769 6e67  -turn for X-wing
-0002b6e0: 206d 6561 6e64 6572 2e22 2222 0a20 2020   meander.""".   
-0002b6f0: 2020 2020 2062 6172 6320 3d20 6172 6328       barc = arc(
-0002b700: 0a20 2020 2020 2020 2020 2020 2072 6164  .            rad
-0002b710: 6975 733d 7769 7265 5f77 6964 7468 202a  ius=wire_width *
-0002b720: 2033 2c20 7769 6474 683d 7769 7265 5f77   3, width=wire_w
-0002b730: 6964 7468 2c20 6c61 7965 723d 6c61 7965  idth, layer=laye
-0002b740: 722c 2074 6865 7461 3d34 350a 2020 2020  r, theta=45.    
-0002b750: 2020 2020 292e 726f 7461 7465 2831 3830      ).rotate(180
-0002b760: 290a 0a20 2020 2020 2020 2070 696e 203d  )..        pin =
-0002b770: 206f 7074 696d 616c 5f68 6169 7270 696e   optimal_hairpin
-0002b780: 280a 2020 2020 2020 2020 2020 2020 7769  (.            wi
-0002b790: 6474 683d 7769 7265 5f77 6964 7468 2c0a  dth=wire_width,.
-0002b7a0: 2020 2020 2020 2020 2020 2020 7069 7463              pitc
-0002b7b0: 683d 7066 6163 7420 2a20 7769 7265 5f77  h=pfact * wire_w
-0002b7c0: 6964 7468 2c0a 2020 2020 2020 2020 2020  idth,.          
-0002b7d0: 2020 6c65 6e67 7468 3d31 3520 2a20 7769    length=15 * wi
-0002b7e0: 7265 5f77 6964 7468 2c0a 2020 2020 2020  re_width,.      
-0002b7f0: 2020 2020 2020 6c61 7965 723d 6c61 7965        layer=laye
-0002b800: 722c 0a20 2020 2020 2020 2029 0a0a 2020  r,.        )..  
-0002b810: 2020 2020 2020 7061 736c 656e 203d 2070        paslen = p
-0002b820: 6661 6374 202a 2077 6972 655f 7769 6474  fact * wire_widt
-0002b830: 6820 2d20 6e70 2e73 7172 7428 3229 202a  h - np.sqrt(2) *
-0002b840: 2077 6972 655f 7069 7463 680a 2020 2020   wire_pitch.    
-0002b850: 2020 2020 7061 7320 3d20 636f 6d70 6173      pas = compas
-0002b860: 7328 7369 7a65 3d28 7769 7265 5f77 6964  s(size=(wire_wid
-0002b870: 7468 2c20 6162 7328 7061 736c 656e 2929  th, abs(paslen))
-0002b880: 2c20 6c61 7965 723d 6c61 7965 7229 0a20  , layer=layer). 
-0002b890: 2020 2020 2020 2044 7465 6d70 203d 2044         Dtemp = D
-0002b8a0: 6576 6963 6528 290a 2020 2020 2020 2020  evice().        
-0002b8b0: 6172 6331 203d 2044 7465 6d70 2e61 6464  arc1 = Dtemp.add
-0002b8c0: 5f72 6566 2862 6172 6329 0a20 2020 2020  _ref(barc).     
-0002b8d0: 2020 2061 7263 312e 726f 7461 7465 2839     arc1.rotate(9
-0002b8e0: 3029 0a20 2020 2020 2020 2070 696e 3120  0).        pin1 
-0002b8f0: 3d20 4474 656d 702e 6164 645f 7265 6628  = Dtemp.add_ref(
-0002b900: 7069 6e29 0a20 2020 2020 2020 2070 6173  pin).        pas
-0002b910: 3120 3d20 4474 656d 702e 6164 645f 7265  1 = Dtemp.add_re
-0002b920: 6628 7061 7329 0a20 2020 2020 2020 2061  f(pas).        a
-0002b930: 7263 3220 3d20 4474 656d 702e 6164 645f  rc2 = Dtemp.add_
-0002b940: 7265 6628 6261 7263 290a 2020 2020 2020  ref(barc).      
-0002b950: 2020 6966 2070 6173 6c65 6e20 3e20 303a    if paslen > 0:
-0002b960: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
-0002b970: 312e 636f 6e6e 6563 7428 7061 7331 2e70  1.connect(pas1.p
-0002b980: 6f72 7473 5b22 5322 5d2c 2061 7263 312e  orts["S"], arc1.
-0002b990: 706f 7274 735b 325d 290a 2020 2020 2020  ports[2]).      
-0002b9a0: 2020 2020 2020 7069 6e31 2e63 6f6e 6e65        pin1.conne
-0002b9b0: 6374 2831 2c20 7061 7331 2e70 6f72 7473  ct(1, pas1.ports
-0002b9c0: 5b22 4e22 5d29 0a20 2020 2020 2020 2020  ["N"]).         
-0002b9d0: 2020 2061 7263 322e 636f 6e6e 6563 7428     arc2.connect(
-0002b9e0: 322c 2070 696e 312e 706f 7274 735b 325d  2, pin1.ports[2]
-0002b9f0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0002ba00: 2020 2020 2020 2020 2020 2020 7069 6e31              pin1
-0002ba10: 2e63 6f6e 6e65 6374 2831 2c20 6172 6331  .connect(1, arc1
-0002ba20: 2e70 6f72 7473 5b32 5d29 0a20 2020 2020  .ports[2]).     
-0002ba30: 2020 2020 2020 2070 6173 312e 636f 6e6e         pas1.conn
-0002ba40: 6563 7428 224e 222c 2070 696e 312e 706f  ect("N", pin1.po
-0002ba50: 7274 735b 325d 290a 2020 2020 2020 2020  rts[2]).        
-0002ba60: 2020 2020 6172 6332 2e63 6f6e 6e65 6374      arc2.connect
-0002ba70: 2832 2c20 7061 7331 2e70 6f72 7473 5b22  (2, pas1.ports["
-0002ba80: 5322 5d29 0a20 2020 2020 2020 2069 6620  S"]).        if 
-0002ba90: 7061 645f 6c65 6e67 7468 203e 2030 3a0a  pad_length > 0:.
-0002baa0: 2020 2020 2020 2020 2020 2020 7069 6e31              pin1
-0002bab0: 2e6d 6f76 6528 5b70 6164 5f6c 656e 6774  .move([pad_lengt
-0002bac0: 6820 2a20 302e 3520 2f20 6e70 2e73 7172  h * 0.5 / np.sqr
-0002bad0: 7428 3229 2c20 7061 645f 6c65 6e67 7468  t(2), pad_length
-0002bae0: 202a 2030 2e35 202f 206e 702e 7371 7274   * 0.5 / np.sqrt
-0002baf0: 2832 295d 290a 2020 2020 2020 2020 2020  (2)]).          
-0002bb00: 2020 6966 2070 6173 6c65 6e20 3e20 303a    if paslen > 0:
-0002bb10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002bb20: 2069 6e64 7831 203d 2032 0a20 2020 2020   indx1 = 2.     
-0002bb30: 2020 2020 2020 2020 2020 2069 6e64 7832             indx2
-0002bb40: 203d 2031 0a20 2020 2020 2020 2020 2020   = 1.           
-0002bb50: 2020 2020 206d 7961 7263 203d 2061 7263       myarc = arc
-0002bb60: 320a 2020 2020 2020 2020 2020 2020 656c  2.            el
-0002bb70: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0002bb80: 2020 2020 696e 6478 3120 3d20 310a 2020      indx1 = 1.  
-0002bb90: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0002bba0: 6478 3220 3d20 320a 2020 2020 2020 2020  dx2 = 2.        
-0002bbb0: 2020 2020 2020 2020 6d79 6172 6320 3d20          myarc = 
-0002bbc0: 6172 6331 0a20 2020 2020 2020 2020 2020  arc1.           
-0002bbd0: 2063 6f6d 7064 6973 7420 3d20 6e70 2e73   compdist = np.s
-0002bbe0: 7172 7428 0a20 2020 2020 2020 2020 2020  qrt(.           
-0002bbf0: 2020 2020 206e 702e 7375 6d28 6e70 2e73       np.sum(np.s
-0002bc00: 7175 6172 6528 7069 6e31 2e70 6f72 7473  quare(pin1.ports
-0002bc10: 5b69 6e64 7831 5d2e 6d69 6470 6f69 6e74  [indx1].midpoint
-0002bc20: 202d 206d 7961 7263 2e70 6f72 7473 5b32   - myarc.ports[2
-0002bc30: 5d2e 6d69 6470 6f69 6e74 2929 0a20 2020  ].midpoint)).   
-0002bc40: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0002bc50: 2020 2020 2020 2074 656d 7063 203d 2044         tempc = D
-0002bc60: 7465 6d70 2e61 6464 5f72 6566 280a 2020  temp.add_ref(.  
-0002bc70: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0002bc80: 6d70 6173 7328 7369 7a65 3d28 7069 6e31  mpass(size=(pin1
-0002bc90: 2e70 6f72 7473 5b69 6e64 7831 5d2e 7769  .ports[indx1].wi
-0002bca0: 6474 682c 2063 6f6d 7064 6973 7429 2c20  dth, compdist), 
-0002bcb0: 6c61 7965 723d 6c61 7965 7229 0a20 2020  layer=layer).   
-0002bcc0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0002bcd0: 2020 2020 2020 2074 656d 7063 2e63 6f6e         tempc.con
-0002bce0: 6e65 6374 2822 4e22 2c20 7069 6e31 2e70  nect("N", pin1.p
-0002bcf0: 6f72 7473 5b69 6e64 7831 5d29 0a20 2020  orts[indx1]).   
-0002bd00: 2020 2020 2020 2020 2063 6f6d 7064 6973           compdis
-0002bd10: 7420 3d20 6e70 2e73 7172 7428 0a20 2020  t = np.sqrt(.   
-0002bd20: 2020 2020 2020 2020 2020 2020 206e 702e               np.
-0002bd30: 7375 6d28 6e70 2e73 7175 6172 6528 7069  sum(np.square(pi
-0002bd40: 6e31 2e70 6f72 7473 5b69 6e64 7832 5d2e  n1.ports[indx2].
-0002bd50: 6d69 6470 6f69 6e74 202d 2070 6173 312e  midpoint - pas1.
-0002bd60: 706f 7274 735b 224e 225d 2e6d 6964 706f  ports["N"].midpo
-0002bd70: 696e 7429 290a 2020 2020 2020 2020 2020  int)).          
-0002bd80: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0002bd90: 7465 6d70 6320 3d20 4474 656d 702e 6164  tempc = Dtemp.ad
-0002bda0: 645f 7265 6628 0a20 2020 2020 2020 2020  d_ref(.         
-0002bdb0: 2020 2020 2020 2063 6f6d 7061 7373 2873         compass(s
-0002bdc0: 697a 653d 2870 696e 312e 706f 7274 735b  ize=(pin1.ports[
-0002bdd0: 696e 6478 325d 2e77 6964 7468 2c20 636f  indx2].width, co
-0002bde0: 6d70 6469 7374 292c 206c 6179 6572 3d6c  mpdist), layer=l
-0002bdf0: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
-0002be00: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0002be10: 7465 6d70 632e 636f 6e6e 6563 7428 224e  tempc.connect("N
-0002be20: 222c 2070 696e 312e 706f 7274 735b 696e  ", pin1.ports[in
-0002be30: 6478 325d 290a 0a20 2020 2020 2020 2044  dx2])..        D
-0002be40: 7465 6d70 2e61 6464 5f70 6f72 7428 0a20  temp.add_port(. 
-0002be50: 2020 2020 2020 2020 2020 206e 616d 653d             name=
-0002be60: 312c 0a20 2020 2020 2020 2020 2020 206d  1,.            m
-0002be70: 6964 706f 696e 743d 6172 6331 2e70 6f72  idpoint=arc1.por
-0002be80: 7473 5b31 5d2e 6d69 6470 6f69 6e74 2c0a  ts[1].midpoint,.
-0002be90: 2020 2020 2020 2020 2020 2020 7769 6474              widt
-0002bea0: 683d 7769 7265 5f77 6964 7468 2c0a 2020  h=wire_width,.  
-0002beb0: 2020 2020 2020 2020 2020 6f72 6965 6e74            orient
-0002bec0: 6174 696f 6e3d 6172 6331 2e70 6f72 7473  ation=arc1.ports
-0002bed0: 5b31 5d2e 6f72 6965 6e74 6174 696f 6e2c  [1].orientation,
-0002bee0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-0002bef0: 2020 2044 7465 6d70 2e61 6464 5f70 6f72     Dtemp.add_por
-0002bf00: 7428 0a20 2020 2020 2020 2020 2020 206e  t(.            n
-0002bf10: 616d 653d 322c 0a20 2020 2020 2020 2020  ame=2,.         
-0002bf20: 2020 206d 6964 706f 696e 743d 6172 6332     midpoint=arc2
-0002bf30: 2e70 6f72 7473 5b31 5d2e 6d69 6470 6f69  .ports[1].midpoi
-0002bf40: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
-0002bf50: 7769 6474 683d 7769 7265 5f77 6964 7468  width=wire_width
-0002bf60: 2c0a 2020 2020 2020 2020 2020 2020 6f72  ,.            or
-0002bf70: 6965 6e74 6174 696f 6e3d 6172 6332 2e70  ientation=arc2.p
-0002bf80: 6f72 7473 5b31 5d2e 6f72 6965 6e74 6174  orts[1].orientat
-0002bf90: 696f 6e2c 0a20 2020 2020 2020 2029 0a0a  ion,.        )..
-0002bfa0: 2020 2020 2020 2020 7265 7475 726e 2044          return D
-0002bfb0: 7465 6d70 0a0a 2020 2020 4420 3d20 4465  temp..    D = De
-0002bfc0: 7669 6365 286e 616d 653d 2273 6e73 7064  vice(name="snspd
-0002bfd0: 5f63 616e 6465 6c61 6272 6122 290a 2020  _candelabra").  
-0002bfe0: 2020 6966 2078 7769 6e67 3a0a 2020 2020    if xwing:.    
-0002bff0: 2020 2020 4474 656d 7020 3d20 7877 696e      Dtemp = xwin
-0002c000: 675f 7574 7572 6e28 7769 7265 5f77 6964  g_uturn(wire_wid
-0002c010: 7468 3d77 6972 655f 7769 6474 682c 2077  th=wire_width, w
-0002c020: 6972 655f 7069 7463 683d 7769 7265 5f70  ire_pitch=wire_p
-0002c030: 6974 6368 2c20 6c61 7965 723d 6c61 7965  itch, layer=laye
-0002c040: 7229 0a20 2020 2065 6c73 653a 0a20 2020  r).    else:.   
-0002c050: 2020 2020 2044 7465 6d70 203d 206f 6666       Dtemp = off
-0002c060: 5f61 7869 735f 7574 7572 6e28 0a20 2020  _axis_uturn(.   
-0002c070: 2020 2020 2020 2020 2077 6972 655f 7769           wire_wi
-0002c080: 6474 683d 7769 7265 5f77 6964 7468 2c20  dth=wire_width, 
-0002c090: 7769 7265 5f70 6974 6368 3d77 6972 655f  wire_pitch=wire_
-0002c0a0: 7069 7463 682c 206c 6179 6572 3d6c 6179  pitch, layer=lay
-0002c0b0: 6572 0a20 2020 2020 2020 2029 0a20 2020  er.        ).   
-0002c0c0: 2044 7465 6d70 5f6d 6972 726f 7265 6420   Dtemp_mirrored 
-0002c0d0: 3d20 6465 6570 636f 7079 2844 7465 6d70  = deepcopy(Dtemp
-0002c0e0: 292e 6d69 7272 6f72 285b 302c 2030 5d2c  ).mirror([0, 0],
-0002c0f0: 205b 302c 2031 5d29 0a20 2020 2070 6164   [0, 1]).    pad
-0002c100: 6469 6e67 203d 2044 7465 6d70 2e78 7369  ding = Dtemp.xsi
-0002c110: 7a65 0a20 2020 206d 6178 6c6c 203d 2068  ze.    maxll = h
-0002c120: 6178 6973 202d 2032 202a 2070 6164 6469  axis - 2 * paddi
-0002c130: 6e67 0a20 2020 2064 6c6c 203d 2061 6273  ng.    dll = abs
-0002c140: 2844 7465 6d70 2e70 6f72 7473 5b31 5d2e  (Dtemp.ports[1].
-0002c150: 7820 2d20 4474 656d 702e 706f 7274 735b  x - Dtemp.ports[
-0002c160: 325d 2e78 2920 2b20 7769 7265 5f70 6974  2].x) + wire_pit
-0002c170: 6368 0a20 2020 2068 616c 665f 6e75 6d5f  ch.    half_num_
-0002c180: 6d65 616e 6465 7273 203d 2069 6e74 286e  meanders = int(n
-0002c190: 702e 6365 696c 2830 2e35 202a 2076 6178  p.ceil(0.5 * vax
-0002c1a0: 6973 202f 2077 6972 655f 7069 7463 6829  is / wire_pitch)
-0002c1b0: 2920 2b20 320a 0a20 2020 2069 6620 7877  ) + 2..    if xw
-0002c1c0: 696e 673a 0a20 2020 2020 2020 2062 656e  ing:.        ben
-0002c1d0: 6420 3d20 442e 6164 645f 7265 6628 0a20  d = D.add_ref(. 
-0002c1e0: 2020 2020 2020 2020 2020 2061 7263 2872             arc(r
-0002c1f0: 6164 6975 733d 7769 7265 5f77 6964 7468  adius=wire_width
-0002c200: 202a 2033 2c20 7769 6474 683d 7769 7265   * 3, width=wire
-0002c210: 5f77 6964 7468 2c20 7468 6574 613d 3930  _width, theta=90
-0002c220: 2c20 6c61 7965 723d 6c61 7965 7229 0a20  , layer=layer). 
-0002c230: 2020 2020 2020 2029 2e72 6f74 6174 6528         ).rotate(
-0002c240: 3138 3029 0a20 2020 2065 6c73 653a 0a20  180).    else:. 
-0002c250: 2020 2020 2020 2062 656e 6420 3d20 442e         bend = D.
-0002c260: 6164 645f 7265 6628 6f70 7469 6d61 6c5f  add_ref(optimal_
-0002c270: 3930 6465 6728 7769 6474 683d 7769 7265  90deg(width=wire
-0002c280: 5f77 6964 7468 2c20 6c61 7965 723d 6c61  _width, layer=la
-0002c290: 7965 7229 290a 2020 2020 6966 2028 6d61  yer)).    if (ma
-0002c2a0: 786c 6c20 2d20 646c 6c20 2a20 6861 6c66  xll - dll * half
-0002c2b0: 5f6e 756d 5f6d 6561 6e64 6572 7329 203c  _num_meanders) <
-0002c2c0: 3d20 302e 303a 0a20 2020 2020 2020 2077  = 0.0:.        w
-0002c2d0: 6869 6c65 2028 6d61 786c 6c20 2d20 646c  hile (maxll - dl
-0002c2e0: 6c20 2a20 6861 6c66 5f6e 756d 5f6d 6561  l * half_num_mea
-0002c2f0: 6e64 6572 7329 203c 3d20 302e 303a 0a20  nders) <= 0.0:. 
-0002c300: 2020 2020 2020 2020 2020 2068 616c 665f             half_
-0002c310: 6e75 6d5f 6d65 616e 6465 7273 203d 2068  num_meanders = h
-0002c320: 616c 665f 6e75 6d5f 6d65 616e 6465 7273  alf_num_meanders
-0002c330: 202d 2031 0a20 2020 2066 7061 7320 3d20   - 1.    fpas = 
-0002c340: 442e 6164 645f 7265 6628 0a20 2020 2020  D.add_ref(.     
-0002c350: 2020 2063 6f6d 7061 7373 2873 697a 653d     compass(size=
-0002c360: 2830 2e35 202a 2028 6d61 786c 6c20 2d20  (0.5 * (maxll - 
-0002c370: 646c 6c20 2a20 6861 6c66 5f6e 756d 5f6d  dll * half_num_m
-0002c380: 6561 6e64 6572 7329 2c20 7769 7265 5f77  eanders), wire_w
-0002c390: 6964 7468 292c 206c 6179 6572 3d6c 6179  idth), layer=lay
-0002c3a0: 6572 290a 2020 2020 290a 2020 2020 442e  er).    ).    D.
-0002c3b0: 6d6f 7665 7828 2d62 656e 642e 706f 7274  movex(-bend.port
-0002c3c0: 735b 315d 2e78 290a 2020 2020 6670 6173  s[1].x).    fpas
-0002c3d0: 2e63 6f6e 6e65 6374 2866 7061 732e 706f  .connect(fpas.po
-0002c3e0: 7274 735b 2257 225d 2c20 6265 6e64 2e70  rts["W"], bend.p
-0002c3f0: 6f72 7473 5b32 5d29 0a20 2020 206c 6c20  orts[2]).    ll 
-0002c400: 3d20 442e 7873 697a 6520 2a20 3220 2d20  = D.xsize * 2 - 
-0002c410: 7769 7265 5f77 6964 7468 0a20 2020 2069  wire_width.    i
-0002c420: 6620 6571 7561 6c69 7a65 5f70 6174 685f  f equalize_path_
-0002c430: 6c65 6e67 7468 733a 0a20 2020 2020 2020  lengths:.       
-0002c440: 2069 6620 7877 696e 673a 0a20 2020 2020   if xwing:.     
-0002c450: 2020 2020 2020 2044 7465 6d70 203d 2078         Dtemp = x
-0002c460: 7769 6e67 5f75 7475 726e 280a 2020 2020  wing_uturn(.    
-0002c470: 2020 2020 2020 2020 2020 2020 7769 7265              wire
-0002c480: 5f77 6964 7468 3d77 6972 655f 7769 6474  _width=wire_widt
-0002c490: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
-0002c4a0: 2020 2077 6972 655f 7069 7463 683d 7769     wire_pitch=wi
-0002c4b0: 7265 5f70 6974 6368 2c0a 2020 2020 2020  re_pitch,.      
-0002c4c0: 2020 2020 2020 2020 2020 7061 645f 6c65            pad_le
-0002c4d0: 6e67 7468 3d28 6d61 786c 6c20 2d20 6c6c  ngth=(maxll - ll
-0002c4e0: 202d 2064 6c6c 2920 2a20 6571 7561 6c69   - dll) * equali
-0002c4f0: 7a65 5f70 6174 685f 6c65 6e67 7468 732c  ze_path_lengths,
-0002c500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002c510: 206c 6179 6572 3d6c 6179 6572 2c0a 2020   layer=layer,.  
-0002c520: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0002c530: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0002c540: 2020 2020 2020 4474 656d 7020 3d20 6f66        Dtemp = of
-0002c550: 665f 6178 6973 5f75 7475 726e 280a 2020  f_axis_uturn(.  
-0002c560: 2020 2020 2020 2020 2020 2020 2020 7769                wi
-0002c570: 7265 5f77 6964 7468 3d77 6972 655f 7769  re_width=wire_wi
-0002c580: 6474 682c 0a20 2020 2020 2020 2020 2020  dth,.           
-0002c590: 2020 2020 2077 6972 655f 7069 7463 683d       wire_pitch=
-0002c5a0: 7769 7265 5f70 6974 6368 2c0a 2020 2020  wire_pitch,.    
-0002c5b0: 2020 2020 2020 2020 2020 2020 7061 645f              pad_
-0002c5c0: 6c65 6e67 7468 3d28 6d61 786c 6c20 2d20  length=(maxll - 
-0002c5d0: 6c6c 202d 2064 6c6c 2920 2a20 6571 7561  ll - dll) * equa
-0002c5e0: 6c69 7a65 5f70 6174 685f 6c65 6e67 7468  lize_path_length
-0002c5f0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-0002c600: 2020 206c 6179 6572 3d6c 6179 6572 2c0a     layer=layer,.
-0002c610: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0002c620: 2020 7574 7572 6e20 3d20 442e 6164 645f    uturn = D.add_
-0002c630: 7265 6628 4474 656d 7029 0a20 2020 2075  ref(Dtemp).    u
-0002c640: 7475 726e 2e63 6f6e 6e65 6374 2831 2c20  turn.connect(1, 
-0002c650: 6670 6173 2e70 6f72 7473 5b22 4522 5d29  fpas.ports["E"])
-0002c660: 0a20 2020 2064 6972 5f6c 6566 7420 3d20  .    dir_left = 
-0002c670: 5472 7565 0a0a 2020 2020 7475 726e 5f70  True..    turn_p
-0002c680: 6164 6469 6e67 203d 206d 6178 6c6c 202d  adding = maxll -
-0002c690: 206c 6c20 2d20 3220 2a20 646c 6c0a 0a20   ll - 2 * dll.. 
-0002c6a0: 2020 2077 6869 6c65 206c 6c20 3c20 6d61     while ll < ma
-0002c6b0: 786c 6c20 2d20 646c 6c3a 0a20 2020 2020  xll - dll:.     
-0002c6c0: 2020 206c 6c20 3d20 6c6c 202b 2064 6c6c     ll = ll + dll
-0002c6d0: 0a20 2020 2020 2020 2069 6620 6571 7561  .        if equa
-0002c6e0: 6c69 7a65 5f70 6174 685f 6c65 6e67 7468  lize_path_length
-0002c6f0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-0002c700: 6620 7877 696e 673a 0a20 2020 2020 2020  f xwing:.       
-0002c710: 2020 2020 2020 2020 2044 7465 6d70 203d           Dtemp =
-0002c720: 2078 7769 6e67 5f75 7475 726e 280a 2020   xwing_uturn(.  
-0002c730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c740: 2020 7769 7265 5f77 6964 7468 3d77 6972    wire_width=wir
-0002c750: 655f 7769 6474 682c 0a20 2020 2020 2020  e_width,.       
-0002c760: 2020 2020 2020 2020 2020 2020 2077 6972               wir
-0002c770: 655f 7069 7463 683d 7769 7265 5f70 6974  e_pitch=wire_pit
-0002c780: 6368 2c0a 2020 2020 2020 2020 2020 2020  ch,.            
-0002c790: 2020 2020 2020 2020 7061 645f 6c65 6e67          pad_leng
-0002c7a0: 7468 3d74 7572 6e5f 7061 6464 696e 6720  th=turn_padding 
-0002c7b0: 2a20 6571 7561 6c69 7a65 5f70 6174 685f  * equalize_path_
-0002c7c0: 6c65 6e67 7468 732c 0a20 2020 2020 2020  lengths,.       
-0002c7d0: 2020 2020 2020 2020 2020 2020 206c 6179               lay
-0002c7e0: 6572 3d6c 6179 6572 2c0a 2020 2020 2020  er=layer,.      
-0002c7f0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0002c800: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002c810: 2020 2020 2020 2020 2020 2020 2020 4474                Dt
-0002c820: 656d 7020 3d20 6f66 665f 6178 6973 5f75  emp = off_axis_u
-0002c830: 7475 726e 280a 2020 2020 2020 2020 2020  turn(.          
-0002c840: 2020 2020 2020 2020 2020 7769 7265 5f77            wire_w
-0002c850: 6964 7468 3d77 6972 655f 7769 6474 682c  idth=wire_width,
-0002c860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002c870: 2020 2020 2077 6972 655f 7069 7463 683d       wire_pitch=
-0002c880: 7769 7265 5f70 6974 6368 2c0a 2020 2020  wire_pitch,.    
-0002c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c8a0: 7061 645f 6c65 6e67 7468 3d74 7572 6e5f  pad_length=turn_
-0002c8b0: 7061 6464 696e 6720 2a20 6571 7561 6c69  padding * equali
-0002c8c0: 7a65 5f70 6174 685f 6c65 6e67 7468 732c  ze_path_lengths,
-0002c8d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002c8e0: 2020 2020 206c 6179 6572 3d6c 6179 6572       layer=layer
-0002c8f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002c900: 2020 290a 2020 2020 2020 2020 7475 726e    ).        turn
-0002c910: 5f70 6164 6469 6e67 203d 2074 7572 6e5f  _padding = turn_
-0002c920: 7061 6464 696e 6720 2d20 646c 6c0a 2020  padding - dll.  
-0002c930: 2020 2020 2020 6e65 7770 6173 203d 2044        newpas = D
-0002c940: 2e61 6464 5f72 6566 2863 6f6d 7061 7373  .add_ref(compass
-0002c950: 2873 697a 653d 286c 6c2c 2077 6972 655f  (size=(ll, wire_
-0002c960: 7769 6474 6829 2c20 6c61 7965 723d 6c61  width), layer=la
-0002c970: 7965 7229 290a 2020 2020 2020 2020 6966  yer)).        if
-0002c980: 2064 6972 5f6c 6566 743a 0a20 2020 2020   dir_left:.     
-0002c990: 2020 2020 2020 206e 6577 7061 732e 636f         newpas.co
-0002c9a0: 6e6e 6563 7428 6e65 7770 6173 2e70 6f72  nnect(newpas.por
-0002c9b0: 7473 5b22 4522 5d2c 2075 7475 726e 2e70  ts["E"], uturn.p
-0002c9c0: 6f72 7473 5b32 5d29 0a20 2020 2020 2020  orts[2]).       
-0002c9d0: 2020 2020 2069 6620 6571 7561 6c69 7a65       if equalize
-0002c9e0: 5f70 6174 685f 6c65 6e67 7468 733a 0a20  _path_lengths:. 
-0002c9f0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-0002ca00: 7475 726e 203d 2044 2e61 6464 5f72 6566  turn = D.add_ref
-0002ca10: 2844 7465 6d70 2e6d 6972 726f 7228 5b30  (Dtemp.mirror([0
-0002ca20: 2c20 305d 2c20 5b30 2c20 315d 2929 0a20  , 0], [0, 1])). 
-0002ca30: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0002ca40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002ca50: 2075 7475 726e 203d 2044 2e61 6464 5f72   uturn = D.add_r
-0002ca60: 6566 2844 7465 6d70 5f6d 6972 726f 7265  ef(Dtemp_mirrore
-0002ca70: 6429 0a20 2020 2020 2020 2020 2020 2075  d).            u
-0002ca80: 7475 726e 2e63 6f6e 6e65 6374 2831 2c20  turn.connect(1, 
-0002ca90: 6e65 7770 6173 2e70 6f72 7473 5b22 5722  newpas.ports["W"
-0002caa0: 5d29 0a20 2020 2020 2020 2020 2020 2064  ]).            d
-0002cab0: 6972 5f6c 6566 7420 3d20 4661 6c73 650a  ir_left = False.
-0002cac0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002cad0: 2020 2020 2020 2020 2020 6e65 7770 6173            newpas
-0002cae0: 2e63 6f6e 6e65 6374 286e 6577 7061 732e  .connect(newpas.
-0002caf0: 706f 7274 735b 2257 225d 2c20 7574 7572  ports["W"], utur
-0002cb00: 6e2e 706f 7274 735b 325d 290a 2020 2020  n.ports[2]).    
-0002cb10: 2020 2020 2020 2020 7574 7572 6e20 3d20          uturn = 
-0002cb20: 442e 6164 645f 7265 6628 4474 656d 7029  D.add_ref(Dtemp)
-0002cb30: 0a20 2020 2020 2020 2020 2020 2075 7475  .            utu
-0002cb40: 726e 2e63 6f6e 6e65 6374 2831 2c20 6e65  rn.connect(1, ne
-0002cb50: 7770 6173 2e70 6f72 7473 5b22 4522 5d29  wpas.ports["E"])
-0002cb60: 0a20 2020 2020 2020 2020 2020 2064 6972  .            dir
-0002cb70: 5f6c 6566 7420 3d20 5472 7565 0a0a 2020  _left = True..  
-0002cb80: 2020 6e65 7770 6173 203d 2044 2e61 6464    newpas = D.add
-0002cb90: 5f72 6566 2863 6f6d 7061 7373 2873 697a  _ref(compass(siz
-0002cba0: 653d 286c 6c20 2f20 322c 2077 6972 655f  e=(ll / 2, wire_
-0002cbb0: 7769 6474 6829 2c20 6c61 7965 723d 6c61  width), layer=la
-0002cbc0: 7965 7229 290a 2020 2020 6966 2064 6972  yer)).    if dir
-0002cbd0: 5f6c 6566 743a 0a20 2020 2020 2020 206e  _left:.        n
-0002cbe0: 6577 7061 732e 636f 6e6e 6563 7428 6e65  ewpas.connect(ne
-0002cbf0: 7770 6173 2e70 6f72 7473 5b22 4522 5d2c  wpas.ports["E"],
-0002cc00: 2075 7475 726e 2e70 6f72 7473 5b32 5d29   uturn.ports[2])
-0002cc10: 0a20 2020 2020 2020 2064 6972 5f6c 6566  .        dir_lef
-0002cc20: 7420 3d20 4661 6c73 650a 2020 2020 656c  t = False.    el
-0002cc30: 7365 3a0a 2020 2020 2020 2020 6e65 7770  se:.        newp
-0002cc40: 6173 2e63 6f6e 6e65 6374 286e 6577 7061  as.connect(newpa
-0002cc50: 732e 706f 7274 735b 2257 225d 2c20 7574  s.ports["W"], ut
-0002cc60: 7572 6e2e 706f 7274 735b 325d 290a 2020  urn.ports[2]).  
-0002cc70: 2020 2020 2020 6469 725f 6c65 6674 203d        dir_left =
-0002cc80: 2054 7275 650a 0a20 2020 2044 2e6d 6f76   True..    D.mov
-0002cc90: 6578 282d 442e 7829 0a20 2020 2069 6620  ex(-D.x).    if 
-0002cca0: 6e6f 7420 7877 696e 673a 0a20 2020 2020  not xwing:.     
-0002ccb0: 2020 2062 656e 642e 6d6f 7665 7828 2d62     bend.movex(-b
-0002ccc0: 656e 642e 706f 7274 735b 315d 2e78 290a  end.ports[1].x).
-0002ccd0: 2020 2020 6966 2028 6670 6173 2e70 6f72      if (fpas.por
-0002cce0: 7473 5b22 5722 5d2e 7820 2d20 6265 6e64  ts["W"].x - bend
-0002ccf0: 2e70 6f72 7473 5b32 5d2e 7829 203e 2030  .ports[2].x) > 0
-0002cd00: 3a0a 2020 2020 2020 2020 7465 6d70 6320  :.        tempc 
-0002cd10: 3d20 442e 6164 645f 7265 6628 0a20 2020  = D.add_ref(.   
-0002cd20: 2020 2020 2020 2020 2063 6f6d 7061 7373           compass
-0002cd30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0002cd40: 2020 7369 7a65 3d28 6670 6173 2e70 6f72    size=(fpas.por
-0002cd50: 7473 5b22 5722 5d2e 7820 2d20 6265 6e64  ts["W"].x - bend
-0002cd60: 2e70 6f72 7473 5b32 5d2e 782c 2062 656e  .ports[2].x, ben
-0002cd70: 642e 706f 7274 735b 325d 2e77 6964 7468  d.ports[2].width
-0002cd80: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0002cd90: 2020 206c 6179 6572 3d6c 6179 6572 2c0a     layer=layer,.
-0002cda0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0002cdb0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0002cdc0: 7465 6d70 632e 636f 6e6e 6563 7428 2245  tempc.connect("E
-0002cdd0: 222c 2066 7061 732e 706f 7274 735b 2257  ", fpas.ports["W
-0002cde0: 225d 290a 2020 2020 442e 6d6f 7665 285b  "]).    D.move([
-0002cdf0: 2d44 2e78 2c20 2d44 2e79 6d69 6e20 2d20  -D.x, -D.ymin - 
-0002ce00: 7769 7265 5f77 6964 7468 202a 2030 2e35  wire_width * 0.5
-0002ce10: 5d29 0a20 2020 2044 2e61 6464 5f70 6f72  ]).    D.add_por
-0002ce20: 7428 6e61 6d65 3d31 2c20 706f 7274 3d62  t(name=1, port=b
-0002ce30: 656e 642e 706f 7274 735b 315d 290a 2020  end.ports[1]).  
-0002ce40: 2020 6966 2064 6972 5f6c 6566 743a 0a20    if dir_left:. 
-0002ce50: 2020 2020 2020 2044 2e61 6464 5f70 6f72         D.add_por
-0002ce60: 7428 6e61 6d65 3d32 2c20 706f 7274 3d6e  t(name=2, port=n
-0002ce70: 6577 7061 732e 706f 7274 735b 2245 225d  ewpas.ports["E"]
-0002ce80: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
-0002ce90: 2020 2020 442e 6164 645f 706f 7274 286e      D.add_port(n
-0002cea0: 616d 653d 322c 2070 6f72 743d 6e65 7770  ame=2, port=newp
-0002ceb0: 6173 2e70 6f72 7473 5b22 5722 5d29 0a0a  as.ports["W"])..
-0002cec0: 2020 2020 446f 7574 203d 2044 6576 6963      Dout = Devic
-0002ced0: 6528 290a 2020 2020 4431 203d 2044 6f75  e().    D1 = Dou
-0002cee0: 742e 6164 645f 7265 6628 4429 0a20 2020  t.add_ref(D).   
-0002cef0: 2044 3220 3d20 446f 7574 2e61 6464 5f72   D2 = Dout.add_r
-0002cf00: 6566 2863 6f70 7928 4429 2e72 6f74 6174  ef(copy(D).rotat
-0002cf10: 6528 3138 3029 290a 2020 2020 7465 6d70  e(180)).    temp
-0002cf20: 6320 3d20 446f 7574 2e61 6464 5f72 6566  c = Dout.add_ref
-0002cf30: 280a 2020 2020 2020 2020 636f 6d70 6173  (.        compas
-0002cf40: 7328 0a20 2020 2020 2020 2020 2020 2073  s(.            s
-0002cf50: 697a 653d 2861 6273 2844 312e 706f 7274  ize=(abs(D1.port
-0002cf60: 735b 325d 2e78 202d 2044 322e 706f 7274  s[2].x - D2.port
-0002cf70: 735b 325d 2e78 292c 2044 312e 706f 7274  s[2].x), D1.port
-0002cf80: 735b 325d 2e77 6964 7468 292c 206c 6179  s[2].width), lay
-0002cf90: 6572 3d6c 6179 6572 0a20 2020 2020 2020  er=layer.       
-0002cfa0: 2029 0a20 2020 2029 0a20 2020 2069 6620   ).    ).    if 
-0002cfb0: 4431 2e70 6f72 7473 5b32 5d2e 7820 3e20  D1.ports[2].x > 
-0002cfc0: 4432 2e70 6f72 7473 5b32 5d2e 783a 0a20  D2.ports[2].x:. 
-0002cfd0: 2020 2020 2020 2074 656d 7063 2e63 6f6e         tempc.con
-0002cfe0: 6e65 6374 2822 4522 2c20 4431 2e70 6f72  nect("E", D1.por
-0002cff0: 7473 5b32 5d29 0a20 2020 2065 6c73 653a  ts[2]).    else:
-0002d000: 0a20 2020 2020 2020 2074 656d 7063 2e63  .        tempc.c
-0002d010: 6f6e 6e65 6374 2822 5722 2c20 4431 2e70  onnect("W", D1.p
-0002d020: 6f72 7473 5b32 5d29 0a20 2020 2044 6f75  orts[2]).    Dou
-0002d030: 742e 6164 645f 706f 7274 286e 616d 653d  t.add_port(name=
-0002d040: 312c 2070 6f72 743d 4431 2e70 6f72 7473  1, port=D1.ports
-0002d050: 5b31 5d29 0a20 2020 2044 6f75 742e 6164  [1]).    Dout.ad
-0002d060: 645f 706f 7274 286e 616d 653d 322c 2070  d_port(name=2, p
-0002d070: 6f72 743d 4432 2e70 6f72 7473 5b31 5d29  ort=D2.ports[1])
-0002d080: 0a20 2020 2072 6574 7572 6e20 446f 7574  .    return Dout
-0002d090: 0a0a 0a64 6566 2079 7472 6f6e 5f72 6f75  ...def ytron_rou
-0002d0a0: 6e64 280a 2020 2020 7268 6f3d 312c 0a20  nd(.    rho=1,. 
-0002d0b0: 2020 2061 726d 5f6c 656e 6774 6873 3d28     arm_lengths=(
-0002d0c0: 3530 302c 2033 3030 292c 0a20 2020 2073  500, 300),.    s
-0002d0d0: 6f75 7263 655f 6c65 6e67 7468 3d35 3030  ource_length=500
-0002d0e0: 2c0a 2020 2020 6172 6d5f 7769 6474 6873  ,.    arm_widths
-0002d0f0: 3d28 3230 302c 2032 3030 292c 0a20 2020  =(200, 200),.   
-0002d100: 2074 6865 7461 3d32 2e35 2c0a 2020 2020   theta=2.5,.    
-0002d110: 7468 6574 615f 7265 736f 6c75 7469 6f6e  theta_resolution
-0002d120: 3d31 302c 0a20 2020 206c 6179 6572 3d30  =10,.    layer=0
-0002d130: 2c0a 293a 0a20 2020 2022 2222 5974 726f  ,.):.    """Ytro
-0002d140: 6e20 7374 7275 6374 7572 6520 666f 7220  n structure for 
-0002d150: 7375 7065 7263 6f6e 6475 6374 696e 6720  superconducting 
-0002d160: 6e61 6e6f 7769 7265 730a 0a20 2020 204d  nanowires..    M
-0002d170: 6343 6175 6768 616e 2c20 412e 204e 2e2c  cCaughan, A. N.,
-0002d180: 2041 6265 6265 2c20 4e2e 2053 2e2c 205a   Abebe, N. S., Z
-0002d190: 6861 6f2c 2051 2e2d 592e 2026 2042 6572  hao, Q.-Y. & Ber
-0002d1a0: 6767 7265 6e2c 204b 2e20 4b2e 0a20 2020  ggren, K. K..   
-0002d1b0: 2055 7369 6e67 2047 656f 6d65 7472 7920   Using Geometry 
-0002d1c0: 546f 2053 656e 7365 2043 7572 7265 6e74  To Sense Current
-0002d1d0: 2e20 4e61 6e6f 204c 6574 742e 2031 362c  . Nano Lett. 16,
-0002d1e0: 2037 3632 36e2 8093 3736 3331 2028 3230   7626...7631 (20
-0002d1f0: 3136 292e 0a20 2020 2068 7474 703a 2f2f  16)..    http://
-0002d200: 6478 2e64 6f69 2e6f 7267 2f31 302e 3130  dx.doi.org/10.10
-0002d210: 3231 2f61 6373 2e6e 616e 6f6c 6574 742e  21/acs.nanolett.
-0002d220: 3662 3033 3539 330a 0a20 2020 2050 6172  6b03593..    Par
-0002d230: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
-0002d240: 2d2d 2d2d 2d2d 0a20 2020 2072 686f 203a  ------.    rho :
-0002d250: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
-0002d260: 2020 2020 2020 5261 6469 7573 206f 6620        Radius of 
-0002d270: 6375 7276 6174 7572 6520 6f66 2079 7472  curvature of ytr
-0002d280: 6f6e 2069 6e74 6572 7365 6374 696f 6e20  on intersection 
-0002d290: 706f 696e 740a 2020 2020 6172 6d5f 6c65  point.    arm_le
-0002d2a0: 6e67 7468 7320 3a20 6172 7261 792d 6c69  ngths : array-li
-0002d2b0: 6b65 5b32 5d20 6f66 2069 6e74 206f 7220  ke[2] of int or 
-0002d2c0: 666c 6f61 740a 2020 2020 2020 2020 4c65  float.        Le
-0002d2d0: 6e67 7468 7320 6f66 2074 6865 206c 6566  ngths of the lef
-0002d2e0: 7420 616e 6420 7269 6768 7420 6172 6d73  t and right arms
-0002d2f0: 206f 6620 7468 6520 7954 726f 6e2c 2072   of the yTron, r
-0002d300: 6573 7065 6374 6976 656c 792e 0a20 2020  espectively..   
-0002d310: 2073 6f75 7263 655f 6c65 6e67 7468 203a   source_length :
-0002d320: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
-0002d330: 2020 2020 2020 4c65 6e67 7468 206f 6620        Length of 
-0002d340: 7468 6520 736f 7572 6365 206f 6620 7468  the source of th
-0002d350: 6520 7954 726f 6e2e 0a20 2020 2061 726d  e yTron..    arm
-0002d360: 5f77 6964 7468 7320 3a20 6172 7261 792d  _widths : array-
-0002d370: 6c69 6b65 5b32 5d20 6f66 2069 6e74 206f  like[2] of int o
-0002d380: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
-0002d390: 5769 6474 6873 206f 6620 7468 6520 6c65  Widths of the le
-0002d3a0: 6674 2061 6e64 2072 6967 6874 2061 726d  ft and right arm
-0002d3b0: 7320 6f66 2074 6865 2079 5472 6f6e 2c20  s of the yTron, 
-0002d3c0: 7265 7370 6563 7469 7665 6c79 2e0a 2020  respectively..  
-0002d3d0: 2020 7468 6574 6120 3a20 696e 7420 6f72    theta : int or
-0002d3e0: 2066 6c6f 6174 0a20 2020 2020 2020 2041   float.        A
-0002d3f0: 6e67 6c65 2062 6574 7765 656e 2074 6865  ngle between the
-0002d400: 2074 776f 2079 5472 6f6e 2061 726d 732e   two yTron arms.
-0002d410: 0a20 2020 2074 6865 7461 5f72 6573 6f6c  .    theta_resol
-0002d420: 7574 696f 6e20 3a20 696e 7420 6f72 2066  ution : int or f
-0002d430: 6c6f 6174 0a20 2020 2020 2020 2041 6e67  loat.        Ang
-0002d440: 6c65 2072 6573 6f6c 7574 696f 6e20 666f  le resolution fo
-0002d450: 7220 6375 7276 6174 7572 6520 6f66 2079  r curvature of y
-0002d460: 7472 6f6e 2069 6e74 6572 7365 6374 696f  tron intersectio
-0002d470: 6e20 706f 696e 740a 2020 2020 6c61 7965  n point.    laye
-0002d480: 7220 3a20 696e 742c 2061 7272 6179 2d6c  r : int, array-l
-0002d490: 696b 655b 325d 2c20 6f72 2073 6574 0a20  ike[2], or set. 
-0002d4a0: 2020 2020 2020 2053 7065 6369 6669 6320         Specific 
-0002d4b0: 6c61 7965 7228 7329 2074 6f20 7075 7420  layer(s) to put 
-0002d4c0: 706f 6c79 676f 6e20 6765 6f6d 6574 7279  polygon geometry
-0002d4d0: 206f 6e2e 0a0a 2020 2020 5265 7475 726e   on...    Return
-0002d4e0: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-0002d4f0: 2020 4420 3a20 4465 7669 6365 0a20 2020    D : Device.   
-0002d500: 2020 2020 2041 2044 6576 6963 6520 636f       A Device co
-0002d510: 6e74 6169 6e69 6e67 2061 2079 5472 6f6e  ntaining a yTron
-0002d520: 2067 656f 6d65 7472 792e 0a20 2020 2022   geometry..    "
-0002d530: 2222 0a20 2020 2023 203d 3d3d 3d3d 3d3d  "".    # =======
-0002d540: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002d550: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002d560: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002d570: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002d580: 3d3d 3d0a 2020 2020 2320 2043 7265 6174  ===.    #  Creat
-0002d590: 6520 7468 6520 6261 7369 6320 6765 6f6d  e the basic geom
-0002d5a0: 6574 7279 0a20 2020 2023 203d 3d3d 3d3d  etry.    # =====
-0002d5b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002d5c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002d5d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002d5e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002d5f0: 3d3d 3d3d 3d0a 2020 2020 7468 6574 6120  =====.    theta 
-0002d600: 3d20 7468 6574 6120 2a20 7069 202f 2031  = theta * pi / 1
-0002d610: 3830 0a20 2020 2074 6865 7461 5f72 6573  80.    theta_res
-0002d620: 6f6c 7574 696f 6e20 3d20 7468 6574 615f  olution = theta_
-0002d630: 7265 736f 6c75 7469 6f6e 202a 2070 6920  resolution * pi 
-0002d640: 2f20 3138 300a 2020 2020 7468 6574 616c  / 180.    thetal
-0002d650: 6973 7420 3d20 6e70 2e6c 696e 7370 6163  ist = np.linspac
-0002d660: 6528 0a20 2020 2020 2020 202d 2870 6920  e(.        -(pi 
-0002d670: 2d20 7468 6574 6129 2c20 2d74 6865 7461  - theta), -theta
-0002d680: 2c20 696e 7428 2870 6920 2d20 3220 2a20  , int((pi - 2 * 
-0002d690: 7468 6574 6129 202f 2074 6865 7461 5f72  theta) / theta_r
-0002d6a0: 6573 6f6c 7574 696f 6e29 202b 2032 0a20  esolution) + 2. 
-0002d6b0: 2020 2029 0a20 2020 2073 656d 6963 6972     ).    semicir
-0002d6c0: 636c 655f 7820 3d20 7268 6f20 2a20 636f  cle_x = rho * co
-0002d6d0: 7328 7468 6574 616c 6973 7429 0a20 2020  s(thetalist).   
-0002d6e0: 2073 656d 6963 6972 636c 655f 7920 3d20   semicircle_y = 
-0002d6f0: 7268 6f20 2a20 7369 6e28 7468 6574 616c  rho * sin(thetal
-0002d700: 6973 7429 202b 2072 686f 0a0a 2020 2020  ist) + rho..    
-0002d710: 2320 5265 7374 206f 6620 7954 726f 6e0a  # Rest of yTron.
-0002d720: 2020 2020 7863 203d 2072 686f 202a 2063      xc = rho * c
-0002d730: 6f73 2874 6865 7461 290a 2020 2020 7963  os(theta).    yc
-0002d740: 203d 2072 686f 202a 2073 696e 2874 6865   = rho * sin(the
-0002d750: 7461 290a 2020 2020 6172 6d5f 785f 6c65  ta).    arm_x_le
-0002d760: 6674 203d 2061 726d 5f6c 656e 6774 6873  ft = arm_lengths
-0002d770: 5b30 5d20 2a20 7369 6e28 7468 6574 6129  [0] * sin(theta)
-0002d780: 0a20 2020 2061 726d 5f79 5f6c 6566 7420  .    arm_y_left 
-0002d790: 3d20 6172 6d5f 6c65 6e67 7468 735b 305d  = arm_lengths[0]
-0002d7a0: 202a 2063 6f73 2874 6865 7461 290a 2020   * cos(theta).  
-0002d7b0: 2020 6172 6d5f 785f 7269 6768 7420 3d20    arm_x_right = 
-0002d7c0: 6172 6d5f 6c65 6e67 7468 735b 315d 202a  arm_lengths[1] *
-0002d7d0: 2073 696e 2874 6865 7461 290a 2020 2020   sin(theta).    
-0002d7e0: 6172 6d5f 795f 7269 6768 7420 3d20 6172  arm_y_right = ar
-0002d7f0: 6d5f 6c65 6e67 7468 735b 315d 202a 2063  m_lengths[1] * c
-0002d800: 6f73 2874 6865 7461 290a 0a20 2020 2023  os(theta)..    #
-0002d810: 2057 7269 7465 206f 7574 2078 2061 6e64   Write out x and
-0002d820: 2079 2063 6f6f 7264 7320 666f 7220 7954   y coords for yT
-0002d830: 726f 6e20 706f 6c79 676f 6e0a 2020 2020  ron polygon.    
-0002d840: 7870 7473 203d 2073 656d 6963 6972 636c  xpts = semicircl
-0002d850: 655f 782e 746f 6c69 7374 2829 202b 205b  e_x.tolist() + [
-0002d860: 0a20 2020 2020 2020 2078 6320 2b20 6172  .        xc + ar
-0002d870: 6d5f 785f 7269 6768 742c 0a20 2020 2020  m_x_right,.     
-0002d880: 2020 2078 6320 2b20 6172 6d5f 785f 7269     xc + arm_x_ri
-0002d890: 6768 7420 2b20 6172 6d5f 7769 6474 6873  ght + arm_widths
-0002d8a0: 5b31 5d2c 0a20 2020 2020 2020 2078 6320  [1],.        xc 
-0002d8b0: 2b20 6172 6d5f 7769 6474 6873 5b31 5d2c  + arm_widths[1],
-0002d8c0: 0a20 2020 2020 2020 2078 6320 2b20 6172  .        xc + ar
-0002d8d0: 6d5f 7769 6474 6873 5b31 5d2c 0a20 2020  m_widths[1],.   
-0002d8e0: 2020 2020 2030 2c0a 2020 2020 2020 2020       0,.        
-0002d8f0: 2d28 7863 202b 2061 726d 5f77 6964 7468  -(xc + arm_width
-0002d900: 735b 305d 292c 0a20 2020 2020 2020 202d  s[0]),.        -
-0002d910: 2878 6320 2b20 6172 6d5f 7769 6474 6873  (xc + arm_widths
-0002d920: 5b30 5d29 2c0a 2020 2020 2020 2020 2d28  [0]),.        -(
-0002d930: 7863 202b 2061 726d 5f78 5f6c 6566 7420  xc + arm_x_left 
-0002d940: 2b20 6172 6d5f 7769 6474 6873 5b30 5d29  + arm_widths[0])
-0002d950: 2c0a 2020 2020 2020 2020 2d28 7863 202b  ,.        -(xc +
-0002d960: 2061 726d 5f78 5f6c 6566 7429 2c0a 2020   arm_x_left),.  
-0002d970: 2020 5d0a 2020 2020 7970 7473 203d 2073    ].    ypts = s
-0002d980: 656d 6963 6972 636c 655f 792e 746f 6c69  emicircle_y.toli
-0002d990: 7374 2829 202b 205b 0a20 2020 2020 2020  st() + [.       
-0002d9a0: 2079 6320 2b20 6172 6d5f 795f 7269 6768   yc + arm_y_righ
-0002d9b0: 742c 0a20 2020 2020 2020 2079 6320 2b20  t,.        yc + 
-0002d9c0: 6172 6d5f 795f 7269 6768 742c 0a20 2020  arm_y_right,.   
-0002d9d0: 2020 2020 2079 632c 0a20 2020 2020 2020       yc,.       
-0002d9e0: 2079 6320 2d20 736f 7572 6365 5f6c 656e   yc - source_len
-0002d9f0: 6774 682c 0a20 2020 2020 2020 2079 6320  gth,.        yc 
-0002da00: 2d20 736f 7572 6365 5f6c 656e 6774 682c  - source_length,
-0002da10: 0a20 2020 2020 2020 2079 6320 2d20 736f  .        yc - so
-0002da20: 7572 6365 5f6c 656e 6774 682c 0a20 2020  urce_length,.   
-0002da30: 2020 2020 2079 632c 0a20 2020 2020 2020       yc,.       
-0002da40: 2079 6320 2b20 6172 6d5f 795f 6c65 6674   yc + arm_y_left
-0002da50: 2c0a 2020 2020 2020 2020 7963 202b 2061  ,.        yc + a
-0002da60: 726d 5f79 5f6c 6566 742c 0a20 2020 205d  rm_y_left,.    ]
-0002da70: 0a0a 2020 2020 2320 3d3d 3d3d 3d3d 3d3d  ..    # ========
-0002da80: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002da90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002daa0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002dab0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002dac0: 3d3d 0a20 2020 2023 2020 4372 6561 7465  ==.    #  Create
-0002dad0: 2061 2062 6c61 6e6b 2064 6576 6963 652c   a blank device,
-0002dae0: 2061 6464 2074 6865 2067 656f 6d65 7472   add the geometr
-0002daf0: 792c 2061 6e64 2064 6566 696e 6520 7468  y, and define th
-0002db00: 6520 706f 7274 730a 2020 2020 2320 3d3d  e ports.    # ==
-0002db10: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002db20: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002db30: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002db40: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002db50: 3d3d 3d3d 3d3d 3d3d 0a20 2020 2044 203d  ========.    D =
-0002db60: 2044 6576 6963 6528 6e61 6d65 3d22 7974   Device(name="yt
-0002db70: 726f 6e22 290a 2020 2020 442e 6164 645f  ron").    D.add_
-0002db80: 706f 6c79 676f 6e28 5b78 7074 732c 2079  polygon([xpts, y
-0002db90: 7074 735d 2c20 6c61 7965 723d 6c61 7965  pts], layer=laye
-0002dba0: 7229 0a20 2020 2044 2e61 6464 5f70 6f72  r).    D.add_por
-0002dbb0: 7428 0a20 2020 2020 2020 206e 616d 653d  t(.        name=
-0002dbc0: 226c 6566 7422 2c0a 2020 2020 2020 2020  "left",.        
-0002dbd0: 6d69 6470 6f69 6e74 3d5b 2d28 7863 202b  midpoint=[-(xc +
-0002dbe0: 2061 726d 5f78 5f6c 6566 7420 2b20 6172   arm_x_left + ar
-0002dbf0: 6d5f 7769 6474 6873 5b30 5d20 2f20 3229  m_widths[0] / 2)
-0002dc00: 2c20 7963 202b 2061 726d 5f79 5f6c 6566  , yc + arm_y_lef
-0002dc10: 745d 2c0a 2020 2020 2020 2020 7769 6474  t],.        widt
-0002dc20: 683d 6172 6d5f 7769 6474 6873 5b30 5d2c  h=arm_widths[0],
-0002dc30: 0a20 2020 2020 2020 206f 7269 656e 7461  .        orienta
-0002dc40: 7469 6f6e 3d39 302c 0a20 2020 2029 0a20  tion=90,.    ). 
-0002dc50: 2020 2044 2e61 6464 5f70 6f72 7428 0a20     D.add_port(. 
-0002dc60: 2020 2020 2020 206e 616d 653d 2272 6967         name="rig
-0002dc70: 6874 222c 0a20 2020 2020 2020 206d 6964  ht",.        mid
-0002dc80: 706f 696e 743d 5b78 6320 2b20 6172 6d5f  point=[xc + arm_
-0002dc90: 785f 7269 6768 7420 2b20 6172 6d5f 7769  x_right + arm_wi
-0002dca0: 6474 6873 5b31 5d20 2f20 322c 2079 6320  dths[1] / 2, yc 
-0002dcb0: 2b20 6172 6d5f 795f 7269 6768 745d 2c0a  + arm_y_right],.
-0002dcc0: 2020 2020 2020 2020 7769 6474 683d 6172          width=ar
-0002dcd0: 6d5f 7769 6474 6873 5b31 5d2c 0a20 2020  m_widths[1],.   
-0002dce0: 2020 2020 206f 7269 656e 7461 7469 6f6e       orientation
-0002dcf0: 3d39 302c 0a20 2020 2029 0a20 2020 2044  =90,.    ).    D
-0002dd00: 2e61 6464 5f70 6f72 7428 0a20 2020 2020  .add_port(.     
-0002dd10: 2020 206e 616d 653d 2273 6f75 7263 6522     name="source"
-0002dd20: 2c0a 2020 2020 2020 2020 6d69 6470 6f69  ,.        midpoi
-0002dd30: 6e74 3d5b 3020 2b20 2861 726d 5f77 6964  nt=[0 + (arm_wid
-0002dd40: 7468 735b 315d 202d 2061 726d 5f77 6964  ths[1] - arm_wid
-0002dd50: 7468 735b 305d 2920 2f20 322c 202d 736f  ths[0]) / 2, -so
-0002dd60: 7572 6365 5f6c 656e 6774 6820 2b20 7963  urce_length + yc
-0002dd70: 5d2c 0a20 2020 2020 2020 2077 6964 7468  ],.        width
-0002dd80: 3d61 726d 5f77 6964 7468 735b 305d 202b  =arm_widths[0] +
-0002dd90: 2061 726d 5f77 6964 7468 735b 315d 202b   arm_widths[1] +
-0002dda0: 2032 202a 2078 632c 0a20 2020 2020 2020   2 * xc,.       
-0002ddb0: 206f 7269 656e 7461 7469 6f6e 3d2d 3930   orientation=-90
-0002ddc0: 2c0a 2020 2020 290a 0a20 2020 2023 203d  ,.    )..    # =
-0002ddd0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002dde0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002ddf0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002de00: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002de10: 3d3d 3d3d 3d3d 3d3d 3d0a 2020 2020 2320  =========.    # 
-0002de20: 2052 6563 6f72 6420 616e 7920 7061 7261   Record any para
-0002de30: 6d65 7465 7273 2079 6f75 206d 6179 2077  meters you may w
-0002de40: 616e 7420 746f 2061 6363 6573 7320 6c61  ant to access la
-0002de50: 7465 720a 2020 2020 2320 3d3d 3d3d 3d3d  ter.    # ======
-0002de60: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002de70: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002de80: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002de90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002dea0: 3d3d 3d3d 0a20 2020 2044 2e69 6e66 6f5b  ====.    D.info[
-0002deb0: 2272 686f 225d 203d 2072 686f 0a20 2020  "rho"] = rho.   
-0002dec0: 2044 2e69 6e66 6f5b 226c 6566 745f 7769   D.info["left_wi
-0002ded0: 6474 6822 5d20 3d20 6172 6d5f 7769 6474  dth"] = arm_widt
-0002dee0: 6873 5b30 5d0a 2020 2020 442e 696e 666f  hs[0].    D.info
-0002def0: 5b22 7269 6768 745f 7769 6474 6822 5d20  ["right_width"] 
-0002df00: 3d20 6172 6d5f 7769 6474 6873 5b31 5d0a  = arm_widths[1].
-0002df10: 2020 2020 442e 696e 666f 5b22 736f 7572      D.info["sour
-0002df20: 6365 5f77 6964 7468 225d 203d 2061 726d  ce_width"] = arm
-0002df30: 5f77 6964 7468 735b 305d 202b 2061 726d  _widths[0] + arm
-0002df40: 5f77 6964 7468 735b 315d 202b 2032 202a  _widths[1] + 2 *
-0002df50: 2078 630a 0a20 2020 2072 6574 7572 6e20   xc..    return 
-0002df60: 440a 0a0a 2320 3d3d 3d3d 3d3d 3d3d 3d3d  D...# ==========
-0002df70: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002df80: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002df90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002dfa0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002dfb0: 3d3d 3d3d 0a23 2045 7861 6d70 6c65 2063  ====.# Example c
-0002dfc0: 6f64 650a 2320 3d3d 3d3d 3d3d 3d3d 3d3d  ode.# ==========
-0002dfd0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002dfe0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002dff0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002e000: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-0002e010: 3d3d 3d3d 0a0a 2320 7920 3d20 7974 726f  ====..# y = ytro
-0002e020: 6e5f 726f 756e 6428 7268 6f20 3d20 312c  n_round(rho = 1,
-0002e030: 2061 726d 5f6c 656e 6774 6873 203d 2028   arm_lengths = (
-0002e040: 3530 302c 3330 3029 2c20 2073 6f75 7263  500,300),  sourc
-0002e050: 655f 6c65 6e67 7468 203d 2035 3030 2c0a  e_length = 500,.
-0002e060: 2320 6172 6d5f 7769 6474 6873 203d 2028  # arm_widths = (
-0002e070: 3230 302c 2032 3030 292c 2074 6865 7461  200, 200), theta
-0002e080: 203d 2032 2e35 2c20 7468 6574 615f 7265   = 2.5, theta_re
-0002e090: 736f 6c75 7469 6f6e 203d 2031 302c 0a23  solution = 10,.#
-0002e0a0: 206c 6179 6572 203d 2030 290a 2320 7175   layer = 0).# qu
-0002e0b0: 6963 6b70 6c6f 7428 7929 0a0a 0a23 2025  ickplot(y)...# %
-0002e0c0: 250a                                     %.
+000049a0: 206f 7065 7261 6e64 313d 415f 706f 6c79   operand1=A_poly
+000049b0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+000049c0: 2020 206f 7065 7261 6e64 323d 425f 706f     operand2=B_po
+000049d0: 6c79 732c 0a20 2020 2020 2020 2020 2020  lys,.           
+000049e0: 2020 2020 206f 7065 7261 7469 6f6e 3d6f       operation=o
+000049f0: 7065 7261 7469 6f6e 2c0a 2020 2020 2020  peration,.      
+00004a00: 2020 2020 2020 2020 2020 7072 6563 6973            precis
+00004a10: 696f 6e3d 7072 6563 6973 696f 6e2c 0a20  ion=precision,. 
+00004a20: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00004a30: 6178 5f70 6f69 6e74 733d 6d61 785f 706f  ax_points=max_po
+00004a40: 696e 7473 2c0a 2020 2020 2020 2020 2020  ints,.          
+00004a50: 2020 2020 2020 6c61 7965 723d 6764 735f        layer=gds_
+00004a60: 6c61 7965 722c 0a20 2020 2020 2020 2020  layer,.         
+00004a70: 2020 2020 2020 2064 6174 6174 7970 653d         datatype=
+00004a80: 6764 735f 6461 7461 7479 7065 2c0a 2020  gds_datatype,.  
+00004a90: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00004aa0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00004ab0: 2020 2020 2020 7020 3d20 5f62 6f6f 6c65        p = _boole
+00004ac0: 616e 5f70 6f6c 7967 6f6e 735f 7061 7261  an_polygons_para
+00004ad0: 6c6c 656c 280a 2020 2020 2020 2020 2020  llel(.          
+00004ae0: 2020 2020 2020 706f 6c79 676f 6e73 5f41        polygons_A
+00004af0: 3d41 5f70 6f6c 7973 2c0a 2020 2020 2020  =A_polys,.      
+00004b00: 2020 2020 2020 2020 2020 706f 6c79 676f            polygo
+00004b10: 6e73 5f42 3d42 5f70 6f6c 7973 2c0a 2020  ns_B=B_polys,.  
+00004b20: 2020 2020 2020 2020 2020 2020 2020 6e75                nu
+00004b30: 6d5f 6469 7669 7369 6f6e 733d 6e75 6d5f  m_divisions=num_
+00004b40: 6469 7669 7369 6f6e 732c 0a20 2020 2020  divisions,.     
+00004b50: 2020 2020 2020 2020 2020 206f 7065 7261             opera
+00004b60: 7469 6f6e 3d6f 7065 7261 7469 6f6e 2c0a  tion=operation,.
+00004b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b80: 7072 6563 6973 696f 6e3d 7072 6563 6973  precision=precis
+00004b90: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+00004ba0: 2029 0a0a 2020 2020 6966 2070 2069 7320   )..    if p is 
+00004bb0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00004bc0: 2020 706f 6c79 676f 6e73 203d 2044 2e61    polygons = D.a
+00004bd0: 6464 5f70 6f6c 7967 6f6e 2870 2c20 6c61  dd_polygon(p, la
+00004be0: 7965 723d 6c61 7965 7229 0a20 2020 2020  yer=layer).     
+00004bf0: 2020 205b 0a20 2020 2020 2020 2020 2020     [.           
+00004c00: 2070 6f6c 7967 6f6e 2e66 7261 6374 7572   polygon.fractur
+00004c10: 6528 6d61 785f 706f 696e 7473 3d6d 6178  e(max_points=max
+00004c20: 5f70 6f69 6e74 732c 2070 7265 6369 7369  _points, precisi
+00004c30: 6f6e 3d70 7265 6369 7369 6f6e 290a 2020  on=precision).  
+00004c40: 2020 2020 2020 2020 2020 666f 7220 706f            for po
+00004c50: 6c79 676f 6e20 696e 2070 6f6c 7967 6f6e  lygon in polygon
+00004c60: 730a 2020 2020 2020 2020 5d0a 2020 2020  s.        ].    
+00004c70: 7265 7475 726e 2044 0a0a 0a64 6566 206f  return D...def o
+00004c80: 7574 6c69 6e65 280a 2020 2020 656c 656d  utline(.    elem
+00004c90: 656e 7473 2c0a 2020 2020 6469 7374 616e  ents,.    distan
+00004ca0: 6365 3d31 2c0a 2020 2020 7072 6563 6973  ce=1,.    precis
+00004cb0: 696f 6e3d 3165 2d34 2c0a 2020 2020 6e75  ion=1e-4,.    nu
+00004cc0: 6d5f 6469 7669 7369 6f6e 733d 5b31 2c20  m_divisions=[1, 
+00004cd0: 315d 2c0a 2020 2020 6a6f 696e 3d22 6d69  1],.    join="mi
+00004ce0: 7465 7222 2c0a 2020 2020 746f 6c65 7261  ter",.    tolera
+00004cf0: 6e63 653d 322c 0a20 2020 206a 6f69 6e5f  nce=2,.    join_
+00004d00: 6669 7273 743d 5472 7565 2c0a 2020 2020  first=True,.    
+00004d10: 6d61 785f 706f 696e 7473 3d34 3030 302c  max_points=4000,
+00004d20: 0a20 2020 206f 7065 6e5f 706f 7274 733d  .    open_ports=
+00004d30: 4661 6c73 652c 0a20 2020 206c 6179 6572  False,.    layer
+00004d40: 3d30 2c0a 293a 0a20 2020 2022 2222 4372  =0,.):.    """Cr
+00004d50: 6561 7465 7320 616e 206f 7574 6c69 6e65  eates an outline
+00004d60: 2061 726f 756e 6420 616c 6c20 7468 6520   around all the 
+00004d70: 706f 6c79 676f 6e73 2070 6173 7365 6420  polygons passed 
+00004d80: 696e 2074 6865 2060 656c 656d 656e 7473  in the `elements
+00004d90: 600a 2020 2020 6172 6775 6d65 6e74 2e20  `.    argument. 
+00004da0: 6065 6c65 6d65 6e74 7360 206d 6179 2062  `elements` may b
+00004db0: 6520 6120 4465 7669 6365 2c20 506f 6c79  e a Device, Poly
+00004dc0: 676f 6e2c 206f 7220 6c69 7374 206f 6620  gon, or list of 
+00004dd0: 4465 7669 6365 732e 0a0a 2020 2020 5061  Devices...    Pa
+00004de0: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
+00004df0: 2d2d 2d2d 2d2d 2d0a 2020 2020 656c 656d  -------.    elem
+00004e00: 656e 7473 203a 2044 6576 6963 6528 2f52  ents : Device(/R
+00004e10: 6566 6572 656e 6365 292c 206c 6973 7420  eference), list 
+00004e20: 6f66 2044 6576 6963 6528 2f52 6566 6572  of Device(/Refer
+00004e30: 656e 6365 292c 206f 7220 506f 6c79 676f  ence), or Polygo
+00004e40: 6e0a 2020 2020 2020 2020 506f 6c79 676f  n.        Polygo
+00004e50: 6e73 2074 6f20 6f75 746c 696e 6520 6f72  ns to outline or
+00004e60: 2044 6576 6963 6520 636f 6e74 6169 6e69   Device containi
+00004e70: 6e67 2070 6f6c 7967 6f6e 7320 746f 206f  ng polygons to o
+00004e80: 7574 6c69 6e65 2e0a 2020 2020 6469 7374  utline..    dist
+00004e90: 616e 6365 203a 2069 6e74 206f 7220 666c  ance : int or fl
+00004ea0: 6f61 740a 2020 2020 2020 2020 4469 7374  oat.        Dist
+00004eb0: 616e 6365 2074 6f20 6f66 6673 6574 2070  ance to offset p
+00004ec0: 6f6c 7967 6f6e 732e 2050 6f73 6974 6976  olygons. Positiv
+00004ed0: 6520 7661 6c75 6573 2065 7870 616e 642c  e values expand,
+00004ee0: 206e 6567 6174 6976 6520 7368 7269 6e6b   negative shrink
+00004ef0: 2e0a 2020 2020 7072 6563 6973 696f 6e20  ..    precision 
+00004f00: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
+00004f10: 4465 7369 7265 6420 7072 6563 6973 696f  Desired precisio
+00004f20: 6e20 666f 7220 726f 756e 6469 6e67 2076  n for rounding v
+00004f30: 6572 7465 7820 636f 6f72 6469 6e61 7465  ertex coordinate
+00004f40: 732e 0a20 2020 206e 756d 5f64 6976 6973  s..    num_divis
+00004f50: 696f 6e73 203a 2061 7272 6179 2d6c 696b  ions : array-lik
+00004f60: 655b 325d 206f 6620 696e 740a 2020 2020  e[2] of int.    
+00004f70: 2020 2020 5468 6520 6e75 6d62 6572 206f      The number o
+00004f80: 6620 6469 7669 7369 6f6e 7320 7769 7468  f divisions with
+00004f90: 2077 6869 6368 2074 6865 2067 656f 6d65   which the geome
+00004fa0: 7472 7920 6973 2064 6976 6964 6564 2069  try is divided i
+00004fb0: 6e74 6f0a 2020 2020 2020 2020 6d75 6c74  nto.        mult
+00004fc0: 6970 6c65 2072 6563 7461 6e67 756c 6172  iple rectangular
+00004fd0: 2072 6567 696f 6e73 2e20 5468 6973 2061   regions. This a
+00004fe0: 6c6c 6f77 7320 666f 7220 6561 6368 2072  llows for each r
+00004ff0: 6567 696f 6e20 746f 2062 650a 2020 2020  egion to be.    
+00005000: 2020 2020 7072 6f63 6573 7365 6420 7365      processed se
+00005010: 7175 656e 7469 616c 6c79 2c20 7768 6963  quentially, whic
+00005020: 6820 6973 206d 6f72 6520 636f 6d70 7574  h is more comput
+00005030: 6174 696f 6e61 6c6c 7920 6566 6669 6369  ationally effici
+00005040: 656e 742e 0a20 2020 206a 6f69 6e20 3a20  ent..    join : 
+00005050: 7b27 6d69 7465 7227 2c20 2762 6576 656c  {'miter', 'bevel
+00005060: 272c 2027 726f 756e 6427 7d0a 2020 2020  ', 'round'}.    
+00005070: 2020 2020 5479 7065 206f 6620 6a6f 696e      Type of join
+00005080: 2075 7365 6420 746f 2063 7265 6174 6520   used to create 
+00005090: 7468 6520 6f66 6673 6574 2070 6f6c 7967  the offset polyg
+000050a0: 6f6e 2e0a 2020 2020 746f 6c65 7261 6e63  on..    toleranc
+000050b0: 6520 3a20 696e 7420 6f72 2066 6c6f 6174  e : int or float
+000050c0: 0a20 2020 2020 2020 2046 6f72 206d 6974  .        For mit
+000050d0: 6572 206a 6f69 6e74 732c 2074 6869 7320  er joints, this 
+000050e0: 6e75 6d62 6572 206d 7573 7420 6265 2061  number must be a
+000050f0: 7420 6c65 6173 7420 3220 616e 6420 6974  t least 2 and it
+00005100: 2072 6570 7265 7365 6e74 7320 7468 650a   represents the.
+00005110: 2020 2020 2020 2020 6d61 7869 6d61 6c20          maximal 
+00005120: 6469 7374 616e 6365 2069 6e20 6d75 6c74  distance in mult
+00005130: 6970 6c65 7320 6f66 206f 6666 7365 7420  iples of offset 
+00005140: 6265 7477 6565 6e20 6e65 7720 7665 7274  between new vert
+00005150: 6963 6573 2061 6e64 2074 6865 6972 0a20  ices and their. 
+00005160: 2020 2020 2020 206f 7269 6769 6e61 6c20         original 
+00005170: 706f 7369 7469 6f6e 2062 6566 6f72 6520  position before 
+00005180: 6265 7665 6c69 6e67 2074 6f20 6176 6f69  beveling to avoi
+00005190: 6420 7370 696b 6573 2061 7420 6163 7574  d spikes at acut
+000051a0: 6520 6a6f 696e 7473 2e20 466f 720a 2020  e joints. For.  
+000051b0: 2020 2020 2020 726f 756e 6420 6a6f 696e        round join
+000051c0: 7473 2c20 6974 2069 6e64 6963 6174 6573  ts, it indicates
+000051d0: 2074 6865 2063 7572 7661 7475 7265 2072   the curvature r
+000051e0: 6573 6f6c 7574 696f 6e20 696e 206e 756d  esolution in num
+000051f0: 6265 7220 6f66 0a20 2020 2020 2020 2070  ber of.        p
+00005200: 6f69 6e74 7320 7065 7220 6675 6c6c 2063  oints per full c
+00005210: 6972 636c 652e 0a20 2020 206a 6f69 6e5f  ircle..    join_
+00005220: 6669 7273 7420 3a20 626f 6f6c 0a20 2020  first : bool.   
+00005230: 2020 2020 204a 6f69 6e20 616c 6c20 7061       Join all pa
+00005240: 7468 7320 6265 666f 7265 206f 6666 7365  ths before offse
+00005250: 7474 696e 6720 746f 2061 766f 6964 2075  tting to avoid u
+00005260: 6e6e 6563 6573 7361 7279 206a 6f69 6e73  nnecessary joins
+00005270: 2069 6e0a 2020 2020 2020 2020 6164 6a61   in.        adja
+00005280: 6365 6e74 2070 6f6c 7967 6f6e 2073 6964  cent polygon sid
+00005290: 6573 2e0a 2020 2020 6d61 785f 706f 696e  es..    max_poin
+000052a0: 7473 203a 2069 6e74 0a20 2020 2020 2020  ts : int.       
+000052b0: 2054 6865 206d 6178 696d 756d 206e 756d   The maximum num
+000052c0: 6265 7220 6f66 2076 6572 7469 6365 7320  ber of vertices 
+000052d0: 7769 7468 696e 2074 6865 2072 6573 756c  within the resul
+000052e0: 7469 6e67 2070 6f6c 7967 6f6e 2e0a 2020  ting polygon..  
+000052f0: 2020 6f70 656e 5f70 6f72 7473 203a 2062    open_ports : b
+00005300: 6f6f 6c20 6f72 2066 6c6f 6174 0a20 2020  ool or float.   
+00005310: 2020 2020 2049 6620 6e6f 7420 4661 6c73       If not Fals
+00005320: 652c 2068 6f6c 6573 2077 696c 6c20 6265  e, holes will be
+00005330: 2063 7574 2069 6e20 7468 6520 6f75 746c   cut in the outl
+00005340: 696e 6520 7375 6368 2074 6861 7420 7468  ine such that th
+00005350: 6520 506f 7274 7320 6172 650a 2020 2020  e Ports are.    
+00005360: 2020 2020 6e6f 7420 636f 7665 7265 642e      not covered.
+00005370: 2049 6620 5472 7565 2c20 7468 6520 686f   If True, the ho
+00005380: 6c65 7320 7769 6c6c 2068 6176 6520 7468  les will have th
+00005390: 6520 7361 6d65 2077 6964 7468 2061 7320  e same width as 
+000053a0: 7468 6520 506f 7274 732e 0a20 2020 2020  the Ports..     
+000053b0: 2020 2049 6620 6120 666c 6f61 742c 2074     If a float, t
+000053c0: 6865 2068 6f6c 6573 2077 696c 6c20 6265  he holes will be
+000053d0: 2062 6520 7769 6465 6e65 6420 6279 2074   be widened by t
+000053e0: 6861 7420 7661 6c75 6520 2875 7365 6675  hat value (usefu
+000053f0: 6c20 666f 7220 6675 6c6c 790a 2020 2020  l for fully.    
+00005400: 2020 2020 636c 6561 7269 6e67 2074 6865      clearing the
+00005410: 206f 7574 6c69 6e65 2061 726f 756e 6420   outline around 
+00005420: 7468 6520 506f 7274 7320 666f 7220 706f  the Ports for po
+00005430: 7369 7469 7665 2d74 6f6e 6520 7072 6f63  sitive-tone proc
+00005440: 6573 7365 730a 2020 2020 6c61 7965 7220  esses.    layer 
+00005450: 3a20 696e 742c 2061 7272 6179 2d6c 696b  : int, array-lik
+00005460: 655b 325d 2c20 6f72 2073 6574 0a20 2020  e[2], or set.   
+00005470: 2020 2020 2053 7065 6369 6669 6320 6c61       Specific la
+00005480: 7965 7228 7329 2074 6f20 7075 7420 706f  yer(s) to put po
+00005490: 6c79 676f 6e20 6765 6f6d 6574 7279 206f  lygon geometry o
+000054a0: 6e2e 290a 0a20 2020 2052 6574 7572 6e73  n.)..    Returns
+000054b0: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
+000054c0: 2044 203a 2044 6576 6963 650a 2020 2020   D : Device.    
+000054d0: 2020 2020 4120 4465 7669 6365 2063 6f6e      A Device con
+000054e0: 7461 696e 696e 6720 7468 6520 6f75 746c  taining the outl
+000054f0: 696e 6564 2070 6f6c 7967 6f6e 2873 292e  ined polygon(s).
+00005500: 0a20 2020 2022 2222 0a20 2020 2044 203d  .    """.    D =
+00005510: 2044 6576 6963 6528 226f 7574 6c69 6e65   Device("outline
+00005520: 2229 0a20 2020 2069 6620 6e6f 7420 6973  ").    if not is
+00005530: 696e 7374 616e 6365 2865 6c65 6d65 6e74  instance(element
+00005540: 732c 206c 6973 7429 3a0a 2020 2020 2020  s, list):.      
+00005550: 2020 656c 656d 656e 7473 203d 205b 656c    elements = [el
+00005560: 656d 656e 7473 5d0a 2020 2020 706f 7274  ements].    port
+00005570: 5f6c 6973 7420 3d20 5b5d 0a20 2020 2066  _list = [].    f
+00005580: 6f72 2065 2069 6e20 656c 656d 656e 7473  or e in elements
+00005590: 3a0a 2020 2020 2020 2020 6966 2069 7369  :.        if isi
+000055a0: 6e73 7461 6e63 6528 652c 2044 6576 6963  nstance(e, Devic
+000055b0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+000055c0: 442e 6164 645f 7265 6628 6529 0a20 2020  D.add_ref(e).   
+000055d0: 2020 2020 2020 2020 2070 6f72 745f 6c69           port_li
+000055e0: 7374 202b 3d20 6c69 7374 2865 2e70 6f72  st += list(e.por
+000055f0: 7473 2e76 616c 7565 7328 2929 0a20 2020  ts.values()).   
+00005600: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00005610: 2020 2020 2020 2044 2e61 6464 2865 290a         D.add(e).
+00005620: 2020 2020 6764 735f 6c61 7965 722c 2067      gds_layer, g
+00005630: 6473 5f64 6174 6174 7970 6520 3d20 5f70  ds_datatype = _p
+00005640: 6172 7365 5f6c 6179 6572 286c 6179 6572  arse_layer(layer
+00005650: 290a 0a20 2020 2044 5f62 6c6f 6174 6564  )..    D_bloated
+00005660: 203d 206f 6666 7365 7428 0a20 2020 2020   = offset(.     
+00005670: 2020 2044 2c0a 2020 2020 2020 2020 6469     D,.        di
+00005680: 7374 616e 6365 3d64 6973 7461 6e63 652c  stance=distance,
+00005690: 0a20 2020 2020 2020 206a 6f69 6e5f 6669  .        join_fi
+000056a0: 7273 743d 6a6f 696e 5f66 6972 7374 2c0a  rst=join_first,.
+000056b0: 2020 2020 2020 2020 6e75 6d5f 6469 7669          num_divi
+000056c0: 7369 6f6e 733d 6e75 6d5f 6469 7669 7369  sions=num_divisi
+000056d0: 6f6e 732c 0a20 2020 2020 2020 2070 7265  ons,.        pre
+000056e0: 6369 7369 6f6e 3d70 7265 6369 7369 6f6e  cision=precision
+000056f0: 2c0a 2020 2020 2020 2020 6d61 785f 706f  ,.        max_po
+00005700: 696e 7473 3d6d 6178 5f70 6f69 6e74 732c  ints=max_points,
+00005710: 0a20 2020 2020 2020 206a 6f69 6e3d 6a6f  .        join=jo
+00005720: 696e 2c0a 2020 2020 2020 2020 746f 6c65  in,.        tole
+00005730: 7261 6e63 653d 746f 6c65 7261 6e63 652c  rance=tolerance,
+00005740: 0a20 2020 2020 2020 206c 6179 6572 3d6c  .        layer=l
+00005750: 6179 6572 2c0a 2020 2020 290a 0a20 2020  ayer,.    )..   
+00005760: 2054 7269 6d20 3d20 4465 7669 6365 2829   Trim = Device()
+00005770: 0a20 2020 2069 6620 6f70 656e 5f70 6f72  .    if open_por
+00005780: 7473 2069 7320 6e6f 7420 4661 6c73 653a  ts is not False:
+00005790: 0a20 2020 2020 2020 2069 6620 6f70 656e  .        if open
+000057a0: 5f70 6f72 7473 2069 7320 5472 7565 3a0a  _ports is True:.
+000057b0: 2020 2020 2020 2020 2020 2020 7472 696d              trim
+000057c0: 5f77 6964 7468 203d 2030 0a20 2020 2020  _width = 0.     
+000057d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000057e0: 2020 2020 2074 7269 6d5f 7769 6474 6820       trim_width 
+000057f0: 3d20 6f70 656e 5f70 6f72 7473 202a 2032  = open_ports * 2
+00005800: 0a20 2020 2020 2020 2066 6f72 2070 6f72  .        for por
+00005810: 7420 696e 2070 6f72 745f 6c69 7374 3a0a  t in port_list:.
+00005820: 2020 2020 2020 2020 2020 2020 7472 696d              trim
+00005830: 203d 2063 6f6d 7061 7373 2873 697a 653d   = compass(size=
+00005840: 2864 6973 7461 6e63 6520 2b20 3620 2a20  (distance + 6 * 
+00005850: 7072 6563 6973 696f 6e2c 2070 6f72 742e  precision, port.
+00005860: 7769 6474 6820 2b20 7472 696d 5f77 6964  width + trim_wid
+00005870: 7468 2929 0a20 2020 2020 2020 2020 2020  th)).           
+00005880: 2074 7269 6d5f 7265 6620 3d20 5472 696d   trim_ref = Trim
+00005890: 203c 3c20 7472 696d 0a20 2020 2020 2020   << trim.       
+000058a0: 2020 2020 2074 7269 6d5f 7265 662e 636f       trim_ref.co
+000058b0: 6e6e 6563 7428 2245 222c 2070 6f72 742c  nnect("E", port,
+000058c0: 206f 7665 726c 6170 3d32 202a 2070 7265   overlap=2 * pre
+000058d0: 6369 7369 6f6e 290a 0a20 2020 204f 7574  cision)..    Out
+000058e0: 6c69 6e65 203d 2062 6f6f 6c65 616e 280a  line = boolean(.
+000058f0: 2020 2020 2020 2020 413d 445f 626c 6f61          A=D_bloa
+00005900: 7465 642c 0a20 2020 2020 2020 2042 3d5b  ted,.        B=[
+00005910: 442c 2054 7269 6d5d 2c0a 2020 2020 2020  D, Trim],.      
+00005920: 2020 6f70 6572 6174 696f 6e3d 2241 2d42    operation="A-B
+00005930: 2220 6966 2064 6973 7461 6e63 6520 3e20  " if distance > 
+00005940: 3020 656c 7365 2022 422d 4122 2c0a 2020  0 else "B-A",.  
+00005950: 2020 2020 2020 6e75 6d5f 6469 7669 7369        num_divisi
+00005960: 6f6e 733d 6e75 6d5f 6469 7669 7369 6f6e  ons=num_division
+00005970: 732c 0a20 2020 2020 2020 206d 6178 5f70  s,.        max_p
+00005980: 6f69 6e74 733d 6d61 785f 706f 696e 7473  oints=max_points
+00005990: 2c0a 2020 2020 2020 2020 7072 6563 6973  ,.        precis
+000059a0: 696f 6e3d 7072 6563 6973 696f 6e2c 0a20  ion=precision,. 
+000059b0: 2020 2020 2020 206c 6179 6572 3d6c 6179         layer=lay
+000059c0: 6572 2c0a 2020 2020 290a 2020 2020 6966  er,.    ).    if
+000059d0: 206f 7065 6e5f 706f 7274 7320 6973 206e   open_ports is n
+000059e0: 6f74 2046 616c 7365 2061 6e64 206c 656e  ot False and len
+000059f0: 2865 6c65 6d65 6e74 7329 203d 3d20 313a  (elements) == 1:
+00005a00: 0a20 2020 2020 2020 2066 6f72 2070 6f72  .        for por
+00005a10: 7420 696e 2070 6f72 745f 6c69 7374 3a0a  t in port_list:.
+00005a20: 2020 2020 2020 2020 2020 2020 4f75 746c              Outl
+00005a30: 696e 652e 6164 645f 706f 7274 2870 6f72  ine.add_port(por
+00005a40: 743d 706f 7274 290a 2020 2020 7265 7475  t=port).    retu
+00005a50: 726e 204f 7574 6c69 6e65 0a0a 0a64 6566  rn Outline...def
+00005a60: 2069 6e76 6572 7428 0a20 2020 2065 6c65   invert(.    ele
+00005a70: 6d65 6e74 732c 2062 6f72 6465 723d 3130  ments, border=10
+00005a80: 2c20 7072 6563 6973 696f 6e3d 3165 2d34  , precision=1e-4
+00005a90: 2c20 6e75 6d5f 6469 7669 7369 6f6e 733d  , num_divisions=
+00005aa0: 5b31 2c20 315d 2c20 6d61 785f 706f 696e  [1, 1], max_poin
+00005ab0: 7473 3d34 3030 302c 206c 6179 6572 3d30  ts=4000, layer=0
+00005ac0: 0a29 3a0a 2020 2020 2222 2243 7265 6174  .):.    """Creat
+00005ad0: 6573 2061 6e20 696e 7665 7274 6564 2076  es an inverted v
+00005ae0: 6572 7369 6f6e 206f 6620 7468 6520 696e  ersion of the in
+00005af0: 7075 7420 7368 6170 6573 2077 6974 6820  put shapes with 
+00005b00: 616e 2061 6464 6974 696f 6e61 6c0a 2020  an additional.  
+00005b10: 2020 626f 7264 6572 2061 726f 756e 6420    border around 
+00005b20: 7468 6520 6564 6765 732e 0a0a 2020 2020  the edges...    
+00005b30: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+00005b40: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 656c  ---------.    el
+00005b50: 656d 656e 7473 203a 2044 6576 6963 6528  ements : Device(
+00005b60: 2f52 6566 6572 656e 6365 292c 206c 6973  /Reference), lis
+00005b70: 7420 6f66 2044 6576 6963 6528 2f52 6566  t of Device(/Ref
+00005b80: 6572 656e 6365 292c 206f 7220 506f 6c79  erence), or Poly
+00005b90: 676f 6e0a 2020 2020 2020 2020 4120 4465  gon.        A De
+00005ba0: 7669 6365 2063 6f6e 7461 696e 696e 6720  vice containing 
+00005bb0: 7468 6520 706f 6c79 676f 6e73 2074 6f20  the polygons to 
+00005bc0: 696e 7665 7274 2e0a 2020 2020 626f 7264  invert..    bord
+00005bd0: 6572 203a 2069 6e74 206f 7220 666c 6f61  er : int or floa
+00005be0: 740a 2020 2020 2020 2020 5369 7a65 206f  t.        Size o
+00005bf0: 6620 7468 6520 626f 7264 6572 2061 726f  f the border aro
+00005c00: 756e 6420 7468 6520 696e 7665 7274 6564  und the inverted
+00005c10: 2073 6861 7065 2028 626f 7264 6572 2076   shape (border v
+00005c20: 616c 7565 2069 7320 7468 650a 2020 2020  alue is the.    
+00005c30: 2020 2020 6469 7374 616e 6365 2066 726f      distance fro
+00005c40: 6d20 7468 6520 6564 6765 7320 6f66 2074  m the edges of t
+00005c50: 6865 2062 6f75 6e64 6172 7920 626f 7820  he boundary box 
+00005c60: 6465 6669 6e69 6e67 2074 6865 2069 6e76  defining the inv
+00005c70: 6572 7465 640a 2020 2020 2020 2020 7368  erted.        sh
+00005c80: 6170 6520 746f 2074 6865 2062 6f72 6465  ape to the borde
+00005c90: 722c 2061 6e64 2069 7320 6170 706c 6965  r, and is applie
+00005ca0: 6420 746f 2061 6c6c 2034 2073 6964 6573  d to all 4 sides
+00005cb0: 206f 6620 7468 6520 7368 6170 6529 2e0a   of the shape)..
+00005cc0: 2020 2020 7072 6563 6973 696f 6e20 3a20      precision : 
+00005cd0: 666c 6f61 740a 2020 2020 2020 2020 4465  float.        De
+00005ce0: 7369 7265 6420 7072 6563 6973 696f 6e20  sired precision 
+00005cf0: 666f 7220 726f 756e 6469 6e67 2076 6572  for rounding ver
+00005d00: 7465 7820 636f 6f72 6469 6e61 7465 732e  tex coordinates.
+00005d10: 0a20 2020 206e 756d 5f64 6976 6973 696f  .    num_divisio
+00005d20: 6e73 203a 2061 7272 6179 2d6c 696b 655b  ns : array-like[
+00005d30: 325d 206f 6620 696e 740a 2020 2020 2020  2] of int.      
+00005d40: 2020 5468 6520 6e75 6d62 6572 206f 6620    The number of 
+00005d50: 6469 7669 7369 6f6e 7320 7769 7468 2077  divisions with w
+00005d60: 6869 6368 2074 6865 2067 656f 6d65 7472  hich the geometr
+00005d70: 7920 6973 2064 6976 6964 6564 2069 6e74  y is divided int
+00005d80: 6f0a 2020 2020 2020 2020 6d75 6c74 6970  o.        multip
+00005d90: 6c65 2072 6563 7461 6e67 756c 6172 2072  le rectangular r
+00005da0: 6567 696f 6e73 2e20 5468 6973 2061 6c6c  egions. This all
+00005db0: 6f77 7320 666f 7220 6561 6368 2072 6567  ows for each reg
+00005dc0: 696f 6e20 746f 2062 650a 2020 2020 2020  ion to be.      
+00005dd0: 2020 7072 6f63 6573 7365 6420 7365 7175    processed sequ
+00005de0: 656e 7469 616c 6c79 2c20 7768 6963 6820  entially, which 
+00005df0: 6973 206d 6f72 6520 636f 6d70 7574 6174  is more computat
+00005e00: 696f 6e61 6c6c 7920 6566 6669 6369 656e  ionally efficien
+00005e10: 742e 0a20 2020 206d 6178 5f70 6f69 6e74  t..    max_point
+00005e20: 7320 3a20 696e 740a 2020 2020 2020 2020  s : int.        
+00005e30: 5468 6520 6d61 7869 6d75 6d20 6e75 6d62  The maximum numb
+00005e40: 6572 206f 6620 7665 7274 6963 6573 2077  er of vertices w
+00005e50: 6974 6869 6e20 7468 6520 7265 7375 6c74  ithin the result
+00005e60: 696e 6720 706f 6c79 676f 6e2e 0a20 2020  ing polygon..   
+00005e70: 206c 6179 6572 203a 2069 6e74 2c20 6172   layer : int, ar
+00005e80: 7261 792d 6c69 6b65 5b32 5d2c 206f 7220  ray-like[2], or 
+00005e90: 7365 740a 2020 2020 2020 2020 5370 6563  set.        Spec
+00005ea0: 6966 6963 206c 6179 6572 2873 2920 746f  ific layer(s) to
+00005eb0: 2070 7574 2070 6f6c 7967 6f6e 2067 656f   put polygon geo
+00005ec0: 6d65 7472 7920 6f6e 2e0a 0a20 2020 2052  metry on...    R
+00005ed0: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
+00005ee0: 2d2d 0a20 2020 2044 203a 2044 6576 6963  --.    D : Devic
+00005ef0: 650a 2020 2020 2020 2020 4120 4465 7669  e.        A Devi
+00005f00: 6365 2063 6f6e 7461 696e 696e 6720 7468  ce containing th
+00005f10: 6520 696e 7665 7274 6564 2076 6572 7369  e inverted versi
+00005f20: 6f6e 206f 6620 7468 6520 696e 7075 7420  on of the input 
+00005f30: 7368 6170 6528 7329 2061 6e64 2074 6865  shape(s) and the
+00005f40: 0a20 2020 2020 2020 2063 6f72 7265 7370  .        corresp
+00005f50: 6f6e 6469 6e67 2062 6f72 6465 7228 7329  onding border(s)
+00005f60: 2e0a 2020 2020 2222 220a 2020 2020 5465  ..    """.    Te
+00005f70: 6d70 203d 2044 6576 6963 6528 290a 2020  mp = Device().  
+00005f80: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+00005f90: 6e63 6528 656c 656d 656e 7473 2c20 6c69  nce(elements, li
+00005fa0: 7374 293a 0a20 2020 2020 2020 2065 6c65  st):.        ele
+00005fb0: 6d65 6e74 7320 3d20 5b65 6c65 6d65 6e74  ments = [element
+00005fc0: 735d 0a20 2020 2066 6f72 2065 2069 6e20  s].    for e in 
+00005fd0: 656c 656d 656e 7473 3a0a 2020 2020 2020  elements:.      
+00005fe0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00005ff0: 652c 2044 6576 6963 6529 3a0a 2020 2020  e, Device):.    
+00006000: 2020 2020 2020 2020 5465 6d70 2e61 6464          Temp.add
+00006010: 5f72 6566 2865 290a 2020 2020 2020 2020  _ref(e).        
+00006020: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00006030: 2020 5465 6d70 2e61 6464 2865 290a 2020    Temp.add(e).  
+00006040: 2020 6764 735f 6c61 7965 722c 2067 6473    gds_layer, gds
+00006050: 5f64 6174 6174 7970 6520 3d20 5f70 6172  _datatype = _par
+00006060: 7365 5f6c 6179 6572 286c 6179 6572 290a  se_layer(layer).
+00006070: 0a20 2020 2023 2042 7569 6c64 2074 6865  .    # Build the
+00006080: 2072 6563 7461 6e67 6c65 2061 726f 756e   rectangle aroun
+00006090: 6420 7468 6520 6465 7669 6365 2044 0a20  d the device D. 
+000060a0: 2020 2052 203d 2072 6563 7461 6e67 6c65     R = rectangle
+000060b0: 2873 697a 653d 2854 656d 702e 7873 697a  (size=(Temp.xsiz
+000060c0: 6520 2b20 3220 2a20 626f 7264 6572 2c20  e + 2 * border, 
+000060d0: 5465 6d70 2e79 7369 7a65 202b 2032 202a  Temp.ysize + 2 *
+000060e0: 2062 6f72 6465 7229 290a 2020 2020 522e   border)).    R.
+000060f0: 6365 6e74 6572 203d 2054 656d 702e 6365  center = Temp.ce
+00006100: 6e74 6572 0a0a 2020 2020 4420 3d20 626f  nter..    D = bo
+00006110: 6f6c 6561 6e28 0a20 2020 2020 2020 2041  olean(.        A
+00006120: 3d52 2c0a 2020 2020 2020 2020 423d 5465  =R,.        B=Te
+00006130: 6d70 2c0a 2020 2020 2020 2020 6f70 6572  mp,.        oper
+00006140: 6174 696f 6e3d 2241 2d42 222c 0a20 2020  ation="A-B",.   
+00006150: 2020 2020 2070 7265 6369 7369 6f6e 3d70       precision=p
+00006160: 7265 6369 7369 6f6e 2c0a 2020 2020 2020  recision,.      
+00006170: 2020 6e75 6d5f 6469 7669 7369 6f6e 733d    num_divisions=
+00006180: 6e75 6d5f 6469 7669 7369 6f6e 732c 0a20  num_divisions,. 
+00006190: 2020 2020 2020 206d 6178 5f70 6f69 6e74         max_point
+000061a0: 733d 6d61 785f 706f 696e 7473 2c0a 2020  s=max_points,.  
+000061b0: 2020 2020 2020 6c61 7965 723d 6c61 7965        layer=laye
+000061c0: 722c 0a20 2020 2029 0a20 2020 2072 6574  r,.    ).    ret
+000061d0: 7572 6e20 440a 0a0a 6465 6620 786f 725f  urn D...def xor_
+000061e0: 6469 6666 2841 2c20 422c 2070 7265 6369  diff(A, B, preci
+000061f0: 7369 6f6e 3d31 652d 3429 3a0a 2020 2020  sion=1e-4):.    
+00006200: 2222 2247 6976 656e 2074 776f 2044 6576  """Given two Dev
+00006210: 6963 6573 2041 2061 6e64 2042 2c20 7065  ices A and B, pe
+00006220: 7266 6f72 6d73 2074 6865 206c 6179 6572  rforms the layer
+00006230: 2d62 792d 6c61 7965 7220 584f 520a 2020  -by-layer XOR.  
+00006240: 2020 6469 6666 6572 656e 6365 2062 6574    difference bet
+00006250: 7765 656e 2041 2061 6e64 2042 2061 6e64  ween A and B and
+00006260: 2072 6574 7572 6e73 2070 6f6c 7967 6f6e   returns polygon
+00006270: 7320 7265 7072 6573 656e 7469 6e67 2074  s representing t
+00006280: 6865 0a20 2020 2064 6966 6665 7265 6e63  he.    differenc
+00006290: 6573 2062 6574 7765 656e 2041 2061 6e64  es between A and
+000062a0: 2042 2e0a 0a20 2020 2050 6172 616d 6574   B...    Paramet
+000062b0: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+000062c0: 2d2d 0a20 2020 2041 203a 2044 6576 6963  --.    A : Devic
+000062d0: 6528 2f52 6566 6572 656e 6365 2920 6f72  e(/Reference) or
+000062e0: 206c 6973 7420 6f66 2044 6576 6963 6528   list of Device(
+000062f0: 2f52 6566 6572 656e 6365 290a 2020 2020  /Reference).    
+00006300: 2020 2020 4120 4465 7669 6365 2063 6f6e      A Device con
+00006310: 7461 696e 696e 6720 6120 706f 6c79 676f  taining a polygo
+00006320: 6e28 7329 2e0a 2020 2020 4220 3a20 4465  n(s)..    B : De
+00006330: 7669 6365 282f 5265 6665 7265 6e63 6529  vice(/Reference)
+00006340: 206f 7220 6c69 7374 206f 6620 4465 7669   or list of Devi
+00006350: 6365 282f 5265 6665 7265 6e63 6529 0a20  ce(/Reference). 
+00006360: 2020 2020 2020 2041 2044 6576 6963 6520         A Device 
+00006370: 636f 6e74 6169 6e69 6e67 2061 2070 6f6c  containing a pol
+00006380: 7967 6f6e 2873 292e 0a20 2020 2070 7265  ygon(s)..    pre
+00006390: 6369 7369 6f6e 203a 2066 6c6f 6174 0a20  cision : float. 
+000063a0: 2020 2020 2020 2044 6573 6972 6564 2070         Desired p
+000063b0: 7265 6369 7369 6f6e 2066 6f72 2072 6f75  recision for rou
+000063c0: 6e64 696e 6720 7665 7274 6578 2063 6f6f  nding vertex coo
+000063d0: 7264 696e 6174 6573 2e0a 0a20 2020 2052  rdinates...    R
+000063e0: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
+000063f0: 2d0a 2020 2020 443a 2044 6576 6963 650a  -.    D: Device.
+00006400: 2020 2020 2020 2020 4120 4465 7669 6365          A Device
+00006410: 2063 6f6e 7461 696e 696e 6720 6120 706f   containing a po
+00006420: 6c79 676f 6e28 7329 2064 6566 696e 6564  lygon(s) defined
+00006430: 2062 7920 7468 6520 584f 5220 6469 6666   by the XOR diff
+00006440: 6572 656e 6365 2072 6573 756c 740a 2020  erence result.  
+00006450: 2020 2020 2020 6265 7477 6565 6e20 4120        between A 
+00006460: 616e 6420 422e 0a20 2020 2022 2222 0a0a  and B..    """..
+00006470: 2020 2020 4420 3d20 4465 7669 6365 2822      D = Device("
+00006480: 786f 725f 6469 6666 2229 0a20 2020 2041  xor_diff").    A
+00006490: 5f70 6f6c 7973 203d 2041 2e67 6574 5f70  _polys = A.get_p
+000064a0: 6f6c 7967 6f6e 7328 6279 5f73 7065 633d  olygons(by_spec=
+000064b0: 5472 7565 290a 2020 2020 425f 706f 6c79  True).    B_poly
+000064c0: 7320 3d20 422e 6765 745f 706f 6c79 676f  s = B.get_polygo
+000064d0: 6e73 2862 795f 7370 6563 3d54 7275 6529  ns(by_spec=True)
+000064e0: 0a20 2020 2041 5f6c 6179 6572 7320 3d20  .    A_layers = 
+000064f0: 415f 706f 6c79 732e 6b65 7973 2829 0a20  A_polys.keys(). 
+00006500: 2020 2042 5f6c 6179 6572 7320 3d20 425f     B_layers = B_
+00006510: 706f 6c79 732e 6b65 7973 2829 0a20 2020  polys.keys().   
+00006520: 2061 6c6c 5f6c 6179 6572 7320 3d20 7365   all_layers = se
+00006530: 7428 290a 2020 2020 616c 6c5f 6c61 7965  t().    all_laye
+00006540: 7273 2e75 7064 6174 6528 415f 6c61 7965  rs.update(A_laye
+00006550: 7273 290a 2020 2020 616c 6c5f 6c61 7965  rs).    all_laye
+00006560: 7273 2e75 7064 6174 6528 425f 6c61 7965  rs.update(B_laye
+00006570: 7273 290a 2020 2020 666f 7220 6c61 7965  rs).    for laye
+00006580: 7220 696e 2061 6c6c 5f6c 6179 6572 733a  r in all_layers:
+00006590: 0a20 2020 2020 2020 2069 6620 286c 6179  .        if (lay
+000065a0: 6572 2069 6e20 415f 6c61 7965 7273 2920  er in A_layers) 
+000065b0: 616e 6420 286c 6179 6572 2069 6e20 425f  and (layer in B_
+000065c0: 6c61 7965 7273 293a 0a20 2020 2020 2020  layers):.       
+000065d0: 2020 2020 2070 203d 2067 6473 7079 2e62       p = gdspy.b
+000065e0: 6f6f 6c65 616e 280a 2020 2020 2020 2020  oolean(.        
+000065f0: 2020 2020 2020 2020 6f70 6572 616e 6431          operand1
+00006600: 3d41 5f70 6f6c 7973 5b6c 6179 6572 5d2c  =A_polys[layer],
+00006610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006620: 206f 7065 7261 6e64 323d 425f 706f 6c79   operand2=B_poly
+00006630: 735b 6c61 7965 725d 2c0a 2020 2020 2020  s[layer],.      
+00006640: 2020 2020 2020 2020 2020 6f70 6572 6174            operat
+00006650: 696f 6e3d 2278 6f72 222c 0a20 2020 2020  ion="xor",.     
+00006660: 2020 2020 2020 2020 2020 2070 7265 6369             preci
+00006670: 7369 6f6e 3d70 7265 6369 7369 6f6e 2c0a  sion=precision,.
+00006680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006690: 6d61 785f 706f 696e 7473 3d34 3030 302c  max_points=4000,
+000066a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000066b0: 206c 6179 6572 3d6c 6179 6572 5b30 5d2c   layer=layer[0],
+000066c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000066d0: 2064 6174 6174 7970 653d 6c61 7965 725b   datatype=layer[
+000066e0: 315d 2c0a 2020 2020 2020 2020 2020 2020  1],.            
+000066f0: 290a 2020 2020 2020 2020 656c 6966 206c  ).        elif l
+00006700: 6179 6572 2069 6e20 415f 6c61 7965 7273  ayer in A_layers
+00006710: 3a0a 2020 2020 2020 2020 2020 2020 7020  :.            p 
+00006720: 3d20 415f 706f 6c79 735b 6c61 7965 725d  = A_polys[layer]
+00006730: 0a20 2020 2020 2020 2065 6c69 6620 6c61  .        elif la
+00006740: 7965 7220 696e 2042 5f6c 6179 6572 733a  yer in B_layers:
+00006750: 0a20 2020 2020 2020 2020 2020 2070 203d  .            p =
+00006760: 2042 5f70 6f6c 7973 5b6c 6179 6572 5d0a   B_polys[layer].
+00006770: 2020 2020 2020 2020 6966 2070 2069 7320          if p is 
+00006780: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00006790: 2020 2020 2020 442e 6164 645f 706f 6c79        D.add_poly
+000067a0: 676f 6e28 702c 206c 6179 6572 3d6c 6179  gon(p, layer=lay
+000067b0: 6572 290a 2020 2020 7265 7475 726e 2044  er).    return D
+000067c0: 0a0a 0a64 6566 2075 6e69 6f6e 2844 2c20  ...def union(D, 
+000067d0: 6279 5f6c 6179 6572 3d46 616c 7365 2c20  by_layer=False, 
+000067e0: 7072 6563 6973 696f 6e3d 3165 2d34 2c20  precision=1e-4, 
+000067f0: 6a6f 696e 5f66 6972 7374 3d54 7275 652c  join_first=True,
+00006800: 206d 6178 5f70 6f69 6e74 733d 3430 3030   max_points=4000
+00006810: 2c20 6c61 7965 723d 3029 3a0a 2020 2020  , layer=0):.    
+00006820: 2222 2250 6572 666f 726d 7320 7468 6520  """Performs the 
+00006830: 756e 696f 6e20 6f66 2061 6c6c 2070 6f6c  union of all pol
+00006840: 7967 6f6e 7320 7769 7468 696e 2061 2044  ygons within a D
+00006850: 6576 6963 652e 0a0a 2020 2020 5061 7261  evice...    Para
+00006860: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
+00006870: 2d2d 2d2d 2d0a 2020 2020 4420 3a20 4465  -----.    D : De
+00006880: 7669 6365 282f 5265 6665 7265 6e63 6529  vice(/Reference)
+00006890: 0a20 2020 2020 2020 2041 2044 6576 6963  .        A Devic
+000068a0: 6520 636f 6e74 6169 6e69 6e67 2070 6f6c  e containing pol
+000068b0: 7967 6f6e 7320 746f 2070 6572 666f 726d  ygons to perform
+000068c0: 2061 2075 6e69 6f6e 206f 6e2e 0a20 2020   a union on..   
+000068d0: 2062 795f 4c61 7965 7220 3a20 626f 6f6c   by_Layer : bool
+000068e0: 0a20 2020 2020 2020 2049 6620 7472 7565  .        If true
+000068f0: 2c20 7065 7266 6f72 6d73 2074 6865 2075  , performs the u
+00006900: 6e69 6f6e 206f 7065 7261 7469 6f6e 206c  nion operation l
+00006910: 6179 6572 2d77 6973 6520 736f 2065 6163  ayer-wise so eac
+00006920: 6820 6c61 7965 7220 6361 6e20 6265 0a20  h layer can be. 
+00006930: 2020 2020 2020 2069 6e64 6976 6964 7561         individua
+00006940: 6c6c 7920 636f 6d62 696e 6564 2e0a 2020  lly combined..  
+00006950: 2020 7072 6563 6973 696f 6e20 3a20 666c    precision : fl
+00006960: 6f61 740a 2020 2020 2020 2020 4465 7369  oat.        Desi
+00006970: 7265 6420 7072 6563 6973 696f 6e20 666f  red precision fo
+00006980: 7220 726f 756e 6469 6e67 2076 6572 7465  r rounding verte
+00006990: 7820 636f 6f72 6469 6e61 7465 732e 0a20  x coordinates.. 
+000069a0: 2020 206a 6f69 6e5f 6669 7273 7420 3a20     join_first : 
+000069b0: 626f 6f6c 0a20 2020 2020 2020 204a 6f69  bool.        Joi
+000069c0: 6e20 616c 6c20 7061 7468 7320 6265 666f  n all paths befo
+000069d0: 7265 206f 6666 7365 7474 696e 6720 746f  re offsetting to
+000069e0: 2061 766f 6964 2075 6e6e 6563 6573 7361   avoid unnecessa
+000069f0: 7279 206a 6f69 6e73 2069 6e0a 2020 2020  ry joins in.    
+00006a00: 2020 2020 6164 6a61 6365 6e74 2070 6f6c      adjacent pol
+00006a10: 7967 6f6e 2073 6964 6573 2e0a 2020 2020  ygon sides..    
+00006a20: 6d61 785f 706f 696e 7473 203a 2069 6e74  max_points : int
+00006a30: 0a20 2020 2020 2020 2054 6865 206d 6178  .        The max
+00006a40: 696d 756d 206e 756d 6265 7220 6f66 2076  imum number of v
+00006a50: 6572 7469 6365 7320 7769 7468 696e 2074  ertices within t
+00006a60: 6865 2072 6573 756c 7469 6e67 2070 6f6c  he resulting pol
+00006a70: 7967 6f6e 2e0a 2020 2020 6c61 7965 7220  ygon..    layer 
+00006a80: 3a20 696e 742c 2061 7272 6179 2d6c 696b  : int, array-lik
+00006a90: 655b 325d 2c20 6f72 2073 6574 0a20 2020  e[2], or set.   
+00006aa0: 2020 2020 2053 7065 6369 6669 6320 6c61       Specific la
+00006ab0: 7965 7228 7329 2074 6f20 7075 7420 706f  yer(s) to put po
+00006ac0: 6c79 676f 6e20 6765 6f6d 6574 7279 206f  lygon geometry o
+00006ad0: 6e2e 0a0a 2020 2020 5265 7475 726e 730a  n...    Returns.
+00006ae0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+00006af0: 5520 3a20 4465 7669 6365 0a20 2020 2020  U : Device.     
+00006b00: 2020 2041 2044 6576 6963 6520 636f 6e74     A Device cont
+00006b10: 6169 6e69 6e67 2074 6865 2075 6e69 6f6e  aining the union
+00006b20: 206f 6620 7468 6520 706f 6c79 676f 6e73   of the polygons
+00006b30: 2077 6974 6869 6e20 7468 6520 696e 7075   within the inpu
+00006b40: 7420 4465 7669 6365 2e0a 2020 2020 2222  t Device..    ""
+00006b50: 220a 2020 2020 5520 3d20 4465 7669 6365  ".    U = Device
+00006b60: 2822 756e 696f 6e22 290a 0a20 2020 2069  ("union")..    i
+00006b70: 6620 6279 5f6c 6179 6572 3a0a 2020 2020  f by_layer:.    
+00006b80: 2020 2020 616c 6c5f 706f 6c79 676f 6e73      all_polygons
+00006b90: 203d 2044 2e67 6574 5f70 6f6c 7967 6f6e   = D.get_polygon
+00006ba0: 7328 6279 5f73 7065 633d 5472 7565 290a  s(by_spec=True).
+00006bb0: 2020 2020 2020 2020 666f 7220 6c61 7965          for laye
+00006bc0: 722c 2070 6f6c 7967 6f6e 7320 696e 2061  r, polygons in a
+00006bd0: 6c6c 5f70 6f6c 7967 6f6e 732e 6974 656d  ll_polygons.item
+00006be0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00006bf0: 2075 6e69 6f6e 6564 5f70 6f6c 7967 6f6e   unioned_polygon
+00006c00: 7320 3d20 5f75 6e69 6f6e 5f70 6f6c 7967  s = _union_polyg
+00006c10: 6f6e 7328 0a20 2020 2020 2020 2020 2020  ons(.           
+00006c20: 2020 2020 2070 6f6c 7967 6f6e 732c 2070       polygons, p
+00006c30: 7265 6369 7369 6f6e 3d70 7265 6369 7369  recision=precisi
+00006c40: 6f6e 2c20 6d61 785f 706f 696e 7473 3d6d  on, max_points=m
+00006c50: 6178 5f70 6f69 6e74 730a 2020 2020 2020  ax_points.      
+00006c60: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00006c70: 2020 2020 552e 6164 645f 706f 6c79 676f      U.add_polygo
+00006c80: 6e28 756e 696f 6e65 645f 706f 6c79 676f  n(unioned_polygo
+00006c90: 6e73 2c20 6c61 7965 723d 6c61 7965 7229  ns, layer=layer)
+00006ca0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00006cb0: 2020 2061 6c6c 5f70 6f6c 7967 6f6e 7320     all_polygons 
+00006cc0: 3d20 442e 6765 745f 706f 6c79 676f 6e73  = D.get_polygons
+00006cd0: 2862 795f 7370 6563 3d46 616c 7365 290a  (by_spec=False).
+00006ce0: 2020 2020 2020 2020 756e 696f 6e65 645f          unioned_
+00006cf0: 706f 6c79 676f 6e73 203d 205f 756e 696f  polygons = _unio
+00006d00: 6e5f 706f 6c79 676f 6e73 280a 2020 2020  n_polygons(.    
+00006d10: 2020 2020 2020 2020 616c 6c5f 706f 6c79          all_poly
+00006d20: 676f 6e73 2c20 7072 6563 6973 696f 6e3d  gons, precision=
+00006d30: 7072 6563 6973 696f 6e2c 206d 6178 5f70  precision, max_p
+00006d40: 6f69 6e74 733d 6d61 785f 706f 696e 7473  oints=max_points
+00006d50: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00006d60: 2020 2055 2e61 6464 5f70 6f6c 7967 6f6e     U.add_polygon
+00006d70: 2875 6e69 6f6e 6564 5f70 6f6c 7967 6f6e  (unioned_polygon
+00006d80: 732c 206c 6179 6572 3d6c 6179 6572 290a  s, layer=layer).
+00006d90: 2020 2020 7265 7475 726e 2055 0a0a 0a64      return U...d
+00006da0: 6566 205f 756e 696f 6e5f 706f 6c79 676f  ef _union_polygo
+00006db0: 6e73 2870 6f6c 7967 6f6e 732c 2070 7265  ns(polygons, pre
+00006dc0: 6369 7369 6f6e 3d31 652d 342c 206d 6178  cision=1e-4, max
+00006dd0: 5f70 6f69 6e74 733d 3430 3030 293a 0a20  _points=4000):. 
+00006de0: 2020 2022 2222 5065 7266 6f72 6d73 2074     """Performs t
+00006df0: 6865 2075 6e69 6f6e 206f 6620 616c 6c20  he union of all 
+00006e00: 706f 6c79 676f 6e73 2077 6974 6869 6e20  polygons within 
+00006e10: 6120 506f 6c79 676f 6e53 6574 206f 7220  a PolygonSet or 
+00006e20: 6c69 7374 206f 660a 2020 2020 706f 6c79  list of.    poly
+00006e30: 676f 6e73 2e0a 0a20 2020 2050 6172 616d  gons...    Param
+00006e40: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
+00006e50: 2d2d 2d2d 0a20 2020 2070 6f6c 7967 6f6e  ----.    polygon
+00006e60: 7320 3a20 506f 6c79 676f 6e53 6574 206f  s : PolygonSet o
+00006e70: 7220 6c69 7374 206f 6620 706f 6c79 676f  r list of polygo
+00006e80: 6e73 0a20 2020 2020 2020 2041 2073 6574  ns.        A set
+00006e90: 2063 6f6e 7461 696e 696e 6720 7468 6520   containing the 
+00006ea0: 696e 7075 7420 706f 6c79 676f 6e73 2e0a  input polygons..
+00006eb0: 2020 2020 7072 6563 6973 696f 6e20 3a20      precision : 
+00006ec0: 666c 6f61 740a 2020 2020 2020 2020 4465  float.        De
+00006ed0: 7369 7265 6420 7072 6563 6973 696f 6e20  sired precision 
+00006ee0: 666f 7220 726f 756e 6469 6e67 2076 6572  for rounding ver
+00006ef0: 7465 7820 636f 6f72 6469 6e61 7465 732e  tex coordinates.
+00006f00: 0a20 2020 206d 6178 5f70 6f69 6e74 7320  .    max_points 
+00006f10: 3a20 696e 740a 2020 2020 2020 2020 5468  : int.        Th
+00006f20: 6520 6d61 7869 6d75 6d20 6e75 6d62 6572  e maximum number
+00006f30: 206f 6620 7665 7274 6963 6573 2077 6974   of vertices wit
+00006f40: 6869 6e20 7468 6520 7265 7375 6c74 696e  hin the resultin
+00006f50: 6720 706f 6c79 676f 6e2e 0a0a 2020 2020  g polygon...    
+00006f60: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
+00006f70: 2d2d 2d0a 2020 2020 756e 696f 6e65 6420  ---.    unioned 
+00006f80: 3a20 706f 6c79 676f 6e0a 2020 2020 2020  : polygon.      
+00006f90: 2020 5468 6520 7265 7375 6c74 206f 6620    The result of 
+00006fa0: 7468 6520 756e 696f 6e20 6f66 2061 6c6c  the union of all
+00006fb0: 2074 6865 2070 6f6c 7967 6f6e 7320 7769   the polygons wi
+00006fc0: 7468 696e 2074 6865 2069 6e70 7574 0a20  thin the input. 
+00006fd0: 2020 2020 2020 2050 6f6c 7967 6f6e 5365         PolygonSe
+00006fe0: 742e 0a20 2020 2022 2222 0a20 2020 2070  t..    """.    p
+00006ff0: 6f6c 7967 6f6e 7320 3d20 5f6d 6572 6765  olygons = _merge
+00007000: 5f66 6c6f 6174 696e 675f 706f 696e 745f  _floating_point_
+00007010: 6572 726f 7273 2870 6f6c 7967 6f6e 732c  errors(polygons,
+00007020: 2074 6f6c 3d70 7265 6369 7369 6f6e 202f   tol=precision /
+00007030: 2031 3030 3029 0a20 2020 2075 6e69 6f6e   1000).    union
+00007040: 6564 203d 2067 6473 7079 2e62 6f6f 6c65  ed = gdspy.boole
+00007050: 616e 280a 2020 2020 2020 2020 706f 6c79  an(.        poly
+00007060: 676f 6e73 2c20 5b5d 2c20 6f70 6572 6174  gons, [], operat
+00007070: 696f 6e3d 226f 7222 2c20 7072 6563 6973  ion="or", precis
+00007080: 696f 6e3d 7072 6563 6973 696f 6e2c 206d  ion=precision, m
+00007090: 6178 5f70 6f69 6e74 733d 6d61 785f 706f  ax_points=max_po
+000070a0: 696e 7473 0a20 2020 2029 0a20 2020 2072  ints.    ).    r
+000070b0: 6574 7572 6e20 756e 696f 6e65 640a 0a0a  eturn unioned...
+000070c0: 6465 6620 5f6d 6572 6765 5f66 6c6f 6174  def _merge_float
+000070d0: 696e 675f 706f 696e 745f 6572 726f 7273  ing_point_errors
+000070e0: 2870 6f6c 7967 6f6e 732c 2074 6f6c 3d31  (polygons, tol=1
+000070f0: 652d 3130 293a 0a20 2020 2022 2222 4669  e-10):.    """Fi
+00007100: 7865 7320 666c 6f61 7469 6e67 2070 6f69  xes floating poi
+00007110: 6e74 2065 7272 6f72 7320 696e 2074 6865  nt errors in the
+00007120: 2069 6e70 7574 2070 6f6c 7967 6f6e 2873   input polygon(s
+00007130: 2920 6279 206d 6572 6769 6e67 2076 616c  ) by merging val
+00007140: 7565 730a 2020 2020 7769 7468 696e 2074  ues.    within t
+00007150: 6865 2074 6f6c 6572 616e 6365 2060 746f  he tolerance `to
+00007160: 6c60 2e20 5365 6520 5f6d 6572 6765 5f6e  l`. See _merge_n
+00007170: 6561 7262 795f 666c 6f61 7469 6e67 5f70  earby_floating_p
+00007180: 6f69 6e74 7320 666f 720a 2020 2020 7370  oints for.    sp
+00007190: 6563 6966 6963 732e 0a0a 2020 2020 5061  ecifics...    Pa
+000071a0: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
+000071b0: 2d2d 2d2d 2d2d 2d0a 2020 2020 706f 6c79  -------.    poly
+000071c0: 676f 6e73 203a 2050 6f6c 7967 6f6e 5365  gons : PolygonSe
+000071d0: 7420 6f72 206c 6973 7420 6f66 2070 6f6c  t or list of pol
+000071e0: 7967 6f6e 730a 2020 2020 2020 2020 5365  ygons.        Se
+000071f0: 7420 6f66 2070 6f6c 7967 6f6e 7320 7769  t of polygons wi
+00007200: 7468 2066 6c6f 6174 696e 6720 706f 696e  th floating poin
+00007210: 7420 6572 726f 7273 2e0a 2020 2020 746f  t errors..    to
+00007220: 6c20 3a20 666c 6f61 740a 2020 2020 2020  l : float.      
+00007230: 2020 546f 6c65 7261 6e63 6520 7769 7468    Tolerance with
+00007240: 696e 2077 6869 6368 2070 6f69 6e74 7320  in which points 
+00007250: 7769 6c6c 2062 6520 6d65 7267 6564 2e0a  will be merged..
+00007260: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
+00007270: 202d 2d2d 2d2d 2d2d 0a20 2020 2070 6f6c   -------.    pol
+00007280: 7967 6f6e 735f 6669 7865 6420 3a20 506f  ygons_fixed : Po
+00007290: 6c79 676f 6e53 6574 0a20 2020 2020 2020  lygonSet.       
+000072a0: 2053 6574 206f 6620 636f 7272 6563 7465   Set of correcte
+000072b0: 6420 706f 6c79 676f 6e73 2e0a 2020 2020  d polygons..    
+000072c0: 2222 220a 2020 2020 6966 206c 656e 2870  """.    if len(p
+000072d0: 6f6c 7967 6f6e 7329 203d 3d20 303a 0a20  olygons) == 0:. 
+000072e0: 2020 2020 2020 2072 6574 7572 6e20 6e70         return np
+000072f0: 2e61 7366 6172 7261 7928 5b5d 290a 2020  .asfarray([]).  
+00007300: 2020 7374 6163 6b65 645f 706f 6c79 676f    stacked_polygo
+00007310: 6e73 203d 206e 702e 7673 7461 636b 2870  ns = np.vstack(p
+00007320: 6f6c 7967 6f6e 7329 0a20 2020 2078 203d  olygons).    x =
+00007330: 2073 7461 636b 6564 5f70 6f6c 7967 6f6e   stacked_polygon
+00007340: 735b 3a2c 2030 5d0a 2020 2020 7920 3d20  s[:, 0].    y = 
+00007350: 7374 6163 6b65 645f 706f 6c79 676f 6e73  stacked_polygons
+00007360: 5b3a 2c20 315d 0a20 2020 2070 6f6c 7967  [:, 1].    polyg
+00007370: 6f6e 5f69 6e64 6963 6573 203d 206e 702e  on_indices = np.
+00007380: 6375 6d73 756d 285b 6c65 6e28 7029 2066  cumsum([len(p) f
+00007390: 6f72 2070 2069 6e20 706f 6c79 676f 6e73  or p in polygons
+000073a0: 5d29 0a0a 2020 2020 7866 6978 6564 203d  ])..    xfixed =
+000073b0: 205f 6d65 7267 655f 6e65 6172 6279 5f66   _merge_nearby_f
+000073c0: 6c6f 6174 696e 675f 706f 696e 7473 2878  loating_points(x
+000073d0: 2c20 746f 6c3d 746f 6c29 0a20 2020 2079  , tol=tol).    y
+000073e0: 6669 7865 6420 3d20 5f6d 6572 6765 5f6e  fixed = _merge_n
+000073f0: 6561 7262 795f 666c 6f61 7469 6e67 5f70  earby_floating_p
+00007400: 6f69 6e74 7328 792c 2074 6f6c 3d74 6f6c  oints(y, tol=tol
+00007410: 290a 2020 2020 7374 6163 6b65 645f 706f  ).    stacked_po
+00007420: 6c79 676f 6e73 5f66 6978 6564 203d 206e  lygons_fixed = n
+00007430: 702e 7673 7461 636b 285b 7866 6978 6564  p.vstack([xfixed
+00007440: 2c20 7966 6978 6564 5d29 2e54 0a20 2020  , yfixed]).T.   
+00007450: 2070 6f6c 7967 6f6e 735f 6669 7865 6420   polygons_fixed 
+00007460: 3d20 6e70 2e76 7370 6c69 7428 7374 6163  = np.vsplit(stac
+00007470: 6b65 645f 706f 6c79 676f 6e73 5f66 6978  ked_polygons_fix
+00007480: 6564 2c20 706f 6c79 676f 6e5f 696e 6469  ed, polygon_indi
+00007490: 6365 735b 3a2d 315d 290a 2020 2020 7265  ces[:-1]).    re
+000074a0: 7475 726e 2070 6f6c 7967 6f6e 735f 6669  turn polygons_fi
+000074b0: 7865 640a 0a0a 6465 6620 5f6d 6572 6765  xed...def _merge
+000074c0: 5f6e 6561 7262 795f 666c 6f61 7469 6e67  _nearby_floating
+000074d0: 5f70 6f69 6e74 7328 782c 2074 6f6c 3d31  _points(x, tol=1
+000074e0: 652d 3130 293a 0a20 2020 2022 2222 5461  e-10):.    """Ta
+000074f0: 6b65 7320 616e 2061 7272 6179 2060 7860  kes an array `x`
+00007500: 2061 6e64 206d 6572 6765 7320 616e 7920   and merges any 
+00007510: 7661 6c75 6573 2077 6974 6869 6e20 7468  values within th
+00007520: 6520 746f 6c65 7261 6e63 6520 6074 6f6c  e tolerance `tol
+00007530: 602e 0a0a 2020 2020 5061 7261 6d65 7465  `...    Paramete
+00007540: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+00007550: 2d0a 2020 2020 7820 3a20 6c69 7374 206f  -.    x : list o
+00007560: 6620 696e 7420 6f72 2066 6c6f 6174 0a20  f int or float. 
+00007570: 2020 2020 2020 2041 7272 6179 206f 6620         Array of 
+00007580: 7661 6c75 6573 2077 6974 6820 666c 6f61  values with floa
+00007590: 7469 6e67 2070 6f69 6e74 2065 7272 6f72  ting point error
+000075a0: 732e 0a20 2020 2074 6f6c 203a 2066 6c6f  s..    tol : flo
+000075b0: 6174 0a20 2020 2020 2020 2054 6f6c 6572  at.        Toler
+000075c0: 616e 6365 2077 6974 6869 6e20 7768 6963  ance within whic
+000075d0: 6820 706f 696e 7473 2077 696c 6c20 6265  h points will be
+000075e0: 206d 6572 6765 642e 0a0a 2020 2020 5265   merged...    Re
+000075f0: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00007600: 2d0a 2020 2020 7873 6f72 7420 3a20 6c69  -.    xsort : li
+00007610: 7374 206f 6620 696e 7420 6f72 2066 6c6f  st of int or flo
+00007620: 6174 0a20 2020 2020 2020 2043 6f72 7265  at.        Corre
+00007630: 6374 6564 2061 6e64 2073 6f72 7465 6420  cted and sorted 
+00007640: 6172 7261 792e 0a0a 2020 2020 4578 616d  array...    Exam
+00007650: 706c 6573 0a20 2020 202d 2d2d 2d2d 2d2d  ples.    -------
+00007660: 2d0a 2020 2020 4966 2067 6976 656e 3a0a  -.    If given:.
+00007670: 2020 2020 3e3e 3e20 7820 3d20 5b2d 322c      >>> x = [-2,
+00007680: 202d 312c 2030 2c20 312e 3030 3031 2c20   -1, 0, 1.0001, 
+00007690: 312e 3030 3032 2c20 312e 3030 3033 2c20  1.0002, 1.0003, 
+000076a0: 342c 2035 2c20 352e 3030 332c 2036 2c20  4, 5, 5.003, 6, 
+000076b0: 372c 2038 5d0a 2020 2020 3e3e 3e20 5f6d  7, 8].    >>> _m
+000076c0: 6572 6765 5f6e 6561 7262 795f 666c 6f61  erge_nearby_floa
+000076d0: 7469 6e67 5f70 6f69 6e74 7328 782c 2074  ting_points(x, t
+000076e0: 6f6c 203d 2031 652d 3329 0a20 2020 2057  ol = 1e-3).    W
+000076f0: 696c 6c20 7265 7475 726e 3a0a 2020 2020  ill return:.    
+00007700: 3e3e 3e20 5b2d 322c 202d 312c 2030 2c20  >>> [-2, -1, 0, 
+00007710: 312e 3030 3031 2c20 312e 3030 3031 2c20  1.0001, 1.0001, 
+00007720: 312e 3030 3031 2c20 342c 2035 2c20 352e  1.0001, 4, 5, 5.
+00007730: 3030 332c 2036 2c20 372c 2038 5d2e 0a20  003, 6, 7, 8].. 
+00007740: 2020 2022 2222 0a20 2020 2078 6172 6773     """.    xargs
+00007750: 6f72 7420 3d20 6e70 2e61 7267 736f 7274  ort = np.argsort
+00007760: 2878 290a 2020 2020 7861 7267 756e 736f  (x).    xargunso
+00007770: 7274 203d 206e 702e 6172 6773 6f72 7428  rt = np.argsort(
+00007780: 7861 7267 736f 7274 290a 2020 2020 7873  xargsort).    xs
+00007790: 6f72 7420 3d20 785b 7861 7267 736f 7274  ort = x[xargsort
+000077a0: 5d0a 2020 2020 6478 203d 206e 702e 6469  ].    dx = np.di
+000077b0: 6666 2878 736f 7274 290a 2020 2020 7873  ff(xsort).    xs
+000077c0: 6f72 7474 6872 6573 686f 6c64 203d 206e  ortthreshold = n
+000077d0: 702e 6c6f 6769 6361 6c5f 616e 6428 6478  p.logical_and(dx
+000077e0: 203c 2074 6f6c 2c20 6478 203e 2030 290a   < tol, dx > 0).
+000077f0: 2020 2020 7873 6f72 7474 6872 6573 686f      xsortthresho
+00007800: 6c64 696e 6420 3d20 6e70 2e61 7267 7768  ldind = np.argwh
+00007810: 6572 6528 7873 6f72 7474 6872 6573 686f  ere(xsortthresho
+00007820: 6c64 290a 0a20 2020 2023 204d 6572 6765  ld)..    # Merge
+00007830: 206e 6561 7262 7920 666c 6f61 7469 6e67   nearby floating
+00007840: 2070 6f69 6e74 2076 616c 7565 730a 2020   point values.  
+00007850: 2020 666f 7220 7869 2069 6e20 7873 6f72    for xi in xsor
+00007860: 7474 6872 6573 686f 6c64 696e 643a 0a20  tthresholdind:. 
+00007870: 2020 2020 2020 2078 736f 7274 5b78 6920         xsort[xi 
+00007880: 2b20 315d 203d 2078 736f 7274 5b78 695d  + 1] = xsort[xi]
+00007890: 0a20 2020 2072 6574 7572 6e20 7873 6f72  .    return xsor
+000078a0: 745b 7861 7267 756e 736f 7274 5d0a 0a0a  t[xargunsort]...
+000078b0: 6465 6620 5f63 726f 705f 7265 6769 6f6e  def _crop_region
+000078c0: 2870 6f6c 7967 6f6e 732c 206c 6566 742c  (polygons, left,
+000078d0: 2062 6f74 746f 6d2c 2072 6967 6874 2c20   bottom, right, 
+000078e0: 746f 702c 2070 7265 6369 7369 6f6e 293a  top, precision):
+000078f0: 0a20 2020 2022 2222 4769 7665 6e20 6120  .    """Given a 
+00007900: 7265 6374 616e 6775 6c61 7220 626f 756e  rectangular boun
+00007910: 6461 7279 2064 6566 696e 6564 2062 7920  dary defined by 
+00007920: 6c65 6674 2f62 6f74 746f 6d2f 7269 6768  left/bottom/righ
+00007930: 742f 746f 702c 2074 6869 730a 2020 2020  t/top, this.    
+00007940: 7461 6b65 7320 6120 6c69 7374 206f 6620  takes a list of 
+00007950: 706f 6c79 676f 6e73 2061 6e64 2063 7574  polygons and cut
+00007960: 7320 7468 656d 2061 7420 7468 6520 626f  s them at the bo
+00007970: 756e 6461 7279 2c20 6469 7363 6172 6469  undary, discardi
+00007980: 6e67 2070 6172 7473 0a20 2020 206f 6620  ng parts.    of 
+00007990: 7468 6520 706f 6c79 676f 6e73 206f 7574  the polygons out
+000079a0: 7369 6465 2074 6865 2072 6563 7461 6e67  side the rectang
+000079b0: 6c65 2e0a 0a20 2020 2050 6172 616d 6574  le...    Paramet
+000079c0: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+000079d0: 2d2d 0a20 2020 2070 6f6c 7967 6f6e 7320  --.    polygons 
+000079e0: 3a20 506f 6c79 676f 6e53 6574 206f 7220  : PolygonSet or 
+000079f0: 6c69 7374 206f 6620 706f 6c79 676f 6e73  list of polygons
+00007a00: 0a20 2020 2020 2020 2053 6574 206f 7220  .        Set or 
+00007a10: 6c69 7374 206f 6620 706f 6c79 676f 6e73  list of polygons
+00007a20: 2074 6f20 6265 2063 726f 7070 6564 2e0a   to be cropped..
+00007a30: 2020 2020 6c65 6674 203a 2069 6e74 206f      left : int o
+00007a40: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
+00007a50: 5468 6520 782d 636f 6f72 6469 6e61 7465  The x-coordinate
+00007a60: 206f 6620 7468 6520 6c65 6674 6861 6e64   of the lefthand
+00007a70: 2062 6f75 6e64 6172 792e 0a20 2020 2062   boundary..    b
+00007a80: 6f74 746f 6d20 3a20 696e 7420 6f72 2066  ottom : int or f
+00007a90: 6c6f 6174 0a20 2020 2020 2020 2054 6865  loat.        The
+00007aa0: 2079 2d63 6f6f 7264 696e 6174 6520 6f66   y-coordinate of
+00007ab0: 2074 6865 2062 6f74 746f 6d20 626f 756e   the bottom boun
+00007ac0: 6461 7279 2e0a 2020 2020 7269 6768 7420  dary..    right 
+00007ad0: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
+00007ae0: 2020 2020 2020 2054 6865 2078 2d63 6f6f         The x-coo
+00007af0: 7264 696e 6174 6520 6f66 2074 6865 2072  rdinate of the r
+00007b00: 6967 6874 6861 6e64 2062 6f75 6e64 6172  ighthand boundar
+00007b10: 792e 0a20 2020 2074 6f70 203a 2069 6e74  y..    top : int
+00007b20: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
+00007b30: 2020 5468 6520 792d 636f 6f72 6469 6e61    The y-coordina
+00007b40: 7465 206f 6620 7468 6520 746f 7020 626f  te of the top bo
+00007b50: 756e 6461 7279 2e0a 2020 2020 7072 6563  undary..    prec
+00007b60: 6973 696f 6e20 3a20 666c 6f61 740a 2020  ision : float.  
+00007b70: 2020 2020 2020 4465 7369 7265 6420 7072        Desired pr
+00007b80: 6563 6973 696f 6e20 666f 7220 726f 756e  ecision for roun
+00007b90: 6469 6e67 2076 6572 7465 7820 636f 6f72  ding vertex coor
+00007ba0: 6469 6e61 7465 732e 0a0a 2020 2020 5265  dinates...    Re
+00007bb0: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00007bc0: 2d0a 2020 2020 6372 6f70 7065 645f 706f  -.    cropped_po
+00007bd0: 6c79 676f 6e73 203a 2050 6f6c 7967 6f6e  lygons : Polygon
+00007be0: 5365 7420 6f72 206c 6973 7420 6f66 2070  Set or list of p
+00007bf0: 6f6c 7967 6f6e 730a 2020 2020 2020 2020  olygons.        
+00007c00: 5365 7420 6f72 206c 6973 7420 6f66 2070  Set or list of p
+00007c10: 6f6c 7967 6f6e 7320 7468 6174 2061 7265  olygons that are
+00007c20: 2063 726f 7070 6564 2061 6363 6f72 6469   cropped accordi
+00007c30: 6e67 2074 6f20 7468 6520 7370 6563 6966  ng to the specif
+00007c40: 6965 640a 2020 2020 2020 2020 626f 756e  ied.        boun
+00007c50: 6461 7279 2e0a 2020 2020 2222 220a 2020  dary..    """.  
+00007c60: 2020 6372 6f70 7065 645f 706f 6c79 676f    cropped_polygo
+00007c70: 6e73 203d 205b 5d0a 2020 2020 666f 7220  ns = [].    for 
+00007c80: 7020 696e 2070 6f6c 7967 6f6e 733a 0a20  p in polygons:. 
+00007c90: 2020 2020 2020 2063 6c69 7070 6564 5f70         clipped_p
+00007ca0: 6f6c 7973 203d 2063 6c69 7070 6572 2e5f  olys = clipper._
+00007cb0: 6368 6f70 2870 2c20 5b74 6f70 2c20 626f  chop(p, [top, bo
+00007cc0: 7474 6f6d 5d2c 2031 2c20 3120 2f20 7072  ttom], 1, 1 / pr
+00007cd0: 6563 6973 696f 6e29 0a20 2020 2020 2020  ecision).       
+00007ce0: 2023 2070 6f6c 7967 6f6e 2c20 5b63 7574   # polygon, [cut
+00007cf0: 735d 2c20 6178 6973 2c20 7363 616c 650a  s], axis, scale.
+00007d00: 2020 2020 2020 2020 666f 7220 6370 2069          for cp i
+00007d10: 6e20 636c 6970 7065 645f 706f 6c79 735b  n clipped_polys[
+00007d20: 315d 3a0a 2020 2020 2020 2020 2020 2020  1]:.            
+00007d30: 7265 7375 6c74 203d 2063 6c69 7070 6572  result = clipper
+00007d40: 2e5f 6368 6f70 2863 702c 205b 6c65 6674  ._chop(cp, [left
+00007d50: 2c20 7269 6768 745d 2c20 302c 2031 202f  , right], 0, 1 /
+00007d60: 2070 7265 6369 7369 6f6e 290a 2020 2020   precision).    
+00007d70: 2020 2020 2020 2020 6372 6f70 7065 645f          cropped_
+00007d80: 706f 6c79 676f 6e73 202b 3d20 6c69 7374  polygons += list
+00007d90: 2872 6573 756c 745b 315d 290a 2020 2020  (result[1]).    
+00007da0: 7265 7475 726e 2063 726f 7070 6564 5f70  return cropped_p
+00007db0: 6f6c 7967 6f6e 730a 0a0a 6465 6620 5f63  olygons...def _c
+00007dc0: 726f 705f 6564 6765 5f70 6f6c 7967 6f6e  rop_edge_polygon
+00007dd0: 7328 616c 6c5f 706f 6c79 676f 6e73 2c20  s(all_polygons, 
+00007de0: 6262 6f78 6573 2c20 6c65 6674 2c20 626f  bboxes, left, bo
+00007df0: 7474 6f6d 2c20 7269 6768 742c 2074 6f70  ttom, right, top
+00007e00: 2c20 7072 6563 6973 696f 6e29 3a0a 2020  , precision):.  
+00007e10: 2020 2222 2250 6172 7365 7320 6f75 7420    """Parses out 
+00007e20: 7768 6963 6820 706f 6c79 676f 6e73 2061  which polygons a
+00007e30: 7265 2061 6c6f 6e67 2074 6865 2065 6467  re along the edg
+00007e40: 6520 6f66 2074 6865 2072 6563 7461 6e67  e of the rectang
+00007e50: 6c65 2061 6e64 206e 6565 640a 2020 2020  le and need.    
+00007e60: 746f 2062 6520 6372 6f70 7065 6420 616e  to be cropped an
+00007e70: 6420 7768 6963 6820 6172 6520 6465 6570  d which are deep
+00007e80: 2069 6e73 6964 6520 7468 6520 7265 6374   inside the rect
+00007e90: 616e 676c 6520 7265 6769 6f6e 2061 6e64  angle region and
+00007ea0: 2063 616e 2062 650a 2020 2020 6c65 6674   can be.    left
+00007eb0: 2061 6c6f 6e65 2c20 7468 656e 2063 726f   alone, then cro
+00007ec0: 7073 206f 6e6c 7920 7468 6f73 6520 706f  ps only those po
+00007ed0: 6c79 676f 6e73 2061 6c6f 6e67 2074 6865  lygons along the
+00007ee0: 2065 6467 652e 0a0a 2020 2020 5061 7261   edge...    Para
+00007ef0: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
+00007f00: 2d2d 2d2d 2d0a 2020 2020 616c 6c5f 706f  -----.    all_po
+00007f10: 6c79 676f 6e73 203a 2050 6f6c 7967 6f6e  lygons : Polygon
+00007f20: 5365 7420 6f72 206c 6973 7420 6f66 2070  Set or list of p
+00007f30: 6f6c 7967 6f6e 730a 2020 2020 2020 2020  olygons.        
+00007f40: 5365 7420 6f72 206c 6973 7420 6f66 2070  Set or list of p
+00007f50: 6f6c 7967 6f6e 7320 746f 2062 6520 6372  olygons to be cr
+00007f60: 6f70 7065 642e 0a20 2020 2062 626f 7865  opped..    bboxe
+00007f70: 7320 3a20 6c69 7374 0a20 2020 2020 2020  s : list.       
+00007f80: 204c 6973 7420 6f66 2061 6c6c 2070 6f6c   List of all pol
+00007f90: 7967 6f6e 2062 626f 7865 7320 696e 2061  ygon bboxes in a
+00007fa0: 6c6c 5f70 6f6c 7967 6f6e 732e 0a20 2020  ll_polygons..   
+00007fb0: 206c 6566 7420 3a20 696e 7420 6f72 2066   left : int or f
+00007fc0: 6c6f 6174 0a20 2020 2020 2020 2054 6865  loat.        The
+00007fd0: 2078 2d63 6f6f 7264 696e 6174 6520 6f66   x-coordinate of
+00007fe0: 2074 6865 206c 6566 7468 616e 6420 626f   the lefthand bo
+00007ff0: 756e 6461 7279 2e0a 2020 2020 626f 7474  undary..    bott
+00008000: 6f6d 203a 2069 6e74 206f 7220 666c 6f61  om : int or floa
+00008010: 740a 2020 2020 2020 2020 5468 6520 792d  t.        The y-
+00008020: 636f 6f72 6469 6e61 7465 206f 6620 7468  coordinate of th
+00008030: 6520 626f 7474 6f6d 2062 6f75 6e64 6172  e bottom boundar
+00008040: 792e 0a20 2020 2072 6967 6874 203a 2069  y..    right : i
+00008050: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
+00008060: 2020 2020 5468 6520 782d 636f 6f72 6469      The x-coordi
+00008070: 6e61 7465 206f 6620 7468 6520 7269 6768  nate of the righ
+00008080: 7468 616e 6420 626f 756e 6461 7279 2e0a  thand boundary..
+00008090: 2020 2020 746f 7020 3a20 696e 7420 6f72      top : int or
+000080a0: 2066 6c6f 6174 0a20 2020 2020 2020 2054   float.        T
+000080b0: 6865 2079 2d63 6f6f 7264 696e 6174 6520  he y-coordinate 
+000080c0: 6f66 2074 6865 2074 6f70 2062 6f75 6e64  of the top bound
+000080d0: 6172 792e 0a20 2020 2070 7265 6369 7369  ary..    precisi
+000080e0: 6f6e 203a 2066 6c6f 6174 0a20 2020 2020  on : float.     
+000080f0: 2020 2044 6573 6972 6564 2070 7265 6369     Desired preci
+00008100: 7369 6f6e 2066 6f72 2072 6f75 6e64 696e  sion for roundin
+00008110: 6720 7665 7274 6578 2063 6f6f 7264 696e  g vertex coordin
+00008120: 6174 6573 2e0a 0a20 2020 2052 6574 7572  ates...    Retur
+00008130: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
+00008140: 2020 2070 6f6c 7967 6f6e 735f 746f 5f70     polygons_to_p
+00008150: 726f 6365 7373 203a 2050 6f6c 7967 6f6e  rocess : Polygon
+00008160: 5365 7420 6f72 206c 6973 7420 6f66 2070  Set or list of p
+00008170: 6f6c 7967 6f6e 730a 2020 2020 2020 2020  olygons.        
+00008180: 5365 7420 6f72 206c 6973 7420 6f66 2070  Set or list of p
+00008190: 6f6c 7967 6f6e 7320 7769 7468 2063 726f  olygons with cro
+000081a0: 7020 6170 706c 6965 6420 746f 2065 6467  p applied to edg
+000081b0: 6520 706f 6c79 676f 6e73 2e0a 2020 2020  e polygons..    
+000081c0: 2222 220a 2020 2020 706f 6c79 676f 6e73  """.    polygons
+000081d0: 5f69 6e5f 7265 6374 5f69 203d 205f 6669  _in_rect_i = _fi
+000081e0: 6e64 5f62 626f 7865 735f 696e 5f72 6563  nd_bboxes_in_rec
+000081f0: 7428 6262 6f78 6573 2c20 6c65 6674 2c20  t(bboxes, left, 
+00008200: 626f 7474 6f6d 2c20 7269 6768 742c 2074  bottom, right, t
+00008210: 6f70 290a 2020 2020 706f 6c79 676f 6e73  op).    polygons
+00008220: 5f65 6467 655f 6920 3d20 5f66 696e 645f  _edge_i = _find_
+00008230: 6262 6f78 6573 5f6f 6e5f 7265 6374 5f65  bboxes_on_rect_e
+00008240: 6467 6528 6262 6f78 6573 2c20 6c65 6674  dge(bboxes, left
+00008250: 2c20 626f 7474 6f6d 2c20 7269 6768 742c  , bottom, right,
+00008260: 2074 6f70 290a 2020 2020 706f 6c79 676f   top).    polygo
+00008270: 6e73 5f69 6e5f 7265 6374 5f6e 6f5f 6564  ns_in_rect_no_ed
+00008280: 6765 5f69 203d 2070 6f6c 7967 6f6e 735f  ge_i = polygons_
+00008290: 696e 5f72 6563 745f 6920 2620 287e 706f  in_rect_i & (~po
+000082a0: 6c79 676f 6e73 5f65 6467 655f 6929 0a0a  lygons_edge_i)..
+000082b0: 2020 2020 2320 4372 6f70 2070 6f6c 7967      # Crop polyg
+000082c0: 6f6e 7320 616c 6f6e 6720 7468 6520 6564  ons along the ed
+000082d0: 6765 2061 6e64 2072 6563 6f6d 6269 6e65  ge and recombine
+000082e0: 2074 6865 6d20 7769 7468 2070 6f6c 7967   them with polyg
+000082f0: 6f6e 7320 696e 7369 6465 2074 6865 0a20  ons inside the. 
+00008300: 2020 2023 2072 6563 7461 6e67 6c65 0a20     # rectangle. 
+00008310: 2020 2070 6f6c 7967 6f6e 735f 6564 6765     polygons_edge
+00008320: 203d 2061 6c6c 5f70 6f6c 7967 6f6e 735b   = all_polygons[
+00008330: 706f 6c79 676f 6e73 5f65 6467 655f 695d  polygons_edge_i]
+00008340: 0a20 2020 2070 6f6c 7967 6f6e 735f 696e  .    polygons_in
+00008350: 5f72 6563 745f 6e6f 5f65 6467 6520 3d20  _rect_no_edge = 
+00008360: 616c 6c5f 706f 6c79 676f 6e73 5b70 6f6c  all_polygons[pol
+00008370: 7967 6f6e 735f 696e 5f72 6563 745f 6e6f  ygons_in_rect_no
+00008380: 5f65 6467 655f 695d 2e74 6f6c 6973 7428  _edge_i].tolist(
+00008390: 290a 2020 2020 706f 6c79 676f 6e73 5f65  ).    polygons_e
+000083a0: 6467 655f 6372 6f70 7065 6420 3d20 5f63  dge_cropped = _c
+000083b0: 726f 705f 7265 6769 6f6e 280a 2020 2020  rop_region(.    
+000083c0: 2020 2020 706f 6c79 676f 6e73 5f65 6467      polygons_edg
+000083d0: 652c 206c 6566 742c 2062 6f74 746f 6d2c  e, left, bottom,
+000083e0: 2072 6967 6874 2c20 746f 702c 2070 7265   right, top, pre
+000083f0: 6369 7369 6f6e 3d70 7265 6369 7369 6f6e  cision=precision
+00008400: 0a20 2020 2029 0a20 2020 2070 6f6c 7967  .    ).    polyg
+00008410: 6f6e 735f 746f 5f70 726f 6365 7373 203d  ons_to_process =
+00008420: 2070 6f6c 7967 6f6e 735f 696e 5f72 6563   polygons_in_rec
+00008430: 745f 6e6f 5f65 6467 6520 2b20 706f 6c79  t_no_edge + poly
+00008440: 676f 6e73 5f65 6467 655f 6372 6f70 7065  gons_edge_croppe
+00008450: 640a 0a20 2020 2072 6574 7572 6e20 706f  d..    return po
+00008460: 6c79 676f 6e73 5f74 6f5f 7072 6f63 6573  lygons_to_proces
+00008470: 730a 0a0a 6465 6620 5f66 696e 645f 6262  s...def _find_bb
+00008480: 6f78 6573 5f69 6e5f 7265 6374 2862 626f  oxes_in_rect(bbo
+00008490: 7865 732c 206c 6566 742c 2062 6f74 746f  xes, left, botto
+000084a0: 6d2c 2072 6967 6874 2c20 746f 7029 3a0a  m, right, top):.
+000084b0: 2020 2020 2222 2247 6976 656e 2061 206c      """Given a l
+000084c0: 6973 7420 6f66 2070 6f6c 7967 6f6e 2062  ist of polygon b
+000084d0: 6f75 6e64 696e 6720 626f 7865 7320 616e  ounding boxes an
+000084e0: 6420 6120 7265 6374 616e 676c 6520 6465  d a rectangle de
+000084f0: 6669 6e65 6420 6279 0a20 2020 206c 6566  fined by.    lef
+00008500: 742f 626f 7474 6f6d 2f72 6967 6874 2f74  t/bottom/right/t
+00008510: 6f70 2c20 7468 6973 2066 756e 6374 696f  op, this functio
+00008520: 6e20 7265 7475 726e 7320 7468 6f73 6520  n returns those 
+00008530: 706f 6c79 676f 6e73 2077 6869 6368 206f  polygons which o
+00008540: 7665 726c 6170 0a20 2020 2074 6865 2072  verlap.    the r
+00008550: 6563 7461 6e67 6c65 2e0a 0a20 2020 2050  ectangle...    P
+00008560: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+00008570: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2062 626f  --------.    bbo
+00008580: 7865 7320 3a20 6c69 7374 0a20 2020 2020  xes : list.     
+00008590: 2020 204c 6973 7420 6f66 2061 6c6c 2070     List of all p
+000085a0: 6f6c 7967 6f6e 2062 626f 7865 732e 0a20  olygon bboxes.. 
+000085b0: 2020 206c 6566 7420 3a20 696e 7420 6f72     left : int or
+000085c0: 2066 6c6f 6174 0a20 2020 2020 2020 2054   float.        T
+000085d0: 6865 2078 2d63 6f6f 7264 696e 6174 6520  he x-coordinate 
+000085e0: 6f66 2074 6865 206c 6566 7468 616e 6420  of the lefthand 
+000085f0: 626f 756e 6461 7279 2e0a 2020 2020 626f  boundary..    bo
+00008600: 7474 6f6d 203a 2069 6e74 206f 7220 666c  ttom : int or fl
+00008610: 6f61 740a 2020 2020 2020 2020 5468 6520  oat.        The 
+00008620: 792d 636f 6f72 6469 6e61 7465 206f 6620  y-coordinate of 
+00008630: 7468 6520 626f 7474 6f6d 2062 6f75 6e64  the bottom bound
+00008640: 6172 792e 0a20 2020 2072 6967 6874 203a  ary..    right :
+00008650: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
+00008660: 2020 2020 2020 5468 6520 782d 636f 6f72        The x-coor
+00008670: 6469 6e61 7465 206f 6620 7468 6520 7269  dinate of the ri
+00008680: 6768 7468 616e 6420 626f 756e 6461 7279  ghthand boundary
+00008690: 2e0a 2020 2020 746f 7020 3a20 696e 7420  ..    top : int 
+000086a0: 6f72 2066 6c6f 6174 0a20 2020 2020 2020  or float.       
+000086b0: 2054 6865 2079 2d63 6f6f 7264 696e 6174   The y-coordinat
+000086c0: 6520 6f66 2074 6865 2074 6f70 2062 6f75  e of the top bou
+000086d0: 6e64 6172 792e 0a0a 2020 2020 5265 7475  ndary...    Retu
+000086e0: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
+000086f0: 2020 2020 7265 7375 6c74 203a 206c 6973      result : lis
+00008700: 740a 2020 2020 2020 2020 4c69 7374 206f  t.        List o
+00008710: 6620 616c 6c20 706f 6c79 676f 6e20 6262  f all polygon bb
+00008720: 6f78 6573 2074 6861 7420 6f76 6572 6c61  oxes that overla
+00008730: 7020 7769 7468 2074 6865 2064 6566 696e  p with the defin
+00008740: 6564 2072 6563 7461 6e67 6c65 2e0a 2020  ed rectangle..  
+00008750: 2020 2222 220a 2020 2020 7265 7375 6c74    """.    result
+00008760: 203d 2028 0a20 2020 2020 2020 2028 6262   = (.        (bb
+00008770: 6f78 6573 5b3a 2c20 305d 203c 3d20 7269  oxes[:, 0] <= ri
+00008780: 6768 7429 0a20 2020 2020 2020 2026 2028  ght).        & (
+00008790: 6262 6f78 6573 5b3a 2c20 325d 203e 3d20  bboxes[:, 2] >= 
+000087a0: 6c65 6674 290a 2020 2020 2020 2020 2620  left).        & 
+000087b0: 2862 626f 7865 735b 3a2c 2031 5d20 3c3d  (bboxes[:, 1] <=
+000087c0: 2074 6f70 290a 2020 2020 2020 2020 2620   top).        & 
+000087d0: 2862 626f 7865 735b 3a2c 2033 5d20 3e3d  (bboxes[:, 3] >=
+000087e0: 2062 6f74 746f 6d29 0a20 2020 2029 0a20   bottom).    ). 
+000087f0: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
+00008800: 0a0a 0a23 205f 6669 6e64 5f62 626f 7865  ...# _find_bboxe
+00008810: 735f 6f6e 5f72 6563 745f 6564 6765 0a64  s_on_rect_edge.d
+00008820: 6566 205f 6669 6e64 5f62 626f 7865 735f  ef _find_bboxes_
+00008830: 6f6e 5f72 6563 745f 6564 6765 2862 626f  on_rect_edge(bbo
+00008840: 7865 732c 206c 6566 742c 2062 6f74 746f  xes, left, botto
+00008850: 6d2c 2072 6967 6874 2c20 746f 7029 3a0a  m, right, top):.
+00008860: 2020 2020 2222 2247 6976 656e 2061 206c      """Given a l
+00008870: 6973 7420 6f66 2070 6f6c 7967 6f6e 2062  ist of polygon b
+00008880: 6f75 6e64 696e 6720 626f 7865 7320 616e  ounding boxes an
+00008890: 6420 6120 7265 6374 616e 6775 6c61 7220  d a rectangular 
+000088a0: 626f 756e 6461 7279 0a20 2020 2064 6566  boundary.    def
+000088b0: 696e 6564 2062 7920 6c65 6674 2f62 6f74  ined by left/bot
+000088c0: 746f 6d2f 7269 6768 742f 746f 702c 2074  tom/right/top, t
+000088d0: 6869 7320 6675 6e63 7469 6f6e 2072 6574  his function ret
+000088e0: 7572 6e73 2074 686f 7365 2070 6f6c 7967  urns those polyg
+000088f0: 6f6e 730a 2020 2020 7768 6963 6820 696e  ons.    which in
+00008900: 7465 7273 6563 7420 7468 6520 7265 6374  tersect the rect
+00008910: 616e 6775 6c61 7220 626f 756e 6461 7279  angular boundary
+00008920: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
+00008930: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+00008940: 0a20 2020 2062 626f 7865 7320 3a20 6c69  .    bboxes : li
+00008950: 7374 0a20 2020 2020 2020 204c 6973 7420  st.        List 
+00008960: 6f66 2061 6c6c 2070 6f6c 7967 6f6e 2062  of all polygon b
+00008970: 626f 7865 732e 0a20 2020 206c 6566 7420  boxes..    left 
+00008980: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
+00008990: 2020 2020 2020 2054 6865 2078 2d63 6f6f         The x-coo
+000089a0: 7264 696e 6174 6520 6f66 2074 6865 206c  rdinate of the l
+000089b0: 6566 7468 616e 6420 626f 756e 6461 7279  efthand boundary
+000089c0: 2e0a 2020 2020 626f 7474 6f6d 203a 2069  ..    bottom : i
+000089d0: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
+000089e0: 2020 2020 5468 6520 792d 636f 6f72 6469      The y-coordi
+000089f0: 6e61 7465 206f 6620 7468 6520 626f 7474  nate of the bott
+00008a00: 6f6d 2062 6f75 6e64 6172 792e 0a20 2020  om boundary..   
+00008a10: 2072 6967 6874 203a 2069 6e74 206f 7220   right : int or 
+00008a20: 666c 6f61 740a 2020 2020 2020 2020 5468  float.        Th
+00008a30: 6520 782d 636f 6f72 6469 6e61 7465 206f  e x-coordinate o
+00008a40: 6620 7468 6520 7269 6768 7468 616e 6420  f the righthand 
+00008a50: 626f 756e 6461 7279 2e0a 2020 2020 746f  boundary..    to
+00008a60: 7020 3a20 696e 7420 6f72 2066 6c6f 6174  p : int or float
+00008a70: 0a20 2020 2020 2020 2054 6865 2079 2d63  .        The y-c
+00008a80: 6f6f 7264 696e 6174 6520 6f66 2074 6865  oordinate of the
+00008a90: 2074 6f70 2062 6f75 6e64 6172 792e 0a0a   top boundary...
+00008aa0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00008ab0: 2d2d 2d2d 2d2d 2d0a 2020 2020 7265 7375  -------.    resu
+00008ac0: 6c74 203a 206c 6973 740a 2020 2020 2020  lt : list.      
+00008ad0: 2020 4c69 7374 206f 6620 616c 6c20 706f    List of all po
+00008ae0: 6c79 676f 6e20 6262 6f78 6573 2074 6861  lygon bboxes tha
+00008af0: 7420 696e 7465 7273 6563 7420 7468 6520  t intersect the 
+00008b00: 6465 6669 6e65 6420 7265 6374 616e 6775  defined rectangu
+00008b10: 6c61 720a 2020 2020 2020 2020 626f 756e  lar.        boun
+00008b20: 6461 7279 2e0a 2020 2020 2222 220a 2020  dary..    """.  
+00008b30: 2020 6262 6f78 6573 5f6c 6566 7420 3d20    bboxes_left = 
+00008b40: 5f66 696e 645f 6262 6f78 6573 5f69 6e5f  _find_bboxes_in_
+00008b50: 7265 6374 2862 626f 7865 732c 206c 6566  rect(bboxes, lef
+00008b60: 742c 2062 6f74 746f 6d2c 206c 6566 742c  t, bottom, left,
+00008b70: 2074 6f70 290a 2020 2020 6262 6f78 6573   top).    bboxes
+00008b80: 5f72 6967 6874 203d 205f 6669 6e64 5f62  _right = _find_b
+00008b90: 626f 7865 735f 696e 5f72 6563 7428 6262  boxes_in_rect(bb
+00008ba0: 6f78 6573 2c20 7269 6768 742c 2062 6f74  oxes, right, bot
+00008bb0: 746f 6d2c 2072 6967 6874 2c20 746f 7029  tom, right, top)
+00008bc0: 0a20 2020 2062 626f 7865 735f 746f 7020  .    bboxes_top 
+00008bd0: 3d20 5f66 696e 645f 6262 6f78 6573 5f69  = _find_bboxes_i
+00008be0: 6e5f 7265 6374 2862 626f 7865 732c 206c  n_rect(bboxes, l
+00008bf0: 6566 742c 2074 6f70 2c20 7269 6768 742c  eft, top, right,
+00008c00: 2074 6f70 290a 2020 2020 6262 6f78 6573   top).    bboxes
+00008c10: 5f62 6f74 746f 6d20 3d20 5f66 696e 645f  _bottom = _find_
+00008c20: 6262 6f78 6573 5f69 6e5f 7265 6374 2862  bboxes_in_rect(b
+00008c30: 626f 7865 732c 206c 6566 742c 2062 6f74  boxes, left, bot
+00008c40: 746f 6d2c 2072 6967 6874 2c20 626f 7474  tom, right, bott
+00008c50: 6f6d 290a 2020 2020 7265 7375 6c74 203d  om).    result =
+00008c60: 2062 626f 7865 735f 6c65 6674 207c 2062   bboxes_left | b
+00008c70: 626f 7865 735f 7269 6768 7420 7c20 6262  boxes_right | bb
+00008c80: 6f78 6573 5f74 6f70 207c 2062 626f 7865  oxes_top | bboxe
+00008c90: 735f 626f 7474 6f6d 0a20 2020 2072 6574  s_bottom.    ret
+00008ca0: 7572 6e20 7265 7375 6c74 0a0a 0a64 6566  urn result...def
+00008cb0: 205f 6f66 6673 6574 5f72 6567 696f 6e28   _offset_region(
+00008cc0: 0a20 2020 2061 6c6c 5f70 6f6c 7967 6f6e  .    all_polygon
+00008cd0: 732c 0a20 2020 2062 626f 7865 732c 0a20  s,.    bboxes,. 
+00008ce0: 2020 206c 6566 742c 0a20 2020 2062 6f74     left,.    bot
+00008cf0: 746f 6d2c 0a20 2020 2072 6967 6874 2c0a  tom,.    right,.
+00008d00: 2020 2020 746f 702c 0a20 2020 2064 6973      top,.    dis
+00008d10: 7461 6e63 653d 352c 0a20 2020 206a 6f69  tance=5,.    joi
+00008d20: 6e5f 6669 7273 743d 5472 7565 2c0a 2020  n_first=True,.  
+00008d30: 2020 7072 6563 6973 696f 6e3d 3165 2d34    precision=1e-4
+00008d40: 2c0a 2020 2020 6a6f 696e 3d22 6d69 7465  ,.    join="mite
+00008d50: 7222 2c0a 2020 2020 746f 6c65 7261 6e63  r",.    toleranc
+00008d60: 653d 322c 0a29 3a0a 2020 2020 2222 2254  e=2,.):.    """T
+00008d70: 616b 696e 6720 6120 7265 6769 6f6e 206f  aking a region o
+00008d80: 6620 652e 672e 2073 697a 6520 2878 2c20  f e.g. size (x, 
+00008d90: 7929 2077 6869 6368 206e 6565 6473 2074  y) which needs t
+00008da0: 6f20 6265 206f 6666 7365 7420 6279 0a20  o be offset by. 
+00008db0: 2020 2064 6973 7461 6e63 6520 642c 2074     distance d, t
+00008dc0: 6869 7320 6675 6e63 7469 6f6e 2063 726f  his function cro
+00008dd0: 7073 206f 7574 2061 2072 6567 696f 6e20  ps out a region 
+00008de0: 2878 2b32 2a64 2c20 792b 322a 6429 206c  (x+2*d, y+2*d) l
+00008df0: 6172 6765 2c20 6f66 6673 6574 730a 2020  arge, offsets.  
+00008e00: 2020 7468 6174 2072 6567 696f 6e2c 2074    that region, t
+00008e10: 6865 6e20 6372 6f70 7320 6974 2062 6163  hen crops it bac
+00008e20: 6b20 746f 2073 697a 6520 2878 2c20 7929  k to size (x, y)
+00008e30: 2074 6f20 6372 6561 7465 2061 2076 616c   to create a val
+00008e40: 6964 2072 6573 756c 742e 0a0a 2020 2020  id result...    
+00008e50: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+00008e60: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 616c  ---------.    al
+00008e70: 6c5f 706f 6c79 676f 6e73 203a 2050 6f6c  l_polygons : Pol
+00008e80: 7967 6f6e 5365 7420 6f72 206c 6973 7420  ygonSet or list 
+00008e90: 6f66 2070 6f6c 7967 6f6e 730a 2020 2020  of polygons.    
+00008ea0: 2020 2020 5365 7420 6f72 206c 6973 7420      Set or list 
+00008eb0: 6f66 2070 6f6c 7967 6f6e 7320 746f 2062  of polygons to b
+00008ec0: 6520 6372 6f70 7065 6420 616e 6420 6f66  e cropped and of
+00008ed0: 6673 6574 2e0a 2020 2020 6262 6f78 6573  fset..    bboxes
+00008ee0: 203a 206c 6973 740a 2020 2020 2020 2020   : list.        
+00008ef0: 4c69 7374 206f 6620 616c 6c20 706f 6c79  List of all poly
+00008f00: 676f 6e20 6262 6f78 6573 2069 6e20 616c  gon bboxes in al
+00008f10: 6c5f 706f 6c79 676f 6e73 2e0a 2020 2020  l_polygons..    
+00008f20: 6c65 6674 203a 2069 6e74 206f 7220 666c  left : int or fl
+00008f30: 6f61 740a 2020 2020 2020 2020 5468 6520  oat.        The 
+00008f40: 782d 636f 6f72 6469 6e61 7465 206f 6620  x-coordinate of 
+00008f50: 7468 6520 6c65 6674 6861 6e64 2062 6f75  the lefthand bou
+00008f60: 6e64 6172 792e 0a20 2020 2062 6f74 746f  ndary..    botto
+00008f70: 6d20 3a20 696e 7420 6f72 2066 6c6f 6174  m : int or float
+00008f80: 0a20 2020 2020 2020 2054 6865 2079 2d63  .        The y-c
+00008f90: 6f6f 7264 696e 6174 6520 6f66 2074 6865  oordinate of the
+00008fa0: 2062 6f74 746f 6d20 626f 756e 6461 7279   bottom boundary
+00008fb0: 2e0a 2020 2020 7269 6768 7420 3a20 696e  ..    right : in
+00008fc0: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
+00008fd0: 2020 2054 6865 2078 2d63 6f6f 7264 696e     The x-coordin
+00008fe0: 6174 6520 6f66 2074 6865 2072 6967 6874  ate of the right
+00008ff0: 6861 6e64 2062 6f75 6e64 6172 792e 0a20  hand boundary.. 
+00009000: 2020 2074 6f70 203a 2069 6e74 206f 7220     top : int or 
+00009010: 666c 6f61 740a 2020 2020 2020 2020 5468  float.        Th
+00009020: 6520 792d 636f 6f72 6469 6e61 7465 206f  e y-coordinate o
+00009030: 6620 7468 6520 746f 7020 626f 756e 6461  f the top bounda
+00009040: 7279 2e0a 2020 2020 6469 7374 616e 6365  ry..    distance
+00009050: 203a 2069 6e74 206f 7220 666c 6f61 740a   : int or float.
+00009060: 2020 2020 2020 2020 4469 7374 616e 6365          Distance
+00009070: 2074 6f20 6f66 6673 6574 2070 6f6c 7967   to offset polyg
+00009080: 6f6e 732e 2050 6f73 6974 6976 6520 7661  ons. Positive va
+00009090: 6c75 6573 2065 7870 616e 642c 206e 6567  lues expand, neg
+000090a0: 6174 6976 6520 7368 7269 6e6b 2e0a 2020  ative shrink..  
+000090b0: 2020 6a6f 696e 5f66 6972 7374 203a 2062    join_first : b
+000090c0: 6f6f 6c0a 2020 2020 2020 2020 4a6f 696e  ool.        Join
+000090d0: 2061 6c6c 2070 6174 6873 2062 6566 6f72   all paths befor
+000090e0: 6520 6f66 6673 6574 7469 6e67 2074 6f20  e offsetting to 
+000090f0: 6176 6f69 6420 756e 6e65 6365 7373 6172  avoid unnecessar
+00009100: 7920 6a6f 696e 7320 696e 0a20 2020 2020  y joins in.     
+00009110: 2020 2061 646a 6163 656e 7420 706f 6c79     adjacent poly
+00009120: 676f 6e20 7369 6465 732e 0a20 2020 2070  gon sides..    p
+00009130: 7265 6369 7369 6f6e 203a 2066 6c6f 6174  recision : float
+00009140: 0a20 2020 2020 2020 2044 6573 6972 6564  .        Desired
+00009150: 2070 7265 6369 7369 6f6e 2066 6f72 2072   precision for r
+00009160: 6f75 6e64 696e 6720 7665 7274 6578 2063  ounding vertex c
+00009170: 6f6f 7264 696e 6174 6573 2e0a 2020 2020  oordinates..    
+00009180: 6a6f 696e 203a 207b 276d 6974 6572 272c  join : {'miter',
+00009190: 2027 6265 7665 6c27 2c20 2772 6f75 6e64   'bevel', 'round
+000091a0: 277d 0a20 2020 2020 2020 2054 7970 6520  '}.        Type 
+000091b0: 6f66 206a 6f69 6e20 7573 6564 2074 6f20  of join used to 
+000091c0: 6372 6561 7465 2074 6865 206f 6666 7365  create the offse
+000091d0: 7420 706f 6c79 676f 6e2e 0a20 2020 2074  t polygon..    t
+000091e0: 6f6c 6572 616e 6365 203a 2069 6e74 206f  olerance : int o
+000091f0: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
+00009200: 466f 7220 6d69 7465 7220 6a6f 696e 7473  For miter joints
+00009210: 2c20 7468 6973 206e 756d 6265 7220 6d75  , this number mu
+00009220: 7374 2062 6520 6174 206c 6561 7374 2032  st be at least 2
+00009230: 2061 6e64 2069 7420 7265 7072 6573 656e   and it represen
+00009240: 7473 2074 6865 0a20 2020 2020 2020 206d  ts the.        m
+00009250: 6178 696d 616c 2064 6973 7461 6e63 6520  aximal distance 
+00009260: 696e 206d 756c 7469 706c 6573 206f 6620  in multiples of 
+00009270: 6f66 6673 6574 2062 6574 7765 656e 206e  offset between n
+00009280: 6577 2076 6572 7469 6365 7320 616e 6420  ew vertices and 
+00009290: 7468 6569 720a 2020 2020 2020 2020 6f72  their.        or
+000092a0: 6967 696e 616c 2070 6f73 6974 696f 6e20  iginal position 
+000092b0: 6265 666f 7265 2062 6576 656c 696e 6720  before beveling 
+000092c0: 746f 2061 766f 6964 2073 7069 6b65 7320  to avoid spikes 
+000092d0: 6174 2061 6375 7465 206a 6f69 6e74 732e  at acute joints.
+000092e0: 2046 6f72 0a20 2020 2020 2020 2072 6f75   For.        rou
+000092f0: 6e64 206a 6f69 6e74 732c 2069 7420 696e  nd joints, it in
+00009300: 6469 6361 7465 7320 7468 6520 6375 7276  dicates the curv
+00009310: 6174 7572 6520 7265 736f 6c75 7469 6f6e  ature resolution
+00009320: 2069 6e20 6e75 6d62 6572 206f 660a 2020   in number of.  
+00009330: 2020 2020 2020 706f 696e 7473 2070 6572        points per
+00009340: 2066 756c 6c20 6369 7263 6c65 2e0a 0a20   full circle... 
+00009350: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
+00009360: 2d2d 2d2d 2d2d 0a20 2020 2070 6f6c 7967  ------.    polyg
+00009370: 6f6e 735f 6f66 6673 6574 5f63 726f 7070  ons_offset_cropp
+00009380: 6564 203a 0a20 2020 2020 2020 2054 6865  ed :.        The
+00009390: 2072 6573 756c 7469 6e67 2069 6e70 7574   resulting input
+000093a0: 2070 6f6c 7967 6f6e 7320 7468 6174 2061   polygons that a
+000093b0: 7265 2063 726f 7070 6564 2074 6f20 6265  re cropped to be
+000093c0: 2062 6574 7765 656e 2074 6865 0a20 2020   between the.   
+000093d0: 2020 2020 2063 6f6f 7264 696e 6174 6573       coordinates
+000093e0: 2028 6c65 6674 2c20 626f 7474 6f6d 2c20   (left, bottom, 
+000093f0: 7269 6768 742c 2074 6f70 290a 0a20 2020  right, top)..   
+00009400: 2022 2222 0a0a 2020 2020 2320 4d61 726b   """..    # Mark
+00009410: 206f 7574 2061 2072 6567 696f 6e20 736c   out a region sl
+00009420: 6967 6874 6c79 206c 6172 6765 7220 7468  ightly larger th
+00009430: 616e 2074 6865 2066 696e 616c 2064 6573  an the final des
+00009440: 6972 6564 2072 6567 696f 6e0a 2020 2020  ired region.    
+00009450: 6420 3d20 6469 7374 616e 6365 202a 2031  d = distance * 1
+00009460: 2e30 310a 0a20 2020 2070 6f6c 7967 6f6e  .01..    polygon
+00009470: 735f 746f 5f6f 6666 7365 7420 3d20 5f63  s_to_offset = _c
+00009480: 726f 705f 6564 6765 5f70 6f6c 7967 6f6e  rop_edge_polygon
+00009490: 7328 0a20 2020 2020 2020 2061 6c6c 5f70  s(.        all_p
+000094a0: 6f6c 7967 6f6e 732c 0a20 2020 2020 2020  olygons,.       
+000094b0: 2062 626f 7865 732c 0a20 2020 2020 2020   bboxes,.       
+000094c0: 206c 6566 7420 2d20 642c 0a20 2020 2020   left - d,.     
+000094d0: 2020 2062 6f74 746f 6d20 2d20 642c 0a20     bottom - d,. 
+000094e0: 2020 2020 2020 2072 6967 6874 202b 2064         right + d
+000094f0: 2c0a 2020 2020 2020 2020 746f 7020 2b20  ,.        top + 
+00009500: 642c 0a20 2020 2020 2020 2070 7265 6369  d,.        preci
+00009510: 7369 6f6e 3d70 7265 6369 7369 6f6e 2c0a  sion=precision,.
+00009520: 2020 2020 290a 0a20 2020 2023 204f 6666      )..    # Off
+00009530: 7365 7420 7468 6520 7265 7375 6c74 696e  set the resultin
+00009540: 6720 6372 6f70 7065 6420 706f 6c79 676f  g cropped polygo
+00009550: 6e73 2061 6e64 2072 6563 726f 7020 746f  ns and recrop to
+00009560: 2066 696e 616c 2064 6573 6972 6564 2073   final desired s
+00009570: 697a 650a 2020 2020 706f 6c79 676f 6e73  ize.    polygons
+00009580: 5f6f 6666 7365 7420 3d20 636c 6970 7065  _offset = clippe
+00009590: 722e 6f66 6673 6574 280a 2020 2020 2020  r.offset(.      
+000095a0: 2020 706f 6c79 676f 6e73 5f74 6f5f 6f66    polygons_to_of
+000095b0: 6673 6574 2c20 6469 7374 616e 6365 2c20  fset, distance, 
+000095c0: 6a6f 696e 2c20 746f 6c65 7261 6e63 652c  join, tolerance,
+000095d0: 2031 202f 2070 7265 6369 7369 6f6e 2c20   1 / precision, 
+000095e0: 696e 7428 6a6f 696e 5f66 6972 7374 290a  int(join_first).
+000095f0: 2020 2020 290a 2020 2020 706f 6c79 676f      ).    polygo
+00009600: 6e73 5f6f 6666 7365 745f 6372 6f70 7065  ns_offset_croppe
+00009610: 6420 3d20 5f63 726f 705f 7265 6769 6f6e  d = _crop_region
+00009620: 280a 2020 2020 2020 2020 706f 6c79 676f  (.        polygo
+00009630: 6e73 5f6f 6666 7365 742c 206c 6566 742c  ns_offset, left,
+00009640: 2062 6f74 746f 6d2c 2072 6967 6874 2c20   bottom, right, 
+00009650: 746f 702c 2070 7265 6369 7369 6f6e 3d70  top, precision=p
+00009660: 7265 6369 7369 6f6e 0a20 2020 2029 0a0a  recision.    )..
+00009670: 2020 2020 7265 7475 726e 2070 6f6c 7967      return polyg
+00009680: 6f6e 735f 6f66 6673 6574 5f63 726f 7070  ons_offset_cropp
+00009690: 6564 0a0a 0a64 6566 205f 706f 6c79 676f  ed...def _polygo
+000096a0: 6e73 5f74 6f5f 6262 6f78 6573 2870 6f6c  ns_to_bboxes(pol
+000096b0: 7967 6f6e 7329 3a0a 2020 2020 2222 2247  ygons):.    """G
+000096c0: 656e 6572 6174 6573 2074 6865 2062 626f  enerates the bbo
+000096d0: 7865 7320 6f66 2061 6c6c 2069 6e70 7574  xes of all input
+000096e0: 2070 6f6c 7967 6f6e 732e 0a0a 2020 2020   polygons...    
+000096f0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+00009700: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 706f  ---------.    po
+00009710: 6c79 676f 6e73 203a 2050 6f6c 7967 6f6e  lygons : Polygon
+00009720: 5365 7420 6f72 206c 6973 7420 6f66 2070  Set or list of p
+00009730: 6f6c 7967 6f6e 730a 2020 2020 2020 2020  olygons.        
+00009740: 5365 7420 6f72 206c 6973 7420 6f66 2070  Set or list of p
+00009750: 6f6c 7967 6f6e 7320 746f 2067 656e 6572  olygons to gener
+00009760: 6174 6520 6262 6f78 6573 206f 662e 0a0a  ate bboxes of...
+00009770: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00009780: 2d2d 2d2d 2d2d 2d0a 2020 2020 6262 6f78  -------.    bbox
+00009790: 6573 203a 206c 6973 740a 2020 2020 2020  es : list.      
+000097a0: 2020 4c69 7374 206f 6620 616c 6c20 706f    List of all po
+000097b0: 6c79 676f 6e20 6262 6f78 6573 2069 6e20  lygon bboxes in 
+000097c0: 706f 6c79 676f 6e73 2e0a 2020 2020 2222  polygons..    ""
+000097d0: 220a 2020 2020 2320 2020 2042 7569 6c64  ".    #    Build
+000097e0: 2062 6f75 6e64 696e 6720 626f 7865 730a   bounding boxes.
+000097f0: 2020 2020 6262 6f78 6573 203d 206e 702e      bboxes = np.
+00009800: 656d 7074 7928 5b6c 656e 2870 6f6c 7967  empty([len(polyg
+00009810: 6f6e 7329 2c20 345d 290a 2020 2020 666f  ons), 4]).    fo
+00009820: 7220 6e2c 2070 2069 6e20 656e 756d 6572  r n, p in enumer
+00009830: 6174 6528 706f 6c79 676f 6e73 293a 0a20  ate(polygons):. 
+00009840: 2020 2020 2020 206c 6566 742c 2062 6f74         left, bot
+00009850: 746f 6d20 3d20 6e70 2e6d 696e 2870 2c20  tom = np.min(p, 
+00009860: 6178 6973 3d30 290a 2020 2020 2020 2020  axis=0).        
+00009870: 7269 6768 742c 2074 6f70 203d 206e 702e  right, top = np.
+00009880: 6d61 7828 702c 2061 7869 733d 3029 0a20  max(p, axis=0). 
+00009890: 2020 2020 2020 2062 626f 7865 735b 6e5d         bboxes[n]
+000098a0: 203d 205b 6c65 6674 2c20 626f 7474 6f6d   = [left, bottom
+000098b0: 2c20 7269 6768 742c 2074 6f70 5d0a 2020  , right, top].  
+000098c0: 2020 7265 7475 726e 2062 626f 7865 730a    return bboxes.
+000098d0: 0a0a 6465 6620 5f6f 6666 7365 745f 706f  ..def _offset_po
+000098e0: 6c79 676f 6e73 5f70 6172 616c 6c65 6c28  lygons_parallel(
+000098f0: 0a20 2020 2070 6f6c 7967 6f6e 732c 0a20  .    polygons,. 
+00009900: 2020 2064 6973 7461 6e63 653d 352c 0a20     distance=5,. 
+00009910: 2020 206e 756d 5f64 6976 6973 696f 6e73     num_divisions
+00009920: 3d5b 3130 2c20 3130 5d2c 0a20 2020 206a  =[10, 10],.    j
+00009930: 6f69 6e5f 6669 7273 743d 5472 7565 2c0a  oin_first=True,.
+00009940: 2020 2020 7072 6563 6973 696f 6e3d 3165      precision=1e
+00009950: 2d34 2c0a 2020 2020 6a6f 696e 3d22 6d69  -4,.    join="mi
+00009960: 7465 7222 2c0a 2020 2020 746f 6c65 7261  ter",.    tolera
+00009970: 6e63 653d 322c 0a29 3a0a 2020 2020 2222  nce=2,.):.    ""
+00009980: 2250 6572 666f 726d 7320 7468 6520 6f66  "Performs the of
+00009990: 6673 6574 2066 756e 6374 696f 6e20 6f6e  fset function on
+000099a0: 2061 206c 6973 7420 6f66 2073 7562 7365   a list of subse
+000099b0: 6374 696f 6e73 206f 6620 7468 6520 6f72  ctions of the or
+000099c0: 6967 696e 616c 0a20 2020 2067 656f 6d65  iginal.    geome
+000099d0: 7472 790a 0a20 2020 2050 6172 616d 6574  try..    Paramet
+000099e0: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+000099f0: 2d2d 0a20 2020 2070 6f6c 7967 6f6e 7320  --.    polygons 
+00009a00: 3a20 506f 6c79 676f 6e53 6574 206f 7220  : PolygonSet or 
+00009a10: 6c69 7374 206f 6620 706f 6c79 676f 6e73  list of polygons
+00009a20: 0a0a 2020 2020 6469 7374 616e 6365 203a  ..    distance :
+00009a30: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
+00009a40: 2020 2020 2020 4469 7374 616e 6365 2074        Distance t
+00009a50: 6f20 6f66 6673 6574 2070 6f6c 7967 6f6e  o offset polygon
+00009a60: 732e 2050 6f73 6974 6976 6520 7661 6c75  s. Positive valu
+00009a70: 6573 2065 7870 616e 642c 206e 6567 6174  es expand, negat
+00009a80: 6976 6520 7368 7269 6e6b 2e0a 2020 2020  ive shrink..    
+00009a90: 6e75 6d5f 6469 7669 7369 6f6e 7320 3a20  num_divisions : 
+00009aa0: 6172 7261 792d 6c69 6b65 5b32 5d20 6f66  array-like[2] of
+00009ab0: 2069 6e74 0a20 2020 2020 2020 2054 6865   int.        The
+00009ac0: 206e 756d 6265 7220 6f66 2064 6976 6973   number of divis
+00009ad0: 696f 6e73 2077 6974 6820 7768 6963 6820  ions with which 
+00009ae0: 7468 6520 6765 6f6d 6574 7279 2069 7320  the geometry is 
+00009af0: 6469 7669 6465 6420 696e 746f 0a20 2020  divided into.   
+00009b00: 2020 2020 206d 756c 7469 706c 6520 7265       multiple re
+00009b10: 6374 616e 6775 6c61 7220 7265 6769 6f6e  ctangular region
+00009b20: 732e 2054 6869 7320 616c 6c6f 7773 2066  s. This allows f
+00009b30: 6f72 2065 6163 6820 7265 6769 6f6e 2074  or each region t
+00009b40: 6f20 6265 0a20 2020 2020 2020 2070 726f  o be.        pro
+00009b50: 6365 7373 6564 2073 6571 7565 6e74 6961  cessed sequentia
+00009b60: 6c6c 792c 2077 6869 6368 2069 7320 6d6f  lly, which is mo
+00009b70: 7265 2063 6f6d 7075 7461 7469 6f6e 616c  re computational
+00009b80: 6c79 2065 6666 6963 6965 6e74 2e0a 2020  ly efficient..  
+00009b90: 2020 6a6f 696e 5f66 6972 7374 203a 2062    join_first : b
+00009ba0: 6f6f 6c0a 2020 2020 2020 2020 4a6f 696e  ool.        Join
+00009bb0: 2061 6c6c 2070 6174 6873 2062 6566 6f72   all paths befor
+00009bc0: 6520 6f66 6673 6574 7469 6e67 2074 6f20  e offsetting to 
+00009bd0: 6176 6f69 6420 756e 6e65 6365 7373 6172  avoid unnecessar
+00009be0: 7920 6a6f 696e 7320 696e 0a20 2020 2020  y joins in.     
+00009bf0: 2020 2061 646a 6163 656e 7420 706f 6c79     adjacent poly
+00009c00: 676f 6e20 7369 6465 732e 0a20 2020 2070  gon sides..    p
+00009c10: 7265 6369 7369 6f6e 203a 2066 6c6f 6174  recision : float
+00009c20: 0a20 2020 2020 2020 2044 6573 6972 6564  .        Desired
+00009c30: 2070 7265 6369 7369 6f6e 2066 6f72 2072   precision for r
+00009c40: 6f75 6e64 696e 6720 7665 7274 6578 2063  ounding vertex c
+00009c50: 6f6f 7264 696e 6174 6573 2e0a 2020 2020  oordinates..    
+00009c60: 6a6f 696e 203a 207b 276d 6974 6572 272c  join : {'miter',
+00009c70: 2027 6265 7665 6c27 2c20 2772 6f75 6e64   'bevel', 'round
+00009c80: 277d 0a20 2020 2020 2020 2054 7970 6520  '}.        Type 
+00009c90: 6f66 206a 6f69 6e20 7573 6564 2074 6f20  of join used to 
+00009ca0: 6372 6561 7465 2074 6865 206f 6666 7365  create the offse
+00009cb0: 7420 706f 6c79 676f 6e2e 0a20 2020 2074  t polygon..    t
+00009cc0: 6f6c 6572 616e 6365 203a 2069 6e74 206f  olerance : int o
+00009cd0: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
+00009ce0: 466f 7220 6d69 7465 7220 6a6f 696e 7473  For miter joints
+00009cf0: 2c20 7468 6973 206e 756d 6265 7220 6d75  , this number mu
+00009d00: 7374 2062 6520 6174 206c 6561 7374 2032  st be at least 2
+00009d10: 2061 6e64 2069 7420 7265 7072 6573 656e   and it represen
+00009d20: 7473 2074 6865 0a20 2020 2020 2020 206d  ts the.        m
+00009d30: 6178 696d 616c 2064 6973 7461 6e63 6520  aximal distance 
+00009d40: 696e 206d 756c 7469 706c 6573 206f 6620  in multiples of 
+00009d50: 6f66 6673 6574 2062 6574 7765 656e 206e  offset between n
+00009d60: 6577 2076 6572 7469 6365 7320 616e 6420  ew vertices and 
+00009d70: 7468 6569 720a 2020 2020 2020 2020 6f72  their.        or
+00009d80: 6967 696e 616c 2070 6f73 6974 696f 6e20  iginal position 
+00009d90: 6265 666f 7265 2062 6576 656c 696e 6720  before beveling 
+00009da0: 746f 2061 766f 6964 2073 7069 6b65 7320  to avoid spikes 
+00009db0: 6174 2061 6375 7465 206a 6f69 6e74 732e  at acute joints.
+00009dc0: 2046 6f72 0a20 2020 2020 2020 2072 6f75   For.        rou
+00009dd0: 6e64 206a 6f69 6e74 732c 2069 7420 696e  nd joints, it in
+00009de0: 6469 6361 7465 7320 7468 6520 6375 7276  dicates the curv
+00009df0: 6174 7572 6520 7265 736f 6c75 7469 6f6e  ature resolution
+00009e00: 2069 6e20 6e75 6d62 6572 206f 660a 2020   in number of.  
+00009e10: 2020 2020 2020 706f 696e 7473 2070 6572        points per
+00009e20: 2066 756c 6c20 6369 7263 6c65 2e0a 0a20   full circle... 
+00009e30: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
+00009e40: 2d2d 2d2d 2d2d 0a20 2020 206f 6666 7365  ------.    offse
+00009e50: 745f 706f 6c79 676f 6e73 203a 0a0a 2020  t_polygons :..  
+00009e60: 2020 2222 220a 2020 2020 2320 4275 696c    """.    # Buil
+00009e70: 6420 626f 756e 6469 6e67 2062 6f78 6573  d bounding boxes
+00009e80: 0a20 2020 2070 6f6c 7967 6f6e 7320 3d20  .    polygons = 
+00009e90: 6e70 2e61 7361 7272 6179 2870 6f6c 7967  np.asarray(polyg
+00009ea0: 6f6e 7329 0a20 2020 2062 626f 7865 7320  ons).    bboxes 
+00009eb0: 3d20 5f70 6f6c 7967 6f6e 735f 746f 5f62  = _polygons_to_b
+00009ec0: 626f 7865 7328 706f 6c79 676f 6e73 290a  boxes(polygons).
+00009ed0: 0a20 2020 2078 6d69 6e2c 2079 6d69 6e20  .    xmin, ymin 
+00009ee0: 3d20 6e70 2e6d 696e 2862 626f 7865 735b  = np.min(bboxes[
+00009ef0: 3a2c 2030 3a32 5d2c 2061 7869 733d 3029  :, 0:2], axis=0)
+00009f00: 202d 2064 6973 7461 6e63 650a 2020 2020   - distance.    
+00009f10: 786d 6178 2c20 796d 6178 203d 206e 702e  xmax, ymax = np.
+00009f20: 6d61 7828 6262 6f78 6573 5b3a 2c20 323a  max(bboxes[:, 2:
+00009f30: 345d 2c20 6178 6973 3d30 2920 2b20 6469  4], axis=0) + di
+00009f40: 7374 616e 6365 0a0a 2020 2020 7873 697a  stance..    xsiz
+00009f50: 6520 3d20 786d 6178 202d 2078 6d69 6e0a  e = xmax - xmin.
+00009f60: 2020 2020 7973 697a 6520 3d20 796d 6178      ysize = ymax
+00009f70: 202d 2079 6d69 6e0a 2020 2020 7864 656c   - ymin.    xdel
+00009f80: 7461 203d 2078 7369 7a65 202f 206e 756d  ta = xsize / num
+00009f90: 5f64 6976 6973 696f 6e73 5b30 5d0a 2020  _divisions[0].  
+00009fa0: 2020 7964 656c 7461 203d 2079 7369 7a65    ydelta = ysize
+00009fb0: 202f 206e 756d 5f64 6976 6973 696f 6e73   / num_divisions
+00009fc0: 5b31 5d0a 2020 2020 7863 6f72 6e65 7273  [1].    xcorners
+00009fd0: 203d 2078 6d69 6e20 2b20 6e70 2e61 7261   = xmin + np.ara
+00009fe0: 6e67 6528 6e75 6d5f 6469 7669 7369 6f6e  nge(num_division
+00009ff0: 735b 305d 2920 2a20 7864 656c 7461 0a20  s[0]) * xdelta. 
+0000a000: 2020 2079 636f 726e 6572 7320 3d20 796d     ycorners = ym
+0000a010: 696e 202b 206e 702e 6172 616e 6765 286e  in + np.arange(n
+0000a020: 756d 5f64 6976 6973 696f 6e73 5b31 5d29  um_divisions[1])
+0000a030: 202a 2079 6465 6c74 610a 0a20 2020 206f   * ydelta..    o
+0000a040: 6666 7365 745f 706f 6c79 676f 6e73 203d  ffset_polygons =
+0000a050: 205b 5d0a 2020 2020 666f 7220 6e2c 2078   [].    for n, x
+0000a060: 6320 696e 2065 6e75 6d65 7261 7465 2878  c in enumerate(x
+0000a070: 636f 726e 6572 7329 3a0a 2020 2020 2020  corners):.      
+0000a080: 2020 666f 7220 6d2c 2079 6320 696e 2065    for m, yc in e
+0000a090: 6e75 6d65 7261 7465 2879 636f 726e 6572  numerate(ycorner
+0000a0a0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+0000a0b0: 6c65 6674 203d 2078 630a 2020 2020 2020  left = xc.      
+0000a0c0: 2020 2020 2020 7269 6768 7420 3d20 7863        right = xc
+0000a0d0: 202b 2078 6465 6c74 610a 2020 2020 2020   + xdelta.      
+0000a0e0: 2020 2020 2020 626f 7474 6f6d 203d 2079        bottom = y
+0000a0f0: 630a 2020 2020 2020 2020 2020 2020 746f  c.            to
+0000a100: 7020 3d20 7963 202b 2079 6465 6c74 610a  p = yc + ydelta.
+0000a110: 2020 2020 2020 2020 2020 2020 5f6f 6666              _off
+0000a120: 7365 745f 7265 6769 6f6e 5f70 6f6c 7967  set_region_polyg
+0000a130: 6f6e 7320 3d20 5f6f 6666 7365 745f 7265  ons = _offset_re
+0000a140: 6769 6f6e 280a 2020 2020 2020 2020 2020  gion(.          
+0000a150: 2020 2020 2020 706f 6c79 676f 6e73 2c0a        polygons,.
+0000a160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a170: 6262 6f78 6573 2c0a 2020 2020 2020 2020  bboxes,.        
+0000a180: 2020 2020 2020 2020 6c65 6674 2c0a 2020          left,.  
+0000a190: 2020 2020 2020 2020 2020 2020 2020 626f                bo
+0000a1a0: 7474 6f6d 2c0a 2020 2020 2020 2020 2020  ttom,.          
+0000a1b0: 2020 2020 2020 7269 6768 742c 0a20 2020        right,.   
+0000a1c0: 2020 2020 2020 2020 2020 2020 2074 6f70               top
+0000a1d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000a1e0: 2020 6469 7374 616e 6365 3d64 6973 7461    distance=dista
+0000a1f0: 6e63 652c 0a20 2020 2020 2020 2020 2020  nce,.           
+0000a200: 2020 2020 206a 6f69 6e5f 6669 7273 743d       join_first=
+0000a210: 6a6f 696e 5f66 6972 7374 2c0a 2020 2020  join_first,.    
+0000a220: 2020 2020 2020 2020 2020 2020 7072 6563              prec
+0000a230: 6973 696f 6e3d 7072 6563 6973 696f 6e2c  ision=precision,
+0000a240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a250: 206a 6f69 6e3d 6a6f 696e 2c0a 2020 2020   join=join,.    
+0000a260: 2020 2020 2020 2020 2020 2020 746f 6c65              tole
+0000a270: 7261 6e63 653d 746f 6c65 7261 6e63 652c  rance=tolerance,
+0000a280: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000a290: 2020 2020 2020 2020 2020 206f 6666 7365             offse
+0000a2a0: 745f 706f 6c79 676f 6e73 202b 3d20 5f6f  t_polygons += _o
+0000a2b0: 6666 7365 745f 7265 6769 6f6e 5f70 6f6c  ffset_region_pol
+0000a2c0: 7967 6f6e 730a 0a20 2020 2072 6574 7572  ygons..    retur
+0000a2d0: 6e20 6f66 6673 6574 5f70 6f6c 7967 6f6e  n offset_polygon
+0000a2e0: 730a 0a0a 6465 6620 5f62 6f6f 6c65 616e  s...def _boolean
+0000a2f0: 5f72 6567 696f 6e28 0a20 2020 2061 6c6c  _region(.    all
+0000a300: 5f70 6f6c 7967 6f6e 735f 412c 0a20 2020  _polygons_A,.   
+0000a310: 2061 6c6c 5f70 6f6c 7967 6f6e 735f 422c   all_polygons_B,
+0000a320: 0a20 2020 2062 626f 7865 735f 412c 0a20  .    bboxes_A,. 
+0000a330: 2020 2062 626f 7865 735f 422c 0a20 2020     bboxes_B,.   
+0000a340: 206c 6566 742c 0a20 2020 2062 6f74 746f   left,.    botto
+0000a350: 6d2c 0a20 2020 2072 6967 6874 2c0a 2020  m,.    right,.  
+0000a360: 2020 746f 702c 0a20 2020 206f 7065 7261    top,.    opera
+0000a370: 7469 6f6e 3d22 616e 6422 2c0a 2020 2020  tion="and",.    
+0000a380: 7072 6563 6973 696f 6e3d 3165 2d34 2c0a  precision=1e-4,.
+0000a390: 293a 0a20 2020 2022 2222 5461 6b69 6e67  ):.    """Taking
+0000a3a0: 2061 2072 6567 696f 6e20 6f66 2065 2e67   a region of e.g
+0000a3b0: 2e20 7369 7a65 2028 782c 2079 2920 7768  . size (x, y) wh
+0000a3c0: 6963 6820 6e65 6564 7320 746f 2062 6520  ich needs to be 
+0000a3d0: 626f 6f6c 6561 6e65 642c 0a20 2020 2074  booleaned,.    t
+0000a3e0: 6869 7320 6675 6e63 7469 6f6e 2063 726f  his function cro
+0000a3f0: 7073 206f 7574 2061 2072 6567 696f 6e20  ps out a region 
+0000a400: 2878 2c20 7929 206c 6172 6765 2066 726f  (x, y) large fro
+0000a410: 6d20 6561 6368 2073 6574 206f 6620 706f  m each set of po
+0000a420: 6c79 676f 6e73 0a20 2020 2028 4120 616e  lygons.    (A an
+0000a430: 6420 4229 2c20 626f 6f6c 6561 6e73 2074  d B), booleans t
+0000a440: 6861 7420 6372 6f70 7065 6420 7265 6769  hat cropped regi
+0000a450: 6f6e 2061 6e64 2072 6574 7572 6e73 2074  on and returns t
+0000a460: 6865 2072 6573 756c 742e 0a0a 2020 2020  he result...    
+0000a470: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+0000a480: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 616c  ---------.    al
+0000a490: 6c5f 706f 6c79 676f 6e73 5f41 203a 2050  l_polygons_A : P
+0000a4a0: 6f6c 7967 6f6e 5365 7420 6f72 206c 6973  olygonSet or lis
+0000a4b0: 7420 6f66 2070 6f6c 7967 6f6e 730a 2020  t of polygons.  
+0000a4c0: 2020 2020 2020 5365 7420 6f72 206c 6973        Set or lis
+0000a4d0: 7420 6f66 2070 6f6c 7967 6f6e 7320 746f  t of polygons to
+0000a4e0: 2062 6520 626f 6f6c 6561 6e65 642e 0a20   be booleaned.. 
+0000a4f0: 2020 2061 6c6c 5f70 6f6c 7967 6f6e 735f     all_polygons_
+0000a500: 4220 3a20 506f 6c79 676f 6e53 6574 206f  B : PolygonSet o
+0000a510: 7220 6c69 7374 206f 6620 706f 6c79 676f  r list of polygo
+0000a520: 6e73 0a20 2020 2020 2020 2053 6574 206f  ns.        Set o
+0000a530: 7220 6c69 7374 206f 6620 706f 6c79 676f  r list of polygo
+0000a540: 6e73 2074 6f20 6265 2062 6f6f 6c65 616e  ns to be boolean
+0000a550: 6564 2e0a 2020 2020 6262 6f78 6573 5f41  ed..    bboxes_A
+0000a560: 203a 206c 6973 740a 2020 2020 2020 2020   : list.        
+0000a570: 4c69 7374 206f 6620 616c 6c20 706f 6c79  List of all poly
+0000a580: 676f 6e20 6262 6f78 6573 2069 6e20 616c  gon bboxes in al
+0000a590: 6c5f 706f 6c79 676f 6e73 5f41 0a20 2020  l_polygons_A.   
+0000a5a0: 2062 626f 7865 735f 4220 3a20 6c69 7374   bboxes_B : list
+0000a5b0: 0a20 2020 2020 2020 204c 6973 7420 6f66  .        List of
+0000a5c0: 2061 6c6c 2070 6f6c 7967 6f6e 2062 626f   all polygon bbo
+0000a5d0: 7865 7320 696e 2061 6c6c 5f70 6f6c 7967  xes in all_polyg
+0000a5e0: 6f6e 735f 420a 2020 2020 6c65 6674 203a  ons_B.    left :
+0000a5f0: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
+0000a600: 2020 2020 2020 5468 6520 782d 636f 6f72        The x-coor
+0000a610: 6469 6e61 7465 206f 6620 7468 6520 6c65  dinate of the le
+0000a620: 6674 6861 6e64 2062 6f75 6e64 6172 792e  fthand boundary.
+0000a630: 0a20 2020 2062 6f74 746f 6d20 3a20 696e  .    bottom : in
+0000a640: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
+0000a650: 2020 2054 6865 2079 2d63 6f6f 7264 696e     The y-coordin
+0000a660: 6174 6520 6f66 2074 6865 2062 6f74 746f  ate of the botto
+0000a670: 6d20 626f 756e 6461 7279 2e0a 2020 2020  m boundary..    
+0000a680: 7269 6768 7420 3a20 696e 7420 6f72 2066  right : int or f
+0000a690: 6c6f 6174 0a20 2020 2020 2020 2054 6865  loat.        The
+0000a6a0: 2078 2d63 6f6f 7264 696e 6174 6520 6f66   x-coordinate of
+0000a6b0: 2074 6865 2072 6967 6874 6861 6e64 2062   the righthand b
+0000a6c0: 6f75 6e64 6172 792e 0a20 2020 2074 6f70  oundary..    top
+0000a6d0: 203a 2069 6e74 206f 7220 666c 6f61 740a   : int or float.
+0000a6e0: 2020 2020 2020 2020 5468 6520 792d 636f          The y-co
+0000a6f0: 6f72 6469 6e61 7465 206f 6620 7468 6520  ordinate of the 
+0000a700: 746f 7020 626f 756e 6461 7279 2e0a 2020  top boundary..  
+0000a710: 2020 6f70 6572 6174 696f 6e20 3a20 7b27    operation : {'
+0000a720: 6e6f 7427 2c20 2761 6e64 272c 2027 6f72  not', 'and', 'or
+0000a730: 272c 2027 786f 7227 2c20 2741 2d42 272c  ', 'xor', 'A-B',
+0000a740: 2027 422d 4127 2c20 2741 2b42 277d 0a20   'B-A', 'A+B'}. 
+0000a750: 2020 2020 2020 2042 6f6f 6c65 616e 206f         Boolean o
+0000a760: 7065 7261 7469 6f6e 2074 6f20 7065 7266  peration to perf
+0000a770: 6f72 6d2e 0a20 2020 2070 7265 6369 7369  orm..    precisi
+0000a780: 6f6e 203a 2066 6c6f 6174 0a20 2020 2020  on : float.     
+0000a790: 2020 2044 6573 6972 6564 2070 7265 6369     Desired preci
+0000a7a0: 7369 6f6e 2066 6f72 2072 6f75 6e64 696e  sion for roundin
+0000a7b0: 6720 7665 7274 6578 2063 6f6f 7264 696e  g vertex coordin
+0000a7c0: 6174 6573 2e0a 0a20 2020 2052 6574 7572  ates...    Retur
+0000a7d0: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
+0000a7e0: 2020 2070 6f6c 7967 6f6e 735f 626f 6f6c     polygons_bool
+0000a7f0: 6561 6e20 3a20 506f 6c79 676f 6e53 6574  ean : PolygonSet
+0000a800: 206f 7220 6c69 7374 206f 6620 706f 6c79   or list of poly
+0000a810: 676f 6e73 0a20 2020 2020 2020 2053 6574  gons.        Set
+0000a820: 206f 7220 6c69 7374 206f 6620 706f 6c79   or list of poly
+0000a830: 676f 6e73 2077 6974 6820 626f 6f6c 6561  gons with boolea
+0000a840: 6e20 6f70 6572 6174 696f 6e20 6170 706c  n operation appl
+0000a850: 6965 642e 0a20 2020 2022 2222 0a0a 2020  ied..    """..  
+0000a860: 2020 706f 6c79 676f 6e73 5f74 6f5f 626f    polygons_to_bo
+0000a870: 6f6c 6561 6e5f 4120 3d20 5f63 726f 705f  olean_A = _crop_
+0000a880: 6564 6765 5f70 6f6c 7967 6f6e 7328 0a20  edge_polygons(. 
+0000a890: 2020 2020 2020 2061 6c6c 5f70 6f6c 7967         all_polyg
+0000a8a0: 6f6e 735f 412c 2062 626f 7865 735f 412c  ons_A, bboxes_A,
+0000a8b0: 206c 6566 742c 2062 6f74 746f 6d2c 2072   left, bottom, r
+0000a8c0: 6967 6874 2c20 746f 702c 2070 7265 6369  ight, top, preci
+0000a8d0: 7369 6f6e 0a20 2020 2029 0a20 2020 2070  sion.    ).    p
+0000a8e0: 6f6c 7967 6f6e 735f 746f 5f62 6f6f 6c65  olygons_to_boole
+0000a8f0: 616e 5f42 203d 205f 6372 6f70 5f65 6467  an_B = _crop_edg
+0000a900: 655f 706f 6c79 676f 6e73 280a 2020 2020  e_polygons(.    
+0000a910: 2020 2020 616c 6c5f 706f 6c79 676f 6e73      all_polygons
+0000a920: 5f42 2c20 6262 6f78 6573 5f42 2c20 6c65  _B, bboxes_B, le
+0000a930: 6674 2c20 626f 7474 6f6d 2c20 7269 6768  ft, bottom, righ
+0000a940: 742c 2074 6f70 2c20 7072 6563 6973 696f  t, top, precisio
+0000a950: 6e0a 2020 2020 290a 2020 2020 706f 6c79  n.    ).    poly
+0000a960: 676f 6e73 5f62 6f6f 6c65 616e 203d 2063  gons_boolean = c
+0000a970: 6c69 7070 6572 2e63 6c69 7028 0a20 2020  lipper.clip(.   
+0000a980: 2020 2020 2070 6f6c 7967 6f6e 735f 746f       polygons_to
+0000a990: 5f62 6f6f 6c65 616e 5f41 2c20 706f 6c79  _boolean_A, poly
+0000a9a0: 676f 6e73 5f74 6f5f 626f 6f6c 6561 6e5f  gons_to_boolean_
+0000a9b0: 422c 206f 7065 7261 7469 6f6e 2c20 3120  B, operation, 1 
+0000a9c0: 2f20 7072 6563 6973 696f 6e0a 2020 2020  / precision.    
+0000a9d0: 290a 2020 2020 7265 7475 726e 2070 6f6c  ).    return pol
+0000a9e0: 7967 6f6e 735f 626f 6f6c 6561 6e0a 0a0a  ygons_boolean...
+0000a9f0: 6465 6620 5f62 6f6f 6c65 616e 5f70 6f6c  def _boolean_pol
+0000aa00: 7967 6f6e 735f 7061 7261 6c6c 656c 280a  ygons_parallel(.
+0000aa10: 2020 2020 706f 6c79 676f 6e73 5f41 2c20      polygons_A, 
+0000aa20: 706f 6c79 676f 6e73 5f42 2c20 6e75 6d5f  polygons_B, num_
+0000aa30: 6469 7669 7369 6f6e 733d 5b31 302c 2031  divisions=[10, 1
+0000aa40: 305d 2c20 6f70 6572 6174 696f 6e3d 2261  0], operation="a
+0000aa50: 6e64 222c 2070 7265 6369 7369 6f6e 3d31  nd", precision=1
+0000aa60: 652d 340a 293a 0a20 2020 2022 2222 5065  e-4.):.    """Pe
+0000aa70: 7266 6f72 6d73 2074 6865 2062 6f6f 6c65  rforms the boole
+0000aa80: 616e 2066 756e 6374 696f 6e20 6f6e 2061  an function on a
+0000aa90: 206c 6973 7420 6f66 2073 7562 7365 6374   list of subsect
+0000aaa0: 696f 6e73 206f 6620 7468 6520 6f72 6967  ions of the orig
+0000aab0: 696e 616c 0a20 2020 2067 656f 6d65 7472  inal.    geometr
+0000aac0: 790a 0a20 2020 2050 6172 616d 6574 6572  y..    Parameter
+0000aad0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+0000aae0: 0a20 2020 2070 6f6c 7967 6f6e 735f 4120  .    polygons_A 
+0000aaf0: 3a20 506f 6c79 676f 6e53 6574 206f 7220  : PolygonSet or 
+0000ab00: 6c69 7374 206f 6620 706f 6c79 676f 6e73  list of polygons
+0000ab10: 0a20 2020 2020 2020 2053 6574 206f 7220  .        Set or 
+0000ab20: 6c69 7374 206f 6620 706f 6c79 676f 6e73  list of polygons
+0000ab30: 2074 6f20 6265 2062 6f6f 6c65 616e 6564   to be booleaned
+0000ab40: 2e0a 2020 2020 706f 6c79 676f 6e73 5f42  ..    polygons_B
+0000ab50: 203a 2050 6f6c 7967 6f6e 5365 7420 6f72   : PolygonSet or
+0000ab60: 206c 6973 7420 6f66 2070 6f6c 7967 6f6e   list of polygon
+0000ab70: 730a 2020 2020 2020 2020 5365 7420 6f72  s.        Set or
+0000ab80: 206c 6973 7420 6f66 2070 6f6c 7967 6f6e   list of polygon
+0000ab90: 7320 746f 2062 6520 626f 6f6c 6561 6e65  s to be booleane
+0000aba0: 642e 0a20 2020 206e 756d 5f64 6976 6973  d..    num_divis
+0000abb0: 696f 6e73 203a 2061 7272 6179 2d6c 696b  ions : array-lik
+0000abc0: 655b 325d 206f 6620 696e 740a 2020 2020  e[2] of int.    
+0000abd0: 2020 2020 5468 6520 6e75 6d62 6572 206f      The number o
+0000abe0: 6620 6469 7669 7369 6f6e 7320 7769 7468  f divisions with
+0000abf0: 2077 6869 6368 2074 6865 2067 656f 6d65   which the geome
+0000ac00: 7472 7920 6973 2064 6976 6964 6564 2069  try is divided i
+0000ac10: 6e74 6f0a 2020 2020 2020 2020 6d75 6c74  nto.        mult
+0000ac20: 6970 6c65 2072 6563 7461 6e67 756c 6172  iple rectangular
+0000ac30: 2072 6567 696f 6e73 2e20 5468 6973 2061   regions. This a
+0000ac40: 6c6c 6f77 7320 666f 7220 6561 6368 2072  llows for each r
+0000ac50: 6567 696f 6e20 746f 2062 650a 2020 2020  egion to be.    
+0000ac60: 2020 2020 7072 6f63 6573 7365 6420 7365      processed se
+0000ac70: 7175 656e 7469 616c 6c79 2c20 7768 6963  quentially, whic
+0000ac80: 6820 6973 206d 6f72 6520 636f 6d70 7574  h is more comput
+0000ac90: 6174 696f 6e61 6c6c 7920 6566 6669 6369  ationally effici
+0000aca0: 656e 742e 0a20 2020 206f 7065 7261 7469  ent..    operati
+0000acb0: 6f6e 203a 207b 276e 6f74 272c 2027 616e  on : {'not', 'an
+0000acc0: 6427 2c20 276f 7227 2c20 2778 6f72 272c  d', 'or', 'xor',
+0000acd0: 2027 412d 4227 2c20 2742 2d41 272c 2027   'A-B', 'B-A', '
+0000ace0: 412b 4227 7d0a 2020 2020 2020 2020 426f  A+B'}.        Bo
+0000acf0: 6f6c 6561 6e20 6f70 6572 6174 696f 6e20  olean operation 
+0000ad00: 746f 2070 6572 666f 726d 2e0a 2020 2020  to perform..    
+0000ad10: 7072 6563 6973 696f 6e20 3a20 666c 6f61  precision : floa
+0000ad20: 740a 2020 2020 2020 2020 4465 7369 7265  t.        Desire
+0000ad30: 6420 7072 6563 6973 696f 6e20 666f 7220  d precision for 
+0000ad40: 726f 756e 6469 6e67 2076 6572 7465 7820  rounding vertex 
+0000ad50: 636f 6f72 6469 6e61 7465 732e 0a0a 2020  coordinates...  
+0000ad60: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
+0000ad70: 2d2d 2d2d 2d0a 2020 2020 626f 6f6c 6561  -----.    boolea
+0000ad80: 6e5f 706f 6c79 676f 6e73 203a 206c 6973  n_polygons : lis
+0000ad90: 7420 6f66 2070 6f6c 7967 6f6e 730a 2020  t of polygons.  
+0000ada0: 2020 2020 2020 416c 6c20 7468 6520 626f        All the bo
+0000adb0: 6f6c 6561 6e65 6420 706f 6c79 676f 6e73  oleaned polygons
+0000adc0: 2066 726f 6d20 6561 6368 206f 6620 7468   from each of th
+0000add0: 6520 7375 6273 6563 7469 6f6e 730a 0a20  e subsections.. 
+0000ade0: 2020 2022 2222 0a20 2020 2023 2042 7569     """.    # Bui
+0000adf0: 6c64 2062 6f75 6e64 696e 6720 626f 7865  ld bounding boxe
+0000ae00: 730a 2020 2020 706f 6c79 676f 6e73 5f41  s.    polygons_A
+0000ae10: 203d 206e 702e 6173 6172 7261 7928 706f   = np.asarray(po
+0000ae20: 6c79 676f 6e73 5f41 2c20 6474 7970 653d  lygons_A, dtype=
+0000ae30: 6f62 6a65 6374 290a 2020 2020 706f 6c79  object).    poly
+0000ae40: 676f 6e73 5f42 203d 206e 702e 6173 6172  gons_B = np.asar
+0000ae50: 7261 7928 706f 6c79 676f 6e73 5f42 2c20  ray(polygons_B, 
+0000ae60: 6474 7970 653d 6f62 6a65 6374 290a 2020  dtype=object).  
+0000ae70: 2020 6262 6f78 6573 5f41 203d 205f 706f    bboxes_A = _po
+0000ae80: 6c79 676f 6e73 5f74 6f5f 6262 6f78 6573  lygons_to_bboxes
+0000ae90: 2870 6f6c 7967 6f6e 735f 4129 0a20 2020  (polygons_A).   
+0000aea0: 2062 626f 7865 735f 4220 3d20 5f70 6f6c   bboxes_B = _pol
+0000aeb0: 7967 6f6e 735f 746f 5f62 626f 7865 7328  ygons_to_bboxes(
+0000aec0: 706f 6c79 676f 6e73 5f42 290a 0a20 2020  polygons_B)..   
+0000aed0: 2078 6d69 6e2c 2079 6d69 6e20 3d20 6e70   xmin, ymin = np
+0000aee0: 2e6d 696e 280a 2020 2020 2020 2020 5b6e  .min(.        [n
+0000aef0: 702e 6d69 6e28 6262 6f78 6573 5f41 5b3a  p.min(bboxes_A[:
+0000af00: 2c20 303a 325d 2c20 6178 6973 3d30 292c  , 0:2], axis=0),
+0000af10: 206e 702e 6d69 6e28 6262 6f78 6573 5f42   np.min(bboxes_B
+0000af20: 5b3a 2c20 303a 325d 2c20 6178 6973 3d30  [:, 0:2], axis=0
+0000af30: 295d 2c20 6178 6973 3d30 0a20 2020 2029  )], axis=0.    )
+0000af40: 0a20 2020 2078 6d61 782c 2079 6d61 7820  .    xmax, ymax 
+0000af50: 3d20 6e70 2e6d 6178 280a 2020 2020 2020  = np.max(.      
+0000af60: 2020 5b6e 702e 6d61 7828 6262 6f78 6573    [np.max(bboxes
+0000af70: 5f41 5b3a 2c20 323a 345d 2c20 6178 6973  _A[:, 2:4], axis
+0000af80: 3d30 292c 206e 702e 6d61 7828 6262 6f78  =0), np.max(bbox
+0000af90: 6573 5f42 5b3a 2c20 323a 345d 2c20 6178  es_B[:, 2:4], ax
+0000afa0: 6973 3d30 295d 2c20 6178 6973 3d30 0a20  is=0)], axis=0. 
+0000afb0: 2020 2029 0a0a 2020 2020 7873 697a 6520     )..    xsize 
+0000afc0: 3d20 786d 6178 202d 2078 6d69 6e0a 2020  = xmax - xmin.  
+0000afd0: 2020 7973 697a 6520 3d20 796d 6178 202d    ysize = ymax -
+0000afe0: 2079 6d69 6e0a 2020 2020 7864 656c 7461   ymin.    xdelta
+0000aff0: 203d 2078 7369 7a65 202f 206e 756d 5f64   = xsize / num_d
+0000b000: 6976 6973 696f 6e73 5b30 5d0a 2020 2020  ivisions[0].    
+0000b010: 7964 656c 7461 203d 2079 7369 7a65 202f  ydelta = ysize /
+0000b020: 206e 756d 5f64 6976 6973 696f 6e73 5b31   num_divisions[1
+0000b030: 5d0a 2020 2020 7863 6f72 6e65 7273 203d  ].    xcorners =
+0000b040: 2078 6d69 6e20 2b20 6e70 2e61 7261 6e67   xmin + np.arang
+0000b050: 6528 6e75 6d5f 6469 7669 7369 6f6e 735b  e(num_divisions[
+0000b060: 305d 2920 2a20 7864 656c 7461 0a20 2020  0]) * xdelta.   
+0000b070: 2079 636f 726e 6572 7320 3d20 796d 696e   ycorners = ymin
+0000b080: 202b 206e 702e 6172 616e 6765 286e 756d   + np.arange(num
+0000b090: 5f64 6976 6973 696f 6e73 5b31 5d29 202a  _divisions[1]) *
+0000b0a0: 2079 6465 6c74 610a 0a20 2020 2062 6f6f   ydelta..    boo
+0000b0b0: 6c65 616e 5f70 6f6c 7967 6f6e 7320 3d20  lean_polygons = 
+0000b0c0: 5b5d 0a20 2020 2066 6f72 206e 2c20 7863  [].    for n, xc
+0000b0d0: 2069 6e20 656e 756d 6572 6174 6528 7863   in enumerate(xc
+0000b0e0: 6f72 6e65 7273 293a 0a20 2020 2020 2020  orners):.       
+0000b0f0: 2066 6f72 206d 2c20 7963 2069 6e20 656e   for m, yc in en
+0000b100: 756d 6572 6174 6528 7963 6f72 6e65 7273  umerate(ycorners
+0000b110: 293a 0a20 2020 2020 2020 2020 2020 206c  ):.            l
+0000b120: 6566 7420 3d20 7863 0a20 2020 2020 2020  eft = xc.       
+0000b130: 2020 2020 2072 6967 6874 203d 2078 6320       right = xc 
+0000b140: 2b20 7864 656c 7461 0a20 2020 2020 2020  + xdelta.       
+0000b150: 2020 2020 2062 6f74 746f 6d20 3d20 7963       bottom = yc
+0000b160: 0a20 2020 2020 2020 2020 2020 2074 6f70  .            top
+0000b170: 203d 2079 6320 2b20 7964 656c 7461 0a20   = yc + ydelta. 
+0000b180: 2020 2020 2020 2020 2020 205f 626f 6f6c             _bool
+0000b190: 6561 6e5f 7265 6769 6f6e 5f70 6f6c 7967  ean_region_polyg
+0000b1a0: 6f6e 7320 3d20 5f62 6f6f 6c65 616e 5f72  ons = _boolean_r
+0000b1b0: 6567 696f 6e28 0a20 2020 2020 2020 2020  egion(.         
+0000b1c0: 2020 2020 2020 2070 6f6c 7967 6f6e 735f         polygons_
+0000b1d0: 412c 0a20 2020 2020 2020 2020 2020 2020  A,.             
+0000b1e0: 2020 2070 6f6c 7967 6f6e 735f 422c 0a20     polygons_B,. 
+0000b1f0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0000b200: 626f 7865 735f 412c 0a20 2020 2020 2020  boxes_A,.       
+0000b210: 2020 2020 2020 2020 2062 626f 7865 735f           bboxes_
+0000b220: 422c 0a20 2020 2020 2020 2020 2020 2020  B,.             
+0000b230: 2020 206c 6566 742c 0a20 2020 2020 2020     left,.       
+0000b240: 2020 2020 2020 2020 2062 6f74 746f 6d2c           bottom,
+0000b250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b260: 2072 6967 6874 2c0a 2020 2020 2020 2020   right,.        
+0000b270: 2020 2020 2020 2020 746f 702c 0a20 2020          top,.   
+0000b280: 2020 2020 2020 2020 2020 2020 206f 7065               ope
+0000b290: 7261 7469 6f6e 3d6f 7065 7261 7469 6f6e  ration=operation
+0000b2a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000b2b0: 2020 7072 6563 6973 696f 6e3d 7072 6563    precision=prec
+0000b2c0: 6973 696f 6e2c 0a20 2020 2020 2020 2020  ision,.         
+0000b2d0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000b2e0: 2062 6f6f 6c65 616e 5f70 6f6c 7967 6f6e   boolean_polygon
+0000b2f0: 7320 2b3d 205f 626f 6f6c 6561 6e5f 7265  s += _boolean_re
+0000b300: 6769 6f6e 5f70 6f6c 7967 6f6e 730a 0a20  gion_polygons.. 
+0000b310: 2020 2072 6574 7572 6e20 626f 6f6c 6561     return boolea
+0000b320: 6e5f 706f 6c79 676f 6e73 0a0a 0a23 203d  n_polygons...# =
+0000b330: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000b340: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000b350: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000b360: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000b370: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 2320  =============.# 
+0000b380: 4b4c 6179 6f75 7420 7574 696c 6974 7920  KLayout utility 
+0000b390: 6675 6e63 7469 6f6e 730a 2320 3d3d 3d3d  functions.# ====
+0000b3a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000b3b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000b3c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000b3d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000b3e0: 3d3d 3d3d 3d3d 3d3d 3d3d 0a0a 0a64 6566  ==========...def
+0000b3f0: 205f 6b6c 5f70 6f6c 7967 6f6e 5f74 6f5f   _kl_polygon_to_
+0000b400: 6172 7261 7928 6b6c 5f70 6f6c 7967 6f6e  array(kl_polygon
+0000b410: 293a 0a20 2020 2072 6574 7572 6e20 5b28  ):.    return [(
+0000b420: 7074 2e78 2c20 7074 2e79 2920 666f 7220  pt.x, pt.y) for 
+0000b430: 7074 2069 6e20 6b6c 5f70 6f6c 7967 6f6e  pt in kl_polygon
+0000b440: 2e65 6163 685f 706f 696e 7428 295d 0a0a  .each_point()]..
+0000b450: 0a64 6566 205f 6f62 6a65 6374 735f 746f  .def _objects_to
+0000b460: 5f6b 6c5f 7265 6769 6f6e 2865 6c65 6d65  _kl_region(eleme
+0000b470: 6e74 732c 2070 7265 6369 7369 6f6e 293a  nts, precision):
+0000b480: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
+0000b490: 2020 696d 706f 7274 206b 6c61 796f 7574    import klayout
+0000b4a0: 2e64 6220 6173 206b 6462 0a20 2020 2065  .db as kdb.    e
+0000b4b0: 7863 6570 7420 496d 706f 7274 4572 726f  xcept ImportErro
+0000b4c0: 723a 0a20 2020 2020 2020 2072 6169 7365  r:.        raise
+0000b4d0: 2049 6d70 6f72 7445 7272 6f72 280a 2020   ImportError(.  
+0000b4e0: 2020 2020 2020 2020 2020 2250 4849 444c            "PHIDL
+0000b4f0: 2074 7269 6564 2074 6f20 696d 706f 7274   tried to import
+0000b500: 2074 6865 206b 6c61 796f 7574 206d 6f64   the klayout mod
+0000b510: 756c 6520 6275 7420 6974 2066 6169 6c65  ule but it faile
+0000b520: 642e 2050 6c65 6173 6520 220a 2020 2020  d. Please ".    
+0000b530: 2020 2020 2020 2020 2b20 2269 6e73 7461          + "insta
+0000b540: 6c6c 2074 6865 206b 6c61 796f 7574 2050  ll the klayout P
+0000b550: 7974 686f 6e20 7061 636b 6167 6520 7769  ython package wi
+0000b560: 7468 2022 0a20 2020 2020 2020 2020 2020  th ".           
+0000b570: 202b 2022 7069 7020 696e 7374 616c 6c20   + "pip install 
+0000b580: 6b6c 6179 6f75 7422 0a20 2020 2020 2020  klayout".       
+0000b590: 2029 0a20 2020 206b 6c5f 7265 6769 6f6e   ).    kl_region
+0000b5a0: 203d 206b 6462 2e52 6567 696f 6e28 290a   = kdb.Region().
+0000b5b0: 2020 2020 6966 2074 7970 6528 656c 656d      if type(elem
+0000b5c0: 656e 7473 2920 6e6f 7420 696e 2028 6c69  ents) not in (li
+0000b5d0: 7374 2c20 7475 706c 6529 3a0a 2020 2020  st, tuple):.    
+0000b5e0: 2020 2020 656c 656d 656e 7473 203d 205b      elements = [
+0000b5f0: 656c 656d 656e 7473 5d0a 2020 2020 706f  elements].    po
+0000b600: 6c79 676f 6e73 203d 205b 5d0a 2020 2020  lygons = [].    
+0000b610: 666f 7220 6520 696e 2065 6c65 6d65 6e74  for e in element
+0000b620: 733a 0a20 2020 2020 2020 2069 6620 6973  s:.        if is
+0000b630: 696e 7374 616e 6365 2865 2c20 4465 7669  instance(e, Devi
+0000b640: 6365 2920 6f72 2069 7369 6e73 7461 6e63  ce) or isinstanc
+0000b650: 6528 652c 2044 6576 6963 6552 6566 6572  e(e, DeviceRefer
+0000b660: 656e 6365 293a 0a20 2020 2020 2020 2020  ence):.         
+0000b670: 2020 2070 6f6c 7967 6f6e 732e 6578 7465     polygons.exte
+0000b680: 6e64 2865 2e67 6574 5f70 6f6c 7967 6f6e  nd(e.get_polygon
+0000b690: 7328 6279 5f73 7065 633d 4661 6c73 6529  s(by_spec=False)
+0000b6a0: 290a 2020 2020 2020 2020 656c 6966 2069  ).        elif i
+0000b6b0: 7369 6e73 7461 6e63 6528 652c 2050 6f6c  sinstance(e, Pol
+0000b6c0: 7967 6f6e 293a 0a20 2020 2020 2020 2020  ygon):.         
+0000b6d0: 2020 2070 6f6c 7967 6f6e 732e 6578 7465     polygons.exte
+0000b6e0: 6e64 285b 652e 706f 696e 7473 5d29 0a20  nd([e.points]). 
+0000b6f0: 2020 2070 6f6c 7967 6f6e 7320 3d20 5f6d     polygons = _m
+0000b700: 6572 6765 5f66 6c6f 6174 696e 675f 706f  erge_floating_po
+0000b710: 696e 745f 6572 726f 7273 2870 6f6c 7967  int_errors(polyg
+0000b720: 6f6e 732c 2074 6f6c 3d31 652d 3130 290a  ons, tol=1e-10).
+0000b730: 2020 2020 666f 7220 706f 696e 7473 2069      for points i
+0000b740: 6e20 706f 6c79 676f 6e73 3a0a 2020 2020  n polygons:.    
+0000b750: 2020 2020 7020 3d20 6b64 622e 5369 6d70      p = kdb.Simp
+0000b760: 6c65 506f 6c79 676f 6e28 0a20 2020 2020  lePolygon(.     
+0000b770: 2020 2020 2020 205b 6b64 622e 506f 696e         [kdb.Poin
+0000b780: 7428 7820 2f20 7072 6563 6973 696f 6e2c  t(x / precision,
+0000b790: 2079 202f 2070 7265 6369 7369 6f6e 2920   y / precision) 
+0000b7a0: 666f 7220 782c 2079 2069 6e20 706f 696e  for x, y in poin
+0000b7b0: 7473 5d0a 2020 2020 2020 2020 2920 2023  ts].        )  #
+0000b7c0: 2078 2061 6e64 2079 206d 7573 7420 6265   x and y must be
+0000b7d0: 2066 6c6f 6174 730a 2020 2020 2020 2020   floats.        
+0000b7e0: 6b6c 5f72 6567 696f 6e2e 696e 7365 7274  kl_region.insert
+0000b7f0: 2870 290a 2020 2020 7265 7475 726e 206b  (p).    return k
+0000b800: 6c5f 7265 6769 6f6e 0a0a 0a64 6566 205f  l_region...def _
+0000b810: 6b6c 5f72 6567 696f 6e5f 746f 5f64 6576  kl_region_to_dev
+0000b820: 6963 6528 6b6c 5f72 6567 696f 6e2c 206c  ice(kl_region, l
+0000b830: 6179 6572 2c20 6e61 6d65 2c20 7072 6563  ayer, name, prec
+0000b840: 6973 696f 6e29 3a0a 2020 2020 4420 3d20  ision):.    D = 
+0000b850: 4465 7669 6365 286e 616d 6529 0a20 2020  Device(name).   
+0000b860: 2066 6f72 2070 6f6c 7967 6f6e 2069 6e20   for polygon in 
+0000b870: 6b6c 5f72 6567 696f 6e2e 6561 6368 2829  kl_region.each()
+0000b880: 3a0a 2020 2020 2020 2020 706f 6c79 676f  :.        polygo
+0000b890: 6e20 3d20 706f 6c79 676f 6e2e 746f 5f73  n = polygon.to_s
+0000b8a0: 696d 706c 655f 706f 6c79 676f 6e28 290a  imple_polygon().
+0000b8b0: 2020 2020 2020 2020 706f 696e 7473 203d          points =
+0000b8c0: 205f 6b6c 5f70 6f6c 7967 6f6e 5f74 6f5f   _kl_polygon_to_
+0000b8d0: 6172 7261 7928 706f 6c79 676f 6e29 0a20  array(polygon). 
+0000b8e0: 2020 2020 2020 2070 6f69 6e74 7320 3d20         points = 
+0000b8f0: 6e70 2e61 7366 6172 7261 7928 706f 696e  np.asfarray(poin
+0000b900: 7473 2920 2a20 7072 6563 6973 696f 6e0a  ts) * precision.
+0000b910: 2020 2020 2020 2020 442e 6164 645f 706f          D.add_po
+0000b920: 6c79 676f 6e28 706f 696e 7473 2c20 6c61  lygon(points, la
+0000b930: 7965 723d 6c61 7965 7229 0a20 2020 2072  yer=layer).    r
+0000b940: 6574 7572 6e20 440a 0a0a 2320 3d3d 3d3d  eturn D...# ====
+0000b950: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000b960: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000b970: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000b980: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000b990: 3d3d 3d3d 3d3d 3d3d 3d3d 0a23 0a23 204b  ==========.#.# K
+0000b9a0: 4c61 796f 7574 2062 6f6f 6c65 616e 2066  Layout boolean f
+0000b9b0: 756e 6374 696f 6e73 0a23 0a23 203d 3d3d  unctions.#.# ===
+0000b9c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000b9d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000b9e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000b9f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000ba00: 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 0a0a 6465  ===========...de
+0000ba10: 6620 5f6b 6c5f 6578 7072 6573 7369 6f6e  f _kl_expression
+0000ba20: 280a 2020 2020 656c 656d 656e 745f 6469  (.    element_di
+0000ba30: 6374 2c20 2023 2065 2e67 2e20 6469 6374  ct,  # e.g. dict
+0000ba40: 2841 203d 2073 6e73 7064 2829 2c20 4220  (A = snspd(), B 
+0000ba50: 3d20 7067 2e65 6c6c 6970 7365 2829 290a  = pg.ellipse()).
+0000ba60: 2020 2020 6578 7072 6573 7369 6f6e 2c20      expression, 
+0000ba70: 2023 2065 2e67 2e20 2741 2e73 697a 6564   # e.g. 'A.sized
+0000ba80: 282d 3530 302c 2032 2920 2d20 4227 2c0a  (-500, 2) - B',.
+0000ba90: 2020 2020 7072 6563 6973 696f 6e3d 3165      precision=1e
+0000baa0: 2d34 2c0a 2020 2020 7469 6c65 5f73 697a  -4,.    tile_siz
+0000bab0: 653d 2831 3030 302c 2031 3030 3029 2c0a  e=(1000, 1000),.
+0000bac0: 2020 2020 6d65 7267 655f 6669 7273 743d      merge_first=
+0000bad0: 5472 7565 2c0a 2020 2020 6d65 7267 655f  True,.    merge_
+0000bae0: 6166 7465 723d 5472 7565 2c0a 2020 2020  after=True,.    
+0000baf0: 6f75 7470 7574 5f6e 616d 653d 2275 6e6e  output_name="unn
+0000bb00: 616d 6564 222c 0a20 2020 206e 756d 5f63  amed",.    num_c
+0000bb10: 7075 3d4e 554d 5f43 5055 2c0a 2020 2020  pu=NUM_CPU,.    
+0000bb20: 6c61 7965 723d 302c 0a29 3a0a 2020 2020  layer=0,.):.    
+0000bb30: 6c61 7965 7220 3d20 5f70 6172 7365 5f6c  layer = _parse_l
+0000bb40: 6179 6572 286c 6179 6572 290a 2020 2020  ayer(layer).    
+0000bb50: 6b6c 5f72 6567 696f 6e5f 6469 6374 203d  kl_region_dict =
+0000bb60: 207b 0a20 2020 2020 2020 206b 3a20 5f6f   {.        k: _o
+0000bb70: 626a 6563 7473 5f74 6f5f 6b6c 5f72 6567  bjects_to_kl_reg
+0000bb80: 696f 6e28 762c 2070 7265 6369 7369 6f6e  ion(v, precision
+0000bb90: 3d70 7265 6369 7369 6f6e 290a 2020 2020  =precision).    
+0000bba0: 2020 2020 666f 7220 6b2c 2076 2069 6e20      for k, v in 
+0000bbb0: 656c 656d 656e 745f 6469 6374 2e69 7465  element_dict.ite
+0000bbc0: 6d73 2829 0a20 2020 207d 0a20 2020 2066  ms().    }.    f
+0000bbd0: 6f72 206b 6c5f 7265 6769 6f6e 2069 6e20  or kl_region in 
+0000bbe0: 6b6c 5f72 6567 696f 6e5f 6469 6374 2e76  kl_region_dict.v
+0000bbf0: 616c 7565 7328 293a 0a20 2020 2020 2020  alues():.       
+0000bc00: 206b 6c5f 7265 6769 6f6e 2e6d 6572 6765   kl_region.merge
+0000bc10: 645f 7365 6d61 6e74 6963 7320 3d20 6d65  d_semantics = me
+0000bc20: 7267 655f 6669 7273 740a 0a20 2020 2069  rge_first..    i
+0000bc30: 6d70 6f72 7420 6b6c 6179 6f75 742e 6462  mport klayout.db
+0000bc40: 2061 7320 6b64 620a 0a20 2020 2074 7020   as kdb..    tp 
+0000bc50: 3d20 6b64 622e 5469 6c69 6e67 5072 6f63  = kdb.TilingProc
+0000bc60: 6573 736f 7228 290a 2020 2020 7470 2e74  essor().    tp.t
+0000bc70: 6872 6561 6473 203d 206e 756d 5f63 7075  hreads = num_cpu
+0000bc80: 0a20 2020 2074 702e 7469 6c65 5f73 697a  .    tp.tile_siz
+0000bc90: 6528 7469 6c65 5f73 697a 655b 305d 202a  e(tile_size[0] *
+0000bca0: 2074 702e 6462 7520 2f20 7072 6563 6973   tp.dbu / precis
+0000bcb0: 696f 6e2c 2074 696c 655f 7369 7a65 5b30  ion, tile_size[0
+0000bcc0: 5d20 2a20 7470 2e64 6275 202f 2070 7265  ] * tp.dbu / pre
+0000bcd0: 6369 7369 6f6e 290a 2020 2020 666f 7220  cision).    for 
+0000bce0: 6e61 6d65 2c20 6b6c 5f72 6567 696f 6e20  name, kl_region 
+0000bcf0: 696e 206b 6c5f 7265 6769 6f6e 5f64 6963  in kl_region_dic
+0000bd00: 742e 6974 656d 7328 293a 0a20 2020 2020  t.items():.     
+0000bd10: 2020 2074 702e 696e 7075 7428 6e61 6d65     tp.input(name
+0000bd20: 2c20 6b6c 5f72 6567 696f 6e29 0a20 2020  , kl_region).   
+0000bd30: 206f 7574 7075 745f 7265 6769 6f6e 203d   output_region =
+0000bd40: 206b 6462 2e52 6567 696f 6e28 290a 2020   kdb.Region().  
+0000bd50: 2020 7470 2e6f 7574 7075 7428 226f 7574    tp.output("out
+0000bd60: 222c 206f 7574 7075 745f 7265 6769 6f6e  ", output_region
+0000bd70: 290a 2020 2020 7470 2e71 7565 7565 2866  ).    tp.queue(f
+0000bd80: 225f 6f75 7470 7574 286f 7574 2c20 7b65  "_output(out, {e
+0000bd90: 7870 7265 7373 696f 6e7d 2922 290a 2020  xpression})").  
+0000bda0: 2020 7470 2e65 7865 6375 7465 2822 7469    tp.execute("ti
+0000bdb0: 6c65 6420 6f70 6572 6174 696f 6e22 290a  led operation").
+0000bdc0: 0a20 2020 2069 6620 6d65 7267 655f 6166  .    if merge_af
+0000bdd0: 7465 7220 6973 2054 7275 653a 0a20 2020  ter is True:.   
+0000bde0: 2020 2020 206f 7574 7075 745f 7265 6769       output_regi
+0000bdf0: 6f6e 2e6d 6572 6765 2829 0a0a 2020 2020  on.merge()..    
+0000be00: 2320 4372 6561 7465 2074 6865 2044 6576  # Create the Dev
+0000be10: 6963 6520 616e 6420 6164 6420 7468 6520  ice and add the 
+0000be20: 7265 7375 6c74 696e 6720 6f66 6673 6574  resulting offset
+0000be30: 2072 6567 696f 6e20 746f 2069 740a 2020   region to it.  
+0000be40: 2020 4420 3d20 5f6b 6c5f 7265 6769 6f6e    D = _kl_region
+0000be50: 5f74 6f5f 6465 7669 6365 280a 2020 2020  _to_device(.    
+0000be60: 2020 2020 6f75 7470 7574 5f72 6567 696f      output_regio
+0000be70: 6e2c 206c 6179 6572 3d6c 6179 6572 2c20  n, layer=layer, 
+0000be80: 6e61 6d65 3d6f 7574 7075 745f 6e61 6d65  name=output_name
+0000be90: 2c20 7072 6563 6973 696f 6e3d 7072 6563  , precision=prec
+0000bea0: 6973 696f 6e0a 2020 2020 290a 0a20 2020  ision.    )..   
+0000beb0: 2023 2044 656c 6574 6520 7468 6520 7265   # Delete the re
+0000bec0: 6769 6f6e 7320 736f 2074 6865 7920 646f  gions so they do
+0000bed0: 6e27 7420 6861 6e67 2061 726f 756e 6420  n't hang around 
+0000bee0: 696e 206d 656d 6f72 790a 2020 2020 666f  in memory.    fo
+0000bef0: 7220 6b6c 5f72 6567 696f 6e20 696e 206b  r kl_region in k
+0000bf00: 6c5f 7265 6769 6f6e 5f64 6963 742e 7661  l_region_dict.va
+0000bf10: 6c75 6573 2829 3a0a 2020 2020 2020 2020  lues():.        
+0000bf20: 6b6c 5f72 6567 696f 6e2e 636c 6561 7228  kl_region.clear(
+0000bf30: 290a 2020 2020 2020 2020 6b6c 5f72 6567  ).        kl_reg
+0000bf40: 696f 6e2e 5f64 6573 7472 6f79 2829 0a0a  ion._destroy()..
+0000bf50: 2020 2020 7265 7475 726e 2044 0a0a 0a64      return D...d
+0000bf60: 6566 206b 6c5f 6f66 6673 6574 280a 2020  ef kl_offset(.  
+0000bf70: 2020 656c 656d 656e 7473 2c0a 2020 2020    elements,.    
+0000bf80: 6469 7374 616e 6365 3d30 2e31 2c0a 2020  distance=0.1,.  
+0000bf90: 2020 7072 6563 6973 696f 6e3d 3165 2d34    precision=1e-4
+0000bfa0: 2c0a 2020 2020 6d69 7465 725f 6d6f 6465  ,.    miter_mode
+0000bfb0: 3d32 2c0a 2020 2020 7469 6c65 5f73 697a  =2,.    tile_siz
+0000bfc0: 653d 2831 3030 302c 2031 3030 3029 2c0a  e=(1000, 1000),.
+0000bfd0: 2020 2020 6d65 7267 655f 6166 7465 723d      merge_after=
+0000bfe0: 5472 7565 2c0a 2020 2020 6c61 7965 723d  True,.    layer=
+0000bff0: 302c 0a29 3a0a 2020 2020 2222 2253 6872  0,.):.    """Shr
+0000c000: 696e 6b73 206f 7220 6578 7061 6e64 7320  inks or expands 
+0000c010: 6120 706f 6c79 676f 6e20 6f72 2073 6574  a polygon or set
+0000c020: 206f 6620 706f 6c79 676f 6e73 2075 7369   of polygons usi
+0000c030: 6e67 204b 4c61 796f 7574 0a0a 2020 2020  ng KLayout..    
+0000c040: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+0000c050: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 656c  ---------.    el
+0000c060: 656d 656e 7473 203a 2044 6576 6963 6528  ements : Device(
+0000c070: 2f52 6566 6572 656e 6365 292c 206c 6973  /Reference), lis
+0000c080: 7420 6f66 2044 6576 6963 6528 2f52 6566  t of Device(/Ref
+0000c090: 6572 656e 6365 292c 206f 7220 506f 6c79  erence), or Poly
+0000c0a0: 676f 6e0a 2020 2020 2020 2020 506f 6c79  gon.        Poly
+0000c0b0: 676f 6e73 2074 6f20 6f66 6673 6574 206f  gons to offset o
+0000c0c0: 7220 4465 7669 6365 2063 6f6e 7461 696e  r Device contain
+0000c0d0: 696e 6720 706f 6c79 676f 6e73 2074 6f20  ing polygons to 
+0000c0e0: 6f66 6673 6574 2e0a 2020 2020 6469 7374  offset..    dist
+0000c0f0: 616e 6365 203a 2069 6e74 206f 7220 666c  ance : int or fl
+0000c100: 6f61 740a 2020 2020 2020 2020 4469 7374  oat.        Dist
+0000c110: 616e 6365 2074 6f20 6f66 6673 6574 2070  ance to offset p
+0000c120: 6f6c 7967 6f6e 732e 2050 6f73 6974 6976  olygons. Positiv
+0000c130: 6520 7661 6c75 6573 2065 7870 616e 642c  e values expand,
+0000c140: 206e 6567 6174 6976 6520 7368 7269 6e6b   negative shrink
+0000c150: 2e0a 2020 2020 7072 6563 6973 696f 6e20  ..    precision 
+0000c160: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
+0000c170: 4465 7369 7265 6420 7072 6563 6973 696f  Desired precisio
+0000c180: 6e20 666f 7220 726f 756e 6469 6e67 2076  n for rounding v
+0000c190: 6572 7465 7820 636f 6f72 6469 6e61 7465  ertex coordinate
+0000c1a0: 732e 0a20 2020 206d 6974 6572 5f6d 6f64  s..    miter_mod
+0000c1b0: 6520 3a20 696e 740a 2020 2020 2020 2020  e : int.        
+0000c1c0: 5479 7065 206f 6620 636f 726e 6572 7320  Type of corners 
+0000c1d0: 6765 6e65 7261 7465 6420 6475 7269 6e67  generated during
+0000c1e0: 2074 6865 206f 6666 7365 7420 6f70 6572   the offset oper
+0000c1f0: 6174 696f 6e2c 2073 6565 0a20 2020 2020  ation, see.     
+0000c200: 2020 2068 7474 7073 3a2f 2f77 7777 2e6b     https://www.k
+0000c210: 6c61 796f 7574 2e64 652f 646f 632f 636f  layout.de/doc/co
+0000c220: 6465 2f63 6c61 7373 5f45 6467 6550 726f  de/class_EdgePro
+0000c230: 6365 7373 6f72 2e68 746d 6c23 6d65 7468  cessor.html#meth
+0000c240: 6f64 3535 0a20 2020 2074 696c 655f 7369  od55.    tile_si
+0000c250: 7a65 203a 2061 7272 6179 2d6c 696b 655b  ze : array-like[
+0000c260: 325d 0a20 2020 2020 2020 2054 6865 2074  2].        The t
+0000c270: 696c 6520 7369 7a65 2077 6974 6820 7768  ile size with wh
+0000c280: 6963 6820 7468 6520 6765 6f6d 6574 7279  ich the geometry
+0000c290: 2069 7320 6469 7669 6465 642e 2054 6869   is divided. Thi
+0000c2a0: 7320 616c 6c6f 7773 2066 6f72 2065 6163  s allows for eac
+0000c2b0: 680a 2020 2020 2020 2020 7265 6769 6f6e  h.        region
+0000c2c0: 2074 6f20 6265 7072 6f63 6573 7365 6420   to beprocessed 
+0000c2d0: 7365 7175 656e 7469 616c 6c79 2c20 7768  sequentially, wh
+0000c2e0: 6963 6820 6973 206d 6f72 6520 636f 6d70  ich is more comp
+0000c2f0: 7574 6174 696f 6e61 6c6c 790a 2020 2020  utationally.    
+0000c300: 2020 2020 6566 6669 6369 656e 7420 2861      efficient (a
+0000c310: 6e64 2063 616e 2062 6520 7275 6e20 696e  nd can be run in
+0000c320: 2070 6172 616c 6c65 6c20 6f6e 206d 756c   parallel on mul
+0000c330: 7469 706c 6520 4350 5520 636f 7265 7329  tiple CPU cores)
+0000c340: 2e0a 2020 2020 6d65 7267 655f 6166 7465  ..    merge_afte
+0000c350: 723a 2062 6f6f 6c0a 2020 2020 2020 2020  r: bool.        
+0000c360: 4d65 7267 6520 616c 6c20 7468 6520 706f  Merge all the po
+0000c370: 6c79 676f 6e73 2061 6674 6572 2070 6572  lygons after per
+0000c380: 666f 726d 696e 6720 7468 6520 6f66 6673  forming the offs
+0000c390: 6574 206f 7065 7261 7469 6f6e 0a20 2020  et operation.   
+0000c3a0: 206c 6179 6572 203a 2069 6e74 2c20 6172   layer : int, ar
+0000c3b0: 7261 792d 6c69 6b65 5b32 5d2c 206f 7220  ray-like[2], or 
+0000c3c0: 7365 740a 2020 2020 2020 2020 5370 6563  set.        Spec
+0000c3d0: 6966 6963 206c 6179 6572 2873 2920 746f  ific layer(s) to
+0000c3e0: 2070 7574 2070 6f6c 7967 6f6e 2067 656f   put polygon geo
+0000c3f0: 6d65 7472 7920 6f6e 2e0a 0a20 2020 2052  metry on...    R
+0000c400: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
+0000c410: 2d2d 0a20 2020 2044 203a 2044 6576 6963  --.    D : Devic
+0000c420: 650a 2020 2020 2020 2020 4120 4465 7669  e.        A Devi
+0000c430: 6365 2063 6f6e 7461 696e 696e 6720 6120  ce containing a 
+0000c440: 706f 6c79 676f 6e28 7329 2077 6974 6820  polygon(s) with 
+0000c450: 7468 6520 7370 6563 6966 6965 6420 6f66  the specified of
+0000c460: 6673 6574 2061 7070 6c69 6564 2e0a 2020  fset applied..  
+0000c470: 2020 2222 220a 0a20 2020 2064 203d 2072    """..    d = r
+0000c480: 6f75 6e64 2864 6973 7461 6e63 6520 2f20  ound(distance / 
+0000c490: 7072 6563 6973 696f 6e29 2020 2320 5468  precision)  # Th
+0000c4a0: 6520 6469 7374 616e 6365 2069 6e20 6461  e distance in da
+0000c4b0: 7461 6261 7365 2075 6e69 7473 0a20 2020  tabase units.   
+0000c4c0: 2044 203d 205f 6b6c 5f65 7870 7265 7373   D = _kl_express
+0000c4d0: 696f 6e28 0a20 2020 2020 2020 2065 6c65  ion(.        ele
+0000c4e0: 6d65 6e74 5f64 6963 743d 6469 6374 2841  ment_dict=dict(A
+0000c4f0: 3d65 6c65 6d65 6e74 7329 2c0a 2020 2020  =elements),.    
+0000c500: 2020 2020 6578 7072 6573 7369 6f6e 3d66      expression=f
+0000c510: 2241 2e73 697a 6564 287b 647d 2c20 7b6d  "A.sized({d}, {m
+0000c520: 6974 6572 5f6d 6f64 657d 2922 2c0a 2020  iter_mode})",.  
+0000c530: 2020 2020 2020 7072 6563 6973 696f 6e3d        precision=
+0000c540: 7072 6563 6973 696f 6e2c 0a20 2020 2020  precision,.     
+0000c550: 2020 2074 696c 655f 7369 7a65 3d74 696c     tile_size=til
+0000c560: 655f 7369 7a65 2c0a 2020 2020 2020 2020  e_size,.        
+0000c570: 6d65 7267 655f 6669 7273 743d 5472 7565  merge_first=True
+0000c580: 2c0a 2020 2020 2020 2020 6d65 7267 655f  ,.        merge_
+0000c590: 6166 7465 723d 6d65 7267 655f 6166 7465  after=merge_afte
+0000c5a0: 722c 0a20 2020 2020 2020 206f 7574 7075  r,.        outpu
+0000c5b0: 745f 6e61 6d65 3d22 6f66 6673 6574 222c  t_name="offset",
+0000c5c0: 0a20 2020 2020 2020 206e 756d 5f63 7075  .        num_cpu
+0000c5d0: 3d4e 554d 5f43 5055 2c0a 2020 2020 2020  =NUM_CPU,.      
+0000c5e0: 2020 6c61 7965 723d 6c61 7965 722c 0a20    layer=layer,. 
+0000c5f0: 2020 2029 0a0a 2020 2020 7265 7475 726e     )..    return
+0000c600: 2044 0a0a 0a64 6566 206b 6c5f 626f 6f6c   D...def kl_bool
+0000c610: 6561 6e28 0a20 2020 2041 2c0a 2020 2020  ean(.    A,.    
+0000c620: 422c 0a20 2020 206f 7065 7261 7469 6f6e  B,.    operation
+0000c630: 2c0a 2020 2020 7072 6563 6973 696f 6e3d  ,.    precision=
+0000c640: 3165 2d34 2c0a 2020 2020 7469 6c65 5f73  1e-4,.    tile_s
+0000c650: 697a 653d 2831 3030 302c 2031 3030 3029  ize=(1000, 1000)
+0000c660: 2c0a 2020 2020 6d65 7267 655f 6166 7465  ,.    merge_afte
+0000c670: 723d 5472 7565 2c0a 2020 2020 6c61 7965  r=True,.    laye
+0000c680: 723d 302c 0a29 3a0a 2020 2020 2222 220a  r=0,.):.    """.
+0000c690: 2020 2020 5065 7266 6f72 6d73 2062 6f6f      Performs boo
+0000c6a0: 6c65 616e 206f 7065 7261 7469 6f6e 7320  lean operations 
+0000c6b0: 6265 7477 6565 6e20 3220 4465 7669 6365  between 2 Device
+0000c6c0: 2f44 6576 6963 6552 6566 6572 656e 6365  /DeviceReference
+0000c6d0: 206f 626a 6563 7473 2c0a 2020 2020 6f72   objects,.    or
+0000c6e0: 206c 6973 7473 206f 6620 4465 7669 6365   lists of Device
+0000c6f0: 732f 4465 7669 6365 5265 6665 7265 6e63  s/DeviceReferenc
+0000c700: 6573 2e0a 0a20 2020 2060 606f 7065 7261  es...    ``opera
+0000c710: 7469 6f6e 6060 2073 686f 756c 6420 6265  tion`` should be
+0000c720: 206f 6e65 206f 6620 7b27 6e6f 7427 2c20   one of {'not', 
+0000c730: 2761 6e64 272c 2027 6f72 272c 2027 786f  'and', 'or', 'xo
+0000c740: 7227 2c20 2741 2d42 272c 2027 422d 4127  r', 'A-B', 'B-A'
+0000c750: 2c20 2741 2b42 277d 2e0a 2020 2020 4e6f  , 'A+B'}..    No
+0000c760: 7465 2074 6861 7420 2741 2b42 2720 6973  te that 'A+B' is
+0000c770: 2065 7175 6976 616c 656e 7420 746f 2027   equivalent to '
+0000c780: 6f72 272c 2027 412d 4227 2069 7320 6571  or', 'A-B' is eq
+0000c790: 7569 7661 6c65 6e74 2074 6f20 276e 6f74  uivalent to 'not
+0000c7a0: 272c 2061 6e64 0a20 2020 2027 422d 4127  ', and.    'B-A'
+0000c7b0: 2069 7320 6571 7569 7661 6c65 6e74 2074   is equivalent t
+0000c7c0: 6f20 276e 6f74 2720 7769 7468 2074 6865  o 'not' with the
+0000c7d0: 206f 7065 7261 6e64 7320 7377 6974 6368   operands switch
+0000c7e0: 6564 0a0a 2020 2020 5061 7261 6d65 7465  ed..    Paramete
+0000c7f0: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+0000c800: 2d0a 2020 2020 4120 3a20 4465 7669 6365  -.    A : Device
+0000c810: 282f 5265 6665 7265 6e63 6529 206f 7220  (/Reference) or 
+0000c820: 6c69 7374 206f 6620 4465 7669 6365 282f  list of Device(/
+0000c830: 5265 6665 7265 6e63 6529 206f 7220 506f  Reference) or Po
+0000c840: 6c79 676f 6e0a 2020 2020 2020 2020 496e  lygon.        In
+0000c850: 7075 7420 4465 7669 6365 732e 0a20 2020  put Devices..   
+0000c860: 2042 203a 2044 6576 6963 6528 2f52 6566   B : Device(/Ref
+0000c870: 6572 656e 6365 2920 6f72 206c 6973 7420  erence) or list 
+0000c880: 6f66 2044 6576 6963 6528 2f52 6566 6572  of Device(/Refer
+0000c890: 656e 6365 2920 6f72 2050 6f6c 7967 6f6e  ence) or Polygon
+0000c8a0: 0a20 2020 2020 2020 2049 6e70 7574 2044  .        Input D
+0000c8b0: 6576 6963 6573 2e0a 2020 2020 6f70 6572  evices..    oper
+0000c8c0: 6174 696f 6e20 3a20 7b27 6e6f 7427 2c20  ation : {'not', 
+0000c8d0: 2761 6e64 272c 2027 6f72 272c 2027 786f  'and', 'or', 'xo
+0000c8e0: 7227 2c20 2741 2d42 272c 2027 422d 4127  r', 'A-B', 'B-A'
+0000c8f0: 2c20 2741 2b42 277d 0a20 2020 2020 2020  , 'A+B'}.       
+0000c900: 2042 6f6f 6c65 616e 206f 7065 7261 7469   Boolean operati
+0000c910: 6f6e 2074 6f20 7065 7266 6f72 6d2e 0a20  on to perform.. 
+0000c920: 2020 2070 7265 6369 7369 6f6e 203a 2066     precision : f
+0000c930: 6c6f 6174 0a20 2020 2020 2020 2044 6573  loat.        Des
+0000c940: 6972 6564 2070 7265 6369 7369 6f6e 2066  ired precision f
+0000c950: 6f72 2072 6f75 6e64 696e 6720 7665 7274  or rounding vert
+0000c960: 6578 2063 6f6f 7264 696e 6174 6573 2e0a  ex coordinates..
+0000c970: 2020 2020 7469 6c65 5f73 697a 6520 3a20      tile_size : 
+0000c980: 6172 7261 792d 6c69 6b65 5b32 5d0a 2020  array-like[2].  
+0000c990: 2020 2020 2020 5468 6520 7469 6c65 2073        The tile s
+0000c9a0: 697a 6520 7769 7468 2077 6869 6368 2074  ize with which t
+0000c9b0: 6865 2067 656f 6d65 7472 7920 6973 2064  he geometry is d
+0000c9c0: 6976 6964 6564 2e20 5468 6973 2061 6c6c  ivided. This all
+0000c9d0: 6f77 7320 666f 7220 6561 6368 0a20 2020  ows for each.   
+0000c9e0: 2020 2020 2072 6567 696f 6e20 746f 2062       region to b
+0000c9f0: 6570 726f 6365 7373 6564 2073 6571 7565  eprocessed seque
+0000ca00: 6e74 6961 6c6c 792c 2077 6869 6368 2069  ntially, which i
+0000ca10: 7320 6d6f 7265 2063 6f6d 7075 7461 7469  s more computati
+0000ca20: 6f6e 616c 6c79 0a20 2020 2020 2020 2065  onally.        e
+0000ca30: 6666 6963 6965 6e74 2028 616e 6420 6361  fficient (and ca
+0000ca40: 6e20 6265 2072 756e 2069 6e20 7061 7261  n be run in para
+0000ca50: 6c6c 656c 206f 6e20 6d75 6c74 6970 6c65  llel on multiple
+0000ca60: 2043 5055 2063 6f72 6573 292e 0a20 2020   CPU cores)..   
+0000ca70: 206d 6572 6765 5f61 6674 6572 3a20 626f   merge_after: bo
+0000ca80: 6f6c 0a20 2020 2020 2020 204d 6572 6765  ol.        Merge
+0000ca90: 2061 6c6c 2074 6865 2070 6f6c 7967 6f6e   all the polygon
+0000caa0: 7320 6166 7465 7220 7065 7266 6f72 6d69  s after performi
+0000cab0: 6e67 2074 6865 2074 696c 6564 2062 6f6f  ng the tiled boo
+0000cac0: 6c65 616e 206f 7065 7261 7469 6f6e 0a20  lean operation. 
+0000cad0: 2020 206c 6179 6572 203a 2069 6e74 2c20     layer : int, 
+0000cae0: 6172 7261 792d 6c69 6b65 5b32 5d2c 206f  array-like[2], o
+0000caf0: 7220 7365 740a 2020 2020 2020 2020 5370  r set.        Sp
+0000cb00: 6563 6966 6963 206c 6179 6572 2873 2920  ecific layer(s) 
+0000cb10: 746f 2070 7574 2070 6f6c 7967 6f6e 2067  to put polygon g
+0000cb20: 656f 6d65 7472 7920 6f6e 2e0a 0a20 2020  eometry on...   
+0000cb30: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
+0000cb40: 2d2d 2d2d 0a20 2020 2044 203a 2044 6576  ----.    D : Dev
+0000cb50: 6963 650a 2020 2020 2020 2020 4120 4465  ice.        A De
+0000cb60: 7669 6365 2063 6f6e 7461 696e 696e 6720  vice containing 
+0000cb70: 6120 706f 6c79 676f 6e28 7329 2077 6974  a polygon(s) wit
+0000cb80: 6820 7468 6520 626f 6f6c 6561 6e20 6f70  h the boolean op
+0000cb90: 6572 6174 696f 6e20 6170 706c 6965 642e  eration applied.
+0000cba0: 0a20 2020 2022 2222 0a0a 2020 2020 6f70  .    """..    op
+0000cbb0: 6572 6174 696f 6e20 3d20 6f70 6572 6174  eration = operat
+0000cbc0: 696f 6e2e 6c6f 7765 7228 292e 7265 706c  ion.lower().repl
+0000cbd0: 6163 6528 2220 222c 2022 2229 0a20 2020  ace(" ", "").   
+0000cbe0: 2069 6620 6f70 6572 6174 696f 6e20 696e   if operation in
+0000cbf0: 207b 2261 2d62 222c 2022 6e6f 7422 7d3a   {"a-b", "not"}:
+0000cc00: 0a20 2020 2020 2020 206f 7065 7261 7469  .        operati
+0000cc10: 6f6e 5f6b 6c20 3d20 222d 220a 2020 2020  on_kl = "-".    
+0000cc20: 656c 6966 206f 7065 7261 7469 6f6e 2069  elif operation i
+0000cc30: 6e20 7b22 622d 6122 7d3a 0a20 2020 2020  n {"b-a"}:.     
+0000cc40: 2020 206f 7065 7261 7469 6f6e 5f6b 6c20     operation_kl 
+0000cc50: 3d20 222d 220a 2020 2020 656c 6966 206f  = "-".    elif o
+0000cc60: 7065 7261 7469 6f6e 2069 6e20 7b22 612b  peration in {"a+
+0000cc70: 6222 2c20 226f 7222 7d3a 0a20 2020 2020  b", "or"}:.     
+0000cc80: 2020 206f 7065 7261 7469 6f6e 5f6b 6c20     operation_kl 
+0000cc90: 3d20 222b 220a 2020 2020 656c 6966 206f  = "+".    elif o
+0000cca0: 7065 7261 7469 6f6e 2069 6e20 7b22 615e  peration in {"a^
+0000ccb0: 6222 2c20 2278 6f72 227d 3a0a 2020 2020  b", "xor"}:.    
+0000ccc0: 2020 2020 6f70 6572 6174 696f 6e5f 6b6c      operation_kl
+0000ccd0: 203d 2022 5e22 0a20 2020 2065 6c69 6620   = "^".    elif 
+0000cce0: 6f70 6572 6174 696f 6e20 696e 207b 2261  operation in {"a
+0000ccf0: 2662 222c 2022 616e 6422 7d3a 0a20 2020  &b", "and"}:.   
+0000cd00: 2020 2020 206f 7065 7261 7469 6f6e 5f6b       operation_k
+0000cd10: 6c20 3d20 2226 220a 2020 2020 656c 7365  l = "&".    else
+0000cd20: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
+0000cd30: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+0000cd40: 2020 2020 2020 2020 225b 5048 4944 4c5d          "[PHIDL]
+0000cd50: 2070 6869 646c 2e67 656f 6d65 7472 792e   phidl.geometry.
+0000cd60: 626f 6f6c 6561 6e28 2920 606f 7065 7261  boolean() `opera
+0000cd70: 7469 6f6e 6020 7061 7261 6d65 7465 7222  tion` parameter"
+0000cd80: 0a20 2020 2020 2020 2020 2020 202b 2022  .            + "
+0000cd90: 206e 6f74 2072 6563 6f67 6e69 7a65 642c   not recognized,
+0000cda0: 206d 7573 7420 6265 206f 6e65 206f 6620   must be one of 
+0000cdb0: 7468 6520 666f 6c6c 6f77 696e 673a 2020  the following:  
+0000cdc0: 276e 6f74 272c 220a 2020 2020 2020 2020  'not',".        
+0000cdd0: 2020 2020 2b20 2220 2761 6e64 272c 2027      + " 'and', '
+0000cde0: 6f72 272c 2027 786f 7227 2c20 2741 2d42  or', 'xor', 'A-B
+0000cdf0: 272c 2027 422d 4127 2c20 2741 2b42 272c  ', 'B-A', 'A+B',
+0000ce00: 2020 2741 2642 272c 2027 415e 4227 220a    'A&B', 'A^B'".
+0000ce10: 2020 2020 2020 2020 290a 0a20 2020 2044          )..    D
+0000ce20: 203d 205f 6b6c 5f65 7870 7265 7373 696f   = _kl_expressio
+0000ce30: 6e28 0a20 2020 2020 2020 2065 6c65 6d65  n(.        eleme
+0000ce40: 6e74 5f64 6963 743d 6469 6374 2841 3d41  nt_dict=dict(A=A
+0000ce50: 2c20 423d 4229 2c0a 2020 2020 2020 2020  , B=B),.        
+0000ce60: 6578 7072 6573 7369 6f6e 3d66 2241 207b  expression=f"A {
+0000ce70: 6f70 6572 6174 696f 6e5f 6b6c 7d20 4222  operation_kl} B"
+0000ce80: 2c0a 2020 2020 2020 2020 7072 6563 6973  ,.        precis
+0000ce90: 696f 6e3d 7072 6563 6973 696f 6e2c 0a20  ion=precision,. 
+0000cea0: 2020 2020 2020 2074 696c 655f 7369 7a65         tile_size
+0000ceb0: 3d74 696c 655f 7369 7a65 2c0a 2020 2020  =tile_size,.    
+0000cec0: 2020 2020 6d65 7267 655f 6669 7273 743d      merge_first=
+0000ced0: 5472 7565 2c0a 2020 2020 2020 2020 6d65  True,.        me
+0000cee0: 7267 655f 6166 7465 723d 6d65 7267 655f  rge_after=merge_
+0000cef0: 6166 7465 722c 0a20 2020 2020 2020 206f  after,.        o
+0000cf00: 7574 7075 745f 6e61 6d65 3d22 626f 6f6c  utput_name="bool
+0000cf10: 6561 6e22 2c0a 2020 2020 2020 2020 6e75  ean",.        nu
+0000cf20: 6d5f 6370 753d 4e55 4d5f 4350 552c 0a20  m_cpu=NUM_CPU,. 
+0000cf30: 2020 2020 2020 206c 6179 6572 3d6c 6179         layer=lay
+0000cf40: 6572 2c0a 2020 2020 290a 0a20 2020 2072  er,.    )..    r
+0000cf50: 6574 7572 6e20 440a 0a0a 6465 6620 6b6c  eturn D...def kl
+0000cf60: 5f6f 7574 6c69 6e65 280a 2020 2020 656c  _outline(.    el
+0000cf70: 656d 656e 7473 2c0a 2020 2020 6469 7374  ements,.    dist
+0000cf80: 616e 6365 3d30 2e31 2c0a 2020 2020 6f70  ance=0.1,.    op
+0000cf90: 656e 5f70 6f72 7473 3d46 616c 7365 2c0a  en_ports=False,.
+0000cfa0: 2020 2020 7072 6563 6973 696f 6e3d 3165      precision=1e
+0000cfb0: 2d34 2c0a 2020 2020 6d69 7465 725f 6d6f  -4,.    miter_mo
+0000cfc0: 6465 3d32 2c0a 2020 2020 7469 6c65 5f73  de=2,.    tile_s
+0000cfd0: 697a 653d 2831 3030 302c 2031 3030 3029  ize=(1000, 1000)
+0000cfe0: 2c0a 2020 2020 6d65 7267 655f 6166 7465  ,.    merge_afte
+0000cff0: 723d 5472 7565 2c0a 2020 2020 6c61 7965  r=True,.    laye
+0000d000: 723d 302c 0a29 3a0a 2020 2020 2222 2253  r=0,.):.    """S
+0000d010: 6872 696e 6b73 206f 7220 6578 7061 6e64  hrinks or expand
+0000d020: 7320 6120 706f 6c79 676f 6e20 6f72 2073  s a polygon or s
+0000d030: 6574 206f 6620 706f 6c79 676f 6e73 2075  et of polygons u
+0000d040: 7369 6e67 204b 4c61 796f 7574 0a0a 2020  sing KLayout..  
+0000d050: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0000d060: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+0000d070: 656c 656d 656e 7473 203a 2044 6576 6963  elements : Devic
+0000d080: 6528 2f52 6566 6572 656e 6365 292c 206c  e(/Reference), l
+0000d090: 6973 7420 6f66 2044 6576 6963 6528 2f52  ist of Device(/R
+0000d0a0: 6566 6572 656e 6365 292c 206f 7220 506f  eference), or Po
+0000d0b0: 6c79 676f 6e0a 2020 2020 2020 2020 506f  lygon.        Po
+0000d0c0: 6c79 676f 6e73 2074 6f20 6f66 6673 6574  lygons to offset
+0000d0d0: 206f 7220 4465 7669 6365 2063 6f6e 7461   or Device conta
+0000d0e0: 696e 696e 6720 706f 6c79 676f 6e73 2074  ining polygons t
+0000d0f0: 6f20 6f66 6673 6574 2e0a 2020 2020 6469  o offset..    di
+0000d100: 7374 616e 6365 203a 2069 6e74 206f 7220  stance : int or 
+0000d110: 666c 6f61 740a 2020 2020 2020 2020 4469  float.        Di
+0000d120: 7374 616e 6365 2074 6f20 6f66 6673 6574  stance to offset
+0000d130: 2070 6f6c 7967 6f6e 732e 2050 6f73 6974   polygons. Posit
+0000d140: 6976 6520 7661 6c75 6573 2065 7870 616e  ive values expan
+0000d150: 642c 206e 6567 6174 6976 6520 7368 7269  d, negative shri
+0000d160: 6e6b 2e0a 2020 2020 6f70 656e 5f70 6f72  nk..    open_por
+0000d170: 7473 203a 2062 6f6f 6c20 6f72 2066 6c6f  ts : bool or flo
+0000d180: 6174 0a20 2020 2020 2020 2049 6620 6e6f  at.        If no
+0000d190: 7420 4661 6c73 652c 2068 6f6c 6573 2077  t False, holes w
+0000d1a0: 696c 6c20 6265 2063 7574 2069 6e20 7468  ill be cut in th
+0000d1b0: 6520 6f75 746c 696e 6520 7375 6368 2074  e outline such t
+0000d1c0: 6861 7420 7468 6520 506f 7274 7320 6172  hat the Ports ar
+0000d1d0: 650a 2020 2020 2020 2020 6e6f 7420 636f  e.        not co
+0000d1e0: 7665 7265 642e 2049 6620 5472 7565 2c20  vered. If True, 
+0000d1f0: 7468 6520 686f 6c65 7320 7769 6c6c 2068  the holes will h
+0000d200: 6176 6520 7468 6520 7361 6d65 2077 6964  ave the same wid
+0000d210: 7468 2061 7320 7468 6520 506f 7274 732e  th as the Ports.
+0000d220: 0a20 2020 2020 2020 2049 6620 6120 666c  .        If a fl
+0000d230: 6f61 742c 2074 6865 2068 6f6c 6573 2077  oat, the holes w
+0000d240: 696c 6c20 6265 2062 6520 7769 6465 6e65  ill be be widene
+0000d250: 6420 6279 2074 6861 7420 7661 6c75 6520  d by that value 
+0000d260: 2875 7365 6675 6c20 666f 7220 6675 6c6c  (useful for full
+0000d270: 790a 2020 2020 2020 2020 636c 6561 7269  y.        cleari
+0000d280: 6e67 2074 6865 206f 7574 6c69 6e65 2061  ng the outline a
+0000d290: 726f 756e 6420 7468 6520 506f 7274 7320  round the Ports 
+0000d2a0: 666f 7220 706f 7369 7469 7665 2d74 6f6e  for positive-ton
+0000d2b0: 6520 7072 6f63 6573 7365 730a 2020 2020  e processes.    
+0000d2c0: 7072 6563 6973 696f 6e20 3a20 666c 6f61  precision : floa
+0000d2d0: 740a 2020 2020 2020 2020 4465 7369 7265  t.        Desire
+0000d2e0: 6420 7072 6563 6973 696f 6e20 666f 7220  d precision for 
+0000d2f0: 726f 756e 6469 6e67 2076 6572 7465 7820  rounding vertex 
+0000d300: 636f 6f72 6469 6e61 7465 732e 0a20 2020  coordinates..   
+0000d310: 206d 6974 6572 5f6d 6f64 6520 3a20 696e   miter_mode : in
+0000d320: 740a 2020 2020 2020 2020 5479 7065 206f  t.        Type o
+0000d330: 6620 636f 726e 6572 7320 6765 6e65 7261  f corners genera
+0000d340: 7465 6420 6475 7269 6e67 2074 6865 206f  ted during the o
+0000d350: 6666 7365 7420 6f70 6572 6174 696f 6e2c  ffset operation,
+0000d360: 2073 6565 0a20 2020 2020 2020 2068 7474   see.        htt
+0000d370: 7073 3a2f 2f77 7777 2e6b 6c61 796f 7574  ps://www.klayout
+0000d380: 2e64 652f 646f 632f 636f 6465 2f63 6c61  .de/doc/code/cla
+0000d390: 7373 5f45 6467 6550 726f 6365 7373 6f72  ss_EdgeProcessor
+0000d3a0: 2e68 746d 6c23 6d65 7468 6f64 3535 0a20  .html#method55. 
+0000d3b0: 2020 2074 696c 655f 7369 7a65 203a 2061     tile_size : a
+0000d3c0: 7272 6179 2d6c 696b 655b 325d 0a20 2020  rray-like[2].   
+0000d3d0: 2020 2020 2054 6865 2074 696c 6520 7369       The tile si
+0000d3e0: 7a65 2077 6974 6820 7768 6963 6820 7468  ze with which th
+0000d3f0: 6520 6765 6f6d 6574 7279 2069 7320 6469  e geometry is di
+0000d400: 7669 6465 642e 2054 6869 7320 616c 6c6f  vided. This allo
+0000d410: 7773 2066 6f72 2065 6163 680a 2020 2020  ws for each.    
+0000d420: 2020 2020 7265 6769 6f6e 2074 6f20 6265      region to be
+0000d430: 7072 6f63 6573 7365 6420 7365 7175 656e  processed sequen
+0000d440: 7469 616c 6c79 2c20 7768 6963 6820 6973  tially, which is
+0000d450: 206d 6f72 6520 636f 6d70 7574 6174 696f   more computatio
+0000d460: 6e61 6c6c 790a 2020 2020 2020 2020 6566  nally.        ef
+0000d470: 6669 6369 656e 7420 2861 6e64 2063 616e  ficient (and can
+0000d480: 2062 6520 7275 6e20 696e 2070 6172 616c   be run in paral
+0000d490: 6c65 6c20 6f6e 206d 756c 7469 706c 6520  lel on multiple 
+0000d4a0: 4350 5520 636f 7265 7329 2e0a 2020 2020  CPU cores)..    
+0000d4b0: 6d65 7267 655f 6166 7465 723a 2062 6f6f  merge_after: boo
+0000d4c0: 6c0a 2020 2020 2020 2020 4d65 7267 6520  l.        Merge 
+0000d4d0: 616c 6c20 7468 6520 706f 6c79 676f 6e73  all the polygons
+0000d4e0: 2061 6674 6572 2070 6572 666f 726d 696e   after performin
+0000d4f0: 6720 7468 6520 6f75 746c 696e 6520 6f70  g the outline op
+0000d500: 6572 6174 696f 6e0a 2020 2020 6c61 7965  eration.    laye
+0000d510: 7220 3a20 696e 742c 2061 7272 6179 2d6c  r : int, array-l
+0000d520: 696b 655b 325d 2c20 6f72 2073 6574 0a20  ike[2], or set. 
+0000d530: 2020 2020 2020 2053 7065 6369 6669 6320         Specific 
+0000d540: 6c61 7965 7228 7329 2074 6f20 7075 7420  layer(s) to put 
+0000d550: 706f 6c79 676f 6e20 6765 6f6d 6574 7279  polygon geometry
+0000d560: 206f 6e2e 0a0a 2020 2020 5265 7475 726e   on...    Return
+0000d570: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
+0000d580: 2020 4420 3a20 4465 7669 6365 0a20 2020    D : Device.   
+0000d590: 2020 2020 2041 2044 6576 6963 6520 636f       A Device co
+0000d5a0: 6e74 6169 6e69 6e67 2061 2070 6f6c 7967  ntaining a polyg
+0000d5b0: 6f6e 2873 2920 7769 7468 2074 6865 2073  on(s) with the s
+0000d5c0: 7065 6369 6669 6564 206f 6666 7365 7420  pecified offset 
+0000d5d0: 6170 706c 6965 642e 0a20 2020 2022 2222  applied..    """
+0000d5e0: 0a0a 2020 2020 6420 3d20 726f 756e 6428  ..    d = round(
+0000d5f0: 6469 7374 616e 6365 202f 2070 7265 6369  distance / preci
+0000d600: 7369 6f6e 2920 2023 2054 6865 2064 6973  sion)  # The dis
+0000d610: 7461 6e63 6520 696e 2064 6174 6162 6173  tance in databas
+0000d620: 6520 756e 6974 730a 0a20 2020 2023 2047  e units..    # G
+0000d630: 6574 206c 6973 7420 6f66 2070 6f72 7473  et list of ports
+0000d640: 2074 6f20 6265 206f 7065 6e65 640a 2020   to be opened.  
+0000d650: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+0000d660: 6e63 6528 656c 656d 656e 7473 2c20 6c69  nce(elements, li
+0000d670: 7374 293a 0a20 2020 2020 2020 2065 6c65  st):.        ele
+0000d680: 6d65 6e74 7320 3d20 5b65 6c65 6d65 6e74  ments = [element
+0000d690: 735d 0a20 2020 2070 6f72 745f 6c69 7374  s].    port_list
+0000d6a0: 203d 205b 5d0a 2020 2020 666f 7220 6520   = [].    for e 
+0000d6b0: 696e 2065 6c65 6d65 6e74 733a 0a20 2020  in elements:.   
+0000d6c0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0000d6d0: 6365 2865 2c20 4465 7669 6365 293a 0a20  ce(e, Device):. 
+0000d6e0: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
+0000d6f0: 6c69 7374 202b 3d20 6c69 7374 2865 2e70  list += list(e.p
+0000d700: 6f72 7473 2e76 616c 7565 7328 2929 0a0a  orts.values())..
+0000d710: 2020 2020 5472 696d 203d 2044 6576 6963      Trim = Devic
+0000d720: 6528 290a 2020 2020 6966 206f 7065 6e5f  e().    if open_
+0000d730: 706f 7274 7320 6973 206e 6f74 2046 616c  ports is not Fal
+0000d740: 7365 3a0a 2020 2020 2020 2020 6966 206f  se:.        if o
+0000d750: 7065 6e5f 706f 7274 7320 6973 2054 7275  pen_ports is Tru
+0000d760: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
+0000d770: 7269 6d5f 7769 6474 6820 3d20 300a 2020  rim_width = 0.  
+0000d780: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000d790: 2020 2020 2020 2020 7472 696d 5f77 6964          trim_wid
+0000d7a0: 7468 203d 206f 7065 6e5f 706f 7274 7320  th = open_ports 
+0000d7b0: 2a20 320a 2020 2020 2020 2020 666f 7220  * 2.        for 
+0000d7c0: 706f 7274 2069 6e20 706f 7274 5f6c 6973  port in port_lis
+0000d7d0: 743a 0a20 2020 2020 2020 2020 2020 2074  t:.            t
+0000d7e0: 7269 6d20 3d20 636f 6d70 6173 7328 7369  rim = compass(si
+0000d7f0: 7a65 3d28 6469 7374 616e 6365 202b 2036  ze=(distance + 6
+0000d800: 202a 2070 7265 6369 7369 6f6e 2c20 706f   * precision, po
+0000d810: 7274 2e77 6964 7468 202b 2074 7269 6d5f  rt.width + trim_
+0000d820: 7769 6474 6829 290a 2020 2020 2020 2020  width)).        
+0000d830: 2020 2020 7472 696d 5f72 6566 203d 2054      trim_ref = T
+0000d840: 7269 6d20 3c3c 2074 7269 6d0a 2020 2020  rim << trim.    
+0000d850: 2020 2020 2020 2020 7472 696d 5f72 6566          trim_ref
+0000d860: 2e63 6f6e 6e65 6374 2822 4522 2c20 706f  .connect("E", po
+0000d870: 7274 2c20 6f76 6572 6c61 703d 3220 2a20  rt, overlap=2 * 
+0000d880: 7072 6563 6973 696f 6e29 0a0a 2020 2020  precision)..    
+0000d890: 4420 3d20 5f6b 6c5f 6578 7072 6573 7369  D = _kl_expressi
+0000d8a0: 6f6e 280a 2020 2020 2020 2020 656c 656d  on(.        elem
+0000d8b0: 656e 745f 6469 6374 3d64 6963 7428 413d  ent_dict=dict(A=
+0000d8c0: 656c 656d 656e 7473 2c20 423d 5472 696d  elements, B=Trim
+0000d8d0: 292c 0a20 2020 2020 2020 2065 7870 7265  ),.        expre
+0000d8e0: 7373 696f 6e3d 6622 412e 7369 7a65 6428  ssion=f"A.sized(
+0000d8f0: 7b64 7d2c 207b 6d69 7465 725f 6d6f 6465  {d}, {miter_mode
+0000d900: 7d29 202d 2028 4120 2b20 4229 222c 0a20  }) - (A + B)",. 
+0000d910: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
+0000d920: 3d70 7265 6369 7369 6f6e 2c0a 2020 2020  =precision,.    
+0000d930: 2020 2020 7469 6c65 5f73 697a 653d 7469      tile_size=ti
+0000d940: 6c65 5f73 697a 652c 0a20 2020 2020 2020  le_size,.       
+0000d950: 206d 6572 6765 5f66 6972 7374 3d54 7275   merge_first=Tru
+0000d960: 652c 0a20 2020 2020 2020 206d 6572 6765  e,.        merge
+0000d970: 5f61 6674 6572 3d6d 6572 6765 5f61 6674  _after=merge_aft
+0000d980: 6572 2c0a 2020 2020 2020 2020 6f75 7470  er,.        outp
+0000d990: 7574 5f6e 616d 653d 226f 7574 6c69 6e65  ut_name="outline
+0000d9a0: 222c 0a20 2020 2020 2020 206e 756d 5f63  ",.        num_c
+0000d9b0: 7075 3d4e 554d 5f43 5055 2c0a 2020 2020  pu=NUM_CPU,.    
+0000d9c0: 2020 2020 6c61 7965 723d 6c61 7965 722c      layer=layer,
+0000d9d0: 0a20 2020 2029 0a0a 2020 2020 6966 206f  .    )..    if o
+0000d9e0: 7065 6e5f 706f 7274 7320 6973 206e 6f74  pen_ports is not
+0000d9f0: 2046 616c 7365 2061 6e64 206c 656e 2865   False and len(e
+0000da00: 6c65 6d65 6e74 7329 203d 3d20 313a 0a20  lements) == 1:. 
+0000da10: 2020 2020 2020 2066 6f72 2070 6f72 7420         for port 
+0000da20: 696e 2070 6f72 745f 6c69 7374 3a0a 2020  in port_list:.  
+0000da30: 2020 2020 2020 2020 2020 442e 6164 645f            D.add_
+0000da40: 706f 7274 2870 6f72 743d 706f 7274 290a  port(port=port).
+0000da50: 0a20 2020 2072 6574 7572 6e20 440a 0a0a  .    return D...
+0000da60: 6465 6620 6b6c 5f69 6e76 6572 7428 0a20  def kl_invert(. 
+0000da70: 2020 2065 6c65 6d65 6e74 732c 0a20 2020     elements,.   
+0000da80: 2062 6f72 6465 723d 2831 302c 2031 3029   border=(10, 10)
+0000da90: 2c0a 2020 2020 7072 6563 6973 696f 6e3d  ,.    precision=
+0000daa0: 3165 2d34 2c0a 2020 2020 7469 6c65 5f73  1e-4,.    tile_s
+0000dab0: 697a 653d 2831 3030 302c 2031 3030 3029  ize=(1000, 1000)
+0000dac0: 2c0a 2020 2020 6d65 7267 655f 6166 7465  ,.    merge_afte
+0000dad0: 723d 5472 7565 2c0a 2020 2020 6c61 7965  r=True,.    laye
+0000dae0: 723d 302c 0a29 3a0a 2020 2020 2222 2243  r=0,.):.    """C
+0000daf0: 7265 6174 6573 2061 6e20 696e 7665 7274  reates an invert
+0000db00: 6564 2076 6572 7369 6f6e 206f 6620 7468  ed version of th
+0000db10: 6520 696e 7075 7420 7368 6170 6573 2077  e input shapes w
+0000db20: 6974 6820 616e 2061 6464 6974 696f 6e61  ith an additiona
+0000db30: 6c0a 2020 2020 626f 7264 6572 2061 726f  l.    border aro
+0000db40: 756e 6420 7468 6520 6564 6765 732e 0a0a  und the edges...
+0000db50: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+0000db60: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+0000db70: 2020 656c 656d 656e 7473 203a 2044 6576    elements : Dev
+0000db80: 6963 6528 2f52 6566 6572 656e 6365 292c  ice(/Reference),
+0000db90: 206c 6973 7420 6f66 2044 6576 6963 6528   list of Device(
+0000dba0: 2f52 6566 6572 656e 6365 292c 206f 7220  /Reference), or 
+0000dbb0: 506f 6c79 676f 6e0a 2020 2020 2020 2020  Polygon.        
+0000dbc0: 4120 4465 7669 6365 2063 6f6e 7461 696e  A Device contain
+0000dbd0: 696e 6720 7468 6520 706f 6c79 676f 6e73  ing the polygons
+0000dbe0: 2074 6f20 696e 7665 7274 2e0a 2020 2020   to invert..    
+0000dbf0: 626f 7264 6572 203a 2061 7272 6179 2d6c  border : array-l
+0000dc00: 696b 655b 325d 0a20 2020 2020 2020 2028  ike[2].        (
+0000dc10: 6478 2c64 7929 2073 697a 6520 6f66 2074  dx,dy) size of t
+0000dc20: 6865 2062 6f72 6465 7220 6172 6f75 6e64  he border around
+0000dc30: 2074 6865 2069 6e76 6572 7465 6420 7368   the inverted sh
+0000dc40: 6170 6520 2862 6f72 6465 7220 7661 6c75  ape (border valu
+0000dc50: 6520 6973 2074 6865 0a20 2020 2020 2020  e is the.       
+0000dc60: 2064 6973 7461 6e63 6520 6672 6f6d 2074   distance from t
+0000dc70: 6865 2065 6467 6573 206f 6620 7468 6520  he edges of the 
+0000dc80: 626f 756e 6469 6e67 2062 6f78 2064 6566  bounding box def
+0000dc90: 696e 696e 6729 0a20 2020 2070 7265 6369  ining).    preci
+0000dca0: 7369 6f6e 203a 2066 6c6f 6174 0a20 2020  sion : float.   
+0000dcb0: 2020 2020 2044 6573 6972 6564 2070 7265       Desired pre
+0000dcc0: 6369 7369 6f6e 2066 6f72 2072 6f75 6e64  cision for round
+0000dcd0: 696e 6720 7665 7274 6578 2063 6f6f 7264  ing vertex coord
+0000dce0: 696e 6174 6573 2e0a 2020 2020 7469 6c65  inates..    tile
+0000dcf0: 5f73 697a 6520 3a20 6172 7261 792d 6c69  _size : array-li
+0000dd00: 6b65 5b32 5d0a 2020 2020 2020 2020 5468  ke[2].        Th
+0000dd10: 6520 7469 6c65 2073 697a 6520 7769 7468  e tile size with
+0000dd20: 2077 6869 6368 2074 6865 2067 656f 6d65   which the geome
+0000dd30: 7472 7920 6973 2064 6976 6964 6564 2e20  try is divided. 
+0000dd40: 5468 6973 2061 6c6c 6f77 7320 666f 7220  This allows for 
+0000dd50: 6561 6368 0a20 2020 2020 2020 2072 6567  each.        reg
+0000dd60: 696f 6e20 746f 2062 6570 726f 6365 7373  ion to beprocess
+0000dd70: 6564 2073 6571 7565 6e74 6961 6c6c 792c  ed sequentially,
+0000dd80: 2077 6869 6368 2069 7320 6d6f 7265 2063   which is more c
+0000dd90: 6f6d 7075 7461 7469 6f6e 616c 6c79 0a20  omputationally. 
+0000dda0: 2020 2020 2020 2065 6666 6963 6965 6e74         efficient
+0000ddb0: 2028 616e 6420 6361 6e20 6265 2072 756e   (and can be run
+0000ddc0: 2069 6e20 7061 7261 6c6c 656c 206f 6e20   in parallel on 
+0000ddd0: 6d75 6c74 6970 6c65 2043 5055 2063 6f72  multiple CPU cor
+0000dde0: 6573 292e 0a20 2020 206d 6572 6765 5f61  es)..    merge_a
+0000ddf0: 6674 6572 3a20 626f 6f6c 0a20 2020 2020  fter: bool.     
+0000de00: 2020 204d 6572 6765 2061 6c6c 2074 6865     Merge all the
+0000de10: 2070 6f6c 7967 6f6e 7320 6166 7465 7220   polygons after 
+0000de20: 7065 7266 6f72 6d69 6e67 2074 6865 206f  performing the o
+0000de30: 7574 6c69 6e65 206f 7065 7261 7469 6f6e  utline operation
+0000de40: 0a20 2020 206c 6179 6572 203a 2069 6e74  .    layer : int
+0000de50: 2c20 6172 7261 792d 6c69 6b65 5b32 5d2c  , array-like[2],
+0000de60: 206f 7220 7365 740a 2020 2020 2020 2020   or set.        
+0000de70: 5370 6563 6966 6963 206c 6179 6572 2873  Specific layer(s
+0000de80: 2920 746f 2070 7574 2070 6f6c 7967 6f6e  ) to put polygon
+0000de90: 2067 656f 6d65 7472 7920 6f6e 2e0a 0a20   geometry on... 
+0000dea0: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
+0000deb0: 2d2d 2d2d 2d2d 0a20 2020 2044 203a 2044  ------.    D : D
+0000dec0: 6576 6963 650a 2020 2020 2020 2020 4120  evice.        A 
+0000ded0: 4465 7669 6365 2063 6f6e 7461 696e 696e  Device containin
+0000dee0: 6720 7468 6520 696e 7665 7274 6564 2076  g the inverted v
+0000def0: 6572 7369 6f6e 206f 6620 7468 6520 696e  ersion of the in
+0000df00: 7075 7420 7368 6170 6528 7329 2061 6e64  put shape(s) and
+0000df10: 2074 6865 0a20 2020 2020 2020 2063 6f72   the.        cor
+0000df20: 7265 7370 6f6e 6469 6e67 2062 6f72 6465  responding borde
+0000df30: 7228 7329 2e0a 2020 2020 2222 220a 2020  r(s)..    """.  
+0000df40: 2020 6966 206e 702e 7369 7a65 2862 6f72    if np.size(bor
+0000df50: 6465 7229 203d 3d20 313a 0a20 2020 2020  der) == 1:.     
+0000df60: 2020 2064 7820 3d20 6479 203d 2072 6f75     dx = dy = rou
+0000df70: 6e64 2862 6f72 6465 7220 2f20 7072 6563  nd(border / prec
+0000df80: 6973 696f 6e29 0a20 2020 2065 6c69 6620  ision).    elif 
+0000df90: 6e70 2e73 697a 6528 626f 7264 6572 2920  np.size(border) 
+0000dfa0: 3d3d 2032 3a0a 2020 2020 2020 2020 6478  == 2:.        dx
+0000dfb0: 203d 2072 6f75 6e64 2862 6f72 6465 725b   = round(border[
+0000dfc0: 305d 202f 2070 7265 6369 7369 6f6e 290a  0] / precision).
+0000dfd0: 2020 2020 2020 2020 6479 203d 2072 6f75          dy = rou
+0000dfe0: 6e64 2862 6f72 6465 725b 315d 202f 2070  nd(border[1] / p
+0000dff0: 7265 6369 7369 6f6e 290a 0a20 2020 2044  recision)..    D
+0000e000: 203d 205f 6b6c 5f65 7870 7265 7373 696f   = _kl_expressio
+0000e010: 6e28 0a20 2020 2020 2020 2065 6c65 6d65  n(.        eleme
+0000e020: 6e74 5f64 6963 743d 6469 6374 2841 3d65  nt_dict=dict(A=e
+0000e030: 6c65 6d65 6e74 7329 2c0a 2020 2020 2020  lements),.      
+0000e040: 2020 6578 7072 6573 7369 6f6e 3d66 2241    expression=f"A
+0000e050: 2e65 7874 656e 7473 2829 2e73 697a 6564  .extents().sized
+0000e060: 287b 6478 7d2c 7b64 797d 2c32 2920 2d20  ({dx},{dy},2) - 
+0000e070: 4122 2c0a 2020 2020 2020 2020 7072 6563  A",.        prec
+0000e080: 6973 696f 6e3d 7072 6563 6973 696f 6e2c  ision=precision,
+0000e090: 0a20 2020 2020 2020 2074 696c 655f 7369  .        tile_si
+0000e0a0: 7a65 3d74 696c 655f 7369 7a65 2c0a 2020  ze=tile_size,.  
+0000e0b0: 2020 2020 2020 6d65 7267 655f 6669 7273        merge_firs
+0000e0c0: 743d 5472 7565 2c0a 2020 2020 2020 2020  t=True,.        
+0000e0d0: 6d65 7267 655f 6166 7465 723d 6d65 7267  merge_after=merg
+0000e0e0: 655f 6166 7465 722c 0a20 2020 2020 2020  e_after,.       
+0000e0f0: 206f 7574 7075 745f 6e61 6d65 3d22 696e   output_name="in
+0000e100: 7665 7274 222c 0a20 2020 2020 2020 206e  vert",.        n
+0000e110: 756d 5f63 7075 3d4e 554d 5f43 5055 2c0a  um_cpu=NUM_CPU,.
+0000e120: 2020 2020 2020 2020 6c61 7965 723d 6c61          layer=la
+0000e130: 7965 722c 0a20 2020 2029 0a20 2020 2072  yer,.    ).    r
+0000e140: 6574 7572 6e20 440a 0a0a 2320 3d3d 3d3d  eturn D...# ====
+0000e150: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000e160: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000e170: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000e180: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000e190: 3d3d 3d3d 3d3d 3d3d 3d3d 0a23 0a23 204c  ==========.#.# L
+0000e1a0: 6974 686f 6772 6170 6879 2074 6573 7420  ithography test 
+0000e1b0: 7374 7275 6374 7572 6573 0a23 0a23 203d  structures.#.# =
+0000e1c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000e1d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000e1e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000e1f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000e200: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 0a0a  =============...
+0000e210: 6465 6620 6c69 7468 6f5f 7374 6570 7328  def litho_steps(
+0000e220: 6c69 6e65 5f77 6964 7468 733d 5b31 2c20  line_widths=[1, 
+0000e230: 322c 2034 2c20 382c 2031 365d 2c20 6c69  2, 4, 8, 16], li
+0000e240: 6e65 5f73 7061 6369 6e67 3d31 302c 2068  ne_spacing=10, h
+0000e250: 6569 6768 743d 3130 302c 206c 6179 6572  eight=100, layer
+0000e260: 3d30 293a 0a20 2020 2022 2222 5072 6f64  =0):.    """Prod
+0000e270: 7563 6573 2061 2070 6f73 6974 6976 6520  uces a positive 
+0000e280: 2b20 6e65 6761 7469 7665 2074 6f6e 6520  + negative tone 
+0000e290: 6c69 6e65 7769 6474 6820 7465 7374 2c20  linewidth test, 
+0000e2a0: 7573 6564 2066 6f72 0a20 2020 206c 6974  used for.    lit
+0000e2b0: 686f 6772 6170 6879 2072 6573 6f6c 7574  hography resolut
+0000e2c0: 696f 6e20 7465 7374 2070 6174 7465 726e  ion test pattern
+0000e2d0: 696e 672e 0a0a 2020 2020 5061 7261 6d65  ing...    Parame
+0000e2e0: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
+0000e2f0: 2d2d 2d0a 2020 2020 6c69 6e65 5f77 6964  ---.    line_wid
+0000e300: 7468 7320 3a20 6172 7261 792d 6c69 6b65  ths : array-like
+0000e310: 5b4e 5d20 6f66 2069 6e74 206f 7220 666c  [N] of int or fl
+0000e320: 6f61 740a 2020 2020 2020 2020 5769 6474  oat.        Widt
+0000e330: 6873 206f 6620 7468 6520 7374 6570 7320  hs of the steps 
+0000e340: 2870 6f73 6974 6976 6520 7369 6465 292e  (positive side).
+0000e350: 0a20 2020 206c 696e 655f 7370 6163 696e  .    line_spacin
+0000e360: 6720 3a20 696e 7420 6f72 2066 6c6f 6174  g : int or float
+0000e370: 0a20 2020 2020 2020 2053 7061 6365 2062  .        Space b
+0000e380: 6574 7765 656e 2065 6163 6820 7374 6570  etween each step
+0000e390: 2028 6e65 6761 7469 7665 2073 6964 6529   (negative side)
+0000e3a0: 2e0a 2020 2020 6865 6967 6874 203a 2069  ..    height : i
+0000e3b0: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
+0000e3c0: 2020 2020 4865 6967 6874 206f 6620 7468      Height of th
+0000e3d0: 6520 7374 6570 732e 0a20 2020 206c 6179  e steps..    lay
+0000e3e0: 6572 203a 2069 6e74 2c20 6172 7261 792d  er : int, array-
+0000e3f0: 6c69 6b65 5b32 5d2c 206f 7220 7365 740a  like[2], or set.
+0000e400: 2020 2020 2020 2020 5370 6563 6966 6963          Specific
+0000e410: 206c 6179 6572 2873 2920 746f 2070 7574   layer(s) to put
+0000e420: 2070 6f6c 7967 6f6e 2067 656f 6d65 7472   polygon geometr
+0000e430: 7920 6f6e 2e0a 0a20 2020 2052 6574 7572  y on...    Retur
+0000e440: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
+0000e450: 2020 2044 203a 2044 6576 6963 650a 2020     D : Device.  
+0000e460: 2020 2020 2020 4120 4465 7669 6365 2063        A Device c
+0000e470: 6f6e 7461 696e 696e 6720 7468 6520 6c69  ontaining the li
+0000e480: 7468 6f67 7261 7068 6963 206c 696e 6577  thographic linew
+0000e490: 6964 7468 2072 6573 6f6c 7574 696f 6e20  idth resolution 
+0000e4a0: 7465 7374 0a20 2020 2020 2020 2067 656f  test.        geo
+0000e4b0: 6d65 7472 792e 0a20 2020 2022 2222 0a20  metry..    """. 
+0000e4c0: 2020 2044 203d 2044 6576 6963 6528 226c     D = Device("l
+0000e4d0: 6974 686f 5f73 7465 7073 2229 0a0a 2020  itho_steps")..  
+0000e4e0: 2020 6865 6967 6874 203d 2068 6569 6768    height = heigh
+0000e4f0: 7420 2f20 320a 2020 2020 5431 203d 2074  t / 2.    T1 = t
+0000e500: 6578 7428 0a20 2020 2020 2020 2074 6578  ext(.        tex
+0000e510: 743d 2225 7322 2025 2073 7472 286c 696e  t="%s" % str(lin
+0000e520: 655f 7769 6474 6873 5b2d 315d 292c 2073  e_widths[-1]), s
+0000e530: 697a 653d 6865 6967 6874 2c20 6a75 7374  ize=height, just
+0000e540: 6966 793d 2263 656e 7465 7222 2c20 6c61  ify="center", la
+0000e550: 7965 723d 6c61 7965 720a 2020 2020 290a  yer=layer.    ).
+0000e560: 2020 2020 5f20 3d20 442e 6164 645f 7265      _ = D.add_re
+0000e570: 6628 5431 292e 726f 7461 7465 2839 3029  f(T1).rotate(90)
+0000e580: 2e6d 6f76 6578 282d 6865 6967 6874 202f  .movex(-height /
+0000e590: 2031 3029 0a20 2020 2052 3120 3d20 7265   10).    R1 = re
+0000e5a0: 6374 616e 676c 6528 7369 7a65 3d28 6c69  ctangle(size=(li
+0000e5b0: 6e65 5f73 7061 6369 6e67 2c20 6865 6967  ne_spacing, heig
+0000e5c0: 6874 292c 206c 6179 6572 3d6c 6179 6572  ht), layer=layer
+0000e5d0: 290a 2020 2020 442e 6164 645f 7265 6628  ).    D.add_ref(
+0000e5e0: 5231 292e 6d6f 7665 7928 2d68 6569 6768  R1).movey(-heigh
+0000e5f0: 7429 0a20 2020 2063 6f75 6e74 203d 2030  t).    count = 0
+0000e600: 0a20 2020 2066 6f72 2069 2069 6e20 7265  .    for i in re
+0000e610: 7665 7273 6564 286c 696e 655f 7769 6474  versed(line_widt
+0000e620: 6873 293a 0a20 2020 2020 2020 2063 6f75  hs):.        cou
+0000e630: 6e74 202b 3d20 6c69 6e65 5f73 7061 6369  nt += line_spaci
+0000e640: 6e67 202b 2069 0a20 2020 2020 2020 2052  ng + i.        R
+0000e650: 3220 3d20 7265 6374 616e 676c 6528 7369  2 = rectangle(si
+0000e660: 7a65 3d28 692c 2068 6569 6768 7429 2c20  ze=(i, height), 
+0000e670: 6c61 7965 723d 6c61 7965 7229 0a20 2020  layer=layer).   
+0000e680: 2020 2020 2044 2e61 6464 5f72 6566 2852       D.add_ref(R
+0000e690: 3129 2e6d 6f76 6578 2863 6f75 6e74 292e  1).movex(count).
+0000e6a0: 6d6f 7665 7928 2d68 6569 6768 7429 0a20  movey(-height). 
+0000e6b0: 2020 2020 2020 2044 2e61 6464 5f72 6566         D.add_ref
+0000e6c0: 2852 3229 2e6d 6f76 6578 2863 6f75 6e74  (R2).movex(count
+0000e6d0: 202d 2069 290a 0a20 2020 2072 6574 7572   - i)..    retur
+0000e6e0: 6e20 440a 0a0a 6465 6620 6c69 7468 6f5f  n D...def litho_
+0000e6f0: 7374 6172 286e 756d 5f6c 696e 6573 3d32  star(num_lines=2
+0000e700: 302c 206c 696e 655f 7769 6474 683d 322c  0, line_width=2,
+0000e710: 2064 6961 6d65 7465 723d 3230 302c 206c   diameter=200, l
+0000e720: 6179 6572 3d30 293a 0a20 2020 2022 2222  ayer=0):.    """
+0000e730: 4372 6561 7465 7320 6120 6369 7263 756c  Creates a circul
+0000e740: 6172 2d73 7461 7220 7368 6170 6520 6672  ar-star shape fr
+0000e750: 6f6d 206c 696e 6573 2c20 7573 6564 2061  om lines, used a
+0000e760: 7320 6120 6c69 7468 6f67 7261 7068 6963  s a lithographic
+0000e770: 0a20 2020 2072 6573 6f6c 7574 696f 6e20  .    resolution 
+0000e780: 7465 7374 2070 6174 7465 726e 2e0a 0a20  test pattern... 
+0000e790: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+0000e7a0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+0000e7b0: 206e 756d 5f6c 696e 6573 203a 2069 6e74   num_lines : int
+0000e7c0: 0a20 2020 2020 2020 204e 756d 6265 7220  .        Number 
+0000e7d0: 6f66 206c 696e 6573 2069 6e20 7468 6520  of lines in the 
+0000e7e0: 6369 7263 756c 6172 2d73 7461 7220 7368  circular-star sh
+0000e7f0: 6170 652e 0a20 2020 206c 696e 655f 7769  ape..    line_wi
+0000e800: 6474 6820 3a20 696e 7420 6f72 2066 6c6f  dth : int or flo
+0000e810: 6174 0a20 2020 2020 2020 2054 6869 636b  at.        Thick
+0000e820: 6e65 7373 206f 6620 7374 6172 2073 7069  ness of star spi
+0000e830: 6b65 206c 696e 6573 2e0a 2020 2020 6469  ke lines..    di
+0000e840: 616d 6574 6572 203a 2069 6e74 206f 7220  ameter : int or 
+0000e850: 666c 6f61 740a 2020 2020 2020 2020 4469  float.        Di
+0000e860: 616d 6574 6572 206f 6620 7468 6520 6369  ameter of the ci
+0000e870: 7263 756c 6172 2d73 7461 7220 7368 6170  rcular-star shap
+0000e880: 6520 2874 6f74 616c 206c 656e 6774 6820  e (total length 
+0000e890: 6f66 2065 6163 6820 7374 6172 2073 7069  of each star spi
+0000e8a0: 6b65 292e 0a20 2020 206c 6179 6572 203a  ke)..    layer :
+0000e8b0: 2069 6e74 2c20 6172 7261 792d 6c69 6b65   int, array-like
+0000e8c0: 5b32 5d2c 206f 7220 7365 740a 2020 2020  [2], or set.    
+0000e8d0: 2020 2020 5370 6563 6966 6963 206c 6179      Specific lay
+0000e8e0: 6572 2873 2920 746f 2070 7574 2070 6f6c  er(s) to put pol
+0000e8f0: 7967 6f6e 2067 656f 6d65 7472 7920 6f6e  ygon geometry on
+0000e900: 2e0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
+0000e910: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2044     -------.    D
+0000e920: 203a 2044 6576 6963 650a 2020 2020 2020   : Device.      
+0000e930: 2020 4120 4465 7669 6365 2063 6f6e 7461    A Device conta
+0000e940: 696e 696e 6720 6120 6c69 6e65 2d62 6173  ining a line-bas
+0000e950: 6564 2063 6972 6375 6c61 722d 7374 6172  ed circular-star
+0000e960: 2073 6861 7065 2e0a 2020 2020 2222 220a   shape..    """.
+0000e970: 2020 2020 4420 3d20 4465 7669 6365 2822      D = Device("
+0000e980: 6c69 7468 6f5f 7374 6172 2229 0a0a 2020  litho_star")..  
+0000e990: 2020 6465 6772 6565 203d 2031 3830 202f    degree = 180 /
+0000e9a0: 206e 756d 5f6c 696e 6573 0a20 2020 2052   num_lines.    R
+0000e9b0: 3120 3d20 7265 6374 616e 676c 6528 7369  1 = rectangle(si
+0000e9c0: 7a65 3d28 6c69 6e65 5f77 6964 7468 2c20  ze=(line_width, 
+0000e9d0: 6469 616d 6574 6572 292c 206c 6179 6572  diameter), layer
+0000e9e0: 3d6c 6179 6572 290a 2020 2020 666f 7220  =layer).    for 
+0000e9f0: 6920 696e 2072 616e 6765 286e 756d 5f6c  i in range(num_l
+0000ea00: 696e 6573 293a 0a20 2020 2020 2020 2072  ines):.        r
+0000ea10: 3120 3d20 442e 6164 645f 7265 6628 5231  1 = D.add_ref(R1
+0000ea20: 292e 726f 7461 7465 2864 6567 7265 6520  ).rotate(degree 
+0000ea30: 2a20 6929 0a20 2020 2020 2020 2072 312e  * i).        r1.
+0000ea40: 6365 6e74 6572 203d 2028 302c 2030 290a  center = (0, 0).
+0000ea50: 0a20 2020 2072 6574 7572 6e20 440a 0a0a  .    return D...
+0000ea60: 6465 6620 6c69 7468 6f5f 6361 6c69 7065  def litho_calipe
+0000ea70: 7273 280a 2020 2020 6e6f 7463 685f 7369  rs(.    notch_si
+0000ea80: 7a65 3d5b 322c 2035 5d2c 0a20 2020 206e  ze=[2, 5],.    n
+0000ea90: 6f74 6368 5f73 7061 6369 6e67 3d32 2c0a  otch_spacing=2,.
+0000eaa0: 2020 2020 6e75 6d5f 6e6f 7463 6865 733d      num_notches=
+0000eab0: 3131 2c0a 2020 2020 6f66 6673 6574 5f70  11,.    offset_p
+0000eac0: 6572 5f6e 6f74 6368 3d30 2e31 2c0a 2020  er_notch=0.1,.  
+0000ead0: 2020 726f 775f 7370 6163 696e 673d 302c    row_spacing=0,
+0000eae0: 0a20 2020 206c 6179 6572 313d 312c 0a20  .    layer1=1,. 
+0000eaf0: 2020 206c 6179 6572 323d 322c 0a29 3a0a     layer2=2,.):.
+0000eb00: 2020 2020 2222 2243 7265 6174 6573 2061      """Creates a
+0000eb10: 2076 6572 6e69 6572 2063 616c 6970 6572   vernier caliper
+0000eb20: 2073 7472 7563 7475 7265 2066 6f72 206c   structure for l
+0000eb30: 6974 686f 6772 6170 6879 2061 6c69 676e  ithography align
+0000eb40: 6d65 6e74 0a20 2020 2074 6573 7473 2e20  ment.    tests. 
+0000eb50: 5665 726e 6965 7220 7374 7275 6374 7572  Vernier structur
+0000eb60: 6520 6973 206d 6164 6520 686f 7269 7a6f  e is made horizo
+0000eb70: 6e74 616c 6c79 2e0a 0a20 2020 2050 6172  ntally...    Par
+0000eb80: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+0000eb90: 2d2d 2d2d 2d2d 0a20 2020 206e 6f74 6368  ------.    notch
+0000eba0: 5f73 697a 6520 3a20 6172 7261 792d 6c69  _size : array-li
+0000ebb0: 6b65 5b32 5d20 6f66 2069 6e74 206f 7220  ke[2] of int or 
+0000ebc0: 666c 616f 740a 2020 2020 2020 2020 782c  flaot.        x,
+0000ebd0: 2079 2073 697a 6520 6f66 2074 6865 206e   y size of the n
+0000ebe0: 6f74 6368 6573 2e0a 2020 2020 6e6f 7463  otches..    notc
+0000ebf0: 685f 7370 6163 696e 6720 3a20 696e 7420  h_spacing : int 
+0000ec00: 6f72 2066 6c6f 6174 0a20 2020 2020 2020  or float.       
+0000ec10: 2053 7061 6369 6e67 2062 6574 7765 656e   Spacing between
+0000ec20: 206e 6f74 6368 6573 206f 6e20 7468 6520   notches on the 
+0000ec30: 636f 6e74 726f 6c20 7374 7275 6374 7572  control structur
+0000ec40: 652e 0a20 2020 206e 756d 5f6e 6f74 6368  e..    num_notch
+0000ec50: 6573 203a 2069 6e74 0a20 2020 2020 2020  es : int.       
+0000ec60: 204e 756d 6265 7220 6f66 206e 6f74 6368   Number of notch
+0000ec70: 6573 206f 6e20 6f6e 6520 7369 6465 206f  es on one side o
+0000ec80: 6620 7468 6520 7374 7275 6374 7572 6520  f the structure 
+0000ec90: 2874 6f74 616c 206e 756d 6265 7220 6f66  (total number of
+0000eca0: 0a20 2020 2020 2020 206e 6f74 6368 6573  .        notches
+0000ecb0: 2069 7320 322a 6e75 6d5f 6e6f 7463 6865   is 2*num_notche
+0000ecc0: 7320 2b20 3129 2e0a 2020 2020 6f66 6673  s + 1)..    offs
+0000ecd0: 6574 5f70 6572 5f6e 6f74 6368 203a 2069  et_per_notch : i
+0000ece0: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
+0000ecf0: 2020 2020 5468 6520 616d 6f75 6e74 206f      The amount o
+0000ed00: 6620 686f 7269 7a6f 6e74 616c 206f 6666  f horizontal off
+0000ed10: 7365 7420 746f 2061 7070 6c79 2074 6f20  set to apply to 
+0000ed20: 7468 6520 6e6f 7463 6820 7370 6163 696e  the notch spacin
+0000ed30: 6720 7065 720a 2020 2020 2020 2020 6e6f  g per.        no
+0000ed40: 7463 6820 6f6e 2074 6865 206e 6f6e 2d63  tch on the non-c
+0000ed50: 6f6e 7472 6f6c 2073 7472 7563 7475 7265  ontrol structure
+0000ed60: 2e0a 2020 2020 726f 775f 7370 6163 696e  ..    row_spacin
+0000ed70: 6720 3a20 696e 7420 6f72 2066 6c6f 6174  g : int or float
+0000ed80: 0a20 2020 2020 2020 2054 6865 2061 6d6f  .        The amo
+0000ed90: 756e 7420 6f66 2076 6572 7469 6361 6c20  unt of vertical 
+0000eda0: 7370 6163 6520 6265 7477 6565 6e20 7468  space between th
+0000edb0: 6520 636f 6e74 726f 6c20 616e 6420 6e6f  e control and no
+0000edc0: 6e2d 636f 6e74 726f 6c0a 2020 2020 2020  n-control.      
+0000edd0: 2020 7374 7275 6374 7572 6573 2e0a 2020    structures..  
+0000ede0: 2020 6c61 7965 7231 203a 2069 6e74 2c20    layer1 : int, 
+0000edf0: 6172 7261 792d 6c69 6b65 5b32 5d2c 206f  array-like[2], o
+0000ee00: 7220 7365 740a 2020 2020 2020 2020 5370  r set.        Sp
+0000ee10: 6563 6966 6963 206c 6179 6572 2873 2920  ecific layer(s) 
+0000ee20: 746f 2070 7574 2074 6865 2063 6f6e 7472  to put the contr
+0000ee30: 6f6c 2067 656f 6d65 7472 7920 6f6e 2e0a  ol geometry on..
+0000ee40: 2020 2020 6c61 7965 7232 203a 2069 6e74      layer2 : int
+0000ee50: 2c20 6172 7261 792d 6c69 6b65 5b32 5d2c  , array-like[2],
+0000ee60: 206f 7220 7365 740a 2020 2020 2020 2020   or set.        
+0000ee70: 5370 6563 6966 6963 206c 6179 6572 2873  Specific layer(s
+0000ee80: 2920 746f 2070 7574 2074 6865 206e 6f6e  ) to put the non
+0000ee90: 2d63 6f6e 7472 6f6c 2067 656f 6d65 7472  -control geometr
+0000eea0: 7920 6f6e 2e0a 0a20 2020 2052 6574 7572  y on...    Retur
+0000eeb0: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
+0000eec0: 2020 2044 6576 6963 650a 2020 2020 2020     Device.      
+0000eed0: 2020 4120 4465 7669 6365 2063 6f6e 7461    A Device conta
+0000eee0: 696e 696e 6720 7468 6520 6361 6c69 7065  ining the calipe
+0000eef0: 7220 7374 7275 6374 7572 6573 2e0a 2020  r structures..  
+0000ef00: 2020 2222 220a 2020 2020 4420 3d20 4465    """.    D = De
+0000ef10: 7669 6365 2822 6c69 7468 6f5f 6361 6c69  vice("litho_cali
+0000ef20: 7065 7273 2229 0a20 2020 206e 756d 5f6e  pers").    num_n
+0000ef30: 6f74 6368 6573 5f74 6f74 616c 203d 206e  otches_total = n
+0000ef40: 756d 5f6e 6f74 6368 6573 202a 2032 202b  um_notches * 2 +
+0000ef50: 2031 0a20 2020 2063 656e 7472 655f 6e6f   1.    centre_no
+0000ef60: 7463 6820 3d20 6e75 6d5f 6e6f 7463 6865  tch = num_notche
+0000ef70: 730a 2020 2020 5231 203d 2072 6563 7461  s.    R1 = recta
+0000ef80: 6e67 6c65 2873 697a 653d 286e 6f74 6368  ngle(size=(notch
+0000ef90: 5f73 697a 6529 2c20 6c61 7965 723d 6c61  _size), layer=la
+0000efa0: 7965 7231 290a 2020 2020 5232 203d 2072  yer1).    R2 = r
+0000efb0: 6563 7461 6e67 6c65 2873 697a 653d 286e  ectangle(size=(n
+0000efc0: 6f74 6368 5f73 697a 6529 2c20 6c61 7965  otch_size), laye
+0000efd0: 723d 6c61 7965 7232 290a 2020 2020 666f  r=layer2).    fo
+0000efe0: 7220 6920 696e 2072 616e 6765 286e 756d  r i in range(num
+0000eff0: 5f6e 6f74 6368 6573 5f74 6f74 616c 293a  _notches_total):
+0000f000: 0a20 2020 2020 2020 2069 6620 6920 3d3d  .        if i ==
+0000f010: 2063 656e 7472 655f 6e6f 7463 683a 0a20   centre_notch:. 
+0000f020: 2020 2020 2020 2020 2020 2028 0a20 2020             (.   
+0000f030: 2020 2020 2020 2020 2020 2020 2044 2e61               D.a
+0000f040: 6464 5f72 6566 2852 3129 0a20 2020 2020  dd_ref(R1).     
+0000f050: 2020 2020 2020 2020 2020 202e 6d6f 7665             .move
+0000f060: 7828 6920 2a20 286e 6f74 6368 5f73 697a  x(i * (notch_siz
+0000f070: 655b 305d 202b 206e 6f74 6368 5f73 7061  e[0] + notch_spa
+0000f080: 6369 6e67 2929 0a20 2020 2020 2020 2020  cing)).         
+0000f090: 2020 2020 2020 202e 6d6f 7665 7928 6e6f         .movey(no
+0000f0a0: 7463 685f 7369 7a65 5b31 5d29 0a20 2020  tch_size[1]).   
+0000f0b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000f0c0: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+0000f0d0: 2020 2020 2020 2020 2044 2e61 6464 5f72           D.add_r
+0000f0e0: 6566 2852 3229 0a20 2020 2020 2020 2020  ef(R2).         
+0000f0f0: 2020 2020 2020 202e 6d6f 7665 7828 0a20         .movex(. 
+0000f100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f110: 2020 2069 202a 2028 6e6f 7463 685f 7369     i * (notch_si
+0000f120: 7a65 5b30 5d20 2b20 6e6f 7463 685f 7370  ze[0] + notch_sp
+0000f130: 6163 696e 6729 0a20 2020 2020 2020 2020  acing).         
+0000f140: 2020 2020 2020 2020 2020 202b 206f 6666             + off
+0000f150: 7365 745f 7065 725f 6e6f 7463 6820 2a20  set_per_notch * 
+0000f160: 2863 656e 7472 655f 6e6f 7463 6820 2d20  (centre_notch - 
+0000f170: 6929 0a20 2020 2020 2020 2020 2020 2020  i).             
+0000f180: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000f190: 2020 2020 202e 6d6f 7665 7928 2d32 202a       .movey(-2 *
+0000f1a0: 206e 6f74 6368 5f73 697a 655b 315d 202d   notch_size[1] -
+0000f1b0: 2072 6f77 5f73 7061 6369 6e67 290a 2020   row_spacing).  
+0000f1c0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000f1d0: 2020 2020 442e 6164 645f 7265 6628 5231      D.add_ref(R1
+0000f1e0: 292e 6d6f 7665 7828 6920 2a20 286e 6f74  ).movex(i * (not
+0000f1f0: 6368 5f73 697a 655b 305d 202b 206e 6f74  ch_size[0] + not
+0000f200: 6368 5f73 7061 6369 6e67 2929 0a20 2020  ch_spacing)).   
+0000f210: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
+0000f220: 2020 2044 2e61 6464 5f72 6566 2852 3229     D.add_ref(R2)
+0000f230: 0a20 2020 2020 2020 2020 2020 202e 6d6f  .            .mo
+0000f240: 7665 7828 0a20 2020 2020 2020 2020 2020  vex(.           
+0000f250: 2020 2020 2069 202a 2028 6e6f 7463 685f       i * (notch_
+0000f260: 7369 7a65 5b30 5d20 2b20 6e6f 7463 685f  size[0] + notch_
+0000f270: 7370 6163 696e 6729 0a20 2020 2020 2020  spacing).       
+0000f280: 2020 2020 2020 2020 202b 206f 6666 7365           + offse
+0000f290: 745f 7065 725f 6e6f 7463 6820 2a20 2863  t_per_notch * (c
+0000f2a0: 656e 7472 655f 6e6f 7463 6820 2d20 6929  entre_notch - i)
+0000f2b0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000f2c0: 2020 2020 2020 2020 2020 202e 6d6f 7665             .move
+0000f2d0: 7928 2d6e 6f74 6368 5f73 697a 655b 315d  y(-notch_size[1]
+0000f2e0: 202d 2072 6f77 5f73 7061 6369 6e67 290a   - row_spacing).
+0000f2f0: 2020 2020 2020 2020 290a 0a20 2020 2072          )..    r
+0000f300: 6574 7572 6e20 440a 0a0a 6465 6620 6c69  eturn D...def li
+0000f310: 7468 6f5f 7275 6c65 7228 0a20 2020 2068  tho_ruler(.    h
+0000f320: 6569 6768 743d 322c 0a20 2020 2077 6964  eight=2,.    wid
+0000f330: 7468 3d30 2e35 2c0a 2020 2020 7370 6163  th=0.5,.    spac
+0000f340: 696e 673d 312e 322c 0a20 2020 2073 6361  ing=1.2,.    sca
+0000f350: 6c65 3d5b 332c 2031 2c20 312c 2031 2c20  le=[3, 1, 1, 1, 
+0000f360: 312c 2032 2c20 312c 2031 2c20 312c 2031  1, 2, 1, 1, 1, 1
+0000f370: 5d2c 0a20 2020 206e 756d 5f6d 6172 6b73  ],.    num_marks
+0000f380: 3d32 312c 0a20 2020 206c 6179 6572 3d30  =21,.    layer=0
+0000f390: 2c0a 293a 0a20 2020 2022 2222 4372 6561  ,.):.    """Crea
+0000f3a0: 7465 7320 6120 7275 6c65 7220 7374 7275  tes a ruler stru
+0000f3b0: 6374 7572 6520 666f 7220 6c69 7468 6f67  cture for lithog
+0000f3c0: 7261 7068 6963 206d 6561 7375 7265 6d65  raphic measureme
+0000f3d0: 6e74 2077 6974 6820 6d61 726b 7320 6f66  nt with marks of
+0000f3e0: 0a20 2020 2076 6172 7969 6e67 2073 6361  .    varying sca
+0000f3f0: 6c65 7320 746f 2061 6c6c 6f77 2066 6f72  les to allow for
+0000f400: 2065 6173 7920 7265 6164 696e 6720 6279   easy reading by
+0000f410: 2065 7965 2e0a 0a20 2020 2050 6172 616d   eye...    Param
+0000f420: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
+0000f430: 2d2d 2d2d 0a20 2020 2068 6569 6768 7420  ----.    height 
+0000f440: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
+0000f450: 4865 6967 6874 206f 6620 7468 6520 7275  Height of the ru
+0000f460: 6c69 6e67 206d 6172 6b73 2e0a 2020 2020  ling marks..    
+0000f470: 7769 6474 6820 3a20 666c 6f61 740a 2020  width : float.  
+0000f480: 2020 2020 2020 5769 6474 6820 6f66 2074        Width of t
+0000f490: 6865 2072 756c 696e 6720 6d61 726b 732e  he ruling marks.
+0000f4a0: 0a20 2020 2073 7061 6369 6e67 203a 2066  .    spacing : f
+0000f4b0: 6c6f 6174 0a20 2020 2020 2020 2043 656e  loat.        Cen
+0000f4c0: 7465 722d 746f 2d63 656e 7465 7220 7370  ter-to-center sp
+0000f4d0: 6163 696e 6720 6f66 2074 6865 2072 756c  acing of the rul
+0000f4e0: 696e 6720 6d61 726b 730a 2020 2020 7363  ing marks.    sc
+0000f4f0: 616c 6520 3a20 6172 7261 792d 6c69 6b65  ale : array-like
+0000f500: 0a20 2020 2020 2020 2048 6569 6768 7420  .        Height 
+0000f510: 7363 616c 6520 7061 7474 6572 6e20 6f66  scale pattern of
+0000f520: 206d 6172 6b73 0a20 2020 206e 756d 5f6d   marks.    num_m
+0000f530: 6172 6b73 203a 2069 6e74 0a20 2020 2020  arks : int.     
+0000f540: 2020 2054 6f74 616c 206e 756d 6265 7220     Total number 
+0000f550: 6f66 206d 6172 6b73 2074 6f20 6765 6e65  of marks to gene
+0000f560: 7261 7465 0a20 2020 206e 756d 5f6d 6172  rate.    num_mar
+0000f570: 6b73 203a 2069 6e74 0a20 2020 2020 2020  ks : int.       
+0000f580: 2054 6f74 616c 206e 756d 6265 7220 6f66   Total number of
+0000f590: 206d 6172 6b73 2074 6f20 6765 6e65 7261   marks to genera
+0000f5a0: 7465 0a20 2020 206c 6179 6572 203a 2069  te.    layer : i
+0000f5b0: 6e74 2c20 6172 7261 792d 6c69 6b65 5b32  nt, array-like[2
+0000f5c0: 5d2c 206f 7220 7365 740a 2020 2020 2020  ], or set.      
+0000f5d0: 2020 5370 6563 6966 6963 206c 6179 6572    Specific layer
+0000f5e0: 2873 2920 746f 2070 7574 2074 6865 2072  (s) to put the r
+0000f5f0: 756c 6572 2067 656f 6d65 7472 7920 6f6e  uler geometry on
+0000f600: 2e0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
+0000f610: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2044     -------.    D
+0000f620: 6576 6963 650a 2020 2020 2020 2020 4120  evice.        A 
+0000f630: 4465 7669 6365 2063 6f6e 7461 696e 696e  Device containin
+0000f640: 6720 7468 6520 7275 6c65 7220 7374 7275  g the ruler stru
+0000f650: 6374 7572 650a 2020 2020 2222 220a 0a20  cture.    """.. 
+0000f660: 2020 2044 203d 2044 6576 6963 6528 226c     D = Device("l
+0000f670: 6974 686f 5f72 756c 6572 2229 0a20 2020  itho_ruler").   
+0000f680: 2066 6f72 206e 2069 6e20 7261 6e67 6528   for n in range(
+0000f690: 6e75 6d5f 6d61 726b 7329 3a0a 2020 2020  num_marks):.    
+0000f6a0: 2020 2020 6820 3d20 6865 6967 6874 202a      h = height *
+0000f6b0: 2073 6361 6c65 5b6e 2025 206c 656e 2873   scale[n % len(s
+0000f6c0: 6361 6c65 295d 0a20 2020 2020 2020 2044  cale)].        D
+0000f6d0: 203c 3c20 7265 6374 616e 676c 6528 7369   << rectangle(si
+0000f6e0: 7a65 3d28 7769 6474 682c 2068 292c 206c  ze=(width, h), l
+0000f6f0: 6179 6572 3d6c 6179 6572 290a 0a20 2020  ayer=layer)..   
+0000f700: 2044 2e64 6973 7472 6962 7574 6528 6469   D.distribute(di
+0000f710: 7265 6374 696f 6e3d 2278 222c 2073 7061  rection="x", spa
+0000f720: 6369 6e67 3d73 7061 6369 6e67 2c20 7365  cing=spacing, se
+0000f730: 7061 7261 7469 6f6e 3d46 616c 7365 2c20  paration=False, 
+0000f740: 6564 6765 3d22 7822 290a 2020 2020 442e  edge="x").    D.
+0000f750: 616c 6967 6e28 616c 6967 6e6d 656e 743d  align(alignment=
+0000f760: 2279 6d69 6e22 290a 2020 2020 442e 666c  "ymin").    D.fl
+0000f770: 6174 7465 6e28 290a 2020 2020 7265 7475  atten().    retu
+0000f780: 726e 2044 0a0a 0a23 203d 3d3d 3d3d 3d3d  rn D...# =======
+0000f790: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000f7a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000f7b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000f7c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000f7d0: 3d3d 3d3d 3d3d 3d0a 230a 2320 5574 696c  =======.#.# Util
+0000f7e0: 6974 7920 6675 6e63 7469 6f6e 730a 230a  ity functions.#.
+0000f7f0: 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  # ==============
+0000f800: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000f810: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000f820: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000f830: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0000f840: 0a0a 0a64 6566 2065 7874 7261 6374 2844  ...def extract(D
+0000f850: 2c20 6c61 7965 7273 3d5b 302c 2031 5d29  , layers=[0, 1])
+0000f860: 3a0a 2020 2020 2222 2245 7874 7261 6374  :.    """Extract
+0000f870: 7320 706f 6c79 676f 6e73 2066 726f 6d20  s polygons from 
+0000f880: 6120 6769 7665 6e20 4465 7669 6365 2e0a  a given Device..
+0000f890: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
+0000f8a0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+0000f8b0: 2020 2044 203a 2044 6576 6963 650a 2020     D : Device.  
+0000f8c0: 2020 2020 2020 4465 7669 6365 2074 6f20        Device to 
+0000f8d0: 6578 7472 6163 7420 706f 6c79 676f 6e73  extract polygons
+0000f8e0: 2066 726f 6d2e 0a20 2020 206c 6179 6572   from..    layer
+0000f8f0: 7320 3a20 6172 7261 792d 6c69 6b65 5b32  s : array-like[2
+0000f900: 5d20 6f72 2073 6574 0a20 2020 2020 2020  ] or set.       
+0000f910: 2053 7065 6369 6669 6320 6c61 7965 7228   Specific layer(
+0000f920: 7329 2074 6f20 6578 7472 6163 7420 706f  s) to extract po
+0000f930: 6c79 676f 6e20 6765 6f6d 6574 7279 2066  lygon geometry f
+0000f940: 726f 6d2e 0a0a 2020 2020 5265 7475 726e  rom...    Return
+0000f950: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
+0000f960: 2020 4465 7669 6365 0a20 2020 2020 2020    Device.       
+0000f970: 2041 2044 6576 6963 6520 636f 6e74 6169   A Device contai
+0000f980: 6e69 6e67 2074 6865 2065 7874 7261 6374  ning the extract
+0000f990: 6564 2070 6f6c 7967 6f6e 732e 0a20 2020  ed polygons..   
+0000f9a0: 2022 2222 0a20 2020 2044 5f65 7874 7261   """.    D_extra
+0000f9b0: 6374 6564 203d 2044 6576 6963 6528 2265  cted = Device("e
+0000f9c0: 7874 7261 6374 2229 0a20 2020 2069 6620  xtract").    if 
+0000f9d0: 6e6f 7420 6973 696e 7374 616e 6365 286c  not isinstance(l
+0000f9e0: 6179 6572 732c 2028 6c69 7374 2c20 7475  ayers, (list, tu
+0000f9f0: 706c 6529 293a 0a20 2020 2020 2020 2072  ple)):.        r
+0000fa00: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+0000fa10: 0a20 2020 2020 2020 2020 2020 2022 5b50  .            "[P
+0000fa20: 4849 444c 5d20 7067 2e65 7874 7261 6374  HIDL] pg.extract
+0000fa30: 2829 2041 7267 756d 656e 7420 606c 6179  () Argument `lay
+0000fa40: 6572 7360 206e 6565 6473 2074 6f20 6265  ers` needs to be
+0000fa50: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
+0000fa60: 7061 7373 6564 2061 206c 6973 7420 6f72  passed a list or
+0000fa70: 2074 7570 6c65 220a 2020 2020 2020 2020   tuple".        
+0000fa80: 290a 2020 2020 706f 6c79 5f64 6963 7420  ).    poly_dict 
+0000fa90: 3d20 442e 6765 745f 706f 6c79 676f 6e73  = D.get_polygons
+0000faa0: 2862 795f 7370 6563 3d54 7275 6529 0a20  (by_spec=True). 
+0000fab0: 2020 2070 6172 7365 645f 6c61 7965 725f     parsed_layer_
+0000fac0: 6c69 7374 203d 205b 5f70 6172 7365 5f6c  list = [_parse_l
+0000fad0: 6179 6572 286c 6179 6572 2920 666f 7220  ayer(layer) for 
+0000fae0: 6c61 7965 7220 696e 206c 6179 6572 735d  layer in layers]
+0000faf0: 0a20 2020 2066 6f72 206c 6179 6572 2c20  .    for layer, 
+0000fb00: 706f 6c79 7320 696e 2070 6f6c 795f 6469  polys in poly_di
+0000fb10: 6374 2e69 7465 6d73 2829 3a0a 2020 2020  ct.items():.    
+0000fb20: 2020 2020 6966 205f 7061 7273 655f 6c61      if _parse_la
+0000fb30: 7965 7228 6c61 7965 7229 2069 6e20 7061  yer(layer) in pa
+0000fb40: 7273 6564 5f6c 6179 6572 5f6c 6973 743a  rsed_layer_list:
+0000fb50: 0a20 2020 2020 2020 2020 2020 2044 5f65  .            D_e
+0000fb60: 7874 7261 6374 6564 2e61 6464 5f70 6f6c  xtracted.add_pol
+0000fb70: 7967 6f6e 2870 6f6c 7973 2c20 6c61 7965  ygon(polys, laye
+0000fb80: 723d 6c61 7965 7229 0a20 2020 2072 6574  r=layer).    ret
+0000fb90: 7572 6e20 445f 6578 7472 6163 7465 640a  urn D_extracted.
+0000fba0: 0a0a 6465 6620 636f 7079 2844 293a 0a20  ..def copy(D):. 
+0000fbb0: 2020 2022 2222 436f 7069 6573 2061 2044     """Copies a D
+0000fbc0: 6576 6963 652e 0a0a 2020 2020 5061 7261  evice...    Para
+0000fbd0: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
+0000fbe0: 2d2d 2d2d 2d0a 2020 2020 4420 3a20 4465  -----.    D : De
+0000fbf0: 7669 6365 0a20 2020 2020 2020 2044 6576  vice.        Dev
+0000fc00: 6963 6520 746f 2062 6520 636f 7069 6564  ice to be copied
+0000fc10: 2e0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
+0000fc20: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2044     -------.    D
+0000fc30: 6576 6963 650a 2020 2020 2020 2020 436f  evice.        Co
+0000fc40: 7069 6564 2044 6576 6963 652e 0a20 2020  pied Device..   
+0000fc50: 2022 2222 0a20 2020 2044 5f63 6f70 7920   """.    D_copy 
+0000fc60: 3d20 4465 7669 6365 286e 616d 653d 442e  = Device(name=D.
+0000fc70: 6e61 6d65 290a 2020 2020 445f 636f 7079  name).    D_copy
+0000fc80: 2e69 6e66 6f20 3d20 7079 7468 6f6e 5f63  .info = python_c
+0000fc90: 6f70 792e 6465 6570 636f 7079 2844 2e69  opy.deepcopy(D.i
+0000fca0: 6e66 6f29 0a20 2020 2066 6f72 2072 6566  nfo).    for ref
+0000fcb0: 2069 6e20 442e 7265 6665 7265 6e63 6573   in D.references
+0000fcc0: 3a0a 2020 2020 2020 2020 6e65 775f 7265  :.        new_re
+0000fcd0: 6620 3d20 4465 7669 6365 5265 6665 7265  f = DeviceRefere
+0000fce0: 6e63 6528 0a20 2020 2020 2020 2020 2020  nce(.           
+0000fcf0: 2064 6576 6963 653d 7265 662e 7061 7265   device=ref.pare
+0000fd00: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
+0000fd10: 6f72 6967 696e 3d72 6566 2e6f 7269 6769  origin=ref.origi
+0000fd20: 6e2c 0a20 2020 2020 2020 2020 2020 2072  n,.            r
+0000fd30: 6f74 6174 696f 6e3d 7265 662e 726f 7461  otation=ref.rota
+0000fd40: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
+0000fd50: 2020 6d61 676e 6966 6963 6174 696f 6e3d    magnification=
+0000fd60: 7265 662e 6d61 676e 6966 6963 6174 696f  ref.magnificatio
+0000fd70: 6e2c 0a20 2020 2020 2020 2020 2020 2078  n,.            x
+0000fd80: 5f72 6566 6c65 6374 696f 6e3d 7265 662e  _reflection=ref.
+0000fd90: 785f 7265 666c 6563 7469 6f6e 2c0a 2020  x_reflection,.  
+0000fda0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000fdb0: 6e65 775f 7265 662e 6f77 6e65 7220 3d20  new_ref.owner = 
+0000fdc0: 445f 636f 7079 0a20 2020 2020 2020 2044  D_copy.        D
+0000fdd0: 5f63 6f70 792e 6164 6428 6e65 775f 7265  _copy.add(new_re
+0000fde0: 6629 0a20 2020 2020 2020 2066 6f72 2061  f).        for a
+0000fdf0: 6c69 6173 5f6e 616d 652c 2061 6c69 6173  lias_name, alias
+0000fe00: 5f72 6566 2069 6e20 442e 616c 6961 7365  _ref in D.aliase
+0000fe10: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
+0000fe20: 2020 2020 2020 2069 6620 616c 6961 735f         if alias_
+0000fe30: 7265 6620 3d3d 2072 6566 3a0a 2020 2020  ref == ref:.    
+0000fe40: 2020 2020 2020 2020 2020 2020 445f 636f              D_co
+0000fe50: 7079 2e61 6c69 6173 6573 5b61 6c69 6173  py.aliases[alias
+0000fe60: 5f6e 616d 655d 203d 206e 6577 5f72 6566  _name] = new_ref
+0000fe70: 0a0a 2020 2020 666f 7220 706f 7274 2069  ..    for port i
+0000fe80: 6e20 442e 706f 7274 732e 7661 6c75 6573  n D.ports.values
+0000fe90: 2829 3a0a 2020 2020 2020 2020 445f 636f  ():.        D_co
+0000fea0: 7079 2e61 6464 5f70 6f72 7428 706f 7274  py.add_port(port
+0000feb0: 3d70 6f72 7429 0a20 2020 2066 6f72 2070  =port).    for p
+0000fec0: 6f6c 7920 696e 2044 2e70 6f6c 7967 6f6e  oly in D.polygon
+0000fed0: 733a 0a20 2020 2020 2020 2044 5f63 6f70  s:.        D_cop
+0000fee0: 792e 6164 645f 706f 6c79 676f 6e28 706f  y.add_polygon(po
+0000fef0: 6c79 290a 2020 2020 666f 7220 6c61 6265  ly).    for labe
+0000ff00: 6c20 696e 2044 2e6c 6162 656c 733a 0a20  l in D.labels:. 
+0000ff10: 2020 2020 2020 2044 5f63 6f70 792e 6164         D_copy.ad
+0000ff20: 645f 6c61 6265 6c28 0a20 2020 2020 2020  d_label(.       
+0000ff30: 2020 2020 2074 6578 743d 6c61 6265 6c2e       text=label.
+0000ff40: 7465 7874 2c0a 2020 2020 2020 2020 2020  text,.          
+0000ff50: 2020 706f 7369 7469 6f6e 3d6c 6162 656c    position=label
+0000ff60: 2e70 6f73 6974 696f 6e2c 0a20 2020 2020  .position,.     
+0000ff70: 2020 2020 2020 206c 6179 6572 3d28 6c61         layer=(la
+0000ff80: 6265 6c2e 6c61 7965 722c 206c 6162 656c  bel.layer, label
+0000ff90: 2e74 6578 7474 7970 6529 2c0a 2020 2020  .texttype),.    
+0000ffa0: 2020 2020 290a 2020 2020 7265 7475 726e      ).    return
+0000ffb0: 2044 5f63 6f70 790a 0a0a 6465 6620 6465   D_copy...def de
+0000ffc0: 6570 636f 7079 2844 293a 0a20 2020 2022  epcopy(D):.    "
+0000ffd0: 2222 4465 6570 2063 6f70 6965 7320 6120  ""Deep copies a 
+0000ffe0: 4465 7669 6365 2e0a 0a20 2020 2050 6172  Device...    Par
+0000fff0: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+00010000: 2d2d 2d2d 2d2d 0a20 2020 2044 203a 2044  ------.    D : D
+00010010: 6576 6963 650a 2020 2020 2020 2020 4465  evice.        De
+00010020: 7669 6365 2074 6f20 6265 2064 6565 7020  vice to be deep 
+00010030: 636f 7069 6564 2e0a 0a20 2020 2052 6574  copied...    Ret
+00010040: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
+00010050: 0a20 2020 2044 6576 6963 650a 2020 2020  .    Device.    
+00010060: 2020 2020 4465 6570 2063 6f70 6965 6420      Deep copied 
+00010070: 4465 7669 6365 2e0a 2020 2020 2222 220a  Device..    """.
+00010080: 2020 2020 445f 636f 7079 203d 2070 7974      D_copy = pyt
+00010090: 686f 6e5f 636f 7079 2e64 6565 7063 6f70  hon_copy.deepcop
+000100a0: 7928 4429 0a20 2020 2044 5f63 6f70 792e  y(D).    D_copy.
+000100b0: 7569 6420 3d20 4465 7669 6365 2e5f 6e65  uid = Device._ne
+000100c0: 7874 5f75 6964 0a20 2020 2044 6576 6963  xt_uid.    Devic
+000100d0: 652e 5f6e 6578 745f 7569 6420 2b3d 2031  e._next_uid += 1
+000100e0: 0a20 2020 2044 5f63 6f70 792e 6e61 6d65  .    D_copy.name
+000100f0: 203d 2044 2e6e 616d 650a 2020 2020 2320   = D.name.    # 
+00010100: 4d61 6b65 2073 7572 6520 5f62 625f 7661  Make sure _bb_va
+00010110: 6c69 6420 6973 2073 6574 2074 6f20 6661  lid is set to fa
+00010120: 6c73 6520 666f 7220 7468 6573 6520 6e65  lse for these ne
+00010130: 7720 6f62 6a65 6374 7320 736f 206e 6577  w objects so new
+00010140: 0a20 2020 2023 2062 6f75 6e64 696e 6720  .    # bounding 
+00010150: 626f 7865 7320 6172 6520 6372 6561 7465  boxes are create
+00010160: 6420 696e 2074 6865 2063 6163 6865 0a20  d in the cache. 
+00010170: 2020 2066 6f72 2044 2069 6e20 445f 636f     for D in D_co
+00010180: 7079 2e67 6574 5f64 6570 656e 6465 6e63  py.get_dependenc
+00010190: 6965 7328 5472 7565 293a 0a20 2020 2020  ies(True):.     
+000101a0: 2020 2044 2e5f 6262 5f76 616c 6964 203d     D._bb_valid =
+000101b0: 2046 616c 7365 0a20 2020 2044 5f63 6f70   False.    D_cop
+000101c0: 792e 5f62 625f 7661 6c69 6420 3d20 4661  y._bb_valid = Fa
+000101d0: 6c73 650a 0a20 2020 2072 6574 7572 6e20  lse..    return 
+000101e0: 445f 636f 7079 0a0a 0a64 6566 2063 6f70  D_copy...def cop
+000101f0: 795f 6c61 7965 7228 442c 206c 6179 6572  y_layer(D, layer
+00010200: 3d31 2c20 6e65 775f 6c61 7965 723d 3229  =1, new_layer=2)
+00010210: 3a0a 2020 2020 2222 2243 6f70 6965 7320  :.    """Copies 
+00010220: 6120 6c61 7965 7220 7769 7468 696e 2061  a layer within a
+00010230: 2044 6576 6963 6520 746f 2061 6e6f 7468   Device to anoth
+00010240: 6572 206c 6179 6572 2069 6e20 7468 6520  er layer in the 
+00010250: 7361 6d65 2044 6576 6963 652e 0a0a 2020  same Device...  
+00010260: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00010270: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00010280: 4420 3a20 4465 7669 6365 0a20 2020 2020  D : Device.     
+00010290: 2020 2044 6576 6963 6520 636f 6e74 6169     Device contai
+000102a0: 6e69 6e67 206c 6179 6572 2074 6f20 6265  ning layer to be
+000102b0: 2063 6f70 6965 642e 0a20 2020 206c 6179   copied..    lay
+000102c0: 6572 203a 2069 6e74 2c20 6172 7261 792d  er : int, array-
+000102d0: 6c69 6b65 5b32 5d2c 206f 7220 7365 740a  like[2], or set.
+000102e0: 2020 2020 2020 2020 5370 6563 6966 6963          Specific
+000102f0: 206c 6179 6572 2873 2920 746f 2063 6f70   layer(s) to cop
+00010300: 792e 0a20 2020 206e 6577 5f6c 6179 6572  y..    new_layer
+00010310: 203a 2069 6e74 2c20 6172 7261 792d 6c69   : int, array-li
+00010320: 6b65 5b32 5d2c 206f 7220 7365 740a 2020  ke[2], or set.  
+00010330: 2020 2020 2020 5370 6563 6966 6963 206c        Specific l
+00010340: 6179 6572 2873 2920 746f 2070 7574 2063  ayer(s) to put c
+00010350: 6f70 6965 6420 6c61 7965 7220 6f6e 2e0a  opied layer on..
+00010360: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
+00010370: 202d 2d2d 2d2d 2d2d 0a20 2020 2044 6576   -------.    Dev
+00010380: 6963 650a 2020 2020 2020 2020 4120 4465  ice.        A De
+00010390: 7669 6365 2063 6f6e 7461 696e 696e 6720  vice containing 
+000103a0: 7468 6520 6f72 6967 696e 616c 2061 6e64  the original and
+000103b0: 2063 6f70 6965 6420 6c61 7965 7273 2e0a   copied layers..
+000103c0: 2020 2020 2222 220a 2020 2020 445f 636f      """.    D_co
+000103d0: 7069 6564 5f6c 6179 6572 203d 2065 7874  pied_layer = ext
+000103e0: 7261 6374 2844 2c20 6c61 7965 7273 3d5b  ract(D, layers=[
+000103f0: 6c61 7965 725d 290a 2020 2020 445f 636f  layer]).    D_co
+00010400: 7069 6564 5f6c 6179 6572 2e66 6c61 7474  pied_layer.flatt
+00010410: 656e 2873 696e 676c 655f 6c61 7965 723d  en(single_layer=
+00010420: 6e65 775f 6c61 7965 7229 0a20 2020 2072  new_layer).    r
+00010430: 6574 7572 6e20 445f 636f 7069 6564 5f6c  eturn D_copied_l
+00010440: 6179 6572 0a0a 0a64 6566 2069 6d70 6f72  ayer...def impor
+00010450: 745f 6764 7328 6669 6c65 6e61 6d65 2c20  t_gds(filename, 
+00010460: 6365 6c6c 6e61 6d65 3d4e 6f6e 652c 2066  cellname=None, f
+00010470: 6c61 7474 656e 3d46 616c 7365 293a 0a20  latten=False):. 
+00010480: 2020 2022 2222 496d 706f 7274 7320 6120     """Imports a 
+00010490: 4744 5320 6669 6c65 2061 6e64 2072 6574  GDS file and ret
+000104a0: 7572 6e73 2061 2044 6576 6963 6520 7769  urns a Device wi
+000104b0: 7468 2061 6c6c 2074 6865 2063 6f72 7265  th all the corre
+000104c0: 7370 6f6e 6469 6e67 0a20 2020 2067 656f  sponding.    geo
+000104d0: 6d65 7472 790a 0a20 2020 2050 6172 616d  metry..    Param
+000104e0: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
+000104f0: 2d2d 2d2d 0a20 2020 2066 696c 656e 616d  ----.    filenam
+00010500: 6520 3a20 7374 720a 2020 2020 2020 2020  e : str.        
+00010510: 5061 7468 206f 7220 6e61 6d65 206f 6620  Path or name of 
+00010520: 6669 6c65 2074 6f20 6265 2069 6d70 6f72  file to be impor
+00010530: 7465 640a 2020 2020 6365 6c6c 6e61 6d65  ted.    cellname
+00010540: 203a 2073 7472 206f 7220 4e6f 6e65 0a20   : str or None. 
+00010550: 2020 2020 2020 204e 616d 6520 6f66 2074         Name of t
+00010560: 6865 2063 656c 6c20 7468 6174 2077 696c  he cell that wil
+00010570: 6c20 6265 2072 6574 7572 6e65 6420 6173  l be returned as
+00010580: 2061 2044 6576 6963 652e 2020 4966 204e   a Device.  If N
+00010590: 6f6e 652c 0a20 2020 2020 2020 2077 696c  one,.        wil
+000105a0: 6c20 6175 746f 6d61 7469 6361 6c6c 7920  l automatically 
+000105b0: 7365 6c65 6374 2074 6865 2074 6f70 6d6f  select the topmo
+000105c0: 7374 2063 656c 6c0a 2020 2020 666c 6174  st cell.    flat
+000105d0: 7465 6e20 3a20 626f 6f6c 0a20 2020 2020  ten : bool.     
+000105e0: 2020 2057 6865 7468 6572 2074 6f20 666c     Whether to fl
+000105f0: 6174 7465 6e20 7468 6520 696d 706f 7274  atten the import
+00010600: 6564 2067 656f 6d65 7472 792c 2072 656d  ed geometry, rem
+00010610: 6f76 696e 6720 616c 6c20 6365 6c6c 2068  oving all cell h
+00010620: 6569 7261 7263 6879 0a0a 2020 2020 5265  eirarchy..    Re
+00010630: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00010640: 2d0a 2020 2020 4465 7669 6365 0a20 2020  -.    Device.   
+00010650: 2020 2020 2041 2050 4849 444c 2044 6576       A PHIDL Dev
+00010660: 6963 6520 7769 7468 2061 6c6c 2074 6865  ice with all the
+00010670: 2067 656f 6d65 7472 792f 6c61 6265 6c73   geometry/labels
+00010680: 2f65 7463 2069 6d70 6f72 7465 6420 6672  /etc imported fr
+00010690: 6f6d 2074 6865 2047 4453 2066 696c 650a  om the GDS file.
+000106a0: 0a20 2020 2022 2222 0a20 2020 2067 6473  .    """.    gds
+000106b0: 6969 5f6c 6962 203d 2067 6473 7079 2e47  ii_lib = gdspy.G
+000106c0: 6473 4c69 6272 6172 7928 290a 2020 2020  dsLibrary().    
+000106d0: 6764 7369 695f 6c69 622e 7265 6164 5f67  gdsii_lib.read_g
+000106e0: 6473 2866 696c 656e 616d 6529 0a20 2020  ds(filename).   
+000106f0: 2074 6f70 5f6c 6576 656c 5f63 656c 6c73   top_level_cells
+00010700: 203d 2067 6473 6969 5f6c 6962 2e74 6f70   = gdsii_lib.top
+00010710: 5f6c 6576 656c 2829 0a20 2020 2069 6620  _level().    if 
+00010720: 6365 6c6c 6e61 6d65 2069 7320 6e6f 7420  cellname is not 
+00010730: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
+00010740: 2063 656c 6c6e 616d 6520 6e6f 7420 696e   cellname not in
+00010750: 2067 6473 6969 5f6c 6962 2e63 656c 6c73   gdsii_lib.cells
+00010760: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00010770: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+00010780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010790: 225b 5048 4944 4c5d 2069 6d70 6f72 745f  "[PHIDL] import_
+000107a0: 6764 7328 2920 5468 6520 7265 7175 6573  gds() The reques
+000107b0: 7465 6420 6365 6c6c 2022 0a20 2020 2020  ted cell ".     
+000107c0: 2020 2020 2020 2020 2020 2022 286e 616d             "(nam
+000107d0: 6564 2025 7329 2069 7320 6e6f 7420 7072  ed %s) is not pr
+000107e0: 6573 656e 7420 696e 2066 696c 6520 2573  esent in file %s
+000107f0: 2220 2520 2863 656c 6c6e 616d 652c 2066  " % (cellname, f
+00010800: 696c 656e 616d 6529 0a20 2020 2020 2020  ilename).       
+00010810: 2020 2020 2029 0a20 2020 2020 2020 2074       ).        t
+00010820: 6f70 6365 6c6c 203d 2067 6473 6969 5f6c  opcell = gdsii_l
+00010830: 6962 2e63 656c 6c73 5b63 656c 6c6e 616d  ib.cells[cellnam
+00010840: 655d 0a20 2020 2065 6c69 6620 6365 6c6c  e].    elif cell
+00010850: 6e61 6d65 2069 7320 4e6f 6e65 2061 6e64  name is None and
+00010860: 206c 656e 2874 6f70 5f6c 6576 656c 5f63   len(top_level_c
+00010870: 656c 6c73 2920 3d3d 2031 3a0a 2020 2020  ells) == 1:.    
+00010880: 2020 2020 746f 7063 656c 6c20 3d20 746f      topcell = to
+00010890: 705f 6c65 7665 6c5f 6365 6c6c 735b 305d  p_level_cells[0]
+000108a0: 0a20 2020 2065 6c69 6620 6365 6c6c 6e61  .    elif cellna
+000108b0: 6d65 2069 7320 4e6f 6e65 2061 6e64 206c  me is None and l
+000108c0: 656e 2874 6f70 5f6c 6576 656c 5f63 656c  en(top_level_cel
+000108d0: 6c73 2920 3e20 313a 0a20 2020 2020 2020  ls) > 1:.       
+000108e0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+000108f0: 7228 0a20 2020 2020 2020 2020 2020 2022  r(.            "
+00010900: 5b50 4849 444c 5d20 696d 706f 7274 5f67  [PHIDL] import_g
+00010910: 6473 2829 2054 6865 7265 2061 7265 206d  ds() There are m
+00010920: 756c 7469 706c 6520 746f 702d 6c65 7665  ultiple top-leve
+00010930: 6c20 220a 2020 2020 2020 2020 2020 2020  l ".            
+00010940: 2263 656c 6c73 2c20 796f 7520 6d75 7374  "cells, you must
+00010950: 2073 7065 6369 6679 2060 6365 6c6c 6e61   specify `cellna
+00010960: 6d65 6020 746f 2073 656c 6563 7420 6f66  me` to select of
+00010970: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
+00010980: 6f6e 6520 6f66 2074 6865 6d22 0a20 2020  one of them".   
+00010990: 2020 2020 2029 0a0a 2020 2020 6966 206e       )..    if n
+000109a0: 6f74 2066 6c61 7474 656e 3a0a 2020 2020  ot flatten:.    
+000109b0: 2020 2020 445f 6c69 7374 203d 205b 5d0a      D_list = [].
+000109c0: 2020 2020 2020 2020 6332 646d 6170 203d          c2dmap =
+000109d0: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
+000109e0: 6365 6c6c 2069 6e20 6764 7369 695f 6c69  cell in gdsii_li
+000109f0: 622e 6365 6c6c 732e 7661 6c75 6573 2829  b.cells.values()
+00010a00: 3a0a 2020 2020 2020 2020 2020 2020 4420  :.            D 
+00010a10: 3d20 4465 7669 6365 286e 616d 653d 6365  = Device(name=ce
+00010a20: 6c6c 2e6e 616d 6529 0a20 2020 2020 2020  ll.name).       
+00010a30: 2020 2020 2044 2e70 6f6c 7967 6f6e 7320       D.polygons 
+00010a40: 3d20 6365 6c6c 2e70 6f6c 7967 6f6e 730a  = cell.polygons.
+00010a50: 2020 2020 2020 2020 2020 2020 442e 7265              D.re
+00010a60: 6665 7265 6e63 6573 203d 2063 656c 6c2e  ferences = cell.
+00010a70: 7265 6665 7265 6e63 6573 0a20 2020 2020  references.     
+00010a80: 2020 2020 2020 2044 2e6e 616d 6520 3d20         D.name = 
+00010a90: 6365 6c6c 2e6e 616d 650a 2020 2020 2020  cell.name.      
+00010aa0: 2020 2020 2020 442e 7061 7468 7320 3d20        D.paths = 
+00010ab0: 6365 6c6c 2e70 6174 6873 0a20 2020 2020  cell.paths.     
+00010ac0: 2020 2020 2020 2066 6f72 206c 6162 656c         for label
+00010ad0: 2069 6e20 6365 6c6c 2e6c 6162 656c 733a   in cell.labels:
+00010ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010af0: 2072 6f74 6174 696f 6e20 3d20 6c61 6265   rotation = labe
+00010b00: 6c2e 726f 7461 7469 6f6e 0a20 2020 2020  l.rotation.     
+00010b10: 2020 2020 2020 2020 2020 2069 6620 726f             if ro
+00010b20: 7461 7469 6f6e 2069 7320 4e6f 6e65 3a0a  tation is None:.
+00010b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b40: 2020 2020 726f 7461 7469 6f6e 203d 2030      rotation = 0
+00010b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010b60: 206c 203d 2044 2e61 6464 5f6c 6162 656c   l = D.add_label
+00010b70: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00010b80: 2020 2020 2020 7465 7874 3d6c 6162 656c        text=label
+00010b90: 2e74 6578 742c 0a20 2020 2020 2020 2020  .text,.         
+00010ba0: 2020 2020 2020 2020 2020 2070 6f73 6974             posit
+00010bb0: 696f 6e3d 6e70 2e61 7366 6172 7261 7928  ion=np.asfarray(
+00010bc0: 6c61 6265 6c2e 706f 7369 7469 6f6e 292c  label.position),
+00010bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010be0: 2020 2020 206d 6167 6e69 6669 6361 7469       magnificati
+00010bf0: 6f6e 3d6c 6162 656c 2e6d 6167 6e69 6669  on=label.magnifi
+00010c00: 6361 7469 6f6e 2c0a 2020 2020 2020 2020  cation,.        
+00010c10: 2020 2020 2020 2020 2020 2020 726f 7461              rota
+00010c20: 7469 6f6e 3d72 6f74 6174 696f 6e20 2a20  tion=rotation * 
+00010c30: 3138 3020 2f20 6e70 2e70 692c 0a20 2020  180 / np.pi,.   
+00010c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c50: 206c 6179 6572 3d28 6c61 6265 6c2e 6c61   layer=(label.la
+00010c60: 7965 722c 206c 6162 656c 2e74 6578 7474  yer, label.textt
+00010c70: 7970 6529 2c0a 2020 2020 2020 2020 2020  ype),.          
+00010c80: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00010c90: 2020 2020 2020 2020 6c2e 616e 6368 6f72          l.anchor
+00010ca0: 203d 206c 6162 656c 2e61 6e63 686f 720a   = label.anchor.
+00010cb0: 2020 2020 2020 2020 2020 2020 6332 646d              c2dm
+00010cc0: 6170 5b63 656c 6c5d 203d 2044 0a20 2020  ap[cell] = D.   
+00010cd0: 2020 2020 2020 2020 2044 5f6c 6973 742e           D_list.
+00010ce0: 6170 7065 6e64 2844 290a 0a20 2020 2020  append(D)..     
+00010cf0: 2020 2066 6f72 2044 2069 6e20 445f 6c69     for D in D_li
+00010d00: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
+00010d10: 2320 4669 7273 7420 636f 6e76 6572 7420  # First convert 
+00010d20: 6561 6368 2072 6566 6572 656e 6365 2073  each reference s
+00010d30: 6f20 6974 2070 6f69 6e74 7320 746f 2074  o it points to t
+00010d40: 6865 2072 6967 6874 2044 6576 6963 650a  he right Device.
+00010d50: 2020 2020 2020 2020 2020 2020 636f 6e76              conv
+00010d60: 6572 7465 645f 7265 6665 7265 6e63 6573  erted_references
+00010d70: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+00010d80: 2020 666f 7220 6520 696e 2044 2e72 6566    for e in D.ref
+00010d90: 6572 656e 6365 733a 0a20 2020 2020 2020  erences:.       
+00010da0: 2020 2020 2020 2020 2072 6566 5f64 6576           ref_dev
+00010db0: 6963 6520 3d20 6332 646d 6170 5b65 2e72  ice = c2dmap[e.r
+00010dc0: 6566 5f63 656c 6c5d 0a20 2020 2020 2020  ef_cell].       
+00010dd0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+00010de0: 7374 616e 6365 2865 2c20 6764 7370 792e  stance(e, gdspy.
+00010df0: 4365 6c6c 5265 6665 7265 6e63 6529 3a0a  CellReference):.
+00010e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e10: 2020 2020 6472 203d 2044 6576 6963 6552      dr = DeviceR
+00010e20: 6566 6572 656e 6365 280a 2020 2020 2020  eference(.      
+00010e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e40: 2020 6465 7669 6365 3d72 6566 5f64 6576    device=ref_dev
+00010e50: 6963 652c 0a20 2020 2020 2020 2020 2020  ice,.           
+00010e60: 2020 2020 2020 2020 2020 2020 206f 7269               ori
+00010e70: 6769 6e3d 652e 6f72 6967 696e 2c0a 2020  gin=e.origin,.  
+00010e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e90: 2020 2020 2020 726f 7461 7469 6f6e 3d65        rotation=e
+00010ea0: 2e72 6f74 6174 696f 6e2c 0a20 2020 2020  .rotation,.     
+00010eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ec0: 2020 206d 6167 6e69 6669 6361 7469 6f6e     magnification
+00010ed0: 3d65 2e6d 6167 6e69 6669 6361 7469 6f6e  =e.magnification
+00010ee0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010ef0: 2020 2020 2020 2020 2020 785f 7265 666c            x_refl
+00010f00: 6563 7469 6f6e 3d65 2e78 5f72 6566 6c65  ection=e.x_refle
+00010f10: 6374 696f 6e2c 0a20 2020 2020 2020 2020  ction,.         
+00010f20: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00010f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f40: 2064 722e 7072 6f70 6572 7469 6573 203d   dr.properties =
+00010f50: 2065 2e70 726f 7065 7274 6965 730a 2020   e.properties.  
+00010f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f70: 2020 6472 2e6f 776e 6572 203d 2044 0a20    dr.owner = D. 
+00010f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f90: 2020 2063 6f6e 7665 7274 6564 5f72 6566     converted_ref
+00010fa0: 6572 656e 6365 732e 6170 7065 6e64 2864  erences.append(d
+00010fb0: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
+00010fc0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+00010fd0: 6365 2865 2c20 6764 7370 792e 4365 6c6c  ce(e, gdspy.Cell
+00010fe0: 4172 7261 7929 3a0a 2020 2020 2020 2020  Array):.        
+00010ff0: 2020 2020 2020 2020 2020 2020 6472 203d              dr =
+00011000: 2043 656c 6c41 7272 6179 280a 2020 2020   CellArray(.    
+00011010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011020: 2020 2020 6465 7669 6365 3d72 6566 5f64      device=ref_d
+00011030: 6576 6963 652c 0a20 2020 2020 2020 2020  evice,.         
+00011040: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00011050: 6f6c 756d 6e73 3d65 2e63 6f6c 756d 6e73  olumns=e.columns
+00011060: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00011070: 2020 2020 2020 2020 2020 726f 7773 3d65            rows=e
+00011080: 2e72 6f77 732c 0a20 2020 2020 2020 2020  .rows,.         
+00011090: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000110a0: 7061 6369 6e67 3d65 2e73 7061 6369 6e67  pacing=e.spacing
+000110b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000110c0: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
+000110d0: 3d65 2e6f 7269 6769 6e2c 0a20 2020 2020  =e.origin,.     
+000110e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000110f0: 2020 2072 6f74 6174 696f 6e3d 652e 726f     rotation=e.ro
+00011100: 7461 7469 6f6e 2c0a 2020 2020 2020 2020  tation,.        
+00011110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011120: 6d61 676e 6966 6963 6174 696f 6e3d 652e  magnification=e.
+00011130: 6d61 676e 6966 6963 6174 696f 6e2c 0a20  magnification,. 
+00011140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011150: 2020 2020 2020 2078 5f72 6566 6c65 6374         x_reflect
+00011160: 696f 6e3d 652e 785f 7265 666c 6563 7469  ion=e.x_reflecti
+00011170: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+00011180: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00011190: 2020 2020 2020 2020 2020 2020 2020 6472                dr
+000111a0: 2e6f 776e 6572 203d 2044 0a20 2020 2020  .owner = D.     
+000111b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000111c0: 6f6e 7665 7274 6564 5f72 6566 6572 656e  onverted_referen
+000111d0: 6365 732e 6170 7065 6e64 2864 7229 0a20  ces.append(dr). 
+000111e0: 2020 2020 2020 2020 2020 2044 2e72 6566             D.ref
+000111f0: 6572 656e 6365 7320 3d20 636f 6e76 6572  erences = conver
+00011200: 7465 645f 7265 6665 7265 6e63 6573 0a20  ted_references. 
+00011210: 2020 2020 2020 2020 2020 2023 204e 6578             # Nex
+00011220: 7420 636f 6e76 6572 7420 6561 6368 2050  t convert each P
+00011230: 6f6c 7967 6f6e 0a20 2020 2020 2020 2020  olygon.         
+00011240: 2020 2074 656d 705f 706f 6c79 676f 6e73     temp_polygons
+00011250: 203d 206c 6973 7428 442e 706f 6c79 676f   = list(D.polygo
+00011260: 6e73 290a 2020 2020 2020 2020 2020 2020  ns).            
+00011270: 442e 706f 6c79 676f 6e73 203d 205b 5d0a  D.polygons = [].
+00011280: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00011290: 7020 696e 2074 656d 705f 706f 6c79 676f  p in temp_polygo
+000112a0: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+000112b0: 2020 2020 442e 6164 645f 706f 6c79 676f      D.add_polygo
+000112c0: 6e28 7029 0a0a 2020 2020 2020 2020 746f  n(p)..        to
+000112d0: 7064 6576 6963 6520 3d20 6332 646d 6170  pdevice = c2dmap
+000112e0: 5b74 6f70 6365 6c6c 5d0a 2020 2020 2020  [topcell].      
+000112f0: 2020 7265 7475 726e 2074 6f70 6465 7669    return topdevi
+00011300: 6365 0a0a 2020 2020 656c 6966 2066 6c61  ce..    elif fla
+00011310: 7474 656e 3a0a 2020 2020 2020 2020 4420  tten:.        D 
+00011320: 3d20 4465 7669 6365 2822 696d 706f 7274  = Device("import
+00011330: 5f67 6473 2229 0a20 2020 2020 2020 2070  _gds").        p
+00011340: 6f6c 7967 6f6e 7320 3d20 746f 7063 656c  olygons = topcel
+00011350: 6c2e 6765 745f 706f 6c79 676f 6e73 2862  l.get_polygons(b
+00011360: 795f 7370 6563 3d54 7275 6529 0a0a 2020  y_spec=True)..  
+00011370: 2020 2020 2020 666f 7220 6c61 7965 725f        for layer_
+00011380: 696e 5f67 6473 2c20 706f 6c79 7320 696e  in_gds, polys in
+00011390: 2070 6f6c 7967 6f6e 732e 6974 656d 7328   polygons.items(
+000113a0: 293a 0a20 2020 2020 2020 2020 2020 2044  ):.            D
+000113b0: 2e61 6464 5f70 6f6c 7967 6f6e 2870 6f6c  .add_polygon(pol
+000113c0: 7973 2c20 6c61 7965 723d 6c61 7965 725f  ys, layer=layer_
+000113d0: 696e 5f67 6473 290a 2020 2020 2020 2020  in_gds).        
+000113e0: 7265 7475 726e 2044 0a0a 0a64 6566 205f  return D...def _
+000113f0: 7472 616e 736c 6174 655f 6365 6c6c 2863  translate_cell(c
+00011400: 293a 0a20 2020 2044 203d 2044 6576 6963  ):.    D = Devic
+00011410: 6528 6e61 6d65 3d63 2e6e 616d 6529 0a20  e(name=c.name). 
+00011420: 2020 2066 6f72 2065 2069 6e20 632e 656c     for e in c.el
+00011430: 656d 656e 7473 3a0a 2020 2020 2020 2020  ements:.        
+00011440: 6966 2069 7369 6e73 7461 6e63 6528 652c  if isinstance(e,
+00011450: 2067 6473 7079 2e50 6f6c 7967 6f6e 5365   gdspy.PolygonSe
+00011460: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+00011470: 666f 7220 6e2c 2070 6f69 6e74 7320 696e  for n, points in
+00011480: 2065 6e75 6d65 7261 7465 2865 2e70 6f6c   enumerate(e.pol
+00011490: 7967 6f6e 7329 3a0a 2020 2020 2020 2020  ygons):.        
+000114a0: 2020 2020 2020 2020 706f 6c79 676f 6e5f          polygon_
+000114b0: 6c61 7965 7220 3d20 5f70 6172 7365 5f6c  layer = _parse_l
+000114c0: 6179 6572 2828 652e 6c61 7965 7273 5b6e  ayer((e.layers[n
+000114d0: 5d2c 2065 2e64 6174 6174 7970 6573 5b6e  ], e.datatypes[n
+000114e0: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
+000114f0: 2020 2020 442e 6164 645f 706f 6c79 676f      D.add_polygo
+00011500: 6e28 706f 696e 7473 3d70 6f69 6e74 732c  n(points=points,
+00011510: 206c 6179 6572 3d70 6f6c 7967 6f6e 5f6c   layer=polygon_l
+00011520: 6179 6572 290a 2020 2020 2020 2020 656c  ayer).        el
+00011530: 6966 2069 7369 6e73 7461 6e63 6528 652c  if isinstance(e,
+00011540: 2067 6473 7079 2e43 656c 6c52 6566 6572   gdspy.CellRefer
+00011550: 656e 6365 293a 0a20 2020 2020 2020 2020  ence):.         
+00011560: 2020 2064 7220 3d20 4465 7669 6365 5265     dr = DeviceRe
+00011570: 6665 7265 6e63 6528 0a20 2020 2020 2020  ference(.       
+00011580: 2020 2020 2020 2020 2064 6576 6963 653d           device=
+00011590: 5f74 7261 6e73 6c61 7465 5f63 656c 6c28  _translate_cell(
+000115a0: 652e 7265 665f 6365 6c6c 292c 0a20 2020  e.ref_cell),.   
+000115b0: 2020 2020 2020 2020 2020 2020 206f 7269               ori
+000115c0: 6769 6e3d 652e 6f72 6967 696e 2c0a 2020  gin=e.origin,.  
+000115d0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+000115e0: 7461 7469 6f6e 3d65 2e72 6f74 6174 696f  tation=e.rotatio
+000115f0: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+00011600: 2020 206d 6167 6e69 6669 6361 7469 6f6e     magnification
+00011610: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
+00011620: 2020 2020 2020 2078 5f72 6566 6c65 6374         x_reflect
+00011630: 696f 6e3d 652e 785f 7265 666c 6563 7469  ion=e.x_reflecti
+00011640: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+00011650: 290a 2020 2020 2020 2020 2020 2020 442e  ).            D.
+00011660: 656c 656d 656e 7473 2e61 7070 656e 6428  elements.append(
+00011670: 6472 290a 2020 2020 442e 6c61 6265 6c73  dr).    D.labels
+00011680: 203d 2063 2e6c 6162 656c 730a 2020 2020   = c.labels.    
+00011690: 7265 7475 726e 2044 0a0a 0a64 6566 2070  return D...def p
+000116a0: 7265 7669 6577 5f6c 6179 6572 7365 7428  review_layerset(
+000116b0: 6c73 2c20 7369 7a65 3d31 3030 2c20 7370  ls, size=100, sp
+000116c0: 6163 696e 673d 3130 3029 3a0a 2020 2020  acing=100):.    
+000116d0: 2222 2247 656e 6572 6174 6573 2061 2070  """Generates a p
+000116e0: 7265 7669 6577 2044 6576 6963 6520 7769  review Device wi
+000116f0: 7468 2072 6570 7265 7365 6e74 6174 696f  th representatio
+00011700: 6e73 206f 6620 616c 6c20 7468 6520 6c61  ns of all the la
+00011710: 7965 7273 2c0a 2020 2020 7573 6564 2066  yers,.    used f
+00011720: 6f72 2070 7265 7669 6577 696e 6720 4c61  or previewing La
+00011730: 7965 7253 6574 2063 6f6c 6f72 2073 6368  yerSet color sch
+00011740: 656d 6573 2069 6e20 7175 6963 6b70 6c6f  emes in quickplo
+00011750: 7420 6f72 2073 6176 6564 202e 6764 730a  t or saved .gds.
+00011760: 2020 2020 6669 6c65 732e 0a0a 2020 2020      files...    
+00011770: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+00011780: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6c73  ---------.    ls
+00011790: 203a 204c 6179 6572 5365 740a 2020 2020   : LayerSet.    
+000117a0: 2020 2020 5365 7420 6f66 206c 6179 6572      Set of layer
+000117b0: 7320 746f 2070 7265 7669 6577 2063 6f6c  s to preview col
+000117c0: 6f72 2073 6368 656d 6573 2e0a 2020 2020  or schemes..    
+000117d0: 7369 7a65 203a 2069 6e74 206f 7220 666c  size : int or fl
+000117e0: 6f61 740a 2020 2020 2020 2020 5265 7369  oat.        Resi
+000117f0: 7a69 6e67 2066 6163 746f 7220 666f 7220  zing factor for 
+00011800: 7468 6520 7072 6576 6965 7720 4465 7669  the preview Devi
+00011810: 6365 2e0a 2020 2020 7370 6163 696e 6720  ce..    spacing 
+00011820: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
+00011830: 2020 2020 2020 2054 6865 2073 7061 6365         The space
+00011840: 2062 6574 7765 656e 2065 6163 6820 6c61   between each la
+00011850: 7965 7220 7265 7072 6573 656e 7461 7469  yer representati
+00011860: 6f6e 2e0a 0a20 2020 2052 6574 7572 6e73  on...    Returns
+00011870: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
+00011880: 2044 203a 2044 6576 6963 650a 2020 2020   D : Device.    
+00011890: 2020 2020 4120 4465 7669 6365 2063 6f6e      A Device con
+000118a0: 7461 696e 696e 6720 6120 7265 7072 6573  taining a repres
+000118b0: 656e 7461 7469 6f6e 206f 6620 616c 6c20  entation of all 
+000118c0: 7468 6520 6c61 7965 7273 2069 6e20 7468  the layers in th
+000118d0: 6520 696e 7075 740a 2020 2020 2020 2020  e input.        
+000118e0: 4c61 7965 7253 6574 2e0a 2020 2020 2222  LayerSet..    ""
+000118f0: 220a 0a20 2020 2044 203d 2044 6576 6963  "..    D = Devic
+00011900: 6528 226c 6179 6572 7365 7422 290a 2020  e("layerset").  
+00011910: 2020 7363 616c 6520 3d20 7369 7a65 202f    scale = size /
+00011920: 2031 3030 0a20 2020 206e 756d 5f6c 6179   100.    num_lay
+00011930: 6572 7320 3d20 6c65 6e28 6c73 2e5f 6c61  ers = len(ls._la
+00011940: 7965 7273 290a 2020 2020 6d61 7472 6978  yers).    matrix
+00011950: 5f73 697a 6520 3d20 696e 7428 6e70 2e63  _size = int(np.c
+00011960: 6569 6c28 6e70 2e73 7172 7428 6e75 6d5f  eil(np.sqrt(num_
+00011970: 6c61 7965 7273 2929 290a 2020 2020 736f  layers))).    so
+00011980: 7274 6564 5f6c 6179 6572 7320 3d20 736f  rted_layers = so
+00011990: 7274 6564 280a 2020 2020 2020 2020 6c73  rted(.        ls
+000119a0: 2e5f 6c61 7965 7273 2e76 616c 7565 7328  ._layers.values(
+000119b0: 292c 206b 6579 3d6c 616d 6264 6120 783a  ), key=lambda x:
+000119c0: 2028 782e 6764 735f 6c61 7965 722c 2078   (x.gds_layer, x
+000119d0: 2e67 6473 5f64 6174 6174 7970 6529 0a20  .gds_datatype). 
+000119e0: 2020 2029 0a20 2020 2066 6f72 206e 2c20     ).    for n, 
+000119f0: 6c61 7965 7220 696e 2065 6e75 6d65 7261  layer in enumera
+00011a00: 7465 2873 6f72 7465 645f 6c61 7965 7273  te(sorted_layers
+00011a10: 293a 0a20 2020 2020 2020 2052 203d 2072  ):.        R = r
+00011a20: 6563 7461 6e67 6c65 2873 697a 653d 2831  ectangle(size=(1
+00011a30: 3030 202a 2073 6361 6c65 2c20 3130 3020  00 * scale, 100 
+00011a40: 2a20 7363 616c 6529 2c20 6c61 7965 723d  * scale), layer=
+00011a50: 6c61 7965 7229 0a20 2020 2020 2020 2054  layer).        T
+00011a60: 203d 2074 6578 7428 0a20 2020 2020 2020   = text(.       
+00011a70: 2020 2020 2074 6578 743d 6622 7b6c 6179       text=f"{lay
+00011a80: 6572 2e6e 616d 657d 5c6e 7b6c 6179 6572  er.name}\n{layer
+00011a90: 2e67 6473 5f6c 6179 6572 7d20 2f20 7b6c  .gds_layer} / {l
+00011aa0: 6179 6572 2e67 6473 5f64 6174 6174 7970  ayer.gds_datatyp
+00011ab0: 657d 222c 0a20 2020 2020 2020 2020 2020  e}",.           
+00011ac0: 2073 697a 653d 3230 202a 2073 6361 6c65   size=20 * scale
+00011ad0: 2c0a 2020 2020 2020 2020 2020 2020 6a75  ,.            ju
+00011ae0: 7374 6966 793d 2263 656e 7465 7222 2c0a  stify="center",.
+00011af0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00011b00: 723d 6c61 7965 722c 0a20 2020 2020 2020  r=layer,.       
+00011b10: 2029 0a0a 2020 2020 2020 2020 542e 6d6f   )..        T.mo
+00011b20: 7665 2828 3530 202a 2073 6361 6c65 2c20  ve((50 * scale, 
+00011b30: 2d32 3020 2a20 7363 616c 6529 290a 2020  -20 * scale)).  
+00011b40: 2020 2020 2020 786c 6f63 203d 206e 2025        xloc = n %
+00011b50: 206d 6174 7269 785f 7369 7a65 0a20 2020   matrix_size.   
+00011b60: 2020 2020 2079 6c6f 6320 3d20 696e 7428       yloc = int(
+00011b70: 6e20 2f2f 206d 6174 7269 785f 7369 7a65  n // matrix_size
+00011b80: 290a 2020 2020 2020 2020 442e 6164 645f  ).        D.add_
+00011b90: 7265 6628 5229 2e6d 6f76 6578 2828 3130  ref(R).movex((10
+00011ba0: 3020 2b20 7370 6163 696e 6729 202a 2078  0 + spacing) * x
+00011bb0: 6c6f 6320 2a20 7363 616c 6529 2e6d 6f76  loc * scale).mov
+00011bc0: 6579 280a 2020 2020 2020 2020 2020 2020  ey(.            
+00011bd0: 2d28 3130 3020 2b20 7370 6163 696e 6729  -(100 + spacing)
+00011be0: 202a 2079 6c6f 6320 2a20 7363 616c 650a   * yloc * scale.
+00011bf0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00011c00: 2020 442e 6164 645f 7265 6628 5429 2e6d    D.add_ref(T).m
+00011c10: 6f76 6578 2828 3130 3020 2b20 7370 6163  ovex((100 + spac
+00011c20: 696e 6729 202a 2078 6c6f 6320 2a20 7363  ing) * xloc * sc
+00011c30: 616c 6529 2e6d 6f76 6579 280a 2020 2020  ale).movey(.    
+00011c40: 2020 2020 2020 2020 2d28 3130 3020 2b20          -(100 + 
+00011c50: 7370 6163 696e 6729 202a 2079 6c6f 6320  spacing) * yloc 
+00011c60: 2a20 7363 616c 650a 2020 2020 2020 2020  * scale.        
+00011c70: 290a 2020 2020 7265 7475 726e 2044 0a0a  ).    return D..
+00011c80: 0a63 6c61 7373 2064 6576 6963 655f 6c72  .class device_lr
+00011c90: 755f 6361 6368 653a 0a20 2020 2022 2222  u_cache:.    """
+00011ca0: 4c65 6173 742d 7265 6365 6e74 6c79 2d75  Least-recently-u
+00011cb0: 7365 6420 284c 5255 2920 6361 6368 6520  sed (LRU) cache 
+00011cc0: 666f 7220 4465 7669 6365 7322 2222 0a0a  for Devices"""..
+00011cd0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00011ce0: 2873 656c 662c 2066 6e29 3a0a 2020 2020  (self, fn):.    
+00011cf0: 2020 2020 7365 6c66 2e6d 6178 7369 7a65      self.maxsize
+00011d00: 203d 2033 320a 2020 2020 2020 2020 7365   = 32.        se
+00011d10: 6c66 2e66 6e20 3d20 666e 0a20 2020 2020  lf.fn = fn.     
+00011d20: 2020 2073 656c 662e 6d65 6d6f 203d 204f     self.memo = O
+00011d30: 7264 6572 6564 4469 6374 2829 0a20 2020  rderedDict().   
+00011d40: 2020 2020 2075 7064 6174 655f 7772 6170       update_wrap
+00011d50: 7065 7228 7365 6c66 2c20 666e 290a 0a20  per(self, fn).. 
+00011d60: 2020 2064 6566 205f 5f63 616c 6c5f 5f28     def __call__(
+00011d70: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
+00011d80: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+00011d90: 7069 636b 6c65 5f73 7472 203d 2070 6963  pickle_str = pic
+00011da0: 6b6c 652e 6475 6d70 7328 6172 6773 2c20  kle.dumps(args, 
+00011db0: 3129 202b 2070 6963 6b6c 652e 6475 6d70  1) + pickle.dump
+00011dc0: 7328 6b77 6172 6773 2c20 3129 0a20 2020  s(kwargs, 1).   
+00011dd0: 2020 2020 2069 6620 7069 636b 6c65 5f73       if pickle_s
+00011de0: 7472 206e 6f74 2069 6e20 7365 6c66 2e6d  tr not in self.m
+00011df0: 656d 6f2e 6b65 7973 2829 3a0a 2020 2020  emo.keys():.    
+00011e00: 2020 2020 2020 2020 6e65 775f 6361 6368          new_cach
+00011e10: 655f 6974 656d 203d 2073 656c 662e 666e  e_item = self.fn
+00011e20: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
+00011e30: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00011e40: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+00011e50: 6e65 775f 6361 6368 655f 6974 656d 2c20  new_cache_item, 
+00011e60: 4465 7669 6365 293a 0a20 2020 2020 2020  Device):.       
+00011e70: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00011e80: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+00011e90: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00011ea0: 5b50 4849 444c 5d20 4064 6576 6963 655f  [PHIDL] @device_
+00011eb0: 6c72 755f 6361 6368 6520 6361 6e20 6f6e  lru_cache can on
+00011ec0: 6c79 2062 6520 220a 2020 2020 2020 2020  ly be ".        
+00011ed0: 2020 2020 2020 2020 2020 2020 2275 7365              "use
+00011ee0: 6420 6f6e 2066 756e 6374 696f 6e73 2077  d on functions w
+00011ef0: 6869 6368 2072 6574 7572 6e20 6120 4465  hich return a De
+00011f00: 7669 6365 220a 2020 2020 2020 2020 2020  vice".          
+00011f10: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00011f20: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
+00011f30: 6d65 6d6f 2920 3e20 7365 6c66 2e6d 6178  memo) > self.max
+00011f40: 7369 7a65 3a0a 2020 2020 2020 2020 2020  size:.          
+00011f50: 2020 2020 2020 7365 6c66 2e6d 656d 6f2e        self.memo.
+00011f60: 706f 7069 7465 6d28 6c61 7374 3d46 616c  popitem(last=Fal
+00011f70: 7365 2920 2023 2052 656d 6f76 6520 6f6c  se)  # Remove ol
+00011f80: 6465 7374 2069 7465 6d20 6672 6f6d 2063  dest item from c
+00011f90: 6163 6865 0a20 2020 2020 2020 2020 2020  ache.           
+00011fa0: 2023 2041 6464 2061 2064 6565 7063 6f70   # Add a deepcop
+00011fb0: 7920 6f66 206e 6577 2069 7465 6d20 746f  y of new item to
+00011fc0: 2063 6163 6865 2073 6f20 7468 6174 2069   cache so that i
+00011fd0: 6620 7765 2063 6861 6e67 6520 7468 650a  f we change the.
+00011fe0: 2020 2020 2020 2020 2020 2020 2320 7265              # re
+00011ff0: 7475 726e 6564 2064 6576 6963 652c 206f  turned device, o
+00012000: 7572 2073 746f 7265 6420 6361 6368 6520  ur stored cache 
+00012010: 6974 656d 2069 7320 6e6f 7420 6368 616e  item is not chan
+00012020: 6765 640a 2020 2020 2020 2020 2020 2020  ged.            
+00012030: 7365 6c66 2e6d 656d 6f5b 7069 636b 6c65  self.memo[pickle
+00012040: 5f73 7472 5d20 3d20 7079 7468 6f6e 5f63  _str] = python_c
+00012050: 6f70 792e 6465 6570 636f 7079 286e 6577  opy.deepcopy(new
+00012060: 5f63 6163 6865 5f69 7465 6d29 0a20 2020  _cache_item).   
+00012070: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00012080: 6e65 775f 6361 6368 655f 6974 656d 0a20  new_cache_item. 
+00012090: 2020 2020 2020 2065 6c73 653a 2020 2320         else:  # 
+000120a0: 6966 2066 6f75 6e64 2069 6e20 6361 6368  if found in cach
+000120b0: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
+000120c0: 506f 7020 6361 6368 6520 6974 656d 206f  Pop cache item o
+000120d0: 7574 2061 6e64 2070 7574 2069 7420 6261  ut and put it ba
+000120e0: 636b 206f 6e20 7468 6520 746f 7020 6f66  ck on the top of
+000120f0: 2074 6865 2063 6163 6865 0a20 2020 2020   the cache.     
+00012100: 2020 2020 2020 2063 6163 6865 645f 6f75         cached_ou
+00012110: 7470 7574 203d 2073 656c 662e 6d65 6d6f  tput = self.memo
+00012120: 2e70 6f70 2870 6963 6b6c 655f 7374 7229  .pop(pickle_str)
+00012130: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00012140: 662e 6d65 6d6f 5b70 6963 6b6c 655f 7374  f.memo[pickle_st
+00012150: 725d 203d 2063 6163 6865 645f 6f75 7470  r] = cached_outp
+00012160: 7574 0a20 2020 2020 2020 2020 2020 2023  ut.            #
+00012170: 2054 6865 6e20 7265 7475 726e 2061 2063   Then return a c
+00012180: 6f70 7920 6f66 2074 6865 2063 6163 6865  opy of the cache
+00012190: 6420 4465 7669 6365 0a20 2020 2020 2020  d Device.       
+000121a0: 2020 2020 2072 6574 7572 6e20 6465 6570       return deep
+000121b0: 636f 7079 2863 6163 6865 645f 6f75 7470  copy(cached_outp
+000121c0: 7574 290a 0a0a 6465 6620 5f63 6f6e 7665  ut)...def _conve
+000121d0: 7274 5f70 6f72 745f 746f 5f67 656f 6d65  rt_port_to_geome
+000121e0: 7472 7928 706f 7274 2c20 6c61 7965 723d  try(port, layer=
+000121f0: 3029 3a0a 2020 2020 2222 2243 6f6e 7665  0):.    """Conve
+00012200: 7274 7320 6120 506f 7274 2074 6f20 6120  rts a Port to a 
+00012210: 6c61 6265 6c20 616e 6420 6120 7472 6961  label and a tria
+00012220: 6e67 6c65 2044 6576 6963 6520 7468 6174  ngle Device that
+00012230: 2061 7265 2074 6865 6e20 6164 6465 640a   are then added.
+00012240: 2020 2020 746f 2074 6865 2070 6172 656e      to the paren
+00012250: 742e 0a0a 2020 2020 5061 7261 6d65 7465  t...    Paramete
+00012260: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+00012270: 2d0a 2020 2020 706f 7274 203a 2050 6f72  -.    port : Por
+00012280: 740a 2020 2020 2020 2020 506f 7274 2074  t.        Port t
+00012290: 6f20 6265 2063 6f6e 7665 7274 6564 2e0a  o be converted..
+000122a0: 2020 2020 6c61 7965 7220 3a20 696e 742c      layer : int,
+000122b0: 2061 7272 6179 2d6c 696b 655b 325d 2c20   array-like[2], 
+000122c0: 6f72 2073 6574 0a20 2020 2020 2020 2053  or set.        S
+000122d0: 7065 6369 6669 6320 6c61 7965 7228 7329  pecific layer(s)
+000122e0: 2074 6f20 7075 7420 6c61 6265 6c20 616e   to put label an
+000122f0: 6420 6765 6f6d 6574 7279 206f 6e2e 0a0a  d geometry on...
+00012300: 2020 2020 4e6f 7465 730a 2020 2020 2d2d      Notes.    --
+00012310: 2d2d 2d0a 2020 2020 5468 6520 506f 7274  ---.    The Port
+00012320: 206d 7573 7420 7374 6172 7420 7769 7468   must start with
+00012330: 2061 2070 6172 656e 742e 0a20 2020 2022   a parent..    "
+00012340: 2222 0a20 2020 2069 6620 706f 7274 2e70  "".    if port.p
+00012350: 6172 656e 7420 6973 204e 6f6e 653a 0a20  arent is None:. 
+00012360: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00012370: 7565 4572 726f 7228 6622 506f 7274 207b  ueError(f"Port {
+00012380: 706f 7274 2e6e 616d 657d 3a20 506f 7274  port.name}: Port
+00012390: 206e 6565 6473 2061 2070 6172 656e 7420   needs a parent 
+000123a0: 696e 2077 6869 6368 2074 6f20 6472 6177  in which to draw
+000123b0: 2229 0a20 2020 2069 6620 6973 696e 7374  ").    if isinst
+000123c0: 616e 6365 2870 6f72 742e 7061 7265 6e74  ance(port.parent
+000123d0: 2c20 4465 7669 6365 5265 6665 7265 6e63  , DeviceReferenc
+000123e0: 6529 3a0a 2020 2020 2020 2020 6465 7669  e):.        devi
+000123f0: 6365 203d 2070 6f72 742e 7061 7265 6e74  ce = port.parent
+00012400: 2e70 6172 656e 740a 2020 2020 656c 7365  .parent.    else
+00012410: 3a0a 2020 2020 2020 2020 6465 7669 6365  :.        device
+00012420: 203d 2070 6f72 742e 7061 7265 6e74 0a0a   = port.parent..
+00012430: 2020 2020 2320 4120 7669 7375 616c 206d      # A visual m
+00012440: 6172 6b65 720a 2020 2020 7472 6961 6e67  arker.    triang
+00012450: 6c65 5f70 6f69 6e74 7320 3d20 5b5b 302c  le_points = [[0,
+00012460: 2030 5d5d 202a 2033 0a20 2020 2074 7269   0]] * 3.    tri
+00012470: 616e 676c 655f 706f 696e 7473 5b30 5d20  angle_points[0] 
+00012480: 3d20 706f 7274 2e65 6e64 706f 696e 7473  = port.endpoints
+00012490: 5b30 5d0a 2020 2020 7472 6961 6e67 6c65  [0].    triangle
+000124a0: 5f70 6f69 6e74 735b 315d 203d 2070 6f72  _points[1] = por
+000124b0: 742e 656e 6470 6f69 6e74 735b 315d 0a20  t.endpoints[1]. 
+000124c0: 2020 2074 7269 616e 676c 655f 706f 696e     triangle_poin
+000124d0: 7473 5b32 5d20 3d20 280a 2020 2020 2020  ts[2] = (.      
+000124e0: 2020 706f 7274 2e6d 6964 706f 696e 7420    port.midpoint 
+000124f0: 2b20 2870 6f72 742e 6e6f 726d 616c 202d  + (port.normal -
+00012500: 2070 6f72 742e 6d69 6470 6f69 6e74 2920   port.midpoint) 
+00012510: 2a20 706f 7274 2e77 6964 7468 202f 2031  * port.width / 1
+00012520: 300a 2020 2020 295b 315d 0a20 2020 2064  0.    )[1].    d
+00012530: 6576 6963 652e 6164 645f 706f 6c79 676f  evice.add_polygo
+00012540: 6e28 7472 6961 6e67 6c65 5f70 6f69 6e74  n(triangle_point
+00012550: 732c 206c 6179 6572 290a 0a20 2020 2023  s, layer)..    #
+00012560: 204c 6162 656c 2063 6172 7279 696e 6720   Label carrying 
+00012570: 6163 7475 616c 2069 6e66 6f72 6d61 7469  actual informati
+00012580: 6f6e 2074 6861 7420 7769 6c6c 2062 6520  on that will be 
+00012590: 7265 636f 7665 7265 640a 2020 2020 6c61  recovered.    la
+000125a0: 6265 6c5f 636f 6e74 656e 7473 203d 2028  bel_contents = (
+000125b0: 0a20 2020 2020 2020 2073 7472 2870 6f72  .        str(por
+000125c0: 742e 6e61 6d65 292c 0a20 2020 2020 2020  t.name),.       
+000125d0: 2023 2070 6f72 742e 6d69 6470 6f69 6e74   # port.midpoint
+000125e0: 2c0a 2020 2020 2020 2020 2320 7261 7468  ,.        # rath
+000125f0: 6572 2074 6861 6e20 7075 7420 7468 6973  er than put this
+00012600: 2069 6e20 7468 6520 7465 7874 2c20 7573   in the text, us
+00012610: 6520 7468 6520 6c61 6265 6c0a 2020 2020  e the label.    
+00012620: 2020 2020 2320 706f 7369 7469 6f6e 0a20      # position. 
+00012630: 2020 2020 2020 2023 2074 6869 7320 6361         # this ca
+00012640: 6e20 6861 7665 2072 6f75 6e64 696e 6720  n have rounding 
+00012650: 6572 726f 7273 2074 6861 7420 6172 6520  errors that are 
+00012660: 6c65 7373 2074 6861 6e20 610a 2020 2020  less than a.    
+00012670: 2020 2020 2320 6e61 6e6f 6d65 7465 720a      # nanometer.
+00012680: 2020 2020 2020 2020 666c 6f61 7428 6e70          float(np
+00012690: 2e72 6f75 6e64 2870 6f72 742e 7769 6474  .round(port.widt
+000126a0: 682c 2064 6563 696d 616c 733d 3329 292c  h, decimals=3)),
+000126b0: 0a20 2020 2020 2020 2066 6c6f 6174 2870  .        float(p
+000126c0: 6f72 742e 6f72 6965 6e74 6174 696f 6e29  ort.orientation)
+000126d0: 2c0a 2020 2020 2020 2020 2320 6465 7669  ,.        # devi
+000126e0: 6365 2c20 2320 7468 6973 2069 7320 6465  ce, # this is de
+000126f0: 6669 6e69 7465 6c79 206e 6f74 2073 6572  finitely not ser
+00012700: 6961 6c69 7a61 626c 650a 2020 2020 2020  ializable.      
+00012710: 2020 2320 706f 7274 2e69 6e66 6f2c 2023    # port.info, #
+00012720: 2077 6f75 6c64 206c 696b 6520 746f 2069   would like to i
+00012730: 6e63 6c75 6465 2c20 6275 7420 6974 206d  nclude, but it m
+00012740: 6967 6874 2067 6f0a 2020 2020 2020 2020  ight go.        
+00012750: 2320 6c6f 6e67 6572 2074 6861 6e20 3130  # longer than 10
+00012760: 3234 2063 6861 7261 6374 6572 730a 2020  24 characters.  
+00012770: 2020 2020 2020 2320 706f 7274 2e75 6964        # port.uid
+00012780: 2c20 2320 6e6f 7420 696e 636c 7564 696e  , # not includin
+00012790: 6720 6265 6361 7573 6520 6974 2069 7320  g because it is 
+000127a0: 7061 7274 206f 6620 7468 650a 2020 2020  part of the.    
+000127b0: 2020 2020 2320 6275 696c 6420 7072 6f63      # build proc
+000127c0: 6573 732c 206e 6f74 2074 6865 2070 6f72  ess, not the por
+000127d0: 7420 7374 6174 650a 2020 2020 290a 2020  t state.    ).  
+000127e0: 2020 6c61 6265 6c5f 7465 7874 203d 206a    label_text = j
+000127f0: 736f 6e2e 6475 6d70 7328 6c61 6265 6c5f  son.dumps(label_
+00012800: 636f 6e74 656e 7473 290a 2020 2020 6465  contents).    de
+00012810: 7669 6365 2e61 6464 5f6c 6162 656c 280a  vice.add_label(.
+00012820: 2020 2020 2020 2020 7465 7874 3d6c 6162          text=lab
+00012830: 656c 5f74 6578 742c 0a20 2020 2020 2020  el_text,.       
+00012840: 2070 6f73 6974 696f 6e3d 706f 7274 2e6d   position=port.m
+00012850: 6964 706f 696e 7420 2b20 5f63 616c 6375  idpoint + _calcu
+00012860: 6c61 7465 5f6c 6162 656c 5f6f 6666 7365  late_label_offse
+00012870: 7428 706f 7274 292c 0a20 2020 2020 2020  t(port),.       
+00012880: 206d 6167 6e69 6669 6361 7469 6f6e 3d30   magnification=0
+00012890: 2e30 3420 2a20 706f 7274 2e77 6964 7468  .04 * port.width
+000128a0: 2c0a 2020 2020 2020 2020 726f 7461 7469  ,.        rotati
+000128b0: 6f6e 3d28 3930 202b 2070 6f72 742e 6f72  on=(90 + port.or
+000128c0: 6965 6e74 6174 696f 6e29 2025 2033 3630  ientation) % 360
+000128d0: 2c0a 2020 2020 2020 2020 6c61 7965 723d  ,.        layer=
+000128e0: 6c61 7965 722c 0a20 2020 2029 0a0a 0a64  layer,.    )...d
+000128f0: 6566 205f 6361 6c63 756c 6174 655f 6c61  ef _calculate_la
+00012900: 6265 6c5f 6f66 6673 6574 2870 6f72 7429  bel_offset(port)
+00012910: 3a0a 2020 2020 2222 2255 7365 6420 746f  :.    """Used to
+00012920: 2070 7574 2074 6865 206c 6162 656c 2069   put the label i
+00012930: 6e20 6120 7072 6574 7479 2070 6f73 6974  n a pretty posit
+00012940: 696f 6e2e 2049 7420 6973 2061 6464 6564  ion. It is added
+00012950: 2077 6865 6e20 6472 6177 696e 670a 2020   when drawing.  
+00012960: 2020 616e 6420 7375 6273 7472 6163 7465    and substracte
+00012970: 6420 7768 656e 2065 7874 7261 6374 696e  d when extractin
+00012980: 672e 0a0a 2020 2020 5061 7261 6d65 7465  g...    Paramete
+00012990: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+000129a0: 2d0a 2020 2020 706f 7274 203a 2050 6f72  -.    port : Por
+000129b0: 740a 2020 2020 2020 2020 506f 7274 2d63  t.        Port-c
+000129c0: 6f6e 7665 7274 6564 206c 6162 656c 2074  onverted label t
+000129d0: 6f20 6d6f 7665 2e0a 0a20 2020 2052 6574  o move...    Ret
+000129e0: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
+000129f0: 0a20 2020 206f 6666 7365 745f 706f 7369  .    offset_posi
+00012a00: 7469 6f6e 203a 2061 7272 6179 2d6c 696b  tion : array-lik
+00012a10: 650a 2020 2020 2020 2020 436f 6f72 6469  e.        Coordi
+00012a20: 6e61 7465 7320 6f66 206e 6577 2070 6f72  nates of new por
+00012a30: 7420 706f 7369 7469 6f6e 2e0a 2020 2020  t position..    
+00012a40: 2222 220a 2020 2020 6f66 6673 6574 5f70  """.    offset_p
+00012a50: 6f73 6974 696f 6e20 3d20 6e70 2e61 7272  osition = np.arr
+00012a60: 6179 280a 2020 2020 2020 2020 282d 636f  ay(.        (-co
+00012a70: 7328 7069 202f 2031 3830 202a 2070 6f72  s(pi / 180 * por
+00012a80: 742e 6f72 6965 6e74 6174 696f 6e29 2c20  t.orientation), 
+00012a90: 2d73 696e 2870 6920 2f20 3138 3020 2a20  -sin(pi / 180 * 
+00012aa0: 706f 7274 2e6f 7269 656e 7461 7469 6f6e  port.orientation
+00012ab0: 2929 0a20 2020 2029 0a20 2020 206f 6666  )).    ).    off
+00012ac0: 7365 745f 706f 7369 7469 6f6e 202a 3d20  set_position *= 
+00012ad0: 706f 7274 2e77 6964 7468 202a 2030 2e30  port.width * 0.0
+00012ae0: 350a 2020 2020 7265 7475 726e 206f 6666  5.    return off
+00012af0: 7365 745f 706f 7369 7469 6f6e 0a0a 0a64  set_position...d
+00012b00: 6566 205f 636f 6e76 6572 745f 6765 6f6d  ef _convert_geom
+00012b10: 6574 7279 5f74 6f5f 706f 7274 286c 6162  etry_to_port(lab
+00012b20: 656c 2c20 6c61 7965 723d 3029 3a0a 2020  el, layer=0):.  
+00012b30: 2020 2222 2243 6f6e 7665 7274 7320 6120    """Converts a 
+00012b40: 6c61 6265 6c20 696e 746f 2061 2050 6f72  label into a Por
+00012b50: 7420 696e 2074 6865 2070 6172 656e 7420  t in the parent 
+00012b60: 4465 7669 6365 2e20 5468 6520 6c61 6265  Device. The labe
+00012b70: 6c20 636f 6e74 6169 6e73 0a20 2020 206e  l contains.    n
+00012b80: 616d 652c 2077 6964 7468 2c20 6f72 6965  ame, width, orie
+00012b90: 6e74 6174 696f 6e2e 2044 6f65 7320 6e6f  ntation. Does no
+00012ba0: 7420 7265 6d6f 7665 2074 6861 7420 6c61  t remove that la
+00012bb0: 6265 6c20 6672 6f6d 2074 6865 2070 6172  bel from the par
+00012bc0: 656e 742e 0a20 2020 2052 6574 7572 6e73  ent..    Returns
+00012bd0: 2074 6865 206e 6577 2070 6f72 742e 0a0a   the new port...
+00012be0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00012bf0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00012c00: 2020 6c61 6265 6c20 3a20 4c61 6265 6c0a    label : Label.
+00012c10: 2020 2020 2020 2020 4c61 6265 6c20 746f          Label to
+00012c20: 2062 6520 636f 6e76 6572 7465 6420 696e   be converted in
+00012c30: 746f 2061 2050 6f72 742e 0a20 2020 206c  to a Port..    l
+00012c40: 6179 6572 203a 2069 6e74 2c20 6172 7261  ayer : int, arra
+00012c50: 792d 6c69 6b65 5b32 5d2c 206f 7220 7365  y-like[2], or se
+00012c60: 740a 2020 2020 2020 2020 5370 6563 6966  t.        Specif
+00012c70: 6963 206c 6179 6572 2873 2920 746f 2070  ic layer(s) to p
+00012c80: 7574 2050 6f72 7420 6f6e 2e0a 0a20 2020  ut Port on...   
+00012c90: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
+00012ca0: 2d2d 2d2d 0a20 2020 206e 6577 5f70 6f72  ----.    new_por
+00012cb0: 7420 3a20 506f 7274 0a20 2020 2020 2020  t : Port.       
+00012cc0: 2050 6f72 742d 636f 6e76 6572 7465 6420   Port-converted 
+00012cd0: 6c61 6265 6c2e 0a20 2020 2022 2222 0a20  label..    """. 
+00012ce0: 2020 206e 616d 652c 2077 6964 7468 2c20     name, width, 
+00012cf0: 6f72 6965 6e74 6174 696f 6e20 3d20 6a73  orientation = js
+00012d00: 6f6e 2e6c 6f61 6473 286c 6162 656c 2e74  on.loads(label.t
+00012d10: 6578 7429 0a20 2020 206e 6577 5f70 6f72  ext).    new_por
+00012d20: 7420 3d20 506f 7274 286e 616d 653d 6e61  t = Port(name=na
+00012d30: 6d65 2c20 7769 6474 683d 7769 6474 682c  me, width=width,
+00012d40: 206f 7269 656e 7461 7469 6f6e 3d6f 7269   orientation=ori
+00012d50: 656e 7461 7469 6f6e 290a 2020 2020 6e65  entation).    ne
+00012d60: 775f 706f 7274 2e6d 6964 706f 696e 7420  w_port.midpoint 
+00012d70: 3d20 6c61 6265 6c2e 706f 7369 7469 6f6e  = label.position
+00012d80: 202d 205f 6361 6c63 756c 6174 655f 6c61   - _calculate_la
+00012d90: 6265 6c5f 6f66 6673 6574 286e 6577 5f70  bel_offset(new_p
+00012da0: 6f72 7429 0a20 2020 2072 6574 7572 6e20  ort).    return 
+00012db0: 6e65 775f 706f 7274 0a0a 0a64 6566 2070  new_port...def p
+00012dc0: 6f72 7473 5f74 6f5f 6765 6f6d 6574 7279  orts_to_geometry
+00012dd0: 2864 6576 6963 652c 206c 6179 6572 3d30  (device, layer=0
+00012de0: 293a 0a20 2020 2022 2222 436f 6e76 6572  ):.    """Conver
+00012df0: 7473 2050 6f72 7420 6f62 6a65 6374 7320  ts Port objects 
+00012e00: 6f76 6572 2074 6865 2077 686f 6c65 2044  over the whole D
+00012e10: 6576 6963 6520 6869 6572 6172 6368 7920  evice hierarchy 
+00012e20: 746f 2067 656f 6d65 7472 7920 616e 640a  to geometry and.
+00012e30: 2020 2020 6c61 6265 6c73 2e0a 0a20 2020      labels...   
+00012e40: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00012e50: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2064  ----------.    d
+00012e60: 6576 6963 6520 3a20 4465 7669 6365 0a20  evice : Device. 
+00012e70: 2020 2020 2020 2044 6576 6963 6520 636f         Device co
+00012e80: 6e74 6169 6e69 6e67 2050 6f72 7420 6f62  ntaining Port ob
+00012e90: 6a65 6374 7320 746f 2063 6f6e 7665 7274  jects to convert
+00012ea0: 2e0a 2020 2020 6c61 7965 7220 3a20 696e  ..    layer : in
+00012eb0: 742c 2061 7272 6179 2d6c 696b 655b 325d  t, array-like[2]
+00012ec0: 2c20 6f72 2073 6574 0a20 2020 2020 2020  , or set.       
+00012ed0: 2053 7065 6369 6669 6320 6c61 7965 7228   Specific layer(
+00012ee0: 7329 2074 6f20 7075 7420 706f 6c79 676f  s) to put polygo
+00012ef0: 6e20 6765 6f6d 6574 7279 206f 6e20 2874  n geometry on (t
+00012f00: 6865 2073 7065 6369 616c 2070 6f72 7420  he special port 
+00012f10: 7265 636f 7264 0a20 2020 2020 2020 206c  record.        l
+00012f20: 6179 6572 292e 0a0a 2020 2020 5265 7475  ayer)...    Retu
+00012f30: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
+00012f40: 2020 2020 7465 6d70 5f64 6576 6963 6520      temp_device 
+00012f50: 3a20 4465 7669 6365 0a20 2020 2020 2020  : Device.       
+00012f60: 2041 2044 6576 6963 6520 7769 7468 2061   A Device with a
+00012f70: 6c6c 2050 6f72 7473 2063 6f6e 7665 7274  ll Ports convert
+00012f80: 6564 2074 6f20 6765 6f6d 6574 7279 2f6c  ed to geometry/l
+00012f90: 6162 656c 7320 616e 6420 7265 6d6f 7665  abels and remove
+00012fa0: 642e 0a20 2020 2022 2222 0a20 2020 2074  d..    """.    t
+00012fb0: 656d 705f 6465 7669 6365 203d 2064 6565  emp_device = dee
+00012fc0: 7063 6f70 7928 6465 7669 6365 290a 2020  pcopy(device).  
+00012fd0: 2020 616c 6c5f 6365 6c6c 7320 3d20 6c69    all_cells = li
+00012fe0: 7374 2874 656d 705f 6465 7669 6365 2e67  st(temp_device.g
+00012ff0: 6574 5f64 6570 656e 6465 6e63 6965 7328  et_dependencies(
+00013000: 7265 6375 7273 6976 653d 5472 7565 2929  recursive=True))
+00013010: 0a20 2020 2061 6c6c 5f63 656c 6c73 2e61  .    all_cells.a
+00013020: 7070 656e 6428 7465 6d70 5f64 6576 6963  ppend(temp_devic
+00013030: 6529 0a20 2020 2066 6f72 2073 7562 6365  e).    for subce
+00013040: 6c6c 2069 6e20 616c 6c5f 6365 6c6c 733a  ll in all_cells:
+00013050: 0a20 2020 2020 2020 2066 6f72 2070 6f72  .        for por
+00013060: 7420 696e 2073 7562 6365 6c6c 2e70 6f72  t in subcell.por
+00013070: 7473 2e76 616c 7565 7328 293a 0a20 2020  ts.values():.   
+00013080: 2020 2020 2020 2020 205f 636f 6e76 6572           _conver
+00013090: 745f 706f 7274 5f74 6f5f 6765 6f6d 6574  t_port_to_geomet
+000130a0: 7279 2870 6f72 742c 206c 6179 6572 3d6c  ry(port, layer=l
+000130b0: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
+000130c0: 2020 7375 6263 656c 6c2e 7265 6d6f 7665    subcell.remove
+000130d0: 2870 6f72 7429 0a20 2020 2072 6574 7572  (port).    retur
+000130e0: 6e20 7465 6d70 5f64 6576 6963 650a 0a0a  n temp_device...
+000130f0: 6465 6620 6765 6f6d 6574 7279 5f74 6f5f  def geometry_to_
+00013100: 706f 7274 7328 6465 7669 6365 2c20 6c61  ports(device, la
+00013110: 7965 723d 3029 3a0a 2020 2020 2222 2243  yer=0):.    """C
+00013120: 6f6e 7665 7274 7320 6765 6f6d 6574 7279  onverts geometry
+00013130: 2072 6570 7265 7365 6e74 696e 6720 706f   representing po
+00013140: 7274 7320 6f76 6572 2074 6865 2077 686f  rts over the who
+00013150: 6c65 2044 6576 6963 6520 6869 6572 6172  le Device hierar
+00013160: 6368 790a 2020 2020 696e 746f 2050 6f72  chy.    into Por
+00013170: 7420 6f62 6a65 6374 732e 0a0a 2020 2020  t objects...    
+00013180: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+00013190: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6465  ---------.    de
+000131a0: 7669 6365 203a 2044 6576 6963 650a 2020  vice : Device.  
+000131b0: 2020 2020 2020 4465 7669 6365 2063 6f6e        Device con
+000131c0: 7461 696e 696e 6720 6765 6f6d 6574 7279  taining geometry
+000131d0: 2072 6570 7265 7365 6e74 696e 6720 706f   representing po
+000131e0: 7274 7320 746f 2063 6f6e 7665 7274 2e0a  rts to convert..
+000131f0: 2020 2020 6c61 7965 7220 3a20 696e 742c      layer : int,
+00013200: 2061 7272 6179 2d6c 696b 655b 325d 2c20   array-like[2], 
+00013210: 6f72 2073 6574 0a20 2020 2020 2020 2053  or set.        S
+00013220: 7065 6369 6669 6320 6c61 7965 7228 7329  pecific layer(s)
+00013230: 2074 6f20 7075 7420 706f 6c79 676f 6e20   to put polygon 
+00013240: 6765 6f6d 6574 7279 206f 6e20 2874 6865  geometry on (the
+00013250: 2073 7065 6369 616c 2070 6f72 7420 7265   special port re
+00013260: 636f 7264 0a20 2020 2020 2020 206c 6179  cord.        lay
+00013270: 6572 290a 0a20 2020 2052 6574 7572 6e73  er)..    Returns
+00013280: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
+00013290: 2074 656d 705f 6465 7669 6365 203a 2044   temp_device : D
+000132a0: 6576 6963 650a 2020 2020 2020 2020 4120  evice.        A 
+000132b0: 4465 7669 6365 2077 6974 6820 616c 6c20  Device with all 
+000132c0: 6765 6f6d 6574 7279 2072 6570 7265 7365  geometry represe
+000132d0: 6e74 696e 6720 706f 7274 7320 636f 6e76  nting ports conv
+000132e0: 6572 7465 6420 746f 2050 6f72 7473 2061  erted to Ports a
+000132f0: 6e64 0a20 2020 2020 2020 2072 656d 6f76  nd.        remov
+00013300: 6564 2e0a 0a20 2020 204e 6f74 6573 0a20  ed...    Notes. 
+00013310: 2020 202d 2d2d 2d2d 0a20 2020 2044 6f65     -----.    Doe
+00013320: 7320 6e6f 7420 6d75 7461 7465 2074 6865  s not mutate the
+00013330: 2064 6576 6963 6520 696e 2074 6865 2061   device in the a
+00013340: 7267 756d 656e 742e 2052 6574 7572 6e73  rgument. Returns
+00013350: 2061 206e 6577 206f 6e65 206c 6163 6b69   a new one lacki
+00013360: 6e67 2061 6c6c 0a20 2020 2070 6f72 7420  ng all.    port 
+00013370: 6765 6f6d 6574 7279 2028 696e 636c 2e20  geometry (incl. 
+00013380: 6c61 6265 6c73 290a 2020 2020 2222 220a  labels).    """.
+00013390: 2020 2020 7465 6d70 5f64 6576 6963 6520      temp_device 
+000133a0: 3d20 6465 6570 636f 7079 2864 6576 6963  = deepcopy(devic
+000133b0: 6529 0a20 2020 2061 6c6c 5f63 656c 6c73  e).    all_cells
+000133c0: 203d 206c 6973 7428 7465 6d70 5f64 6576   = list(temp_dev
+000133d0: 6963 652e 6765 745f 6465 7065 6e64 656e  ice.get_dependen
+000133e0: 6369 6573 2872 6563 7572 7369 7665 3d54  cies(recursive=T
+000133f0: 7275 6529 290a 2020 2020 616c 6c5f 6365  rue)).    all_ce
+00013400: 6c6c 732e 6170 7065 6e64 2874 656d 705f  lls.append(temp_
+00013410: 6465 7669 6365 290a 2020 2020 666f 7220  device).    for 
+00013420: 7375 6263 656c 6c20 696e 2061 6c6c 5f63  subcell in all_c
+00013430: 656c 6c73 3a20 2023 2057 616c 6b20 7468  ells:  # Walk th
+00013440: 726f 7567 6820 6365 6c6c 730a 2020 2020  rough cells.    
+00013450: 2020 2020 666f 7220 6c61 6220 696e 2073      for lab in s
+00013460: 7562 6365 6c6c 2e6c 6162 656c 733a 0a20  ubcell.labels:. 
+00013470: 2020 2020 2020 2020 2020 2069 6620 6c61             if la
+00013480: 622e 6c61 7965 7220 3d3d 206c 6179 6572  b.layer == layer
+00013490: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000134a0: 2020 7468 655f 706f 7274 203d 205f 636f    the_port = _co
+000134b0: 6e76 6572 745f 6765 6f6d 6574 7279 5f74  nvert_geometry_t
+000134c0: 6f5f 706f 7274 286c 6162 290a 2020 2020  o_port(lab).    
+000134d0: 2020 2020 2020 2020 2020 2020 7375 6263              subc
+000134e0: 656c 6c2e 6164 645f 706f 7274 286e 616d  ell.add_port(nam
+000134f0: 653d 7468 655f 706f 7274 2e6e 616d 652c  e=the_port.name,
+00013500: 2070 6f72 743d 7468 655f 706f 7274 290a   port=the_port).
+00013510: 2020 2020 7465 6d70 5f64 6576 6963 652e      temp_device.
+00013520: 7265 6d6f 7665 5f6c 6179 6572 7328 6c61  remove_layers(la
+00013530: 7965 7273 3d5b 6c61 7965 725d 2c20 696e  yers=[layer], in
+00013540: 636c 7564 655f 6c61 6265 6c73 3d54 7275  clude_labels=Tru
+00013550: 6529 0a20 2020 2072 6574 7572 6e20 7465  e).    return te
+00013560: 6d70 5f64 6576 6963 650a 0a0a 2320 3d3d  mp_device...# ==
+00013570: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00013580: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00013590: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000135a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000135b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a23 0a23  ============.#.#
+000135c0: 2043 6f6e 6e65 6374 6f72 730a 230a 2320   Connectors.#.# 
+000135d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000135e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000135f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00013600: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00013610: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a0a  ==============..
+00013620: 0a64 6566 2063 6f6e 6e65 6374 6f72 286d  .def connector(m
+00013630: 6964 706f 696e 743d 2830 2c20 3029 2c20  idpoint=(0, 0), 
+00013640: 7769 6474 683d 312c 206f 7269 656e 7461  width=1, orienta
+00013650: 7469 6f6e 3d30 293a 0a20 2020 2022 2222  tion=0):.    """
+00013660: 4372 6561 7465 7320 6120 4465 7669 6365  Creates a Device
+00013670: 2077 6869 6368 2068 6173 2062 6163 6b2d   which has back-
+00013680: 746f 2d62 6163 6b20 706f 7274 732e 0a0a  to-back ports...
+00013690: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+000136a0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+000136b0: 2020 6d69 6470 6f69 6e74 203a 2061 7272    midpoint : arr
+000136c0: 6179 2d6c 696b 650a 2020 2020 2020 2020  ay-like.        
+000136d0: 436f 6f72 6469 6e61 7465 7320 6f66 2044  Coordinates of D
+000136e0: 6576 6963 6520 6d69 6470 6f69 6e74 2e0a  evice midpoint..
+000136f0: 2020 2020 7769 6474 6820 3a20 696e 7420      width : int 
+00013700: 6f72 2066 6c6f 6174 0a20 2020 2020 2020  or float.       
+00013710: 2057 6964 7468 206f 6620 636f 6e6e 6563   Width of connec
+00013720: 746f 7220 6f6e 206e 6f6e 2d70 6f72 7420  tor on non-port 
+00013730: 6178 6973 2e0a 2020 2020 6f72 6965 6e74  axis..    orient
+00013740: 6174 696f 6e20 3a20 696e 7420 6f72 2066  ation : int or f
+00013750: 6c6f 6174 0a20 2020 2020 2020 204f 7269  loat.        Ori
+00013760: 656e 7461 7469 6f6e 206f 6620 7468 6520  entation of the 
+00013770: 706f 7274 732e 0a0a 2020 2020 5265 7475  ports...    Retu
+00013780: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
+00013790: 2020 2020 4420 3a20 4465 7669 6365 0a20      D : Device. 
+000137a0: 2020 2020 2020 2041 2044 6576 6963 6520         A Device 
+000137b0: 636f 6e74 6169 6e69 6e67 2061 2062 6163  containing a bac
+000137c0: 6b2d 746f 2d62 6163 6b20 706f 7274 2067  k-to-back port g
+000137d0: 656f 6d65 7472 792e 0a20 2020 2022 2222  eometry..    """
+000137e0: 0a20 2020 2044 203d 2044 6576 6963 6528  .    D = Device(
+000137f0: 6e61 6d65 3d22 636f 6e6e 6563 746f 7222  name="connector"
+00013800: 290a 2020 2020 442e 6164 645f 706f 7274  ).    D.add_port
+00013810: 280a 2020 2020 2020 2020 6e61 6d65 3d31  (.        name=1
+00013820: 2c0a 2020 2020 2020 2020 6d69 6470 6f69  ,.        midpoi
+00013830: 6e74 3d5b 6d69 6470 6f69 6e74 5b30 5d2c  nt=[midpoint[0],
+00013840: 206d 6964 706f 696e 745b 315d 5d2c 0a20   midpoint[1]],. 
+00013850: 2020 2020 2020 2077 6964 7468 3d77 6964         width=wid
+00013860: 7468 2c0a 2020 2020 2020 2020 6f72 6965  th,.        orie
+00013870: 6e74 6174 696f 6e3d 6f72 6965 6e74 6174  ntation=orientat
+00013880: 696f 6e2c 0a20 2020 2029 0a20 2020 2044  ion,.    ).    D
+00013890: 2e61 6464 5f70 6f72 7428 0a20 2020 2020  .add_port(.     
+000138a0: 2020 206e 616d 653d 322c 0a20 2020 2020     name=2,.     
+000138b0: 2020 206d 6964 706f 696e 743d 5b6d 6964     midpoint=[mid
+000138c0: 706f 696e 745b 305d 2c20 6d69 6470 6f69  point[0], midpoi
+000138d0: 6e74 5b31 5d5d 2c0a 2020 2020 2020 2020  nt[1]],.        
+000138e0: 7769 6474 683d 7769 6474 682c 0a20 2020  width=width,.   
+000138f0: 2020 2020 206f 7269 656e 7461 7469 6f6e       orientation
+00013900: 3d6f 7269 656e 7461 7469 6f6e 202d 2031  =orientation - 1
+00013910: 3830 2c0a 2020 2020 290a 2020 2020 7265  80,.    ).    re
+00013920: 7475 726e 2044 0a0a 0a23 203d 3d3d 3d3d  turn D...# =====
+00013930: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00013940: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00013950: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00013960: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00013970: 3d3d 3d3d 3d3d 3d3d 3d0a 230a 2320 436f  =========.#.# Co
+00013980: 6e74 6163 7420 7061 6473 0a23 0a23 203d  ntact pads.#.# =
+00013990: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000139a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000139b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000139c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000139d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 0a0a  =============...
+000139e0: 6465 6620 636f 6d70 6173 7328 7369 7a65  def compass(size
+000139f0: 3d28 342c 2032 292c 206c 6179 6572 3d30  =(4, 2), layer=0
+00013a00: 293a 0a20 2020 2022 2222 4372 6561 7465  ):.    """Create
+00013a10: 7320 6120 7265 6374 616e 6775 6c61 7220  s a rectangular 
+00013a20: 636f 6e74 6163 7420 7061 6420 7769 7468  contact pad with
+00013a30: 2063 656e 7465 7265 6420 706f 7274 7320   centered ports 
+00013a40: 6f6e 2065 6467 6573 206f 6620 7468 650a  on edges of the.
+00013a50: 2020 2020 7265 6374 616e 676c 6520 286e      rectangle (n
+00013a60: 6f72 7468 2c20 736f 7574 682c 2065 6173  orth, south, eas
+00013a70: 742c 2061 6e64 2077 6573 7429 2e0a 0a20  t, and west)... 
+00013a80: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00013a90: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00013aa0: 2073 697a 6520 3a20 6172 7261 795f 6c69   size : array_li
+00013ab0: 6b65 5b32 5d0a 2020 2020 2020 2020 4469  ke[2].        Di
+00013ac0: 6d65 6e73 696f 6e73 206f 6620 7468 6520  mensions of the 
+00013ad0: 7265 6374 616e 6775 6c61 7220 636f 6e74  rectangular cont
+00013ae0: 6163 7420 7061 642e 0a20 2020 206c 6179  act pad..    lay
+00013af0: 6572 203a 2069 6e74 2c20 6172 7261 792d  er : int, array-
+00013b00: 6c69 6b65 5b32 5d2c 206f 7220 7365 740a  like[2], or set.
+00013b10: 2020 2020 2020 2020 5370 6563 6966 6963          Specific
+00013b20: 206c 6179 6572 2873 2920 746f 2070 7574   layer(s) to put
+00013b30: 2070 6f6c 7967 6f6e 2067 656f 6d65 7472   polygon geometr
+00013b40: 7920 6f6e 2e0a 0a20 2020 2052 6574 7572  y on...    Retur
+00013b50: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
+00013b60: 2020 2044 203a 2044 6576 6963 650a 2020     D : Device.  
+00013b70: 2020 2020 2020 4120 4465 7669 6365 2063        A Device c
+00013b80: 6f6e 7461 696e 696e 6720 6120 7265 6374  ontaining a rect
+00013b90: 616e 6775 6c61 7220 636f 6e74 6163 7420  angular contact 
+00013ba0: 7061 6420 7769 7468 2063 656e 7465 7265  pad with centere
+00013bb0: 6420 706f 7274 732e 0a20 2020 2022 2222  d ports..    """
+00013bc0: 0a20 2020 2044 203d 2044 6576 6963 6528  .    D = Device(
+00013bd0: 6e61 6d65 3d22 636f 6d70 6173 7322 290a  name="compass").
+00013be0: 2020 2020 7220 3d20 442e 6164 645f 7265      r = D.add_re
+00013bf0: 6628 7265 6374 616e 676c 6528 7369 7a65  f(rectangle(size
+00013c00: 2c20 6c61 7965 723d 6c61 7965 7229 290a  , layer=layer)).
+00013c10: 2020 2020 722e 6365 6e74 6572 203d 2028      r.center = (
+00013c20: 302c 2030 290a 0a20 2020 2064 7820 3d20  0, 0)..    dx = 
+00013c30: 7369 7a65 5b30 5d0a 2020 2020 6479 203d  size[0].    dy =
+00013c40: 2073 697a 655b 315d 0a20 2020 2044 2e61   size[1].    D.a
+00013c50: 6464 5f70 6f72 7428 6e61 6d65 3d22 4e22  dd_port(name="N"
+00013c60: 2c20 6d69 6470 6f69 6e74 3d5b 302c 2064  , midpoint=[0, d
+00013c70: 7920 2f20 325d 2c20 7769 6474 683d 6478  y / 2], width=dx
+00013c80: 2c20 6f72 6965 6e74 6174 696f 6e3d 3930  , orientation=90
+00013c90: 290a 2020 2020 442e 6164 645f 706f 7274  ).    D.add_port
+00013ca0: 286e 616d 653d 2253 222c 206d 6964 706f  (name="S", midpo
+00013cb0: 696e 743d 5b30 2c20 2d64 7920 2f20 325d  int=[0, -dy / 2]
+00013cc0: 2c20 7769 6474 683d 6478 2c20 6f72 6965  , width=dx, orie
+00013cd0: 6e74 6174 696f 6e3d 2d39 3029 0a20 2020  ntation=-90).   
+00013ce0: 2044 2e61 6464 5f70 6f72 7428 6e61 6d65   D.add_port(name
+00013cf0: 3d22 4522 2c20 6d69 6470 6f69 6e74 3d5b  ="E", midpoint=[
+00013d00: 6478 202f 2032 2c20 305d 2c20 7769 6474  dx / 2, 0], widt
+00013d10: 683d 6479 2c20 6f72 6965 6e74 6174 696f  h=dy, orientatio
+00013d20: 6e3d 3029 0a20 2020 2044 2e61 6464 5f70  n=0).    D.add_p
+00013d30: 6f72 7428 6e61 6d65 3d22 5722 2c20 6d69  ort(name="W", mi
+00013d40: 6470 6f69 6e74 3d5b 2d64 7820 2f20 322c  dpoint=[-dx / 2,
+00013d50: 2030 5d2c 2077 6964 7468 3d64 792c 206f   0], width=dy, o
+00013d60: 7269 656e 7461 7469 6f6e 3d31 3830 290a  rientation=180).
+00013d70: 0a20 2020 2072 6574 7572 6e20 440a 0a0a  .    return D...
+00013d80: 6465 6620 636f 6d70 6173 735f 6d75 6c74  def compass_mult
+00013d90: 6928 7369 7a65 3d28 342c 2032 292c 2070  i(size=(4, 2), p
+00013da0: 6f72 7473 3d7b 224e 223a 2033 2c20 2253  orts={"N": 3, "S
+00013db0: 223a 2034 7d2c 206c 6179 6572 3d30 293a  ": 4}, layer=0):
+00013dc0: 0a20 2020 2022 2222 4372 6561 7465 7320  .    """Creates 
+00013dd0: 6120 7265 6374 616e 6775 6c61 7220 636f  a rectangular co
+00013de0: 6e74 6163 7420 7061 6420 7769 7468 206d  ntact pad with m
+00013df0: 756c 7469 706c 6520 706f 7274 7320 616c  ultiple ports al
+00013e00: 6f6e 6720 7468 6520 6564 6765 730a 2020  ong the edges.  
+00013e10: 2020 7265 6374 616e 676c 6520 286e 6f72    rectangle (nor
+00013e20: 7468 2c20 736f 7574 682c 2065 6173 742c  th, south, east,
+00013e30: 2061 6e64 2077 6573 7429 2e0a 0a20 2020   and west)...   
+00013e40: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00013e50: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2073  ----------.    s
+00013e60: 697a 6520 3a20 6172 7261 795f 6c69 6b65  ize : array_like
+00013e70: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
+00013e80: 6f6e 7320 6f66 2074 6865 2072 6563 7461  ons of the recta
+00013e90: 6e67 756c 6172 2063 6f6e 7461 6374 2070  ngular contact p
+00013ea0: 6164 2e0a 2020 2020 706f 7274 7320 3a20  ad..    ports : 
+00013eb0: 6469 6374 0a20 2020 2020 2020 204e 756d  dict.        Num
+00013ec0: 6265 7220 6f66 2070 6f72 7473 206f 6e20  ber of ports on 
+00013ed0: 6561 6368 2065 6467 6520 6f66 2074 6865  each edge of the
+00013ee0: 2072 6563 7461 6e67 6c65 2e0a 2020 2020   rectangle..    
+00013ef0: 6c61 7965 7220 3a20 696e 742c 2061 7272  layer : int, arr
+00013f00: 6179 2d6c 696b 655b 325d 2c20 6f72 2073  ay-like[2], or s
+00013f10: 6574 0a20 2020 2020 2020 2053 7065 6369  et.        Speci
+00013f20: 6669 6320 6c61 7965 7228 7329 2074 6f20  fic layer(s) to 
+00013f30: 7075 7420 706f 6c79 676f 6e20 6765 6f6d  put polygon geom
+00013f40: 6574 7279 206f 6e2e 0a0a 2020 2020 5265  etry on...    Re
+00013f50: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00013f60: 2d0a 2020 2020 4420 3a20 4465 7669 6365  -.    D : Device
+00013f70: 0a20 2020 2020 2020 2041 2044 6576 6963  .        A Devic
+00013f80: 6520 636f 6e74 6169 6e69 6e67 2061 2072  e containing a r
+00013f90: 6563 7461 6e67 756c 6172 2063 6f6e 7461  ectangular conta
+00013fa0: 6374 2070 6164 2077 6974 6820 6d75 6c74  ct pad with mult
+00013fb0: 6970 6c65 2070 6f72 7473 2e0a 2020 2020  iple ports..    
+00013fc0: 2222 220a 2020 2020 4420 3d20 4465 7669  """.    D = Devi
+00013fd0: 6365 286e 616d 653d 2263 6f6d 7061 7373  ce(name="compass
+00013fe0: 5f6d 756c 7469 2229 0a20 2020 2072 203d  _multi").    r =
+00013ff0: 2044 2e61 6464 5f72 6566 2872 6563 7461   D.add_ref(recta
+00014000: 6e67 6c65 2873 697a 652c 206c 6179 6572  ngle(size, layer
+00014010: 3d6c 6179 6572 2929 0a20 2020 2072 2e63  =layer)).    r.c
+00014020: 656e 7465 7220 3d20 2830 2c20 3029 0a0a  enter = (0, 0)..
+00014030: 2020 2020 6478 203d 2073 697a 655b 305d      dx = size[0]
+00014040: 202f 2032 0a20 2020 2064 7920 3d20 7369   / 2.    dy = si
+00014050: 7a65 5b31 5d20 2f20 320a 0a20 2020 2069  ze[1] / 2..    i
+00014060: 6620 224e 2220 696e 2070 6f72 7473 3a0a  f "N" in ports:.
+00014070: 2020 2020 2020 2020 6e75 6d5f 706f 7274          num_port
+00014080: 7320 3d20 706f 7274 735b 224e 225d 0a20  s = ports["N"]. 
+00014090: 2020 2020 2020 206d 203d 2064 7820 2d20         m = dx - 
+000140a0: 6478 202f 206e 756d 5f70 6f72 7473 0a20  dx / num_ports. 
+000140b0: 2020 2020 2020 2070 5f6c 6973 7420 3d20         p_list = 
+000140c0: 6e70 2e6c 696e 7370 6163 6528 2d6d 2c20  np.linspace(-m, 
+000140d0: 6d2c 206e 756d 5f70 6f72 7473 290a 2020  m, num_ports).  
+000140e0: 2020 2020 2020 5b0a 2020 2020 2020 2020        [.        
+000140f0: 2020 2020 442e 6164 645f 706f 7274 280a      D.add_port(.
+00014100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014110: 6e61 6d65 3d28 224e 2573 2220 2520 286e  name=("N%s" % (n
+00014120: 202b 2031 2929 2c0a 2020 2020 2020 2020   + 1)),.        
+00014130: 2020 2020 2020 2020 6d69 6470 6f69 6e74          midpoint
+00014140: 3d5b 702c 2064 795d 2c0a 2020 2020 2020  =[p, dy],.      
+00014150: 2020 2020 2020 2020 2020 7769 6474 683d            width=
+00014160: 6478 202f 206e 756d 5f70 6f72 7473 202a  dx / num_ports *
+00014170: 2032 2c0a 2020 2020 2020 2020 2020 2020   2,.            
+00014180: 2020 2020 6f72 6965 6e74 6174 696f 6e3d      orientation=
+00014190: 3930 2c0a 2020 2020 2020 2020 2020 2020  90,.            
+000141a0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+000141b0: 7220 6e2c 2070 2069 6e20 656e 756d 6572  r n, p in enumer
+000141c0: 6174 6528 705f 6c69 7374 290a 2020 2020  ate(p_list).    
+000141d0: 2020 2020 5d0a 2020 2020 6966 2022 5322      ].    if "S"
+000141e0: 2069 6e20 706f 7274 733a 0a20 2020 2020   in ports:.     
+000141f0: 2020 206e 756d 5f70 6f72 7473 203d 2070     num_ports = p
+00014200: 6f72 7473 5b22 5322 5d0a 2020 2020 2020  orts["S"].      
+00014210: 2020 6d20 3d20 6478 202d 2064 7820 2f20    m = dx - dx / 
+00014220: 6e75 6d5f 706f 7274 730a 2020 2020 2020  num_ports.      
+00014230: 2020 705f 6c69 7374 203d 206e 702e 6c69    p_list = np.li
+00014240: 6e73 7061 6365 282d 6d2c 206d 2c20 6e75  nspace(-m, m, nu
+00014250: 6d5f 706f 7274 7329 0a20 2020 2020 2020  m_ports).       
+00014260: 205b 0a20 2020 2020 2020 2020 2020 2044   [.            D
+00014270: 2e61 6464 5f70 6f72 7428 0a20 2020 2020  .add_port(.     
+00014280: 2020 2020 2020 2020 2020 206e 616d 653d             name=
+00014290: 2822 5325 7322 2025 2028 6e20 2b20 3129  ("S%s" % (n + 1)
+000142a0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+000142b0: 2020 206d 6964 706f 696e 743d 5b70 2c20     midpoint=[p, 
+000142c0: 2d64 795d 2c0a 2020 2020 2020 2020 2020  -dy],.          
+000142d0: 2020 2020 2020 7769 6474 683d 6478 202f        width=dx /
+000142e0: 206e 756d 5f70 6f72 7473 202a 2032 2c0a   num_ports * 2,.
+000142f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014300: 6f72 6965 6e74 6174 696f 6e3d 2d39 302c  orientation=-90,
+00014310: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00014320: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
+00014330: 2c20 7020 696e 2065 6e75 6d65 7261 7465  , p in enumerate
+00014340: 2870 5f6c 6973 7429 0a20 2020 2020 2020  (p_list).       
+00014350: 205d 0a20 2020 2069 6620 2245 2220 696e   ].    if "E" in
+00014360: 2070 6f72 7473 3a0a 2020 2020 2020 2020   ports:.        
+00014370: 6e75 6d5f 706f 7274 7320 3d20 706f 7274  num_ports = port
+00014380: 735b 2245 225d 0a20 2020 2020 2020 206d  s["E"].        m
+00014390: 203d 2064 7920 2d20 6479 202f 206e 756d   = dy - dy / num
+000143a0: 5f70 6f72 7473 0a20 2020 2020 2020 2070  _ports.        p
+000143b0: 5f6c 6973 7420 3d20 6e70 2e6c 696e 7370  _list = np.linsp
+000143c0: 6163 6528 2d6d 2c20 6d2c 206e 756d 5f70  ace(-m, m, num_p
+000143d0: 6f72 7473 290a 2020 2020 2020 2020 5b0a  orts).        [.
+000143e0: 2020 2020 2020 2020 2020 2020 442e 6164              D.ad
+000143f0: 645f 706f 7274 280a 2020 2020 2020 2020  d_port(.        
+00014400: 2020 2020 2020 2020 6e61 6d65 3d28 2245          name=("E
+00014410: 2573 2220 2520 286e 202b 2031 2929 2c0a  %s" % (n + 1)),.
+00014420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014430: 6d69 6470 6f69 6e74 3d5b 6478 2c20 705d  midpoint=[dx, p]
+00014440: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014450: 2020 7769 6474 683d 6479 202f 206e 756d    width=dy / num
+00014460: 5f70 6f72 7473 202a 2032 2c0a 2020 2020  _ports * 2,.    
+00014470: 2020 2020 2020 2020 2020 2020 6f72 6965              orie
+00014480: 6e74 6174 696f 6e3d 302c 0a20 2020 2020  ntation=0,.     
+00014490: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000144a0: 2020 2020 2066 6f72 206e 2c20 7020 696e       for n, p in
+000144b0: 2065 6e75 6d65 7261 7465 2870 5f6c 6973   enumerate(p_lis
+000144c0: 7429 0a20 2020 2020 2020 205d 0a20 2020  t).        ].   
+000144d0: 2069 6620 2257 2220 696e 2070 6f72 7473   if "W" in ports
+000144e0: 3a0a 2020 2020 2020 2020 6e75 6d5f 706f  :.        num_po
+000144f0: 7274 7320 3d20 706f 7274 735b 2257 225d  rts = ports["W"]
+00014500: 0a20 2020 2020 2020 206d 203d 2064 7920  .        m = dy 
+00014510: 2d20 6479 202f 206e 756d 5f70 6f72 7473  - dy / num_ports
+00014520: 0a20 2020 2020 2020 2070 5f6c 6973 7420  .        p_list 
+00014530: 3d20 6e70 2e6c 696e 7370 6163 6528 2d6d  = np.linspace(-m
+00014540: 2c20 6d2c 206e 756d 5f70 6f72 7473 290a  , m, num_ports).
+00014550: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
+00014560: 2020 2020 2020 442e 6164 645f 706f 7274        D.add_port
+00014570: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00014580: 2020 6e61 6d65 3d28 2257 2573 2220 2520    name=("W%s" % 
+00014590: 286e 202b 2031 2929 2c0a 2020 2020 2020  (n + 1)),.      
+000145a0: 2020 2020 2020 2020 2020 6d69 6470 6f69            midpoi
+000145b0: 6e74 3d5b 2d64 782c 2070 5d2c 0a20 2020  nt=[-dx, p],.   
+000145c0: 2020 2020 2020 2020 2020 2020 2077 6964               wid
+000145d0: 7468 3d64 7920 2f20 6e75 6d5f 706f 7274  th=dy / num_port
+000145e0: 7320 2a20 322c 0a20 2020 2020 2020 2020  s * 2,.         
+000145f0: 2020 2020 2020 206f 7269 656e 7461 7469         orientati
+00014600: 6f6e 3d31 3830 2c0a 2020 2020 2020 2020  on=180,.        
+00014610: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00014620: 2020 666f 7220 6e2c 2070 2069 6e20 656e    for n, p in en
+00014630: 756d 6572 6174 6528 705f 6c69 7374 290a  umerate(p_list).
+00014640: 2020 2020 2020 2020 5d0a 0a20 2020 2072          ]..    r
+00014650: 6574 7572 6e20 440a 0a0a 2320 544f 444f  eturn D...# TODO
+00014660: 3a20 4669 7820 7468 6520 6669 6c6c 6574  : Fix the fillet
+00014670: 2068 6572 652c 2072 6967 6874 206e 6f77   here, right now
+00014680: 206f 6e6c 7920 676f 6573 2068 616c 6677   only goes halfw
+00014690: 6179 2064 6f77 6e0a 6465 6620 666c 6167  ay down.def flag
+000146a0: 706f 6c65 2873 697a 653d 2834 2c20 3229  pole(size=(4, 2)
+000146b0: 2c20 7374 7562 5f73 697a 653d 2832 2c20  , stub_size=(2, 
+000146c0: 3129 2c20 7368 6170 653d 2270 222c 2074  1), shape="p", t
+000146d0: 6170 6572 5f74 7970 653d 2273 7472 6169  aper_type="strai
+000146e0: 6768 7422 2c20 6c61 7965 723d 3029 3a0a  ght", layer=0):.
+000146f0: 2020 2020 2222 2243 7265 6174 6573 2061      """Creates a
+00014700: 2066 6c61 6770 6f6c 6520 6765 6f6d 6574   flagpole geomet
+00014710: 7279 206f 6620 6f6e 6520 6f66 2066 6f75  ry of one of fou
+00014720: 7220 636f 6e66 6967 7572 6174 696f 6e73  r configurations
+00014730: 2c20 616c 6c0a 2020 2020 696e 766f 6c76  , all.    involv
+00014740: 696e 6720 6120 7665 7274 6963 616c 2063  ing a vertical c
+00014750: 656e 7472 616c 2063 6f6c 756d 6e20 616e  entral column an
+00014760: 6420 6120 6f75 7477 6172 642d 706f 696e  d a outward-poin
+00014770: 7469 6e67 2066 6c61 672e 0a0a 2020 2020  ting flag...    
+00014780: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+00014790: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 7369  ---------.    si
+000147a0: 7a65 203a 2061 7272 6179 2d6c 696b 650a  ze : array-like.
+000147b0: 2020 2020 2020 2020 2877 6964 7468 2c20          (width, 
+000147c0: 6865 6967 6874 2920 6f66 2074 6865 2066  height) of the f
+000147d0: 6c61 672e 0a20 2020 2073 7475 625f 7369  lag..    stub_si
+000147e0: 7a65 203a 2061 7272 6179 2d6c 696b 650a  ze : array-like.
+000147f0: 2020 2020 2020 2020 2877 6964 7468 2c20          (width, 
+00014800: 6865 6967 6874 2920 6f66 2074 6865 2070  height) of the p
+00014810: 6f6c 6520 7374 7562 2e0a 2020 2020 7368  ole stub..    sh
+00014820: 6170 6520 3a20 7b27 7027 2c20 2771 272c  ape : {'p', 'q',
+00014830: 2027 6227 2c20 2764 277d 0a20 2020 2020   'b', 'd'}.     
+00014840: 2020 2043 6f6e 6669 6775 7261 7469 6f6e     Configuration
+00014850: 206f 6620 7468 6520 666c 6167 706f 6c65   of the flagpole
+00014860: 2c20 7768 6572 6520 7468 6520 6375 7276  , where the curv
+00014870: 6564 2070 6f72 7469 6f6e 206f 6620 7468  ed portion of th
+00014880: 650a 2020 2020 2020 2020 6c65 7474 6572  e.        letter
+00014890: 7320 7265 7072 6573 656e 7473 2074 6865  s represents the
+000148a0: 2066 6c61 6720 616e 6420 7468 6520 7374   flag and the st
+000148b0: 7261 6967 6874 2070 6f72 7469 6f6e 2074  raight portion t
+000148c0: 6865 2070 6f6c 652e 0a20 2020 2074 6170  he pole..    tap
+000148d0: 6572 5f74 7970 6520 3a20 7b27 7374 7261  er_type : {'stra
+000148e0: 6967 6874 272c 2027 6669 6c6c 6574 272c  ight', 'fillet',
+000148f0: 204e 6f6e 657d 0a20 2020 2020 2020 2054   None}.        T
+00014900: 7970 6520 6f66 2074 6170 6572 2062 6574  ype of taper bet
+00014910: 7765 656e 2074 6865 2062 6f74 746f 6d20  ween the bottom 
+00014920: 636f 726e 6572 206f 6620 7468 6520 7374  corner of the st
+00014930: 7562 206f 6e20 7468 6520 7369 6465 206f  ub on the side o
+00014940: 660a 2020 2020 2020 2020 7468 6520 666c  f.        the fl
+00014950: 6167 2061 6e64 2074 6865 2063 6f72 6e65  ag and the corne
+00014960: 7220 6f66 2074 6865 2066 6c61 6720 636c  r of the flag cl
+00014970: 6f73 6573 7420 746f 2074 6865 2073 7475  osest to the stu
+00014980: 622e 0a20 2020 206c 6179 6572 203a 2069  b..    layer : i
+00014990: 6e74 2c20 6172 7261 792d 6c69 6b65 5b32  nt, array-like[2
+000149a0: 5d2c 206f 7220 7365 740a 2020 2020 2020  ], or set.      
+000149b0: 2020 5370 6563 6966 6963 206c 6179 6572    Specific layer
+000149c0: 2873 2920 746f 2070 7574 2070 6f6c 7967  (s) to put polyg
+000149d0: 6f6e 2067 656f 6d65 7472 7920 6f6e 2e0a  on geometry on..
+000149e0: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
+000149f0: 202d 2d2d 2d2d 2d2d 0a20 2020 2044 203a   -------.    D :
+00014a00: 2044 6576 6963 650a 2020 2020 2020 2020   Device.        
+00014a10: 4120 4465 7669 6365 2063 6f6e 7461 696e  A Device contain
+00014a20: 696e 6720 6120 666c 6167 706f 6c65 2067  ing a flagpole g
+00014a30: 656f 6d65 7472 792e 0a20 2020 2022 2222  eometry..    """
+00014a40: 0a20 2020 2066 203d 206e 702e 6172 7261  .    f = np.arra
+00014a50: 7928 7369 7a65 290a 2020 2020 7020 3d20  y(size).    p = 
+00014a60: 6e70 2e61 7272 6179 2873 7475 625f 7369  np.array(stub_si
+00014a70: 7a65 290a 2020 2020 7368 6170 6520 3d20  ze).    shape = 
+00014a80: 7368 6170 652e 6c6f 7765 7228 290a 0a20  shape.lower().. 
+00014a90: 2020 2061 7373 6572 7420 7368 6170 6520     assert shape 
+00014aa0: 696e 2022 7071 6264 222c 2022 5b44 4556  in "pqbd", "[DEV
+00014ab0: 4943 455d 2020 666c 6167 706f 6c65 2829  ICE]  flagpole()
+00014ac0: 2073 6861 7065 206d 7573 7420 6265 2070   shape must be p
+00014ad0: 2c20 712c 2062 2c20 6f72 2064 220a 2020  , q, b, or d".  
+00014ae0: 2020 6173 7365 7274 2074 6170 6572 5f74    assert taper_t
+00014af0: 7970 6520 696e 205b 2273 7472 6169 6768  ype in ["straigh
+00014b00: 7422 2c20 2266 696c 6c65 7422 2c20 4e6f  t", "fillet", No
+00014b10: 6e65 5d2c 2028 0a20 2020 2020 2020 2027  ne], (.        '
+00014b20: 5b44 4556 4943 455d 2020 666c 6167 706f  [DEVICE]  flagpo
+00014b30: 6c65 2829 2074 6170 6572 5f74 7970 6520  le() taper_type 
+00014b40: 6d75 7374 2022 7374 7261 6967 6874 2220  must "straight" 
+00014b50: 2720 2720 6f72 2022 6669 6c6c 6574 2220  ' ' or "fillet" 
+00014b60: 6f72 204e 6f6e 6527 0a20 2020 2029 0a0a  or None'.    )..
+00014b70: 2020 2020 6966 2073 6861 7065 203d 3d20      if shape == 
+00014b80: 2270 223a 0a20 2020 2020 2020 206f 7269  "p":.        ori
+00014b90: 656e 7461 7469 6f6e 203d 202d 3930 0a20  entation = -90. 
+00014ba0: 2020 2065 6c69 6620 7368 6170 6520 3d3d     elif shape ==
+00014bb0: 2022 7122 3a0a 2020 2020 2020 2020 665b   "q":.        f[
+00014bc0: 305d 2c20 705b 305d 203d 202d 7369 7a65  0], p[0] = -size
+00014bd0: 5b30 5d2c 202d 7374 7562 5f73 697a 655b  [0], -stub_size[
+00014be0: 305d 0a20 2020 2020 2020 206f 7269 656e  0].        orien
+00014bf0: 7461 7469 6f6e 203d 202d 3930 0a20 2020  tation = -90.   
+00014c00: 2065 6c69 6620 7368 6170 6520 3d3d 2022   elif shape == "
+00014c10: 6222 3a0a 2020 2020 2020 2020 665b 315d  b":.        f[1]
+00014c20: 2c20 705b 315d 203d 202d 7369 7a65 5b31  , p[1] = -size[1
+00014c30: 5d2c 202d 7374 7562 5f73 697a 655b 315d  ], -stub_size[1]
+00014c40: 0a20 2020 2020 2020 206f 7269 656e 7461  .        orienta
+00014c50: 7469 6f6e 203d 2039 300a 2020 2020 656c  tion = 90.    el
+00014c60: 6966 2073 6861 7065 203d 3d20 2264 223a  if shape == "d":
+00014c70: 0a20 2020 2020 2020 2066 5b31 5d2c 2070  .        f[1], p
+00014c80: 5b31 5d20 3d20 2d73 697a 655b 315d 2c20  [1] = -size[1], 
+00014c90: 2d73 7475 625f 7369 7a65 5b31 5d0a 2020  -stub_size[1].  
+00014ca0: 2020 2020 2020 665b 305d 2c20 705b 305d        f[0], p[0]
+00014cb0: 203d 202d 7369 7a65 5b30 5d2c 202d 7374   = -size[0], -st
+00014cc0: 7562 5f73 697a 655b 305d 0a20 2020 2020  ub_size[0].     
+00014cd0: 2020 206f 7269 656e 7461 7469 6f6e 203d     orientation =
+00014ce0: 2039 300a 2020 2020 7870 7473 203d 205b   90.    xpts = [
+00014cf0: 302c 2030 2c20 665b 305d 2c20 665b 305d  0, 0, f[0], f[0]
+00014d00: 2c20 705b 305d 2c20 705b 305d 2c20 305d  , p[0], p[0], 0]
+00014d10: 0a20 2020 2079 7074 7320 3d20 5b30 2c20  .    ypts = [0, 
+00014d20: 665b 315d 2c20 665b 315d 2c20 302c 2030  f[1], f[1], 0, 0
+00014d30: 2c20 2d70 5b31 5d2c 202d 705b 315d 5d0a  , -p[1], -p[1]].
+00014d40: 0a20 2020 2044 203d 2044 6576 6963 6528  .    D = Device(
+00014d50: 6e61 6d65 3d22 666c 6167 706f 6c65 2229  name="flagpole")
+00014d60: 0a20 2020 2070 6164 5f70 6f6c 7920 3d20  .    pad_poly = 
+00014d70: 442e 6164 645f 706f 6c79 676f 6e28 5b78  D.add_polygon([x
+00014d80: 7074 732c 2079 7074 735d 2c20 6c61 7965  pts, ypts], laye
+00014d90: 723d 6c61 7965 7229 0a20 2020 2069 6620  r=layer).    if 
+00014da0: 7461 7065 725f 7479 7065 203d 3d20 2266  taper_type == "f
+00014db0: 696c 6c65 7422 3a0a 2020 2020 2020 2020  illet":.        
+00014dc0: 7461 7065 725f 616d 6f75 6e74 203d 206d  taper_amount = m
+00014dd0: 696e 285b 6162 7328 665b 305d 202d 2070  in([abs(f[0] - p
+00014de0: 5b30 5d29 2c20 6162 7328 705b 315d 295d  [0]), abs(p[1])]
+00014df0: 290a 2020 2020 2020 2020 7061 645f 706f  ).        pad_po
+00014e00: 6c79 2e66 696c 6c65 7428 5b30 2c20 302c  ly.fillet([0, 0,
+00014e10: 2030 2c20 302c 2074 6170 6572 5f61 6d6f   0, 0, taper_amo
+00014e20: 756e 742c 2030 2c20 305d 290a 2020 2020  unt, 0, 0]).    
+00014e30: 656c 6966 2074 6170 6572 5f74 7970 6520  elif taper_type 
+00014e40: 3d3d 2022 7374 7261 6967 6874 223a 0a20  == "straight":. 
+00014e50: 2020 2020 2020 2044 2e61 6464 5f70 6f6c         D.add_pol
+00014e60: 7967 6f6e 285b 7870 7473 5b33 3a36 5d2c  ygon([xpts[3:6],
+00014e70: 2079 7074 735b 333a 365d 5d2c 206c 6179   ypts[3:6]], lay
+00014e80: 6572 3d6c 6179 6572 290a 0a20 2020 2044  er=layer)..    D
+00014e90: 2e61 6464 5f70 6f72 7428 0a20 2020 2020  .add_port(.     
+00014ea0: 2020 206e 616d 653d 312c 206d 6964 706f     name=1, midpo
+00014eb0: 696e 743d 5b70 5b30 5d20 2f20 322c 202d  int=[p[0] / 2, -
+00014ec0: 705b 315d 5d2c 2077 6964 7468 3d61 6273  p[1]], width=abs
+00014ed0: 2870 5b30 5d29 2c20 6f72 6965 6e74 6174  (p[0]), orientat
+00014ee0: 696f 6e3d 6f72 6965 6e74 6174 696f 6e0a  ion=orientation.
+00014ef0: 2020 2020 290a 2020 2020 442e 6164 645f      ).    D.add_
+00014f00: 706f 7274 280a 2020 2020 2020 2020 6e61  port(.        na
+00014f10: 6d65 3d32 2c0a 2020 2020 2020 2020 6d69  me=2,.        mi
+00014f20: 6470 6f69 6e74 3d5b 665b 305d 202f 2032  dpoint=[f[0] / 2
+00014f30: 2c20 665b 315d 5d2c 0a20 2020 2020 2020  , f[1]],.       
+00014f40: 2077 6964 7468 3d61 6273 2866 5b30 5d29   width=abs(f[0])
+00014f50: 2c0a 2020 2020 2020 2020 6f72 6965 6e74  ,.        orient
+00014f60: 6174 696f 6e3d 6f72 6965 6e74 6174 696f  ation=orientatio
+00014f70: 6e20 2d20 3138 302c 0a20 2020 2029 0a20  n - 180,.    ). 
+00014f80: 2020 2072 6574 7572 6e20 440a 0a0a 6465     return D...de
+00014f90: 6620 7465 6528 7369 7a65 3d28 342c 2032  f tee(size=(4, 2
+00014fa0: 292c 2073 7475 625f 7369 7a65 3d28 322c  ), stub_size=(2,
+00014fb0: 2031 292c 2074 6170 6572 5f74 7970 653d   1), taper_type=
+00014fc0: 4e6f 6e65 2c20 6c61 7965 723d 3029 3a0a  None, layer=0):.
+00014fd0: 2020 2020 2222 2243 7265 6174 6573 2061      """Creates a
+00014fe0: 2054 2d73 6861 7065 6420 6765 6f6d 6574   T-shaped geomet
+00014ff0: 7279 2e0a 0a20 2020 2050 6172 616d 6574  ry...    Paramet
+00015000: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+00015010: 2d2d 0a20 2020 2073 697a 6520 3a20 6172  --.    size : ar
+00015020: 7261 792d 6c69 6b65 0a20 2020 2020 2020  ray-like.       
+00015030: 2028 7769 6474 682c 2068 6569 6768 7429   (width, height)
+00015040: 206f 6620 7468 6520 686f 7269 7a6f 6e74   of the horizont
+00015050: 616c 2074 6f70 2070 6172 7420 6f66 2074  al top part of t
+00015060: 6865 2054 2073 6861 7065 2e0a 2020 2020  he T shape..    
+00015070: 7374 7562 5f73 697a 6520 3a20 6172 7261  stub_size : arra
+00015080: 792d 6c69 6b65 0a20 2020 2020 2020 2028  y-like.        (
+00015090: 7769 6474 682c 2068 6569 6768 7429 206f  width, height) o
+000150a0: 6620 7468 6520 7665 7274 6963 616c 2073  f the vertical s
+000150b0: 7475 6220 7061 7274 206f 6620 7468 6520  tub part of the 
+000150c0: 5420 7368 6170 652e 0a20 2020 2074 6170  T shape..    tap
+000150d0: 6572 5f74 7970 6520 3a20 7b27 7374 7261  er_type : {'stra
+000150e0: 6967 6874 272c 2027 6669 6c6c 6574 272c  ight', 'fillet',
+000150f0: 204e 6f6e 657d 0a20 2020 2020 2020 2049   None}.        I
+00015100: 6620 7370 6563 6966 6965 642c 2074 6865  f specified, the
+00015110: 2074 7970 6520 6f66 2074 6170 6572 2062   type of taper b
+00015120: 6574 7765 656e 2074 6865 2062 6f74 746f  etween the botto
+00015130: 6d20 636f 726e 6572 7320 6f66 2074 6865  m corners of the
+00015140: 2073 7475 620a 2020 2020 2020 2020 616e   stub.        an
+00015150: 6420 7468 6520 626f 7474 6f6d 2063 6f72  d the bottom cor
+00015160: 6e65 7273 206f 6620 7468 6520 5420 7368  ners of the T sh
+00015170: 6170 652e 0a20 2020 206c 6179 6572 203a  ape..    layer :
+00015180: 2069 6e74 2c20 6172 7261 792d 6c69 6b65   int, array-like
+00015190: 5b32 5d2c 206f 7220 7365 740a 2020 2020  [2], or set.    
+000151a0: 2020 2020 5370 6563 6966 6963 206c 6179      Specific lay
+000151b0: 6572 2873 2920 746f 2070 7574 2070 6f6c  er(s) to put pol
+000151c0: 7967 6f6e 2067 656f 6d65 7472 7920 6f6e  ygon geometry on
+000151d0: 2e0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
+000151e0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2044     -------.    D
+000151f0: 203a 2044 6576 6963 650a 2020 2020 2020   : Device.      
+00015200: 2020 4120 4465 7669 6365 2063 6f6e 7461    A Device conta
+00015210: 696e 696e 6720 6120 542d 7368 6170 6564  ining a T-shaped
+00015220: 2067 656f 6d65 7472 792e 0a20 2020 2022   geometry..    "
+00015230: 2222 0a20 2020 2066 203d 206e 702e 6172  "".    f = np.ar
+00015240: 7261 7928 7369 7a65 290a 2020 2020 7020  ray(size).    p 
+00015250: 3d20 6e70 2e61 7272 6179 2873 7475 625f  = np.array(stub_
+00015260: 7369 7a65 290a 0a20 2020 2078 7074 7320  size)..    xpts 
+00015270: 3d20 6e70 2e61 7272 6179 285b 665b 305d  = np.array([f[0]
+00015280: 2c20 665b 305d 2c20 705b 305d 2c20 705b  , f[0], p[0], p[
+00015290: 305d 2c20 2d70 5b30 5d2c 202d 705b 305d  0], -p[0], -p[0]
+000152a0: 2c20 2d66 5b30 5d2c 202d 665b 305d 5d29  , -f[0], -f[0]])
+000152b0: 202f 2032 0a20 2020 2079 7074 7320 3d20   / 2.    ypts = 
+000152c0: 5b66 5b31 5d2c 2030 2c20 302c 202d 705b  [f[1], 0, 0, -p[
+000152d0: 315d 2c20 2d70 5b31 5d2c 2030 2c20 302c  1], -p[1], 0, 0,
+000152e0: 2066 5b31 5d5d 0a0a 2020 2020 4420 3d20   f[1]]..    D = 
+000152f0: 4465 7669 6365 286e 616d 653d 2274 6565  Device(name="tee
+00015300: 2229 0a20 2020 2070 6164 5f70 6f6c 7920  ").    pad_poly 
+00015310: 3d20 442e 6164 645f 706f 6c79 676f 6e28  = D.add_polygon(
+00015320: 5b78 7074 732c 2079 7074 735d 2c20 6c61  [xpts, ypts], la
+00015330: 7965 723d 6c61 7965 7229 0a20 2020 2069  yer=layer).    i
+00015340: 6620 7461 7065 725f 7479 7065 203d 3d20  f taper_type == 
+00015350: 2266 696c 6c65 7422 3a0a 2020 2020 2020  "fillet":.      
+00015360: 2020 7461 7065 725f 616d 6f75 6e74 203d    taper_amount =
+00015370: 206d 696e 285b 6162 7328 665b 305d 202d   min([abs(f[0] -
+00015380: 2070 5b30 5d29 2c20 6162 7328 705b 315d   p[0]), abs(p[1]
+00015390: 295d 290a 2020 2020 2020 2020 7061 645f  )]).        pad_
+000153a0: 706f 6c79 2e66 696c 6c65 7428 5b30 2c20  poly.fillet([0, 
+000153b0: 302c 2074 6170 6572 5f61 6d6f 756e 742c  0, taper_amount,
+000153c0: 2030 2c20 302c 2074 6170 6572 5f61 6d6f   0, 0, taper_amo
+000153d0: 756e 742c 2030 2c20 305d 290a 2020 2020  unt, 0, 0]).    
+000153e0: 656c 6966 2074 6170 6572 5f74 7970 6520  elif taper_type 
+000153f0: 3d3d 2022 7374 7261 6967 6874 223a 0a20  == "straight":. 
+00015400: 2020 2020 2020 2044 2e61 6464 5f70 6f6c         D.add_pol
+00015410: 7967 6f6e 285b 7870 7473 5b31 3a34 5d2c  ygon([xpts[1:4],
+00015420: 2079 7074 735b 313a 345d 5d2c 206c 6179   ypts[1:4]], lay
+00015430: 6572 3d6c 6179 6572 2920 2023 2074 6170  er=layer)  # tap
+00015440: 6572 5f70 6f6c 7931 0a20 2020 2020 2020  er_poly1.       
+00015450: 2044 2e61 6464 5f70 6f6c 7967 6f6e 285b   D.add_polygon([
+00015460: 7870 7473 5b34 3a37 5d2c 2079 7074 735b  xpts[4:7], ypts[
+00015470: 343a 375d 5d2c 206c 6179 6572 3d6c 6179  4:7]], layer=lay
+00015480: 6572 2920 2023 2074 6170 6572 5f70 6f6c  er)  # taper_pol
+00015490: 7932 0a0a 2020 2020 442e 6164 645f 706f  y2..    D.add_po
+000154a0: 7274 286e 616d 653d 312c 206d 6964 706f  rt(name=1, midpo
+000154b0: 696e 743d 5b66 5b30 5d20 2f20 322c 2066  int=[f[0] / 2, f
+000154c0: 5b31 5d20 2f20 325d 2c20 7769 6474 683d  [1] / 2], width=
+000154d0: 665b 315d 2c20 6f72 6965 6e74 6174 696f  f[1], orientatio
+000154e0: 6e3d 3029 0a20 2020 2044 2e61 6464 5f70  n=0).    D.add_p
+000154f0: 6f72 7428 6e61 6d65 3d32 2c20 6d69 6470  ort(name=2, midp
+00015500: 6f69 6e74 3d5b 2d66 5b30 5d20 2f20 322c  oint=[-f[0] / 2,
+00015510: 2066 5b31 5d20 2f20 325d 2c20 7769 6474   f[1] / 2], widt
+00015520: 683d 665b 315d 2c20 6f72 6965 6e74 6174  h=f[1], orientat
+00015530: 696f 6e3d 3138 3029 0a20 2020 2044 2e61  ion=180).    D.a
+00015540: 6464 5f70 6f72 7428 6e61 6d65 3d33 2c20  dd_port(name=3, 
+00015550: 6d69 6470 6f69 6e74 3d5b 302c 202d 705b  midpoint=[0, -p[
+00015560: 315d 5d2c 2077 6964 7468 3d70 5b30 5d2c  1]], width=p[0],
+00015570: 206f 7269 656e 7461 7469 6f6e 3d2d 3930   orientation=-90
+00015580: 290a 2020 2020 7265 7475 726e 2044 0a0a  ).    return D..
+00015590: 0a23 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  .# =============
+000155a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000155b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000155c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000155d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000155e0: 3d0a 2320 4578 616d 706c 6520 636f 6465  =.# Example code
+000155f0: 0a23 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  .# =============
+00015600: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00015610: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00015620: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00015630: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00015640: 3d0a 0a23 2063 7020 3d20 636f 6d70 6173  =..# cp = compas
+00015650: 7328 7369 7a65 203d 205b 342c 325d 290a  s(size = [4,2]).
+00015660: 2320 7175 6963 6b70 6c6f 7428 6370 290a  # quickplot(cp).
+00015670: 0a0a 2320 6370 6d20 3d20 636f 6d70 6173  ..# cpm = compas
+00015680: 735f 6d75 6c74 6928 7369 7a65 203d 205b  s_multi(size = [
+00015690: 3430 2c32 305d 2c20 706f 7274 7320 3d20  40,20], ports = 
+000156a0: 7b27 4e27 3a33 2c27 5327 3a34 2c20 2745  {'N':3,'S':4, 'E
+000156b0: 273a 312c 2027 5727 3a38 7d2c 206c 6179  ':1, 'W':8}, lay
+000156c0: 6572 203d 2030 290a 2320 7175 6963 6b70  er = 0).# quickp
+000156d0: 6c6f 7428 6370 6d29 0a0a 0a23 2063 706d  lot(cpm)...# cpm
+000156e0: 203d 2063 6f6d 7061 7373 5f6d 756c 7469   = compass_multi
+000156f0: 2873 697a 6520 3d20 5b34 302c 3230 5d2c  (size = [40,20],
+00015700: 2070 6f72 7473 203d 207b 274e 273a 332c   ports = {'N':3,
+00015710: 2753 273a 342c 2027 4527 3a31 2c20 2757  'S':4, 'E':1, 'W
+00015720: 273a 387d 2c20 6c61 7965 7220 3d20 3029  ':8}, layer = 0)
+00015730: 0a23 2069 6e73 6574 5f70 6f6c 7967 6f6e  .# inset_polygon
+00015740: 203d 206f 6666 7365 7428 6370 6d2c 2064   = offset(cpm, d
+00015750: 6973 7461 6e63 6520 3d20 2d32 2c20 6c61  istance = -2, la
+00015760: 7965 7220 3d20 3129 0a23 2063 706d 2e61  yer = 1).# cpm.a
+00015770: 6464 5f70 6f6c 7967 6f6e 2869 6e73 6574  dd_polygon(inset
+00015780: 5f70 6f6c 7967 6f6e 290a 2320 7175 6963  _polygon).# quic
+00015790: 6b70 6c6f 7428 6370 6d29 0a0a 2320 6670  kplot(cpm)..# fp
+000157a0: 203d 2066 6c61 6770 6f6c 6528 7369 7a65   = flagpole(size
+000157b0: 203d 205b 342c 325d 2c20 7374 7562 5f73   = [4,2], stub_s
+000157c0: 697a 6520 3d20 5b32 2c31 5d2c 2073 6861  ize = [2,1], sha
+000157d0: 7065 203d 2027 7027 2c20 7461 7065 725f  pe = 'p', taper_
+000157e0: 7479 7065 203d 2027 7374 7261 6967 6874  type = 'straight
+000157f0: 272c 206c 6179 6572 203d 2030 290a 2320  ', layer = 0).# 
+00015800: 7175 6963 6b70 6c6f 7428 6670 290a 0a0a  quickplot(fp)...
+00015810: 2320 7470 203d 2074 6565 2873 697a 6520  # tp = tee(size 
+00015820: 3d20 5b34 2c32 5d2c 2073 7475 625f 7369  = [4,2], stub_si
+00015830: 7a65 203d 205b 322c 315d 2c20 7461 7065  ze = [2,1], tape
+00015840: 725f 7479 7065 203d 2027 6669 6c6c 6574  r_type = 'fillet
+00015850: 272c 206c 6179 6572 203d 2030 290a 2320  ', layer = 0).# 
+00015860: 7175 6963 6b70 6c6f 7428 7470 290a 0a0a  quickplot(tp)...
+00015870: 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  # ==============
+00015880: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00015890: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000158a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000158b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000158c0: 0a23 0a23 2054 6170 6572 730a 230a 2320  .#.# Tapers.#.# 
+000158d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000158e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000158f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00015900: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00015910: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a0a  ==============..
+00015920: 0a64 6566 2074 6170 6572 286c 656e 6774  .def taper(lengt
+00015930: 683d 3130 2c20 7769 6474 6831 3d35 2c20  h=10, width1=5, 
+00015940: 7769 6474 6832 3d4e 6f6e 652c 2070 6f72  width2=None, por
+00015950: 743d 4e6f 6e65 2c20 6c61 7965 723d 3029  t=None, layer=0)
+00015960: 3a0a 2020 2020 2222 2243 7265 6174 6573  :.    """Creates
+00015970: 2061 2074 6170 6572 6564 2074 7261 7065   a tapered trape
+00015980: 7a6f 6964 2f72 6563 7461 6e67 6c65 2067  zoid/rectangle g
+00015990: 656f 6d65 7472 792e 0a0a 2020 2020 5061  eometry...    Pa
+000159a0: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
+000159b0: 2d2d 2d2d 2d2d 2d0a 2020 2020 6c65 6e67  -------.    leng
+000159c0: 7468 203a 2069 6e74 206f 7220 666c 6f61  th : int or floa
+000159d0: 740a 2020 2020 2020 2020 4c65 6e67 7468  t.        Length
+000159e0: 206f 6620 7468 6520 7368 6170 652e 0a20   of the shape.. 
+000159f0: 2020 2077 6964 7468 3120 3a20 696e 742c     width1 : int,
+00015a00: 2066 6c6f 6174 2c20 6f72 204e 6f6e 650a   float, or None.
+00015a10: 2020 2020 2020 2020 5769 6474 6820 6f66          Width of
+00015a20: 2065 6e64 2031 206f 6620 7468 6520 7461   end 1 of the ta
+00015a30: 7065 7220 7365 6374 696f 6e20 2877 6964  per section (wid
+00015a40: 7468 2069 7320 6571 7561 6c20 746f 2074  th is equal to t
+00015a50: 6865 2070 6f72 7420 7769 6474 680a 2020  he port width.  
+00015a60: 2020 2020 2020 6966 2050 6f72 7420 6973        if Port is
+00015a70: 206e 6f74 204e 6f6e 6520 616e 6420 7769   not None and wi
+00015a80: 6474 6831 2069 7320 4e6f 6e65 292e 0a20  dth1 is None).. 
+00015a90: 2020 2077 6964 7468 3220 3a20 696e 742c     width2 : int,
+00015aa0: 2066 6c6f 6174 2c20 6f72 204e 6f6e 650a   float, or None.
+00015ab0: 2020 2020 2020 2020 5769 6474 6820 6f66          Width of
+00015ac0: 2065 6e64 2032 206f 6620 7468 6520 7461   end 2 of the ta
+00015ad0: 7065 7220 7365 6374 696f 6e20 2877 6964  per section (wid
+00015ae0: 7468 2069 7320 6571 7561 6c20 746f 2074  th is equal to t
+00015af0: 6865 2070 6f72 7420 7769 6474 680a 2020  he port width.  
+00015b00: 2020 2020 2020 6966 2050 6f72 7420 6973        if Port is
+00015b10: 206e 6f74 204e 6f6e 6520 616e 6420 7769   not None and wi
+00015b20: 6474 6832 2069 7320 4e6f 6e65 292e 0a20  dth2 is None).. 
+00015b30: 2020 2070 6f72 7420 3a20 506f 7274 206f     port : Port o
+00015b40: 7220 4e6f 6e65 0a20 2020 2020 2020 2050  r None.        P
+00015b50: 6f72 7420 7769 7468 2077 6869 6368 2074  ort with which t
+00015b60: 6f20 6d61 7463 6820 7468 6520 7769 6474  o match the widt
+00015b70: 6820 6f66 2074 6865 2074 6170 6572 2065  h of the taper e
+00015b80: 6e64 732e 0a20 2020 206c 6179 6572 203a  nds..    layer :
+00015b90: 2069 6e74 2c20 6172 7261 792d 6c69 6b65   int, array-like
+00015ba0: 5b32 5d2c 206f 7220 7365 740a 2020 2020  [2], or set.    
+00015bb0: 2020 2020 5370 6563 6966 6963 206c 6179      Specific lay
+00015bc0: 6572 2873 2920 746f 2070 7574 2070 6f6c  er(s) to put pol
+00015bd0: 7967 6f6e 2067 656f 6d65 7472 7920 6f6e  ygon geometry on
+00015be0: 2e0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
+00015bf0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2044     -------.    D
+00015c00: 3a20 4465 7669 6365 0a20 2020 2020 2020  : Device.       
+00015c10: 2041 2044 6576 6963 6520 636f 6e74 6169   A Device contai
+00015c20: 6e69 6e67 2061 2074 6170 6572 2067 656f  ning a taper geo
+00015c30: 6d65 7472 792e 0a20 2020 2022 2222 0a20  metry..    """. 
+00015c40: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00015c50: 2870 6f72 742c 2050 6f72 7429 2061 6e64  (port, Port) and
+00015c60: 2077 6964 7468 3120 6973 204e 6f6e 653a   width1 is None:
+00015c70: 0a20 2020 2020 2020 2077 6964 7468 3120  .        width1 
+00015c80: 3d20 706f 7274 2e77 6964 7468 0a20 2020  = port.width.   
+00015c90: 2069 6620 7769 6474 6832 2069 7320 4e6f   if width2 is No
+00015ca0: 6e65 3a0a 2020 2020 2020 2020 7769 6474  ne:.        widt
+00015cb0: 6832 203d 2077 6964 7468 310a 2020 2020  h2 = width1.    
+00015cc0: 7870 7473 203d 205b 302c 206c 656e 6774  xpts = [0, lengt
+00015cd0: 682c 206c 656e 6774 682c 2030 5d0a 2020  h, length, 0].  
+00015ce0: 2020 7970 7473 203d 205b 7769 6474 6831    ypts = [width1
+00015cf0: 202f 2032 2c20 7769 6474 6832 202f 2032   / 2, width2 / 2
+00015d00: 2c20 2d77 6964 7468 3220 2f20 322c 202d  , -width2 / 2, -
+00015d10: 7769 6474 6831 202f 2032 5d0a 0a20 2020  width1 / 2]..   
+00015d20: 2044 203d 2044 6576 6963 6528 2274 6170   D = Device("tap
+00015d30: 6572 2229 0a20 2020 2044 2e61 6464 5f70  er").    D.add_p
+00015d40: 6f6c 7967 6f6e 285b 7870 7473 2c20 7970  olygon([xpts, yp
+00015d50: 7473 5d2c 206c 6179 6572 3d6c 6179 6572  ts], layer=layer
+00015d60: 290a 2020 2020 442e 6164 645f 706f 7274  ).    D.add_port
+00015d70: 286e 616d 653d 312c 206d 6964 706f 696e  (name=1, midpoin
+00015d80: 743d 5b30 2c20 305d 2c20 7769 6474 683d  t=[0, 0], width=
+00015d90: 7769 6474 6831 2c20 6f72 6965 6e74 6174  width1, orientat
+00015da0: 696f 6e3d 3138 3029 0a20 2020 2044 2e61  ion=180).    D.a
+00015db0: 6464 5f70 6f72 7428 6e61 6d65 3d32 2c20  dd_port(name=2, 
+00015dc0: 6d69 6470 6f69 6e74 3d5b 6c65 6e67 7468  midpoint=[length
+00015dd0: 2c20 305d 2c20 7769 6474 683d 7769 6474  , 0], width=widt
+00015de0: 6832 2c20 6f72 6965 6e74 6174 696f 6e3d  h2, orientation=
+00015df0: 3029 0a20 2020 2069 6620 6973 696e 7374  0).    if isinst
+00015e00: 616e 6365 2870 6f72 742c 2050 6f72 7429  ance(port, Port)
+00015e10: 3a0a 2020 2020 2020 2020 442e 726f 7461  :.        D.rota
+00015e20: 7465 2861 6e67 6c65 3d70 6f72 742e 6f72  te(angle=port.or
+00015e30: 6965 6e74 6174 696f 6e2c 2063 656e 7465  ientation, cente
+00015e40: 723d 5b30 2c20 305d 290a 2020 2020 2020  r=[0, 0]).      
+00015e50: 2020 442e 6d6f 7665 286f 7269 6769 6e3d    D.move(origin=
+00015e60: 5b30 2c20 305d 2c20 6465 7374 696e 6174  [0, 0], destinat
+00015e70: 696f 6e3d 706f 7274 2e6d 6964 706f 696e  ion=port.midpoin
+00015e80: 7429 0a20 2020 2072 6574 7572 6e20 440a  t).    return D.
+00015e90: 0a0a 6465 6620 7261 6d70 286c 656e 6774  ..def ramp(lengt
+00015ea0: 683d 3130 2c20 7769 6474 6831 3d35 2c20  h=10, width1=5, 
+00015eb0: 7769 6474 6832 3d38 2c20 6c61 7965 723d  width2=8, layer=
+00015ec0: 3029 3a0a 2020 2020 2222 2243 7265 6174  0):.    """Creat
+00015ed0: 6573 2061 2072 616d 7020 6765 6f6d 6574  es a ramp geomet
+00015ee0: 7279 2e0a 0a20 2020 2050 6172 616d 6574  ry...    Paramet
+00015ef0: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+00015f00: 2d2d 0a20 2020 206c 656e 6774 6820 3a20  --.    length : 
+00015f10: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
+00015f20: 2020 2020 204c 656e 6774 6820 6f66 2074       Length of t
+00015f30: 6865 2072 616d 7020 7365 6374 696f 6e2e  he ramp section.
+00015f40: 0a20 2020 2077 6964 7468 3120 3a20 696e  .    width1 : in
+00015f50: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
+00015f60: 2020 2057 6964 7468 206f 6620 7468 6520     Width of the 
+00015f70: 7374 6172 7420 6f66 2074 6865 2072 616d  start of the ram
+00015f80: 7020 7365 6374 696f 6e2e 0a20 2020 2077  p section..    w
+00015f90: 6964 7468 3220 3a20 696e 742c 2066 6c6f  idth2 : int, flo
+00015fa0: 6174 2c20 6f72 204e 6f6e 650a 2020 2020  at, or None.    
+00015fb0: 2020 2020 5769 6474 6820 6f66 2074 6865      Width of the
+00015fc0: 2065 6e64 206f 6620 7468 6520 7261 6d70   end of the ramp
+00015fd0: 2073 6563 7469 6f6e 2028 6966 2077 6964   section (if wid
+00015fe0: 7468 3220 6973 204e 6f6e 652c 2077 6964  th2 is None, wid
+00015ff0: 7468 320a 2020 2020 2020 2020 6265 636f  th2.        beco
+00016000: 6d65 7320 7468 6520 7361 6d65 2061 7320  mes the same as 
+00016010: 7769 6474 6831 292e 0a20 2020 206c 6179  width1)..    lay
+00016020: 6572 203a 2069 6e74 2c20 6172 7261 792d  er : int, array-
+00016030: 6c69 6b65 5b32 5d2c 206f 7220 7365 740a  like[2], or set.
+00016040: 2020 2020 2020 2020 5370 6563 6966 6963          Specific
+00016050: 206c 6179 6572 2873 2920 746f 2070 7574   layer(s) to put
+00016060: 2070 6f6c 7967 6f6e 2067 656f 6d65 7472   polygon geometr
+00016070: 7920 6f6e 2e0a 0a20 2020 2052 6574 7572  y on...    Retur
+00016080: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
+00016090: 2020 2044 203a 2044 6576 6963 650a 2020     D : Device.  
+000160a0: 2020 2020 2020 4120 4465 7669 6365 2063        A Device c
+000160b0: 6f6e 7461 696e 696e 6720 6120 7261 6d70  ontaining a ramp
+000160c0: 2067 656f 6d65 7472 792e 0a20 2020 2022   geometry..    "
+000160d0: 2222 0a20 2020 2069 6620 7769 6474 6832  "".    if width2
+000160e0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+000160f0: 2020 7769 6474 6832 203d 2077 6964 7468    width2 = width
+00016100: 310a 2020 2020 7870 7473 203d 205b 302c  1.    xpts = [0,
+00016110: 206c 656e 6774 682c 206c 656e 6774 682c   length, length,
+00016120: 2030 5d0a 2020 2020 7970 7473 203d 205b   0].    ypts = [
+00016130: 7769 6474 6831 2c20 7769 6474 6832 2c20  width1, width2, 
+00016140: 302c 2030 5d0a 2020 2020 4420 3d20 4465  0, 0].    D = De
+00016150: 7669 6365 2822 7261 6d70 2229 0a20 2020  vice("ramp").   
+00016160: 2044 2e61 6464 5f70 6f6c 7967 6f6e 285b   D.add_polygon([
+00016170: 7870 7473 2c20 7970 7473 5d2c 206c 6179  xpts, ypts], lay
+00016180: 6572 3d6c 6179 6572 290a 2020 2020 442e  er=layer).    D.
+00016190: 6164 645f 706f 7274 286e 616d 653d 312c  add_port(name=1,
+000161a0: 206d 6964 706f 696e 743d 5b30 2c20 7769   midpoint=[0, wi
+000161b0: 6474 6831 202f 2032 5d2c 2077 6964 7468  dth1 / 2], width
+000161c0: 3d77 6964 7468 312c 206f 7269 656e 7461  =width1, orienta
+000161d0: 7469 6f6e 3d31 3830 290a 2020 2020 442e  tion=180).    D.
+000161e0: 6164 645f 706f 7274 286e 616d 653d 322c  add_port(name=2,
+000161f0: 206d 6964 706f 696e 743d 5b6c 656e 6774   midpoint=[lengt
+00016200: 682c 2077 6964 7468 3220 2f20 325d 2c20  h, width2 / 2], 
+00016210: 7769 6474 683d 7769 6474 6832 2c20 6f72  width=width2, or
+00016220: 6965 6e74 6174 696f 6e3d 3029 0a20 2020  ientation=0).   
+00016230: 2072 6574 7572 6e20 440a 0a0a 6465 6620   return D...def 
+00016240: 5f6d 6963 726f 7374 7269 705f 5a28 7769  _microstrip_Z(wi
+00016250: 7265 5f77 6964 7468 2c20 6469 656c 6563  re_width, dielec
+00016260: 7472 6963 5f74 6869 636b 6e65 7373 2c20  tric_thickness, 
+00016270: 6570 735f 7229 3a0a 2020 2020 2222 2243  eps_r):.    """C
+00016280: 616c 6375 6c61 7465 7320 7468 6520 696d  alculates the im
+00016290: 7065 6461 6e63 6520 6f66 2061 206d 6963  pedance of a mic
+000162a0: 726f 7374 7269 7020 6769 7665 6e20 7468  rostrip given th
+000162b0: 6520 7769 7265 2077 6964 7468 2061 6e64  e wire width and
+000162c0: 0a20 2020 2064 6965 6c65 6374 7269 6320  .    dielectric 
+000162d0: 7468 6963 6b6e 6573 7320 616e 6420 636f  thickness and co
+000162e0: 6e73 7461 6e74 2e0a 0a20 2020 2050 6172  nstant...    Par
+000162f0: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+00016300: 2d2d 2d2d 2d2d 0a20 2020 2077 6972 655f  ------.    wire_
+00016310: 7769 6474 6820 3a20 696e 7420 6f72 2066  width : int or f
+00016320: 6c6f 6174 0a20 2020 2020 2020 2057 6964  loat.        Wid
+00016330: 7468 206f 6620 7468 6520 636f 6e64 7563  th of the conduc
+00016340: 7469 6e67 2073 7472 6970 2e0a 2020 2020  ting strip..    
+00016350: 6469 656c 6563 7472 6963 5f74 6869 636b  dielectric_thick
+00016360: 6e65 7373 203a 2069 6e74 206f 7220 666c  ness : int or fl
+00016370: 6f61 740a 2020 2020 2020 2020 5468 6963  oat.        Thic
+00016380: 6b6e 6573 7320 6f66 2074 6865 2073 7562  kness of the sub
+00016390: 7374 7261 7465 2e0a 2020 2020 6570 735f  strate..    eps_
+000163a0: 7220 3a20 696e 7420 6f72 2066 6c6f 6174  r : int or float
+000163b0: 0a20 2020 2020 2020 2044 6965 6c65 6374  .        Dielect
+000163c0: 7269 6320 636f 6e73 7461 6e74 206f 6620  ric constant of 
+000163d0: 7468 6520 7375 6273 7472 6174 652e 0a0a  the substrate...
+000163e0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+000163f0: 2d2d 2d2d 2d2d 2d0a 2020 2020 5a20 3a20  -------.    Z : 
+00016400: 666c 6f61 740a 2020 2020 2020 2020 496d  float.        Im
+00016410: 7065 6461 6e63 6520 6f66 2074 6865 206d  pedance of the m
+00016420: 6963 726f 7374 7269 702e 0a20 2020 2065  icrostrip..    e
+00016430: 7073 5f65 6666 203a 2066 6c6f 6174 0a20  ps_eff : float. 
+00016440: 2020 2020 2020 2045 6666 6563 7469 7665         Effective
+00016450: 2064 6965 6c65 6374 7269 6320 636f 6e73   dielectric cons
+00016460: 7461 6e74 206f 6620 7468 6520 6d69 6372  tant of the micr
+00016470: 6f73 7472 6970 2e0a 0a20 2020 204e 6f74  ostrip...    Not
+00016480: 6573 0a20 2020 202d 2d2d 2d2d 0a20 2020  es.    -----.   
+00016490: 2045 7175 6174 696f 6e73 2074 616b 656e   Equations taken
+000164a0: 2066 726f 6d20 5b31 5d5f 2e0a 0a20 2020   from [1]_...   
+000164b0: 2054 6865 7365 2065 7175 6174 696f 6e73   These equations
+000164c0: 2063 616e 2062 6520 6675 7274 6865 7220   can be further 
+000164d0: 636f 7272 6563 7465 6420 666f 7220 7468  corrected for th
+000164e0: 6963 6b20 6669 6c6d 7320 2848 616d 6d65  ick films (Hamme
+000164f0: 7273 7461 6420 4571 732e 0a20 2020 2036  rstad Eqs..    6
+00016500: 2d39 2920 616e 6420 616c 736f 2066 6f72  -9) and also for
+00016510: 2066 7265 7175 656e 6379 2073 696e 6365   frequency since
+00016520: 206d 6963 726f 7374 7269 7073 2061 7265   microstrips are
+00016530: 2064 6973 7065 7273 6976 6520 2848 616d   dispersive (Ham
+00016540: 6d65 7273 7461 640a 2020 2020 4571 732e  merstad.    Eqs.
+00016550: 2031 302d 3132 290a 0a20 2020 2052 6566   10-12)..    Ref
+00016560: 6572 656e 6365 730a 2020 2020 2d2d 2d2d  erences.    ----
+00016570: 2d2d 2d2d 2d2d 0a20 2020 202e 2e20 5b31  ------.    .. [1
+00016580: 5d20 4861 6d6d 6572 7374 6164 2c20 452e  ] Hammerstad, E.
+00016590: 2c20 2620 4a65 6e73 656e 2c20 4f2e 2028  , & Jensen, O. (
+000165a0: 3139 3830 292e 2041 6363 7572 6174 6520  1980). Accurate 
+000165b0: 4d6f 6465 6c73 2066 6f72 204d 6963 726f  Models for Micro
+000165c0: 7374 7269 700a 2020 2020 2020 2043 6f6d  strip.       Com
+000165d0: 7075 7465 722d 4169 6465 6420 4465 7369  puter-Aided Desi
+000165e0: 676e 2e20 2068 7474 703a 2f2f 646f 692e  gn.  http://doi.
+000165f0: 6f72 672f 3130 2e31 3130 392f 4d57 5359  org/10.1109/MWSY
+00016600: 4d2e 3139 3830 2e31 3132 3433 3033 0a20  M.1980.1124303. 
+00016610: 2020 2022 2222 0a20 2020 2075 203d 2077     """.    u = w
+00016620: 6972 655f 7769 6474 6820 2f20 6469 656c  ire_width / diel
+00016630: 6563 7472 6963 5f74 6869 636b 6e65 7373  ectric_thickness
+00016640: 0a20 2020 2065 7461 203d 2033 3736 2e37  .    eta = 376.7
+00016650: 3320 2023 2056 6163 7575 6d20 696d 7065  3  # Vacuum impe
+00016660: 6461 6e63 650a 0a20 2020 2061 203d 2028  dance..    a = (
+00016670: 0a20 2020 2020 2020 2031 0a20 2020 2020  .        1.     
+00016680: 2020 202b 206c 6f67 2828 752a 2a34 202b     + log((u**4 +
+00016690: 2028 7520 2f20 3532 2920 2a2a 2032 2920   (u / 52) ** 2) 
+000166a0: 2f20 2875 2a2a 3420 2b20 302e 3433 3229  / (u**4 + 0.432)
+000166b0: 2920 2f20 3439 0a20 2020 2020 2020 202b  ) / 49.        +
+000166c0: 206c 6f67 2831 202b 2028 7520 2f20 3138   log(1 + (u / 18
+000166d0: 2e31 2920 2a2a 2033 2920 2f20 3138 2e37  .1) ** 3) / 18.7
+000166e0: 0a20 2020 2029 0a20 2020 2062 203d 2030  .    ).    b = 0
+000166f0: 2e35 3634 202a 2028 2865 7073 5f72 202d  .564 * ((eps_r -
+00016700: 2030 2e39 2920 2f20 2865 7073 5f72 202b   0.9) / (eps_r +
+00016710: 2033 2929 202a 2a20 302e 3035 330a 2020   3)) ** 0.053.  
+00016720: 2020 4620 3d20 3620 2b20 2832 202a 2070    F = 6 + (2 * p
+00016730: 6920 2d20 3629 202a 2065 7870 282d 2828  i - 6) * exp(-((
+00016740: 3330 2e36 3636 202f 2075 2920 2a2a 2030  30.666 / u) ** 0
+00016750: 2e37 3532 3829 290a 2020 2020 6570 735f  .7528)).    eps_
+00016760: 6566 6620 3d20 302e 3520 2a20 2865 7073  eff = 0.5 * (eps
+00016770: 5f72 202b 2031 2920 2b20 302e 3520 2a20  _r + 1) + 0.5 * 
+00016780: 2865 7073 5f72 202d 2031 2920 2a20 2831  (eps_r - 1) * (1
+00016790: 202b 2031 3020 2f20 7529 202a 2a20 282d   + 10 / u) ** (-
+000167a0: 6120 2a20 6229 0a20 2020 205a 203d 2065  a * b).    Z = e
+000167b0: 7461 202f 2028 3220 2a20 7069 2920 2a20  ta / (2 * pi) * 
+000167c0: 6c6f 6728 4620 2f20 7520 2b20 7371 7274  log(F / u + sqrt
+000167d0: 2831 202b 2028 3220 2f20 7529 202a 2a20  (1 + (2 / u) ** 
+000167e0: 3229 2920 2f20 7371 7274 2865 7073 5f65  2)) / sqrt(eps_e
+000167f0: 6666 290a 2020 2020 7265 7475 726e 205a  ff).    return Z
+00016800: 2c20 6570 735f 6566 660a 0a0a 6465 6620  , eps_eff...def 
+00016810: 5f6d 6963 726f 7374 7269 705f 4c43 5f70  _microstrip_LC_p
+00016820: 6572 5f6d 6574 6572 2877 6972 655f 7769  er_meter(wire_wi
+00016830: 6474 682c 2064 6965 6c65 6374 7269 635f  dth, dielectric_
+00016840: 7468 6963 6b6e 6573 732c 2065 7073 5f72  thickness, eps_r
+00016850: 293a 0a20 2020 2022 2222 4361 6c63 756c  ):.    """Calcul
+00016860: 6174 6573 2074 6865 2069 6e64 7563 7461  ates the inducta
+00016870: 6e63 6520 616e 6420 6361 7061 6369 7461  nce and capacita
+00016880: 6e63 6520 7065 7220 6d65 7465 7220 6f66  nce per meter of
+00016890: 2061 206d 6963 726f 7374 7269 700a 2020   a microstrip.  
+000168a0: 2020 6769 7665 6e20 7769 7265 2077 6964    given wire wid
+000168b0: 7468 2061 6e64 2064 6965 6c65 6374 7269  th and dielectri
+000168c0: 6320 7468 6963 6b6e 6573 7320 616e 6420  c thickness and 
+000168d0: 636f 6e73 7461 6e74 2e0a 0a20 2020 2050  constant...    P
+000168e0: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+000168f0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2077 6972  --------.    wir
+00016900: 655f 7769 6474 6820 3a20 696e 7420 6f72  e_width : int or
+00016910: 2066 6c6f 6174 0a20 2020 2020 2020 2057   float.        W
+00016920: 6964 7468 206f 6620 7468 6520 636f 6e64  idth of the cond
+00016930: 7563 7469 6e67 2073 7472 6970 2e0a 2020  ucting strip..  
+00016940: 2020 6469 656c 6563 7472 6963 5f74 6869    dielectric_thi
+00016950: 636b 6e65 7373 203a 2069 6e74 206f 7220  ckness : int or 
+00016960: 666c 6f61 740a 2020 2020 2020 2020 5468  float.        Th
+00016970: 6963 6b6e 6573 7320 6f66 2074 6865 2073  ickness of the s
+00016980: 7562 7374 7261 7465 2e0a 2020 2020 6570  ubstrate..    ep
+00016990: 735f 7220 3a20 696e 7420 6f72 2066 6c6f  s_r : int or flo
+000169a0: 6174 0a20 2020 2020 2020 2044 6965 6c65  at.        Diele
+000169b0: 6374 7269 6320 636f 6e73 7461 6e74 206f  ctric constant o
+000169c0: 6620 7468 6520 7375 6273 7472 6174 652e  f the substrate.
+000169d0: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
+000169e0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 4c5f    -------.    L_
+000169f0: 6d20 3a20 666c 6f61 740a 2020 2020 2020  m : float.      
+00016a00: 2020 496e 6475 6374 616e 6365 2070 6572    Inductance per
+00016a10: 206d 6574 6572 206f 6620 7468 6520 6d69   meter of the mi
+00016a20: 6372 6f73 7472 6970 2e0a 2020 2020 435f  crostrip..    C_
+00016a30: 6d20 3a20 666c 6f61 740a 2020 2020 2020  m : float.      
+00016a40: 2020 4361 7061 6369 7461 6e63 6520 7065    Capacitance pe
+00016a50: 7220 6d65 7465 7220 6f66 2074 6865 206d  r meter of the m
+00016a60: 6963 726f 7374 7269 702e 0a0a 2020 2020  icrostrip...    
+00016a70: 4e6f 7465 730a 2020 2020 2d2d 2d2d 2d0a  Notes.    -----.
+00016a80: 2020 2020 4571 7561 7469 6f6e 7320 7461      Equations ta
+00016a90: 6b65 6e20 6672 6f6d 3a0a 2020 2020 2020  ken from:.      
+00016aa0: 2020 4861 6d6d 6572 7374 6164 2c20 452e    Hammerstad, E.
+00016ab0: 2c20 2620 4a65 6e73 656e 2c20 4f2e 2028  , & Jensen, O. (
+00016ac0: 3139 3830 292e 2041 6363 7572 6174 6520  1980). Accurate 
+00016ad0: 4d6f 6465 6c73 2066 6f72 204d 6963 726f  Models for Micro
+00016ae0: 7374 7269 700a 2020 2020 2020 2020 436f  strip.        Co
+00016af0: 6d70 7574 6572 2d41 6964 6564 2044 6573  mputer-Aided Des
+00016b00: 6967 6e2e 2020 6874 7470 3a2f 2f64 6f69  ign.  http://doi
+00016b10: 2e6f 7267 2f31 302e 3131 3039 2f4d 5753  .org/10.1109/MWS
+00016b20: 594d 2e31 3938 302e 3131 3234 3330 330a  YM.1980.1124303.
+00016b30: 0a20 2020 2054 6865 7365 2065 7175 6174  .    These equat
+00016b40: 696f 6e73 2063 616e 2062 6520 6675 7274  ions can be furt
+00016b50: 6865 7220 636f 7272 6563 7465 6420 666f  her corrected fo
+00016b60: 7220 7468 6963 6b20 6669 6c6d 7320 2848  r thick films (H
+00016b70: 616d 6d65 7273 7461 6420 4571 730a 2020  ammerstad Eqs.  
+00016b80: 2020 362d 3929 2061 6e64 2061 6c73 6f20    6-9) and also 
+00016b90: 666f 7220 6672 6571 7565 6e63 7920 7369  for frequency si
+00016ba0: 6e63 6520 6d69 6372 6f73 7472 6970 7320  nce microstrips 
+00016bb0: 6172 6520 6469 7370 6572 7369 7665 2028  are dispersive (
+00016bc0: 4861 6d6d 6572 7374 6164 0a20 2020 2045  Hammerstad.    E
+00016bd0: 7173 2031 302d 3132 290a 2020 2020 2222  qs 10-12).    ""
+00016be0: 220a 2020 2020 2320 5573 6520 7468 6520  ".    # Use the 
+00016bf0: 6661 6374 2074 6861 7420 7620 3d20 312f  fact that v = 1/
+00016c00: 7371 7274 284c 5f6d 2a43 5f6d 2920 3d20  sqrt(L_m*C_m) = 
+00016c10: 312f 7371 7274 2865 7073 2a6d 7529 2061  1/sqrt(eps*mu) a
+00016c20: 6e64 0a20 2020 2023 205a 203d 2073 7172  nd.    # Z = sqr
+00016c30: 7428 4c5f 6d2f 435f 6d29 2020 205b 5768  t(L_m/C_m)   [Wh
+00016c40: 6572 6520 4c5f 6d20 6973 2069 6e64 7563  ere L_m is induc
+00016c50: 7461 6e63 6520 7065 7220 6d65 7465 725d  tance per meter]
+00016c60: 0a20 2020 205a 2c20 6570 735f 6566 6620  .    Z, eps_eff 
+00016c70: 3d20 5f6d 6963 726f 7374 7269 705f 5a28  = _microstrip_Z(
+00016c80: 7769 7265 5f77 6964 7468 2c20 6469 656c  wire_width, diel
+00016c90: 6563 7472 6963 5f74 6869 636b 6e65 7373  ectric_thickness
+00016ca0: 2c20 6570 735f 7229 0a20 2020 2065 7073  , eps_r).    eps
+00016cb0: 3020 3d20 382e 3835 3465 2d31 320a 2020  0 = 8.854e-12.  
+00016cc0: 2020 6d75 3020 3d20 3420 2a20 7069 202a    mu0 = 4 * pi *
+00016cd0: 2031 652d 370a 0a20 2020 2065 7073 203d   1e-7..    eps =
+00016ce0: 2065 7073 5f65 6666 202a 2065 7073 300a   eps_eff * eps0.
+00016cf0: 2020 2020 6d75 203d 206d 7530 0a20 2020      mu = mu0.   
+00016d00: 204c 5f6d 203d 2073 7172 7428 6570 7320   L_m = sqrt(eps 
+00016d10: 2a20 6d75 2920 2a20 5a0a 2020 2020 435f  * mu) * Z.    C_
+00016d20: 6d20 3d20 7371 7274 2865 7073 202a 206d  m = sqrt(eps * m
+00016d30: 7529 202f 205a 0a20 2020 2072 6574 7572  u) / Z.    retur
+00016d40: 6e20 4c5f 6d2c 2043 5f6d 0a0a 0a64 6566  n L_m, C_m...def
+00016d50: 205f 6d69 6372 6f73 7472 6970 5f5a 5f77   _microstrip_Z_w
+00016d60: 6974 685f 4c6b 2877 6972 655f 7769 6474  ith_Lk(wire_widt
+00016d70: 682c 2064 6965 6c65 6374 7269 635f 7468  h, dielectric_th
+00016d80: 6963 6b6e 6573 732c 2065 7073 5f72 2c20  ickness, eps_r, 
+00016d90: 4c6b 5f70 6572 5f73 7129 3a0a 2020 2020  Lk_per_sq):.    
+00016da0: 2222 2243 616c 6375 6c61 7465 7320 7468  """Calculates th
+00016db0: 6520 696d 7065 6461 6e63 6520 6f66 2061  e impedance of a
+00016dc0: 206d 6963 726f 7374 7269 7020 6769 7665   microstrip give
+00016dd0: 6e20 7769 7265 2077 6964 7468 2c20 6469  n wire width, di
+00016de0: 656c 6563 7472 6963 0a20 2020 2074 6869  electric.    thi
+00016df0: 636b 6e65 7373 2061 6e64 2063 6f6e 7374  ckness and const
+00016e00: 616e 742c 2061 6e64 206b 696e 6574 6963  ant, and kinetic
+00016e10: 2069 6e64 7563 7461 6e63 6520 7065 7220   inductance per 
+00016e20: 7371 7561 7265 2e0a 0a20 2020 2050 6172  square...    Par
+00016e30: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+00016e40: 2d2d 2d2d 2d2d 0a20 2020 2077 6972 655f  ------.    wire_
+00016e50: 7769 6474 6820 3a20 696e 7420 6f72 2066  width : int or f
+00016e60: 6c6f 6174 0a20 2020 2020 2020 2057 6964  loat.        Wid
+00016e70: 7468 206f 6620 7468 6520 636f 6e64 7563  th of the conduc
+00016e80: 7469 6e67 2073 7472 6970 2e0a 2020 2020  ting strip..    
+00016e90: 6469 656c 6563 7472 6963 5f74 6869 636b  dielectric_thick
+00016ea0: 6e65 7373 203a 2069 6e74 206f 7220 666c  ness : int or fl
+00016eb0: 6f61 740a 2020 2020 2020 2020 5468 6963  oat.        Thic
+00016ec0: 6b6e 6573 7320 6f66 2074 6865 2073 7562  kness of the sub
+00016ed0: 7374 7261 7465 2e0a 2020 2020 6570 735f  strate..    eps_
+00016ee0: 7220 3a20 696e 7420 6f72 2066 6c6f 6174  r : int or float
+00016ef0: 0a20 2020 2020 2020 2044 6965 6c65 6374  .        Dielect
+00016f00: 7269 6320 636f 6e73 7461 6e74 206f 6620  ric constant of 
+00016f10: 7468 6520 7375 6273 7472 6174 652e 0a20  the substrate.. 
+00016f20: 2020 204c 6b5f 7065 725f 7371 203a 2069     Lk_per_sq : i
+00016f30: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
+00016f40: 2020 2020 4b69 6e65 7469 6320 696e 6475      Kinetic indu
+00016f50: 6374 616e 6365 2070 6572 2073 7175 6172  ctance per squar
+00016f60: 6520 6f66 2074 6865 206d 6963 726f 7374  e of the microst
+00016f70: 7269 702e 0a0a 2020 2020 5265 7475 726e  rip...    Return
+00016f80: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
+00016f90: 2020 5a20 3a20 666c 6f61 740a 2020 2020    Z : float.    
+00016fa0: 2020 2020 496d 7065 6461 6e63 6520 6f66      Impedance of
+00016fb0: 2074 6865 206d 6963 726f 7374 7269 702e   the microstrip.
+00016fc0: 0a0a 2020 2020 4e6f 7465 730a 2020 2020  ..    Notes.    
+00016fd0: 2d2d 2d2d 2d0a 2020 2020 4571 7561 7469  -----.    Equati
+00016fe0: 6f6e 7320 7461 6b65 6e20 6672 6f6d 3a0a  ons taken from:.
+00016ff0: 2020 2020 2020 2020 4861 6d6d 6572 7374          Hammerst
+00017000: 6164 2c20 452e 2c20 2620 4a65 6e73 656e  ad, E., & Jensen
+00017010: 2c20 4f2e 2028 3139 3830 292e 2041 6363  , O. (1980). Acc
+00017020: 7572 6174 6520 4d6f 6465 6c73 2066 6f72  urate Models for
+00017030: 204d 6963 726f 7374 7269 700a 2020 2020   Microstrip.    
+00017040: 2020 2020 436f 6d70 7574 6572 2d41 6964      Computer-Aid
+00017050: 6564 2044 6573 6967 6e2e 2020 6874 7470  ed Design.  http
+00017060: 3a2f 2f64 6f69 2e6f 7267 2f31 302e 3131  ://doi.org/10.11
+00017070: 3039 2f4d 5753 594d 2e31 3938 302e 3131  09/MWSYM.1980.11
+00017080: 3234 3330 330a 0a20 2020 2054 6865 7365  24303..    These
+00017090: 2065 7175 6174 696f 6e73 2063 616e 2062   equations can b
+000170a0: 6520 6675 7274 6865 7220 636f 7272 6563  e further correc
+000170b0: 7465 6420 666f 7220 7468 6963 6b20 6669  ted for thick fi
+000170c0: 6c6d 7320 2848 616d 6d65 7273 7461 6420  lms (Hammerstad 
+000170d0: 4571 730a 2020 2020 362d 3929 2061 6e64  Eqs.    6-9) and
+000170e0: 2061 6c73 6f20 666f 7220 6672 6571 7565   also for freque
+000170f0: 6e63 7920 7369 6e63 6520 6d69 6372 6f73  ncy since micros
+00017100: 7472 6970 7320 6172 6520 6469 7370 6572  trips are disper
+00017110: 7369 7665 2028 4861 6d6d 6572 7374 6164  sive (Hammerstad
+00017120: 0a20 2020 2045 7173 2031 302d 3132 290a  .    Eqs 10-12).
+00017130: 2020 2020 2222 220a 2020 2020 2320 4164      """.    # Ad
+00017140: 6420 6120 6b69 6e65 7469 6320 696e 6475  d a kinetic indu
+00017150: 6374 616e 6365 2061 6e64 2072 6563 616c  ctance and recal
+00017160: 6375 6c61 7465 2074 6865 2069 6d70 6564  culate the imped
+00017170: 616e 6365 2c20 6265 2063 6172 6566 756c  ance, be careful
+00017180: 0a20 2020 2023 2074 6f20 696e 7075 7420  .    # to input 
+00017190: 4c6b 2061 7320 6120 7065 722d 6d65 7465  Lk as a per-mete
+000171a0: 7220 696e 6475 6374 616e 6365 0a20 2020  r inductance.   
+000171b0: 204c 5f6d 2c20 435f 6d20 3d20 5f6d 6963   L_m, C_m = _mic
+000171c0: 726f 7374 7269 705f 4c43 5f70 6572 5f6d  rostrip_LC_per_m
+000171d0: 6574 6572 2877 6972 655f 7769 6474 682c  eter(wire_width,
+000171e0: 2064 6965 6c65 6374 7269 635f 7468 6963   dielectric_thic
+000171f0: 6b6e 6573 732c 2065 7073 5f72 290a 2020  kness, eps_r).  
+00017200: 2020 4c6b 5f6d 203d 204c 6b5f 7065 725f    Lk_m = Lk_per_
+00017210: 7371 202a 2028 312e 3020 2f20 7769 7265  sq * (1.0 / wire
+00017220: 5f77 6964 7468 290a 2020 2020 5a20 3d20  _width).    Z = 
+00017230: 7371 7274 2828 4c5f 6d20 2b20 4c6b 5f6d  sqrt((L_m + Lk_m
+00017240: 2920 2f20 435f 6d29 0a20 2020 2072 6574  ) / C_m).    ret
+00017250: 7572 6e20 5a0a 0a0a 6465 6620 5f6d 6963  urn Z...def _mic
+00017260: 726f 7374 7269 705f 765f 7769 7468 5f4c  rostrip_v_with_L
+00017270: 6b28 7769 7265 5f77 6964 7468 2c20 6469  k(wire_width, di
+00017280: 656c 6563 7472 6963 5f74 6869 636b 6e65  electric_thickne
+00017290: 7373 2c20 6570 735f 722c 204c 6b5f 7065  ss, eps_r, Lk_pe
+000172a0: 725f 7371 293a 0a20 2020 2022 2222 4361  r_sq):.    """Ca
+000172b0: 6c63 756c 6174 6573 2074 6865 2070 726f  lculates the pro
+000172c0: 7061 6761 7469 6f6e 2076 656c 6f63 6974  pagation velocit
+000172d0: 7920 696e 2061 206d 6963 726f 7374 7269  y in a microstri
+000172e0: 700a 0a20 2020 2050 6172 616d 6574 6572  p..    Parameter
+000172f0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+00017300: 0a20 2020 2077 6972 655f 7769 6474 6820  .    wire_width 
+00017310: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
+00017320: 2020 2020 2020 2057 6964 7468 206f 6620         Width of 
+00017330: 7468 6520 636f 6e64 7563 7469 6e67 2073  the conducting s
+00017340: 7472 6970 2e0a 2020 2020 6469 656c 6563  trip..    dielec
+00017350: 7472 6963 5f74 6869 636b 6e65 7373 203a  tric_thickness :
+00017360: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
+00017370: 2020 2020 2020 5468 6963 6b6e 6573 7320        Thickness 
+00017380: 6f66 2074 6865 2073 7562 7374 7261 7465  of the substrate
+00017390: 2e0a 2020 2020 6570 735f 7220 3a20 696e  ..    eps_r : in
+000173a0: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
+000173b0: 2020 2044 6965 6c65 6374 7269 6320 636f     Dielectric co
+000173c0: 6e73 7461 6e74 206f 6620 7468 6520 7375  nstant of the su
+000173d0: 6273 7472 6174 652e 0a20 2020 204c 6b5f  bstrate..    Lk_
+000173e0: 7065 725f 7371 203a 2069 6e74 206f 7220  per_sq : int or 
+000173f0: 666c 6f61 740a 2020 2020 2020 2020 4b69  float.        Ki
+00017400: 6e65 7469 6320 696e 6475 6374 616e 6365  netic inductance
+00017410: 2070 6572 2073 7175 6172 6520 6f66 2074   per square of t
+00017420: 6865 206d 6963 726f 7374 7269 702e 0a0a  he microstrip...
+00017430: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00017440: 2d2d 2d2d 2d2d 2d0a 2020 2020 7620 3a20  -------.    v : 
+00017450: 666c 6f61 740a 2020 2020 2020 2020 5072  float.        Pr
+00017460: 6f70 6167 6174 696f 6e20 7665 6c6f 6369  opagation veloci
+00017470: 7479 2069 6e20 7468 6520 6d69 6372 6f73  ty in the micros
+00017480: 7472 6970 0a0a 2020 2020 4e6f 7465 730a  trip..    Notes.
+00017490: 2020 2020 2d2d 2d2d 2d0a 2020 2020 4571      -----.    Eq
+000174a0: 7561 7469 6f6e 7320 7461 6b65 6e20 6672  uations taken fr
+000174b0: 6f6d 3a0a 2020 2020 2020 2020 4861 6d6d  om:.        Hamm
+000174c0: 6572 7374 6164 2c20 452e 2c20 2620 4a65  erstad, E., & Je
+000174d0: 6e73 656e 2c20 4f2e 2028 3139 3830 292e  nsen, O. (1980).
+000174e0: 2041 6363 7572 6174 6520 4d6f 6465 6c73   Accurate Models
+000174f0: 2066 6f72 204d 6963 726f 7374 7269 700a   for Microstrip.
+00017500: 2020 2020 2020 2020 436f 6d70 7574 6572          Computer
+00017510: 2d41 6964 6564 2044 6573 6967 6e2e 2020  -Aided Design.  
+00017520: 6874 7470 3a2f 2f64 6f69 2e6f 7267 2f31  http://doi.org/1
+00017530: 302e 3131 3039 2f4d 5753 594d 2e31 3938  0.1109/MWSYM.198
+00017540: 302e 3131 3234 3330 330a 0a20 2020 2054  0.1124303..    T
+00017550: 6865 7365 2065 7175 6174 696f 6e73 2063  hese equations c
+00017560: 616e 2062 6520 6675 7274 6865 7220 636f  an be further co
+00017570: 7272 6563 7465 6420 666f 7220 7468 6963  rrected for thic
+00017580: 6b20 6669 6c6d 7320 2848 616d 6d65 7273  k films (Hammers
+00017590: 7461 6420 4571 730a 2020 2020 362d 3929  tad Eqs.    6-9)
+000175a0: 2061 6e64 2061 6c73 6f20 666f 7220 6672   and also for fr
+000175b0: 6571 7565 6e63 7920 7369 6e63 6520 6d69  equency since mi
+000175c0: 6372 6f73 7472 6970 7320 6172 6520 6469  crostrips are di
+000175d0: 7370 6572 7369 7665 2028 4861 6d6d 6572  spersive (Hammer
+000175e0: 7374 6164 0a20 2020 2045 7173 2031 302d  stad.    Eqs 10-
+000175f0: 3132 290a 2020 2020 2222 220a 2020 2020  12).    """.    
+00017600: 4c5f 6d2c 2043 5f6d 203d 205f 6d69 6372  L_m, C_m = _micr
+00017610: 6f73 7472 6970 5f4c 435f 7065 725f 6d65  ostrip_LC_per_me
+00017620: 7465 7228 7769 7265 5f77 6964 7468 2c20  ter(wire_width, 
+00017630: 6469 656c 6563 7472 6963 5f74 6869 636b  dielectric_thick
+00017640: 6e65 7373 2c20 6570 735f 7229 0a20 2020  ness, eps_r).   
+00017650: 204c 6b5f 6d20 3d20 4c6b 5f70 6572 5f73   Lk_m = Lk_per_s
+00017660: 7120 2a20 2831 2e30 202f 2077 6972 655f  q * (1.0 / wire_
+00017670: 7769 6474 6829 0a20 2020 2076 203d 2031  width).    v = 1
+00017680: 202f 2073 7172 7428 284c 5f6d 202b 204c   / sqrt((L_m + L
+00017690: 6b5f 6d29 202a 2043 5f6d 290a 2020 2020  k_m) * C_m).    
+000176a0: 7265 7475 726e 2076 0a0a 0a64 6566 205f  return v...def _
+000176b0: 6669 6e64 5f6d 6963 726f 7374 7269 705f  find_microstrip_
+000176c0: 7769 7265 5f77 6964 7468 285a 5f74 6172  wire_width(Z_tar
+000176d0: 6765 742c 2064 6965 6c65 6374 7269 635f  get, dielectric_
+000176e0: 7468 6963 6b6e 6573 732c 2065 7073 5f72  thickness, eps_r
+000176f0: 2c20 4c6b 5f70 6572 5f73 7129 3a0a 2020  , Lk_per_sq):.  
+00017700: 2020 2222 2243 616c 6375 6c61 7465 7320    """Calculates 
+00017710: 7468 6520 7769 7265 2077 6964 7468 206f  the wire width o
+00017720: 6620 6120 6d69 6372 6f73 7472 6970 2067  f a microstrip g
+00017730: 6976 656e 2061 2074 6172 6765 7420 696d  iven a target im
+00017740: 7065 6461 6e63 652c 0a20 2020 2064 6965  pedance,.    die
+00017750: 6c65 6374 7269 6320 7468 6963 6b6e 6573  lectric thicknes
+00017760: 7320 616e 6420 636f 6e73 7461 6e74 2c20  s and constant, 
+00017770: 616e 6420 6b69 6e65 7469 6320 696e 6475  and kinetic indu
+00017780: 6374 616e 6365 2070 6572 2073 7175 6172  ctance per squar
+00017790: 652e 0a0a 2020 2020 5061 7261 6d65 7465  e...    Paramete
+000177a0: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+000177b0: 2d0a 2020 2020 5a5f 7461 7267 6574 203a  -.    Z_target :
+000177c0: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
+000177d0: 2020 2020 2020 5461 7267 6574 2069 6d70        Target imp
+000177e0: 6564 616e 6365 206f 6620 7468 6520 6d69  edance of the mi
+000177f0: 6372 6f73 7472 6970 2e0a 2020 2020 6469  crostrip..    di
+00017800: 656c 6563 7472 6963 5f74 6869 636b 6e65  electric_thickne
+00017810: 7373 203a 2069 6e74 206f 7220 666c 6f61  ss : int or floa
+00017820: 740a 2020 2020 2020 2020 5468 6963 6b6e  t.        Thickn
+00017830: 6573 7320 6f66 2074 6865 2073 7562 7374  ess of the subst
+00017840: 7261 7465 2e0a 2020 2020 6570 735f 7220  rate..    eps_r 
+00017850: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
+00017860: 2020 2020 2020 2044 6965 6c65 6374 7269         Dielectri
+00017870: 6320 636f 6e73 7461 6e74 206f 6620 7468  c constant of th
+00017880: 6520 7375 6273 7472 6174 652e 0a20 2020  e substrate..   
+00017890: 204c 6b5f 7065 725f 7371 203a 2069 6e74   Lk_per_sq : int
+000178a0: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
+000178b0: 2020 4b69 6e65 7469 6320 696e 6475 6374    Kinetic induct
+000178c0: 616e 6365 2070 6572 2073 7175 6172 6520  ance per square 
+000178d0: 6f66 2074 6865 206d 6963 726f 7374 7269  of the microstri
+000178e0: 702e 0a0a 2020 2020 5265 7475 726e 730a  p...    Returns.
+000178f0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+00017900: 7720 3a20 666c 6f61 740a 2020 2020 2020  w : float.      
+00017910: 2020 5769 7265 2077 6964 7468 206f 6620    Wire width of 
+00017920: 7468 6520 6d69 6372 6f73 7472 6970 2e0a  the microstrip..
+00017930: 0a20 2020 204e 6f74 6573 0a20 2020 202d  .    Notes.    -
+00017940: 2d2d 2d2d 0a20 2020 2045 7175 6174 696f  ----.    Equatio
+00017950: 6e73 2074 616b 656e 2066 726f 6d3a 0a20  ns taken from:. 
+00017960: 2020 2020 2020 2048 616d 6d65 7273 7461         Hammersta
+00017970: 642c 2045 2e2c 2026 204a 656e 7365 6e2c  d, E., & Jensen,
+00017980: 204f 2e20 2831 3938 3029 2e20 4163 6375   O. (1980). Accu
+00017990: 7261 7465 204d 6f64 656c 7320 666f 7220  rate Models for 
+000179a0: 4d69 6372 6f73 7472 6970 0a20 2020 2020  Microstrip.     
+000179b0: 2020 2043 6f6d 7075 7465 722d 4169 6465     Computer-Aide
+000179c0: 6420 4465 7369 676e 2e20 2068 7474 703a  d Design.  http:
+000179d0: 2f2f 646f 692e 6f72 672f 3130 2e31 3130  //doi.org/10.110
+000179e0: 392f 4d57 5359 4d2e 3139 3830 2e31 3132  9/MWSYM.1980.112
+000179f0: 3433 3033 0a0a 2020 2020 5468 6573 6520  4303..    These 
+00017a00: 6571 7561 7469 6f6e 7320 6361 6e20 6265  equations can be
+00017a10: 2066 7572 7468 6572 2063 6f72 7265 6374   further correct
+00017a20: 6564 2066 6f72 2074 6869 636b 2066 696c  ed for thick fil
+00017a30: 6d73 2028 4861 6d6d 6572 7374 6164 2045  ms (Hammerstad E
+00017a40: 7173 0a20 2020 2036 2d39 2920 616e 6420  qs.    6-9) and 
+00017a50: 616c 736f 2066 6f72 2066 7265 7175 656e  also for frequen
+00017a60: 6379 2073 696e 6365 206d 6963 726f 7374  cy since microst
+00017a70: 7269 7073 2061 7265 2064 6973 7065 7273  rips are dispers
+00017a80: 6976 6520 2848 616d 6d65 7273 7461 640a  ive (Hammerstad.
+00017a90: 2020 2020 4571 7320 3130 2d31 3229 0a20      Eqs 10-12). 
+00017aa0: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
+00017ab0: 6572 726f 725f 6675 6e28 7769 7265 5f77  error_fun(wire_w
+00017ac0: 6964 7468 293a 0a20 2020 2020 2020 205a  idth):.        Z
+00017ad0: 5f67 7565 7373 6564 203d 205f 6d69 6372  _guessed = _micr
+00017ae0: 6f73 7472 6970 5f5a 5f77 6974 685f 4c6b  ostrip_Z_with_Lk
+00017af0: 280a 2020 2020 2020 2020 2020 2020 7769  (.            wi
+00017b00: 7265 5f77 6964 7468 2c20 6469 656c 6563  re_width, dielec
+00017b10: 7472 6963 5f74 6869 636b 6e65 7373 2c20  tric_thickness, 
+00017b20: 6570 735f 722c 204c 6b5f 7065 725f 7371  eps_r, Lk_per_sq
+00017b30: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00017b40: 2020 2072 6574 7572 6e20 285a 5f67 7565     return (Z_gue
+00017b50: 7373 6564 202d 205a 5f74 6172 6765 7429  ssed - Z_target)
+00017b60: 202a 2a20 3220 2023 2054 6865 2065 7272   ** 2  # The err
+00017b70: 6f72 0a0a 2020 2020 7830 203d 2064 6965  or..    x0 = die
+00017b80: 6c65 6374 7269 635f 7468 6963 6b6e 6573  lectric_thicknes
+00017b90: 730a 2020 2020 7472 793a 0a20 2020 2020  s.    try:.     
+00017ba0: 2020 2066 726f 6d20 7363 6970 792e 6f70     from scipy.op
+00017bb0: 7469 6d69 7a65 2069 6d70 6f72 7420 666d  timize import fm
+00017bc0: 696e 0a20 2020 2065 7863 6570 7420 4578  in.    except Ex
+00017bd0: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+00017be0: 2072 6169 7365 2049 6d70 6f72 7445 7272   raise ImportErr
+00017bf0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00017c00: 2220 5b50 4849 444c 5d20 546f 2072 756e  " [PHIDL] To run
+00017c10: 2074 6865 206d 6963 726f 7374 7269 7020   the microstrip 
+00017c20: 6675 6e63 7469 6f6e 7320 796f 7520 220a  functions you ".
+00017c30: 2020 2020 2020 2020 2020 2020 226e 6565              "nee
+00017c40: 6420 7363 6970 792c 2070 6c65 6173 6520  d scipy, please 
+00017c50: 696e 7374 616c 6c20 6974 2077 6974 6820  install it with 
+00017c60: 220a 2020 2020 2020 2020 2020 2020 2260  ".            "`
+00017c70: 7069 7020 696e 7374 616c 6c20 7363 6970  pip install scip
+00017c80: 7960 220a 2020 2020 2020 2020 290a 2020  y`".        ).  
+00017c90: 2020 7720 3d20 666d 696e 2865 7272 6f72    w = fmin(error
+00017ca0: 5f66 756e 2c20 7830 2c20 6172 6773 3d28  _fun, x0, args=(
+00017cb0: 292c 2064 6973 703d 4661 6c73 6529 0a20  ), disp=False). 
+00017cc0: 2020 2072 6574 7572 6e20 775b 305d 0a0a     return w[0]..
+00017cd0: 0a64 6566 205f 475f 696e 7465 6772 616e  .def _G_integran
+00017ce0: 6428 7869 702c 2042 293a 0a20 2020 2022  d(xip, B):.    "
+00017cf0: 2222 5370 6563 6961 6c20 6675 6e63 7469  ""Special functi
+00017d00: 6f6e 2066 6f72 206d 6963 726f 7374 7269  on for microstri
+00017d10: 7020 6361 6c63 756c 6174 696f 6e73 2222  p calculations""
+00017d20: 220a 2020 2020 7472 793a 0a20 2020 2020  ".    try:.     
+00017d30: 2020 2066 726f 6d20 7363 6970 792e 7370     from scipy.sp
+00017d40: 6563 6961 6c20 696d 706f 7274 2069 7620  ecial import iv 
+00017d50: 6173 2062 6573 7365 6c69 0a20 2020 2065  as besseli.    e
+00017d60: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+00017d70: 0a20 2020 2020 2020 2022 2222 5b50 4849  .        """[PHI
+00017d80: 444c 5d20 546f 2072 756e 2074 6869 7320  DL] To run this 
+00017d90: 6675 6e63 7469 6f6e 2079 6f75 206e 6565  function you nee
+00017da0: 6420 7363 6970 792c 2070 6c65 6173 6520  d scipy, please 
+00017db0: 696e 7374 616c 6c20 6974 2077 6974 680a  install it with.
+00017dc0: 2020 2020 2020 2020 7069 7020 696e 7374          pip inst
+00017dd0: 616c 6c20 7363 6970 7922 2222 0a20 2020  all scipy""".   
+00017de0: 2072 6574 7572 6e20 6265 7373 656c 6928   return besseli(
+00017df0: 302c 2042 202a 2073 7172 7428 3120 2d20  0, B * sqrt(1 - 
+00017e00: 7869 702a 2a32 2929 0a0a 0a64 6566 205f  xip**2))...def _
+00017e10: 4728 7869 2c20 4229 3a0a 2020 2020 2222  G(xi, B):.    ""
+00017e20: 2253 7065 6369 616c 2066 756e 6374 696f  "Special functio
+00017e30: 6e20 666f 7220 6d69 6372 6f73 7472 6970  n for microstrip
+00017e40: 2063 616c 6375 6c61 7469 6f6e 7322 2222   calculations"""
+00017e50: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
+00017e60: 2020 696d 706f 7274 2073 6369 7079 2e69    import scipy.i
+00017e70: 6e74 6567 7261 7465 0a20 2020 2065 7863  ntegrate.    exc
+00017e80: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+00017e90: 2020 2020 2020 2072 6169 7365 2049 6d70         raise Imp
+00017ea0: 6f72 7445 7272 6f72 280a 2020 2020 2020  ortError(.      
+00017eb0: 2020 2020 2020 2220 5b50 4849 444c 5d20        " [PHIDL] 
+00017ec0: 546f 2072 756e 2074 6865 206d 6963 726f  To run the micro
+00017ed0: 7374 7269 7020 6675 6e63 7469 6f6e 7320  strip functions 
+00017ee0: 796f 7520 220a 2020 2020 2020 2020 2020  you ".          
+00017ef0: 2020 226e 6565 6420 7363 6970 792c 2070    "need scipy, p
+00017f00: 6c65 6173 6520 696e 7374 616c 6c20 6974  lease install it
+00017f10: 2077 6974 6820 220a 2020 2020 2020 2020   with ".        
+00017f20: 2020 2020 2260 7069 7020 696e 7374 616c      "`pip instal
+00017f30: 6c20 7363 6970 7960 220a 2020 2020 2020  l scipy`".      
+00017f40: 2020 290a 2020 2020 7265 7475 726e 2042    ).    return B
+00017f50: 202f 2073 696e 6828 4229 202a 2073 6369   / sinh(B) * sci
+00017f60: 7079 2e69 6e74 6567 7261 7465 2e71 7561  py.integrate.qua
+00017f70: 6428 5f47 5f69 6e74 6567 7261 6e64 2c20  d(_G_integrand, 
+00017f80: 302c 2078 692c 2061 7267 733d 2842 2929  0, xi, args=(B))
+00017f90: 5b30 5d0a 0a0a 4064 6576 6963 655f 6c72  [0]...@device_lr
+00017fa0: 755f 6361 6368 650a 6465 6620 6865 636b  u_cache.def heck
+00017fb0: 656e 5f74 6170 6572 280a 2020 2020 6c65  en_taper(.    le
+00017fc0: 6e67 7468 3d32 3030 2c0a 2020 2020 423d  ngth=200,.    B=
+00017fd0: 342e 3030 3931 2c0a 2020 2020 6469 656c  4.0091,.    diel
+00017fe0: 6563 7472 6963 5f74 6869 636b 6e65 7373  ectric_thickness
+00017ff0: 3d30 2e32 352c 0a20 2020 2065 7073 5f72  =0.25,.    eps_r
+00018000: 3d32 2c0a 2020 2020 4c6b 5f70 6572 5f73  =2,.    Lk_per_s
+00018010: 713d 3235 3065 2d31 322c 0a20 2020 205a  q=250e-12,.    Z
+00018020: 313d 4e6f 6e65 2c0a 2020 2020 5a32 3d4e  1=None,.    Z2=N
+00018030: 6f6e 652c 0a20 2020 2077 6964 7468 313d  one,.    width1=
+00018040: 4e6f 6e65 2c0a 2020 2020 7769 6474 6832  None,.    width2
+00018050: 3d4e 6f6e 652c 0a20 2020 206e 756d 5f70  =None,.    num_p
+00018060: 7473 3d31 3030 2c0a 2020 2020 6c61 7965  ts=100,.    laye
+00018070: 723d 302c 0a29 3a0a 2020 2020 2222 2243  r=0,.):.    """C
+00018080: 7265 6174 6573 2061 2048 6563 6b65 6e2d  reates a Hecken-
+00018090: 7461 7065 7265 6420 6d69 6372 6f73 7472  tapered microstr
+000180a0: 6970 2e0a 0a20 2020 2050 6172 616d 6574  ip...    Paramet
+000180b0: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+000180c0: 2d2d 0a20 2020 206c 656e 6774 6820 3a20  --.    length : 
+000180d0: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
+000180e0: 2020 2020 204c 656e 6774 6820 6f66 2074       Length of t
+000180f0: 6865 206d 6963 726f 7374 7269 702e 0a20  he microstrip.. 
+00018100: 2020 2042 203a 2069 6e74 206f 7220 666c     B : int or fl
+00018110: 6f61 740a 2020 2020 2020 2020 436f 6e74  oat.        Cont
+00018120: 726f 6c73 2074 6865 2069 6e74 656e 7369  rols the intensi
+00018130: 7479 206f 6620 7468 6520 7461 7065 722e  ty of the taper.
+00018140: 0a20 2020 2064 6965 6c65 6374 7269 635f  .    dielectric_
+00018150: 7468 6963 6b6e 6573 7320 3a20 696e 7420  thickness : int 
+00018160: 6f72 2066 6c6f 6174 0a20 2020 2020 2020  or float.       
+00018170: 2054 6869 636b 6e65 7373 206f 6620 7468   Thickness of th
+00018180: 6520 7375 6273 7472 6174 652e 0a20 2020  e substrate..   
+00018190: 2065 7073 5f72 203a 2069 6e74 206f 7220   eps_r : int or 
+000181a0: 666c 6f61 740a 2020 2020 2020 2020 4469  float.        Di
+000181b0: 656c 6563 7472 6963 2063 6f6e 7374 616e  electric constan
+000181c0: 7420 6f66 2074 6865 2073 7562 7374 7261  t of the substra
+000181d0: 7465 2e0a 2020 2020 4c6b 5f70 6572 5f73  te..    Lk_per_s
+000181e0: 7120 3a20 666c 6f61 740a 2020 2020 2020  q : float.      
+000181f0: 2020 4b69 6e65 7469 6320 696e 6475 6374    Kinetic induct
+00018200: 616e 6365 2070 6572 2073 7175 6172 6520  ance per square 
+00018210: 6f66 2074 6865 206d 6963 726f 7374 7269  of the microstri
+00018220: 702e 0a20 2020 205a 3120 3a20 696e 742c  p..    Z1 : int,
+00018230: 2066 6c6f 6174 2c20 6f72 204e 6f6e 650a   float, or None.
+00018240: 2020 2020 2020 2020 496d 7065 6461 6e63          Impedanc
+00018250: 6520 6f66 2074 6865 206c 6566 7420 7369  e of the left si
+00018260: 6465 2072 6567 696f 6e20 6f66 2074 6865  de region of the
+00018270: 206d 6963 726f 7374 7269 702e 0a20 2020   microstrip..   
+00018280: 205a 3220 3a20 696e 742c 2066 6c6f 6174   Z2 : int, float
+00018290: 2c20 6f72 204e 6f6e 650a 2020 2020 2020  , or None.      
+000182a0: 2020 496d 7065 6461 6e63 6520 6f66 2074    Impedance of t
+000182b0: 6865 2072 6967 6874 2073 6964 6520 7265  he right side re
+000182c0: 6769 6f6e 206f 6620 7468 6520 6d69 6372  gion of the micr
+000182d0: 6f73 7472 6970 2e0a 2020 2020 7769 6474  ostrip..    widt
+000182e0: 6831 203a 2069 6e74 2c20 666c 6f61 742c  h1 : int, float,
+000182f0: 206f 7220 4e6f 6e65 0a20 2020 2020 2020   or None.       
+00018300: 2057 6964 7468 206f 6620 7468 6520 6c65   Width of the le
+00018310: 6674 2073 6964 6520 6f66 2074 6865 206d  ft side of the m
+00018320: 6963 726f 7374 7269 702e 0a20 2020 2077  icrostrip..    w
+00018330: 6964 7468 3220 3a20 696e 742c 2066 6c6f  idth2 : int, flo
+00018340: 6174 2c20 6f72 204e 6f6e 650a 2020 2020  at, or None.    
+00018350: 2020 2020 5769 6474 6820 6f66 2074 6865      Width of the
+00018360: 2072 6967 6874 2073 6964 6520 6f66 2074   right side of t
+00018370: 6865 206d 6963 726f 7374 7269 702e 0a20  he microstrip.. 
+00018380: 2020 206e 756d 5f70 7473 203a 2069 6e74     num_pts : int
+00018390: 0a20 2020 2020 2020 204e 756d 6265 7220  .        Number 
+000183a0: 6f66 2070 6f69 6e74 7320 636f 6d70 7269  of points compri
+000183b0: 7369 6e67 2074 6865 2063 7572 7665 206f  sing the curve o
+000183c0: 6620 7468 6520 656e 7469 7265 206d 6963  f the entire mic
+000183d0: 726f 7374 7269 702e 0a20 2020 206c 6179  rostrip..    lay
+000183e0: 6572 203a 2069 6e74 2c20 6172 7261 792d  er : int, array-
+000183f0: 6c69 6b65 5b32 5d2c 206f 7220 7365 740a  like[2], or set.
+00018400: 2020 2020 2020 2020 5370 6563 6966 6963          Specific
+00018410: 206c 6179 6572 2873 2920 746f 2070 7574   layer(s) to put
+00018420: 2070 6f6c 7967 6f6e 2067 656f 6d65 7472   polygon geometr
+00018430: 7920 6f6e 2e0a 0a20 2020 2052 6574 7572  y on...    Retur
+00018440: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
+00018450: 2020 2044 203a 2044 6576 6963 650a 2020     D : Device.  
+00018460: 2020 2020 2020 4120 4465 7669 6365 2063        A Device c
+00018470: 6f6e 7461 696e 696e 6720 6120 4865 636b  ontaining a Heck
+00018480: 656e 2d74 6170 6572 6564 206d 6963 726f  en-tapered micro
+00018490: 7374 7269 702e 0a20 2020 2022 2222 0a20  strip..    """. 
+000184a0: 2020 2069 6620 7769 6474 6831 2069 7320     if width1 is 
+000184b0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+000184c0: 2020 5a31 203d 205f 6d69 6372 6f73 7472    Z1 = _microstr
+000184d0: 6970 5f5a 5f77 6974 685f 4c6b 280a 2020  ip_Z_with_Lk(.  
+000184e0: 2020 2020 2020 2020 2020 7769 6474 6831            width1
+000184f0: 202a 2031 652d 362c 2064 6965 6c65 6374   * 1e-6, dielect
+00018500: 7269 635f 7468 6963 6b6e 6573 7320 2a20  ric_thickness * 
+00018510: 3165 2d36 2c20 6570 735f 722c 204c 6b5f  1e-6, eps_r, Lk_
+00018520: 7065 725f 7371 0a20 2020 2020 2020 2029  per_sq.        )
+00018530: 0a20 2020 2069 6620 7769 6474 6832 2069  .    if width2 i
+00018540: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00018550: 2020 2020 5a32 203d 205f 6d69 6372 6f73      Z2 = _micros
+00018560: 7472 6970 5f5a 5f77 6974 685f 4c6b 280a  trip_Z_with_Lk(.
+00018570: 2020 2020 2020 2020 2020 2020 7769 6474              widt
+00018580: 6832 202a 2031 652d 362c 2064 6965 6c65  h2 * 1e-6, diele
+00018590: 6374 7269 635f 7468 6963 6b6e 6573 7320  ctric_thickness 
+000185a0: 2a20 3165 2d36 2c20 6570 735f 722c 204c  * 1e-6, eps_r, L
+000185b0: 6b5f 7065 725f 7371 0a20 2020 2020 2020  k_per_sq.       
+000185c0: 2029 0a20 2020 2023 204e 6f72 6d61 6c69   ).    # Normali
+000185d0: 7a65 6420 6c65 6e67 7468 206f 6620 7468  zed length of th
+000185e0: 6520 7769 7265 205b 2d31 2074 6f20 2b31  e wire [-1 to +1
+000185f0: 5d0a 2020 2020 7869 5f6c 6973 7420 3d20  ].    xi_list = 
+00018600: 6e70 2e6c 696e 7370 6163 6528 2d31 2c20  np.linspace(-1, 
+00018610: 312c 206e 756d 5f70 7473 290a 2020 2020  1, num_pts).    
+00018620: 5a20 3d20 5b6e 702e 6578 7028 302e 3520  Z = [np.exp(0.5 
+00018630: 2a20 6c6f 6728 5a31 202a 205a 3229 202b  * log(Z1 * Z2) +
+00018640: 2030 2e35 202a 206c 6f67 285a 3220 2f20   0.5 * log(Z2 / 
+00018650: 5a31 2920 2a20 5f47 2878 692c 2042 2929  Z1) * _G(xi, B))
+00018660: 2066 6f72 2078 6920 696e 2078 695f 6c69   for xi in xi_li
+00018670: 7374 5d0a 2020 2020 7769 6474 6873 203d  st].    widths =
+00018680: 206e 702e 6172 7261 7928 0a20 2020 2020   np.array(.     
+00018690: 2020 205b 0a20 2020 2020 2020 2020 2020     [.           
+000186a0: 205f 6669 6e64 5f6d 6963 726f 7374 7269   _find_microstri
+000186b0: 705f 7769 7265 5f77 6964 7468 280a 2020  p_wire_width(.  
+000186c0: 2020 2020 2020 2020 2020 2020 2020 7a2c                z,
+000186d0: 2064 6965 6c65 6374 7269 635f 7468 6963   dielectric_thic
+000186e0: 6b6e 6573 7320 2a20 3165 2d36 2c20 6570  kness * 1e-6, ep
+000186f0: 735f 722c 204c 6b5f 7065 725f 7371 0a20  s_r, Lk_per_sq. 
+00018700: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00018710: 2020 2020 2020 2020 202a 2031 6536 0a20           * 1e6. 
+00018720: 2020 2020 2020 2020 2020 2066 6f72 207a             for z
+00018730: 2069 6e20 5a0a 2020 2020 2020 2020 5d0a   in Z.        ].
+00018740: 2020 2020 290a 2020 2020 7820 3d20 2878      ).    x = (x
+00018750: 695f 6c69 7374 202f 2032 2920 2a20 6c65  i_list / 2) * le
+00018760: 6e67 7468 0a0a 2020 2020 2320 436f 6d70  ngth..    # Comp
+00018770: 656e 7361 7465 2066 6f72 2076 6172 7969  ensate for varyi
+00018780: 6e67 2073 7065 6564 206f 6620 6c69 6768  ng speed of ligh
+00018790: 7420 696e 2074 6865 206d 6963 726f 7374  t in the microst
+000187a0: 7269 7020 6279 2073 686f 7274 656e 696e  rip by shortenin
+000187b0: 670a 2020 2020 2320 616e 6420 6c65 6e67  g.    # and leng
+000187c0: 7468 656e 696e 6720 7365 6374 696f 6e73  thening sections
+000187d0: 2061 6363 6f72 6469 6e67 2074 6f20 7468   according to th
+000187e0: 6520 7370 6565 6420 6f66 206c 6967 6874  e speed of light
+000187f0: 2069 6e20 7468 6174 2073 6563 7469 6f6e   in that section
+00018800: 0a20 2020 2076 203d 206e 702e 6172 7261  .    v = np.arra
+00018810: 7928 0a20 2020 2020 2020 205b 0a20 2020  y(.        [.   
+00018820: 2020 2020 2020 2020 205f 6d69 6372 6f73           _micros
+00018830: 7472 6970 5f76 5f77 6974 685f 4c6b 280a  trip_v_with_Lk(.
+00018840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018850: 7720 2a20 3165 2d36 2c20 6469 656c 6563  w * 1e-6, dielec
+00018860: 7472 6963 5f74 6869 636b 6e65 7373 202a  tric_thickness *
+00018870: 2031 652d 362c 2065 7073 5f72 2c20 4c6b   1e-6, eps_r, Lk
+00018880: 5f70 6572 5f73 710a 2020 2020 2020 2020  _per_sq.        
+00018890: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+000188a0: 2020 666f 7220 7720 696e 2077 6964 7468    for w in width
+000188b0: 730a 2020 2020 2020 2020 5d0a 2020 2020  s.        ].    
+000188c0: 290a 2020 2020 6478 203d 206e 702e 6469  ).    dx = np.di
+000188d0: 6666 2878 290a 2020 2020 6478 5f63 6f6d  ff(x).    dx_com
+000188e0: 7065 6e73 6174 6564 203d 2064 7820 2a20  pensated = dx * 
+000188f0: 765b 3a2d 315d 0a20 2020 2078 5f63 6f6d  v[:-1].    x_com
+00018900: 7065 6e73 6174 6564 203d 206e 702e 6375  pensated = np.cu
+00018910: 6d73 756d 2864 785f 636f 6d70 656e 7361  msum(dx_compensa
+00018920: 7465 6429 0a20 2020 2078 203d 206e 702e  ted).    x = np.
+00018930: 6873 7461 636b 285b 302c 2078 5f63 6f6d  hstack([0, x_com
+00018940: 7065 6e73 6174 6564 5d29 202f 206d 6178  pensated]) / max
+00018950: 2878 5f63 6f6d 7065 6e73 6174 6564 2920  (x_compensated) 
+00018960: 2a20 6c65 6e67 7468 0a0a 2020 2020 2320  * length..    # 
+00018970: 4372 6561 7465 2062 6c61 6e6b 2064 6576  Create blank dev
+00018980: 6963 6520 616e 6420 6164 6420 7461 7065  ice and add tape
+00018990: 7220 706f 6c79 676f 6e0a 2020 2020 4420  r polygon.    D 
+000189a0: 3d20 4465 7669 6365 2822 6865 636b 656e  = Device("hecken
+000189b0: 2229 0a20 2020 2078 7074 7320 3d20 6e70  ").    xpts = np
+000189c0: 2e63 6f6e 6361 7465 6e61 7465 285b 782c  .concatenate([x,
+000189d0: 2078 5b3a 3a2d 315d 5d29 0a20 2020 2079   x[::-1]]).    y
+000189e0: 7074 7320 3d20 6e70 2e63 6f6e 6361 7465  pts = np.concate
+000189f0: 6e61 7465 285b 7769 6474 6873 202f 2032  nate([widths / 2
+00018a00: 2c20 2d77 6964 7468 735b 3a3a 2d31 5d20  , -widths[::-1] 
+00018a10: 2f20 325d 290a 2020 2020 442e 6164 645f  / 2]).    D.add_
+00018a20: 706f 6c79 676f 6e28 2878 7074 732c 2079  polygon((xpts, y
+00018a30: 7074 7329 2c20 6c61 7965 723d 6c61 7965  pts), layer=laye
+00018a40: 7229 0a20 2020 2044 2e61 6464 5f70 6f72  r).    D.add_por
+00018a50: 7428 6e61 6d65 3d31 2c20 6d69 6470 6f69  t(name=1, midpoi
+00018a60: 6e74 3d28 302c 2030 292c 2077 6964 7468  nt=(0, 0), width
+00018a70: 3d77 6964 7468 735b 305d 2c20 6f72 6965  =widths[0], orie
+00018a80: 6e74 6174 696f 6e3d 3138 3029 0a20 2020  ntation=180).   
+00018a90: 2044 2e61 6464 5f70 6f72 7428 6e61 6d65   D.add_port(name
+00018aa0: 3d32 2c20 6d69 6470 6f69 6e74 3d28 6c65  =2, midpoint=(le
+00018ab0: 6e67 7468 2c20 3029 2c20 7769 6474 683d  ngth, 0), width=
+00018ac0: 7769 6474 6873 5b2d 315d 2c20 6f72 6965  widths[-1], orie
+00018ad0: 6e74 6174 696f 6e3d 3029 0a0a 2020 2020  ntation=0)..    
+00018ae0: 2320 4164 6420 6d65 7461 2069 6e66 6f72  # Add meta infor
+00018af0: 6d61 7469 6f6e 2061 626f 7574 2074 6865  mation about the
+00018b00: 2074 6170 6572 0a20 2020 2044 2e69 6e66   taper.    D.inf
+00018b10: 6f5b 226e 756d 5f73 7175 6172 6573 225d  o["num_squares"]
+00018b20: 203d 206e 702e 7375 6d28 6e70 2e64 6966   = np.sum(np.dif
+00018b30: 6628 7829 202f 2077 6964 7468 735b 3a2d  f(x) / widths[:-
+00018b40: 315d 290a 2020 2020 442e 696e 666f 5b22  1]).    D.info["
+00018b50: 7769 6474 6831 225d 203d 2077 6964 7468  width1"] = width
+00018b60: 735b 305d 0a20 2020 2044 2e69 6e66 6f5b  s[0].    D.info[
+00018b70: 2277 6964 7468 3222 5d20 3d20 7769 6474  "width2"] = widt
+00018b80: 6873 5b2d 315d 0a20 2020 2044 2e69 6e66  hs[-1].    D.inf
+00018b90: 6f5b 225a 3122 5d20 3d20 5a5b 305d 0a20  o["Z1"] = Z[0]. 
+00018ba0: 2020 2044 2e69 6e66 6f5b 225a 3222 5d20     D.info["Z2"] 
+00018bb0: 3d20 5a5b 2d31 5d0a 2020 2020 2320 4e6f  = Z[-1].    # No
+00018bc0: 7465 2074 6865 7265 2061 7265 2074 776f  te there are two
+00018bd0: 2076 616c 7565 7320 666f 7220 762f 6320   values for v/c 
+00018be0: 2861 6e64 2066 5f63 7574 6f66 6629 2062  (and f_cutoff) b
+00018bf0: 6563 6175 7365 2074 6865 2073 7065 6564  ecause the speed
+00018c00: 206f 660a 2020 2020 2320 6c69 6768 7420   of.    # light 
+00018c10: 6973 2064 6966 6665 7265 6e74 2061 7420  is different at 
+00018c20: 7468 6520 6265 6769 6e6e 696e 6720 616e  the beginning an
+00018c30: 6420 656e 6420 6f66 2074 6865 2074 6170  d end of the tap
+00018c40: 6572 0a20 2020 2044 2e69 6e66 6f5b 2277  er.    D.info["w
+00018c50: 225d 203d 2077 6964 7468 730a 2020 2020  "] = widths.    
+00018c60: 442e 696e 666f 5b22 7822 5d20 3d20 780a  D.info["x"] = x.
+00018c70: 2020 2020 442e 696e 666f 5b22 5a22 5d20      D.info["Z"] 
+00018c80: 3d20 5a0a 2020 2020 442e 696e 666f 5b22  = Z.    D.info["
+00018c90: 762f 6322 5d20 3d20 7620 2f20 3365 380a  v/c"] = v / 3e8.
+00018ca0: 2020 2020 442e 696e 666f 5b22 7469 6d65      D.info["time
+00018cb0: 5f6c 656e 6774 6822 5d20 3d20 6e70 2e73  _length"] = np.s
+00018cc0: 756d 280a 2020 2020 2020 2020 6e70 2e64  um(.        np.d
+00018cd0: 6966 6628 442e 696e 666f 5b22 7822 5d20  iff(D.info["x"] 
+00018ce0: 2a20 3165 2d36 2920 2f20 2844 2e69 6e66  * 1e-6) / (D.inf
+00018cf0: 6f5b 2276 2f63 225d 5b3a 2d31 5d20 2a20  o["v/c"][:-1] * 
+00018d00: 3365 3829 0a20 2020 2029 0a20 2020 2044  3e8).    ).    D
+00018d10: 2e69 6e66 6f5b 2266 5f63 7574 6f66 6622  .info["f_cutoff"
+00018d20: 5d20 3d20 3120 2f20 2832 202a 2044 2e69  ] = 1 / (2 * D.i
+00018d30: 6e66 6f5b 2274 696d 655f 6c65 6e67 7468  nfo["time_length
+00018d40: 225d 290a 2020 2020 442e 696e 666f 5b22  "]).    D.info["
+00018d50: 6c65 6e67 7468 225d 203d 206c 656e 6774  length"] = lengt
+00018d60: 680a 0a20 2020 2072 6574 7572 6e20 440a  h..    return D.
+00018d70: 0a0a 4064 6576 6963 655f 6c72 755f 6361  ..@device_lru_ca
+00018d80: 6368 650a 6465 6620 6d65 616e 6465 725f  che.def meander_
+00018d90: 7461 7065 7228 0a20 2020 2078 5f74 6170  taper(.    x_tap
+00018da0: 6572 2c20 775f 7461 7065 722c 206d 6561  er, w_taper, mea
+00018db0: 6e64 6572 5f6c 656e 6774 683d 3130 3030  nder_length=1000
+00018dc0: 2c20 7370 6163 696e 675f 6661 6374 6f72  , spacing_factor
+00018dd0: 3d33 2c20 6d69 6e5f 7370 6163 696e 673d  =3, min_spacing=
+00018de0: 302e 352c 206c 6179 6572 3d30 0a29 3a0a  0.5, layer=0.):.
+00018df0: 2020 2020 2222 2254 616b 6573 2069 6e20      """Takes in 
+00018e00: 616e 2061 7272 6179 206f 6620 782d 706f  an array of x-po
+00018e10: 7369 7469 6f6e 7320 616e 6420 6120 6172  sitions and a ar
+00018e20: 7261 7920 6f66 2077 6964 7468 7320 2863  ray of widths (c
+00018e30: 6f72 7265 7370 6f6e 6469 6e67 2074 6f0a  orresponding to.
+00018e40: 2020 2020 6561 6368 2078 2d70 6f73 6974      each x-posit
+00018e50: 696f 6e29 2061 6e64 2063 7265 6174 6573  ion) and creates
+00018e60: 2061 206d 6561 6e64 6572 2e20 2054 7970   a meander.  Typ
+00018e70: 6963 616c 6c79 2075 7365 6420 666f 7220  ically used for 
+00018e80: 6372 6561 7469 6e67 0a20 2020 206d 6561  creating.    mea
+00018e90: 6e64 6572 6564 2074 6170 6572 730a 0a20  ndered tapers.. 
+00018ea0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00018eb0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00018ec0: 2078 5f74 6170 6572 203a 2061 7272 6179   x_taper : array
+00018ed0: 2d6c 696b 655b 4e5d 0a20 2020 2020 2020  -like[N].       
+00018ee0: 2054 6865 2078 2d63 6f6f 7264 696e 6174   The x-coordinat
+00018ef0: 6573 206f 6620 7468 6520 6461 7461 2070  es of the data p
+00018f00: 6f69 6e74 732c 206d 7573 7420 6265 2069  oints, must be i
+00018f10: 6e63 7265 6173 696e 672e 0a20 2020 2077  ncreasing..    w
+00018f20: 5f74 6170 6572 203a 2061 7272 6179 2d6c  _taper : array-l
+00018f30: 696b 655b 4e5d 0a20 2020 2020 2020 2054  ike[N].        T
+00018f40: 6865 2079 2d63 6f6f 7264 696e 6174 6573  he y-coordinates
+00018f50: 206f 6620 7468 6520 6461 7461 2070 6f69   of the data poi
+00018f60: 6e74 732c 2073 616d 6520 6c65 6e67 7468  nts, same length
+00018f70: 2061 7320 6060 785f 7461 7065 7260 602e   as ``x_taper``.
+00018f80: 0a20 2020 206d 6561 6e64 6572 5f6c 656e  .    meander_len
+00018f90: 6774 6820 3a20 696e 7420 6f72 2066 6c6f  gth : int or flo
+00018fa0: 6174 0a20 2020 2020 2020 204c 656e 6774  at.        Lengt
+00018fb0: 6820 6f66 2065 6163 6820 7365 6374 696f  h of each sectio
+00018fc0: 6e20 6f66 2074 6865 206d 6561 6e64 6572  n of the meander
+00018fd0: 0a20 2020 2073 7061 6369 6e67 5f66 6163  .    spacing_fac
+00018fe0: 746f 7220 3a20 696e 7420 6f72 2066 6c6f  tor : int or flo
+00018ff0: 6174 0a20 2020 2020 2020 204d 756c 7469  at.        Multi
+00019000: 706c 6963 6174 6976 6520 7370 6163 696e  plicative spacin
+00019010: 6720 6661 6374 6f72 2062 6574 7765 656e  g factor between
+00019020: 2061 646a 6163 656e 7420 6d65 616e 6465   adjacent meande
+00019030: 7273 0a20 2020 206d 696e 5f73 7061 6369  rs.    min_spaci
+00019040: 6e67 203a 2069 6e74 206f 7220 666c 6f61  ng : int or floa
+00019050: 740a 2020 2020 2020 2020 4d69 6e69 6d75  t.        Minimu
+00019060: 6d20 7370 6163 696e 6720 6265 7477 6565  m spacing betwee
+00019070: 6e20 6164 6a61 6365 6e74 206d 6561 6e64  n adjacent meand
+00019080: 6572 730a 0a20 2020 206c 6179 6572 203a  ers..    layer :
+00019090: 2069 6e74 2c20 6172 7261 792d 6c69 6b65   int, array-like
+000190a0: 5b32 5d2c 206f 7220 7365 740a 2020 2020  [2], or set.    
+000190b0: 2020 2020 5370 6563 6966 6963 206c 6179      Specific lay
+000190c0: 6572 2873 2920 746f 2070 7574 2070 6f6c  er(s) to put pol
+000190d0: 7967 6f6e 2067 656f 6d65 7472 7920 6f6e  ygon geometry on
+000190e0: 2e0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
+000190f0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2044     -------.    D
+00019100: 203a 2044 6576 6963 650a 0a20 2020 2022   : Device..    "
+00019110: 2222 0a0a 2020 2020 6465 6620 7461 7065  ""..    def tape
+00019120: 725f 7769 6474 6828 7829 3a0a 2020 2020  r_width(x):.    
+00019130: 2020 2020 7265 7475 726e 206e 702e 696e      return np.in
+00019140: 7465 7270 2878 2c20 785f 7461 7065 722c  terp(x, x_taper,
+00019150: 2077 5f74 6170 6572 290a 0a20 2020 2064   w_taper)..    d
+00019160: 6566 2074 6170 6572 5f73 6563 7469 6f6e  ef taper_section
+00019170: 2878 5f73 7461 7274 2c20 785f 656e 642c  (x_start, x_end,
+00019180: 206e 756d 5f70 7473 3d33 302c 206c 6179   num_pts=30, lay
+00019190: 6572 3d30 293a 0a20 2020 2020 2020 2044  er=0):.        D
+000191a0: 203d 2044 6576 6963 6528 2274 6170 6572   = Device("taper
+000191b0: 7365 6322 290a 2020 2020 2020 2020 6c65  sec").        le
+000191c0: 6e67 7468 203d 2078 5f65 6e64 202d 2078  ngth = x_end - x
+000191d0: 5f73 7461 7274 0a20 2020 2020 2020 2078  _start.        x
+000191e0: 203d 206e 702e 6c69 6e73 7061 6365 2830   = np.linspace(0
+000191f0: 2c20 6c65 6e67 7468 2c20 6e75 6d5f 7074  , length, num_pt
+00019200: 7329 0a20 2020 2020 2020 2077 6964 7468  s).        width
+00019210: 7320 3d20 6e70 2e6c 696e 7370 6163 6528  s = np.linspace(
+00019220: 7461 7065 725f 7769 6474 6828 785f 7374  taper_width(x_st
+00019230: 6172 7429 2c20 7461 7065 725f 7769 6474  art), taper_widt
+00019240: 6828 785f 656e 6429 2c20 6e75 6d5f 7074  h(x_end), num_pt
+00019250: 7329 0a20 2020 2020 2020 2078 7074 7320  s).        xpts 
+00019260: 3d20 6e70 2e63 6f6e 6361 7465 6e61 7465  = np.concatenate
+00019270: 285b 782c 2078 5b3a 3a2d 315d 5d29 0a20  ([x, x[::-1]]). 
+00019280: 2020 2020 2020 2079 7074 7320 3d20 6e70         ypts = np
+00019290: 2e63 6f6e 6361 7465 6e61 7465 285b 7769  .concatenate([wi
+000192a0: 6474 6873 202f 2032 2c20 2d77 6964 7468  dths / 2, -width
+000192b0: 735b 3a3a 2d31 5d20 2f20 325d 290a 2020  s[::-1] / 2]).  
+000192c0: 2020 2020 2020 442e 6164 645f 706f 6c79        D.add_poly
+000192d0: 676f 6e28 2878 7074 732c 2079 7074 7329  gon((xpts, ypts)
+000192e0: 2c20 6c61 7965 723d 6c61 7965 7229 0a20  , layer=layer). 
+000192f0: 2020 2020 2020 2044 2e61 6464 5f70 6f72         D.add_por
+00019300: 7428 6e61 6d65 3d31 2c20 6d69 6470 6f69  t(name=1, midpoi
+00019310: 6e74 3d28 302c 2030 292c 2077 6964 7468  nt=(0, 0), width
+00019320: 3d77 6964 7468 735b 305d 2c20 6f72 6965  =widths[0], orie
+00019330: 6e74 6174 696f 6e3d 3138 3029 0a20 2020  ntation=180).   
+00019340: 2020 2020 2044 2e61 6464 5f70 6f72 7428       D.add_port(
+00019350: 6e61 6d65 3d32 2c20 6d69 6470 6f69 6e74  name=2, midpoint
+00019360: 3d28 6c65 6e67 7468 2c20 3029 2c20 7769  =(length, 0), wi
+00019370: 6474 683d 7769 6474 6873 5b2d 315d 2c20  dth=widths[-1], 
+00019380: 6f72 6965 6e74 6174 696f 6e3d 3029 0a20  orientation=0). 
+00019390: 2020 2020 2020 2072 6574 7572 6e20 440a         return D.
+000193a0: 0a20 2020 2064 6566 2061 7263 5f74 6170  .    def arc_tap
+000193b0: 6572 6564 280a 2020 2020 2020 2020 7261  ered(.        ra
+000193c0: 6469 7573 3d31 302c 2077 6964 7468 313d  dius=10, width1=
+000193d0: 312c 2077 6964 7468 323d 322c 2074 6865  1, width2=2, the
+000193e0: 7461 3d34 352c 2061 6e67 6c65 5f72 6573  ta=45, angle_res
+000193f0: 6f6c 7574 696f 6e3d 322e 352c 206c 6179  olution=2.5, lay
+00019400: 6572 3d30 0a20 2020 2029 3a0a 2020 2020  er=0.    ):.    
+00019410: 2020 2020 4420 3d20 4465 7669 6365 2822      D = Device("
+00019420: 6172 6374 6170 6572 2229 0a20 2020 2020  arctaper").     
+00019430: 2020 2070 6174 6831 203d 2067 6473 7079     path1 = gdspy
+00019440: 2e50 6174 6828 7769 6474 683d 7769 6474  .Path(width=widt
+00019450: 6831 2c20 696e 6974 6961 6c5f 706f 696e  h1, initial_poin
+00019460: 743d 2830 2c20 3029 290a 2020 2020 2020  t=(0, 0)).      
+00019470: 2020 7061 7468 312e 7475 726e 280a 2020    path1.turn(.  
+00019480: 2020 2020 2020 2020 2020 7261 6469 7573            radius
+00019490: 3d72 6164 6975 732c 0a20 2020 2020 2020  =radius,.       
+000194a0: 2020 2020 2061 6e67 6c65 3d74 6865 7461       angle=theta
+000194b0: 202a 2070 6920 2f20 3138 302c 0a20 2020   * pi / 180,.   
+000194c0: 2020 2020 2020 2020 206e 756d 6265 725f           number_
+000194d0: 6f66 5f70 6f69 6e74 733d 696e 7428 6162  of_points=int(ab
+000194e0: 7328 3220 2a20 7468 6574 6120 2f20 616e  s(2 * theta / an
+000194f0: 676c 655f 7265 736f 6c75 7469 6f6e 2929  gle_resolution))
+00019500: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
+00019510: 6e61 6c5f 7769 6474 683d 7769 6474 6832  nal_width=width2
+00019520: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+00019530: 2020 2020 5b44 2e61 6464 5f70 6f6c 7967      [D.add_polyg
+00019540: 6f6e 2870 2c20 6c61 7965 723d 6c61 7965  on(p, layer=laye
+00019550: 7229 2066 6f72 2070 2069 6e20 7061 7468  r) for p in path
+00019560: 312e 706f 6c79 676f 6e73 5d0a 2020 2020  1.polygons].    
+00019570: 2020 2020 442e 6164 645f 706f 7274 286e      D.add_port(n
+00019580: 616d 653d 312c 206d 6964 706f 696e 743d  ame=1, midpoint=
+00019590: 2830 2c20 3029 2c20 7769 6474 683d 7769  (0, 0), width=wi
+000195a0: 6474 6831 2c20 6f72 6965 6e74 6174 696f  dth1, orientatio
+000195b0: 6e3d 3138 3029 0a20 2020 2020 2020 2044  n=180).        D
+000195c0: 2e61 6464 5f70 6f72 7428 0a20 2020 2020  .add_port(.     
+000195d0: 2020 2020 2020 206e 616d 653d 322c 0a20         name=2,. 
+000195e0: 2020 2020 2020 2020 2020 206d 6964 706f             midpo
+000195f0: 696e 743d 2870 6174 6831 2e78 2c20 7061  int=(path1.x, pa
+00019600: 7468 312e 7929 2c0a 2020 2020 2020 2020  th1.y),.        
+00019610: 2020 2020 7769 6474 683d 7769 6474 6832      width=width2
+00019620: 2c0a 2020 2020 2020 2020 2020 2020 6f72  ,.            or
+00019630: 6965 6e74 6174 696f 6e3d 7061 7468 312e  ientation=path1.
+00019640: 6469 7265 6374 696f 6e20 2a20 3138 3020  direction * 180 
+00019650: 2f20 7069 2c0a 2020 2020 2020 2020 290a  / pi,.        ).
+00019660: 2020 2020 2020 2020 7265 7475 726e 2044          return D
+00019670: 0a0a 2020 2020 4420 3d20 4465 7669 6365  ..    D = Device
+00019680: 2822 6d65 616e 6465 722d 7461 7065 7222  ("meander-taper"
+00019690: 290a 2020 2020 7870 6f73 3120 3d20 6d69  ).    xpos1 = mi
+000196a0: 6e28 785f 7461 7065 7229 0a20 2020 2078  n(x_taper).    x
+000196b0: 706f 7332 203d 206d 696e 2878 5f74 6170  pos2 = min(x_tap
+000196c0: 6572 2920 2b20 6d65 616e 6465 725f 6c65  er) + meander_le
+000196d0: 6e67 7468 0a20 2020 2074 203d 2044 2e61  ngth.    t = D.a
+000196e0: 6464 5f72 6566 2874 6170 6572 5f73 6563  dd_ref(taper_sec
+000196f0: 7469 6f6e 2878 5f73 7461 7274 3d78 706f  tion(x_start=xpo
+00019700: 7331 2c20 785f 656e 643d 7870 6f73 322c  s1, x_end=xpos2,
+00019710: 206e 756d 5f70 7473 3d35 302c 206c 6179   num_pts=50, lay
+00019720: 6572 3d6c 6179 6572 2929 0a20 2020 2044  er=layer)).    D
+00019730: 2e61 6464 5f70 6f72 7428 742e 706f 7274  .add_port(t.port
+00019740: 735b 315d 290a 2020 2020 6469 725f 746f  s[1]).    dir_to
+00019750: 6767 6c65 203d 202d 310a 2020 2020 7768  ggle = -1.    wh
+00019760: 696c 6520 7870 6f73 3220 3c20 6d61 7828  ile xpos2 < max(
+00019770: 785f 7461 7065 7229 3a0a 2020 2020 2020  x_taper):.      
+00019780: 2020 6172 635f 7769 6474 6831 203d 2074    arc_width1 = t
+00019790: 6170 6572 5f77 6964 7468 2878 706f 7332  aper_width(xpos2
+000197a0: 290a 2020 2020 2020 2020 6172 635f 7261  ).        arc_ra
+000197b0: 6469 7573 203d 206d 6178 2873 7061 6369  dius = max(spaci
+000197c0: 6e67 5f66 6163 746f 7220 2a20 6172 635f  ng_factor * arc_
+000197d0: 7769 6474 6831 2c20 6d69 6e5f 7370 6163  width1, min_spac
+000197e0: 696e 6729 0a20 2020 2020 2020 2061 7263  ing).        arc
+000197f0: 5f6c 656e 6774 6820 3d20 7069 202a 2061  _length = pi * a
+00019800: 7263 5f72 6164 6975 730a 2020 2020 2020  rc_radius.      
+00019810: 2020 6172 635f 7769 6474 6832 203d 2074    arc_width2 = t
+00019820: 6170 6572 5f77 6964 7468 2878 706f 7332  aper_width(xpos2
+00019830: 202b 2061 7263 5f6c 656e 6774 6829 0a20   + arc_length). 
+00019840: 2020 2020 2020 2041 203d 2061 7263 5f74         A = arc_t
+00019850: 6170 6572 6564 280a 2020 2020 2020 2020  apered(.        
+00019860: 2020 2020 7261 6469 7573 3d61 7263 5f72      radius=arc_r
+00019870: 6164 6975 732c 0a20 2020 2020 2020 2020  adius,.         
+00019880: 2020 2077 6964 7468 313d 6172 635f 7769     width1=arc_wi
+00019890: 6474 6831 2c0a 2020 2020 2020 2020 2020  dth1,.          
+000198a0: 2020 7769 6474 6832 3d61 7263 5f77 6964    width2=arc_wid
+000198b0: 7468 322c 0a20 2020 2020 2020 2020 2020  th2,.           
+000198c0: 2074 6865 7461 3d31 3830 202a 2064 6972   theta=180 * dir
+000198d0: 5f74 6f67 676c 652c 0a20 2020 2020 2020  _toggle,.       
+000198e0: 2020 2020 206c 6179 6572 3d6c 6179 6572       layer=layer
+000198f0: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+00019900: 2020 2020 6120 3d20 442e 6164 645f 7265      a = D.add_re
+00019910: 6628 4129 0a20 2020 2020 2020 2061 2e63  f(A).        a.c
+00019920: 6f6e 6e65 6374 2870 6f72 743d 312c 2064  onnect(port=1, d
+00019930: 6573 7469 6e61 7469 6f6e 3d74 2e70 6f72  estination=t.por
+00019940: 7473 5b32 5d29 0a20 2020 2020 2020 2064  ts[2]).        d
+00019950: 6972 5f74 6f67 676c 6520 3d20 2d64 6972  ir_toggle = -dir
+00019960: 5f74 6f67 676c 650a 2020 2020 2020 2020  _toggle.        
+00019970: 7870 6f73 3120 3d20 7870 6f73 3220 2b20  xpos1 = xpos2 + 
+00019980: 6172 635f 6c65 6e67 7468 0a20 2020 2020  arc_length.     
+00019990: 2020 2078 706f 7332 203d 2078 706f 7331     xpos2 = xpos1
+000199a0: 202b 206d 6561 6e64 6572 5f6c 656e 6774   + meander_lengt
+000199b0: 680a 2020 2020 2020 2020 7420 3d20 442e  h.        t = D.
+000199c0: 6164 645f 7265 6628 0a20 2020 2020 2020  add_ref(.       
+000199d0: 2020 2020 2074 6170 6572 5f73 6563 7469       taper_secti
+000199e0: 6f6e 2878 5f73 7461 7274 3d78 706f 7331  on(x_start=xpos1
+000199f0: 2c20 785f 656e 643d 7870 6f73 322c 206e  , x_end=xpos2, n
+00019a00: 756d 5f70 7473 3d33 302c 206c 6179 6572  um_pts=30, layer
+00019a10: 3d6c 6179 6572 290a 2020 2020 2020 2020  =layer).        
+00019a20: 290a 2020 2020 2020 2020 742e 636f 6e6e  ).        t.conn
+00019a30: 6563 7428 706f 7274 3d31 2c20 6465 7374  ect(port=1, dest
+00019a40: 696e 6174 696f 6e3d 612e 706f 7274 735b  ination=a.ports[
+00019a50: 325d 290a 2020 2020 442e 6164 645f 706f  2]).    D.add_po
+00019a60: 7274 2874 2e70 6f72 7473 5b32 5d29 0a0a  rt(t.ports[2])..
+00019a70: 2020 2020 7265 7475 726e 2044 0a0a 0a23      return D...#
+00019a80: 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d   ===============
+00019a90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019aa0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019ab0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019ac0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a  ===============.
+00019ad0: 2320 4578 616d 706c 6520 636f 6465 0a23  # Example code.#
+00019ae0: 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d   ===============
+00019af0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019b00: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019b10: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019b20: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a  ===============.
+00019b30: 0a23 2044 203d 2072 6163 6574 7261 636b  .# D = racetrack
+00019b40: 5f67 7261 6475 616c 2877 6964 7468 2c20  _gradual(width, 
+00019b50: 5220 3d20 352c 204e 3d33 290a 2320 7175  R = 5, N=3).# qu
+00019b60: 6963 6b70 6c6f 7428 4429 0a0a 2320 4420  ickplot(D)..# D 
+00019b70: 3d20 6865 636b 656e 5f74 6170 6572 286c  = hecken_taper(l
+00019b80: 656e 6774 6820 3d20 3230 302c 2042 203d  ength = 200, B =
+00019b90: 2034 2e30 3039 312c 2064 6965 6c65 6374   4.0091, dielect
+00019ba0: 7269 635f 7468 6963 6b6e 6573 7320 3d20  ric_thickness = 
+00019bb0: 302e 3235 2c20 6570 735f 7220 3d20 322c  0.25, eps_r = 2,
+00019bc0: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
+00019bd0: 2020 2020 4c6b 5f70 6572 5f73 7120 3d20      Lk_per_sq = 
+00019be0: 3235 3065 2d31 322c 205a 3120 3d20 3530  250e-12, Z1 = 50
+00019bf0: 2c20 7769 6474 6832 203d 2030 2e33 2c0a  , width2 = 0.3,.
+00019c00: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00019c10: 2020 206e 756d 5f70 7473 203d 2031 3030     num_pts = 100
+00019c20: 2c20 6c61 7965 7220 3d20 3029 0a23 2071  , layer = 0).# q
+00019c30: 7569 636b 706c 6f74 2844 290a 0a23 2074  uickplot(D)..# t
+00019c40: 203d 206e 702e 6c69 6e73 7061 6365 2830   = np.linspace(0
+00019c50: 2c31 290a 2320 782c 7920 3d20 5f72 6163  ,1).# x,y = _rac
+00019c60: 6574 7261 636b 5f67 7261 6475 616c 5f70  etrack_gradual_p
+00019c70: 6172 616d 6574 7269 6328 742c 2052 203d  arametric(t, R =
+00019c80: 2035 2c20 4e20 3d20 3329 0a23 2070 6c74   5, N = 3).# plt
+00019c90: 2e70 6c6f 7428 782c 7929 0a23 2070 6c74  .plot(x,y).# plt
+00019ca0: 2e61 7869 7328 2765 7175 616c 2729 0a0a  .axis('equal')..
+00019cb0: 0a23 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  .# =============
+00019cc0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019cd0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019ce0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019cf0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019d00: 3d0a 230a 2320 5465 7874 0a23 0a23 203d  =.#.# Text.#.# =
+00019d10: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019d20: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019d30: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019d40: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00019d50: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 0a0a  =============...
+00019d60: 6465 6620 7465 7874 2874 6578 743d 2261  def text(text="a
+00019d70: 6263 6422 2c20 7369 7a65 3d31 302c 206a  bcd", size=10, j
+00019d80: 7573 7469 6679 3d22 6c65 6674 222c 206c  ustify="left", l
+00019d90: 6179 6572 3d30 2c20 666f 6e74 3d22 4445  ayer=0, font="DE
+00019da0: 504c 4f46 2229 3a0a 2020 2020 2222 2243  PLOF"):.    """C
+00019db0: 7265 6174 6573 2067 656f 6d65 7472 6965  reates geometrie
+00019dc0: 7320 6f66 2074 6578 740a 0a20 2020 2050  s of text..    P
+00019dd0: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+00019de0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2074 6578  --------.    tex
+00019df0: 7420 3a20 7374 720a 2020 2020 2020 2020  t : str.        
+00019e00: 5465 7874 2073 7472 696e 6720 746f 2062  Text string to b
+00019e10: 6520 7772 6974 7465 6e2e 0a20 2020 2073  e written..    s
+00019e20: 697a 6520 3a20 696e 7420 6f72 2066 6c6f  ize : int or flo
+00019e30: 6174 0a20 2020 2020 2020 2053 697a 6520  at.        Size 
+00019e40: 6f66 2074 6865 2074 6578 740a 2020 2020  of the text.    
+00019e50: 6a75 7374 6966 7920 3a20 7b27 6c65 6674  justify : {'left
+00019e60: 272c 2027 7269 6768 7427 2c20 2763 656e  ', 'right', 'cen
+00019e70: 7465 7227 7d0a 2020 2020 2020 2020 4a75  ter'}.        Ju
+00019e80: 7374 6966 6963 6174 696f 6e20 6f66 2074  stification of t
+00019e90: 6865 2074 6578 742e 0a20 2020 206c 6179  he text..    lay
+00019ea0: 6572 203a 2069 6e74 2c20 6172 7261 792d  er : int, array-
+00019eb0: 6c69 6b65 5b32 5d2c 206f 7220 7365 740a  like[2], or set.
+00019ec0: 2020 2020 2020 2020 5370 6563 6966 6963          Specific
+00019ed0: 206c 6179 6572 2873 2920 746f 2070 7574   layer(s) to put
+00019ee0: 2070 6f6c 7967 6f6e 2067 656f 6d65 7472   polygon geometr
+00019ef0: 7920 6f6e 2e0a 2020 2020 666f 6e74 3a20  y on..    font: 
+00019f00: 7374 720a 2020 2020 2020 2020 466f 6e74  str.        Font
+00019f10: 2066 6163 6520 746f 2075 7365 2e20 4465   face to use. De
+00019f20: 6661 756c 7420 4445 504c 4f46 2064 6f65  fault DEPLOF doe
+00019f30: 7320 6e6f 7420 7265 7175 6972 6520 6164  s not require ad
+00019f40: 6469 7469 6f6e 616c 206c 6962 7261 7269  ditional librari
+00019f50: 6573 2c20 6f74 6865 7277 6973 650a 2020  es, otherwise.  
+00019f60: 2020 2020 2020 6672 6565 7479 7065 2077        freetype w
+00019f70: 696c 6c20 6265 2075 7365 6420 746f 206c  ill be used to l
+00019f80: 6f61 6420 666f 6e74 732e 2046 6f6e 7420  oad fonts. Font 
+00019f90: 6361 6e20 6265 2067 6976 656e 2065 6974  can be given eit
+00019fa0: 6865 7220 6279 206e 616d 6520 2865 2e67  her by name (e.g
+00019fb0: 2e20 2254 696d 6573 204e 6577 2052 6f6d  . "Times New Rom
+00019fc0: 616e 2229 2c0a 2020 2020 2020 2020 6f72  an"),.        or
+00019fd0: 2062 7920 6669 6c65 2070 6174 682e 204f   by file path. O
+00019fe0: 5446 206f 7220 5454 4620 666f 6e74 7320  TF or TTF fonts 
+00019ff0: 6172 6520 7375 7070 6f72 7465 642e 0a0a  are supported...
+0001a000: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+0001a010: 2d2d 2d2d 2d2d 2d0a 2020 2020 7420 3a20  -------.    t : 
+0001a020: 4465 7669 6365 0a20 2020 2020 2020 2041  Device.        A
+0001a030: 2044 6576 6963 6520 636f 6e74 6169 6e69   Device containi
+0001a040: 6e67 2074 6865 2074 6578 7420 6765 6f6d  ng the text geom
+0001a050: 6574 7279 2e0a 2020 2020 2222 220a 2020  etry..    """.  
+0001a060: 2020 7420 3d20 4465 7669 6365 2822 7465    t = Device("te
+0001a070: 7874 2229 0a20 2020 2078 6f66 6673 6574  xt").    xoffset
+0001a080: 203d 2030 0a20 2020 2079 6f66 6673 6574   = 0.    yoffset
+0001a090: 203d 2030 0a0a 2020 2020 6661 6365 203d   = 0..    face =
+0001a0a0: 2066 6f6e 740a 2020 2020 6966 2066 6163   font.    if fac
+0001a0b0: 6520 3d3d 2022 4445 504c 4f46 223a 0a20  e == "DEPLOF":. 
+0001a0c0: 2020 2020 2020 2073 6361 6c69 6e67 203d         scaling =
+0001a0d0: 2073 697a 6520 2f20 3130 3030 0a0a 2020   size / 1000..  
+0001a0e0: 2020 2020 2020 666f 7220 6c69 6e65 2069        for line i
+0001a0f0: 6e20 7465 7874 2e73 706c 6974 2822 5c6e  n text.split("\n
+0001a100: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+0001a110: 6c20 3d20 4465 7669 6365 286e 616d 653d  l = Device(name=
+0001a120: 2274 6578 746c 696e 6522 290a 2020 2020  "textline").    
+0001a130: 2020 2020 2020 2020 666f 7220 6320 696e          for c in
+0001a140: 206c 696e 653a 0a20 2020 2020 2020 2020   line:.         
+0001a150: 2020 2020 2020 2061 7363 6969 5f76 616c         ascii_val
+0001a160: 203d 206f 7264 2863 290a 2020 2020 2020   = ord(c).      
+0001a170: 2020 2020 2020 2020 2020 6966 2063 203d            if c =
+0001a180: 3d20 2220 223a 0a20 2020 2020 2020 2020  = " ":.         
+0001a190: 2020 2020 2020 2020 2020 2078 6f66 6673             xoffs
+0001a1a0: 6574 202b 3d20 3530 3020 2a20 7363 616c  et += 500 * scal
+0001a1b0: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+0001a1c0: 2020 2020 656c 6966 2028 3333 203c 3d20      elif (33 <= 
+0001a1d0: 6173 6369 695f 7661 6c20 3c3d 2031 3236  ascii_val <= 126
+0001a1e0: 2920 6f72 2028 6173 6369 695f 7661 6c20  ) or (ascii_val 
+0001a1f0: 3d3d 2031 3831 293a 0a20 2020 2020 2020  == 181):.       
+0001a200: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001a210: 2070 6f6c 7920 696e 205f 676c 7970 685b   poly in _glyph[
+0001a220: 6173 6369 695f 7661 6c5d 3a0a 2020 2020  ascii_val]:.    
+0001a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a240: 2020 2020 7870 7473 203d 206e 702e 6172      xpts = np.ar
+0001a250: 7261 7928 706f 6c79 295b 3a2c 2030 5d20  ray(poly)[:, 0] 
+0001a260: 2a20 7363 616c 696e 670a 2020 2020 2020  * scaling.      
+0001a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a280: 2020 7970 7473 203d 206e 702e 6172 7261    ypts = np.arra
+0001a290: 7928 706f 6c79 295b 3a2c 2031 5d20 2a20  y(poly)[:, 1] * 
+0001a2a0: 7363 616c 696e 670a 2020 2020 2020 2020  scaling.        
+0001a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a2c0: 6c2e 6164 645f 706f 6c79 676f 6e28 5b78  l.add_polygon([x
+0001a2d0: 7074 7320 2b20 786f 6666 7365 742c 2079  pts + xoffset, y
+0001a2e0: 7074 7320 2b20 796f 6666 7365 745d 2c20  pts + yoffset], 
+0001a2f0: 6c61 7965 723d 6c61 7965 7229 0a20 2020  layer=layer).   
+0001a300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a310: 2078 6f66 6673 6574 202b 3d20 285f 7769   xoffset += (_wi
+0001a320: 6474 685b 6173 6369 695f 7661 6c5d 202b  dth[ascii_val] +
+0001a330: 205f 696e 6465 6e74 5b61 7363 6969 5f76   _indent[ascii_v
+0001a340: 616c 5d29 202a 2073 6361 6c69 6e67 0a20  al]) * scaling. 
+0001a350: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001a360: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001a370: 2020 2020 2020 2020 2076 616c 6964 5f63           valid_c
+0001a380: 6861 7273 203d 2022 215c 2223 2425 2627  hars = "!\"#$%&'
+0001a390: 2829 2a2b 2c2d 2e2f 3031 3233 3435 3637  ()*+,-./01234567
+0001a3a0: 3839 3a3b 3c3d 3e3f 4041 4243 4445 4647  89:;<=>?@ABCDEFG
+0001a3b0: 4849 4a4b 4c4d 4e4f 5051 5253 5455 5657  HIJKLMNOPQRSTUVW
+0001a3c0: 5859 5a5b 5c5c 5d5e 5f60 6162 6364 6566  XYZ[\\]^_`abcdef
+0001a3d0: 6768 696a 6b6c 6d6e 6f70 7172 7374 7576  ghijklmnopqrstuv
+0001a3e0: 7778 797a 7b7c 7d7e c2b5 220a 2020 2020  wxyz{|}~..".    
+0001a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a400: 7761 726e 696e 6773 2e77 6172 6e28 0a20  warnings.warn(. 
+0001a410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a420: 2020 2020 2020 2027 5b50 4849 444c 5d20         '[PHIDL] 
+0001a430: 7465 7874 2829 3a20 5761 726e 696e 672c  text(): Warning,
+0001a440: 2073 6f6d 6520 6368 6172 6163 7465 7273   some characters
+0001a450: 2069 676e 6f72 6564 2c20 6e6f 2067 656f   ignored, no geo
+0001a460: 6d65 7472 7920 666f 7220 6368 6172 6163  metry for charac
+0001a470: 7465 7220 2225 7322 2077 6974 6820 6173  ter "%s" with as
+0001a480: 6369 6920 7661 6c75 6520 2573 2e20 270a  cii value %s. '.
+0001a490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a4a0: 2020 2020 2020 2020 2256 616c 6964 2063          "Valid c
+0001a4b0: 6861 7261 6374 6572 733a 2025 7322 0a20  haracters: %s". 
+0001a4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a4d0: 2020 2020 2020 2025 2028 6368 7228 6173         % (chr(as
+0001a4e0: 6369 695f 7661 6c29 2c20 6173 6369 695f  cii_val), ascii_
+0001a4f0: 7661 6c2c 2076 616c 6964 5f63 6861 7273  val, valid_chars
+0001a500: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001a510: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001a520: 2020 2020 742e 6164 645f 7265 6628 6c29      t.add_ref(l)
+0001a530: 0a20 2020 2020 2020 2020 2020 2079 6f66  .            yof
+0001a540: 6673 6574 202d 3d20 3135 3030 202a 2073  fset -= 1500 * s
+0001a550: 6361 6c69 6e67 0a20 2020 2020 2020 2020  caling.         
+0001a560: 2020 2078 6f66 6673 6574 203d 2030 0a20     xoffset = 0. 
+0001a570: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001a580: 2066 726f 6d20 2e66 6f6e 7420 696d 706f   from .font impo
+0001a590: 7274 205f 6765 745f 666f 6e74 5f62 795f  rt _get_font_by_
+0001a5a0: 6669 6c65 2c20 5f67 6574 5f66 6f6e 745f  file, _get_font_
+0001a5b0: 6279 5f6e 616d 652c 205f 6765 745f 676c  by_name, _get_gl
+0001a5c0: 7970 680a 0a20 2020 2020 2020 2023 204c  yph..        # L
+0001a5d0: 6f61 6420 7468 6520 666f 6e74 0a20 2020  oad the font.   
+0001a5e0: 2020 2020 2023 2049 6620 7765 2776 6520       # If we've 
+0001a5f0: 7061 7373 6564 2061 2076 616c 6964 2066  passed a valid f
+0001a600: 696c 652c 2074 7279 2074 6f20 6c6f 6164  ile, try to load
+0001a610: 2074 6861 742c 206f 7468 6572 7769 7365   that, otherwise
+0001a620: 2073 6561 7263 6820 7379 7374 656d 2066   search system f
+0001a630: 6f6e 7473 0a20 2020 2020 2020 2066 6f6e  onts.        fon
+0001a640: 7420 3d20 4e6f 6e65 0a20 2020 2020 2020  t = None.       
+0001a650: 2069 6620 2866 6163 652e 656e 6473 7769   if (face.endswi
+0001a660: 7468 2822 2e6f 7466 2229 206f 7220 6661  th(".otf") or fa
+0001a670: 6365 2e65 6e64 7377 6974 6828 222e 7474  ce.endswith(".tt
+0001a680: 6622 2929 2061 6e64 206f 732e 7061 7468  f")) and os.path
+0001a690: 2e65 7869 7374 7328 6661 6365 293a 0a20  .exists(face):. 
+0001a6a0: 2020 2020 2020 2020 2020 2066 6f6e 7420             font 
+0001a6b0: 3d20 5f67 6574 5f66 6f6e 745f 6279 5f66  = _get_font_by_f
+0001a6c0: 696c 6528 6661 6365 290a 2020 2020 2020  ile(face).      
+0001a6d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001a6e0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001a6f0: 2020 2020 2020 2020 2066 6f6e 7420 3d20           font = 
+0001a700: 5f67 6574 5f66 6f6e 745f 6279 5f6e 616d  _get_font_by_nam
+0001a710: 6528 6661 6365 290a 2020 2020 2020 2020  e(face).        
+0001a720: 2020 2020 6578 6365 7074 2056 616c 7565      except Value
+0001a730: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
+0001a740: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+0001a750: 2020 2020 6966 2066 6f6e 7420 6973 204e      if font is N
+0001a760: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0001a770: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0001a780: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0001a790: 2020 2028 0a20 2020 2020 2020 2020 2020     (.           
+0001a7a0: 2020 2020 2020 2020 2027 5b50 4849 444c           '[PHIDL
+0001a7b0: 5d20 4661 696c 6564 2074 6f20 6669 6e64  ] Failed to find
+0001a7c0: 2066 6f6e 743a 2022 2573 222e 2027 0a20   font: "%s". '. 
+0001a7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7e0: 2020 202b 2022 5472 7920 7370 6563 6966     + "Try specif
+0001a7f0: 7969 6e67 2074 6865 2065 7861 6374 2028  ying the exact (
+0001a800: 6675 6c6c 2920 7061 7468 2074 6f20 7468  full) path to th
+0001a810: 6520 2e74 7466 206f 7220 2e6f 7466 2066  e .ttf or .otf f
+0001a820: 696c 652e 2022 0a20 2020 2020 2020 2020  ile. ".         
+0001a830: 2020 2020 2020 2020 2020 202b 2022 4f74             + "Ot
+0001a840: 6865 7277 6973 652c 2069 7420 6d69 6768  herwise, it migh
+0001a850: 7420 6265 2072 6573 6f6c 7665 6420 6279  t be resolved by
+0001a860: 2072 6562 7569 6c64 696e 6720 7468 6520   rebuilding the 
+0001a870: 6d61 7470 6c6f 746c 6962 2066 6f6e 7420  matplotlib font 
+0001a880: 6361 6368 6522 0a20 2020 2020 2020 2020  cache".         
+0001a890: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001a8a0: 2020 2020 2020 2020 2025 2028 6661 6365           % (face
+0001a8b0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+0001a8c0: 0a20 2020 2020 2020 2023 2052 656e 6465  .        # Rende
+0001a8d0: 7220 6561 6368 2063 6861 7261 6374 6572  r each character
+0001a8e0: 0a20 2020 2020 2020 2066 6f72 206c 696e  .        for lin
+0001a8f0: 6520 696e 2074 6578 742e 7370 6c69 7428  e in text.split(
+0001a900: 225c 6e22 293a 0a20 2020 2020 2020 2020  "\n"):.         
+0001a910: 2020 206c 203d 2044 6576 6963 6528 2274     l = Device("t
+0001a920: 6578 746c 696e 6522 290a 2020 2020 2020  extline").      
+0001a930: 2020 2020 2020 786f 6666 7365 7420 3d20        xoffset = 
+0001a940: 300a 2020 2020 2020 2020 2020 2020 666f  0.            fo
+0001a950: 7220 6c65 7474 6572 2069 6e20 6c69 6e65  r letter in line
+0001a960: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a970: 2020 6c65 7474 6572 5f64 6576 203d 2044    letter_dev = D
+0001a980: 6576 6963 6528 226c 6574 7465 7222 290a  evice("letter").
+0001a990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9a0: 6c65 7474 6572 5f74 656d 706c 6174 652c  letter_template,
+0001a9b0: 2061 6476 616e 6365 5f78 203d 205f 6765   advance_x = _ge
+0001a9c0: 745f 676c 7970 6828 666f 6e74 2c20 6c65  t_glyph(font, le
+0001a9d0: 7474 6572 290a 2020 2020 2020 2020 2020  tter).          
+0001a9e0: 2020 2020 2020 666f 7220 706f 6c79 2069        for poly i
+0001a9f0: 6e20 6c65 7474 6572 5f74 656d 706c 6174  n letter_templat
+0001aa00: 652e 706f 6c79 676f 6e73 3a0a 2020 2020  e.polygons:.    
+0001aa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa20: 6c65 7474 6572 5f64 6576 2e61 6464 5f70  letter_dev.add_p
+0001aa30: 6f6c 7967 6f6e 2870 6f6c 792e 706f 6c79  olygon(poly.poly
+0001aa40: 676f 6e73 2c20 6c61 7965 723d 6c61 7965  gons, layer=laye
+0001aa50: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
+0001aa60: 2020 2072 6566 203d 206c 2e61 6464 5f72     ref = l.add_r
+0001aa70: 6566 286c 6574 7465 725f 6465 7629 0a20  ef(letter_dev). 
+0001aa80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001aa90: 6566 2e6d 6f76 6528 6465 7374 696e 6174  ef.move(destinat
+0001aaa0: 696f 6e3d 2878 6f66 6673 6574 2c20 3029  ion=(xoffset, 0)
+0001aab0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001aac0: 2020 7265 662e 6d61 676e 6966 6963 6174    ref.magnificat
+0001aad0: 696f 6e20 3d20 7369 7a65 0a20 2020 2020  ion = size.     
+0001aae0: 2020 2020 2020 2020 2020 2078 6f66 6673             xoffs
+0001aaf0: 6574 202b 3d20 7369 7a65 202a 2061 6476  et += size * adv
+0001ab00: 616e 6365 5f78 0a0a 2020 2020 2020 2020  ance_x..        
+0001ab10: 2020 2020 7265 6620 3d20 742e 6164 645f      ref = t.add_
+0001ab20: 7265 6628 6c29 0a20 2020 2020 2020 2020  ref(l).         
+0001ab30: 2020 2072 6566 2e6d 6f76 6528 6465 7374     ref.move(dest
+0001ab40: 696e 6174 696f 6e3d 2830 2c20 796f 6666  ination=(0, yoff
+0001ab50: 7365 7429 290a 2020 2020 2020 2020 2020  set)).          
+0001ab60: 2020 796f 6666 7365 7420 2d3d 2073 697a    yoffset -= siz
+0001ab70: 650a 0a20 2020 206a 7573 7469 6679 203d  e..    justify =
+0001ab80: 206a 7573 7469 6679 2e6c 6f77 6572 2829   justify.lower()
+0001ab90: 0a20 2020 2066 6f72 206c 2069 6e20 742e  .    for l in t.
+0001aba0: 7265 6665 7265 6e63 6573 3a0a 2020 2020  references:.    
+0001abb0: 2020 2020 6966 206a 7573 7469 6679 203d      if justify =
+0001abc0: 3d20 226c 6566 7422 3a0a 2020 2020 2020  = "left":.      
+0001abd0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+0001abe0: 2020 2069 6620 6a75 7374 6966 7920 3d3d     if justify ==
+0001abf0: 2022 7269 6768 7422 3a0a 2020 2020 2020   "right":.      
+0001ac00: 2020 2020 2020 6c2e 786d 6178 203d 2030        l.xmax = 0
+0001ac10: 0a20 2020 2020 2020 2069 6620 6a75 7374  .        if just
+0001ac20: 6966 7920 3d3d 2022 6365 6e74 6572 223a  ify == "center":
+0001ac30: 0a20 2020 2020 2020 2020 2020 206c 2e6d  .            l.m
+0001ac40: 6f76 6528 6f72 6967 696e 3d6c 2e63 656e  ove(origin=l.cen
+0001ac50: 7465 722c 2064 6573 7469 6e61 7469 6f6e  ter, destination
+0001ac60: 3d28 302c 2030 292c 2061 7869 733d 2278  =(0, 0), axis="x
+0001ac70: 2229 0a0a 2020 2020 742e 666c 6174 7465  ")..    t.flatte
+0001ac80: 6e28 290a 2020 2020 7265 7475 726e 2074  n().    return t
+0001ac90: 0a0a 0a23 203d 3d3d 3d3d 3d3d 3d3d 3d3d  ...# ===========
+0001aca0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001acb0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001acc0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001acd0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001ace0: 3d3d 3d0a 2320 4578 616d 706c 6520 636f  ===.# Example co
+0001acf0: 6465 0a23 203d 3d3d 3d3d 3d3d 3d3d 3d3d  de.# ===========
+0001ad00: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001ad10: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001ad20: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001ad30: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001ad40: 3d3d 3d0a 0a23 2044 203d 2074 6578 7428  ===..# D = text(
+0001ad50: 2774 6865 2071 7569 636b 2062 726f 776e  'the quick brown
+0001ad60: 5c6e 2066 6f78 206a 756d 7065 6420 6f76  \n fox jumped ov
+0001ad70: 6572 5c6e 7468 6520 6c61 7a79 2064 6f67  er\nthe lazy dog
+0001ad80: 272c 206a 7573 7469 6679 203d 2027 6365  ', justify = 'ce
+0001ad90: 6e74 6572 272c 2073 697a 6520 3d20 3830  nter', size = 80
+0001ada0: 3029 0a23 2071 7569 636b 706c 6f74 2844  0).# quickplot(D
+0001adb0: 290a 0a0a 2320 3d3d 3d3d 3d3d 3d3d 3d3d  )...# ==========
+0001adc0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001add0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001ade0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001adf0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001ae00: 3d3d 3d3d 0a23 0a23 2057 6166 6572 2061  ====.#.# Wafer a
+0001ae10: 6e64 2064 6965 0a23 0a23 203d 3d3d 3d3d  nd die.#.# =====
+0001ae20: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001ae30: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001ae40: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001ae50: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001ae60: 3d3d 3d3d 3d3d 3d3d 3d0a 0a0a 6465 6620  =========...def 
+0001ae70: 6261 7369 635f 6469 6528 0a20 2020 2073  basic_die(.    s
+0001ae80: 697a 653d 2831 3030 3030 2c20 3130 3030  ize=(10000, 1000
+0001ae90: 3029 2c0a 2020 2020 7374 7265 6574 5f77  0),.    street_w
+0001aea0: 6964 7468 3d31 3030 2c0a 2020 2020 7374  idth=100,.    st
+0001aeb0: 7265 6574 5f6c 656e 6774 683d 3130 3030  reet_length=1000
+0001aec0: 2c0a 2020 2020 6469 655f 6e61 6d65 3d22  ,.    die_name="
+0001aed0: 6368 6970 3939 222c 0a20 2020 2074 6578  chip99",.    tex
+0001aee0: 745f 7369 7a65 3d31 3030 2c0a 2020 2020  t_size=100,.    
+0001aef0: 7465 7874 5f6c 6f63 6174 696f 6e3d 2253  text_location="S
+0001af00: 5722 2c0a 2020 2020 6c61 7965 723d 302c  W",.    layer=0,
+0001af10: 0a20 2020 2064 7261 775f 6262 6f78 3d54  .    draw_bbox=T
+0001af20: 7275 652c 0a20 2020 2062 626f 785f 6c61  rue,.    bbox_la
+0001af30: 7965 723d 3939 2c0a 293a 0a20 2020 2022  yer=99,.):.    "
+0001af40: 2222 4372 6561 7465 7320 6120 6261 7369  ""Creates a basi
+0001af50: 6320 6368 6970 2f64 6965 2074 656d 706c  c chip/die templ
+0001af60: 6174 652c 2077 6974 6820 3420 7269 6768  ate, with 4 righ
+0001af70: 7420 616e 676c 6520 636f 726e 6572 7320  t angle corners 
+0001af80: 6d61 726b 696e 670a 2020 2020 7468 6520  marking.    the 
+0001af90: 626f 756e 6461 7279 206f 6620 7468 6520  boundary of the 
+0001afa0: 6368 6970 2f64 6965 2061 6e64 2061 206c  chip/die and a l
+0001afb0: 6162 656c 2077 6974 6820 7468 6520 6e61  abel with the na
+0001afc0: 6d65 206f 6620 7468 6520 6469 652e 0a0a  me of the die...
+0001afd0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+0001afe0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+0001aff0: 2020 7369 7a65 203a 2061 7272 6179 5f6c    size : array_l
+0001b000: 696b 655b 325d 206f 6620 696e 7420 6f72  ike[2] of int or
+0001b010: 2066 6c6f 6174 0a20 2020 2020 2020 2078   float.        x
+0001b020: 2c20 7920 6469 6d65 6e73 696f 6e73 206f  , y dimensions o
+0001b030: 6620 7468 6520 6469 652e 0a20 2020 2073  f the die..    s
+0001b040: 7472 6565 745f 7769 6474 6820 3a20 696e  treet_width : in
+0001b050: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
+0001b060: 2020 2057 6964 7468 206f 6620 7468 6520     Width of the 
+0001b070: 636f 726e 6572 206d 6172 6b73 2066 6f72  corner marks for
+0001b080: 2064 6965 2d73 6177 696e 672e 0a20 2020   die-sawing..   
+0001b090: 2073 7472 6565 745f 6c65 6e67 7468 203a   street_length :
+0001b0a0: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
+0001b0b0: 2020 2020 2020 4c65 6e67 7468 206f 6620        Length of 
+0001b0c0: 7468 6520 636f 726e 6572 206d 6172 6b73  the corner marks
+0001b0d0: 2066 6f72 2064 6965 2d73 6177 696e 672e   for die-sawing.
+0001b0e0: 0a20 2020 2064 6965 5f6e 616d 6520 3a20  .    die_name : 
+0001b0f0: 7374 720a 2020 2020 2020 2020 4c61 6265  str.        Labe
+0001b100: 6c20 7465 7874 2e0a 2020 2020 7465 7874  l text..    text
+0001b110: 5f73 697a 6520 3a20 696e 7420 6f72 2066  _size : int or f
+0001b120: 6c6f 6174 0a20 2020 2020 2020 204c 6162  loat.        Lab
+0001b130: 656c 2074 6578 7420 7369 7a65 2e0a 2020  el text size..  
+0001b140: 2020 7465 7874 5f6c 6f63 6174 696f 6e20    text_location 
+0001b150: 3a20 7b27 4e57 272c 2027 4e27 2c20 274e  : {'NW', 'N', 'N
+0001b160: 4527 2c20 2753 5727 2c20 2753 272c 2027  E', 'SW', 'S', '
+0001b170: 5345 277d 0a20 2020 2020 2020 204c 6162  SE'}.        Lab
+0001b180: 656c 2074 6578 7420 636f 6d70 6173 7320  el text compass 
+0001b190: 6c6f 6361 7469 6f6e 2e0a 2020 2020 6c61  location..    la
+0001b1a0: 7965 7220 3a20 696e 740a 2020 2020 2020  yer : int.      
+0001b1b0: 2020 5370 6563 6966 6963 206c 6179 6572    Specific layer
+0001b1c0: 2873 2920 746f 2070 7574 2070 6f6c 7967  (s) to put polyg
+0001b1d0: 6f6e 2067 656f 6d65 7472 7920 6f6e 2e0a  on geometry on..
+0001b1e0: 2020 2020 6472 6177 5f62 626f 7820 3a20      draw_bbox : 
+0001b1f0: 626f 6f6c 0a20 2020 2020 2020 2049 6620  bool.        If 
+0001b200: 7472 7565 2c20 6472 6177 6e73 2061 2062  true, drawns a b
+0001b210: 626f 7820 6172 6f75 6e64 2074 6865 2063  box around the c
+0001b220: 6869 7020 6469 6520 6765 6f6d 6574 7279  hip die geometry
+0001b230: 2e0a 2020 2020 6262 6f78 5f6c 6179 6572  ..    bbox_layer
+0001b240: 203a 2069 6e74 0a20 2020 2020 2020 204c   : int.        L
+0001b250: 6179 6572 206f 6e20 7768 6963 6820 6262  ayer on which bb
+0001b260: 6f78 2069 7320 706c 6163 6564 2069 6620  ox is placed if 
+0001b270: 6060 6472 6177 5f62 626f 7860 6020 6973  ``draw_bbox`` is
+0001b280: 2074 7275 652e 0a0a 2020 2020 5265 7475   true...    Retu
+0001b290: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
+0001b2a0: 2020 2020 4420 3a20 4465 7669 6365 0a20      D : Device. 
+0001b2b0: 2020 2020 2020 2041 2044 6576 6963 6520         A Device 
+0001b2c0: 636f 6e74 6169 6e69 6e67 2061 2062 6173  containing a bas
+0001b2d0: 6963 2064 6965 2067 656f 6d65 7472 792e  ic die geometry.
+0001b2e0: 0a20 2020 2022 2222 0a20 2020 2044 203d  .    """.    D =
+0001b2f0: 2044 6576 6963 6528 6e61 6d65 3d22 6469   Device(name="di
+0001b300: 6522 290a 2020 2020 7378 2c20 7379 203d  e").    sx, sy =
+0001b310: 2073 697a 655b 305d 202f 2032 2c20 7369   size[0] / 2, si
+0001b320: 7a65 5b31 5d20 2f20 320a 2020 2020 7870  ze[1] / 2.    xp
+0001b330: 7473 203d 206e 702e 6172 7261 7928 0a20  ts = np.array(. 
+0001b340: 2020 2020 2020 205b 0a20 2020 2020 2020         [.       
+0001b350: 2020 2020 2073 782c 0a20 2020 2020 2020       sx,.       
+0001b360: 2020 2020 2073 782c 0a20 2020 2020 2020       sx,.       
+0001b370: 2020 2020 2073 7820 2d20 7374 7265 6574       sx - street
+0001b380: 5f77 6964 7468 2c0a 2020 2020 2020 2020  _width,.        
+0001b390: 2020 2020 7378 202d 2073 7472 6565 745f      sx - street_
+0001b3a0: 7769 6474 682c 0a20 2020 2020 2020 2020  width,.         
+0001b3b0: 2020 2073 7820 2d20 7374 7265 6574 5f6c     sx - street_l
+0001b3c0: 656e 6774 682c 0a20 2020 2020 2020 2020  ength,.         
+0001b3d0: 2020 2073 7820 2d20 7374 7265 6574 5f6c     sx - street_l
+0001b3e0: 656e 6774 682c 0a20 2020 2020 2020 205d  ength,.        ]
+0001b3f0: 0a20 2020 2029 0a20 2020 2079 7074 7320  .    ).    ypts 
+0001b400: 3d20 6e70 2e61 7272 6179 280a 2020 2020  = np.array(.    
+0001b410: 2020 2020 5b0a 2020 2020 2020 2020 2020      [.          
+0001b420: 2020 7379 2c0a 2020 2020 2020 2020 2020    sy,.          
+0001b430: 2020 7379 202d 2073 7472 6565 745f 6c65    sy - street_le
+0001b440: 6e67 7468 2c0a 2020 2020 2020 2020 2020  ngth,.          
+0001b450: 2020 7379 202d 2073 7472 6565 745f 6c65    sy - street_le
+0001b460: 6e67 7468 2c0a 2020 2020 2020 2020 2020  ngth,.          
+0001b470: 2020 7379 202d 2073 7472 6565 745f 7769    sy - street_wi
+0001b480: 6474 682c 0a20 2020 2020 2020 2020 2020  dth,.           
+0001b490: 2073 7920 2d20 7374 7265 6574 5f77 6964   sy - street_wid
+0001b4a0: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+0001b4b0: 7379 2c0a 2020 2020 2020 2020 5d0a 2020  sy,.        ].  
+0001b4c0: 2020 290a 2020 2020 442e 6164 645f 706f    ).    D.add_po
+0001b4d0: 6c79 676f 6e28 5b78 7074 732c 2079 7074  lygon([xpts, ypt
+0001b4e0: 735d 2c20 6c61 7965 723d 6c61 7965 7229  s], layer=layer)
+0001b4f0: 0a20 2020 2044 2e61 6464 5f70 6f6c 7967  .    D.add_polyg
+0001b500: 6f6e 285b 2d78 7074 732c 2079 7074 735d  on([-xpts, ypts]
+0001b510: 2c20 6c61 7965 723d 6c61 7965 7229 0a20  , layer=layer). 
+0001b520: 2020 2044 2e61 6464 5f70 6f6c 7967 6f6e     D.add_polygon
+0001b530: 285b 7870 7473 2c20 2d79 7074 735d 2c20  ([xpts, -ypts], 
+0001b540: 6c61 7965 723d 6c61 7965 7229 0a20 2020  layer=layer).   
+0001b550: 2044 2e61 6464 5f70 6f6c 7967 6f6e 285b   D.add_polygon([
+0001b560: 2d78 7074 732c 202d 7970 7473 5d2c 206c  -xpts, -ypts], l
+0001b570: 6179 6572 3d6c 6179 6572 290a 0a20 2020  ayer=layer)..   
+0001b580: 2069 6620 6472 6177 5f62 626f 7820 6973   if draw_bbox is
+0001b590: 2054 7275 653a 0a20 2020 2020 2020 2044   True:.        D
+0001b5a0: 2e61 6464 5f70 6f6c 7967 6f6e 285b 5b73  .add_polygon([[s
+0001b5b0: 782c 2073 795d 2c20 5b73 782c 202d 7379  x, sy], [sx, -sy
+0001b5c0: 5d2c 205b 2d73 782c 202d 7379 5d2c 205b  ], [-sx, -sy], [
+0001b5d0: 2d73 782c 2073 795d 5d2c 206c 6179 6572  -sx, sy]], layer
+0001b5e0: 3d62 626f 785f 6c61 7965 7229 0a20 2020  =bbox_layer).   
+0001b5f0: 2044 2e63 656e 7465 7220 3d20 2830 2c20   D.center = (0, 
+0001b600: 3029 0a20 2020 2074 203d 2044 2e61 6464  0).    t = D.add
+0001b610: 5f72 6566 2874 6578 7428 7465 7874 3d64  _ref(text(text=d
+0001b620: 6965 5f6e 616d 652c 2073 697a 653d 7465  ie_name, size=te
+0001b630: 7874 5f73 697a 652c 206c 6179 6572 3d6c  xt_size, layer=l
+0001b640: 6179 6572 2929 0a0a 2020 2020 6420 3d20  ayer))..    d = 
+0001b650: 7374 7265 6574 5f77 6964 7468 202b 2032  street_width + 2
+0001b660: 300a 2020 2020 6966 2069 7369 6e73 7461  0.    if isinsta
+0001b670: 6e63 6528 7465 7874 5f6c 6f63 6174 696f  nce(text_locatio
+0001b680: 6e2c 2073 7472 293a 0a20 2020 2020 2020  n, str):.       
+0001b690: 2074 6578 745f 6c6f 6361 7469 6f6e 203d   text_location =
+0001b6a0: 2074 6578 745f 6c6f 6361 7469 6f6e 2e75   text_location.u
+0001b6b0: 7070 6572 2829 0a20 2020 2020 2020 2069  pper().        i
+0001b6c0: 6620 7465 7874 5f6c 6f63 6174 696f 6e20  f text_location 
+0001b6d0: 3d3d 2022 4e57 223a 0a20 2020 2020 2020  == "NW":.       
+0001b6e0: 2020 2020 2074 2e78 6d69 6e2c 2074 2e79       t.xmin, t.y
+0001b6f0: 6d61 7820 3d20 5b2d 7378 202b 2064 2c20  max = [-sx + d, 
+0001b700: 7379 202d 2064 5d0a 2020 2020 2020 2020  sy - d].        
+0001b710: 656c 6966 2074 6578 745f 6c6f 6361 7469  elif text_locati
+0001b720: 6f6e 203d 3d20 224e 223a 0a20 2020 2020  on == "N":.     
+0001b730: 2020 2020 2020 2074 2e78 2c20 742e 796d         t.x, t.ym
+0001b740: 6178 203d 205b 302c 2073 7920 2d20 645d  ax = [0, sy - d]
+0001b750: 0a20 2020 2020 2020 2065 6c69 6620 7465  .        elif te
+0001b760: 7874 5f6c 6f63 6174 696f 6e20 3d3d 2022  xt_location == "
+0001b770: 4e45 223a 0a20 2020 2020 2020 2020 2020  NE":.           
+0001b780: 2074 2e78 6d61 782c 2074 2e79 6d61 7820   t.xmax, t.ymax 
+0001b790: 3d20 5b73 7820 2d20 642c 2073 7920 2d20  = [sx - d, sy - 
+0001b7a0: 645d 0a20 2020 2020 2020 2069 6620 7465  d].        if te
+0001b7b0: 7874 5f6c 6f63 6174 696f 6e20 3d3d 2022  xt_location == "
+0001b7c0: 5357 223a 0a20 2020 2020 2020 2020 2020  SW":.           
+0001b7d0: 2074 2e78 6d69 6e2c 2074 2e79 6d69 6e20   t.xmin, t.ymin 
+0001b7e0: 3d20 5b2d 7378 202b 2064 2c20 2d73 7920  = [-sx + d, -sy 
+0001b7f0: 2b20 645d 0a20 2020 2020 2020 2065 6c69  + d].        eli
+0001b800: 6620 7465 7874 5f6c 6f63 6174 696f 6e20  f text_location 
+0001b810: 3d3d 2022 5322 3a0a 2020 2020 2020 2020  == "S":.        
+0001b820: 2020 2020 742e 782c 2074 2e79 6d69 6e20      t.x, t.ymin 
+0001b830: 3d20 5b30 2c20 2d73 7920 2b20 645d 0a20  = [0, -sy + d]. 
+0001b840: 2020 2020 2020 2065 6c69 6620 7465 7874         elif text
+0001b850: 5f6c 6f63 6174 696f 6e20 3d3d 2022 5345  _location == "SE
+0001b860: 223a 0a20 2020 2020 2020 2020 2020 2074  ":.            t
+0001b870: 2e78 6d61 782c 2074 2e79 6d69 6e20 3d20  .xmax, t.ymin = 
+0001b880: 5b73 7820 2d20 642c 202d 7379 202b 2064  [sx - d, -sy + d
+0001b890: 5d0a 2020 2020 656c 7365 3a0a 2020 2020  ].    else:.    
+0001b8a0: 2020 2020 742e 782c 2074 2e79 203d 2074      t.x, t.y = t
+0001b8b0: 6578 745f 6c6f 6361 7469 6f6e 0a0a 2020  ext_location..  
+0001b8c0: 2020 7265 7475 726e 2044 0a0a 0a23 203d    return D...# =
+0001b8d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001b8e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001b8f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001b900: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001b910: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 2320  =============.# 
+0001b920: 4578 616d 706c 6520 636f 6465 0a23 203d  Example code.# =
+0001b930: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001b940: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001b950: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001b960: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001b970: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 0a23  =============..#
+0001b980: 2044 203d 2062 6173 6963 5f64 6965 2873   D = basic_die(s
+0001b990: 697a 6520 3d20 2831 3030 3030 2c20 3130  ize = (10000, 10
+0001b9a0: 3030 3029 2c20 7374 7265 6574 5f77 6964  000), street_wid
+0001b9b0: 7468 203d 2031 3030 2c20 7374 7265 6574  th = 100, street
+0001b9c0: 5f6c 656e 6774 6820 3d20 3130 3030 2c0a  _length = 1000,.
+0001b9d0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0001b9e0: 6469 655f 6e61 6d65 203d 2027 6368 6970  die_name = 'chip
+0001b9f0: 3939 272c 2074 6578 745f 7369 7a65 203d  99', text_size =
+0001ba00: 2033 3030 2c20 7465 7874 5f6c 6f63 6174   300, text_locat
+0001ba10: 696f 6e20 3d20 2753 5727 2c20 206c 6179  ion = 'SW',  lay
+0001ba20: 6572 203d 2030 2c0a 2320 2020 2020 2020  er = 0,.#       
+0001ba30: 2020 2020 2020 2020 6472 6177 5f62 626f          draw_bbo
+0001ba40: 7820 3d20 5472 7565 2c20 2062 626f 785f  x = True,  bbox_
+0001ba50: 6c61 7965 7220 3d20 3939 290a 2320 7175  layer = 99).# qu
+0001ba60: 6963 6b70 6c6f 7428 4429 0a0a 0a23 203d  ickplot(D)...# =
+0001ba70: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001ba80: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001ba90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001baa0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001bab0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 230a  =============.#.
+0001bac0: 2320 5761 7665 6775 6964 6520 6375 7276  # Waveguide curv
+0001bad0: 6573 0a23 0a23 203d 3d3d 3d3d 3d3d 3d3d  es.#.# =========
+0001bae0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001baf0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001bb00: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001bb10: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001bb20: 3d3d 3d3d 3d0a 0a0a 6465 6620 7261 6365  =====...def race
+0001bb30: 7472 6163 6b5f 6772 6164 7561 6c28 7769  track_gradual(wi
+0001bb40: 6474 683d 302e 332c 2052 3d35 2c20 4e3d  dth=0.3, R=5, N=
+0001bb50: 332c 206c 6179 6572 3d30 293a 0a20 2020  3, layer=0):.   
+0001bb60: 2022 2222 4372 6561 7465 7320 6120 6772   """Creates a gr
+0001bb70: 6164 7561 6c20 7261 6365 7472 6163 6b20  adual racetrack 
+0001bb80: 6265 6e74 2067 656f 6d65 7472 792e 0a0a  bent geometry...
+0001bb90: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+0001bba0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+0001bbb0: 2020 7769 6474 6820 3a20 696e 7420 6f72    width : int or
+0001bbc0: 2066 6c6f 6174 0a20 2020 2020 2020 2057   float.        W
+0001bbd0: 6964 7468 206f 6620 7468 6520 7472 6163  idth of the trac
+0001bbe0: 6b2e 0a20 2020 2052 203a 2069 6e74 206f  k..    R : int o
+0001bbf0: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
+0001bc00: 5261 6469 7573 206f 6620 7468 6520 7472  Radius of the tr
+0001bc10: 6163 6b20 6174 2069 7473 206d 6f73 7420  ack at its most 
+0001bc20: 6375 7276 6564 2070 6f69 6e74 2e0a 2020  curved point..  
+0001bc30: 2020 4e20 3a20 696e 7420 6f72 2066 6c6f    N : int or flo
+0001bc40: 6174 0a20 2020 2020 2020 2052 6164 6975  at.        Radiu
+0001bc50: 7320 6f66 2074 6865 2074 7261 636b 2061  s of the track a
+0001bc60: 7420 6974 7320 6c65 6173 7420 6375 7276  t its least curv
+0001bc70: 6564 2070 6f69 6e74 2e0a 2020 2020 6c61  ed point..    la
+0001bc80: 7965 7220 3a20 696e 742c 2061 7272 6179  yer : int, array
+0001bc90: 2d6c 696b 655b 325d 2c20 6f72 2073 6574  -like[2], or set
+0001bca0: 0a20 2020 2020 2020 2053 7065 6369 6669  .        Specifi
+0001bcb0: 6320 6c61 7965 7228 7329 2074 6f20 7075  c layer(s) to pu
+0001bcc0: 7420 706f 6c79 676f 6e20 6765 6f6d 6574  t polygon geomet
+0001bcd0: 7279 206f 6e2e 0a0a 2020 2020 5265 7475  ry on...    Retu
+0001bce0: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
+0001bcf0: 2020 2020 4420 3a20 4465 7669 6365 0a20      D : Device. 
+0001bd00: 2020 2020 2020 2041 2044 6576 6963 6520         A Device 
+0001bd10: 636f 6e74 6169 6e69 6e67 2061 2067 7261  containing a gra
+0001bd20: 6475 616c 2072 6163 6574 7261 636b 2062  dual racetrack b
+0001bd30: 656e 7420 6765 6f6d 6574 7279 2e0a 2020  ent geometry..  
+0001bd40: 2020 2222 220a 2020 2020 6375 7276 655f    """.    curve_
+0001bd50: 6675 6e20 3d20 6c61 6d62 6461 2074 3a20  fun = lambda t: 
+0001bd60: 5f72 6163 6574 7261 636b 5f67 7261 6475  _racetrack_gradu
+0001bd70: 616c 5f70 6172 616d 6574 7269 6328 742c  al_parametric(t,
+0001bd80: 2052 3d35 2c20 4e3d 3329 0a20 2020 2072   R=5, N=3).    r
+0001bd90: 6f75 7465 5f70 6174 6820 3d20 6764 7370  oute_path = gdsp
+0001bda0: 792e 5061 7468 2877 6964 7468 3d77 6964  y.Path(width=wid
+0001bdb0: 7468 2c20 696e 6974 6961 6c5f 706f 696e  th, initial_poin
+0001bdc0: 743d 5b30 2c20 305d 290a 2020 2020 726f  t=[0, 0]).    ro
+0001bdd0: 7574 655f 7061 7468 2e70 6172 616d 6574  ute_path.paramet
+0001bde0: 7269 6328 0a20 2020 2020 2020 2063 7572  ric(.        cur
+0001bdf0: 7665 5f66 756e 2c0a 2020 2020 2020 2020  ve_fun,.        
+0001be00: 6e75 6d62 6572 5f6f 665f 6576 616c 7561  number_of_evalua
+0001be10: 7469 6f6e 733d 3939 2c0a 2020 2020 2020  tions=99,.      
+0001be20: 2020 6d61 785f 706f 696e 7473 3d34 3030    max_points=400
+0001be30: 302c 0a20 2020 2020 2020 2066 696e 616c  0,.        final
+0001be40: 5f64 6973 7461 6e63 653d 4e6f 6e65 2c0a  _distance=None,.
+0001be50: 2020 2020 2020 2020 6c61 7965 723d 6c61          layer=la
+0001be60: 7965 722c 0a20 2020 2029 0a20 2020 2044  yer,.    ).    D
+0001be70: 203d 2044 6576 6963 6528 2272 6163 6574   = Device("racet
+0001be80: 7261 636b 2229 0a20 2020 2044 2e61 6464  rack").    D.add
+0001be90: 2872 6f75 7465 5f70 6174 6829 0a20 2020  (route_path).   
+0001bea0: 2072 6574 7572 6e20 440a 0a0a 6465 6620   return D...def 
+0001beb0: 5f72 6163 6574 7261 636b 5f67 7261 6475  _racetrack_gradu
+0001bec0: 616c 5f70 6172 616d 6574 7269 6328 742c  al_parametric(t,
+0001bed0: 2052 2c20 4e29 3a0a 2020 2020 2222 2254   R, N):.    """T
+0001bee0: 616b 6573 2069 6e20 6120 7061 7261 6d65  akes in a parame
+0001bef0: 7472 6963 2076 616c 7565 2060 6074 6060  tric value ``t``
+0001bf00: 206f 6e20 2830 2c31 292c 2072 6574 7572   on (0,1), retur
+0001bf10: 6e73 2074 6865 2078 2c79 2063 6f6f 7264  ns the x,y coord
+0001bf20: 696e 6174 6573 0a20 2020 206f 6620 6120  inates.    of a 
+0001bf30: 7261 6365 7472 6163 6b20 6265 6e74 2061  racetrack bent a
+0001bf40: 6363 6f72 6469 6e67 2074 6f0a 2020 2020  ccording to.    
+0001bf50: 3230 3039 3038 3130 5f45 4f53 345f 6d6f  20090810_EOS4_mo
+0001bf60: 6475 6c61 746f 725f 6465 7369 676e 735f  dulator_designs_
+0001bf70: 6578 6365 7270 7446 6f72 4a61 736f 6e47  excerptForJasonG
+0001bf80: 7261 6475 616c 4265 6e64 732e 7070 740a  radualBends.ppt.
+0001bf90: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
+0001bfa0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+0001bfb0: 2020 2074 203a 2061 7272 6179 2d6c 696b     t : array-lik
+0001bfc0: 655b 4e5d 0a20 2020 2020 2020 2050 6172  e[N].        Par
+0001bfd0: 616d 6574 7269 6320 7661 6c75 6573 2066  ametric values f
+0001bfe0: 6f72 2074 6865 2072 6163 6574 7261 636b  or the racetrack
+0001bff0: 2e0a 2020 2020 5220 3a20 696e 7420 6f72  ..    R : int or
+0001c000: 2066 6c6f 6174 0a20 2020 2020 2020 2052   float.        R
+0001c010: 6164 6975 7320 6f66 2074 6865 2074 7261  adius of the tra
+0001c020: 636b 2061 7420 6974 7320 6d6f 7374 2063  ck at its most c
+0001c030: 7572 7665 6420 706f 696e 742e 0a20 2020  urved point..   
+0001c040: 204e 203a 2069 6e74 206f 7220 666c 6f61   N : int or floa
+0001c050: 740a 2020 2020 2020 2020 5261 6469 7573  t.        Radius
+0001c060: 206f 6620 7468 6520 7472 6163 6b20 6174   of the track at
+0001c070: 2069 7473 206c 6561 7374 2063 7572 7665   its least curve
+0001c080: 6420 706f 696e 742e 0a0a 2020 2020 5265  d point...    Re
+0001c090: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+0001c0a0: 2d0a 2020 2020 7820 3a20 6172 7261 792d  -.    x : array-
+0001c0b0: 6c69 6b65 5b4e 5d0a 2020 2020 2020 2020  like[N].        
+0001c0c0: 782d 636f 6f72 6469 6e61 7465 7320 6f66  x-coordinates of
+0001c0d0: 2074 6865 2072 6163 6574 7261 636b 2063   the racetrack c
+0001c0e0: 7572 7665 2e0a 2020 2020 7920 3a20 6172  urve..    y : ar
+0001c0f0: 7261 792d 6c69 6b65 5b4e 5d0a 2020 2020  ray-like[N].    
+0001c100: 2020 2020 792d 636f 6f72 6469 6e61 7465      y-coordinate
+0001c110: 7320 6f66 2074 6865 2072 6163 6574 7261  s of the racetra
+0001c120: 636b 2063 7572 7665 2e0a 2020 2020 2222  ck curve..    ""
+0001c130: 220a 2020 2020 7830 203d 2052 202f 2032  ".    x0 = R / 2
+0001c140: 202a 2a20 2831 202f 204e 290a 2020 2020   ** (1 / N).    
+0001c150: 526d 696e 203d 2032 202a 2a20 2830 2e35  Rmin = 2 ** (0.5
+0001c160: 202d 2031 202f 204e 2920 2f20 284e 202d   - 1 / N) / (N -
+0001c170: 2031 2920 2a20 520a 2020 2020 5230 203d   1) * R.    R0 =
+0001c180: 2052 202d 2028 7830 202d 2052 6d69 6e20   R - (x0 - Rmin 
+0001c190: 2f20 7371 7274 2832 2929 0a20 2020 2074  / sqrt(2)).    t
+0001c1a0: 203d 206e 702e 6172 7261 7928 7429 0a20   = np.array(t). 
+0001c1b0: 2020 2078 2c20 7920 3d20 6e70 2e7a 6572     x, y = np.zer
+0001c1c0: 6f73 2874 2e73 6861 7065 292c 206e 702e  os(t.shape), np.
+0001c1d0: 7a65 726f 7328 742e 7368 6170 6529 0a0a  zeros(t.shape)..
+0001c1e0: 2020 2020 2320 446f 696e 6720 7468 6520      # Doing the 
+0001c1f0: 6d61 7468 0a20 2020 2078 203d 2063 6f73  math.    x = cos
+0001c200: 2874 202a 2070 6920 2f20 3229 202a 2052  (t * pi / 2) * R
+0001c210: 3020 2023 2074 2028 302d 3129 2077 6869  0  # t (0-1) whi
+0001c220: 6c65 2078 2028 3020 746f 2052 3029 0a20  le x (0 to R0). 
+0001c230: 2020 2069 6920 3d20 2852 6d69 6e20 2f20     ii = (Rmin / 
+0001c240: 7371 7274 2832 2920 3c20 7829 2026 2028  sqrt(2) < x) & (
+0001c250: 7820 3c3d 2052 3029 0a20 2020 206a 6a20  x <= R0).    jj 
+0001c260: 3d20 2830 203c 2078 2920 2620 2878 203c  = (0 < x) & (x <
+0001c270: 3d20 526d 696e 202f 2073 7172 7428 3229  = Rmin / sqrt(2)
+0001c280: 290a 2020 2020 795b 6969 5d20 3d20 2852  ).    y[ii] = (R
+0001c290: 2a2a 4e20 2d20 2878 5b69 695d 202b 2028  **N - (x[ii] + (
+0001c2a0: 7830 202d 2052 6d69 6e20 2f20 7371 7274  x0 - Rmin / sqrt
+0001c2b0: 2832 2929 2920 2a2a 204e 2920 2a2a 2028  (2))) ** N) ** (
+0001c2c0: 3120 2f20 4e29 0a20 2020 2079 5b6a 6a5d  1 / N).    y[jj]
+0001c2d0: 203d 2028 7830 202d 2052 6d69 6e20 2f20   = (x0 - Rmin / 
+0001c2e0: 7371 7274 2832 2929 202b 2073 7172 7428  sqrt(2)) + sqrt(
+0001c2f0: 526d 696e 2a2a 3220 2d20 785b 6a6a 5d20  Rmin**2 - x[jj] 
+0001c300: 2a2a 2032 290a 2020 2020 7265 7475 726e  ** 2).    return
+0001c310: 2078 2c20 790a 0a0a 2320 3d3d 3d3d 3d3d   x, y...# ======
+0001c320: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001c330: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001c340: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001c350: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001c360: 3d3d 3d3d 3d3d 3d3d 0a23 2045 7861 6d70  ========.# Examp
+0001c370: 6c65 2063 6f64 650a 2320 3d3d 3d3d 3d3d  le code.# ======
+0001c380: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001c390: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001c3a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001c3b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001c3c0: 3d3d 3d3d 3d3d 3d3d 0a0a 2320 4420 3d20  ========..# D = 
+0001c3d0: 7261 6365 7472 6163 6b5f 6772 6164 7561  racetrack_gradua
+0001c3e0: 6c28 7769 6474 6820 3d20 302e 332c 2052  l(width = 0.3, R
+0001c3f0: 203d 2035 2c20 4e20 3d20 3329 0a23 2071   = 5, N = 3).# q
+0001c400: 7569 636b 706c 6f74 2844 290a 0a0a 2320  uickplot(D)...# 
+0001c410: 7420 3d20 6e70 2e6c 696e 7370 6163 6528  t = np.linspace(
+0001c420: 302c 3129 0a23 2078 2c79 203d 205f 7261  0,1).# x,y = _ra
+0001c430: 6365 7472 6163 6b5f 6772 6164 7561 6c5f  cetrack_gradual_
+0001c440: 7061 7261 6d65 7472 6963 2874 2c20 5220  parametric(t, R 
+0001c450: 3d20 352c 204e 203d 2033 290a 2320 706c  = 5, N = 3).# pl
+0001c460: 742e 706c 6f74 2878 2c79 290a 2320 706c  t.plot(x,y).# pl
+0001c470: 742e 6178 6973 2827 6571 7561 6c27 290a  t.axis('equal').
+0001c480: 0a0a 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ..# ============
+0001c490: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001c4a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001c4b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001c4c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001c4d0: 3d3d 0a23 0a23 2041 7261 6e67 652c 2070  ==.#.# Arange, p
+0001c4e0: 6163 6b69 6e67 2061 6e64 2066 696c 6c0a  acking and fill.
+0001c4f0: 230a 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  #.# ============
+0001c500: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001c510: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001c520: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001c530: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0001c540: 3d3d 0a0a 0a64 6566 2067 7269 6428 0a20  ==...def grid(. 
+0001c550: 2020 2064 6576 6963 655f 6c69 7374 2c0a     device_list,.
+0001c560: 2020 2020 7370 6163 696e 673d 2835 2c20      spacing=(5, 
+0001c570: 3130 292c 0a20 2020 2073 6570 6172 6174  10),.    separat
+0001c580: 696f 6e3d 5472 7565 2c0a 2020 2020 7368  ion=True,.    sh
+0001c590: 6170 653d 4e6f 6e65 2c0a 2020 2020 616c  ape=None,.    al
+0001c5a0: 6967 6e5f 783d 2278 222c 0a20 2020 2061  ign_x="x",.    a
+0001c5b0: 6c69 676e 5f79 3d22 7922 2c0a 2020 2020  lign_y="y",.    
+0001c5c0: 6564 6765 5f78 3d22 7822 2c0a 2020 2020  edge_x="x",.    
+0001c5d0: 6564 6765 5f79 3d22 796d 6178 222c 0a29  edge_y="ymax",.)
+0001c5e0: 3a0a 2020 2020 2222 2250 6c61 6365 7320  :.    """Places 
+0001c5f0: 7468 6520 6465 7669 6365 7320 696e 2074  the devices in t
+0001c600: 6865 2060 6465 7669 6365 5f6c 6973 7460  he `device_list`
+0001c610: 2028 3144 206f 7220 3244 2920 6f6e 2061   (1D or 2D) on a
+0001c620: 2067 7269 642e 0a0a 2020 2020 5061 7261   grid...    Para
+0001c630: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
+0001c640: 2d2d 2d2d 2d0a 2020 2020 6465 7669 6365  -----.    device
+0001c650: 5f6c 6973 7420 3a20 6172 7261 792d 6c69  _list : array-li
+0001c660: 6b65 5b4e 5d20 6f66 2044 6576 6963 650a  ke[N] of Device.
+0001c670: 2020 2020 2020 2020 4465 7669 6365 7320          Devices 
+0001c680: 746f 2062 6520 706c 6163 6564 206f 6e74  to be placed ont
+0001c690: 6f20 6120 6772 6964 2e0a 2020 2020 7370  o a grid..    sp
+0001c6a0: 6163 696e 6720 3a20 696e 742c 2066 6c6f  acing : int, flo
+0001c6b0: 6174 2c20 6f72 2061 7272 6179 2d6c 696b  at, or array-lik
+0001c6c0: 655b 325d 206f 6620 696e 7420 6f72 2066  e[2] of int or f
+0001c6d0: 6c6f 6174 0a20 2020 2020 2020 2053 7061  loat.        Spa
+0001c6e0: 6369 6e67 2062 6574 7765 656e 2061 646a  cing between adj
+0001c6f0: 6163 656e 7420 656c 656d 656e 7473 206f  acent elements o
+0001c700: 6e20 7468 6520 6772 6964 2c20 6361 6e20  n the grid, can 
+0001c710: 6265 2061 2074 7570 6c65 2066 6f72 0a20  be a tuple for. 
+0001c720: 2020 2020 2020 2064 6966 6665 7265 6e74         different
+0001c730: 2064 6973 7461 6e63 6573 2069 6e20 7769   distances in wi
+0001c740: 6474 6820 616e 6420 6865 6967 6874 2028  dth and height (
+0001c750: 782c 7929 2e0a 2020 2020 7365 7061 7261  x,y)..    separa
+0001c760: 7469 6f6e 203a 2062 6f6f 6c0a 2020 2020  tion : bool.    
+0001c770: 2020 2020 4966 2054 7275 652c 2067 7561      If True, gua
+0001c780: 7261 6e74 6565 7320 656c 656d 656e 7473  rantees elements
+0001c790: 2061 7265 2073 7065 7061 7261 7465 6420   are speparated 
+0001c7a0: 7769 7468 2061 2066 6978 6564 2073 7061  with a fixed spa
+0001c7b0: 6369 6e67 0a20 2020 2020 2020 2062 6574  cing.        bet
+0001c7c0: 7765 656e 3b20 6966 2020 4661 6c73 652c  ween; if  False,
+0001c7d0: 2065 6c65 6d65 6e74 7320 6172 6520 7370   elements are sp
+0001c7e0: 6163 6564 2065 7665 6e6c 7920 616c 6f6e  aced evenly alon
+0001c7f0: 6720 6120 6772 6964 2e0a 2020 2020 7368  g a grid..    sh
+0001c800: 6170 6520 3a20 6172 7261 792d 6c69 6b65  ape : array-like
+0001c810: 5b32 5d0a 2020 2020 2020 2020 782c 2079  [2].        x, y
+0001c820: 2073 6861 7065 206f 6620 7468 6520 6772   shape of the gr
+0001c830: 6964 2028 6173 2069 6620 6e70 2e72 6573  id (as if np.res
+0001c840: 6861 7065 2829 2077 6572 6520 7275 6e20  hape() were run 
+0001c850: 7769 7468 2073 6861 7065 5b3a 3a2d 315d  with shape[::-1]
+0001c860: 292e 2049 6620 6e6f 2073 6861 7065 2069  ). If no shape i
+0001c870: 7320 6769 7665 6e20 616e 6420 7468 650a  s given and the.
+0001c880: 2020 2020 2020 2020 6c69 7374 2069 7320          list is 
+0001c890: 3144 2c20 7468 6520 6f75 7470 7574 2069  1D, the output i
+0001c8a0: 7320 6173 2069 6620 6e70 2e72 6573 6861  s as if np.resha
+0001c8b0: 7065 2077 6572 6520 7275 6e20 7769 7468  pe were run with
+0001c8c0: 2028 2d31 2c20 7369 7a65 206f 6620 6c69   (-1, size of li
+0001c8d0: 7374 292e 0a20 2020 2061 6c69 676e 5f78  st)..    align_x
+0001c8e0: 203a 207b 2778 272c 2027 786d 696e 272c   : {'x', 'xmin',
+0001c8f0: 2027 786d 6178 277d 0a20 2020 2020 2020   'xmax'}.       
+0001c900: 2057 6869 6368 2065 6467 6520 746f 2070   Which edge to p
+0001c910: 6572 666f 726d 2074 6865 2078 2028 636f  erform the x (co
+0001c920: 6c75 6d6e 2920 616c 6967 6e6d 656e 7420  lumn) alignment 
+0001c930: 616c 6f6e 670a 2020 2020 616c 6967 6e5f  along.    align_
+0001c940: 7920 3a20 7b27 7927 2c20 2779 6d69 6e27  y : {'y', 'ymin'
+0001c950: 2c20 2779 6d61 7827 7d0a 2020 2020 2020  , 'ymax'}.      
+0001c960: 2020 5768 6963 6820 6564 6765 2074 6f20    Which edge to 
+0001c970: 7065 7266 6f72 6d20 7468 6520 7920 2872  perform the y (r
+0001c980: 6f77 2920 616c 6967 6e6d 656e 7420 616c  ow) alignment al
+0001c990: 6f6e 670a 2020 2020 6564 6765 5f78 203a  ong.    edge_x :
+0001c9a0: 207b 2778 272c 2027 786d 696e 272c 2027   {'x', 'xmin', '
+0001c9b0: 786d 6178 277d 0a20 2020 2020 2020 2057  xmax'}.        W
+0001c9c0: 6869 6368 2065 6467 6520 746f 2070 6572  hich edge to per
+0001c9d0: 666f 726d 2074 6865 2078 2028 636f 6c75  form the x (colu
+0001c9e0: 6d6e 2920 6469 7374 7269 6275 7469 6f6e  mn) distribution
+0001c9f0: 2061 6c6f 6e67 2028 756e 7573 6564 2069   along (unused i
+0001ca00: 660a 2020 2020 2020 2020 7365 7061 7261  f.        separa
+0001ca10: 7469 6f6e 203d 3d20 5472 7565 290a 2020  tion == True).  
+0001ca20: 2020 6564 6765 5f79 203a 207b 2779 272c    edge_y : {'y',
+0001ca30: 2027 796d 696e 272c 2027 796d 6178 277d   'ymin', 'ymax'}
+0001ca40: 0a20 2020 2020 2020 2057 6869 6368 2065  .        Which e
+0001ca50: 6467 6520 746f 2070 6572 666f 726d 2074  dge to perform t
+0001ca60: 6865 2079 2028 726f 7729 2064 6973 7472  he y (row) distr
+0001ca70: 6962 7574 696f 6e20 616c 6f6e 6720 2875  ibution along (u
+0001ca80: 6e75 7365 6420 6966 0a20 2020 2020 2020  nused if.       
+0001ca90: 2073 6570 6172 6174 696f 6e20 3d3d 2054   separation == T
+0001caa0: 7275 6529 0a0a 2020 2020 5265 7475 726e  rue)..    Return
+0001cab0: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
+0001cac0: 2020 6465 7669 6365 5f6d 6174 7269 7820    device_matrix 
+0001cad0: 3a20 4465 7669 6365 0a20 2020 2020 2020  : Device.       
+0001cae0: 2041 2044 6576 6963 6520 636f 6e74 6169   A Device contai
+0001caf0: 6e69 6e67 2061 6c6c 2074 6865 2044 6576  ning all the Dev
+0001cb00: 6963 6573 2069 6e20 6064 6576 6963 655f  ices in `device_
+0001cb10: 6c69 7374 6020 696e 2061 2067 7269 642e  list` in a grid.
+0001cb20: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+0001cb30: 7669 6365 5f61 7272 6179 203d 206e 702e  vice_array = np.
+0001cb40: 6173 6172 7261 7928 6465 7669 6365 5f6c  asarray(device_l
+0001cb50: 6973 7429 0a20 2020 2073 7061 6369 6e67  ist).    spacing
+0001cb60: 203d 206e 702e 6272 6f61 6463 6173 745f   = np.broadcast_
+0001cb70: 746f 2873 7061 6369 6e67 2c20 3229 0a20  to(spacing, 2). 
+0001cb80: 2020 2023 2043 6865 636b 2061 7267 756d     # Check argum
+0001cb90: 656e 7473 0a20 2020 2069 6620 6465 7669  ents.    if devi
+0001cba0: 6365 5f61 7272 6179 2e6e 6469 6d20 6e6f  ce_array.ndim no
+0001cbb0: 7420 696e 2028 312c 2032 293a 0a20 2020  t in (1, 2):.   
+0001cbc0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0001cbd0: 4572 726f 7228 225b 5048 4944 4c5d 2067  Error("[PHIDL] g
+0001cbe0: 7269 6428 2920 5468 6520 6465 7669 6365  rid() The device
+0001cbf0: 5f6c 6973 7420 6e65 6564 7320 746f 2062  _list needs to b
+0001cc00: 6520 3144 206f 7220 3244 2e22 290a 2020  e 1D or 2D.").  
+0001cc10: 2020 6966 2073 6861 7065 2069 7320 6e6f    if shape is no
+0001cc20: 7420 4e6f 6e65 2061 6e64 206c 656e 2873  t None and len(s
+0001cc30: 6861 7065 2920 213d 2032 3a0a 2020 2020  hape) != 2:.    
+0001cc40: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0001cc50: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+0001cc60: 2020 225b 5048 4944 4c5d 2067 7269 6428    "[PHIDL] grid(
+0001cc70: 2920 7368 6170 6520 6172 6775 6d65 6e74  ) shape argument
+0001cc80: 206d 7573 7420 6265 204e 6f6e 6520 6f72   must be None or
+0001cc90: 220a 2020 2020 2020 2020 2020 2020 2b20  ".            + 
+0001cca0: 2220 6861 7665 2061 206c 656e 6774 6820  " have a length 
+0001ccb0: 6f66 2032 2c20 666f 7220 6578 616d 706c  of 2, for exampl
+0001ccc0: 6520 7368 6170 653d 2834 2c36 2922 0a20  e shape=(4,6)". 
+0001ccd0: 2020 2020 2020 2029 0a0a 2020 2020 2320         )..    # 
+0001cce0: 4368 6563 6b20 7468 6174 2073 6861 7065  Check that shape
+0001ccf0: 2069 7320 7661 6c69 6420 616e 6420 7265   is valid and re
+0001cd00: 7368 6170 6520 6172 7261 7920 6966 206e  shape array if n
+0001cd10: 6565 6465 640a 2020 2020 6966 2028 7368  eeded.    if (sh
+0001cd20: 6170 6520 6973 204e 6f6e 6529 2061 6e64  ape is None) and
+0001cd30: 2028 6465 7669 6365 5f61 7272 6179 2e6e   (device_array.n
+0001cd40: 6469 6d20 3d3d 2032 293a 2020 2320 416c  dim == 2):  # Al
+0001cd50: 7265 6164 7920 696e 2064 6573 6972 6564  ready in desired
+0001cd60: 2073 6861 7065 0a20 2020 2020 2020 2073   shape.        s
+0001cd70: 6861 7065 203d 2064 6576 6963 655f 6172  hape = device_ar
+0001cd80: 7261 792e 7368 6170 650a 2020 2020 656c  ray.shape.    el
+0001cd90: 6966 2028 7368 6170 6520 6973 204e 6f6e  if (shape is Non
+0001cda0: 6529 2061 6e64 2028 6465 7669 6365 5f61  e) and (device_a
+0001cdb0: 7272 6179 2e6e 6469 6d20 3d3d 2031 293a  rray.ndim == 1):
+0001cdc0: 0a20 2020 2020 2020 2073 6861 7065 203d  .        shape =
+0001cdd0: 2028 2d31 2c20 6465 7669 6365 5f61 7272   (-1, device_arr
+0001cde0: 6179 2e73 697a 6529 0a20 2020 2065 6c69  ay.size).    eli
+0001cdf0: 6620 3020 3c20 7368 6170 655b 305d 202a  f 0 < shape[0] *
+0001ce00: 2073 6861 7065 5b31 5d20 3c20 6465 7669   shape[1] < devi
+0001ce10: 6365 5f61 7272 6179 2e73 697a 653a 0a20  ce_array.size:. 
+0001ce20: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0001ce30: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+0001ce40: 2020 2020 2022 5b50 4849 444c 5d20 6772       "[PHIDL] gr
+0001ce50: 6964 2829 2054 6865 2073 6861 7065 2069  id() The shape i
+0001ce60: 7320 746f 6f20 736d 616c 6c20 666f 7220  s too small for 
+0001ce70: 616c 6c20 7468 6520 6974 656d 7320 696e  all the items in
+0001ce80: 2064 6576 6963 655f 6c69 7374 220a 2020   device_list".  
+0001ce90: 2020 2020 2020 290a 2020 2020 656c 7365        ).    else
+0001cea0: 3a0a 2020 2020 2020 2020 2320 4368 616e  :.        # Chan
+0001ceb0: 6765 2028 782c 7929 2073 6861 7065 2074  ge (x,y) shape t
+0001cec0: 6f20 2879 2c78 2920 7368 6170 6520 746f  o (y,x) shape to
+0001ced0: 2066 6f6c 6c6f 7720 6465 6661 756c 7420   follow default 
+0001cee0: 726f 772c 2063 6f6c 756d 6e20 666f 726d  row, column form
+0001cef0: 6174 2069 6e20 6e70 2e72 6573 6861 7065  at in np.reshape
+0001cf00: 0a20 2020 2020 2020 2073 6861 7065 203d  .        shape =
+0001cf10: 2073 6861 7065 5b3a 3a2d 315d 0a0a 2020   shape[::-1]..  
+0001cf20: 2020 2020 2020 6966 206e 702e 6d69 6e28        if np.min(
+0001cf30: 7368 6170 6529 203d 3d20 2d31 3a0a 2020  shape) == -1:.  
+0001cf40: 2020 2020 2020 2020 2020 6d61 785f 7368            max_sh
+0001cf50: 6170 6520 3d20 6e70 2e6d 6178 2873 6861  ape = np.max(sha
+0001cf60: 7065 290a 2020 2020 2020 2020 2020 2020  pe).            
+0001cf70: 6d69 6e5f 6465 7669 6365 7320 3d20 696e  min_devices = in
+0001cf80: 7428 6e70 2e63 6569 6c28 6465 7669 6365  t(np.ceil(device
+0001cf90: 5f61 7272 6179 2e73 697a 6520 2f20 6d61  _array.size / ma
+0001cfa0: 785f 7368 6170 6529 202a 206d 6178 5f73  x_shape) * max_s
+0001cfb0: 6861 7065 290a 2020 2020 2020 2020 2020  hape).          
+0001cfc0: 2020 6578 7472 615f 6465 7669 6365 7320    extra_devices 
+0001cfd0: 3d20 6d69 6e5f 6465 7669 6365 7320 2d20  = min_devices - 
+0001cfe0: 6465 7669 6365 5f61 7272 6179 2e73 697a  device_array.siz
+0001cff0: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
+0001d000: 2020 2020 2020 2020 2020 2020 6578 7472              extr
+0001d010: 615f 6465 7669 6365 7320 3d20 7368 6170  a_devices = shap
+0001d020: 655b 305d 202a 2073 6861 7065 5b31 5d20  e[0] * shape[1] 
+0001d030: 2d20 6465 7669 6365 5f61 7272 6179 2e73  - device_array.s
+0001d040: 697a 650a 2020 2020 2020 2020 6966 2065  ize.        if e
+0001d050: 7874 7261 5f64 6576 6963 6573 2021 3d20  xtra_devices != 
+0001d060: 303a 0a20 2020 2020 2020 2020 2020 2064  0:.            d
+0001d070: 6576 6963 655f 6172 7261 7920 3d20 6e70  evice_array = np
+0001d080: 2e61 7070 656e 6428 0a20 2020 2020 2020  .append(.       
+0001d090: 2020 2020 2020 2020 2064 6576 6963 655f           device_
+0001d0a0: 6172 7261 792c 0a20 2020 2020 2020 2020  array,.         
+0001d0b0: 2020 2020 2020 205b 0a20 2020 2020 2020         [.       
+0001d0c0: 2020 2020 2020 2020 2020 2020 204e 6f6e               Non
+0001d0d0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0001d0e0: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
+0001d0f0: 2020 2020 202a 2065 7874 7261 5f64 6576       * extra_dev
+0001d100: 6963 6573 2c0a 2020 2020 2020 2020 2020  ices,.          
+0001d110: 2020 290a 2020 2020 6465 7669 6365 5f61    ).    device_a
+0001d120: 7272 6179 203d 206e 702e 7265 7368 6170  rray = np.reshap
+0001d130: 6528 6465 7669 6365 5f61 7272 6179 2c20  e(device_array, 
+0001d140: 7368 6170 6529 0a0a 2020 2020 2320 4372  shape)..    # Cr
+0001d150: 6561 7465 2061 2062 6c61 6e6b 2044 6576  eate a blank Dev
+0001d160: 6963 6520 616e 6420 7265 6665 7265 6e63  ice and referenc
+0001d170: 6520 616c 6c20 7468 6520 4465 7669 6365  e all the Device
+0001d180: 7320 696e 2069 740a 2020 2020 4420 3d20  s in it.    D = 
+0001d190: 4465 7669 6365 2822 6772 6964 2229 0a20  Device("grid"). 
+0001d1a0: 2020 2072 6566 5f61 7272 6179 203d 206e     ref_array = n
+0001d1b0: 702e 656d 7074 7928 6465 7669 6365 5f61  p.empty(device_a
+0001d1c0: 7272 6179 2e73 6861 7065 2c20 6474 7970  rray.shape, dtyp
+0001d1d0: 653d 6f62 6a65 6374 290a 2020 2020 6475  e=object).    du
+0001d1e0: 6d6d 7920 3d20 4465 7669 6365 2829 0a20  mmy = Device(). 
+0001d1f0: 2020 2066 6f72 2069 6478 2c20 6420 696e     for idx, d in
+0001d200: 206e 702e 6e64 656e 756d 6572 6174 6528   np.ndenumerate(
+0001d210: 6465 7669 6365 5f61 7272 6179 293a 0a20  device_array):. 
+0001d220: 2020 2020 2020 2069 6620 6420 6973 206e         if d is n
+0001d230: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0001d240: 2020 2020 2072 6566 5f61 7272 6179 5b69       ref_array[i
+0001d250: 6478 5d20 3d20 4420 3c3c 2064 0a20 2020  dx] = D << d.   
+0001d260: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001d270: 2020 2020 2020 2072 6566 5f61 7272 6179         ref_array
+0001d280: 5b69 6478 5d20 3d20 4420 3c3c 2064 756d  [idx] = D << dum
+0001d290: 6d79 2020 2320 4372 6561 7465 2064 756d  my  # Create dum
+0001d2a0: 6d79 2064 6576 6963 6573 0a0a 2020 2020  my devices..    
+0001d2b0: 726f 7773 203d 205b 4772 6f75 7028 7265  rows = [Group(re
+0001d2c0: 665f 6172 7261 795b 6e2c 203a 5d29 2066  f_array[n, :]) f
+0001d2d0: 6f72 206e 2069 6e20 7261 6e67 6528 7265  or n in range(re
+0001d2e0: 665f 6172 7261 792e 7368 6170 655b 305d  f_array.shape[0]
+0001d2f0: 295d 0a20 2020 2063 6f6c 7320 3d20 5b47  )].    cols = [G
+0001d300: 726f 7570 2872 6566 5f61 7272 6179 5b3a  roup(ref_array[:
+0001d310: 2c20 6e5d 2920 666f 7220 6e20 696e 2072  , n]) for n in r
+0001d320: 616e 6765 2872 6566 5f61 7272 6179 2e73  ange(ref_array.s
+0001d330: 6861 7065 5b31 5d29 5d0a 0a20 2020 2023  hape[1])]..    #
+0001d340: 2041 6c69 676e 2072 6f77 7320 616e 6420   Align rows and 
+0001d350: 636f 6c75 6d6e 7320 696e 6465 7065 6e64  columns independ
+0001d360: 656e 746c 790a 2020 2020 666f 7220 6e2c  ently.    for n,
+0001d370: 2072 2069 6e20 656e 756d 6572 6174 6528   r in enumerate(
+0001d380: 726f 7773 293a 0a20 2020 2020 2020 2072  rows):.        r
+0001d390: 2e61 6c69 676e 2861 6c69 676e 6d65 6e74  .align(alignment
+0001d3a0: 3d61 6c69 676e 5f79 290a 2020 2020 666f  =align_y).    fo
+0001d3b0: 7220 6e2c 2063 2069 6e20 656e 756d 6572  r n, c in enumer
+0001d3c0: 6174 6528 636f 6c73 293a 0a20 2020 2020  ate(cols):.     
+0001d3d0: 2020 2063 2e61 6c69 676e 2861 6c69 676e     c.align(align
+0001d3e0: 6d65 6e74 3d61 6c69 676e 5f78 290a 0a20  ment=align_x).. 
+0001d3f0: 2020 2023 2044 6973 7472 6962 7574 6520     # Distribute 
+0001d400: 726f 7773 2061 6e64 2063 6f6c 756d 6e73  rows and columns
+0001d410: 0a20 2020 2047 726f 7570 2863 6f6c 7329  .    Group(cols)
+0001d420: 2e64 6973 7472 6962 7574 6528 0a20 2020  .distribute(.   
+0001d430: 2020 2020 2064 6972 6563 7469 6f6e 3d22       direction="
+0001d440: 7822 2c20 7370 6163 696e 673d 7370 6163  x", spacing=spac
+0001d450: 696e 675b 305d 2c20 7365 7061 7261 7469  ing[0], separati
+0001d460: 6f6e 3d73 6570 6172 6174 696f 6e2c 2065  on=separation, e
+0001d470: 6467 653d 6564 6765 5f78 0a20 2020 2029  dge=edge_x.    )
+0001d480: 0a20 2020 2047 726f 7570 2872 6f77 735b  .    Group(rows[
+0001d490: 3a3a 2d31 5d29 2e64 6973 7472 6962 7574  ::-1]).distribut
+0001d4a0: 6528 0a20 2020 2020 2020 2064 6972 6563  e(.        direc
+0001d4b0: 7469 6f6e 3d22 7922 2c20 7370 6163 696e  tion="y", spacin
+0001d4c0: 673d 7370 6163 696e 675b 315d 2c20 7365  g=spacing[1], se
+0001d4d0: 7061 7261 7469 6f6e 3d73 6570 6172 6174  paration=separat
+0001d4e0: 696f 6e2c 2065 6467 653d 6564 6765 5f79  ion, edge=edge_y
+0001d4f0: 0a20 2020 2029 0a0a 2020 2020 2320 7265  .    )..    # re
+0001d500: 7475 726e 2064 6576 6963 655f 6d61 7472  turn device_matr
+0001d510: 6978 0a20 2020 2072 6574 7572 6e20 440a  ix.    return D.
+0001d520: 0a0a 6465 6620 5f70 6172 616d 6574 6572  ..def _parameter
+0001d530: 5f63 6f6d 6269 6e61 7469 6f6e 7328 7061  _combinations(pa
+0001d540: 7261 6d65 7465 7273 5f64 6963 7429 3a0a  rameters_dict):.
+0001d550: 2020 2020 2222 2243 7265 6174 6573 2070      """Creates p
+0001d560: 6172 616d 6574 6572 2063 6f6d 6269 6e61  arameter combina
+0001d570: 7469 6f6e 7320 6672 6f6d 2061 2064 6963  tions from a dic
+0001d580: 7420 6669 6c6c 6564 2077 6974 6820 6c69  t filled with li
+0001d590: 7374 2076 616c 7565 732c 2065 2e67 2e0a  st values, e.g..
+0001d5a0: 2020 2020 7061 7261 6d65 7465 7273 5f64      parameters_d
+0001d5b0: 6963 7420 3d20 7b0a 2020 2020 2020 2020  ict = {.        
+0001d5c0: 2777 6964 7468 2720 3a20 5b30 2e31 2c30  'width' : [0.1,0
+0001d5d0: 2e32 5d2c 0a20 2020 2020 2020 2027 6c65  .2],.        'le
+0001d5e0: 6e67 7468 2720 3a20 5b34 2c35 2c36 5d2c  ngth' : [4,5,6],
+0001d5f0: 0a20 2020 2020 2020 2027 6865 6967 6874  .        'height
+0001d600: 2720 3a20 5b32 325d 0a20 2020 2020 2020  ' : [22].       
+0001d610: 207d 0a20 2020 2057 696c 6c20 7072 6f64   }.    Will prod
+0001d620: 7563 6520 6120 6c69 7374 206f 6620 6469  uce a list of di
+0001d630: 6374 696f 6e61 7269 6573 2c20 6561 6368  ctionaries, each
+0001d640: 206f 6620 7768 6963 6820 6361 6e20 6265   of which can be
+0001d650: 2075 7365 6420 6173 206b 7761 7267 7320   used as kwargs 
+0001d660: 696e 7075 743a 0a20 2020 2020 2020 205b  input:.        [
+0001d670: 7b27 6865 6967 6874 273a 2032 322c 2027  {'height': 22, '
+0001d680: 6c65 6e67 7468 273a 2034 2c20 2777 6964  length': 4, 'wid
+0001d690: 7468 273a 2030 2e31 7d2c 0a20 2020 2020  th': 0.1},.     
+0001d6a0: 2020 2020 7b27 6865 6967 6874 273a 2032      {'height': 2
+0001d6b0: 322c 2027 6c65 6e67 7468 273a 2035 2c20  2, 'length': 5, 
+0001d6c0: 2777 6964 7468 273a 2030 2e31 7d2c 0a20  'width': 0.1},. 
+0001d6d0: 2020 2020 2020 2020 7b27 6865 6967 6874          {'height
+0001d6e0: 273a 2032 322c 2027 6c65 6e67 7468 273a  ': 22, 'length':
+0001d6f0: 2036 2c20 2777 6964 7468 273a 2030 2e31   6, 'width': 0.1
+0001d700: 7d2c 0a20 2020 2020 2020 2020 7b27 6865  },.         {'he
+0001d710: 6967 6874 273a 2032 322c 2027 6c65 6e67  ight': 22, 'leng
+0001d720: 7468 273a 2034 2c20 2777 6964 7468 273a  th': 4, 'width':
+0001d730: 2030 2e32 7d2c 0a20 2020 2020 2020 2020   0.2},.         
+0001d740: 7b27 6865 6967 6874 273a 2032 322c 2027  {'height': 22, '
+0001d750: 6c65 6e67 7468 273a 2035 2c20 2777 6964  length': 5, 'wid
+0001d760: 7468 273a 2030 2e32 7d2c 0a20 2020 2020  th': 0.2},.     
+0001d770: 2020 2020 7b27 6865 6967 6874 273a 2032      {'height': 2
+0001d780: 322c 2027 6c65 6e67 7468 273a 2036 2c20  2, 'length': 6, 
+0001d790: 2777 6964 7468 273a 2030 2e32 7d5d 2222  'width': 0.2}]""
+0001d7a0: 220a 2020 2020 7661 6c75 655f 636f 6d62  ".    value_comb
+0001d7b0: 696e 6174 696f 6e73 203d 206c 6973 7428  inations = list(
+0001d7c0: 6974 6572 746f 6f6c 732e 7072 6f64 7563  itertools.produc
+0001d7d0: 7428 2a70 6172 616d 6574 6572 735f 6469  t(*parameters_di
+0001d7e0: 6374 2e76 616c 7565 7328 2929 290a 2020  ct.values())).  
+0001d7f0: 2020 6b65 7973 203d 206c 6973 7428 7061    keys = list(pa
+0001d800: 7261 6d65 7465 7273 5f64 6963 742e 6b65  rameters_dict.ke
+0001d810: 7973 2829 290a 2020 2020 7265 7475 726e  ys()).    return
+0001d820: 205b 0a20 2020 2020 2020 207b 6b65 7973   [.        {keys
+0001d830: 5b6e 5d3a 2076 616c 7565 735b 6e5d 2066  [n]: values[n] f
+0001d840: 6f72 206e 2069 6e20 7261 6e67 6528 6c65  or n in range(le
+0001d850: 6e28 6b65 7973 2929 7d20 666f 7220 7661  n(keys))} for va
+0001d860: 6c75 6573 2069 6e20 7661 6c75 655f 636f  lues in value_co
+0001d870: 6d62 696e 6174 696f 6e73 0a20 2020 205d  mbinations.    ]
+0001d880: 0a0a 0a64 6566 205f 6765 6e5f 7061 7261  ...def _gen_para
+0001d890: 6d5f 7661 7269 6174 696f 6e73 280a 2020  m_variations(.  
+0001d8a0: 2020 6675 6e63 7469 6f6e 2c20 7061 7261    function, para
+0001d8b0: 6d5f 7661 7269 6174 696f 6e73 2c20 7061  m_variations, pa
+0001d8c0: 7261 6d5f 6465 6661 756c 7473 3d7b 7d2c  ram_defaults={},
+0001d8d0: 2070 6172 616d 5f6f 7665 7272 6964 653d   param_override=
+0001d8e0: 7b7d 2c20 6c61 6265 6c5f 6c61 7965 723d  {}, label_layer=
+0001d8f0: 3235 350a 293a 0a20 2020 2022 2222 5461  255.):.    """Ta
+0001d900: 6b65 7320 652e 672e 0a0a 2020 2020 7061  kes e.g...    pa
+0001d910: 7261 6d5f 7661 7269 6174 696f 6e73 203d  ram_variations =
+0001d920: 207b 0a20 2020 2020 2020 2020 2020 2027   {.            '
+0001d930: 6368 616e 6e65 6c5f 7769 6474 6827 203a  channel_width' :
+0001d940: 205b 312c 322c 335d 0a20 2020 2020 2020   [1,2,3].       
+0001d950: 2020 2020 2027 6761 7465 5f77 6964 7468       'gate_width
+0001d960: 2720 3a20 5b30 2e31 2c30 2e32 2c30 2e34  ' : [0.1,0.2,0.4
+0001d970: 5d2c 0a20 2020 2020 2020 2020 2020 207d  ],.            }
+0001d980: 0a20 2020 2020 2020 6f72 2065 7175 6976  .       or equiv
+0001d990: 616c 656e 746c 790a 2020 2020 7061 7261  alently.    para
+0001d9a0: 6d5f 7661 7269 6174 696f 6e73 203d 2064  m_variations = d
+0001d9b0: 6963 7428 0a20 2020 2020 2020 2020 2020  ict(.           
+0001d9c0: 2063 6861 6e6e 656c 5f77 6964 7468 203d   channel_width =
+0001d9d0: 205b 312c 322c 335d 2c0a 2020 2020 2020   [1,2,3],.      
+0001d9e0: 2020 2020 2020 6761 7465 5f77 6964 7468        gate_width
+0001d9f0: 203d 205b 302e 312c 302e 322c 302e 345d   = [0.1,0.2,0.4]
+0001da00: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0001da10: 2020 2020 2222 220a 2020 2020 7061 7261      """.    para
+0001da20: 6d65 7465 725f 6c69 7374 203d 205f 7061  meter_list = _pa
+0001da30: 7261 6d65 7465 725f 636f 6d62 696e 6174  rameter_combinat
+0001da40: 696f 6e73 2870 6172 616d 5f76 6172 6961  ions(param_varia
+0001da50: 7469 6f6e 7329 0a0a 2020 2020 2320 506f  tions)..    # Po
+0001da60: 7020 6f75 7420 616e 7920 4e6f 6e65 2076  p out any None v
+0001da70: 616c 7565 730a 2020 2020 5b70 6172 616d  alues.    [param
+0001da80: 732e 706f 7028 284e 6f6e 652c 2022 7822  s.pop((None, "x"
+0001da90: 292c 204e 6f6e 6529 2066 6f72 2070 6172  ), None) for par
+0001daa0: 616d 7320 696e 2070 6172 616d 6574 6572  ams in parameter
+0001dab0: 5f6c 6973 745d 0a20 2020 205b 7061 7261  _list].    [para
+0001dac0: 6d73 2e70 6f70 2828 4e6f 6e65 2c20 2279  ms.pop((None, "y
+0001dad0: 2229 2c20 4e6f 6e65 2920 666f 7220 7061  "), None) for pa
+0001dae0: 7261 6d73 2069 6e20 7061 7261 6d65 7465  rams in paramete
+0001daf0: 725f 6c69 7374 5d0a 0a20 2020 2044 5f6c  r_list]..    D_l
+0001db00: 6973 7420 3d20 5b5d 0a20 2020 2066 6f72  ist = [].    for
+0001db10: 2070 6172 616d 7320 696e 2070 6172 616d   params in param
+0001db20: 6574 6572 5f6c 6973 743a 0a20 2020 2020  eter_list:.     
+0001db30: 2020 206e 6577 5f70 6172 616d 7320 3d20     new_params = 
+0001db40: 6469 6374 2829 0a20 2020 2020 2020 206e  dict().        n
+0001db50: 6577 5f70 6172 616d 732e 7570 6461 7465  ew_params.update
+0001db60: 2870 6172 616d 7329 0a20 2020 2020 2020  (params).       
+0001db70: 206e 6577 5f70 6172 616d 732e 7570 6461   new_params.upda
+0001db80: 7465 2870 6172 616d 5f6f 7665 7272 6964  te(param_overrid
+0001db90: 6529 0a20 2020 2020 2020 2044 5f6e 6577  e).        D_new
+0001dba0: 203d 206d 616b 655f 6465 7669 6365 2866   = make_device(f
+0001dbb0: 756e 6374 696f 6e2c 2063 6f6e 6669 673d  unction, config=
+0001dbc0: 7061 7261 6d5f 6465 6661 756c 7473 2c20  param_defaults, 
+0001dbd0: 2a2a 6e65 775f 7061 7261 6d73 290a 2020  **new_params).  
+0001dbe0: 2020 2020 2020 6c61 6265 6c5f 7465 7874        label_text
+0001dbf0: 203d 2022 220a 2020 2020 2020 2020 666f   = "".        fo
+0001dc00: 7220 6e61 6d65 2c20 7661 6c75 6520 696e  r name, value in
+0001dc10: 2070 6172 616d 732e 6974 656d 7328 293a   params.items():
+0001dc20: 0a20 2020 2020 2020 2020 2020 206c 6162  .            lab
+0001dc30: 656c 5f74 6578 7420 2b3d 2028 6622 7b6e  el_text += (f"{n
+0001dc40: 616d 657d 3d7b 7661 6c75 657d 2229 202b  ame}={value}") +
+0001dc50: 2022 5c6e 220a 2020 2020 2020 2020 6966   "\n".        if
+0001dc60: 206c 6162 656c 5f6c 6179 6572 2069 7320   label_layer is 
+0001dc70: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0001dc80: 2020 2020 2020 445f 6e65 772e 6164 645f        D_new.add_
+0001dc90: 6c61 6265 6c28 7465 7874 3d6c 6162 656c  label(text=label
+0001dca0: 5f74 6578 742c 2070 6f73 6974 696f 6e3d  _text, position=
+0001dcb0: 445f 6e65 772e 6365 6e74 6572 2c20 6c61  D_new.center, la
+0001dcc0: 7965 723d 6c61 6265 6c5f 6c61 7965 7229  yer=label_layer)
+0001dcd0: 0a0a 2020 2020 2020 2020 445f 6c69 7374  ..        D_list
+0001dce0: 2e61 7070 656e 6428 445f 6e65 7729 0a20  .append(D_new). 
+0001dcf0: 2020 2072 6574 7572 6e20 445f 6c69 7374     return D_list
+0001dd00: 0a0a 0a64 6566 2067 7269 6473 7765 6570  ...def gridsweep
+0001dd10: 280a 2020 2020 6675 6e63 7469 6f6e 2c0a  (.    function,.
+0001dd20: 2020 2020 7061 7261 6d5f 783d 7b22 7769      param_x={"wi
+0001dd30: 6474 6822 3a20 5b31 2c20 352c 2036 2c20  dth": [1, 5, 6, 
+0001dd40: 375d 7d2c 0a20 2020 2070 6172 616d 5f79  7]},.    param_y
+0001dd50: 3d7b 226c 656e 6774 6822 3a20 5b31 2e31  ={"length": [1.1
+0001dd60: 2c20 322c 2037 305d 7d2c 0a20 2020 2070  , 2, 70]},.    p
+0001dd70: 6172 616d 5f64 6566 6175 6c74 733d 7b7d  aram_defaults={}
+0001dd80: 2c0a 2020 2020 7061 7261 6d5f 6f76 6572  ,.    param_over
+0001dd90: 7269 6465 3d7b 7d2c 0a20 2020 2073 7061  ride={},.    spa
+0001dda0: 6369 6e67 3d28 3530 2c20 3130 3029 2c0a  cing=(50, 100),.
+0001ddb0: 2020 2020 7365 7061 7261 7469 6f6e 3d54      separation=T
+0001ddc0: 7275 652c 0a20 2020 2061 6c69 676e 5f78  rue,.    align_x
+0001ddd0: 3d22 7822 2c0a 2020 2020 616c 6967 6e5f  ="x",.    align_
+0001dde0: 793d 2279 222c 0a20 2020 2065 6467 655f  y="y",.    edge_
+0001ddf0: 783d 2278 222c 0a20 2020 2065 6467 655f  x="x",.    edge_
+0001de00: 793d 2279 6d69 6e22 2c0a 2020 2020 6c61  y="ymin",.    la
+0001de10: 6265 6c5f 6c61 7965 723d 3235 352c 0a29  bel_layer=255,.)
+0001de20: 3a0a 2020 2020 2222 2243 7265 6174 6573  :.    """Creates
+0001de30: 2061 2070 6172 616d 6574 6572 2073 7765   a parameter swe
+0001de40: 6570 206f 6620 6465 7669 6365 7320 616e  ep of devices an
+0001de50: 6420 706c 6163 6573 2074 6865 6d20 6f6e  d places them on
+0001de60: 2061 2067 7269 6420 7769 7468 0a20 2020   a grid with.   
+0001de70: 206c 6162 656c 7320 666f 7220 6561 6368   labels for each
+0001de80: 2064 6576 6963 652e 2046 6f72 2069 6e73   device. For ins
+0001de90: 7461 6e63 652c 2067 6976 656e 2061 2066  tance, given a f
+0001dea0: 756e 6374 696f 6e20 6465 6669 6e65 6420  unction defined 
+0001deb0: 6c69 6b65 0a20 2020 2060 6d79 7368 6170  like.    `myshap
+0001dec0: 6528 7769 6474 682c 2068 6569 6768 742c  e(width, height,
+0001ded0: 206f 6666 7365 742c 206c 6179 6572 2960   offset, layer)`
+0001dee0: 2061 6e64 2074 6865 2066 6f6c 6c6f 7769   and the followi
+0001def0: 6e67 2070 6172 616d 6574 6572 733a 0a20  ng parameters:. 
+0001df00: 2020 2020 2020 2070 6172 616d 5f78 203d         param_x =
+0001df10: 207b 2777 6964 7468 2720 3a20 205b 342c   {'width' :  [4,
+0001df20: 2035 2c20 365d 2020 7d2c 0a20 2020 2020   5, 6]  },.     
+0001df30: 2020 2070 6172 616d 5f79 203d 207b 2768     param_y = {'h
+0001df40: 6569 6768 7427 203a 205b 372c 2039 5d2c  eight' : [7, 9],
+0001df50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001df60: 2020 2020 276c 6179 6572 2720 3a20 205b      'layer' :  [
+0001df70: 312c 2032 2c20 335d 2020 7d2c 0a20 2020  1, 2, 3]  },.   
+0001df80: 2020 2020 2070 6172 616d 5f64 6566 6175       param_defau
+0001df90: 6c74 7320 3d20 7b27 7363 616c 6527 203a  lts = {'scale' :
+0001dfa0: 2031 7d0a 0a20 2020 2067 7269 6473 7765   1}..    gridswe
+0001dfb0: 6570 2829 2070 726f 6475 6365 2061 2067  ep() produce a g
+0001dfc0: 7269 6420 6f66 2064 6576 6963 6573 2077  rid of devices w
+0001dfd0: 6974 6820 7468 6520 666f 6c6c 6f77 696e  ith the followin
+0001dfe0: 6720 6c61 796f 7574 2f70 6172 616d 6574  g layout/paramet
+0001dff0: 6572 733a 0a20 2020 2020 2020 2028 773d  ers:.        (w=
+0001e000: 342c 2068 3d37 2c20 733d 312c 206c 3d31  4, h=7, s=1, l=1
+0001e010: 2920 2020 2028 773d 352c 2068 3d37 2c20  )    (w=5, h=7, 
+0001e020: 733d 312c 206c 3d31 2920 2020 2028 773d  s=1, l=1)    (w=
+0001e030: 362c 2068 3d37 2c20 733d 312c 206c 3d31  6, h=7, s=1, l=1
+0001e040: 290a 2020 2020 2020 2020 2877 3d34 2c20  ).        (w=4, 
+0001e050: 683d 372c 2073 3d31 2c20 6c3d 3229 2020  h=7, s=1, l=2)  
+0001e060: 2020 2877 3d35 2c20 683d 372c 2073 3d31    (w=5, h=7, s=1
+0001e070: 2c20 6c3d 3229 2020 2020 2877 3d36 2c20  , l=2)    (w=6, 
+0001e080: 683d 372c 2073 3d31 2c20 6c3d 3229 0a20  h=7, s=1, l=2). 
+0001e090: 2020 2020 2020 2028 773d 342c 2068 3d37         (w=4, h=7
+0001e0a0: 2c20 733d 312c 206c 3d33 2920 2020 2028  , s=1, l=3)    (
+0001e0b0: 773d 352c 2068 3d37 2c20 733d 312c 206c  w=5, h=7, s=1, l
+0001e0c0: 3d33 2920 2020 2028 773d 362c 2068 3d37  =3)    (w=6, h=7
+0001e0d0: 2c20 733d 312c 206c 3d33 290a 2020 2020  , s=1, l=3).    
+0001e0e0: 2020 2020 2877 3d34 2c20 683d 392c 2073      (w=4, h=9, s
+0001e0f0: 3d31 2c20 6c3d 3129 2020 2020 2877 3d35  =1, l=1)    (w=5
+0001e100: 2c20 683d 392c 2073 3d31 2c20 6c3d 3129  , h=9, s=1, l=1)
+0001e110: 2020 2020 2877 3d36 2c20 683d 392c 2073      (w=6, h=9, s
+0001e120: 3d31 2c20 6c3d 3129 0a20 2020 2020 2020  =1, l=1).       
+0001e130: 2028 773d 342c 2068 3d39 2c20 733d 312c   (w=4, h=9, s=1,
+0001e140: 206c 3d32 2920 2020 2028 773d 352c 2068   l=2)    (w=5, h
+0001e150: 3d39 2c20 733d 312c 206c 3d32 2920 2020  =9, s=1, l=2)   
+0001e160: 2028 773d 362c 2068 3d39 2c20 733d 312c   (w=6, h=9, s=1,
+0001e170: 206c 3d32 290a 2020 2020 2020 2020 2877   l=2).        (w
+0001e180: 3d34 2c20 683d 392c 2073 3d31 2c20 6c3d  =4, h=9, s=1, l=
+0001e190: 3329 2020 2020 2877 3d35 2c20 683d 392c  3)    (w=5, h=9,
+0001e1a0: 2073 3d31 2c20 6c3d 3329 2020 2020 2877   s=1, l=3)    (w
+0001e1b0: 3d36 2c20 683d 392c 2073 3d31 2c20 6c3d  =6, h=9, s=1, l=
+0001e1c0: 3329 0a0a 0a20 2020 2050 6172 616d 6574  3)...    Paramet
+0001e1d0: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+0001e1e0: 2d2d 0a20 2020 2066 756e 6374 696f 6e20  --.    function 
+0001e1f0: 3a20 6675 6e63 7469 6f6e 2074 6861 7420  : function that 
+0001e200: 7072 6f64 7563 6573 2061 2044 6576 6963  produces a Devic
+0001e210: 650a 2020 2020 2020 2020 5468 6520 6675  e.        The fu
+0001e220: 6e63 7469 6f6e 2077 6869 6368 2077 696c  nction which wil
+0001e230: 6c20 6265 2075 7365 6420 746f 2063 7265  l be used to cre
+0001e240: 6174 6520 7468 6520 696e 6469 7669 6475  ate the individu
+0001e250: 616c 2064 6576 6963 6573 2069 6e20 7468  al devices in th
+0001e260: 650a 2020 2020 2020 2020 6772 6964 2e20  e.        grid. 
+0001e270: 204d 7573 7420 6f6e 6c79 2072 6574 7572   Must only retur
+0001e280: 6e20 6120 7369 6e67 6c65 2044 6576 6963  n a single Devic
+0001e290: 6520 2865 2e67 2e20 616e 7920 6f66 2074  e (e.g. any of t
+0001e2a0: 6865 2066 756e 6374 696f 6e73 2069 6e0a  he functions in.
+0001e2b0: 2020 2020 2020 2020 7067 2e67 656f 6d65          pg.geome
+0001e2c0: 7472 7929 0a20 2020 2070 6172 616d 5f78  try).    param_x
+0001e2d0: 203a 2064 6963 742c 2069 6e74 2c20 4e6f   : dict, int, No
+0001e2e0: 6e65 0a20 2020 2020 2020 2041 2064 6963  ne.        A dic
+0001e2f0: 7469 6f6e 6172 7920 6f66 206f 6e65 206f  tionary of one o
+0001e300: 7220 6d6f 7265 2070 6172 616d 6574 6572  r more parameter
+0001e310: 7320 746f 2073 7765 6570 2069 6e20 7468  s to sweep in th
+0001e320: 6520 782d 6469 7265 6374 696f 6e2e 0a20  e x-direction.. 
+0001e330: 2020 2020 2020 2049 6620 4e6f 6e65 2c20         If None, 
+0001e340: 646f 206e 6f74 2073 7765 6570 2e20 4966  do not sweep. If
+0001e350: 2069 6e74 2c20 7265 7065 6174 204e 2074   int, repeat N t
+0001e360: 696d 6573 2069 6e20 782d 6469 7265 6374  imes in x-direct
+0001e370: 696f 6e0a 2020 2020 7061 7261 6d5f 7920  ion.    param_y 
+0001e380: 3a20 6469 6374 2c20 696e 742c 204e 6f6e  : dict, int, Non
+0001e390: 650a 2020 2020 2020 2020 4120 6469 6374  e.        A dict
+0001e3a0: 696f 6e61 7279 206f 6620 6f6e 6520 6f72  ionary of one or
+0001e3b0: 206d 6f72 6520 7061 7261 6d65 7465 7273   more parameters
+0001e3c0: 2074 6f20 7377 6565 7020 696e 2074 6865   to sweep in the
+0001e3d0: 2079 2d64 6972 6563 7469 6f6e 2e0a 2020   y-direction..  
+0001e3e0: 2020 2020 2020 4966 204e 6f6e 652c 2064        If None, d
+0001e3f0: 6f20 6e6f 7420 7377 6565 702e 2049 6620  o not sweep. If 
+0001e400: 696e 742c 2072 6570 6561 7420 4e20 7469  int, repeat N ti
+0001e410: 6d65 7320 696e 2079 2d64 6972 6563 7469  mes in y-directi
+0001e420: 6f6e 0a20 2020 2070 6172 616d 5f64 6566  on.    param_def
+0001e430: 6175 6c74 7320 3a20 6469 6374 0a20 2020  aults : dict.   
+0001e440: 2020 2020 2044 6566 6175 6c74 2070 6172       Default par
+0001e450: 616d 6574 6572 7320 746f 2070 6173 7320  ameters to pass 
+0001e460: 746f 2065 7665 7279 2064 6576 6963 6520  to every device 
+0001e470: 696e 2074 6865 2067 7269 640a 2020 2020  in the grid.    
+0001e480: 7061 7261 6d5f 6f76 6572 7269 6465 203a  param_override :
+0001e490: 2064 6963 740a 2020 2020 2020 2020 5061   dict.        Pa
+0001e4a0: 7261 6d65 7465 7273 2074 6861 7420 7769  rameters that wi
+0001e4b0: 6c6c 206f 7665 7272 6964 6520 6070 6172  ll override `par
+0001e4c0: 616d 5f64 6566 6175 6c74 7360 2c20 6571  am_defaults`, eq
+0001e4d0: 7569 7661 6c65 6e74 2074 6f20 6368 616e  uivalent to chan
+0001e4e0: 6769 6e67 0a20 2020 2020 2020 2070 6172  ging.        par
+0001e4f0: 616d 5f64 6566 6175 6c74 7320 2875 7365  am_defaults (use
+0001e500: 6675 6c20 290a 2020 2020 7370 6163 696e  ful ).    spacin
+0001e510: 6720 3a20 696e 742c 2066 6c6f 6174 2c20  g : int, float, 
+0001e520: 6f72 2061 7272 6179 2d6c 696b 655b 325d  or array-like[2]
+0001e530: 206f 6620 696e 7420 6f72 2066 6c6f 6174   of int or float
+0001e540: 0a20 2020 2020 2020 2053 7061 6369 6e67  .        Spacing
+0001e550: 2062 6574 7765 656e 2061 646a 6163 656e   between adjacen
+0001e560: 7420 656c 656d 656e 7473 206f 6e20 7468  t elements on th
+0001e570: 6520 6772 6964 2c20 6361 6e20 6265 2061  e grid, can be a
+0001e580: 2074 7570 6c65 2066 6f72 0a20 2020 2020   tuple for.     
+0001e590: 2020 2064 6966 6665 7265 6e74 2064 6973     different dis
+0001e5a0: 7461 6e63 6573 2069 6e20 7769 6474 6820  tances in width 
+0001e5b0: 616e 6420 6865 6967 6874 2028 782c 7929  and height (x,y)
+0001e5c0: 2e0a 2020 2020 7365 7061 7261 7469 6f6e  ..    separation
+0001e5d0: 203a 2062 6f6f 6c0a 2020 2020 2020 2020   : bool.        
+0001e5e0: 4966 2054 7275 652c 2067 7561 7261 6e74  If True, guarant
+0001e5f0: 6565 7320 656c 656d 656e 7473 2061 7265  ees elements are
+0001e600: 2073 6570 6172 6174 6564 2077 6974 6820   separated with 
+0001e610: 6120 6669 7865 6420 7370 6163 696e 670a  a fixed spacing.
+0001e620: 2020 2020 2020 2020 6265 7477 6565 6e3b          between;
+0001e630: 2069 6620 4661 6c73 652c 2065 6c65 6d65   if False, eleme
+0001e640: 6e74 7320 6172 6520 7370 6163 6564 2065  nts are spaced e
+0001e650: 7665 6e6c 7920 616c 6f6e 6720 6120 6772  venly along a gr
+0001e660: 6964 2e0a 2020 2020 7368 6170 6520 3a20  id..    shape : 
+0001e670: 6172 7261 792d 6c69 6b65 5b32 5d0a 2020  array-like[2].  
+0001e680: 2020 2020 2020 782c 2079 2073 6861 7065        x, y shape
+0001e690: 206f 6620 7468 6520 6772 6964 2028 7365   of the grid (se
+0001e6a0: 6520 6e70 2e72 6573 6861 7065 292e 2049  e np.reshape). I
+0001e6b0: 6620 6e6f 2073 6861 7065 2069 7320 6769  f no shape is gi
+0001e6c0: 7665 6e20 616e 6420 7468 650a 2020 2020  ven and the.    
+0001e6d0: 2020 2020 6c69 7374 2069 7320 3144 2c20      list is 1D, 
+0001e6e0: 7468 6520 6f75 7470 7574 2069 7320 6173  the output is as
+0001e6f0: 2069 6620 6e70 2e72 6573 6861 7065 2077   if np.reshape w
+0001e700: 6572 6520 7275 6e20 7769 7468 2028 312c  ere run with (1,
+0001e710: 202d 3129 2e0a 2020 2020 616c 6967 6e5f   -1)..    align_
+0001e720: 7820 3a20 7b27 7827 2c20 2778 6d69 6e27  x : {'x', 'xmin'
+0001e730: 2c20 2778 6d61 7827 7d0a 2020 2020 2020  , 'xmax'}.      
+0001e740: 2020 5768 6963 6820 6564 6765 2074 6f20    Which edge to 
+0001e750: 7065 7266 6f72 6d20 7468 6520 7820 2863  perform the x (c
+0001e760: 6f6c 756d 6e29 2061 6c69 676e 6d65 6e74  olumn) alignment
+0001e770: 2061 6c6f 6e67 0a20 2020 2061 6c69 676e   along.    align
+0001e780: 5f79 203a 207b 2779 272c 2027 796d 696e  _y : {'y', 'ymin
+0001e790: 272c 2027 796d 6178 277d 0a20 2020 2020  ', 'ymax'}.     
+0001e7a0: 2020 2057 6869 6368 2065 6467 6520 746f     Which edge to
+0001e7b0: 2070 6572 666f 726d 2074 6865 2079 2028   perform the y (
+0001e7c0: 726f 7729 2061 6c69 676e 6d65 6e74 2061  row) alignment a
+0001e7d0: 6c6f 6e67 0a20 2020 2065 6467 655f 7820  long.    edge_x 
+0001e7e0: 3a20 7b27 7827 2c20 2778 6d69 6e27 2c20  : {'x', 'xmin', 
+0001e7f0: 2778 6d61 7827 7d0a 2020 2020 2020 2020  'xmax'}.        
+0001e800: 5768 6963 6820 6564 6765 2074 6f20 7065  Which edge to pe
+0001e810: 7266 6f72 6d20 7468 6520 7820 2863 6f6c  rform the x (col
+0001e820: 756d 6e29 2064 6973 7472 6962 7574 696f  umn) distributio
+0001e830: 6e20 616c 6f6e 6720 2875 6e75 7365 6420  n along (unused 
+0001e840: 6966 0a20 2020 2020 2020 2073 6570 6172  if.        separ
+0001e850: 6174 696f 6e20 3d3d 2054 7275 6529 0a20  ation == True). 
+0001e860: 2020 2065 6467 655f 7920 3a20 7b27 7927     edge_y : {'y'
+0001e870: 2c20 2779 6d69 6e27 2c20 2779 6d61 7827  , 'ymin', 'ymax'
+0001e880: 7d0a 2020 2020 2020 2020 5768 6963 6820  }.        Which 
+0001e890: 6564 6765 2074 6f20 7065 7266 6f72 6d20  edge to perform 
+0001e8a0: 7468 6520 7920 2872 6f77 2920 6469 7374  the y (row) dist
+0001e8b0: 7269 6275 7469 6f6e 2061 6c6f 6e67 2028  ribution along (
+0001e8c0: 756e 7573 6564 2069 660a 2020 2020 2020  unused if.      
+0001e8d0: 2020 7365 7061 7261 7469 6f6e 203d 3d20    separation == 
+0001e8e0: 5472 7565 290a 2020 2020 6c61 6265 6c5f  True).    label_
+0001e8f0: 6c61 7965 7220 3a20 4e6f 6e65 206f 7220  layer : None or 
+0001e900: 6c61 7965 720a 2020 2020 2020 2020 4966  layer.        If
+0001e910: 206e 6f74 204e 6f6e 652c 2077 696c 6c20   not None, will 
+0001e920: 706c 6163 6520 6120 6c61 6265 6c20 7468  place a label th
+0001e930: 6174 2064 6573 6372 6962 6573 2074 6865  at describes the
+0001e940: 2070 6172 616d 6574 6572 7320 6f6e 2074   parameters on t
+0001e950: 6865 2064 6576 6963 650a 0a20 2020 2052  he device..    R
+0001e960: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
+0001e970: 2d2d 0a20 2020 2064 6576 6963 655f 6d61  --.    device_ma
+0001e980: 7472 6978 203a 2044 6576 6963 650a 2020  trix : Device.  
+0001e990: 2020 2020 2020 4120 4465 7669 6365 2063        A Device c
+0001e9a0: 6f6e 7461 696e 696e 6720 616c 6c20 7468  ontaining all th
+0001e9b0: 6520 4465 7669 6365 7320 696e 2060 6465  e Devices in `de
+0001e9c0: 7669 6365 5f6c 6973 7460 2069 6e20 6120  vice_list` in a 
+0001e9d0: 6772 6964 2e0a 2020 2020 2222 220a 2020  grid..    """.  
+0001e9e0: 2020 6966 2070 6172 616d 5f78 2069 7320    if param_x is 
+0001e9f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7061  None:.        pa
+0001ea00: 7261 6d5f 7820 3d20 7b28 4e6f 6e65 2c20  ram_x = {(None, 
+0001ea10: 2278 2229 3a20 5b4e 6f6e 655d 7d0a 2020  "x"): [None]}.  
+0001ea20: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+0001ea30: 6528 7061 7261 6d5f 782c 2069 6e74 293a  e(param_x, int):
+0001ea40: 0a20 2020 2020 2020 2070 6172 616d 5f78  .        param_x
+0001ea50: 203d 207b 284e 6f6e 652c 2022 7822 293a   = {(None, "x"):
+0001ea60: 205b 4e6f 6e65 5d20 2a20 7061 7261 6d5f   [None] * param_
+0001ea70: 787d 0a20 2020 2069 6620 7061 7261 6d5f  x}.    if param_
+0001ea80: 7920 6973 204e 6f6e 653a 0a20 2020 2020  y is None:.     
+0001ea90: 2020 2070 6172 616d 5f79 203d 207b 284e     param_y = {(N
+0001eaa0: 6f6e 652c 2022 7922 293a 205b 4e6f 6e65  one, "y"): [None
+0001eab0: 5d7d 0a20 2020 2065 6c69 6620 6973 696e  ]}.    elif isin
+0001eac0: 7374 616e 6365 2870 6172 616d 5f79 2c20  stance(param_y, 
+0001ead0: 696e 7429 3a0a 2020 2020 2020 2020 7061  int):.        pa
+0001eae0: 7261 6d5f 7920 3d20 7b28 4e6f 6e65 2c20  ram_y = {(None, 
+0001eaf0: 2279 2229 3a20 5b4e 6f6e 655d 202a 2070  "y"): [None] * p
+0001eb00: 6172 616d 5f79 7d0a 0a20 2020 2070 6172  aram_y}..    par
+0001eb10: 616d 5f76 6172 6961 7469 6f6e 7320 3d20  am_variations = 
+0001eb20: 4f72 6465 7265 6444 6963 7428 290a 2020  OrderedDict().  
+0001eb30: 2020 7061 7261 6d5f 7661 7269 6174 696f    param_variatio
+0001eb40: 6e73 2e75 7064 6174 6528 7061 7261 6d5f  ns.update(param_
+0001eb50: 7929 0a20 2020 2070 6172 616d 5f76 6172  y).    param_var
+0001eb60: 6961 7469 6f6e 732e 7570 6461 7465 2870  iations.update(p
+0001eb70: 6172 616d 5f78 290a 0a20 2020 2044 5f6c  aram_x)..    D_l
+0001eb80: 6973 7420 3d20 5f67 656e 5f70 6172 616d  ist = _gen_param
+0001eb90: 5f76 6172 6961 7469 6f6e 7328 0a20 2020  _variations(.   
+0001eba0: 2020 2020 2066 756e 6374 696f 6e3d 6675       function=fu
+0001ebb0: 6e63 7469 6f6e 2c0a 2020 2020 2020 2020  nction,.        
+0001ebc0: 7061 7261 6d5f 7661 7269 6174 696f 6e73  param_variations
+0001ebd0: 3d70 6172 616d 5f76 6172 6961 7469 6f6e  =param_variation
+0001ebe0: 732c 0a20 2020 2020 2020 2070 6172 616d  s,.        param
+0001ebf0: 5f64 6566 6175 6c74 733d 7061 7261 6d5f  _defaults=param_
+0001ec00: 6465 6661 756c 7473 2c0a 2020 2020 2020  defaults,.      
+0001ec10: 2020 7061 7261 6d5f 6f76 6572 7269 6465    param_override
+0001ec20: 3d70 6172 616d 5f6f 7665 7272 6964 652c  =param_override,
+0001ec30: 0a20 2020 2020 2020 206c 6162 656c 5f6c  .        label_l
+0001ec40: 6179 6572 3d6c 6162 656c 5f6c 6179 6572  ayer=label_layer
+0001ec50: 2c0a 2020 2020 290a 0a20 2020 206e 756d  ,.    )..    num
+0001ec60: 5f78 5f70 6172 616d 6574 6572 7320 3d20  _x_parameters = 
+0001ec70: 6c65 6e28 5f70 6172 616d 6574 6572 5f63  len(_parameter_c
+0001ec80: 6f6d 6269 6e61 7469 6f6e 7328 7061 7261  ombinations(para
+0001ec90: 6d5f 7829 290a 2020 2020 6e75 6d5f 795f  m_x)).    num_y_
+0001eca0: 7061 7261 6d65 7465 7273 203d 206c 656e  parameters = len
+0001ecb0: 285f 7061 7261 6d65 7465 725f 636f 6d62  (_parameter_comb
+0001ecc0: 696e 6174 696f 6e73 2870 6172 616d 5f79  inations(param_y
+0001ecd0: 2929 0a20 2020 2044 203d 2067 7269 6428  )).    D = grid(
+0001ece0: 0a20 2020 2020 2020 2044 5f6c 6973 742c  .        D_list,
+0001ecf0: 0a20 2020 2020 2020 2073 7061 6369 6e67  .        spacing
+0001ed00: 3d73 7061 6369 6e67 2c0a 2020 2020 2020  =spacing,.      
+0001ed10: 2020 7365 7061 7261 7469 6f6e 3d73 6570    separation=sep
+0001ed20: 6172 6174 696f 6e2c 0a20 2020 2020 2020  aration,.       
+0001ed30: 2073 6861 7065 3d28 6e75 6d5f 785f 7061   shape=(num_x_pa
+0001ed40: 7261 6d65 7465 7273 2c20 6e75 6d5f 795f  rameters, num_y_
+0001ed50: 7061 7261 6d65 7465 7273 292c 0a20 2020  parameters),.   
+0001ed60: 2020 2020 2061 6c69 676e 5f78 3d61 6c69       align_x=ali
+0001ed70: 676e 5f78 2c0a 2020 2020 2020 2020 616c  gn_x,.        al
+0001ed80: 6967 6e5f 793d 616c 6967 6e5f 792c 0a20  ign_y=align_y,. 
+0001ed90: 2020 2020 2020 2065 6467 655f 783d 6564         edge_x=ed
+0001eda0: 6765 5f78 2c0a 2020 2020 2020 2020 6564  ge_x,.        ed
+0001edb0: 6765 5f79 3d65 6467 655f 792c 0a20 2020  ge_y=edge_y,.   
+0001edc0: 2029 0a0a 2020 2020 6c61 6265 6c5f 7465   )..    label_te
+0001edd0: 7874 203d 207b 7d0a 2020 2020 6c61 6265  xt = {}.    labe
+0001ede0: 6c5f 7465 7874 2e75 7064 6174 6528 7061  l_text.update(pa
+0001edf0: 7261 6d5f 6465 6661 756c 7473 290a 2020  ram_defaults).  
+0001ee00: 2020 6c61 6265 6c5f 7465 7874 2e75 7064    label_text.upd
+0001ee10: 6174 6528 7061 7261 6d5f 6f76 6572 7269  ate(param_overri
+0001ee20: 6465 290a 2020 2020 6966 206c 6162 656c  de).    if label
+0001ee30: 5f6c 6179 6572 2069 7320 6e6f 7420 4e6f  _layer is not No
+0001ee40: 6e65 3a0a 2020 2020 2020 2020 442e 6164  ne:.        D.ad
+0001ee50: 645f 6c61 6265 6c28 7465 7874 3d73 7472  d_label(text=str
+0001ee60: 286c 6162 656c 5f74 6578 7429 2c20 706f  (label_text), po
+0001ee70: 7369 7469 6f6e 3d28 442e 786d 696e 2c20  sition=(D.xmin, 
+0001ee80: 442e 796d 696e 292c 206c 6179 6572 3d6c  D.ymin), layer=l
+0001ee90: 6162 656c 5f6c 6179 6572 290a 0a20 2020  abel_layer)..   
+0001eea0: 2072 6574 7572 6e20 440a 0a0a 6465 6620   return D...def 
+0001eeb0: 5f70 6163 6b5f 7369 6e67 6c65 5f62 696e  _pack_single_bin
+0001eec0: 280a 2020 2020 7265 6374 5f64 6963 742c  (.    rect_dict,
+0001eed0: 2061 7370 6563 745f 7261 7469 6f2c 206d   aspect_ratio, m
+0001eee0: 6178 5f73 697a 652c 2073 6f72 745f 6279  ax_size, sort_by
+0001eef0: 5f61 7265 612c 2064 656e 7369 7479 2c20  _area, density, 
+0001ef00: 7072 6563 6973 696f 6e2c 2076 6572 626f  precision, verbo
+0001ef10: 7365 0a29 3a0a 2020 2020 2222 2254 616b  se.):.    """Tak
+0001ef20: 6573 2061 2060 7265 6374 5f64 6963 7460  es a `rect_dict`
+0001ef30: 2061 7267 756d 656e 7420 6f66 2074 6865   argument of the
+0001ef40: 2066 6f72 6d20 7b69 643a 2877 2c20 6829   form {id:(w, h)
+0001ef50: 7d20 616e 6420 7472 6965 7320 746f 0a20  } and tries to. 
+0001ef60: 2020 2070 6163 6b20 6974 2069 6e74 6f20     pack it into 
+0001ef70: 6120 6269 6e20 6173 2073 6d61 6c6c 2061  a bin as small a
+0001ef80: 7320 706f 7373 6962 6c65 2077 6974 6820  s possible with 
+0001ef90: 6173 7065 6374 2072 6174 696f 2060 6173  aspect ratio `as
+0001efa0: 7065 6374 5f72 6174 696f 602e 0a20 2020  pect_ratio`..   
+0001efb0: 2057 696c 6c20 6974 6572 6174 6976 656c   Will iterativel
+0001efc0: 7920 6772 6f77 2074 6865 2062 696e 2073  y grow the bin s
+0001efd0: 697a 6520 756e 7469 6c20 6576 6572 7974  ize until everyt
+0001efe0: 6869 6e67 2066 6974 7320 6f72 2074 6865  hing fits or the
+0001eff0: 2062 696e 2073 697a 650a 2020 2020 7265   bin size.    re
+0001f000: 6163 6865 7320 606d 6178 5f73 697a 6560  aches `max_size`
+0001f010: 2e20 5265 7475 726e 7320 6120 6469 6374  . Returns a dict
+0001f020: 696f 6e61 7279 206f 6620 7468 6520 7061  ionary of the pa
+0001f030: 636b 6564 2072 6563 7461 6e67 6c65 736e  cked rectanglesn
+0001f040: 2069 6e20 7468 650a 2020 2020 666f 726d   in the.    form
+0001f050: 207b 6964 3a28 782c 2079 2c20 772c 2068   {id:(x, y, w, h
+0001f060: 297d 2c20 616e 6420 6120 6469 6374 696f  )}, and a dictio
+0001f070: 6e61 7279 206f 6620 7265 6d61 696e 696e  nary of remainin
+0001f080: 6720 756e 7061 636b 6564 2072 6563 7473  g unpacked rects
+0001f090: 2e0a 2020 2020 2222 220a 2020 2020 7472  ..    """.    tr
+0001f0a0: 793a 0a20 2020 2020 2020 2069 6d70 6f72  y:.        impor
+0001f0b0: 7420 7265 6374 7061 636b 0a20 2020 2065  t rectpack.    e
+0001f0c0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+0001f0d0: 0a20 2020 2020 2020 2072 6169 7365 2049  .        raise I
+0001f0e0: 6d70 6f72 7445 7272 6f72 280a 2020 2020  mportError(.    
+0001f0f0: 2020 2020 2020 2020 225b 5048 4944 4c5d          "[PHIDL]
+0001f100: 2054 6865 2070 6163 6b65 7228 2920 6675   The packer() fu
+0001f110: 6e63 7469 6f6e 2072 6571 7569 7265 7320  nction requires 
+0001f120: 7468 6520 220a 2020 2020 2020 2020 2020  the ".          
+0001f130: 2020 276d 6f64 756c 6520 2272 6563 7470    'module "rectp
+0001f140: 6163 6b22 2074 6f20 6f70 6572 6174 652e  ack" to operate.
+0001f150: 2020 506c 6561 7365 2072 6574 7279 2027    Please retry '
+0001f160: 0a20 2020 2020 2020 2020 2020 2022 6166  .            "af
+0001f170: 7465 7220 696e 7374 616c 6c69 6e67 2072  ter installing r
+0001f180: 6563 7470 6163 6b3a 5c6e 5c6e 220a 2020  ectpack:\n\n".  
+0001f190: 2020 2020 2020 2020 2020 2224 2070 6970            "$ pip
+0001f1a0: 2069 6e73 7461 6c6c 2072 6563 7470 6163   install rectpac
+0001f1b0: 6b22 0a20 2020 2020 2020 2029 0a0a 2020  k".        )..  
+0001f1c0: 2020 2320 436f 6d70 7574 6520 746f 7461    # Compute tota
+0001f1d0: 6c20 6172 6561 2061 6e64 2075 7365 2069  l area and use i
+0001f1e0: 7420 666f 7220 616e 2069 6e69 7469 616c  t for an initial
+0001f1f0: 2065 7374 696d 6174 6520 6f66 2074 6865   estimate of the
+0001f200: 2062 696e 2073 697a 650a 2020 2020 746f   bin size.    to
+0001f210: 7461 6c5f 6172 6561 203d 2030 0a20 2020  tal_area = 0.   
+0001f220: 2066 6f72 2072 2069 6e20 7265 6374 5f64   for r in rect_d
+0001f230: 6963 742e 7661 6c75 6573 2829 3a0a 2020  ict.values():.  
+0001f240: 2020 2020 2020 746f 7461 6c5f 6172 6561        total_area
+0001f250: 202b 3d20 725b 305d 202a 2072 5b31 5d0a   += r[0] * r[1].
+0001f260: 2020 2020 2320 4e6f 726d 616c 697a 650a      # Normalize.
+0001f270: 2020 2020 6173 7065 6374 5f72 6174 696f      aspect_ratio
+0001f280: 203d 206e 702e 6173 6172 7261 7928 6173   = np.asarray(as
+0001f290: 7065 6374 5f72 6174 696f 2920 2f20 6e70  pect_ratio) / np
+0001f2a0: 2e6c 696e 616c 672e 6e6f 726d 2861 7370  .linalg.norm(asp
+0001f2b0: 6563 745f 7261 7469 6f29 0a0a 2020 2020  ect_ratio)..    
+0001f2c0: 2320 5365 7475 7020 7661 7269 6162 6c65  # Setup variable
+0001f2d0: 730a 2020 2020 626f 785f 7369 7a65 203d  s.    box_size =
+0001f2e0: 206e 702e 6173 6172 7261 7928 6173 7065   np.asarray(aspe
+0001f2f0: 6374 5f72 6174 696f 202a 206e 702e 7371  ct_ratio * np.sq
+0001f300: 7274 2874 6f74 616c 5f61 7265 6129 2c20  rt(total_area), 
+0001f310: 6474 7970 653d 6e70 2e66 6c6f 6174 3634  dtype=np.float64
+0001f320: 290a 2020 2020 626f 785f 7369 7a65 203d  ).    box_size =
+0001f330: 206e 702e 636c 6970 2862 6f78 5f73 697a   np.clip(box_siz
+0001f340: 652c 204e 6f6e 652c 206d 6178 5f73 697a  e, None, max_siz
+0001f350: 6529 0a20 2020 2069 6620 736f 7274 5f62  e).    if sort_b
+0001f360: 795f 6172 6561 3a0a 2020 2020 2020 2020  y_area:.        
+0001f370: 7270 5f73 6f72 7420 3d20 7265 6374 7061  rp_sort = rectpa
+0001f380: 636b 2e53 4f52 545f 4152 4541 0a20 2020  ck.SORT_AREA.   
+0001f390: 2065 6c73 653a 0a20 2020 2020 2020 2072   else:.        r
+0001f3a0: 705f 736f 7274 203d 2072 6563 7470 6163  p_sort = rectpac
+0001f3b0: 6b2e 534f 5254 5f4e 4f4e 450a 0a20 2020  k.SORT_NONE..   
+0001f3c0: 2023 2052 6570 6561 7465 646c 7920 7275   # Repeatedly ru
+0001f3d0: 6e20 7468 6520 7265 6374 616e 676c 652d  n the rectangle-
+0001f3e0: 7061 636b 696e 6720 616c 676f 7269 7468  packing algorith
+0001f3f0: 6d20 7769 7468 2069 6e63 7265 6173 696e  m with increasin
+0001f400: 676c 7920 6c61 7267 6572 0a20 2020 2023  gly larger.    #
+0001f410: 2061 7265 6173 2075 6e74 696c 2065 7665   areas until eve
+0001f420: 7279 7468 696e 6720 6669 7473 206f 7220  rything fits or 
+0001f430: 7765 2776 6520 7265 6163 6865 6420 7468  we've reached th
+0001f440: 6520 6d61 7869 6d75 6d20 7369 7a65 0a20  e maximum size. 
+0001f450: 2020 2077 6869 6c65 2054 7275 653a 0a20     while True:. 
+0001f460: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
+0001f470: 7468 6520 7061 636b 6572 206f 626a 6563  the packer objec
+0001f480: 740a 2020 2020 2020 2020 7265 6374 5f70  t.        rect_p
+0001f490: 6163 6b65 7220 3d20 7265 6374 7061 636b  acker = rectpack
+0001f4a0: 2e6e 6577 5061 636b 6572 280a 2020 2020  .newPacker(.    
+0001f4b0: 2020 2020 2020 2020 6d6f 6465 3d72 6563          mode=rec
+0001f4c0: 7470 6163 6b2e 5061 636b 696e 674d 6f64  tpack.PackingMod
+0001f4d0: 652e 4f66 666c 696e 652c 0a20 2020 2020  e.Offline,.     
+0001f4e0: 2020 2020 2020 2070 6163 6b5f 616c 676f         pack_algo
+0001f4f0: 3d72 6563 7470 6163 6b2e 4d61 7852 6563  =rectpack.MaxRec
+0001f500: 7473 426c 7366 2c0a 2020 2020 2020 2020  tsBlsf,.        
+0001f510: 2020 2020 736f 7274 5f61 6c67 6f3d 7270      sort_algo=rp
+0001f520: 5f73 6f72 742c 0a20 2020 2020 2020 2020  _sort,.         
+0001f530: 2020 2062 696e 5f61 6c67 6f3d 7265 6374     bin_algo=rect
+0001f540: 7061 636b 2e50 6163 6b69 6e67 4269 6e2e  pack.PackingBin.
+0001f550: 4242 462c 0a20 2020 2020 2020 2020 2020  BBF,.           
+0001f560: 2072 6f74 6174 696f 6e3d 4661 6c73 652c   rotation=False,
+0001f570: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0001f580: 2020 2020 2320 4164 6420 6561 6368 2072      # Add each r
+0001f590: 6563 7461 6e67 6c65 2074 6f20 7468 6520  ectangle to the 
+0001f5a0: 7061 636b 6572 2c20 6372 6561 7465 2061  packer, create a
+0001f5b0: 2073 696e 676c 6520 6269 6e2c 2061 6e64   single bin, and
+0001f5c0: 2070 6163 6b0a 2020 2020 2020 2020 666f   pack.        fo
+0001f5d0: 7220 7269 642c 2072 2069 6e20 7265 6374  r rid, r in rect
+0001f5e0: 5f64 6963 742e 6974 656d 7328 293a 0a20  _dict.items():. 
+0001f5f0: 2020 2020 2020 2020 2020 2072 6563 745f             rect_
+0001f600: 7061 636b 6572 2e61 6464 5f72 6563 7428  packer.add_rect(
+0001f610: 7769 6474 683d 725b 305d 2c20 6865 6967  width=r[0], heig
+0001f620: 6874 3d72 5b31 5d2c 2072 6964 3d72 6964  ht=r[1], rid=rid
+0001f630: 290a 2020 2020 2020 2020 7265 6374 5f70  ).        rect_p
+0001f640: 6163 6b65 722e 6164 645f 6269 6e28 7769  acker.add_bin(wi
+0001f650: 6474 683d 626f 785f 7369 7a65 5b30 5d2c  dth=box_size[0],
+0001f660: 2068 6569 6768 743d 626f 785f 7369 7a65   height=box_size
+0001f670: 5b31 5d29 0a20 2020 2020 2020 2072 6563  [1]).        rec
+0001f680: 745f 7061 636b 6572 2e70 6163 6b28 290a  t_packer.pack().
+0001f690: 0a20 2020 2020 2020 2023 2041 646a 7573  .        # Adjus
+0001f6a0: 7420 7468 6520 626f 7820 7369 7a65 2066  t the box size f
+0001f6b0: 6f72 206e 6578 7420 7469 6d65 0a20 2020  or next time.   
+0001f6c0: 2020 2020 2062 6f78 5f73 697a 6520 2a3d       box_size *=
+0001f6d0: 2064 656e 7369 7479 2020 2320 496e 6372   density  # Incr
+0001f6e0: 6561 7365 2061 7265 6120 746f 2074 7279  ease area to try
+0001f6f0: 2074 6f20 6669 740a 2020 2020 2020 2020   to fit.        
+0001f700: 626f 785f 7369 7a65 203d 206e 702e 636c  box_size = np.cl
+0001f710: 6970 2862 6f78 5f73 697a 652c 204e 6f6e  ip(box_size, Non
+0001f720: 652c 206d 6178 5f73 697a 6529 0a20 2020  e, max_size).   
+0001f730: 2020 2020 2069 6620 7665 7262 6f73 653a       if verbose:
+0001f740: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0001f750: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+0001f760: 2020 2020 2254 7279 696e 6720 746f 2070      "Trying to p
+0001f770: 6163 6b20 696e 2062 696e 2073 697a 6520  ack in bin size 
+0001f780: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0001f790: 2020 2228 2530 2e32 662c 2025 302e 3266    "(%0.2f, %0.2f
+0001f7a0: 2922 2025 2074 7570 6c65 2862 6f78 5f73  )" % tuple(box_s
+0001f7b0: 697a 6520 2a20 7072 6563 6973 696f 6e29  ize * precision)
+0001f7c0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+0001f7d0: 2020 2020 2020 2020 2320 5175 6974 2074          # Quit t
+0001f7e0: 6865 206c 6f6f 7020 6966 2077 6527 7665  he loop if we've
+0001f7f0: 2070 6163 6b65 6420 616c 6c20 7468 6520   packed all the 
+0001f800: 7265 6374 616e 676c 6573 0a20 2020 2020  rectangles.     
+0001f810: 2020 2023 206f 7220 7265 6163 6865 6420     # or reached 
+0001f820: 7468 6520 6d61 7820 7369 7a65 0a20 2020  the max size.   
+0001f830: 2020 2020 2069 6620 6c65 6e28 7265 6374       if len(rect
+0001f840: 5f70 6163 6b65 722e 7265 6374 5f6c 6973  _packer.rect_lis
+0001f850: 7428 2929 203d 3d20 6c65 6e28 7265 6374  t()) == len(rect
+0001f860: 5f64 6963 7429 3a0a 2020 2020 2020 2020  _dict):.        
+0001f870: 2020 2020 6966 2076 6572 626f 7365 3a0a      if verbose:.
+0001f880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f890: 7072 696e 7428 2253 7563 6365 7373 2122  print("Success!"
+0001f8a0: 290a 2020 2020 2020 2020 2020 2020 6272  ).            br
+0001f8b0: 6561 6b0a 2020 2020 2020 2020 656c 6966  eak.        elif
+0001f8c0: 2061 6c6c 2862 6f78 5f73 697a 6520 3e3d   all(box_size >=
+0001f8d0: 206d 6178 5f73 697a 6529 3a0a 2020 2020   max_size):.    
+0001f8e0: 2020 2020 2020 2020 6966 2076 6572 626f          if verbo
+0001f8f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001f900: 2020 2020 7072 696e 7428 2252 6561 6368      print("Reach
+0001f910: 6564 206d 6178 5f73 697a 652c 2063 7265  ed max_size, cre
+0001f920: 6174 696e 6720 2220 2261 6e20 6164 6469  ating " "an addi
+0001f930: 7469 6f6e 616c 2062 696e 2229 0a20 2020  tional bin").   
+0001f940: 2020 2020 2020 2020 2062 7265 616b 0a0a           break..
+0001f950: 2020 2020 2320 5365 7061 7261 7465 2070      # Separate p
+0001f960: 6163 6b65 6420 6672 6f6d 2075 6e70 6163  acked from unpac
+0001f970: 6b65 6420 7265 6374 616e 676c 6573 2c20  ked rectangles, 
+0001f980: 6d61 6b65 2064 6963 7473 206f 6620 666f  make dicts of fo
+0001f990: 726d 0a20 2020 2023 207b 6964 3a28 782c  rm.    # {id:(x,
+0001f9a0: 792c 772c 6829 7d0a 2020 2020 7061 636b  y,w,h)}.    pack
+0001f9b0: 6564 5f72 6563 745f 6469 6374 203d 207b  ed_rect_dict = {
+0001f9c0: 725b 2d31 5d3a 2072 5b3a 2d31 5d20 666f  r[-1]: r[:-1] fo
+0001f9d0: 7220 7220 696e 2072 6563 745f 7061 636b  r r in rect_pack
+0001f9e0: 6572 5b30 5d2e 7265 6374 5f6c 6973 7428  er[0].rect_list(
+0001f9f0: 297d 0a20 2020 2075 6e70 6163 6b65 645f  )}.    unpacked_
+0001fa00: 7265 6374 5f64 6963 7420 3d20 7b7d 0a20  rect_dict = {}. 
+0001fa10: 2020 2066 6f72 206b 2c20 7620 696e 2072     for k, v in r
+0001fa20: 6563 745f 6469 6374 2e69 7465 6d73 2829  ect_dict.items()
+0001fa30: 3a0a 2020 2020 2020 2020 6966 206b 206e  :.        if k n
+0001fa40: 6f74 2069 6e20 7061 636b 6564 5f72 6563  ot in packed_rec
+0001fa50: 745f 6469 6374 3a0a 2020 2020 2020 2020  t_dict:.        
+0001fa60: 2020 2020 756e 7061 636b 6564 5f72 6563      unpacked_rec
+0001fa70: 745f 6469 6374 5b6b 5d20 3d20 760a 0a20  t_dict[k] = v.. 
+0001fa80: 2020 2072 6574 7572 6e20 2870 6163 6b65     return (packe
+0001fa90: 645f 7265 6374 5f64 6963 742c 2075 6e70  d_rect_dict, unp
+0001faa0: 6163 6b65 645f 7265 6374 5f64 6963 7429  acked_rect_dict)
+0001fab0: 0a0a 0a64 6566 2070 6163 6b65 7228 0a20  ...def packer(. 
+0001fac0: 2020 2044 5f6c 6973 742c 0a20 2020 2073     D_list,.    s
+0001fad0: 7061 6369 6e67 3d31 302c 0a20 2020 2061  pacing=10,.    a
+0001fae0: 7370 6563 745f 7261 7469 6f3d 2831 2c20  spect_ratio=(1, 
+0001faf0: 3129 2c0a 2020 2020 6d61 785f 7369 7a65  1),.    max_size
+0001fb00: 3d28 4e6f 6e65 2c20 4e6f 6e65 292c 0a20  =(None, None),. 
+0001fb10: 2020 2073 6f72 745f 6279 5f61 7265 613d     sort_by_area=
+0001fb20: 5472 7565 2c0a 2020 2020 6465 6e73 6974  True,.    densit
+0001fb30: 793d 312e 312c 0a20 2020 2070 7265 6369  y=1.1,.    preci
+0001fb40: 7369 6f6e 3d31 652d 322c 0a20 2020 2076  sion=1e-2,.    v
+0001fb50: 6572 626f 7365 3d46 616c 7365 2c0a 293a  erbose=False,.):
+0001fb60: 0a20 2020 2022 2222 5061 636b 7320 6765  .    """Packs ge
+0001fb70: 6f6d 6574 7269 6573 2074 6f67 6574 6865  ometries togethe
+0001fb80: 7220 696e 746f 2072 6563 7461 6e67 756c  r into rectangul
+0001fb90: 6172 2062 696e 732e 0a0a 2020 2020 5061  ar bins...    Pa
+0001fba0: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
+0001fbb0: 2d2d 2d2d 2d2d 2d0a 2020 2020 445f 6c69  -------.    D_li
+0001fbc0: 7374 203a 2061 7272 6179 2d6c 696b 6520  st : array-like 
+0001fbd0: 6f66 2044 6576 6963 6573 0a20 2020 2020  of Devices.     
+0001fbe0: 2020 2049 6e70 7574 2044 6576 6963 6573     Input Devices
+0001fbf0: 2074 6f20 6265 2070 6163 6b65 642e 0a20   to be packed.. 
+0001fc00: 2020 2073 7061 6369 6e67 203a 2069 6e74     spacing : int
+0001fc10: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
+0001fc20: 2020 5468 6520 6d69 6e69 6d75 6d20 6469    The minimum di
+0001fc30: 7374 616e 6365 2062 6574 7765 656e 2061  stance between a
+0001fc40: 646a 6163 656e 7420 7368 6170 6573 2e0a  djacent shapes..
+0001fc50: 2020 2020 6173 7065 6374 5f72 6174 696f      aspect_ratio
+0001fc60: 203a 2061 7272 6179 2d6c 696b 650a 2020   : array-like.  
+0001fc70: 2020 2020 2020 5468 6520 2877 6964 7468        The (width
+0001fc80: 2c20 6865 6967 6874 2920 7261 7469 6f20  , height) ratio 
+0001fc90: 6f66 2074 6865 2072 6563 7461 6e67 756c  of the rectangul
+0001fca0: 6172 2062 696e 2e0a 2020 2020 6d61 785f  ar bin..    max_
+0001fcb0: 7369 7a65 203a 2061 7272 6179 2d6c 696b  size : array-lik
+0001fcc0: 650a 2020 2020 2020 2020 4c69 6d69 7473  e.        Limits
+0001fcd0: 2074 6865 2073 697a 6520 696e 746f 2077   the size into w
+0001fce0: 6869 6368 2074 6865 2073 6861 7065 7320  hich the shapes 
+0001fcf0: 7769 6c6c 2062 6520 7061 636b 6564 2e0a  will be packed..
+0001fd00: 2020 2020 736f 7274 5f62 795f 6172 6561      sort_by_area
+0001fd10: 203a 2062 6f6f 6c0a 2020 2020 2020 2020   : bool.        
+0001fd20: 4966 2074 7275 652c 2070 7265 2d73 6f72  If true, pre-sor
+0001fd30: 7473 2074 6865 2073 6861 7065 7320 6279  ts the shapes by
+0001fd40: 2061 7265 612e 0a20 2020 2064 656e 7369   area..    densi
+0001fd50: 7479 203a 2069 6e74 206f 7220 666c 6f61  ty : int or floa
+0001fd60: 740a 2020 2020 2020 2020 4465 6e73 6974  t.        Densit
+0001fd70: 7920 6f66 2070 6163 6b69 6e67 2e20 5661  y of packing. Va
+0001fd80: 6c75 6573 2063 6c6f 7365 7220 746f 2031  lues closer to 1
+0001fd90: 2070 6163 6b20 7469 6768 7465 7220 6275   pack tighter bu
+0001fda0: 7420 7265 7175 6972 6520 6d6f 7265 0a20  t require more. 
+0001fdb0: 2020 2020 2020 2063 6f6d 7075 7461 7469         computati
+0001fdc0: 6f6e 2e0a 2020 2020 7072 6563 6973 696f  on..    precisio
+0001fdd0: 6e20 3a20 666c 6f61 740a 2020 2020 2020  n : float.      
+0001fde0: 2020 4465 7369 7265 6420 7072 6563 6973    Desired precis
+0001fdf0: 696f 6e20 666f 7220 726f 756e 6469 6e67  ion for rounding
+0001fe00: 2076 6572 7465 7820 636f 6f72 6469 6e61   vertex coordina
+0001fe10: 7465 732e 0a20 2020 2076 6572 626f 7365  tes..    verbose
+0001fe20: 203a 2062 6f6f 6c0a 2020 2020 2020 2020   : bool.        
+0001fe30: 5768 6574 6865 7220 746f 2064 6973 706c  Whether to displ
+0001fe40: 6179 2072 6573 756c 7473 206f 6620 7061  ay results of pa
+0001fe50: 636b 696e 6720 6174 7465 6d70 7473 0a0a  cking attempts..
+0001fe60: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
+0001fe70: 202d 2d2d 2d2d 2d2d 0a20 2020 2044 5f70   -------.    D_p
+0001fe80: 6163 6b65 645f 6c69 7374 203a 2044 6576  acked_list : Dev
+0001fe90: 6963 6520 6f72 206c 6973 7420 6f66 2044  ice or list of D
+0001fea0: 6576 6963 6573 0a20 2020 2020 2020 2041  evices.        A
+0001feb0: 2044 6576 6963 6520 6f72 206c 6973 7420   Device or list 
+0001fec0: 6f66 2044 6576 6963 6573 2063 6f6e 7461  of Devices conta
+0001fed0: 696e 696e 6720 616c 6c20 7468 6520 7061  ining all the pa
+0001fee0: 636b 6564 2072 6563 7461 6e67 756c 6172  cked rectangular
+0001fef0: 0a20 2020 2020 2020 2062 696e 7320 6765  .        bins ge
+0001ff00: 6e65 7261 7465 642e 0a0a 2020 2020 4e6f  nerated...    No
+0001ff10: 7465 730a 2020 2020 2d2d 2d2d 2d0a 2020  tes.    -----.  
+0001ff20: 2020 4966 2061 206d 6178 2d73 697a 6520    If a max-size 
+0001ff30: 6973 2073 7065 6369 6669 6564 2c20 7468  is specified, th
+0001ff40: 6520 6675 6e63 7469 6f6e 2077 696c 6c20  e function will 
+0001ff50: 6372 6561 7465 2061 7320 6d61 6e79 2062  create as many b
+0001ff60: 696e 7320 6173 0a20 2020 206e 6563 6573  ins as.    neces
+0001ff70: 7361 7279 2074 6f20 7061 636b 2061 6c6c  sary to pack all
+0001ff80: 2074 6865 2067 656f 6d65 7472 6965 7320   the geometries 
+0001ff90: 616e 6420 7468 656e 2072 6574 7572 6e20  and then return 
+0001ffa0: 6120 6c69 7374 206f 6620 7468 650a 2020  a list of the.  
+0001ffb0: 2020 6669 6c6c 6564 2d62 696e 2044 6576    filled-bin Dev
+0001ffc0: 6963 6573 2e0a 2020 2020 2222 220a 2020  ices..    """.  
+0001ffd0: 2020 6966 2064 656e 7369 7479 203c 2031    if density < 1
+0001ffe0: 2e30 313a 0a20 2020 2020 2020 2072 6169  .01:.        rai
+0001fff0: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+00020000: 2020 2020 2020 2020 2020 2022 5b50 4849             "[PHI
+00020010: 444c 5d20 7061 636b 6572 2829 2077 6173  DL] packer() was
+00020020: 2067 6976 656e 2061 2060 6465 6e73 6974   given a `densit
+00020030: 7960 2061 7267 756d 656e 7420 220a 2020  y` argument ".  
+00020040: 2020 2020 2020 2020 2020 2274 6861 7420            "that 
+00020050: 6973 2074 6f6f 2073 6d61 6c6c 2e20 2054  is too small.  T
+00020060: 6865 2064 656e 7369 7479 2061 7267 756d  he density argum
+00020070: 656e 7420 6d75 7374 2062 6520 220a 2020  ent must be ".  
+00020080: 2020 2020 2020 2020 2020 223e 3d20 312e            ">= 1.
+00020090: 3031 220a 2020 2020 2020 2020 290a 0a20  01".        ).. 
+000200a0: 2020 2023 2053 616e 7469 7a65 206d 6178     # Santize max
+000200b0: 5f73 697a 6520 7661 7269 6162 6c65 0a20  _size variable. 
+000200c0: 2020 206d 6178 5f73 697a 6520 3d20 5b6e     max_size = [n
+000200d0: 702e 696e 6620 6966 2076 2069 7320 4e6f  p.inf if v is No
+000200e0: 6e65 2065 6c73 6520 7620 666f 7220 7620  ne else v for v 
+000200f0: 696e 206d 6178 5f73 697a 655d 0a20 2020  in max_size].   
+00020100: 206d 6178 5f73 697a 6520 3d20 6e70 2e61   max_size = np.a
+00020110: 7361 7272 6179 286d 6178 5f73 697a 652c  sarray(max_size,
+00020120: 2064 7479 7065 3d6e 702e 666c 6f61 7436   dtype=np.float6
+00020130: 3429 2020 2320 496e 2063 6173 6520 6974  4)  # In case it
+00020140: 2773 2069 6e74 6567 6572 730a 2020 2020  's integers.    
+00020150: 6d61 785f 7369 7a65 203d 206d 6178 5f73  max_size = max_s
+00020160: 697a 6520 2f20 7072 6563 6973 696f 6e0a  ize / precision.
+00020170: 0a20 2020 2023 2043 6f6e 7665 7274 2044  .    # Convert D
+00020180: 6576 6963 6573 2074 6f20 7265 6374 616e  evices to rectan
+00020190: 676c 6573 0a20 2020 2072 6563 745f 6469  gles.    rect_di
+000201a0: 6374 203d 207b 7d0a 2020 2020 666f 7220  ct = {}.    for 
+000201b0: 6e2c 2044 2069 6e20 656e 756d 6572 6174  n, D in enumerat
+000201c0: 6528 445f 6c69 7374 293a 0a20 2020 2020  e(D_list):.     
+000201d0: 2020 2077 2c20 6820 3d20 2844 2e73 697a     w, h = (D.siz
+000201e0: 6520 2b20 7370 6163 696e 6729 202f 2070  e + spacing) / p
+000201f0: 7265 6369 7369 6f6e 0a20 2020 2020 2020  recision.       
+00020200: 2077 2c20 6820 3d20 696e 7428 7729 2c20   w, h = int(w), 
+00020210: 696e 7428 6829 0a20 2020 2020 2020 2069  int(h).        i
+00020220: 6620 2877 203e 206d 6178 5f73 697a 655b  f (w > max_size[
+00020230: 305d 2920 6f72 2028 6820 3e20 6d61 785f  0]) or (h > max_
+00020240: 7369 7a65 5b31 5d29 3a0a 2020 2020 2020  size[1]):.      
+00020250: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00020260: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00020270: 2020 2020 2020 2020 225b 5048 4944 4c5d          "[PHIDL]
+00020280: 2070 6163 6b65 7228 2920 6661 696c 6564   packer() failed
+00020290: 2062 6563 6175 7365 206f 6e65 206f 6620   because one of 
+000202a0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+000202b0: 2020 2274 6865 206f 626a 6563 7473 2069    "the objects i
+000202c0: 6e20 6044 5f6c 6973 7460 2069 7320 6861  n `D_list` is ha
+000202d0: 7320 616e 2078 206f 7220 220a 2020 2020  s an x or ".    
+000202e0: 2020 2020 2020 2020 2020 2020 2279 2064              "y d
+000202f0: 696d 656e 7369 6f6e 206c 6172 6765 7220  imension larger 
+00020300: 7468 616e 2060 6d61 785f 7369 7a65 6020  than `max_size` 
+00020310: 616e 6420 220a 2020 2020 2020 2020 2020  and ".          
+00020320: 2020 2020 2020 2273 6f20 6361 6e6e 6f74        "so cannot
+00020330: 2062 6520 7061 636b 6564 220a 2020 2020   be packed".    
+00020340: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00020350: 2020 7265 6374 5f64 6963 745b 6e5d 203d    rect_dict[n] =
+00020360: 2028 772c 2068 290a 0a20 2020 2070 6163   (w, h)..    pac
+00020370: 6b65 645f 6c69 7374 203d 205b 5d0a 2020  ked_list = [].  
+00020380: 2020 7768 696c 6520 6c65 6e28 7265 6374    while len(rect
+00020390: 5f64 6963 7429 203e 2030 3a0a 2020 2020  _dict) > 0:.    
+000203a0: 2020 2020 2870 6163 6b65 645f 7265 6374      (packed_rect
+000203b0: 5f64 6963 742c 2072 6563 745f 6469 6374  _dict, rect_dict
+000203c0: 2920 3d20 5f70 6163 6b5f 7369 6e67 6c65  ) = _pack_single
+000203d0: 5f62 696e 280a 2020 2020 2020 2020 2020  _bin(.          
+000203e0: 2020 7265 6374 5f64 6963 742c 0a20 2020    rect_dict,.   
+000203f0: 2020 2020 2020 2020 2061 7370 6563 745f           aspect_
+00020400: 7261 7469 6f3d 6173 7065 6374 5f72 6174  ratio=aspect_rat
+00020410: 696f 2c0a 2020 2020 2020 2020 2020 2020  io,.            
+00020420: 6d61 785f 7369 7a65 3d6d 6178 5f73 697a  max_size=max_siz
+00020430: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
+00020440: 6f72 745f 6279 5f61 7265 613d 736f 7274  ort_by_area=sort
+00020450: 5f62 795f 6172 6561 2c0a 2020 2020 2020  _by_area,.      
+00020460: 2020 2020 2020 6465 6e73 6974 793d 6465        density=de
+00020470: 6e73 6974 792c 0a20 2020 2020 2020 2020  nsity,.         
+00020480: 2020 2070 7265 6369 7369 6f6e 3d70 7265     precision=pre
+00020490: 6369 7369 6f6e 2c0a 2020 2020 2020 2020  cision,.        
+000204a0: 2020 2020 7665 7262 6f73 653d 7665 7262      verbose=verb
+000204b0: 6f73 652c 0a20 2020 2020 2020 2029 0a20  ose,.        ). 
+000204c0: 2020 2020 2020 2070 6163 6b65 645f 6c69         packed_li
+000204d0: 7374 2e61 7070 656e 6428 7061 636b 6564  st.append(packed
+000204e0: 5f72 6563 745f 6469 6374 290a 0a20 2020  _rect_dict)..   
+000204f0: 2044 5f70 6163 6b65 645f 6c69 7374 203d   D_packed_list =
+00020500: 205b 5d0a 2020 2020 666f 7220 7265 6374   [].    for rect
+00020510: 5f64 6963 7420 696e 2070 6163 6b65 645f  _dict in packed_
+00020520: 6c69 7374 3a0a 2020 2020 2020 2020 445f  list:.        D_
+00020530: 7061 636b 6564 203d 2044 6576 6963 6528  packed = Device(
+00020540: 290a 2020 2020 2020 2020 666f 7220 6e2c  ).        for n,
+00020550: 2072 6563 7420 696e 2072 6563 745f 6469   rect in rect_di
+00020560: 6374 2e69 7465 6d73 2829 3a0a 2020 2020  ct.items():.    
+00020570: 2020 2020 2020 2020 782c 2079 2c20 772c          x, y, w,
+00020580: 2068 203d 2072 6563 740a 2020 2020 2020   h = rect.      
+00020590: 2020 2020 2020 7863 656e 7465 7220 3d20        xcenter = 
+000205a0: 7820 2b20 7720 2f20 3220 2b20 7370 6163  x + w / 2 + spac
+000205b0: 696e 6720 2f20 320a 2020 2020 2020 2020  ing / 2.        
+000205c0: 2020 2020 7963 656e 7465 7220 3d20 7920      ycenter = y 
+000205d0: 2b20 6820 2f20 3220 2b20 7370 6163 696e  + h / 2 + spacin
+000205e0: 6720 2f20 320a 2020 2020 2020 2020 2020  g / 2.          
+000205f0: 2020 6420 3d20 445f 7061 636b 6564 2e61    d = D_packed.a
+00020600: 6464 5f72 6566 2844 5f6c 6973 745b 6e5d  dd_ref(D_list[n]
+00020610: 290a 2020 2020 2020 2020 2020 2020 642e  ).            d.
+00020620: 6365 6e74 6572 203d 2028 7863 656e 7465  center = (xcente
+00020630: 7220 2a20 7072 6563 6973 696f 6e2c 2079  r * precision, y
+00020640: 6365 6e74 6572 202a 2070 7265 6369 7369  center * precisi
+00020650: 6f6e 290a 2020 2020 2020 2020 445f 7061  on).        D_pa
+00020660: 636b 6564 5f6c 6973 742e 6170 7065 6e64  cked_list.append
+00020670: 2844 5f70 6163 6b65 6429 0a0a 2020 2020  (D_packed)..    
+00020680: 7265 7475 726e 2044 5f70 6163 6b65 645f  return D_packed_
+00020690: 6c69 7374 0a0a 0a64 6566 205f 7261 7374  list...def _rast
+000206a0: 6572 697a 655f 706f 6c79 676f 6e73 2870  erize_polygons(p
+000206b0: 6f6c 7967 6f6e 732c 2062 6f75 6e64 733d  olygons, bounds=
+000206c0: 5b5b 2d31 3030 2c20 2d31 3030 5d2c 205b  [[-100, -100], [
+000206d0: 3130 302c 2031 3030 5d5d 2c20 6478 3d31  100, 100]], dx=1
+000206e0: 2c20 6479 3d31 293a 0a20 2020 2022 2222  , dy=1):.    """
+000206f0: 436f 6e76 6572 7473 2070 6f6c 7967 6f6e  Converts polygon
+00020700: 7320 746f 2061 2062 6c61 636b 2f77 6869  s to a black/whi
+00020710: 7465 2028 312f 3029 206d 6174 7269 7822  te (1/0) matrix"
+00020720: 2222 0a20 2020 2074 7279 3a0a 2020 2020  "".    try:.    
+00020730: 2020 2020 6672 6f6d 2073 6b69 6d61 6765      from skimage
+00020740: 2069 6d70 6f72 7420 6472 6177 0a20 2020   import draw.   
+00020750: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00020760: 6e3a 0a20 2020 2020 2020 2072 6169 7365  n:.        raise
+00020770: 2049 6d70 6f72 7445 7272 6f72 280a 2020   ImportError(.  
+00020780: 2020 2020 2020 2020 2020 2254 6865 2066            "The f
+00020790: 696c 6c20 6675 6e63 7469 6f6e 2072 6571  ill function req
+000207a0: 7569 7265 7320 7468 6520 6d6f 6475 6c65  uires the module
+000207b0: 2022 0a20 2020 2020 2020 2020 2020 2027   ".            '
+000207c0: 2273 6369 6b69 742d 696d 6167 6522 2074  "scikit-image" t
+000207d0: 6f20 6f70 6572 6174 652e 2020 506c 6561  o operate.  Plea
+000207e0: 7365 2072 6574 7279 2027 0a20 2020 2020  se retry '.     
+000207f0: 2020 2020 2020 2022 6166 7465 7220 696e         "after in
+00020800: 7374 616c 6c69 6e67 2073 6369 6b69 742d  stalling scikit-
+00020810: 696d 6167 653a 5c6e 5c6e 220a 2020 2020  image:\n\n".    
+00020820: 2020 2020 2020 2020 2224 2070 6970 2069          "$ pip i
+00020830: 6e73 7461 6c6c 202d 2d75 7067 7261 6465  nstall --upgrade
+00020840: 2073 6369 6b69 742d 696d 6167 6522 0a20   scikit-image". 
+00020850: 2020 2020 2020 2029 0a0a 2020 2020 2320         )..    # 
+00020860: 5072 6570 6172 6520 706f 6c79 676f 6e20  Prepare polygon 
+00020870: 6172 7261 7920 6279 2073 6869 6674 696e  array by shiftin
+00020880: 6720 616c 6c20 706f 696e 7473 2069 6e74  g all points int
+00020890: 6f20 7468 6520 6669 7273 7420 7175 6164  o the first quad
+000208a0: 7261 6e74 2061 6e64 0a20 2020 2023 2073  rant and.    # s
+000208b0: 6570 6172 6174 696e 6720 706f 696e 7473  eparating points
+000208c0: 2069 6e74 6f20 7820 616e 6420 7920 6c69   into x and y li
+000208d0: 7374 730a 2020 2020 7870 7473 203d 205b  sts.    xpts = [
+000208e0: 5d0a 2020 2020 7970 7473 203d 205b 5d0a  ].    ypts = [].
+000208f0: 2020 2020 666f 7220 7020 696e 2070 6f6c      for p in pol
+00020900: 7967 6f6e 733a 0a20 2020 2020 2020 2070  ygons:.        p
+00020910: 5f61 7272 6179 203d 206e 702e 6173 6172  _array = np.asar
+00020920: 7261 7928 7029 0a20 2020 2020 2020 2078  ray(p).        x
+00020930: 203d 2070 5f61 7272 6179 5b3a 2c20 305d   = p_array[:, 0]
+00020940: 0a20 2020 2020 2020 2079 203d 2070 5f61  .        y = p_a
+00020950: 7272 6179 5b3a 2c20 315d 0a20 2020 2020  rray[:, 1].     
+00020960: 2020 2078 7074 732e 6170 7065 6e64 2828     xpts.append((
+00020970: 7820 2d20 626f 756e 6473 5b30 5d5b 305d  x - bounds[0][0]
+00020980: 2920 2f20 6478 202d 2030 2e35 290a 2020  ) / dx - 0.5).  
+00020990: 2020 2020 2020 7970 7473 2e61 7070 656e        ypts.appen
+000209a0: 6428 2879 202d 2062 6f75 6e64 735b 305d  d((y - bounds[0]
+000209b0: 5b31 5d29 202f 2064 7920 2d20 302e 3529  [1]) / dy - 0.5)
+000209c0: 0a0a 2020 2020 2320 496e 6974 6961 6c69  ..    # Initiali
+000209d0: 7a65 2074 6865 2072 6173 7465 7220 6d61  ze the raster ma
+000209e0: 7472 6978 2077 6527 6c6c 2062 6520 7772  trix we'll be wr
+000209f0: 6974 696e 6720 746f 0a20 2020 2078 7369  iting to.    xsi
+00020a00: 7a65 203d 2069 6e74 286e 702e 6365 696c  ze = int(np.ceil
+00020a10: 2862 6f75 6e64 735b 315d 5b30 5d20 2d20  (bounds[1][0] - 
+00020a20: 626f 756e 6473 5b30 5d5b 305d 2920 2f20  bounds[0][0]) / 
+00020a30: 6478 290a 2020 2020 7973 697a 6520 3d20  dx).    ysize = 
+00020a40: 696e 7428 6e70 2e63 6569 6c28 626f 756e  int(np.ceil(boun
+00020a50: 6473 5b31 5d5b 315d 202d 2062 6f75 6e64  ds[1][1] - bound
+00020a60: 735b 305d 5b31 5d29 202f 2064 7929 0a20  s[0][1]) / dy). 
+00020a70: 2020 2072 6173 7465 7220 3d20 6e70 2e7a     raster = np.z
+00020a80: 6572 6f73 2828 7973 697a 652c 2078 7369  eros((ysize, xsi
+00020a90: 7a65 292c 2064 7479 7065 3d62 6f6f 6c29  ze), dtype=bool)
+00020aa0: 0a0a 2020 2020 2320 544f 444f 3a20 5265  ..    # TODO: Re
+00020ab0: 706c 6163 6520 706f 6c79 676f 6e5f 7065  place polygon_pe
+00020ac0: 7269 6d65 7465 7220 7769 7468 2074 6865  rimeter with the
+00020ad0: 2073 7570 6572 636f 7665 7220 7665 7273   supercover vers
+00020ae0: 696f 6e0a 2020 2020 666f 7220 6e20 696e  ion.    for n in
+00020af0: 2072 616e 6765 286c 656e 2878 7074 7329   range(len(xpts)
+00020b00: 293a 0a20 2020 2020 2020 2072 722c 2063  ):.        rr, c
+00020b10: 6320 3d20 6472 6177 2e70 6f6c 7967 6f6e  c = draw.polygon
+00020b20: 2879 7074 735b 6e5d 2c20 7870 7473 5b6e  (ypts[n], xpts[n
+00020b30: 5d2c 2073 6861 7065 3d72 6173 7465 722e  ], shape=raster.
+00020b40: 7368 6170 6529 0a20 2020 2020 2020 2072  shape).        r
+00020b50: 7270 2c20 6363 7020 3d20 6472 6177 2e70  rp, ccp = draw.p
+00020b60: 6f6c 7967 6f6e 5f70 6572 696d 6574 6572  olygon_perimeter
+00020b70: 280a 2020 2020 2020 2020 2020 2020 7970  (.            yp
+00020b80: 7473 5b6e 5d2c 2078 7074 735b 6e5d 2c20  ts[n], xpts[n], 
+00020b90: 7368 6170 653d 7261 7374 6572 2e73 6861  shape=raster.sha
+00020ba0: 7065 2c20 636c 6970 3d46 616c 7365 0a20  pe, clip=False. 
+00020bb0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00020bc0: 2072 6173 7465 725b 7272 2c20 6363 5d20   raster[rr, cc] 
+00020bd0: 3d20 310a 2020 2020 2020 2020 7261 7374  = 1.        rast
+00020be0: 6572 5b72 7270 2c20 6363 705d 203d 2031  er[rrp, ccp] = 1
+00020bf0: 0a0a 2020 2020 7265 7475 726e 2072 6173  ..    return ras
+00020c00: 7465 720a 0a0a 6465 6620 5f72 6173 7465  ter...def _raste
+00020c10: 725f 696e 6465 785f 746f 5f63 6f6f 7264  r_index_to_coord
+00020c20: 7328 692c 206a 2c20 626f 756e 6473 3d5b  s(i, j, bounds=[
+00020c30: 5b2d 3130 302c 202d 3130 305d 2c20 5b31  [-100, -100], [1
+00020c40: 3030 2c20 3130 305d 5d2c 2064 783d 312c  00, 100]], dx=1,
+00020c50: 2064 793d 3129 3a0a 2020 2020 2222 2243   dy=1):.    """C
+00020c60: 6f6e 7665 7274 7320 2869 2c6a 2920 696e  onverts (i,j) in
+00020c70: 6465 7820 6f66 2072 6173 7465 7220 6d61  dex of raster ma
+00020c80: 7472 6978 2074 6f20 7265 616c 2063 6f6f  trix to real coo
+00020c90: 7264 696e 6174 6573 2222 220a 2020 2020  rdinates""".    
+00020ca0: 7820 3d20 286a 202b 2030 2e35 2920 2a20  x = (j + 0.5) * 
+00020cb0: 6478 202b 2062 6f75 6e64 735b 305d 5b30  dx + bounds[0][0
+00020cc0: 5d0a 2020 2020 7920 3d20 2869 202b 2030  ].    y = (i + 0
+00020cd0: 2e35 2920 2a20 6479 202b 2062 6f75 6e64  .5) * dy + bound
+00020ce0: 735b 305d 5b31 5d0a 2020 2020 7265 7475  s[0][1].    retu
+00020cf0: 726e 2078 2c20 790a 0a0a 6465 6620 5f65  rn x, y...def _e
+00020d00: 7870 616e 645f 7261 7374 6572 2872 6173  xpand_raster(ras
+00020d10: 7465 722c 2064 6973 7461 6e63 653d 2834  ter, distance=(4
+00020d20: 2c20 3229 293a 0a20 2020 2022 2222 4578  , 2)):.    """Ex
+00020d30: 7061 6e64 7320 616c 6c20 626c 6163 6b20  pands all black 
+00020d40: 2831 2920 7069 7865 6c73 2069 6e20 7468  (1) pixels in th
+00020d50: 6520 7261 7374 6572 2222 220a 2020 2020  e raster""".    
+00020d60: 7472 793a 0a20 2020 2020 2020 2066 726f  try:.        fro
+00020d70: 6d20 736b 696d 6167 6520 696d 706f 7274  m skimage import
+00020d80: 2064 7261 772c 206d 6f72 7068 6f6c 6f67   draw, morpholog
+00020d90: 790a 2020 2020 6578 6365 7074 2045 7863  y.    except Exc
+00020da0: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+00020db0: 7261 6973 6520 496d 706f 7274 4572 726f  raise ImportErro
+00020dc0: 7228 0a20 2020 2020 2020 2020 2020 2022  r(.            "
+00020dd0: 5468 6520 6669 6c6c 2066 756e 6374 696f  The fill functio
+00020de0: 6e20 7265 7175 6972 6573 2074 6865 206d  n requires the m
+00020df0: 6f64 756c 6520 220a 2020 2020 2020 2020  odule ".        
+00020e00: 2020 2020 2722 7363 696b 6974 2d69 6d61      '"scikit-ima
+00020e10: 6765 2220 746f 206f 7065 7261 7465 2e20  ge" to operate. 
+00020e20: 2050 6c65 6173 6520 7265 7472 7920 270a   Please retry '.
+00020e30: 2020 2020 2020 2020 2020 2020 2261 6674              "aft
+00020e40: 6572 2069 6e73 7461 6c6c 696e 6720 7363  er installing sc
+00020e50: 696b 6974 2d69 6d61 6765 3a5c 6e5c 6e22  ikit-image:\n\n"
+00020e60: 0a20 2020 2020 2020 2020 2020 2022 2420  .            "$ 
+00020e70: 7069 7020 696e 7374 616c 6c20 2d2d 7570  pip install --up
+00020e80: 6772 6164 6520 7363 696b 6974 2d69 6d61  grade scikit-ima
+00020e90: 6765 220a 2020 2020 2020 2020 290a 2020  ge".        ).  
+00020ea0: 2020 6966 2064 6973 7461 6e63 655b 305d    if distance[0]
+00020eb0: 203c 3d20 302e 3520 616e 6420 6469 7374   <= 0.5 and dist
+00020ec0: 616e 6365 5b31 5d20 3c3d 2030 2e35 3a0a  ance[1] <= 0.5:.
+00020ed0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00020ee0: 6173 7465 720a 0a20 2020 206e 756d 5f70  aster..    num_p
+00020ef0: 6978 656c 7320 3d20 6e70 2e61 7272 6179  ixels = np.array
+00020f00: 286e 702e 6365 696c 2864 6973 7461 6e63  (np.ceil(distanc
+00020f10: 6529 2c20 6474 7970 653d 696e 7429 0a20  e), dtype=int). 
+00020f20: 2020 206e 6569 6768 626f 7268 6f6f 6420     neighborhood 
+00020f30: 3d20 6e70 2e7a 6572 6f73 2828 6e75 6d5f  = np.zeros((num_
+00020f40: 7069 7865 6c73 5b31 5d20 2a20 3220 2b20  pixels[1] * 2 + 
+00020f50: 312c 206e 756d 5f70 6978 656c 735b 305d  1, num_pixels[0]
+00020f60: 202a 2032 202b 2031 292c 2064 7479 7065   * 2 + 1), dtype
+00020f70: 3d62 6f6f 6c29 0a20 2020 2072 722c 2063  =bool).    rr, c
+00020f80: 6320 3d20 6472 6177 2e65 6c6c 6970 7365  c = draw.ellipse
+00020f90: 280a 2020 2020 2020 2020 6e75 6d5f 7069  (.        num_pi
+00020fa0: 7865 6c73 5b31 5d2c 206e 756d 5f70 6978  xels[1], num_pix
+00020fb0: 656c 735b 305d 2c20 6469 7374 616e 6365  els[0], distance
+00020fc0: 5b31 5d20 2b20 302e 352c 2064 6973 7461  [1] + 0.5, dista
+00020fd0: 6e63 655b 305d 202b 2030 2e35 0a20 2020  nce[0] + 0.5.   
+00020fe0: 2029 0a20 2020 206e 6569 6768 626f 7268   ).    neighborh
+00020ff0: 6f6f 645b 7272 2c20 6363 5d20 3d20 310a  ood[rr, cc] = 1.
+00021000: 0a20 2020 2072 6574 7572 6e20 6d6f 7270  .    return morp
+00021010: 686f 6c6f 6779 2e62 696e 6172 795f 6469  hology.binary_di
+00021020: 6c61 7469 6f6e 2869 6d61 6765 3d72 6173  lation(image=ras
+00021030: 7465 722c 2066 6f6f 7470 7269 6e74 3d6e  ter, footprint=n
+00021040: 6569 6768 626f 7268 6f6f 6429 0a0a 0a64  eighborhood)...d
+00021050: 6566 205f 6669 6c6c 5f63 656c 6c5f 7265  ef _fill_cell_re
+00021060: 6374 616e 676c 6528 0a20 2020 2073 697a  ctangle(.    siz
+00021070: 653d 2832 302c 2032 3029 2c0a 2020 2020  e=(20, 20),.    
+00021080: 6c61 7965 7273 3d28 302c 2031 2c20 3329  layers=(0, 1, 3)
+00021090: 2c0a 2020 2020 6465 6e73 6974 6965 733d  ,.    densities=
+000210a0: 2830 2e35 2c20 302e 3235 2c20 302e 3729  (0.5, 0.25, 0.7)
+000210b0: 2c0a 2020 2020 696e 7665 7274 6564 3d28  ,.    inverted=(
+000210c0: 4661 6c73 652c 2046 616c 7365 2c20 4661  False, False, Fa
+000210d0: 6c73 6529 2c0a 293a 0a20 2020 2022 2222  lse),.):.    """
+000210e0: 4372 6561 7465 7320 6120 7369 6e67 6c65  Creates a single
+000210f0: 2044 6576 6963 6520 6f6e 206d 756c 7469   Device on multi
+00021100: 706c 6520 6c61 7965 7273 2074 6f20 6265  ple layers to be
+00021110: 2075 7365 6420 6173 2066 696c 6c0a 0a20   used as fill.. 
+00021120: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00021130: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00021140: 2073 697a 6520 3a20 6172 7261 792d 6c69   size : array-li
+00021150: 6b65 206f 6620 696e 7420 6f72 2066 6c6f  ke of int or flo
+00021160: 6174 0a20 2020 2020 2020 2078 2c20 7920  at.        x, y 
+00021170: 6469 6d65 6e73 696f 6e73 206f 6620 7468  dimensions of th
+00021180: 6520 6669 6c6c 2061 7265 6120 666f 7220  e fill area for 
+00021190: 616c 6c20 6c61 7965 7273 2e0a 2020 2020  all layers..    
+000211a0: 6c61 7965 7273 203a 2069 6e74 2c20 6172  layers : int, ar
+000211b0: 7261 792d 6c69 6b65 5b32 5d2c 206f 7220  ray-like[2], or 
+000211c0: 7365 740a 2020 2020 2020 2020 5370 6563  set.        Spec
+000211d0: 6966 6963 206c 6179 6572 2873 2920 746f  ific layer(s) to
+000211e0: 2070 7574 2066 696c 6c20 6365 6c6c 2072   put fill cell r
+000211f0: 6563 7461 6e67 6c65 2067 656f 6d65 7472  ectangle geometr
+00021200: 7920 6f6e 2e0a 2020 2020 6465 6e73 6974  y on..    densit
+00021210: 6965 7320 3a20 6172 7261 792d 6c69 6b65  ies : array-like
+00021220: 206f 6620 696e 7420 6f72 2066 6c6f 6174   of int or float
+00021230: 0a20 2020 2020 2020 2046 696c 6c20 6465  .        Fill de
+00021240: 6e73 6974 6965 7320 666f 7220 6561 6368  nsities for each
+00021250: 206c 6179 6572 2073 7065 6369 6669 6564   layer specified
+00021260: 2069 6e20 6060 6c61 7965 7273 6060 2e20   in ``layers``. 
+00021270: 4d75 7374 2062 6520 7468 6520 7361 6d65  Must be the same
+00021280: 0a20 2020 2020 2020 2073 697a 6520 6173  .        size as
+00021290: 2060 606c 6179 6572 7360 602e 0a20 2020   ``layers``..   
+000212a0: 2069 6e76 6572 7465 6420 3a20 6172 7261   inverted : arra
+000212b0: 792d 6c69 6b65 206f 7220 626f 6f6c 0a20  y-like or bool. 
+000212c0: 2020 2020 2020 2049 6620 7472 7565 2c20         If true, 
+000212d0: 696e 7665 7274 7320 7468 6520 6669 6c6c  inverts the fill
+000212e0: 2061 7265 6120 666f 7220 636f 7272 6573   area for corres
+000212f0: 706f 6e64 696e 6720 6c61 7965 722e 204d  ponding layer. M
+00021300: 7573 7420 6265 2074 6865 0a20 2020 2020  ust be the.     
+00021310: 2020 2073 616d 6520 7369 7a65 2061 7320     same size as 
+00021320: 6060 6c61 7965 7273 6060 2e0a 0a20 2020  ``layers``...   
+00021330: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
+00021340: 2d2d 2d2d 0a20 2020 2044 203a 2044 6576  ----.    D : Dev
+00021350: 6963 650a 2020 2020 2020 2020 4120 4465  ice.        A De
+00021360: 7669 6365 2063 6f6e 7461 696e 696e 6720  vice containing 
+00021370: 6669 6c6c 6564 2063 656c 6c20 7265 6374  filled cell rect
+00021380: 616e 676c 6573 2e0a 2020 2020 2222 220a  angles..    """.
+00021390: 2020 2020 4420 3d20 4465 7669 6365 2822      D = Device("
+000213a0: 6669 6c6c 6365 6c6c 2229 0a20 2020 2066  fillcell").    f
+000213b0: 6f72 206c 6179 6572 2c20 6465 6e73 6974  or layer, densit
+000213c0: 792c 2069 6e76 2069 6e20 7a69 7028 6c61  y, inv in zip(la
+000213d0: 7965 7273 2c20 6465 6e73 6974 6965 732c  yers, densities,
+000213e0: 2069 6e76 6572 7465 6429 3a0a 2020 2020   inverted):.    
+000213f0: 2020 2020 7265 6374 616e 676c 655f 7369      rectangle_si
+00021400: 7a65 203d 206e 702e 6172 7261 7928 7369  ze = np.array(si
+00021410: 7a65 2920 2a20 7371 7274 2864 656e 7369  ze) * sqrt(densi
+00021420: 7479 290a 2020 2020 2020 2020 2320 7220  ty).        # r 
+00021430: 3d20 442e 6164 645f 7265 6628 7265 6374  = D.add_ref(rect
+00021440: 616e 676c 6528 7369 7a65 203d 2072 6563  angle(size = rec
+00021450: 7461 6e67 6c65 5f73 697a 652c 206c 6179  tangle_size, lay
+00021460: 6572 203d 206c 6179 6572 2929 0a20 2020  er = layer)).   
+00021470: 2020 2020 2052 203d 2072 6563 7461 6e67       R = rectang
+00021480: 6c65 2873 697a 653d 7265 6374 616e 676c  le(size=rectangl
+00021490: 655f 7369 7a65 2c20 6c61 7965 723d 6c61  e_size, layer=la
+000214a0: 7965 7229 0a20 2020 2020 2020 2052 2e63  yer).        R.c
+000214b0: 656e 7465 7220 3d20 2830 2c20 3029 0a20  enter = (0, 0). 
+000214c0: 2020 2020 2020 2069 6620 696e 7620 6973         if inv is
+000214d0: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
+000214e0: 2020 2041 203d 2072 6563 7461 6e67 6c65     A = rectangle
+000214f0: 2873 697a 653d 7369 7a65 290a 2020 2020  (size=size).    
+00021500: 2020 2020 2020 2020 412e 6365 6e74 6572          A.center
+00021510: 203d 2028 302c 2030 290a 2020 2020 2020   = (0, 0).      
+00021520: 2020 2020 2020 4120 3d20 412e 6765 745f        A = A.get_
+00021530: 706f 6c79 676f 6e73 2829 0a20 2020 2020  polygons().     
+00021540: 2020 2020 2020 2042 203d 2052 2e67 6574         B = R.get
+00021550: 5f70 6f6c 7967 6f6e 7328 290a 2020 2020  _polygons().    
+00021560: 2020 2020 2020 2020 7020 3d20 6764 7370          p = gdsp
+00021570: 792e 626f 6f6c 6561 6e28 412c 2042 2c20  y.boolean(A, B, 
+00021580: 6f70 6572 6174 696f 6e3d 226e 6f74 2229  operation="not")
+00021590: 0a20 2020 2020 2020 2020 2020 2044 2e61  .            D.a
+000215a0: 6464 5f70 6f6c 7967 6f6e 2870 2c20 6c61  dd_polygon(p, la
+000215b0: 7965 723d 6c61 7965 7229 0a20 2020 2020  yer=layer).     
+000215c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000215d0: 2020 2020 2044 2e61 6464 5f72 6566 2852       D.add_ref(R
+000215e0: 290a 2020 2020 7265 7475 726e 2044 0a0a  ).    return D..
+000215f0: 0a64 6566 205f 6c6f 6f70 5f6f 7665 7228  .def _loop_over(
+00021600: 7661 7229 3a0a 2020 2020 2222 2243 6865  var):.    """Che
+00021610: 636b 7320 6966 2061 2076 6172 6961 626c  cks if a variabl
+00021620: 6520 6973 2069 6e20 7468 6520 666f 726d  e is in the form
+00021630: 206f 6620 616e 2069 7465 7261 626c 6520   of an iterable 
+00021640: 286c 6973 742f 7475 706c 6529 0a20 2020  (list/tuple).   
+00021650: 2061 6e64 2069 6620 6e6f 742c 2072 6574   and if not, ret
+00021660: 7572 6e73 2069 7420 6173 2061 206c 6973  urns it as a lis
+00021670: 742e 2020 5573 6566 756c 2066 6f72 2061  t.  Useful for a
+00021680: 6c6c 6f77 696e 6720 6172 6775 6d65 6e74  llowing argument
+00021690: 0a20 2020 2069 6e70 7574 7320 746f 2062  .    inputs to b
+000216a0: 6520 6569 7468 6572 206c 6973 7473 2028  e either lists (
+000216b0: 652e 672e 205b 312c 2033 2c20 345d 2920  e.g. [1, 3, 4]) 
+000216c0: 6f72 2073 696e 676c 652d 7661 6c75 6564  or single-valued
+000216d0: 2028 652e 672e 2033 292e 0a0a 2020 2020   (e.g. 3)...    
+000216e0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+000216f0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 7661  ---------.    va
+00021700: 7220 3a20 696e 7420 6f72 2066 6c6f 6174  r : int or float
+00021710: 206f 7220 6c69 7374 0a20 2020 2020 2020   or list.       
+00021720: 2056 6172 6961 626c 6520 746f 2063 6865   Variable to che
+00021730: 636b 2066 6f72 2069 7465 7261 6269 6c69  ck for iterabili
+00021740: 7479 2e0a 0a20 2020 2052 6574 7572 6e73  ty...    Returns
+00021750: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
+00021760: 2076 6172 203a 206c 6973 740a 2020 2020   var : list.    
+00021770: 2020 2020 5661 7269 6162 6c65 2063 6f6e      Variable con
+00021780: 7665 7274 6564 2074 6f20 6c69 7374 2069  verted to list i
+00021790: 6620 7369 6e67 6c65 2d76 616c 7565 6420  f single-valued 
+000217a0: 696e 7075 742e 0a20 2020 2022 2222 0a0a  input..    """..
+000217b0: 2020 2020 6966 2068 6173 6174 7472 2876      if hasattr(v
+000217c0: 6172 2c20 225f 5f69 7465 725f 5f22 293a  ar, "__iter__"):
+000217d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000217e0: 7661 720a 2020 2020 656c 7365 3a0a 2020  var.    else:.  
+000217f0: 2020 2020 2020 7265 7475 726e 205b 7661        return [va
+00021800: 725d 0a0a 0a64 6566 2066 696c 6c5f 7265  r]...def fill_re
+00021810: 6374 616e 676c 6528 0a20 2020 2044 2c0a  ctangle(.    D,.
+00021820: 2020 2020 6669 6c6c 5f73 697a 653d 2834      fill_size=(4
+00021830: 302c 2031 3029 2c0a 2020 2020 6176 6f69  0, 10),.    avoi
+00021840: 645f 6c61 7965 7273 3d22 616c 6c22 2c0a  d_layers="all",.
+00021850: 2020 2020 696e 636c 7564 655f 6c61 7965      include_laye
+00021860: 7273 3d4e 6f6e 652c 0a20 2020 206d 6172  rs=None,.    mar
+00021870: 6769 6e3d 3130 302c 0a20 2020 2066 696c  gin=100,.    fil
+00021880: 6c5f 6c61 7965 7273 3d28 302c 2031 2c20  l_layers=(0, 1, 
+00021890: 3329 2c0a 2020 2020 6669 6c6c 5f64 656e  3),.    fill_den
+000218a0: 7369 7469 6573 3d28 302e 352c 2030 2e32  sities=(0.5, 0.2
+000218b0: 352c 2030 2e37 292c 0a20 2020 2066 696c  5, 0.7),.    fil
+000218c0: 6c5f 696e 7665 7274 6564 3d4e 6f6e 652c  l_inverted=None,
+000218d0: 0a20 2020 2062 626f 783d 4e6f 6e65 2c0a  .    bbox=None,.
+000218e0: 293a 0a20 2020 2022 2222 4372 6561 7465  ):.    """Create
+000218f0: 7320 6120 7265 6374 616e 6775 6c61 7220  s a rectangular 
+00021900: 6669 6c6c 2070 6174 7465 726e 2061 6e64  fill pattern and
+00021910: 2066 696c 6c73 2061 6c6c 2065 6d70 7479   fills all empty
+00021920: 2061 7265 6173 0a20 2020 2069 6e20 7468   areas.    in th
+00021930: 6520 696e 7075 7420 6465 7669 6365 2044  e input device D
+00021940: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
+00021950: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
+00021960: 2020 2020 4420 3a20 4465 7669 6365 0a20      D : Device. 
+00021970: 2020 2020 2020 2044 6576 6963 6520 746f         Device to
+00021980: 2062 6520 6669 6c6c 6564 0a20 2020 2066   be filled.    f
+00021990: 696c 6c5f 7369 7a65 203a 2061 7272 6179  ill_size : array
+000219a0: 2d6c 696b 655b 325d 0a20 2020 2020 2020  -like[2].       
+000219b0: 2052 6563 7461 6e67 756c 6172 2073 697a   Rectangular siz
+000219c0: 6520 6f66 2074 6865 2066 696c 6c20 656c  e of the fill el
+000219d0: 656d 656e 740a 2020 2020 6176 6f69 645f  ement.    avoid_
+000219e0: 6c61 7965 7273 203a 2027 616c 6c27 206f  layers : 'all' o
+000219f0: 7220 6c69 7374 206f 6620 6c61 7965 7273  r list of layers
+00021a00: 0a20 2020 2020 2020 204c 6179 6572 7320  .        Layers 
+00021a10: 746f 2062 6520 6176 6f69 6465 6420 286e  to be avoided (n
+00021a20: 6f74 2066 696c 6c65 6429 2069 6e20 440a  ot filled) in D.
+00021a30: 2020 2020 696e 636c 7564 655f 6c61 7965      include_laye
+00021a40: 7273 203a 0a20 2020 2020 2020 204c 6179  rs :.        Lay
+00021a50: 6572 7320 746f 2062 6520 696e 636c 7564  ers to be includ
+00021a60: 6564 2028 6669 6c6c 6564 2920 696e 2044  ed (filled) in D
+00021a70: 2c20 7375 7065 7263 6564 6573 2061 766f  , supercedes avo
+00021a80: 6964 5f6c 6179 6572 730a 2020 2020 6d61  id_layers.    ma
+00021a90: 7267 696e 203a 2069 6e74 206f 7220 666c  rgin : int or fl
+00021aa0: 6f61 740a 2020 2020 2020 2020 4d61 7267  oat.        Marg
+00021ab0: 696e 2073 7061 6369 6e67 2061 726f 756e  in spacing aroun
+00021ac0: 6420 6176 6f69 6465 6420 6172 6561 7320  d avoided areas 
+00021ad0: 2d2d 2066 696c 6c20 7769 6c6c 206e 6f74  -- fill will not
+00021ae0: 2063 6f6d 6520 7769 7468 696e 0a20 2020   come within.   
+00021af0: 2020 2020 2060 6d61 7267 696e 6020 6f66       `margin` of
+00021b00: 2074 6865 2067 656f 6d65 7472 7920 696e   the geometry in
+00021b10: 2044 0a20 2020 2066 696c 6c5f 6c61 7965   D.    fill_laye
+00021b20: 7273 203a 206c 6973 7420 6f66 206c 6179  rs : list of lay
+00021b30: 6572 730a 2020 2020 2020 2020 4465 6669  ers.        Defi
+00021b40: 6e65 7320 7468 6520 6669 6c6c 2070 6174  nes the fill pat
+00021b50: 7465 726e 206c 6179 6572 730a 2020 2020  tern layers.    
+00021b60: 6669 6c6c 5f64 656e 7369 7469 6573 203a  fill_densities :
+00021b70: 2066 6c6f 6174 2062 6574 7765 656e 2030   float between 0
+00021b80: 2061 6e64 2031 0a20 2020 2020 2020 2044   and 1.        D
+00021b90: 6566 696e 6573 2074 6865 2066 696c 6c20  efines the fill 
+00021ba0: 7061 7474 6572 6e20 6465 6e73 6974 7920  pattern density 
+00021bb0: 2831 2e30 203d 3d20 6675 6c6c 7920 6669  (1.0 == fully fi
+00021bc0: 6c6c 6564 290a 2020 2020 6669 6c6c 5f69  lled).    fill_i
+00021bd0: 6e76 6572 7465 6420 3a20 626f 6f6c 0a20  nverted : bool. 
+00021be0: 2020 2020 2020 2049 6e76 6572 7473 2074         Inverts t
+00021bf0: 6865 2066 696c 6c20 7061 7474 6572 6e0a  he fill pattern.
+00021c00: 2020 2020 6262 6f78 203a 2061 7272 6179      bbox : array
+00021c10: 2d6c 696b 655b 325d 5b32 5d0a 2020 2020  -like[2][2].    
+00021c20: 2020 2020 4c69 6d69 7420 7468 6520 6669      Limit the fi
+00021c30: 6c6c 2070 6174 7465 726e 2074 6f20 7468  ll pattern to th
+00021c40: 6520 6172 6561 2064 6566 696e 6564 2062  e area defined b
+00021c50: 7920 7468 6973 2062 6f75 6e64 696e 6720  y this bounding 
+00021c60: 626f 780a 0a20 2020 2052 6574 7572 6e73  box..    Returns
+00021c70: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
+00021c80: 2046 203a 2044 6576 6963 650a 0a20 2020   F : Device..   
+00021c90: 2022 2222 0a20 2020 2023 2043 7265 6174   """.    # Creat
+00021ca0: 6520 7468 6520 6669 6c6c 2063 656c 6c2e  e the fill cell.
+00021cb0: 0a20 2020 2023 2049 6620 6669 6c6c 5f69  .    # If fill_i
+00021cc0: 6e76 6572 7465 6420 6973 206e 6f74 2073  nverted is not s
+00021cd0: 7065 6369 6669 6564 2c20 6173 7375 6d65  pecified, assume
+00021ce0: 2061 6c6c 2046 616c 7365 0a20 2020 2066   all False.    f
+00021cf0: 696c 6c5f 6c61 7965 7273 203d 205f 6c6f  ill_layers = _lo
+00021d00: 6f70 5f6f 7665 7228 6669 6c6c 5f6c 6179  op_over(fill_lay
+00021d10: 6572 7329 0a20 2020 2066 696c 6c5f 6465  ers).    fill_de
+00021d20: 6e73 6974 6965 7320 3d20 5f6c 6f6f 705f  nsities = _loop_
+00021d30: 6f76 6572 2866 696c 6c5f 6465 6e73 6974  over(fill_densit
+00021d40: 6965 7329 0a20 2020 2069 6620 6669 6c6c  ies).    if fill
+00021d50: 5f69 6e76 6572 7465 6420 6973 204e 6f6e  _inverted is Non
+00021d60: 653a 0a20 2020 2020 2020 2066 696c 6c5f  e:.        fill_
+00021d70: 696e 7665 7274 6564 203d 205b 4661 6c73  inverted = [Fals
+00021d80: 655d 202a 206c 656e 2866 696c 6c5f 6c61  e] * len(fill_la
+00021d90: 7965 7273 290a 2020 2020 6669 6c6c 5f69  yers).    fill_i
+00021da0: 6e76 6572 7465 6420 3d20 5f6c 6f6f 705f  nverted = _loop_
+00021db0: 6f76 6572 2866 696c 6c5f 696e 7665 7274  over(fill_invert
+00021dc0: 6564 290a 2020 2020 6966 206c 656e 2866  ed).    if len(f
+00021dd0: 696c 6c5f 6c61 7965 7273 2920 213d 206c  ill_layers) != l
+00021de0: 656e 2866 696c 6c5f 6465 6e73 6974 6965  en(fill_densitie
+00021df0: 7329 3a0a 2020 2020 2020 2020 7261 6973  s):.        rais
+00021e00: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+00021e10: 2020 2020 2020 2020 2020 225b 5048 4944            "[PHID
+00021e20: 4c5d 2070 6869 646c 2e67 656f 6d65 7472  L] phidl.geometr
+00021e30: 792e 6669 6c6c 5f72 6563 7461 6e67 6c65  y.fill_rectangle
+00021e40: 2829 2022 0a20 2020 2020 2020 2020 2020  () ".           
+00021e50: 2022 6066 696c 6c5f 6c61 7965 7273 6020   "`fill_layers` 
+00021e60: 616e 6420 6066 696c 6c5f 6465 6e73 6974  and `fill_densit
+00021e70: 6965 7360 2070 6172 616d 6574 6572 7320  ies` parameters 
+00021e80: 220a 2020 2020 2020 2020 2020 2020 226d  ".            "m
+00021e90: 7573 7420 6265 206c 6973 7473 206f 6620  ust be lists of 
+00021ea0: 7468 6520 7361 6d65 206c 656e 6774 6822  the same length"
+00021eb0: 0a20 2020 2020 2020 2029 0a20 2020 2069  .        ).    i
+00021ec0: 6620 6c65 6e28 6669 6c6c 5f6c 6179 6572  f len(fill_layer
+00021ed0: 7329 2021 3d20 6c65 6e28 6669 6c6c 5f69  s) != len(fill_i
+00021ee0: 6e76 6572 7465 6429 3a0a 2020 2020 2020  nverted):.      
+00021ef0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00021f00: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00021f10: 225b 5048 4944 4c5d 2070 6869 646c 2e67  "[PHIDL] phidl.g
+00021f20: 656f 6d65 7472 792e 6669 6c6c 5f72 6563  eometry.fill_rec
+00021f30: 7461 6e67 6c65 2829 2022 0a20 2020 2020  tangle() ".     
+00021f40: 2020 2020 2020 2022 6066 696c 6c5f 6c61         "`fill_la
+00021f50: 7965 7273 6020 616e 6420 6066 696c 6c5f  yers` and `fill_
+00021f60: 696e 7665 7274 6564 6020 7061 7261 6d65  inverted` parame
+00021f70: 7465 7273 206d 7573 7420 220a 2020 2020  ters must ".    
+00021f80: 2020 2020 2020 2020 2262 6520 6c69 7374          "be list
+00021f90: 7320 6f66 2074 6865 2073 616d 6520 6c65  s of the same le
+00021fa0: 6e67 7468 220a 2020 2020 2020 2020 290a  ngth".        ).
+00021fb0: 0a20 2020 2066 696c 6c5f 6365 6c6c 203d  .    fill_cell =
+00021fc0: 205f 6669 6c6c 5f63 656c 6c5f 7265 6374   _fill_cell_rect
+00021fd0: 616e 676c 6528 0a20 2020 2020 2020 2073  angle(.        s
+00021fe0: 697a 653d 6669 6c6c 5f73 697a 652c 0a20  ize=fill_size,. 
+00021ff0: 2020 2020 2020 206c 6179 6572 733d 6669         layers=fi
+00022000: 6c6c 5f6c 6179 6572 732c 0a20 2020 2020  ll_layers,.     
+00022010: 2020 2064 656e 7369 7469 6573 3d66 696c     densities=fil
+00022020: 6c5f 6465 6e73 6974 6965 732c 0a20 2020  l_densities,.   
+00022030: 2020 2020 2069 6e76 6572 7465 643d 6669       inverted=fi
+00022040: 6c6c 5f69 6e76 6572 7465 642c 0a20 2020  ll_inverted,.   
+00022050: 2029 0a20 2020 2046 203d 2044 6576 6963   ).    F = Devic
+00022060: 6528 6e61 6d65 3d22 6669 6c6c 5f70 6174  e(name="fill_pat
+00022070: 7465 726e 2229 0a0a 2020 2020 6966 2061  tern")..    if a
+00022080: 766f 6964 5f6c 6179 6572 7320 3d3d 2022  void_layers == "
+00022090: 616c 6c22 3a0a 2020 2020 2020 2020 6578  all":.        ex
+000220a0: 636c 7564 655f 706f 6c79 7320 3d20 442e  clude_polys = D.
+000220b0: 6765 745f 706f 6c79 676f 6e73 2862 795f  get_polygons(by_
+000220c0: 7370 6563 3d46 616c 7365 2c20 6465 7074  spec=False, dept
+000220d0: 683d 4e6f 6e65 290a 2020 2020 656c 7365  h=None).    else
+000220e0: 3a0a 2020 2020 2020 2020 6176 6f69 645f  :.        avoid_
+000220f0: 6c61 7965 7273 203d 205b 5f70 6172 7365  layers = [_parse
+00022100: 5f6c 6179 6572 286c 2920 666f 7220 6c20  _layer(l) for l 
+00022110: 696e 205f 6c6f 6f70 5f6f 7665 7228 6176  in _loop_over(av
+00022120: 6f69 645f 6c61 7965 7273 295d 0a20 2020  oid_layers)].   
+00022130: 2020 2020 2065 7863 6c75 6465 5f70 6f6c       exclude_pol
+00022140: 7973 203d 2044 2e67 6574 5f70 6f6c 7967  ys = D.get_polyg
+00022150: 6f6e 7328 6279 5f73 7065 633d 5472 7565  ons(by_spec=True
+00022160: 2c20 6465 7074 683d 4e6f 6e65 290a 2020  , depth=None).  
+00022170: 2020 2020 2020 6578 636c 7564 655f 706f        exclude_po
+00022180: 6c79 7320 3d20 7b0a 2020 2020 2020 2020  lys = {.        
+00022190: 2020 2020 6b65 793a 2065 7863 6c75 6465      key: exclude
+000221a0: 5f70 6f6c 7973 5b6b 6579 5d20 666f 7220  _polys[key] for 
+000221b0: 6b65 7920 696e 2065 7863 6c75 6465 5f70  key in exclude_p
+000221c0: 6f6c 7973 2069 6620 6b65 7920 696e 2061  olys if key in a
+000221d0: 766f 6964 5f6c 6179 6572 730a 2020 2020  void_layers.    
+000221e0: 2020 2020 7d0a 2020 2020 2020 2020 6578      }.        ex
+000221f0: 636c 7564 655f 706f 6c79 7320 3d20 6974  clude_polys = it
+00022200: 6572 746f 6f6c 732e 6368 6169 6e2e 6672  ertools.chain.fr
+00022210: 6f6d 5f69 7465 7261 626c 6528 6578 636c  om_iterable(excl
+00022220: 7564 655f 706f 6c79 732e 7661 6c75 6573  ude_polys.values
+00022230: 2829 290a 0a20 2020 2069 6620 696e 636c  ())..    if incl
+00022240: 7564 655f 6c61 7965 7273 2069 7320 4e6f  ude_layers is No
+00022250: 6e65 3a0a 2020 2020 2020 2020 696e 636c  ne:.        incl
+00022260: 7564 655f 706f 6c79 7320 3d20 5b5d 0a20  ude_polys = []. 
+00022270: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00022280: 2069 6e63 6c75 6465 5f6c 6179 6572 7320   include_layers 
+00022290: 3d20 5b5f 7061 7273 655f 6c61 7965 7228  = [_parse_layer(
+000222a0: 6c29 2066 6f72 206c 2069 6e20 5f6c 6f6f  l) for l in _loo
+000222b0: 705f 6f76 6572 2869 6e63 6c75 6465 5f6c  p_over(include_l
+000222c0: 6179 6572 7329 5d0a 2020 2020 2020 2020  ayers)].        
+000222d0: 696e 636c 7564 655f 706f 6c79 7320 3d20  include_polys = 
+000222e0: 442e 6765 745f 706f 6c79 676f 6e73 2862  D.get_polygons(b
+000222f0: 795f 7370 6563 3d54 7275 652c 2064 6570  y_spec=True, dep
+00022300: 7468 3d4e 6f6e 6529 0a20 2020 2020 2020  th=None).       
+00022310: 2069 6e63 6c75 6465 5f70 6f6c 7973 203d   include_polys =
+00022320: 207b 0a20 2020 2020 2020 2020 2020 206b   {.            k
+00022330: 6579 3a20 696e 636c 7564 655f 706f 6c79  ey: include_poly
+00022340: 735b 6b65 795d 2066 6f72 206b 6579 2069  s[key] for key i
+00022350: 6e20 696e 636c 7564 655f 706f 6c79 7320  n include_polys 
+00022360: 6966 206b 6579 2069 6e20 696e 636c 7564  if key in includ
+00022370: 655f 6c61 7965 7273 0a20 2020 2020 2020  e_layers.       
+00022380: 207d 0a20 2020 2020 2020 2069 6e63 6c75   }.        inclu
+00022390: 6465 5f70 6f6c 7973 203d 2069 7465 7274  de_polys = itert
+000223a0: 6f6f 6c73 2e63 6861 696e 2e66 726f 6d5f  ools.chain.from_
+000223b0: 6974 6572 6162 6c65 2869 6e63 6c75 6465  iterable(include
+000223c0: 5f70 6f6c 7973 2e76 616c 7565 7328 2929  _polys.values())
+000223d0: 0a0a 2020 2020 6966 2062 626f 7820 6973  ..    if bbox is
+000223e0: 204e 6f6e 653a 0a20 2020 2020 2020 2062   None:.        b
+000223f0: 626f 7820 3d20 442e 6262 6f78 0a0a 2020  box = D.bbox..  
+00022400: 2020 7261 7374 6572 203d 205f 7261 7374    raster = _rast
+00022410: 6572 697a 655f 706f 6c79 676f 6e73 280a  erize_polygons(.
+00022420: 2020 2020 2020 2020 706f 6c79 676f 6e73          polygons
+00022430: 3d65 7863 6c75 6465 5f70 6f6c 7973 2c20  =exclude_polys, 
+00022440: 626f 756e 6473 3d62 626f 782c 2064 783d  bounds=bbox, dx=
+00022450: 6669 6c6c 5f73 697a 655b 305d 2c20 6479  fill_size[0], dy
+00022460: 3d66 696c 6c5f 7369 7a65 5b31 5d0a 2020  =fill_size[1].  
+00022470: 2020 290a 2020 2020 7261 7374 6572 203d    ).    raster =
+00022480: 2072 6173 7465 7220 2620 7e5f 7261 7374   raster & ~_rast
+00022490: 6572 697a 655f 706f 6c79 676f 6e73 280a  erize_polygons(.
+000224a0: 2020 2020 2020 2020 706f 6c79 676f 6e73          polygons
+000224b0: 3d69 6e63 6c75 6465 5f70 6f6c 7973 2c20  =include_polys, 
+000224c0: 626f 756e 6473 3d62 626f 782c 2064 783d  bounds=bbox, dx=
+000224d0: 6669 6c6c 5f73 697a 655b 305d 2c20 6479  fill_size[0], dy
+000224e0: 3d66 696c 6c5f 7369 7a65 5b31 5d0a 2020  =fill_size[1].  
+000224f0: 2020 290a 2020 2020 7261 7374 6572 203d    ).    raster =
+00022500: 205f 6578 7061 6e64 5f72 6173 7465 7228   _expand_raster(
+00022510: 7261 7374 6572 2c20 6469 7374 616e 6365  raster, distance
+00022520: 3d6d 6172 6769 6e20 2f20 6e70 2e61 7272  =margin / np.arr
+00022530: 6179 2866 696c 6c5f 7369 7a65 2929 0a0a  ay(fill_size))..
+00022540: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+00022550: 6765 286e 702e 7369 7a65 2872 6173 7465  ge(np.size(raste
+00022560: 722c 2030 2929 3a0a 2020 2020 2020 2020  r, 0)):.        
+00022570: 7375 625f 7261 7374 6572 7320 3d20 5b6c  sub_rasters = [l
+00022580: 6973 7428 6729 2066 6f72 206b 2c20 6720  ist(g) for k, g 
+00022590: 696e 2069 7465 7274 6f6f 6c73 2e67 726f  in itertools.gro
+000225a0: 7570 6279 2872 6173 7465 725b 695d 295d  upby(raster[i])]
+000225b0: 0a20 2020 2020 2020 206a 203d 2030 0a20  .        j = 0. 
+000225c0: 2020 2020 2020 2066 6f72 2073 2069 6e20         for s in 
+000225d0: 7375 625f 7261 7374 6572 733a 0a20 2020  sub_rasters:.   
+000225e0: 2020 2020 2020 2020 2069 6620 735b 305d           if s[0]
+000225f0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00022600: 2020 2020 2020 2078 2c20 7920 3d20 5f72         x, y = _r
+00022610: 6173 7465 725f 696e 6465 785f 746f 5f63  aster_index_to_c
+00022620: 6f6f 7264 7328 692c 206a 2c20 6262 6f78  oords(i, j, bbox
+00022630: 2c20 6669 6c6c 5f73 697a 655b 305d 2c20  , fill_size[0], 
+00022640: 6669 6c6c 5f73 697a 655b 315d 290a 2020  fill_size[1]).  
+00022650: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00022660: 462e 6164 6428 6764 7370 792e 4365 6c6c  F.add(gdspy.Cell
+00022670: 4172 7261 7928 7265 665f 6365 6c6c 203d  Array(ref_cell =
+00022680: 2066 696c 6c5f 6365 6c6c 2c0a 2020 2020   fill_cell,.    
+00022690: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+000226a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000226b0: 2020 2020 636f 6c75 6d6e 7320 3d20 6c65      columns = le
+000226c0: 6e28 7329 2c20 726f 7773 203d 2031 2c0a  n(s), rows = 1,.
+000226d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000226e0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+000226f0: 2020 2020 2020 2020 7370 6163 696e 6720          spacing 
+00022700: 3d20 6669 6c6c 5f73 697a 652c 2029 290a  = fill_size, )).
+00022710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022720: 6120 3d20 462e 6164 645f 6172 7261 7928  a = F.add_array(
+00022730: 6669 6c6c 5f63 656c 6c2c 2063 6f6c 756d  fill_cell, colum
+00022740: 6e73 3d6c 656e 2873 292c 2072 6f77 733d  ns=len(s), rows=
+00022750: 312c 2073 7061 6369 6e67 3d66 696c 6c5f  1, spacing=fill_
+00022760: 7369 7a65 290a 2020 2020 2020 2020 2020  size).          
+00022770: 2020 2020 2020 612e 6d6f 7665 2828 782c        a.move((x,
+00022780: 2079 2929 0a20 2020 2020 2020 2020 2020   y)).           
+00022790: 206a 202b 3d20 6c65 6e28 7329 0a0a 2020   j += len(s)..  
+000227a0: 2020 7265 7475 726e 2046 0a0a 0a23 203d    return F...# =
+000227b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000227c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000227d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000227e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000227f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 230a  =============.#.
+00022800: 2320 5068 6f74 6f6e 6963 730a 230a 2320  # Photonics.#.# 
+00022810: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00022820: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00022830: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00022840: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00022850: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a0a  ==============..
+00022860: 0a64 6566 2070 6f6c 7967 6f6e 5f70 6f72  .def polygon_por
+00022870: 7473 2878 7074 733d 5b2d 312c 202d 312c  ts(xpts=[-1, -1,
+00022880: 2030 2c20 305d 2c20 7970 7473 3d5b 302c   0, 0], ypts=[0,
+00022890: 2031 2c20 312c 2030 5d2c 206c 6179 6572   1, 1, 0], layer
+000228a0: 3d30 293a 0a20 2020 2022 2222 4372 6561  =0):.    """Crea
+000228b0: 7465 7320 6120 706f 6c79 676f 6e20 7769  tes a polygon wi
+000228c0: 7468 2070 6f72 7473 206f 6e20 616c 6c20  th ports on all 
+000228d0: 6564 6765 732e 0a0a 2020 2020 5061 7261  edges...    Para
+000228e0: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
+000228f0: 2d2d 2d2d 2d0a 2020 2020 7870 7473 203a  -----.    xpts :
+00022900: 2061 7272 6179 2d6c 696b 650a 2020 2020   array-like.    
+00022910: 2020 2020 782d 636f 6f72 6469 6e61 7465      x-coordinate
+00022920: 2076 616c 7565 7320 6f66 2074 6865 2070   values of the p
+00022930: 6f6c 7967 6f6e 2076 6572 7469 6365 732e  olygon vertices.
+00022940: 0a20 2020 2079 7074 7320 3a20 6172 7261  .    ypts : arra
+00022950: 792d 6c69 6b65 0a20 2020 2020 2020 2079  y-like.        y
+00022960: 2d63 6f6f 7264 696e 6174 6520 7661 6c75  -coordinate valu
+00022970: 6573 206f 6620 7468 6520 706f 6c79 676f  es of the polygo
+00022980: 6e20 7665 7274 6963 6573 2e0a 2020 2020  n vertices..    
+00022990: 6c61 7965 7220 3a20 696e 742c 2061 7272  layer : int, arr
+000229a0: 6179 2d6c 696b 655b 325d 2c20 6f72 2073  ay-like[2], or s
+000229b0: 6574 0a20 2020 2020 2020 2053 7065 6369  et.        Speci
+000229c0: 6669 6320 6c61 7965 7228 7329 2074 6f20  fic layer(s) to 
+000229d0: 7075 7420 706f 6c79 676f 6e20 6765 6f6d  put polygon geom
+000229e0: 6574 7279 206f 6e2e 0a0a 2020 2020 5265  etry on...    Re
+000229f0: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00022a00: 2d0a 2020 2020 5020 3a20 4465 7669 6365  -.    P : Device
+00022a10: 0a20 2020 2020 2020 2041 2044 6576 6963  .        A Devic
+00022a20: 6520 636f 6e74 6169 6e69 6e67 2061 2070  e containing a p
+00022a30: 6f6c 7967 6f6e 2077 6974 6820 706f 7274  olygon with port
+00022a40: 7320 6f6e 2061 6c6c 2065 6467 6573 2e0a  s on all edges..
+00022a50: 2020 2020 2222 220a 2020 2020 2320 7265      """.    # re
+00022a60: 7475 726e 7320 6120 706f 6c79 676f 6e20  turns a polygon 
+00022a70: 7769 7468 2070 6f72 7473 206f 6e20 616c  with ports on al
+00022a80: 6c20 6564 6765 730a 2020 2020 5020 3d20  l edges.    P = 
+00022a90: 4465 7669 6365 2822 706f 6c79 676f 6e22  Device("polygon"
+00022aa0: 290a 2020 2020 502e 6164 645f 706f 6c79  ).    P.add_poly
+00022ab0: 676f 6e28 5b78 7074 732c 2079 7074 735d  gon([xpts, ypts]
+00022ac0: 2c20 6c61 7965 723d 6c61 7965 7229 0a20  , layer=layer). 
+00022ad0: 2020 206e 203d 206c 656e 2878 7074 7329     n = len(xpts)
+00022ae0: 0a20 2020 2078 7074 732e 6170 7065 6e64  .    xpts.append
+00022af0: 2878 7074 735b 305d 290a 2020 2020 7970  (xpts[0]).    yp
+00022b00: 7473 2e61 7070 656e 6428 7970 7473 5b30  ts.append(ypts[0
+00022b10: 5d29 0a20 2020 2023 2064 6574 6572 6d69  ]).    # determi
+00022b20: 6e65 2069 6620 636c 6f63 6b77 6973 6520  ne if clockwise 
+00022b30: 6f72 2063 6f75 6e74 6572 636c 6f63 6b77  or counterclockw
+00022b40: 6973 650a 2020 2020 6363 203d 2030 0a20  ise.    cc = 0. 
+00022b50: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+00022b60: 6528 302c 206e 293a 0a20 2020 2020 2020  e(0, n):.       
+00022b70: 2063 6320 2b3d 2028 7870 7473 5b69 202b   cc += (xpts[i +
+00022b80: 2031 5d20 2d20 7870 7473 5b69 5d29 202a   1] - xpts[i]) *
+00022b90: 2028 7970 7473 5b69 202b 2031 5d20 2b20   (ypts[i + 1] + 
+00022ba0: 7970 7473 5b69 5d29 0a0a 2020 2020 666f  ypts[i])..    fo
+00022bb0: 7220 6920 696e 2072 616e 6765 2830 2c20  r i in range(0, 
+00022bc0: 6e29 3a0a 2020 2020 2020 2020 6d69 6470  n):.        midp
+00022bd0: 6f69 6e74 5f6e 203d 205b 2878 7074 735b  oint_n = [(xpts[
+00022be0: 6920 2b20 315d 202b 2078 7074 735b 695d  i + 1] + xpts[i]
+00022bf0: 2920 2f20 322c 2028 7970 7473 5b69 202b  ) / 2, (ypts[i +
+00022c00: 2031 5d20 2b20 7970 7473 5b69 5d29 202f   1] + ypts[i]) /
+00022c10: 2032 5d0a 2020 2020 2020 2020 6f72 6965   2].        orie
+00022c20: 6e74 6174 696f 6e5f 6e20 3d20 280a 2020  ntation_n = (.  
+00022c30: 2020 2020 2020 2020 2020 6e70 2e61 7263            np.arc
+00022c40: 7461 6e32 280a 2020 2020 2020 2020 2020  tan2(.          
+00022c50: 2020 2020 2020 6e70 2e73 6967 6e28 6363        np.sign(cc
+00022c60: 2920 2a20 2878 7074 735b 6920 2b20 315d  ) * (xpts[i + 1]
+00022c70: 202d 2078 7074 735b 695d 292c 0a20 2020   - xpts[i]),.   
+00022c80: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+00022c90: 7369 676e 2863 6329 202a 2028 7970 7473  sign(cc) * (ypts
+00022ca0: 5b69 5d20 2d20 7970 7473 5b69 202b 2031  [i] - ypts[i + 1
+00022cb0: 5d29 2c0a 2020 2020 2020 2020 2020 2020  ]),.            
+00022cc0: 290a 2020 2020 2020 2020 2020 2020 2a20  ).            * 
+00022cd0: 3138 300a 2020 2020 2020 2020 2020 2020  180.            
+00022ce0: 2f20 7069 0a20 2020 2020 2020 2029 0a20  / pi.        ). 
+00022cf0: 2020 2020 2020 2077 6964 7468 5f6e 203d         width_n =
+00022d00: 206e 702e 6162 7328 0a20 2020 2020 2020   np.abs(.       
+00022d10: 2020 2020 2073 7172 7428 2878 7074 735b       sqrt((xpts[
+00022d20: 6920 2b20 315d 202d 2078 7074 735b 695d  i + 1] - xpts[i]
+00022d30: 2920 2a2a 2032 202b 2028 7970 7473 5b69  ) ** 2 + (ypts[i
+00022d40: 202b 2031 5d20 2d20 7970 7473 5b69 5d29   + 1] - ypts[i])
+00022d50: 202a 2a20 3229 0a20 2020 2020 2020 2029   ** 2).        )
+00022d60: 0a20 2020 2020 2020 2050 2e61 6464 5f70  .        P.add_p
+00022d70: 6f72 7428 0a20 2020 2020 2020 2020 2020  ort(.           
+00022d80: 206e 616d 653d 7374 7228 6920 2b20 3129   name=str(i + 1)
+00022d90: 2c0a 2020 2020 2020 2020 2020 2020 6d69  ,.            mi
+00022da0: 6470 6f69 6e74 3d6d 6964 706f 696e 745f  dpoint=midpoint_
+00022db0: 6e2c 0a20 2020 2020 2020 2020 2020 2077  n,.            w
+00022dc0: 6964 7468 3d77 6964 7468 5f6e 2c0a 2020  idth=width_n,.  
+00022dd0: 2020 2020 2020 2020 2020 6f72 6965 6e74            orient
+00022de0: 6174 696f 6e3d 6f72 6965 6e74 6174 696f  ation=orientatio
+00022df0: 6e5f 6e2c 0a20 2020 2020 2020 2029 0a0a  n_n,.        )..
+00022e00: 2020 2020 7265 7475 726e 2050 0a0a 0a23      return P...#
+00022e10: 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d   ===============
+00022e20: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00022e30: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00022e40: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00022e50: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a  ===============.
+00022e60: 2320 4578 616d 706c 6520 636f 6465 0a23  # Example code.#
+00022e70: 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d   ===============
+00022e80: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00022e90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00022ea0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00022eb0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a  ===============.
+00022ec0: 0a23 2050 203d 2070 6f6c 7967 6f6e 2878  .# P = polygon(x
+00022ed0: 7074 733d 5b2d 312c 2d33 2c20 302c 2030  pts=[-1,-3, 0, 0
+00022ee0: 5d2c 2079 7074 7320 3d20 5b30 2c20 312c  ], ypts = [0, 1,
+00022ef0: 2032 2c20 305d 2c20 6c61 7965 7220 3d20   2, 0], layer = 
+00022f00: 3329 0a23 2071 7569 636b 706c 6f74 2850  3).# quickplot(P
+00022f10: 290a 0a0a 4064 6576 6963 655f 6c72 755f  )...@device_lru_
+00022f20: 6361 6368 650a 6465 6620 6772 6174 696e  cache.def gratin
+00022f30: 6728 0a20 2020 206e 756d 5f70 6572 696f  g(.    num_perio
+00022f40: 6473 3d32 302c 0a20 2020 2070 6572 696f  ds=20,.    perio
+00022f50: 643d 302e 3735 2c0a 2020 2020 6669 6c6c  d=0.75,.    fill
+00022f60: 5f66 6163 746f 723d 302e 352c 0a20 2020  _factor=0.5,.   
+00022f70: 2077 6964 7468 5f67 7261 7469 6e67 3d35   width_grating=5
+00022f80: 2c0a 2020 2020 6c65 6e67 7468 5f74 6170  ,.    length_tap
+00022f90: 6572 3d31 302c 0a20 2020 2077 6964 7468  er=10,.    width
+00022fa0: 3d30 2e34 2c0a 2020 2020 7061 7274 6961  =0.4,.    partia
+00022fb0: 6c5f 6574 6368 3d46 616c 7365 2c0a 293a  l_etch=False,.):
+00022fc0: 0a20 2020 2022 2222 5369 6d70 6c65 2067  .    """Simple g
+00022fd0: 7261 7469 6e67 2073 7472 7563 7475 7265  rating structure
+00022fe0: 2066 6f72 2070 686f 746f 6e69 6373 0a0a   for photonics..
+00022ff0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00023000: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00023010: 2020 6e75 6d5f 7065 7269 6f64 7320 3a20    num_periods : 
+00023020: 696e 740a 2020 2020 2020 2020 4e75 6d62  int.        Numb
+00023030: 6572 206f 6620 6772 6174 696e 6773 2e0a  er of gratings..
+00023040: 2020 2020 7065 7269 6f64 203a 2069 6e74      period : int
+00023050: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
+00023060: 2020 4469 7374 616e 6365 2062 6574 7765    Distance betwe
+00023070: 656e 2067 7261 7469 6e67 732e 0a20 2020  en gratings..   
+00023080: 2066 696c 6c5f 6661 6374 6f72 203a 2069   fill_factor : i
+00023090: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
+000230a0: 2020 2020 5468 6963 6b6e 6573 7320 6f66      Thickness of
+000230b0: 2074 6865 2067 7261 7469 6e67 732e 0a20   the gratings.. 
+000230c0: 2020 2077 6964 7468 5f67 7261 7469 6e67     width_grating
+000230d0: 203a 2069 6e74 206f 7220 666c 6f61 740a   : int or float.
+000230e0: 2020 2020 2020 2020 5769 6474 6820 6f66          Width of
+000230f0: 2074 6865 2067 7261 7469 6e67 732e 0a20   the gratings.. 
+00023100: 2020 206c 656e 6774 685f 7461 7065 7220     length_taper 
+00023110: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
+00023120: 2020 2020 2020 204c 656e 6774 6820 6f66         Length of
+00023130: 2074 6865 2074 6170 6572 2073 6563 7469   the taper secti
+00023140: 6f6e 2e0a 2020 2020 7769 6474 6820 3a20  on..    width : 
+00023150: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
+00023160: 2020 2020 2057 6964 7468 206f 6620 7468       Width of th
+00023170: 6520 656e 6420 6f66 2074 6865 2074 6170  e end of the tap
+00023180: 6572 2073 6563 7469 6f6e 2e0a 2020 2020  er section..    
+00023190: 7061 7274 6961 6c5f 6574 6368 203a 2062  partial_etch : b
+000231a0: 6f6f 6c0a 2020 2020 2020 2020 4966 2054  ool.        If T
+000231b0: 7275 652c 206d 616b 6573 2061 6e20 756e  rue, makes an un
+000231c0: 7461 7065 7265 642c 2070 6172 7469 616c  tapered, partial
+000231d0: 6c79 2d65 7463 6865 6420 6772 6174 696e  ly-etched gratin
+000231e0: 672e 0a0a 2020 2020 5265 7475 726e 730a  g...    Returns.
+000231f0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+00023200: 4720 3a20 4465 7669 6365 0a20 2020 2020  G : Device.     
+00023210: 2020 2041 2044 6576 6963 6520 636f 6e74     A Device cont
+00023220: 6169 6e69 6e67 2061 2066 6962 6572 2067  aining a fiber g
+00023230: 7261 7469 6e67 2067 656f 6d65 7472 792e  rating geometry.
+00023240: 0a20 2020 2022 2222 0a20 2020 2023 2072  .    """.    # r
+00023250: 6574 7572 6e73 2061 2066 6962 6572 2067  eturns a fiber g
+00023260: 7261 7469 6e67 0a20 2020 2047 203d 2044  rating.    G = D
+00023270: 6576 6963 6528 2267 7261 7469 6e67 2229  evice("grating")
+00023280: 0a0a 2020 2020 2320 6d61 6b65 2074 6865  ..    # make the
+00023290: 2064 6565 7020 6574 6368 6564 2067 7261   deep etched gra
+000232a0: 7469 6e67 0a20 2020 2069 6620 7061 7274  ting.    if part
+000232b0: 6961 6c5f 6574 6368 2069 7320 4661 6c73  ial_etch is Fals
+000232c0: 653a 0a20 2020 2020 2020 2023 206d 616b  e:.        # mak
+000232d0: 6520 7468 6520 6772 6174 696e 6720 7465  e the grating te
+000232e0: 6574 680a 2020 2020 2020 2020 666f 7220  eth.        for 
+000232f0: 6920 696e 2072 616e 6765 286e 756d 5f70  i in range(num_p
+00023300: 6572 696f 6473 293a 0a20 2020 2020 2020  eriods):.       
+00023310: 2020 2020 2063 6772 6174 696e 6720 3d20       cgrating = 
+00023320: 472e 6164 645f 7265 6628 0a20 2020 2020  G.add_ref(.     
+00023330: 2020 2020 2020 2020 2020 2063 6f6d 7061             compa
+00023340: 7373 2873 697a 653d 5b70 6572 696f 6420  ss(size=[period 
+00023350: 2a20 6669 6c6c 5f66 6163 746f 722c 2077  * fill_factor, w
+00023360: 6964 7468 5f67 7261 7469 6e67 5d2c 206c  idth_grating], l
+00023370: 6179 6572 3d30 290a 2020 2020 2020 2020  ayer=0).        
+00023380: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00023390: 2020 6367 7261 7469 6e67 2e78 202b 3d20    cgrating.x += 
+000233a0: 6920 2a20 7065 7269 6f64 0a0a 2020 2020  i * period..    
+000233b0: 2020 2020 2320 6d61 6b65 2074 6865 2074      # make the t
+000233c0: 6170 6572 0a20 2020 2020 2020 2074 6772  aper.        tgr
+000233d0: 6174 696e 6720 3d20 472e 6164 645f 7265  ating = G.add_re
+000233e0: 6628 0a20 2020 2020 2020 2020 2020 2074  f(.            t
+000233f0: 6170 6572 280a 2020 2020 2020 2020 2020  aper(.          
+00023400: 2020 2020 2020 6c65 6e67 7468 3d6c 656e        length=len
+00023410: 6774 685f 7461 7065 722c 0a20 2020 2020  gth_taper,.     
+00023420: 2020 2020 2020 2020 2020 2077 6964 7468             width
+00023430: 313d 7769 6474 685f 6772 6174 696e 672c  1=width_grating,
+00023440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023450: 2077 6964 7468 323d 7769 6474 682c 0a20   width2=width,. 
+00023460: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00023470: 6f72 743d 4e6f 6e65 2c0a 2020 2020 2020  ort=None,.      
+00023480: 2020 2020 2020 2020 2020 6c61 7965 723d            layer=
+00023490: 302c 0a20 2020 2020 2020 2020 2020 2029  0,.            )
+000234a0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+000234b0: 2020 2074 6772 6174 696e 672e 786d 696e     tgrating.xmin
+000234c0: 203d 2063 6772 6174 696e 672e 786d 6178   = cgrating.xmax
+000234d0: 0a20 2020 2020 2020 2023 2064 6566 696e  .        # defin
+000234e0: 6520 7468 6520 706f 7274 206f 6620 7468  e the port of th
+000234f0: 6520 6772 6174 696e 670a 2020 2020 2020  e grating.      
+00023500: 2020 7020 3d20 472e 6164 645f 706f 7274    p = G.add_port
+00023510: 2870 6f72 743d 7467 7261 7469 6e67 2e70  (port=tgrating.p
+00023520: 6f72 7473 5b32 5d2c 206e 616d 653d 3129  orts[2], name=1)
+00023530: 0a20 2020 2023 206d 616b 6520 6120 7061  .    # make a pa
+00023540: 7274 6961 6c6c 7920 6574 6368 6564 2067  rtially etched g
+00023550: 7261 7469 6e67 0a20 2020 2069 6620 7061  rating.    if pa
+00023560: 7274 6961 6c5f 6574 6368 2069 7320 5472  rtial_etch is Tr
+00023570: 7565 3a0a 2020 2020 2020 2020 2320 6861  ue:.        # ha
+00023580: 7264 2063 6f64 6564 206f 7665 726c 6170  rd coded overlap
+00023590: 0a20 2020 2020 2020 2070 6172 7465 7463  .        partetc
+000235a0: 685f 6f76 6572 6861 6e67 203d 2035 0a20  h_overhang = 5. 
+000235b0: 2020 2020 2020 2023 206d 616b 6520 7468         # make th
+000235c0: 6520 6574 6368 6564 2061 7265 6173 2028  e etched areas (
+000235d0: 6f70 706f 7369 7465 2074 6f20 7465 6574  opposite to teet
+000235e0: 6829 0a20 2020 2020 2020 2066 6f72 2069  h).        for i
+000235f0: 2069 6e20 7261 6e67 6528 6e75 6d5f 7065   in range(num_pe
+00023600: 7269 6f64 7329 3a0a 2020 2020 2020 2020  riods):.        
+00023610: 2020 2020 6367 7261 7469 6e67 203d 2047      cgrating = G
+00023620: 2e61 6464 5f72 6566 280a 2020 2020 2020  .add_ref(.      
+00023630: 2020 2020 2020 2020 2020 636f 6d70 6173            compas
+00023640: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
+00023650: 2020 2020 2020 2073 697a 653d 5b0a 2020         size=[.  
+00023660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023670: 2020 2020 2020 7065 7269 6f64 202a 2028        period * (
+00023680: 3120 2d20 6669 6c6c 5f66 6163 746f 7229  1 - fill_factor)
+00023690: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000236a0: 2020 2020 2020 2020 2020 7769 6474 685f            width_
+000236b0: 6772 6174 696e 6720 2b20 7061 7274 6574  grating + partet
+000236c0: 6368 5f6f 7665 7268 616e 6720 2a20 322c  ch_overhang * 2,
+000236d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000236e0: 2020 2020 205d 2c0a 2020 2020 2020 2020       ],.        
+000236f0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00023700: 723d 312c 0a20 2020 2020 2020 2020 2020  r=1,.           
+00023710: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00023720: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00023730: 2063 6772 6174 696e 672e 7820 2b3d 2069   cgrating.x += i
+00023740: 202a 2070 6572 696f 640a 2020 2020 2020   * period.      
+00023750: 2020 2320 6465 6669 6e65 2074 6865 2070    # define the p
+00023760: 6f72 7420 6f66 2074 6865 2067 7261 7469  ort of the grati
+00023770: 6e67 0a20 2020 2020 2020 2070 203d 2047  ng.        p = G
+00023780: 2e61 6464 5f70 6f72 7428 706f 7274 3d63  .add_port(port=c
+00023790: 6772 6174 696e 672e 706f 7274 735b 2245  grating.ports["E
+000237a0: 225d 2c20 6e61 6d65 3d31 290a 2020 2020  "], name=1).    
+000237b0: 2020 2020 702e 6d69 6470 6f69 6e74 203d      p.midpoint =
+000237c0: 2070 2e6d 6964 706f 696e 7420 2b20 6e70   p.midpoint + np
+000237d0: 2e61 7272 6179 285b 2831 202d 2066 696c  .array([(1 - fil
+000237e0: 6c5f 6661 6374 6f72 2920 2a20 7065 7269  l_factor) * peri
+000237f0: 6f64 2c20 305d 290a 0a20 2020 2020 2020  od, 0])..       
+00023800: 2023 2064 7261 7720 7468 6520 6465 6570   # draw the deep
+00023810: 2065 7463 6865 6420 7371 7561 7265 2061   etched square a
+00023820: 726f 756e 6420 7468 6520 6772 6174 696e  round the gratin
+00023830: 670a 2020 2020 2020 2020 472e 6164 645f  g.        G.add_
+00023840: 7265 6628 2020 2320 6465 6570 626f 780a  ref(  # deepbox.
+00023850: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+00023860: 6173 7328 7369 7a65 3d5b 6e75 6d5f 7065  ass(size=[num_pe
+00023870: 7269 6f64 7320 2a20 7065 7269 6f64 2c20  riods * period, 
+00023880: 7769 6474 685f 6772 6174 696e 675d 2c20  width_grating], 
+00023890: 6c61 7965 723d 3029 0a20 2020 2020 2020  layer=0).       
+000238a0: 2029 0a20 2020 2072 6574 7572 6e20 470a   ).    return G.
+000238b0: 0a0a 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ..# ============
+000238c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000238d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000238e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000238f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00023900: 3d3d 0a23 2045 7861 6d70 6c65 2063 6f64  ==.# Example cod
+00023910: 650a 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  e.# ============
+00023920: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00023930: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00023940: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00023950: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00023960: 3d3d 0a0a 2320 4720 3d20 6772 6174 696e  ==..# G = gratin
+00023970: 6728 6e75 6d5f 7065 7269 6f64 7320 3d20  g(num_periods = 
+00023980: 3230 2c20 7065 7269 6f64 203d 2030 2e37  20, period = 0.7
+00023990: 352c 2066 696c 6c5f 6661 6374 6f72 203d  5, fill_factor =
+000239a0: 2030 2e35 2c0a 2320 2020 2020 2020 2020   0.5,.#         
+000239b0: 2020 2020 7769 6474 685f 6772 6174 696e      width_gratin
+000239c0: 6720 3d20 3230 2c20 6c65 6e67 7468 5f74  g = 20, length_t
+000239d0: 6170 6572 203d 2031 302c 2077 6964 7468  aper = 10, width
+000239e0: 203d 2030 2e34 2c0a 2320 2020 2020 2020   = 0.4,.#       
+000239f0: 2020 2020 2020 7061 7274 6961 6c5f 6574        partial_et
+00023a00: 6368 203d 2046 616c 7365 290a 2320 7175  ch = False).# qu
+00023a10: 6963 6b70 6c6f 7428 4729 0a0a 0a23 203d  ickplot(G)...# =
+00023a20: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00023a30: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00023a40: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00023a50: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00023a60: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 230a  =============.#.
+00023a70: 2320 5465 7374 2053 7472 7563 7475 7265  # Test Structure
+00023a80: 730a 230a 2320 3d3d 3d3d 3d3d 3d3d 3d3d  s.#.# ==========
+00023a90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00023aa0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00023ab0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00023ac0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00023ad0: 3d3d 3d3d 0a0a 0a23 2056 6961 2052 6f75  ====...# Via Rou
+00023ae0: 7465 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  te -------------
+00023af0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00023b00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 6465 6620  -----------.def 
+00023b10: 5f76 6961 5f69 7465 7261 626c 6528 0a20  _via_iterable(. 
+00023b20: 2020 2076 6961 5f73 7061 6369 6e67 2c20     via_spacing, 
+00023b30: 7769 7265 5f77 6964 7468 2c20 7769 7269  wire_width, wiri
+00023b40: 6e67 315f 6c61 7965 722c 2077 6972 696e  ng1_layer, wirin
+00023b50: 6732 5f6c 6179 6572 2c20 7669 615f 6c61  g2_layer, via_la
+00023b60: 7965 722c 2076 6961 5f77 6964 7468 0a29  yer, via_width.)
+00023b70: 3a0a 2020 2020 2222 2248 656c 7065 7220  :.    """Helper 
+00023b80: 6675 6e63 7469 6f6e 2066 6f72 2074 6573  function for tes
+00023b90: 745f 7669 610a 0a20 2020 2050 6172 616d  t_via..    Param
+00023ba0: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
+00023bb0: 2d2d 2d2d 0a20 2020 2076 6961 5f73 7061  ----.    via_spa
+00023bc0: 6369 6e67 203a 2069 6e74 206f 7220 666c  cing : int or fl
+00023bd0: 6f61 740a 2020 2020 2020 2020 4469 7374  oat.        Dist
+00023be0: 616e 6365 2062 6574 7765 656e 2076 6961  ance between via
+00023bf0: 732e 0a20 2020 2077 6972 655f 7769 6474  s..    wire_widt
+00023c00: 6820 3a20 696e 7420 6f72 2066 6c6f 6174  h : int or float
+00023c10: 0a20 2020 2020 2020 2054 6865 2077 6964  .        The wid
+00023c20: 7468 206f 6620 7468 6520 7769 7265 732e  th of the wires.
+00023c30: 0a20 2020 2077 6972 696e 6731 5f6c 6179  .    wiring1_lay
+00023c40: 6572 203a 2069 6e74 0a20 2020 2020 2020  er : int.       
+00023c50: 2053 7065 6369 6669 6320 6c61 7965 7220   Specific layer 
+00023c60: 746f 2070 7574 2074 6865 2074 6f70 2077  to put the top w
+00023c70: 6972 696e 6720 6f6e 2e0a 2020 2020 7769  iring on..    wi
+00023c80: 7269 6e67 325f 6c61 7965 7220 3a20 696e  ring2_layer : in
+00023c90: 740a 2020 2020 2020 2020 5370 6563 6966  t.        Specif
+00023ca0: 6963 206c 6179 6572 2074 6f20 7075 7420  ic layer to put 
+00023cb0: 7468 6520 626f 7474 6f6d 2077 6972 696e  the bottom wirin
+00023cc0: 6720 6f6e 2e0a 2020 2020 7669 615f 6c61  g on..    via_la
+00023cd0: 7965 7220 3a20 696e 740a 2020 2020 2020  yer : int.      
+00023ce0: 2020 5370 6563 6966 6963 206c 6179 6572    Specific layer
+00023cf0: 2074 6f20 7075 7420 7468 6520 7669 6173   to put the vias
+00023d00: 206f 6e2e 0a20 2020 2076 6961 5f77 6964   on..    via_wid
+00023d10: 7468 203a 2069 6e74 206f 7220 666c 6f61  th : int or floa
+00023d20: 740a 2020 2020 2020 2020 4469 616d 6574  t.        Diamet
+00023d30: 6572 206f 6620 7468 6520 7669 6173 2e0a  er of the vias..
+00023d40: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
+00023d50: 202d 2d2d 2d2d 2d2d 0a20 2020 2056 4920   -------.    VI 
+00023d60: 3a20 4465 7669 6365 0a0a 2020 2020 2222  : Device..    ""
+00023d70: 220a 2020 2020 5649 203d 2044 6576 6963  ".    VI = Devic
+00023d80: 6528 2274 6573 745f 7669 615f 6974 6572  e("test_via_iter
+00023d90: 2229 0a20 2020 2077 6972 6531 203d 2056  ").    wire1 = V
+00023da0: 492e 6164 645f 7265 6628 636f 6d70 6173  I.add_ref(compas
+00023db0: 7328 7369 7a65 3d28 7669 615f 7370 6163  s(size=(via_spac
+00023dc0: 696e 672c 2077 6972 655f 7769 6474 6829  ing, wire_width)
+00023dd0: 2c20 6c61 7965 723d 7769 7269 6e67 315f  , layer=wiring1_
+00023de0: 6c61 7965 7229 290a 2020 2020 7769 7265  layer)).    wire
+00023df0: 3220 3d20 5649 2e61 6464 5f72 6566 2863  2 = VI.add_ref(c
+00023e00: 6f6d 7061 7373 2873 697a 653d 2876 6961  ompass(size=(via
+00023e10: 5f73 7061 6369 6e67 2c20 7769 7265 5f77  _spacing, wire_w
+00023e20: 6964 7468 292c 206c 6179 6572 3d77 6972  idth), layer=wir
+00023e30: 696e 6732 5f6c 6179 6572 2929 0a20 2020  ing2_layer)).   
+00023e40: 2076 6961 3120 3d20 5649 2e61 6464 5f72   via1 = VI.add_r
+00023e50: 6566 2863 6f6d 7061 7373 2873 697a 653d  ef(compass(size=
+00023e60: 2876 6961 5f77 6964 7468 2c20 7669 615f  (via_width, via_
+00023e70: 7769 6474 6829 2c20 6c61 7965 723d 7669  width), layer=vi
+00023e80: 615f 6c61 7965 7229 290a 2020 2020 7669  a_layer)).    vi
+00023e90: 6132 203d 2056 492e 6164 645f 7265 6628  a2 = VI.add_ref(
+00023ea0: 636f 6d70 6173 7328 7369 7a65 3d28 7669  compass(size=(vi
+00023eb0: 615f 7769 6474 682c 2076 6961 5f77 6964  a_width, via_wid
+00023ec0: 7468 292c 206c 6179 6572 3d76 6961 5f6c  th), layer=via_l
+00023ed0: 6179 6572 2929 0a20 2020 2077 6972 6531  ayer)).    wire1
+00023ee0: 2e63 6f6e 6e65 6374 2870 6f72 743d 2245  .connect(port="E
+00023ef0: 222c 2064 6573 7469 6e61 7469 6f6e 3d77  ", destination=w
+00023f00: 6972 6532 2e70 6f72 7473 5b22 5722 5d2c  ire2.ports["W"],
+00023f10: 206f 7665 726c 6170 3d77 6972 655f 7769   overlap=wire_wi
+00023f20: 6474 6829 0a20 2020 2076 6961 312e 636f  dth).    via1.co
+00023f30: 6e6e 6563 7428 0a20 2020 2020 2020 2070  nnect(.        p
+00023f40: 6f72 743d 2257 222c 2064 6573 7469 6e61  ort="W", destina
+00023f50: 7469 6f6e 3d77 6972 6531 2e70 6f72 7473  tion=wire1.ports
+00023f60: 5b22 4522 5d2c 206f 7665 726c 6170 3d28  ["E"], overlap=(
+00023f70: 7769 7265 5f77 6964 7468 202b 2076 6961  wire_width + via
+00023f80: 5f77 6964 7468 2920 2f20 320a 2020 2020  _width) / 2.    
+00023f90: 290a 2020 2020 7669 6132 2e63 6f6e 6e65  ).    via2.conne
+00023fa0: 6374 280a 2020 2020 2020 2020 706f 7274  ct(.        port
+00023fb0: 3d22 5722 2c20 6465 7374 696e 6174 696f  ="W", destinatio
+00023fc0: 6e3d 7769 7265 322e 706f 7274 735b 2245  n=wire2.ports["E
+00023fd0: 225d 2c20 6f76 6572 6c61 703d 2877 6972  "], overlap=(wir
+00023fe0: 655f 7769 6474 6820 2b20 7669 615f 7769  e_width + via_wi
+00023ff0: 6474 6829 202f 2032 0a20 2020 2029 0a20  dth) / 2.    ). 
+00024000: 2020 2056 492e 6164 645f 706f 7274 286e     VI.add_port(n
+00024010: 616d 653d 2257 222c 2070 6f72 743d 7769  ame="W", port=wi
+00024020: 7265 312e 706f 7274 735b 2257 225d 290a  re1.ports["W"]).
+00024030: 2020 2020 5649 2e61 6464 5f70 6f72 7428      VI.add_port(
+00024040: 6e61 6d65 3d22 4522 2c20 706f 7274 3d77  name="E", port=w
+00024050: 6972 6532 2e70 6f72 7473 5b22 4522 5d29  ire2.ports["E"])
+00024060: 0a20 2020 2056 492e 6164 645f 706f 7274  .    VI.add_port
+00024070: 280a 2020 2020 2020 2020 6e61 6d65 3d22  (.        name="
+00024080: 5322 2c0a 2020 2020 2020 2020 6d69 6470  S",.        midp
+00024090: 6f69 6e74 3d5b 2831 202a 2077 6972 655f  oint=[(1 * wire_
+000240a0: 7769 6474 6829 202b 2077 6972 655f 7769  width) + wire_wi
+000240b0: 6474 6820 2f20 322c 202d 7769 7265 5f77  dth / 2, -wire_w
+000240c0: 6964 7468 202f 2032 5d2c 0a20 2020 2020  idth / 2],.     
+000240d0: 2020 2077 6964 7468 3d77 6972 655f 7769     width=wire_wi
+000240e0: 6474 682c 0a20 2020 2020 2020 206f 7269  dth,.        ori
+000240f0: 656e 7461 7469 6f6e 3d2d 3930 2c0a 2020  entation=-90,.  
+00024100: 2020 290a 2020 2020 5649 2e61 6464 5f70    ).    VI.add_p
+00024110: 6f72 7428 0a20 2020 2020 2020 206e 616d  ort(.        nam
+00024120: 653d 224e 222c 0a20 2020 2020 2020 206d  e="N",.        m
+00024130: 6964 706f 696e 743d 5b28 3120 2a20 7769  idpoint=[(1 * wi
+00024140: 7265 5f77 6964 7468 2920 2b20 7769 7265  re_width) + wire
+00024150: 5f77 6964 7468 202f 2032 2c20 7769 7265  _width / 2, wire
+00024160: 5f77 6964 7468 202f 2032 5d2c 0a20 2020  _width / 2],.   
+00024170: 2020 2020 2077 6964 7468 3d77 6972 655f       width=wire_
+00024180: 7769 6474 682c 0a20 2020 2020 2020 206f  width,.        o
+00024190: 7269 656e 7461 7469 6f6e 3d39 302c 0a20  rientation=90,. 
+000241a0: 2020 2029 0a0a 2020 2020 7265 7475 726e     )..    return
+000241b0: 2056 490a 0a0a 6465 6620 7465 7374 5f76   VI...def test_v
+000241c0: 6961 280a 2020 2020 6e75 6d5f 7669 6173  ia(.    num_vias
+000241d0: 3d31 3030 2c0a 2020 2020 7769 7265 5f77  =100,.    wire_w
+000241e0: 6964 7468 3d31 302c 0a20 2020 2076 6961  idth=10,.    via
+000241f0: 5f77 6964 7468 3d31 352c 0a20 2020 2076  _width=15,.    v
+00024200: 6961 5f73 7061 6369 6e67 3d34 302c 0a20  ia_spacing=40,. 
+00024210: 2020 2070 6164 5f73 697a 653d 2833 3030     pad_size=(300
+00024220: 2c20 3330 3029 2c0a 2020 2020 6d69 6e5f  , 300),.    min_
+00024230: 7061 645f 7370 6163 696e 673d 302c 0a20  pad_spacing=0,. 
+00024240: 2020 2070 6164 5f6c 6179 6572 3d30 2c0a     pad_layer=0,.
+00024250: 2020 2020 7769 7269 6e67 315f 6c61 7965      wiring1_laye
+00024260: 723d 312c 0a20 2020 2077 6972 696e 6732  r=1,.    wiring2
+00024270: 5f6c 6179 6572 3d32 2c0a 2020 2020 7669  _layer=2,.    vi
+00024280: 615f 6c61 7965 723d 332c 0a29 3a0a 2020  a_layer=3,.):.  
+00024290: 2020 2222 2256 6961 2063 6861 696e 2074    """Via chain t
+000242a0: 6573 7420 7374 7275 6374 7572 650a 0a20  est structure.. 
+000242b0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+000242c0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+000242d0: 206e 756d 5f76 6961 7320 3a20 696e 740a   num_vias : int.
+000242e0: 2020 2020 2020 2020 5468 6520 746f 7461          The tota
+000242f0: 6c20 6e75 6d62 6572 206f 6620 7265 7175  l number of requ
+00024300: 6573 7465 6420 7669 6173 2028 6d75 7374  ested vias (must
+00024310: 2062 6520 616e 2065 7665 6e20 6e75 6d62   be an even numb
+00024320: 6572 292e 0a20 2020 2077 6972 655f 7769  er)..    wire_wi
+00024330: 6474 6820 3a20 696e 7420 6f72 2066 6c6f  dth : int or flo
+00024340: 6174 0a20 2020 2020 2020 2054 6865 2077  at.        The w
+00024350: 6964 7468 206f 6620 7468 6520 7769 7265  idth of the wire
+00024360: 732e 0a20 2020 2076 6961 5f77 6964 7468  s..    via_width
+00024370: 203a 2069 6e74 206f 7220 666c 6f61 740a   : int or float.
+00024380: 2020 2020 2020 2020 4469 616d 6574 6572          Diameter
+00024390: 206f 6620 7468 6520 7669 6173 2e0a 2020   of the vias..  
+000243a0: 2020 7669 615f 7370 6163 696e 6720 3a20    via_spacing : 
+000243b0: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
+000243c0: 2020 2020 2044 6973 7461 6e63 6520 6265       Distance be
+000243d0: 7477 6565 6e20 7669 6173 2e0a 2020 2020  tween vias..    
+000243e0: 7061 645f 7369 7a65 203a 2061 7272 6179  pad_size : array
+000243f0: 2d6c 696b 655b 325d 0a20 2020 2020 2020  -like[2].       
+00024400: 2028 7769 6474 682c 2068 6569 6768 7429   (width, height)
+00024410: 206f 6620 7468 6520 7061 6473 2e0a 2020   of the pads..  
+00024420: 2020 6d69 6e5f 7061 645f 7370 6163 696e    min_pad_spacin
+00024430: 6720 3a20 696e 7420 6f72 2066 6c6f 6174  g : int or float
+00024440: 0a20 2020 2020 2020 2044 6566 696e 6573  .        Defines
+00024450: 2074 6865 206d 696e 696d 756d 2064 6973   the minimum dis
+00024460: 7461 6e63 6520 6265 7477 6565 6e20 7468  tance between th
+00024470: 6520 7477 6f20 7061 6473 2e0a 2020 2020  e two pads..    
+00024480: 7061 645f 6c61 7965 7220 3a20 696e 740a  pad_layer : int.
+00024490: 2020 2020 2020 2020 5370 6563 6966 6963          Specific
+000244a0: 206c 6179 6572 2074 6f20 7075 7420 7468   layer to put th
+000244b0: 6520 7061 6473 206f 6e2e 0a20 2020 2077  e pads on..    w
+000244c0: 6972 696e 6731 5f6c 6179 6572 203a 2069  iring1_layer : i
+000244d0: 6e74 0a20 2020 2020 2020 2053 7065 6369  nt.        Speci
+000244e0: 6669 6320 6c61 7965 7220 746f 2070 7574  fic layer to put
+000244f0: 2074 6865 2074 6f70 2077 6972 696e 6720   the top wiring 
+00024500: 6f6e 2e0a 2020 2020 7769 7269 6e67 325f  on..    wiring2_
+00024510: 6c61 7965 7220 3a20 696e 740a 2020 2020  layer : int.    
+00024520: 2020 2020 5370 6563 6966 6963 206c 6179      Specific lay
+00024530: 6572 2074 6f20 7075 7420 7468 6520 626f  er to put the bo
+00024540: 7474 6f6d 2077 6972 696e 6720 6f6e 2e0a  ttom wiring on..
+00024550: 2020 2020 7669 615f 6c61 7965 7220 3a20      via_layer : 
+00024560: 696e 740a 2020 2020 2020 2020 5370 6563  int.        Spec
+00024570: 6966 6963 206c 6179 6572 2074 6f20 7075  ific layer to pu
+00024580: 7420 7468 6520 7669 6173 206f 6e2e 0a0a  t the vias on...
+00024590: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+000245a0: 2d2d 2d2d 2d2d 2d0a 2020 2020 5652 203a  -------.    VR :
+000245b0: 2044 6576 6963 650a 2020 2020 2020 2020   Device.        
+000245c0: 4120 4465 7669 6365 2063 6f6e 7461 696e  A Device contain
+000245d0: 696e 6720 7468 6520 7465 7374 2076 6961  ing the test via
+000245e0: 2073 7472 7563 7475 7265 732e 0a0a 2020   structures...  
+000245f0: 2020 5573 6167 650a 2020 2020 2d2d 2d2d    Usage.    ----
+00024600: 2d0a 2020 2020 4361 6c6c 2076 6961 5f72  -.    Call via_r
+00024610: 6f75 7465 5f74 6573 745f 7374 7275 6374  oute_test_struct
+00024620: 7572 6528 2920 6279 2069 6e64 6963 6174  ure() by indicat
+00024630: 696e 6720 7468 6520 6e75 6d62 6572 206f  ing the number o
+00024640: 6620 7669 6173 2079 6f75 2077 616e 740a  f vias you want.
+00024650: 2020 2020 6472 6177 6e2e 2059 6f75 2063      drawn. You c
+00024660: 616e 2061 6c73 6f20 6368 616e 6765 2074  an also change t
+00024670: 6865 206f 7468 6572 2070 6172 616d 6574  he other paramet
+00024680: 6572 7320 686f 7765 7665 7220 6966 2079  ers however if y
+00024690: 6f75 2064 6f20 6e6f 740a 2020 2020 7370  ou do not.    sp
+000246a0: 6563 6966 6979 2061 2076 616c 7565 2066  ecifiy a value f
+000246b0: 6f72 2061 2070 6172 616d 6574 6572 2069  or a parameter i
+000246c0: 7420 7769 6c6c 206a 7573 7420 7573 6520  t will just use 
+000246d0: 7468 6520 6465 6661 756c 7420 7661 6c75  the default valu
+000246e0: 650a 2020 2020 4578 3a3a 0a0a 2020 2020  e.    Ex::..    
+000246f0: 2020 2020 7669 615f 726f 7574 655f 7465      via_route_te
+00024700: 7374 5f73 7472 7563 7475 7265 286e 756d  st_structure(num
+00024710: 5f76 6961 733d 3534 290a 0a20 2020 202d  _vias=54)..    -
+00024720: 206f 7220 2d3a 3a0a 0a20 2020 2020 2020   or -::..       
+00024730: 2076 6961 5f72 6f75 7465 5f74 6573 745f   via_route_test_
+00024740: 7374 7275 6374 7572 6528 6e75 6d5f 7669  structure(num_vi
+00024750: 6173 3d31 322c 2070 6164 5f73 697a 653d  as=12, pad_size=
+00024760: 2831 3030 2c31 3030 292c 7769 7265 5f77  (100,100),wire_w
+00024770: 6964 7468 3d38 290a 0a20 2020 2065 783a  idth=8)..    ex:
+00024780: 2076 6961 5f72 6f75 7465 2835 342c 206d   via_route(54, m
+00024790: 696e 5f70 6164 5f73 7061 6369 6e67 3d33  in_pad_spacing=3
+000247a0: 3030 290a 2020 2020 2222 220a 2020 2020  00).    """.    
+000247b0: 5652 203d 2044 6576 6963 6528 2274 6573  VR = Device("tes
+000247c0: 745f 7669 6122 290a 2020 2020 7061 6431  t_via").    pad1
+000247d0: 203d 2056 522e 6164 645f 7265 6628 7265   = VR.add_ref(re
+000247e0: 6374 616e 676c 6528 7369 7a65 3d70 6164  ctangle(size=pad
+000247f0: 5f73 697a 652c 206c 6179 6572 3d70 6164  _size, layer=pad
+00024800: 5f6c 6179 6572 2929 0a20 2020 2070 6164  _layer)).    pad
+00024810: 315f 6f76 6572 6c61 7920 3d20 5652 2e61  1_overlay = VR.a
+00024820: 6464 5f72 6566 2872 6563 7461 6e67 6c65  dd_ref(rectangle
+00024830: 2873 697a 653d 7061 645f 7369 7a65 2c20  (size=pad_size, 
+00024840: 6c61 7965 723d 7769 7269 6e67 315f 6c61  layer=wiring1_la
+00024850: 7965 7229 290a 2020 2020 7061 6432 203d  yer)).    pad2 =
+00024860: 2056 522e 6164 645f 7265 6628 7265 6374   VR.add_ref(rect
+00024870: 616e 676c 6528 7369 7a65 3d70 6164 5f73  angle(size=pad_s
+00024880: 697a 652c 206c 6179 6572 3d70 6164 5f6c  ize, layer=pad_l
+00024890: 6179 6572 2929 0a20 2020 2070 6164 325f  ayer)).    pad2_
+000248a0: 6f76 6572 6c61 7920 3d20 5652 2e61 6464  overlay = VR.add
+000248b0: 5f72 6566 2872 6563 7461 6e67 6c65 2873  _ref(rectangle(s
+000248c0: 697a 653d 7061 645f 7369 7a65 2c20 6c61  ize=pad_size, la
+000248d0: 7965 723d 7769 7269 6e67 315f 6c61 7965  yer=wiring1_laye
+000248e0: 7229 290a 2020 2020 6e75 6220 3d20 5652  r)).    nub = VR
+000248f0: 2e61 6464 5f72 6566 2863 6f6d 7061 7373  .add_ref(compass
+00024900: 2873 697a 653d 2833 202a 2077 6972 655f  (size=(3 * wire_
+00024910: 7769 6474 682c 2077 6972 655f 7769 6474  width, wire_widt
+00024920: 6829 2c20 6c61 7965 723d 7061 645f 6c61  h), layer=pad_la
+00024930: 7965 7229 290a 2020 2020 6e75 625f 6f76  yer)).    nub_ov
+00024940: 6572 6c61 7920 3d20 5652 2e61 6464 5f72  erlay = VR.add_r
+00024950: 6566 280a 2020 2020 2020 2020 636f 6d70  ef(.        comp
+00024960: 6173 7328 7369 7a65 3d28 3320 2a20 7769  ass(size=(3 * wi
+00024970: 7265 5f77 6964 7468 2c20 7769 7265 5f77  re_width, wire_w
+00024980: 6964 7468 292c 206c 6179 6572 3d77 6972  idth), layer=wir
+00024990: 696e 6731 5f6c 6179 6572 290a 2020 2020  ing1_layer).    
+000249a0: 290a 2020 2020 6865 6164 203d 2056 522e  ).    head = VR.
+000249b0: 6164 645f 7265 6628 636f 6d70 6173 7328  add_ref(compass(
+000249c0: 7369 7a65 3d28 7769 7265 5f77 6964 7468  size=(wire_width
+000249d0: 2c20 7769 7265 5f77 6964 7468 292c 206c  , wire_width), l
+000249e0: 6179 6572 3d70 6164 5f6c 6179 6572 2929  ayer=pad_layer))
+000249f0: 0a20 2020 2068 6561 645f 6f76 6572 6c61  .    head_overla
+00024a00: 7920 3d20 5652 2e61 6464 5f72 6566 280a  y = VR.add_ref(.
+00024a10: 2020 2020 2020 2020 636f 6d70 6173 7328          compass(
+00024a20: 7369 7a65 3d28 7769 7265 5f77 6964 7468  size=(wire_width
+00024a30: 2c20 7769 7265 5f77 6964 7468 292c 206c  , wire_width), l
+00024a40: 6179 6572 3d77 6972 696e 6731 5f6c 6179  ayer=wiring1_lay
+00024a50: 6572 290a 2020 2020 290a 2020 2020 6e75  er).    ).    nu
+00024a60: 622e 796d 6178 203d 2070 6164 312e 796d  b.ymax = pad1.ym
+00024a70: 6178 202d 2035 0a20 2020 206e 7562 2e78  ax - 5.    nub.x
+00024a80: 6d69 6e20 3d20 7061 6431 2e78 6d61 780a  min = pad1.xmax.
+00024a90: 2020 2020 6e75 625f 6f76 6572 6c61 792e      nub_overlay.
+00024aa0: 796d 6178 203d 2070 6164 312e 796d 6178  ymax = pad1.ymax
+00024ab0: 202d 2035 0a20 2020 206e 7562 5f6f 7665   - 5.    nub_ove
+00024ac0: 726c 6179 2e78 6d69 6e20 3d20 7061 6431  rlay.xmin = pad1
+00024ad0: 2e78 6d61 780a 2020 2020 6865 6164 2e63  .xmax.    head.c
+00024ae0: 6f6e 6e65 6374 2870 6f72 743d 2257 222c  onnect(port="W",
+00024af0: 2064 6573 7469 6e61 7469 6f6e 3d6e 7562   destination=nub
+00024b00: 2e70 6f72 7473 5b22 4522 5d29 0a20 2020  .ports["E"]).   
+00024b10: 2068 6561 645f 6f76 6572 6c61 792e 636f   head_overlay.co
+00024b20: 6e6e 6563 7428 706f 7274 3d22 5722 2c20  nnect(port="W", 
+00024b30: 6465 7374 696e 6174 696f 6e3d 6e75 625f  destination=nub_
+00024b40: 6f76 6572 6c61 792e 706f 7274 735b 2245  overlay.ports["E
+00024b50: 225d 290a 2020 2020 7061 6431 5f6f 7665  "]).    pad1_ove
+00024b60: 726c 6179 2e78 6d69 6e20 3d20 7061 6431  rlay.xmin = pad1
+00024b70: 2e78 6d69 6e0a 2020 2020 7061 6431 5f6f  .xmin.    pad1_o
+00024b80: 7665 726c 6179 2e79 6d69 6e20 3d20 7061  verlay.ymin = pa
+00024b90: 6431 2e79 6d69 6e0a 0a20 2020 206f 6c64  d1.ymin..    old
+00024ba0: 5f70 6f72 7420 3d20 6865 6164 2e70 6f72  _port = head.por
+00024bb0: 7473 5b22 5322 5d0a 2020 2020 636f 756e  ts["S"].    coun
+00024bc0: 7420 3d20 300a 2020 2020 7769 6474 685f  t = 0.    width_
+00024bd0: 7669 615f 6974 6572 203d 2032 202a 2076  via_iter = 2 * v
+00024be0: 6961 5f73 7061 6369 6e67 202d 2032 202a  ia_spacing - 2 *
+00024bf0: 2077 6972 655f 7769 6474 680a 0a20 2020   wire_width..   
+00024c00: 2070 6164 322e 786d 696e 203d 2070 6164   pad2.xmin = pad
+00024c10: 312e 786d 6178 202b 206d 696e 5f70 6164  1.xmax + min_pad
+00024c20: 5f73 7061 6369 6e67 0a20 2020 2075 7020  _spacing.    up 
+00024c30: 3d20 4661 6c73 650a 2020 2020 646f 776e  = False.    down
+00024c40: 203d 2054 7275 650a 2020 2020 6564 6765   = True.    edge
+00024c50: 203d 2054 7275 650a 2020 2020 6375 7272   = True.    curr
+00024c60: 656e 745f 7769 6474 6820 3d20 3320 2a20  ent_width = 3 * 
+00024c70: 7769 7265 5f77 6964 7468 202b 2077 6972  wire_width + wir
+00024c80: 655f 7769 6474 6820 2023 2077 6964 7468  e_width  # width
+00024c90: 206f 6620 6e75 6220 616e 6420 3120 6f76   of nub and 1 ov
+00024ca0: 6572 6c61 700a 2020 2020 6f62 6a5f 6f6c  erlap.    obj_ol
+00024cb0: 6420 3d20 6865 6164 0a20 2020 206f 626a  d = head.    obj
+00024cc0: 203d 2068 6561 640a 2020 2020 7669 615f   = head.    via_
+00024cd0: 6974 6572 6162 6c65 203d 205f 7669 615f  iterable = _via_
+00024ce0: 6974 6572 6162 6c65 280a 2020 2020 2020  iterable(.      
+00024cf0: 2020 7669 615f 7370 6163 696e 672c 2077    via_spacing, w
+00024d00: 6972 655f 7769 6474 682c 2077 6972 696e  ire_width, wirin
+00024d10: 6731 5f6c 6179 6572 2c20 7769 7269 6e67  g1_layer, wiring
+00024d20: 325f 6c61 7965 722c 2076 6961 5f6c 6179  2_layer, via_lay
+00024d30: 6572 2c20 7669 615f 7769 6474 680a 2020  er, via_width.  
+00024d40: 2020 290a 2020 2020 7768 696c 6520 2863    ).    while (c
+00024d50: 6f75 6e74 202b 2032 2920 3c3d 206e 756d  ount + 2) <= num
+00024d60: 5f76 6961 733a 0a20 2020 2020 2020 206f  _vias:.        o
+00024d70: 626a 203d 2056 522e 6164 645f 7265 6628  bj = VR.add_ref(
+00024d80: 7669 615f 6974 6572 6162 6c65 290a 2020  via_iterable).  
+00024d90: 2020 2020 2020 6f62 6a2e 636f 6e6e 6563        obj.connec
+00024da0: 7428 706f 7274 3d22 5722 2c20 6465 7374  t(port="W", dest
+00024db0: 696e 6174 696f 6e3d 6f6c 645f 706f 7274  ination=old_port
+00024dc0: 2c20 6f76 6572 6c61 703d 7769 7265 5f77  , overlap=wire_w
+00024dd0: 6964 7468 290a 2020 2020 2020 2020 6f6c  idth).        ol
+00024de0: 645f 706f 7274 203d 206f 626a 2e70 6f72  d_port = obj.por
+00024df0: 7473 5b22 4522 5d0a 2020 2020 2020 2020  ts["E"].        
+00024e00: 6564 6765 203d 2046 616c 7365 0a20 2020  edge = False.   
+00024e10: 2020 2020 2069 6620 6f62 6a2e 796d 6178       if obj.ymax
+00024e20: 203e 2070 6164 312e 796d 6178 3a0a 2020   > pad1.ymax:.  
+00024e30: 2020 2020 2020 2020 2020 6f62 6a2e 636f            obj.co
+00024e40: 6e6e 6563 7428 706f 7274 3d22 5722 2c20  nnect(port="W", 
+00024e50: 6465 7374 696e 6174 696f 6e3d 6f62 6a5f  destination=obj_
+00024e60: 6f6c 642e 706f 7274 735b 2253 225d 2c20  old.ports["S"], 
+00024e70: 6f76 6572 6c61 703d 7769 7265 5f77 6964  overlap=wire_wid
+00024e80: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
+00024e90: 6f6c 645f 706f 7274 203d 206f 626a 2e70  old_port = obj.p
+00024ea0: 6f72 7473 5b22 5322 5d0a 2020 2020 2020  orts["S"].      
+00024eb0: 2020 2020 2020 6375 7272 656e 745f 7769        current_wi
+00024ec0: 6474 6820 2b3d 2077 6964 7468 5f76 6961  dth += width_via
+00024ed0: 5f69 7465 720a 2020 2020 2020 2020 2020  _iter.          
+00024ee0: 2020 646f 776e 203d 2054 7275 650a 2020    down = True.  
+00024ef0: 2020 2020 2020 2020 2020 7570 203d 2046            up = F
+00024f00: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00024f10: 2065 6467 6520 3d20 5472 7565 0a0a 2020   edge = True..  
+00024f20: 2020 2020 2020 656c 6966 206f 626a 2e79        elif obj.y
+00024f30: 6d69 6e20 3c20 7061 6431 2e79 6d69 6e3a  min < pad1.ymin:
+00024f40: 0a20 2020 2020 2020 2020 2020 206f 626a  .            obj
+00024f50: 2e63 6f6e 6e65 6374 2870 6f72 743d 2257  .connect(port="W
+00024f60: 222c 2064 6573 7469 6e61 7469 6f6e 3d6f  ", destination=o
+00024f70: 626a 5f6f 6c64 2e70 6f72 7473 5b22 4e22  bj_old.ports["N"
+00024f80: 5d2c 206f 7665 726c 6170 3d77 6972 655f  ], overlap=wire_
+00024f90: 7769 6474 6829 0a20 2020 2020 2020 2020  width).         
+00024fa0: 2020 206f 6c64 5f70 6f72 7420 3d20 6f62     old_port = ob
+00024fb0: 6a2e 706f 7274 735b 224e 225d 0a20 2020  j.ports["N"].   
+00024fc0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00024fd0: 5f77 6964 7468 202b 3d20 7769 6474 685f  _width += width_
+00024fe0: 7669 615f 6974 6572 0a20 2020 2020 2020  via_iter.       
+00024ff0: 2020 2020 2075 7020 3d20 5472 7565 0a20       up = True. 
+00025000: 2020 2020 2020 2020 2020 2064 6f77 6e20             down 
+00025010: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00025020: 2020 2020 6564 6765 203d 2054 7275 650a      edge = True.
+00025030: 2020 2020 2020 2020 636f 756e 7420 3d20          count = 
+00025040: 636f 756e 7420 2b20 320a 2020 2020 2020  count + 2.      
+00025050: 2020 6f62 6a5f 6f6c 6420 3d20 6f62 6a0a    obj_old = obj.
+00025060: 0a20 2020 2069 6620 280a 2020 2020 2020  .    if (.      
+00025070: 2020 6375 7272 656e 745f 7769 6474 6820    current_width 
+00025080: 3c20 6d69 6e5f 7061 645f 7370 6163 696e  < min_pad_spacin
+00025090: 670a 2020 2020 2020 2020 616e 6420 286d  g.        and (m
+000250a0: 696e 5f70 6164 5f73 7061 6369 6e67 202d  in_pad_spacing -
+000250b0: 2063 7572 7265 6e74 5f77 6964 7468 2920   current_width) 
+000250c0: 3e20 3320 2a20 7769 7265 5f77 6964 7468  > 3 * wire_width
+000250d0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+000250e0: 7461 696c 203d 2056 522e 6164 645f 7265  tail = VR.add_re
+000250f0: 6628 0a20 2020 2020 2020 2020 2020 2063  f(.            c
+00025100: 6f6d 7061 7373 280a 2020 2020 2020 2020  ompass(.        
+00025110: 2020 2020 2020 2020 7369 7a65 3d28 6d69          size=(mi
+00025120: 6e5f 7061 645f 7370 6163 696e 6720 2d20  n_pad_spacing - 
+00025130: 6375 7272 656e 745f 7769 6474 6820 2b20  current_width + 
+00025140: 7769 7265 5f77 6964 7468 2c20 7769 7265  wire_width, wire
+00025150: 5f77 6964 7468 292c 0a20 2020 2020 2020  _width),.       
+00025160: 2020 2020 2020 2020 206c 6179 6572 3d77           layer=w
+00025170: 6972 696e 6731 5f6c 6179 6572 2c0a 2020  iring1_layer,.  
+00025180: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00025190: 2020 2020 290a 2020 2020 2020 2020 7461      ).        ta
+000251a0: 696c 5f6f 7665 726c 6179 203d 2056 522e  il_overlay = VR.
+000251b0: 6164 645f 7265 6628 0a20 2020 2020 2020  add_ref(.       
+000251c0: 2020 2020 2063 6f6d 7061 7373 280a 2020       compass(.  
+000251d0: 2020 2020 2020 2020 2020 2020 2020 7369                si
+000251e0: 7a65 3d28 6d69 6e5f 7061 645f 7370 6163  ze=(min_pad_spac
+000251f0: 696e 6720 2d20 6375 7272 656e 745f 7769  ing - current_wi
+00025200: 6474 6820 2b20 7769 7265 5f77 6964 7468  dth + wire_width
+00025210: 2c20 7769 7265 5f77 6964 7468 292c 0a20  , wire_width),. 
+00025220: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00025230: 6179 6572 3d70 6164 5f6c 6179 6572 2c0a  ayer=pad_layer,.
+00025240: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00025250: 2020 2020 2020 290a 2020 2020 656c 7365        ).    else
+00025260: 3a0a 2020 2020 2020 2020 7461 696c 203d  :.        tail =
+00025270: 2056 522e 6164 645f 7265 6628 0a20 2020   VR.add_ref(.   
+00025280: 2020 2020 2020 2020 2063 6f6d 7061 7373           compass
+00025290: 2873 697a 653d 2833 202a 2077 6972 655f  (size=(3 * wire_
+000252a0: 7769 6474 682c 2077 6972 655f 7769 6474  width, wire_widt
+000252b0: 6829 2c20 6c61 7965 723d 7769 7269 6e67  h), layer=wiring
+000252c0: 315f 6c61 7965 7229 0a20 2020 2020 2020  1_layer).       
+000252d0: 2029 0a20 2020 2020 2020 2074 6169 6c5f   ).        tail_
+000252e0: 6f76 6572 6c61 7920 3d20 5652 2e61 6464  overlay = VR.add
+000252f0: 5f72 6566 280a 2020 2020 2020 2020 2020  _ref(.          
+00025300: 2020 636f 6d70 6173 7328 7369 7a65 3d28    compass(size=(
+00025310: 3320 2a20 7769 7265 5f77 6964 7468 2c20  3 * wire_width, 
+00025320: 7769 7265 5f77 6964 7468 292c 206c 6179  wire_width), lay
+00025330: 6572 3d77 6972 696e 6731 5f6c 6179 6572  er=wiring1_layer
+00025340: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
+00025350: 2069 6620 7570 2061 6e64 206e 6f74 2065   if up and not e
+00025360: 6467 653a 0a20 2020 2020 2020 2074 6169  dge:.        tai
+00025370: 6c2e 636f 6e6e 6563 7428 706f 7274 3d22  l.connect(port="
+00025380: 5722 2c20 6465 7374 696e 6174 696f 6e3d  W", destination=
+00025390: 6f62 6a2e 706f 7274 735b 2253 225d 2c20  obj.ports["S"], 
+000253a0: 6f76 6572 6c61 703d 7769 7265 5f77 6964  overlap=wire_wid
+000253b0: 7468 290a 2020 2020 2020 2020 7461 696c  th).        tail
+000253c0: 5f6f 7665 726c 6179 2e63 6f6e 6e65 6374  _overlay.connect
+000253d0: 2870 6f72 743d 2257 222c 2064 6573 7469  (port="W", desti
+000253e0: 6e61 7469 6f6e 3d6f 626a 2e70 6f72 7473  nation=obj.ports
+000253f0: 5b22 5322 5d2c 206f 7665 726c 6170 3d77  ["S"], overlap=w
+00025400: 6972 655f 7769 6474 6829 0a20 2020 2065  ire_width).    e
+00025410: 6c69 6620 646f 776e 2061 6e64 206e 6f74  lif down and not
+00025420: 2065 6467 653a 0a20 2020 2020 2020 2074   edge:.        t
+00025430: 6169 6c2e 636f 6e6e 6563 7428 706f 7274  ail.connect(port
+00025440: 3d22 5722 2c20 6465 7374 696e 6174 696f  ="W", destinatio
+00025450: 6e3d 6f62 6a2e 706f 7274 735b 224e 225d  n=obj.ports["N"]
+00025460: 2c20 6f76 6572 6c61 703d 7769 7265 5f77  , overlap=wire_w
+00025470: 6964 7468 290a 2020 2020 2020 2020 7461  idth).        ta
+00025480: 696c 5f6f 7665 726c 6179 2e63 6f6e 6e65  il_overlay.conne
+00025490: 6374 2870 6f72 743d 2257 222c 2064 6573  ct(port="W", des
+000254a0: 7469 6e61 7469 6f6e 3d6f 626a 2e70 6f72  tination=obj.por
+000254b0: 7473 5b22 4e22 5d2c 206f 7665 726c 6170  ts["N"], overlap
+000254c0: 3d77 6972 655f 7769 6474 6829 0a20 2020  =wire_width).   
+000254d0: 2065 6c73 653a 0a20 2020 2020 2020 2074   else:.        t
+000254e0: 6169 6c2e 636f 6e6e 6563 7428 706f 7274  ail.connect(port
+000254f0: 3d22 5722 2c20 6465 7374 696e 6174 696f  ="W", destinatio
+00025500: 6e3d 6f62 6a2e 706f 7274 735b 2245 225d  n=obj.ports["E"]
+00025510: 2c20 6f76 6572 6c61 703d 7769 7265 5f77  , overlap=wire_w
+00025520: 6964 7468 290a 2020 2020 2020 2020 7461  idth).        ta
+00025530: 696c 5f6f 7665 726c 6179 2e63 6f6e 6e65  il_overlay.conne
+00025540: 6374 2870 6f72 743d 2257 222c 2064 6573  ct(port="W", des
+00025550: 7469 6e61 7469 6f6e 3d6f 626a 2e70 6f72  tination=obj.por
+00025560: 7473 5b22 4522 5d2c 206f 7665 726c 6170  ts["E"], overlap
+00025570: 3d77 6972 655f 7769 6474 6829 0a0a 2020  =wire_width)..  
+00025580: 2020 7061 6432 2e78 6d69 6e20 3d20 7461    pad2.xmin = ta
+00025590: 696c 2e78 6d61 780a 2020 2020 7061 6432  il.xmax.    pad2
+000255a0: 5f6f 7665 726c 6179 2e78 6d69 6e20 3d20  _overlay.xmin = 
+000255b0: 7061 6432 2e78 6d69 6e0a 2020 2020 7061  pad2.xmin.    pa
+000255c0: 6432 5f6f 7665 726c 6179 2e79 6d69 6e20  d2_overlay.ymin 
+000255d0: 3d20 7061 6432 2e79 6d69 6e0a 0a20 2020  = pad2.ymin..   
+000255e0: 2072 6574 7572 6e20 5652 0a0a 0a64 6566   return VR...def
+000255f0: 2074 6573 745f 636f 6d62 280a 2020 2020   test_comb(.    
+00025600: 7061 645f 7369 7a65 3d28 3230 302c 2032  pad_size=(200, 2
+00025610: 3030 292c 0a20 2020 2077 6972 655f 7769  00),.    wire_wi
+00025620: 6474 683d 312c 0a20 2020 2077 6972 655f  dth=1,.    wire_
+00025630: 6761 703d 332c 0a20 2020 2063 6f6d 625f  gap=3,.    comb_
+00025640: 6c61 7965 723d 302c 0a20 2020 206f 7665  layer=0,.    ove
+00025650: 726c 6170 5f7a 6967 7a61 675f 6c61 7965  rlap_zigzag_laye
+00025660: 723d 312c 0a20 2020 2063 6f6d 625f 7061  r=1,.    comb_pa
+00025670: 645f 6c61 7965 723d 322c 0a20 2020 2063  d_layer=2,.    c
+00025680: 6f6d 625f 676e 645f 6c61 7965 723d 332c  omb_gnd_layer=3,
+00025690: 0a20 2020 206f 7665 726c 6170 5f70 6164  .    overlap_pad
+000256a0: 5f6c 6179 6572 3d34 2c0a 293a 0a20 2020  _layer=4,.):.   
+000256b0: 2022 2222 4f76 6572 6c61 7020 636f 6d62   """Overlap comb
+000256c0: 2074 6573 7420 7374 7275 6374 7572 6520   test structure 
+000256d0: 666f 7220 6368 6563 6b69 6e67 2077 6865  for checking whe
+000256e0: 7468 6572 2074 776f 206c 6179 6572 730a  ther two layers.
+000256f0: 2020 2020 6172 6520 656c 6563 7472 6963      are electric
+00025700: 616c 6c79 2069 736f 6c61 7465 640a 0a20  ally isolated.. 
+00025710: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00025720: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00025730: 2070 6164 5f73 697a 6520 3a20 6172 7261   pad_size : arra
+00025740: 792d 6c69 6b65 0a20 2020 2020 2020 2078  y-like.        x
+00025750: 2061 6e64 2079 2064 696d 656e 7369 6f6e   and y dimension
+00025760: 7320 6f66 2074 6865 2063 6f6d 6220 7061  s of the comb pa
+00025770: 6473 2e0a 2020 2020 7769 7265 5f77 6964  ds..    wire_wid
+00025780: 7468 203a 2069 6e74 206f 7220 666c 6f61  th : int or floa
+00025790: 740a 2020 2020 2020 2020 5769 6474 6820  t.        Width 
+000257a0: 6f66 2074 6865 2074 6573 7420 636f 6d62  of the test comb
+000257b0: 2074 6565 7468 2e0a 2020 2020 7769 7265   teeth..    wire
+000257c0: 5f67 6170 203a 2069 6e74 206f 7220 666c  _gap : int or fl
+000257d0: 6f61 740a 2020 2020 2020 2020 5369 7a65  oat.        Size
+000257e0: 206f 6620 7468 6520 6761 7020 6265 7477   of the gap betw
+000257f0: 6565 6e20 636f 6d62 2074 6565 7468 2e0a  een comb teeth..
+00025800: 2020 2020 636f 6d62 5f6c 6179 6572 203a      comb_layer :
+00025810: 2069 6e74 2c20 6172 7261 792d 6c69 6b65   int, array-like
+00025820: 5b32 5d2c 206f 7220 7365 740a 2020 2020  [2], or set.    
+00025830: 2020 2020 5370 6563 6966 6963 206c 6179      Specific lay
+00025840: 6572 2873 2920 746f 2070 7574 2063 6f6d  er(s) to put com
+00025850: 6220 6765 6f6d 6574 7279 206f 6e2e 0a20  b geometry on.. 
+00025860: 2020 206f 7665 726c 6170 5f7a 6967 7a61     overlap_zigza
+00025870: 675f 6c61 7965 7220 3a20 696e 742c 2061  g_layer : int, a
+00025880: 7272 6179 2d6c 696b 655b 325d 2c20 6f72  rray-like[2], or
+00025890: 2073 6574 0a20 2020 2020 2020 2053 7065   set.        Spe
+000258a0: 6369 6669 6320 6c61 7965 7228 7329 2074  cific layer(s) t
+000258b0: 6f20 7075 7420 6f76 6572 6c61 7020 7a69  o put overlap zi
+000258c0: 677a 6167 2067 656f 6d65 7472 7920 6f6e  gzag geometry on
+000258d0: 2e0a 2020 2020 636f 6d62 5f70 6164 5f6c  ..    comb_pad_l
+000258e0: 6179 6572 203a 2069 6e74 2c20 6172 7261  ayer : int, arra
+000258f0: 792d 6c69 6b65 5b32 5d2c 206f 7220 7365  y-like[2], or se
+00025900: 740a 2020 2020 2020 2020 5370 6563 6966  t.        Specif
+00025910: 6963 206c 6179 6572 2873 2920 746f 2070  ic layer(s) to p
+00025920: 7574 2063 6f6d 6220 7061 6473 206f 6e2e  ut comb pads on.
+00025930: 0a20 2020 2063 6f6d 625f 676e 645f 6c61  .    comb_gnd_la
+00025940: 7965 7220 3a20 696e 742c 2061 7272 6179  yer : int, array
+00025950: 2d6c 696b 655b 325d 2c20 6f72 2073 6574  -like[2], or set
+00025960: 0a20 2020 2020 2020 2053 7065 6369 6669  .        Specifi
+00025970: 6320 6c61 7965 7228 7329 2074 6f20 7075  c layer(s) to pu
+00025980: 7420 7468 6520 636f 6d62 2067 726f 756e  t the comb groun
+00025990: 6420 6f6e 2e0a 2020 2020 6f76 6572 6c61  d on..    overla
+000259a0: 705f 7061 645f 6c61 7965 7220 3a20 696e  p_pad_layer : in
+000259b0: 742c 2061 7272 6179 2d6c 696b 655b 325d  t, array-like[2]
+000259c0: 2c20 6f72 2073 6574 0a20 2020 2020 2020  , or set.       
+000259d0: 2053 7065 6369 6669 6320 6c61 7965 7228   Specific layer(
+000259e0: 7329 2074 6f20 7075 7420 6f76 6572 6c61  s) to put overla
+000259f0: 7020 7061 6473 206f 6e2e 0a0a 2020 2020  p pads on...    
+00025a00: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
+00025a10: 2d2d 2d0a 2020 2020 4349 203a 2044 6576  ---.    CI : Dev
+00025a20: 6963 650a 2020 2020 2020 2020 4120 4465  ice.        A De
+00025a30: 7669 6365 2063 6f6e 7461 696e 696e 6720  vice containing 
+00025a40: 6120 7465 7374 2063 6f6d 6220 6765 6f6d  a test comb geom
+00025a50: 6574 7279 2e0a 0a20 2020 204e 6f74 6573  etry...    Notes
+00025a60: 0a20 2020 202d 2d2d 2d2d 0a20 2020 2043  .    -----.    C
+00025a70: 616c 6c20 636f 6d62 5f69 6e73 756c 6174  all comb_insulat
+00025a80: 696f 6e5f 7465 7374 5f73 7472 7563 7475  ion_test_structu
+00025a90: 7265 2829 2077 6974 6820 616e 7920 6f66  re() with any of
+00025aa0: 2074 6865 2070 6172 616d 6574 6572 7320   the parameters 
+00025ab0: 7368 6f77 6e0a 2020 2020 6265 6c6f 7720  shown.    below 
+00025ac0: 7768 6963 6820 796f 7527 6420 6c69 6b65  which you'd like
+00025ad0: 2074 6f20 6368 616e 6765 2e20 596f 7520   to change. You 
+00025ae0: 6f6e 6c79 206e 6565 6420 746f 2073 7570  only need to sup
+00025af0: 706c 7920 7468 6520 7061 7261 6d65 7465  ply the paramete
+00025b00: 7273 0a20 2020 2077 6869 6368 2079 6f75  rs.    which you
+00025b10: 2069 6e74 656e 6420 6f6e 2063 6861 6e67   intend on chang
+00025b20: 696e 6720 596f 7520 6361 6e20 616c 7465  ing You can alte
+00025b30: 726e 6174 6976 656c 7920 6361 6c6c 2069  rnatively call i
+00025b40: 7420 7769 7468 206e 6f0a 2020 2020 7061  t with no.    pa
+00025b50: 7261 6d65 7465 7273 2061 6e64 2069 7420  rameters and it 
+00025b60: 7769 6c6c 2074 616b 6520 616c 6c20 7468  will take all th
+00025b70: 6520 6465 6661 756c 7420 7661 6c75 6573  e default values
+00025b80: 2073 686f 776e 2062 656c 6f77 2e0a 0a20   shown below... 
+00025b90: 2020 2045 783a 3a0a 2020 2020 2020 2020     Ex::.        
+00025ba0: 636f 6d62 5f69 6e73 756c 6174 696f 6e5f  comb_insulation_
+00025bb0: 7465 7374 5f73 7472 7563 7475 7265 2870  test_structure(p
+00025bc0: 6164 5f73 697a 653d 2831 3735 2c31 3735  ad_size=(175,175
+00025bd0: 292c 2077 6972 655f 7769 6474 683d 322c  ), wire_width=2,
+00025be0: 2077 6972 655f 6761 703d 3529 0a20 2020   wire_gap=5).   
+00025bf0: 202d 206f 7220 2d3a 3a0a 2020 2020 2020   - or -::.      
+00025c00: 2020 636f 6d62 5f69 6e73 756c 6174 696f    comb_insulatio
+00025c10: 6e5f 7465 7374 5f73 7472 7563 7475 7265  n_test_structure
+00025c20: 2829 0a20 2020 2022 2222 0a20 2020 2043  ().    """.    C
+00025c30: 4920 3d20 4465 7669 6365 2822 7465 7374  I = Device("test
+00025c40: 5f63 6f6d 6222 290a 0a20 2020 2023 2069  _comb")..    # i
+00025c50: 6620 636f 6d62 5f70 6164 5f6c 6179 6572  f comb_pad_layer
+00025c60: 2069 7320 4e6f 6e65 3a20 636f 6d62 5f70   is None: comb_p
+00025c70: 6164 5f6c 6179 6572 203d 2063 6f6d 625f  ad_layer = comb_
+00025c80: 6c61 7965 720a 2020 2020 2320 6966 2063  layer.    # if c
+00025c90: 6f6d 625f 676e 645f 6c61 7965 7220 6973  omb_gnd_layer is
+00025ca0: 204e 6f6e 653a 2063 6f6d 625f 676e 645f   None: comb_gnd_
+00025cb0: 6c61 7965 7220 3d20 636f 6d62 5f6c 6179  layer = comb_lay
+00025cc0: 6572 0a20 2020 2023 2069 6620 6f76 6572  er.    # if over
+00025cd0: 6c61 705f 7061 645f 6c61 7965 7220 6973  lap_pad_layer is
+00025ce0: 204e 6f6e 653a 206f 7665 726c 6170 5f70   None: overlap_p
+00025cf0: 6164 5f6c 6179 6572 203d 206f 7665 726c  ad_layer = overl
+00025d00: 6170 5f7a 6967 7a61 675f 6c61 7965 720a  ap_zigzag_layer.
+00025d10: 2020 2020 7769 7265 5f73 7061 6369 6e67      wire_spacing
+00025d20: 203d 2077 6972 655f 7769 6474 6820 2b20   = wire_width + 
+00025d30: 7769 7265 5f67 6170 202a 2032 0a0a 2020  wire_gap * 2..  
+00025d40: 2020 2320 7061 6420 6f76 6572 6c61 7973    # pad overlays
+00025d50: 0a20 2020 206f 7665 726c 6179 5f70 6164  .    overlay_pad
+00025d60: 6220 3d20 4349 2e61 6464 5f72 6566 280a  b = CI.add_ref(.
+00025d70: 2020 2020 2020 2020 7265 6374 616e 676c          rectangl
+00025d80: 6528 0a20 2020 2020 2020 2020 2020 2073  e(.            s
+00025d90: 697a 653d 2870 6164 5f73 697a 655b 305d  ize=(pad_size[0]
+00025da0: 202a 2039 202f 2031 302c 2070 6164 5f73   * 9 / 10, pad_s
+00025db0: 697a 655b 315d 202a 2039 202f 2031 3029  ize[1] * 9 / 10)
+00025dc0: 2c20 6c61 7965 723d 6f76 6572 6c61 705f  , layer=overlap_
+00025dd0: 7061 645f 6c61 7965 720a 2020 2020 2020  pad_layer.      
+00025de0: 2020 290a 2020 2020 290a 2020 2020 6f76    ).    ).    ov
+00025df0: 6572 6c61 795f 7061 646c 203d 2043 492e  erlay_padl = CI.
+00025e00: 6164 645f 7265 6628 0a20 2020 2020 2020  add_ref(.       
+00025e10: 2072 6563 7461 6e67 6c65 280a 2020 2020   rectangle(.    
+00025e20: 2020 2020 2020 2020 7369 7a65 3d28 7061          size=(pa
+00025e30: 645f 7369 7a65 5b30 5d20 2a20 3920 2f20  d_size[0] * 9 / 
+00025e40: 3130 2c20 7061 645f 7369 7a65 5b31 5d20  10, pad_size[1] 
+00025e50: 2a20 3920 2f20 3130 292c 206c 6179 6572  * 9 / 10), layer
+00025e60: 3d63 6f6d 625f 7061 645f 6c61 7965 720a  =comb_pad_layer.
+00025e70: 2020 2020 2020 2020 290a 2020 2020 290a          ).    ).
+00025e80: 2020 2020 6f76 6572 6c61 795f 7061 6474      overlay_padt
+00025e90: 203d 2043 492e 6164 645f 7265 6628 0a20   = CI.add_ref(. 
+00025ea0: 2020 2020 2020 2072 6563 7461 6e67 6c65         rectangle
+00025eb0: 280a 2020 2020 2020 2020 2020 2020 7369  (.            si
+00025ec0: 7a65 3d28 7061 645f 7369 7a65 5b30 5d20  ze=(pad_size[0] 
+00025ed0: 2a20 3920 2f20 3130 2c20 7061 645f 7369  * 9 / 10, pad_si
+00025ee0: 7a65 5b31 5d20 2a20 3920 2f20 3130 292c  ze[1] * 9 / 10),
+00025ef0: 206c 6179 6572 3d63 6f6d 625f 7061 645f   layer=comb_pad_
+00025f00: 6c61 7965 720a 2020 2020 2020 2020 290a  layer.        ).
+00025f10: 2020 2020 290a 2020 2020 6f76 6572 6c61      ).    overla
+00025f20: 795f 7061 6472 203d 2043 492e 6164 645f  y_padr = CI.add_
+00025f30: 7265 6628 0a20 2020 2020 2020 2072 6563  ref(.        rec
+00025f40: 7461 6e67 6c65 280a 2020 2020 2020 2020  tangle(.        
+00025f50: 2020 2020 7369 7a65 3d28 7061 645f 7369      size=(pad_si
+00025f60: 7a65 5b30 5d20 2a20 3920 2f20 3130 2c20  ze[0] * 9 / 10, 
+00025f70: 7061 645f 7369 7a65 5b31 5d20 2a20 3920  pad_size[1] * 9 
+00025f80: 2f20 3130 292c 206c 6179 6572 3d63 6f6d  / 10), layer=com
+00025f90: 625f 676e 645f 6c61 7965 720a 2020 2020  b_gnd_layer.    
+00025fa0: 2020 2020 290a 2020 2020 290a 2020 2020      ).    ).    
+00025fb0: 6f76 6572 6c61 795f 7061 646c 2e78 6d69  overlay_padl.xmi
+00025fc0: 6e20 3d20 300a 2020 2020 6f76 6572 6c61  n = 0.    overla
+00025fd0: 795f 7061 646c 2e79 6d69 6e20 3d20 300a  y_padl.ymin = 0.
+00025fe0: 2020 2020 6f76 6572 6c61 795f 7061 6462      overlay_padb
+00025ff0: 2e79 6d61 7820 3d20 300a 2020 2020 6f76  .ymax = 0.    ov
+00026000: 6572 6c61 795f 7061 6462 2e78 6d69 6e20  erlay_padb.xmin 
+00026010: 3d20 6f76 6572 6c61 795f 7061 646c 2e78  = overlay_padl.x
+00026020: 6d61 7820 2b20 7061 645f 7369 7a65 5b31  max + pad_size[1
+00026030: 5d20 2f20 350a 2020 2020 6f76 6572 6c61  ] / 5.    overla
+00026040: 795f 7061 6472 2e79 6d69 6e20 3d20 6f76  y_padr.ymin = ov
+00026050: 6572 6c61 795f 7061 646c 2e79 6d69 6e0a  erlay_padl.ymin.
+00026060: 2020 2020 6f76 6572 6c61 795f 7061 6472      overlay_padr
+00026070: 2e78 6d69 6e20 3d20 6f76 6572 6c61 795f  .xmin = overlay_
+00026080: 7061 6462 2e78 6d61 7820 2b20 7061 645f  padb.xmax + pad_
+00026090: 7369 7a65 5b31 5d20 2f20 350a 2020 2020  size[1] / 5.    
+000260a0: 6f76 6572 6c61 795f 7061 6474 2e78 6d69  overlay_padt.xmi
+000260b0: 6e20 3d20 6f76 6572 6c61 795f 7061 646c  n = overlay_padl
+000260c0: 2e78 6d61 7820 2b20 7061 645f 7369 7a65  .xmax + pad_size
+000260d0: 5b31 5d20 2f20 350a 2020 2020 6f76 6572  [1] / 5.    over
+000260e0: 6c61 795f 7061 6474 2e79 6d69 6e20 3d20  lay_padt.ymin = 
+000260f0: 6f76 6572 6c61 795f 7061 646c 2e79 6d61  overlay_padl.yma
+00026100: 780a 0a20 2020 2023 2070 6164 730a 2020  x..    # pads.  
+00026110: 2020 7061 646c 203d 2043 492e 6164 645f    padl = CI.add_
+00026120: 7265 6628 7265 6374 616e 676c 6528 7369  ref(rectangle(si
+00026130: 7a65 3d70 6164 5f73 697a 652c 206c 6179  ze=pad_size, lay
+00026140: 6572 3d63 6f6d 625f 6c61 7965 7229 290a  er=comb_layer)).
+00026150: 2020 2020 7061 6474 203d 2043 492e 6164      padt = CI.ad
+00026160: 645f 7265 6628 7265 6374 616e 676c 6528  d_ref(rectangle(
+00026170: 7369 7a65 3d70 6164 5f73 697a 652c 206c  size=pad_size, l
+00026180: 6179 6572 3d63 6f6d 625f 6c61 7965 7229  ayer=comb_layer)
+00026190: 290a 2020 2020 7061 6472 203d 2043 492e  ).    padr = CI.
+000261a0: 6164 645f 7265 6628 7265 6374 616e 676c  add_ref(rectangl
+000261b0: 6528 7369 7a65 3d70 6164 5f73 697a 652c  e(size=pad_size,
+000261c0: 206c 6179 6572 3d63 6f6d 625f 6c61 7965   layer=comb_laye
+000261d0: 7229 290a 2020 2020 7061 6462 203d 2043  r)).    padb = C
+000261e0: 492e 6164 645f 7265 6628 7265 6374 616e  I.add_ref(rectan
+000261f0: 676c 6528 7369 7a65 3d70 6164 5f73 697a  gle(size=pad_siz
+00026200: 652c 206c 6179 6572 3d6f 7665 726c 6170  e, layer=overlap
+00026210: 5f7a 6967 7a61 675f 6c61 7965 7229 290a  _zigzag_layer)).
+00026220: 2020 2020 7061 646c 5f6e 7562 203d 2043      padl_nub = C
+00026230: 492e 6164 645f 7265 6628 0a20 2020 2020  I.add_ref(.     
+00026240: 2020 2072 6563 7461 6e67 6c65 2873 697a     rectangle(siz
+00026250: 653d 2870 6164 5f73 697a 655b 305d 202f  e=(pad_size[0] /
+00026260: 2034 2c20 7061 645f 7369 7a65 5b31 5d20   4, pad_size[1] 
+00026270: 2f20 3229 2c20 6c61 7965 723d 636f 6d62  / 2), layer=comb
+00026280: 5f6c 6179 6572 290a 2020 2020 290a 2020  _layer).    ).  
+00026290: 2020 7061 6472 5f6e 7562 203d 2043 492e    padr_nub = CI.
+000262a0: 6164 645f 7265 6628 0a20 2020 2020 2020  add_ref(.       
+000262b0: 2072 6563 7461 6e67 6c65 2873 697a 653d   rectangle(size=
+000262c0: 2870 6164 5f73 697a 655b 305d 202f 2034  (pad_size[0] / 4
+000262d0: 2c20 7061 645f 7369 7a65 5b31 5d20 2f20  , pad_size[1] / 
+000262e0: 3229 2c20 6c61 7965 723d 636f 6d62 5f6c  2), layer=comb_l
+000262f0: 6179 6572 290a 2020 2020 290a 2020 2020  ayer).    ).    
+00026300: 7061 646c 2e78 6d69 6e20 3d20 6f76 6572  padl.xmin = over
+00026310: 6c61 795f 7061 646c 2e78 6d69 6e0a 2020  lay_padl.xmin.  
+00026320: 2020 7061 646c 2e63 656e 7465 7220 3d20    padl.center = 
+00026330: 5b70 6164 6c2e 6365 6e74 6572 5b30 5d2c  [padl.center[0],
+00026340: 206f 7665 726c 6179 5f70 6164 6c2e 6365   overlay_padl.ce
+00026350: 6e74 6572 5b31 5d5d 0a20 2020 2070 6164  nter[1]].    pad
+00026360: 742e 796d 6178 203d 206f 7665 726c 6179  t.ymax = overlay
+00026370: 5f70 6164 742e 796d 6178 0a20 2020 2070  _padt.ymax.    p
+00026380: 6164 742e 6365 6e74 6572 203d 205b 6f76  adt.center = [ov
+00026390: 6572 6c61 795f 7061 6474 2e63 656e 7465  erlay_padt.cente
+000263a0: 725b 305d 2c20 7061 6474 2e63 656e 7465  r[0], padt.cente
+000263b0: 725b 315d 5d0a 2020 2020 7061 6472 2e78  r[1]].    padr.x
+000263c0: 6d61 7820 3d20 6f76 6572 6c61 795f 7061  max = overlay_pa
+000263d0: 6472 2e78 6d61 780a 2020 2020 7061 6472  dr.xmax.    padr
+000263e0: 2e63 656e 7465 7220 3d20 5b70 6164 722e  .center = [padr.
+000263f0: 6365 6e74 6572 5b30 5d2c 206f 7665 726c  center[0], overl
+00026400: 6179 5f70 6164 722e 6365 6e74 6572 5b31  ay_padr.center[1
+00026410: 5d5d 0a20 2020 2070 6164 622e 796d 696e  ]].    padb.ymin
+00026420: 203d 206f 7665 726c 6179 5f70 6164 622e   = overlay_padb.
+00026430: 796d 696e 0a20 2020 2070 6164 622e 6365  ymin.    padb.ce
+00026440: 6e74 6572 203d 205b 6f76 6572 6c61 795f  nter = [overlay_
+00026450: 7061 6462 2e63 656e 7465 725b 305d 2c20  padb.center[0], 
+00026460: 7061 6462 2e63 656e 7465 725b 315d 5d0a  padb.center[1]].
+00026470: 2020 2020 7061 646c 5f6e 7562 2e78 6d69      padl_nub.xmi
+00026480: 6e20 3d20 7061 646c 2e78 6d61 780a 2020  n = padl.xmax.  
+00026490: 2020 7061 646c 5f6e 7562 2e63 656e 7465    padl_nub.cente
+000264a0: 7220 3d20 5b70 6164 6c5f 6e75 622e 6365  r = [padl_nub.ce
+000264b0: 6e74 6572 5b30 5d2c 2070 6164 6c2e 6365  nter[0], padl.ce
+000264c0: 6e74 6572 5b31 5d5d 0a20 2020 2070 6164  nter[1]].    pad
+000264d0: 725f 6e75 622e 786d 6178 203d 2070 6164  r_nub.xmax = pad
+000264e0: 722e 786d 696e 0a20 2020 2070 6164 725f  r.xmin.    padr_
+000264f0: 6e75 622e 6365 6e74 6572 203d 205b 7061  nub.center = [pa
+00026500: 6472 5f6e 7562 2e63 656e 7465 725b 305d  dr_nub.center[0]
+00026510: 2c20 7061 6472 2e63 656e 7465 725b 315d  , padr.center[1]
+00026520: 5d0a 0a20 2020 2023 2063 6f6e 6e65 6374  ]..    # connect
+00026530: 6564 207a 6967 0a20 2020 2068 6561 6420  ed zig.    head 
+00026540: 3d20 4349 2e61 6464 5f72 6566 2863 6f6d  = CI.add_ref(com
+00026550: 7061 7373 2873 697a 653d 2870 6164 5f73  pass(size=(pad_s
+00026560: 697a 655b 305d 202f 2031 322c 2077 6972  ize[0] / 12, wir
+00026570: 655f 7769 6474 6829 2c20 6c61 7965 723d  e_width), layer=
+00026580: 636f 6d62 5f6c 6179 6572 2929 0a20 2020  comb_layer)).   
+00026590: 2068 6561 642e 786d 696e 203d 2070 6164   head.xmin = pad
+000265a0: 6c5f 6e75 622e 786d 6178 0a20 2020 2068  l_nub.xmax.    h
+000265b0: 6561 642e 796d 6178 203d 2070 6164 6c5f  ead.ymax = padl_
+000265c0: 6e75 622e 796d 6178 0a20 2020 2063 6f6e  nub.ymax.    con
+000265d0: 6e65 6374 6f72 203d 2043 492e 6164 645f  nector = CI.add_
+000265e0: 7265 6628 636f 6d70 6173 7328 7369 7a65  ref(compass(size
+000265f0: 3d28 7769 7265 5f77 6964 7468 2c20 7769  =(wire_width, wi
+00026600: 7265 5f77 6964 7468 292c 206c 6179 6572  re_width), layer
+00026610: 3d63 6f6d 625f 6c61 7965 7229 290a 2020  =comb_layer)).  
+00026620: 2020 636f 6e6e 6563 746f 722e 636f 6e6e    connector.conn
+00026630: 6563 7428 706f 7274 3d22 5722 2c20 6465  ect(port="W", de
+00026640: 7374 696e 6174 696f 6e3d 6865 6164 2e70  stination=head.p
+00026650: 6f72 7473 5b22 4522 5d29 0a20 2020 206f  orts["E"]).    o
+00026660: 6c64 5f70 6f72 7420 3d20 636f 6e6e 6563  ld_port = connec
+00026670: 746f 722e 706f 7274 735b 2253 225d 0a20  tor.ports["S"]. 
+00026680: 2020 2074 6f70 203d 2054 7275 650a 2020     top = True.  
+00026690: 2020 6f62 6a20 3d20 636f 6e6e 6563 746f    obj = connecto
+000266a0: 720a 2020 2020 7768 696c 6520 6f62 6a2e  r.    while obj.
+000266b0: 786d 6178 202b 2070 6164 5f73 697a 655b  xmax + pad_size[
+000266c0: 305d 202f 2031 3220 3c20 7061 6472 5f6e  0] / 12 < padr_n
+000266d0: 7562 2e78 6d69 6e3a 0a20 2020 2020 2020  ub.xmin:.       
+000266e0: 2023 206c 6f6e 6720 7a69 6720 7a61 6720   # long zig zag 
+000266f0: 7265 6374 616e 676c 650a 2020 2020 2020  rectangle.      
+00026700: 2020 6f62 6a20 3d20 4349 2e61 6464 5f72    obj = CI.add_r
+00026710: 6566 280a 2020 2020 2020 2020 2020 2020  ef(.            
+00026720: 636f 6d70 6173 7328 0a20 2020 2020 2020  compass(.       
+00026730: 2020 2020 2020 2020 2073 697a 653d 2870           size=(p
+00026740: 6164 5f73 697a 655b 315d 202f 2032 202d  ad_size[1] / 2 -
+00026750: 2032 202a 2077 6972 655f 7769 6474 682c   2 * wire_width,
+00026760: 2077 6972 655f 7769 6474 6829 2c20 6c61   wire_width), la
+00026770: 7965 723d 636f 6d62 5f6c 6179 6572 0a20  yer=comb_layer. 
+00026780: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00026790: 2020 2020 2029 0a20 2020 2020 2020 206f       ).        o
+000267a0: 626a 2e63 6f6e 6e65 6374 2870 6f72 743d  bj.connect(port=
+000267b0: 2257 222c 2064 6573 7469 6e61 7469 6f6e  "W", destination
+000267c0: 3d6f 6c64 5f70 6f72 7429 0a20 2020 2020  =old_port).     
+000267d0: 2020 206f 6c64 5f70 6f72 7420 3d20 6f62     old_port = ob
+000267e0: 6a2e 706f 7274 735b 2245 225d 0a20 2020  j.ports["E"].   
+000267f0: 2020 2020 2069 6620 746f 703a 0a20 2020       if top:.   
+00026800: 2020 2020 2020 2020 2023 207a 6967 207a           # zig z
+00026810: 6167 2065 6467 6520 7265 6374 616e 676c  ag edge rectangl
+00026820: 650a 2020 2020 2020 2020 2020 2020 6f62  e.            ob
+00026830: 6a20 3d20 4349 2e61 6464 5f72 6566 2863  j = CI.add_ref(c
+00026840: 6f6d 7061 7373 2873 697a 653d 2877 6972  ompass(size=(wir
+00026850: 655f 7769 6474 682c 2077 6972 655f 7769  e_width, wire_wi
+00026860: 6474 6829 2c20 6c61 7965 723d 636f 6d62  dth), layer=comb
+00026870: 5f6c 6179 6572 2929 0a20 2020 2020 2020  _layer)).       
+00026880: 2020 2020 206f 626a 2e63 6f6e 6e65 6374       obj.connect
+00026890: 2870 6f72 743d 224e 222c 2064 6573 7469  (port="N", desti
+000268a0: 6e61 7469 6f6e 3d6f 6c64 5f70 6f72 7429  nation=old_port)
+000268b0: 0a20 2020 2020 2020 2020 2020 2074 6f70  .            top
+000268c0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+000268d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000268e0: 2020 2023 207a 6967 207a 6167 2065 6467     # zig zag edg
+000268f0: 6520 7265 6374 616e 676c 650a 2020 2020  e rectangle.    
+00026900: 2020 2020 2020 2020 6f62 6a20 3d20 4349          obj = CI
+00026910: 2e61 6464 5f72 6566 2863 6f6d 7061 7373  .add_ref(compass
+00026920: 2873 697a 653d 2877 6972 655f 7769 6474  (size=(wire_widt
+00026930: 682c 2077 6972 655f 7769 6474 6829 2c20  h, wire_width), 
+00026940: 6c61 7965 723d 636f 6d62 5f6c 6179 6572  layer=comb_layer
+00026950: 2929 0a20 2020 2020 2020 2020 2020 206f  )).            o
+00026960: 626a 2e63 6f6e 6e65 6374 2870 6f72 743d  bj.connect(port=
+00026970: 2253 222c 2064 6573 7469 6e61 7469 6f6e  "S", destination
+00026980: 3d6f 6c64 5f70 6f72 7429 0a20 2020 2020  =old_port).     
+00026990: 2020 2020 2020 2074 6f70 203d 2054 7275         top = Tru
+000269a0: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
+000269b0: 636f 6d62 2072 6563 7461 6e67 650a 2020  comb rectange.  
+000269c0: 2020 2020 2020 2020 2020 636f 6d62 203d            comb =
+000269d0: 2043 492e 6164 645f 7265 6628 0a20 2020   CI.add_ref(.   
+000269e0: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+000269f0: 7461 6e67 6c65 280a 2020 2020 2020 2020  tangle(.        
+00026a00: 2020 2020 2020 2020 2020 2020 7369 7a65              size
+00026a10: 3d28 0a20 2020 2020 2020 2020 2020 2020  =(.             
+00026a20: 2020 2020 2020 2020 2020 2028 7061 6474             (padt
+00026a30: 2e79 6d69 6e20 2d20 6865 6164 2e79 6d61  .ymin - head.yma
+00026a40: 7829 0a20 2020 2020 2020 2020 2020 2020  x).             
+00026a50: 2020 2020 2020 2020 2020 202b 2070 6164             + pad
+00026a60: 5f73 697a 655b 315d 202f 2032 0a20 2020  _size[1] / 2.   
+00026a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026a80: 2020 2020 202d 2028 7769 7265 5f73 7061       - (wire_spa
+00026a90: 6369 6e67 202b 2077 6972 655f 7769 6474  cing + wire_widt
+00026aa0: 6829 202f 2032 2c0a 2020 2020 2020 2020  h) / 2,.        
+00026ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026ac0: 7769 7265 5f77 6964 7468 2c0a 2020 2020  wire_width,.    
+00026ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026ae0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00026af0: 2020 2020 2020 206c 6179 6572 3d63 6f6d         layer=com
+00026b00: 625f 6c61 7965 722c 0a20 2020 2020 2020  b_layer,.       
+00026b10: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00026b20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00026b30: 2020 2020 2063 6f6d 622e 726f 7461 7465       comb.rotate
+00026b40: 2839 3029 0a20 2020 2020 2020 2020 2020  (90).           
+00026b50: 2063 6f6d 622e 796d 6178 203d 2070 6164   comb.ymax = pad
+00026b60: 742e 796d 696e 0a20 2020 2020 2020 2020  t.ymin.         
+00026b70: 2020 2063 6f6d 622e 786d 6178 203d 206f     comb.xmax = o
+00026b80: 626a 2e78 6d61 7820 2d20 2877 6972 655f  bj.xmax - (wire_
+00026b90: 7370 6163 696e 6720 2b20 7769 7265 5f77  spacing + wire_w
+00026ba0: 6964 7468 2920 2f20 320a 2020 2020 2020  idth) / 2.      
+00026bb0: 2020 6f6c 645f 706f 7274 203d 206f 626a    old_port = obj
+00026bc0: 2e70 6f72 7473 5b22 4522 5d0a 2020 2020  .ports["E"].    
+00026bd0: 2020 2020 6f62 6a20 3d20 4349 2e61 6464      obj = CI.add
+00026be0: 5f72 6566 2863 6f6d 7061 7373 2873 697a  _ref(compass(siz
+00026bf0: 653d 2877 6972 655f 7370 6163 696e 672c  e=(wire_spacing,
+00026c00: 2077 6972 655f 7769 6474 6829 2c20 6c61   wire_width), la
+00026c10: 7965 723d 636f 6d62 5f6c 6179 6572 2929  yer=comb_layer))
+00026c20: 0a20 2020 2020 2020 206f 626a 2e63 6f6e  .        obj.con
+00026c30: 6e65 6374 2870 6f72 743d 2257 222c 2064  nect(port="W", d
+00026c40: 6573 7469 6e61 7469 6f6e 3d6f 6c64 5f70  estination=old_p
+00026c50: 6f72 7429 0a20 2020 2020 2020 206f 6c64  ort).        old
+00026c60: 5f70 6f72 7420 3d20 6f62 6a2e 706f 7274  _port = obj.port
+00026c70: 735b 2245 225d 0a20 2020 2020 2020 206f  s["E"].        o
+00026c80: 626a 203d 2043 492e 6164 645f 7265 6628  bj = CI.add_ref(
+00026c90: 636f 6d70 6173 7328 7369 7a65 3d28 7769  compass(size=(wi
+00026ca0: 7265 5f77 6964 7468 2c20 7769 7265 5f77  re_width, wire_w
+00026cb0: 6964 7468 292c 206c 6179 6572 3d63 6f6d  idth), layer=com
+00026cc0: 625f 6c61 7965 7229 290a 2020 2020 2020  b_layer)).      
+00026cd0: 2020 6f62 6a2e 636f 6e6e 6563 7428 706f    obj.connect(po
+00026ce0: 7274 3d22 5722 2c20 6465 7374 696e 6174  rt="W", destinat
+00026cf0: 696f 6e3d 6f6c 645f 706f 7274 290a 2020  ion=old_port).  
+00026d00: 2020 2020 2020 6966 2074 6f70 3a0a 2020        if top:.  
+00026d10: 2020 2020 2020 2020 2020 6f6c 645f 706f            old_po
+00026d20: 7274 203d 206f 626a 2e70 6f72 7473 5b22  rt = obj.ports["
+00026d30: 5322 5d0a 2020 2020 2020 2020 656c 7365  S"].        else
+00026d40: 3a0a 2020 2020 2020 2020 2020 2020 6f6c  :.            ol
+00026d50: 645f 706f 7274 203d 206f 626a 2e70 6f72  d_port = obj.por
+00026d60: 7473 5b22 4e22 5d0a 2020 2020 6f6c 645f  ts["N"].    old_
+00026d70: 706f 7274 203d 206f 626a 2e70 6f72 7473  port = obj.ports
+00026d80: 5b22 4522 5d0a 2020 2020 6966 2070 6164  ["E"].    if pad
+00026d90: 725f 6e75 622e 786d 696e 202d 206f 626a  r_nub.xmin - obj
+00026da0: 2e78 6d61 7820 3e20 303a 0a20 2020 2020  .xmax > 0:.     
+00026db0: 2020 2074 6169 6c20 3d20 4349 2e61 6464     tail = CI.add
+00026dc0: 5f72 6566 280a 2020 2020 2020 2020 2020  _ref(.          
+00026dd0: 2020 636f 6d70 6173 7328 7369 7a65 3d28    compass(size=(
+00026de0: 7061 6472 5f6e 7562 2e78 6d69 6e20 2d20  padr_nub.xmin - 
+00026df0: 6f62 6a2e 786d 6178 2c20 7769 7265 5f77  obj.xmax, wire_w
+00026e00: 6964 7468 292c 206c 6179 6572 3d63 6f6d  idth), layer=com
+00026e10: 625f 6c61 7965 7229 0a20 2020 2020 2020  b_layer).       
+00026e20: 2029 0a20 2020 2065 6c73 653a 0a20 2020   ).    else:.   
+00026e30: 2020 2020 2074 6169 6c20 3d20 4349 2e61       tail = CI.a
+00026e40: 6464 5f72 6566 2863 6f6d 7061 7373 2873  dd_ref(compass(s
+00026e50: 697a 653d 2877 6972 655f 7769 6474 682c  ize=(wire_width,
+00026e60: 2077 6972 655f 7769 6474 6829 2c20 6c61   wire_width), la
+00026e70: 7965 723d 636f 6d62 5f6c 6179 6572 2929  yer=comb_layer))
+00026e80: 0a20 2020 2074 6169 6c2e 636f 6e6e 6563  .    tail.connec
+00026e90: 7428 706f 7274 3d22 5722 2c20 6465 7374  t(port="W", dest
+00026ea0: 696e 6174 696f 6e3d 6f6c 645f 706f 7274  ination=old_port
+00026eb0: 290a 0a20 2020 2023 2064 6973 636f 6e6e  )..    # disconn
+00026ec0: 6563 7465 6420 7a69 670a 2020 2020 6468  ected zig.    dh
+00026ed0: 6561 6420 3d20 4349 2e61 6464 5f72 6566  ead = CI.add_ref
+00026ee0: 280a 2020 2020 2020 2020 636f 6d70 6173  (.        compas
+00026ef0: 7328 0a20 2020 2020 2020 2020 2020 2073  s(.            s
+00026f00: 697a 653d 2870 6164 725f 6e75 622e 796d  ize=(padr_nub.ym
+00026f10: 696e 202d 2070 6164 622e 796d 6178 202d  in - padb.ymax -
+00026f20: 2077 6972 655f 7769 6474 682c 2077 6972   wire_width, wir
+00026f30: 655f 7769 6474 6829 2c0a 2020 2020 2020  e_width),.      
+00026f40: 2020 2020 2020 6c61 7965 723d 6f76 6572        layer=over
+00026f50: 6c61 705f 7a69 677a 6167 5f6c 6179 6572  lap_zigzag_layer
+00026f60: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+00026f70: 290a 2020 2020 6468 6561 642e 726f 7461  ).    dhead.rota
+00026f80: 7465 2839 3029 0a20 2020 2064 6865 6164  te(90).    dhead
+00026f90: 2e79 6d69 6e20 3d20 7061 6462 2e79 6d61  .ymin = padb.yma
+00026fa0: 780a 2020 2020 6468 6561 642e 786d 6178  x.    dhead.xmax
+00026fb0: 203d 2074 6169 6c2e 786d 696e 202d 2028   = tail.xmin - (
+00026fc0: 7769 7265 5f73 7061 6369 6e67 202b 2077  wire_spacing + w
+00026fd0: 6972 655f 7769 6474 6829 202f 2032 0a20  ire_width) / 2. 
+00026fe0: 2020 2063 6f6e 6e65 6374 6f72 203d 2043     connector = C
+00026ff0: 492e 6164 645f 7265 6628 0a20 2020 2020  I.add_ref(.     
+00027000: 2020 2063 6f6d 7061 7373 2873 697a 653d     compass(size=
+00027010: 2877 6972 655f 7769 6474 682c 2077 6972  (wire_width, wir
+00027020: 655f 7769 6474 6829 2c20 6c61 7965 723d  e_width), layer=
+00027030: 6f76 6572 6c61 705f 7a69 677a 6167 5f6c  overlap_zigzag_l
+00027040: 6179 6572 290a 2020 2020 290a 2020 2020  ayer).    ).    
+00027050: 636f 6e6e 6563 746f 722e 636f 6e6e 6563  connector.connec
+00027060: 7428 706f 7274 3d22 5322 2c20 6465 7374  t(port="S", dest
+00027070: 696e 6174 696f 6e3d 6468 6561 642e 706f  ination=dhead.po
+00027080: 7274 735b 2245 225d 290a 2020 2020 6f6c  rts["E"]).    ol
+00027090: 645f 706f 7274 203d 2063 6f6e 6e65 6374  d_port = connect
+000270a0: 6f72 2e70 6f72 7473 5b22 4e22 5d0a 2020  or.ports["N"].  
+000270b0: 2020 7269 6768 7420 3d20 5472 7565 0a20    right = True. 
+000270c0: 2020 206f 626a 203d 2063 6f6e 6e65 6374     obj = connect
+000270d0: 6f72 0a20 2020 2077 6869 6c65 206f 626a  or.    while obj
+000270e0: 2e79 6d61 7820 2b20 7769 7265 5f73 7061  .ymax + wire_spa
+000270f0: 6369 6e67 202b 2077 6972 655f 7769 6474  cing + wire_widt
+00027100: 6820 3c20 6865 6164 2e79 6d61 783a 0a20  h < head.ymax:. 
+00027110: 2020 2020 2020 206f 626a 203d 2043 492e         obj = CI.
+00027120: 6164 645f 7265 6628 0a20 2020 2020 2020  add_ref(.       
+00027130: 2020 2020 2063 6f6d 7061 7373 2873 697a       compass(siz
+00027140: 653d 2877 6972 655f 7370 6163 696e 672c  e=(wire_spacing,
+00027150: 2077 6972 655f 7769 6474 6829 2c20 6c61   wire_width), la
+00027160: 7965 723d 6f76 6572 6c61 705f 7a69 677a  yer=overlap_zigz
+00027170: 6167 5f6c 6179 6572 290a 2020 2020 2020  ag_layer).      
+00027180: 2020 290a 2020 2020 2020 2020 6f62 6a2e    ).        obj.
+00027190: 636f 6e6e 6563 7428 706f 7274 3d22 5722  connect(port="W"
+000271a0: 2c20 6465 7374 696e 6174 696f 6e3d 6f6c  , destination=ol
+000271b0: 645f 706f 7274 290a 2020 2020 2020 2020  d_port).        
+000271c0: 6f6c 645f 706f 7274 203d 206f 626a 2e70  old_port = obj.p
+000271d0: 6f72 7473 5b22 4522 5d0a 2020 2020 2020  orts["E"].      
+000271e0: 2020 6966 2072 6967 6874 3a0a 2020 2020    if right:.    
+000271f0: 2020 2020 2020 2020 6f62 6a20 3d20 4349          obj = CI
+00027200: 2e61 6464 5f72 6566 280a 2020 2020 2020  .add_ref(.      
+00027210: 2020 2020 2020 2020 2020 636f 6d70 6173            compas
+00027220: 7328 7369 7a65 3d28 7769 7265 5f77 6964  s(size=(wire_wid
+00027230: 7468 2c20 7769 7265 5f77 6964 7468 292c  th, wire_width),
+00027240: 206c 6179 6572 3d6f 7665 726c 6170 5f7a   layer=overlap_z
+00027250: 6967 7a61 675f 6c61 7965 7229 0a20 2020  igzag_layer).   
+00027260: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00027270: 2020 2020 2020 206f 626a 2e63 6f6e 6e65         obj.conne
+00027280: 6374 2870 6f72 743d 2257 222c 2064 6573  ct(port="W", des
+00027290: 7469 6e61 7469 6f6e 3d6f 6c64 5f70 6f72  tination=old_por
+000272a0: 7429 0a20 2020 2020 2020 2020 2020 2072  t).            r
+000272b0: 6967 6874 203d 2046 616c 7365 0a20 2020  ight = False.   
+000272c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000272d0: 2020 2020 2020 206f 626a 203d 2043 492e         obj = CI.
+000272e0: 6164 645f 7265 6628 0a20 2020 2020 2020  add_ref(.       
+000272f0: 2020 2020 2020 2020 2063 6f6d 7061 7373           compass
+00027300: 2873 697a 653d 2877 6972 655f 7769 6474  (size=(wire_widt
+00027310: 682c 2077 6972 655f 7769 6474 6829 2c20  h, wire_width), 
+00027320: 6c61 7965 723d 6f76 6572 6c61 705f 7a69  layer=overlap_zi
+00027330: 677a 6167 5f6c 6179 6572 290a 2020 2020  gzag_layer).    
+00027340: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00027350: 2020 2020 2020 6f62 6a2e 636f 6e6e 6563        obj.connec
+00027360: 7428 706f 7274 3d22 4522 2c20 6465 7374  t(port="E", dest
+00027370: 696e 6174 696f 6e3d 6f6c 645f 706f 7274  ination=old_port
+00027380: 290a 2020 2020 2020 2020 2020 2020 7269  ).            ri
+00027390: 6768 7420 3d20 5472 7565 0a20 2020 2020  ght = True.     
+000273a0: 2020 206f 6c64 5f70 6f72 7420 3d20 6f62     old_port = ob
+000273b0: 6a2e 706f 7274 735b 224e 225d 0a20 2020  j.ports["N"].   
+000273c0: 2020 2020 206f 626a 203d 2043 492e 6164       obj = CI.ad
+000273d0: 645f 7265 6628 0a20 2020 2020 2020 2020  d_ref(.         
+000273e0: 2020 2063 6f6d 7061 7373 280a 2020 2020     compass(.    
+000273f0: 2020 2020 2020 2020 2020 2020 7369 7a65              size
+00027400: 3d28 0a20 2020 2020 2020 2020 2020 2020  =(.             
+00027410: 2020 2020 2020 2064 6865 6164 2e78 6d69         dhead.xmi
+00027420: 6e20 2d20 2868 6561 642e 786d 6178 202b  n - (head.xmax +
+00027430: 2068 6561 642e 786d 696e 202b 2077 6972   head.xmin + wir
+00027440: 655f 7769 6474 6829 202f 2032 2c0a 2020  e_width) / 2,.  
+00027450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027460: 2020 7769 7265 5f77 6964 7468 2c0a 2020    wire_width,.  
+00027470: 2020 2020 2020 2020 2020 2020 2020 292c                ),
+00027480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027490: 206c 6179 6572 3d6f 7665 726c 6170 5f7a   layer=overlap_z
+000274a0: 6967 7a61 675f 6c61 7965 722c 0a20 2020  igzag_layer,.   
+000274b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000274c0: 2020 2029 0a20 2020 2020 2020 206f 626a     ).        obj
+000274d0: 2e63 6f6e 6e65 6374 2870 6f72 743d 2245  .connect(port="E
+000274e0: 222c 2064 6573 7469 6e61 7469 6f6e 3d6f  ", destination=o
+000274f0: 6c64 5f70 6f72 7429 0a20 2020 2020 2020  ld_port).       
+00027500: 206f 6c64 5f70 6f72 7420 3d20 6f62 6a2e   old_port = obj.
+00027510: 706f 7274 735b 2257 225d 0a20 2020 2020  ports["W"].     
+00027520: 2020 206f 626a 203d 2043 492e 6164 645f     obj = CI.add_
+00027530: 7265 6628 0a20 2020 2020 2020 2020 2020  ref(.           
+00027540: 2063 6f6d 7061 7373 2873 697a 653d 2877   compass(size=(w
+00027550: 6972 655f 7769 6474 682c 2077 6972 655f  ire_width, wire_
+00027560: 7769 6474 6829 2c20 6c61 7965 723d 6f76  width), layer=ov
+00027570: 6572 6c61 705f 7a69 677a 6167 5f6c 6179  erlap_zigzag_lay
+00027580: 6572 290a 2020 2020 2020 2020 290a 2020  er).        ).  
+00027590: 2020 2020 2020 6f62 6a2e 636f 6e6e 6563        obj.connec
+000275a0: 7428 706f 7274 3d22 5322 2c20 6465 7374  t(port="S", dest
+000275b0: 696e 6174 696f 6e3d 6f6c 645f 706f 7274  ination=old_port
+000275c0: 290a 2020 2020 2020 2020 6966 2072 6967  ).        if rig
+000275d0: 6874 3a0a 2020 2020 2020 2020 2020 2020  ht:.            
+000275e0: 6f6c 645f 706f 7274 203d 206f 626a 2e70  old_port = obj.p
+000275f0: 6f72 7473 5b22 5722 5d0a 2020 2020 2020  orts["W"].      
+00027600: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00027610: 2020 2020 6f6c 645f 706f 7274 203d 206f      old_port = o
+00027620: 626a 2e70 6f72 7473 5b22 4522 5d0a 0a20  bj.ports["E"].. 
+00027630: 2020 2072 6574 7572 6e20 4349 0a0a 0a64     return CI...d
+00027640: 6566 205f 7465 7374 5f69 635f 7769 7265  ef _test_ic_wire
+00027650: 5f73 7465 7028 7468 6963 6b5f 7769 6474  _step(thick_widt
+00027660: 683d 3130 2c20 7468 696e 5f77 6964 7468  h=10, thin_width
+00027670: 3d31 2c20 7769 7265 5f6c 6179 6572 3d32  =1, wire_layer=2
+00027680: 293a 0a20 2020 2022 2222 4865 6c70 6572  ):.    """Helper
+00027690: 2066 756e 6374 696f 6e20 7573 6564 2074   function used t
+000276a0: 6f20 6d61 6b65 2074 6865 2049 4320 7374  o make the IC st
+000276b0: 6570 2077 6972 6520 7374 7275 6374 7572  ep wire structur
+000276c0: 652e 2222 220a 2020 2020 5753 3420 3d20  e.""".    WS4 = 
+000276d0: 4465 7669 6365 2822 7465 7374 5f69 635f  Device("test_ic_
+000276e0: 7374 6570 2229 0a20 2020 2077 6972 655f  step").    wire_
+000276f0: 7374 6570 6120 3d20 5753 342e 6164 645f  stepa = WS4.add_
+00027700: 7265 6628 0a20 2020 2020 2020 206f 7074  ref(.        opt
+00027710: 696d 616c 5f73 7465 7028 7468 6963 6b5f  imal_step(thick_
+00027720: 7769 6474 6820 2f20 322c 2074 6869 6e5f  width / 2, thin_
+00027730: 7769 6474 6820 2f20 322c 206c 6179 6572  width / 2, layer
+00027740: 3d77 6972 655f 6c61 7965 7229 0a20 2020  =wire_layer).   
+00027750: 2029 0a20 2020 2077 6972 655f 7374 6570   ).    wire_step
+00027760: 6220 3d20 5753 342e 6164 645f 7265 6628  b = WS4.add_ref(
+00027770: 0a20 2020 2020 2020 206f 7074 696d 616c  .        optimal
+00027780: 5f73 7465 7028 7468 696e 5f77 6964 7468  _step(thin_width
+00027790: 202f 2032 2c20 7468 6963 6b5f 7769 6474   / 2, thick_widt
+000277a0: 6820 2f20 322c 206c 6179 6572 3d77 6972  h / 2, layer=wir
+000277b0: 655f 6c61 7965 7229 0a20 2020 2029 0a20  e_layer).    ). 
+000277c0: 2020 2077 6972 655f 7374 6570 6320 3d20     wire_stepc = 
+000277d0: 5753 342e 6164 645f 7265 6628 0a20 2020  WS4.add_ref(.   
+000277e0: 2020 2020 206f 7074 696d 616c 5f73 7465       optimal_ste
+000277f0: 7028 7468 6963 6b5f 7769 6474 6820 2f20  p(thick_width / 
+00027800: 322c 2074 6869 6e5f 7769 6474 6820 2f20  2, thin_width / 
+00027810: 322c 206c 6179 6572 3d77 6972 655f 6c61  2, layer=wire_la
+00027820: 7965 7229 0a20 2020 2029 0a20 2020 2077  yer).    ).    w
+00027830: 6972 655f 7374 6570 6420 3d20 5753 342e  ire_stepd = WS4.
+00027840: 6164 645f 7265 6628 0a20 2020 2020 2020  add_ref(.       
+00027850: 206f 7074 696d 616c 5f73 7465 7028 7468   optimal_step(th
+00027860: 696e 5f77 6964 7468 202f 2032 2c20 7468  in_width / 2, th
+00027870: 6963 6b5f 7769 6474 6820 2f20 322c 206c  ick_width / 2, l
+00027880: 6179 6572 3d77 6972 655f 6c61 7965 7229  ayer=wire_layer)
+00027890: 0a20 2020 2029 0a20 2020 2077 6972 655f  .    ).    wire_
+000278a0: 7374 6570 622e 726f 7461 7465 2831 3830  stepb.rotate(180
+000278b0: 290a 2020 2020 7769 7265 5f73 7465 7062  ).    wire_stepb
+000278c0: 2e78 6d69 6e20 3d20 7769 7265 5f73 7465  .xmin = wire_ste
+000278d0: 7061 2e78 6d69 6e0a 2020 2020 7769 7265  pa.xmin.    wire
+000278e0: 5f73 7465 7063 2e72 6f74 6174 6528 3138  _stepc.rotate(18
+000278f0: 3029 0a20 2020 2077 6972 655f 7374 6570  0).    wire_step
+00027900: 632e 786d 696e 203d 2077 6972 655f 7374  c.xmin = wire_st
+00027910: 6570 612e 786d 6178 0a20 2020 2077 6972  epa.xmax.    wir
+00027920: 655f 7374 6570 642e 786d 696e 203d 2077  e_stepd.xmin = w
+00027930: 6972 655f 7374 6570 632e 786d 696e 0a20  ire_stepc.xmin. 
+00027940: 2020 2072 6574 7572 6e20 5753 340a 0a0a     return WS4...
+00027950: 6465 6620 7465 7374 5f69 6328 0a20 2020  def test_ic(.   
+00027960: 2077 6972 655f 7769 6474 6873 3d5b 302e   wire_widths=[0.
+00027970: 3235 2c20 302e 352c 2031 2c20 322c 2034  25, 0.5, 1, 2, 4
+00027980: 5d2c 0a20 2020 2077 6972 655f 7769 6474  ],.    wire_widt
+00027990: 6873 5f77 6964 653d 5b30 2e37 352c 2031  hs_wide=[0.75, 1
+000279a0: 2e35 2c20 332c 2034 2c20 365d 2c0a 2020  .5, 3, 4, 6],.  
+000279b0: 2020 7061 645f 7369 7a65 3d28 3230 302c    pad_size=(200,
+000279c0: 2032 3030 292c 0a20 2020 2070 6164 5f67   200),.    pad_g
+000279d0: 6170 3d37 352c 0a20 2020 2077 6972 655f  ap=75,.    wire_
+000279e0: 6c61 7965 723d 302c 0a20 2020 2070 6164  layer=0,.    pad
+000279f0: 5f6c 6179 6572 3d31 2c0a 2020 2020 676e  _layer=1,.    gn
+00027a00: 645f 6c61 7965 723d 312c 0a29 3a0a 2020  d_layer=1,.):.  
+00027a10: 2020 2222 2243 7269 7469 6361 6c20 6375    """Critical cu
+00027a20: 7272 656e 7420 7465 7374 2073 7472 7563  rrent test struc
+00027a30: 7475 7265 2066 6f72 2073 7570 6572 636f  ture for superco
+00027a40: 6e64 7563 7469 6e67 2077 6972 6573 2e0a  nducting wires..
+00027a50: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
+00027a60: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00027a70: 2020 2077 6972 655f 7769 6474 6873 203a     wire_widths :
+00027a80: 2061 7272 6179 2d6c 696b 655b 4e5d 0a20   array-like[N]. 
+00027a90: 2020 2020 2020 2054 6865 2077 6964 7468         The width
+00027aa0: 7320 6f66 2074 6865 2074 6869 6e6e 6573  s of the thinnes
+00027ab0: 7420 7061 7274 7320 6f66 2074 6865 2074  t parts of the t
+00027ac0: 6573 7420 7769 7265 732e 0a20 2020 2077  est wires..    w
+00027ad0: 6972 655f 7769 6474 6873 5f77 6964 6520  ire_widths_wide 
+00027ae0: 3a20 6172 7261 792d 6c69 6b65 5b4e 5d0a  : array-like[N].
+00027af0: 2020 2020 2020 2020 5468 6520 7769 6474          The widt
+00027b00: 6873 206f 6620 7468 6520 7468 6963 6b65  hs of the thicke
+00027b10: 7374 2070 6172 7473 206f 6620 7468 6520  st parts of the 
+00027b20: 7465 7374 2077 6972 6573 2e0a 2020 2020  test wires..    
+00027b30: 7061 645f 7369 7a65 203a 2061 7272 6179  pad_size : array
+00027b40: 2d6c 696b 655b 325d 206f 6620 696e 7420  -like[2] of int 
+00027b50: 6f72 2066 6c6f 6174 0a20 2020 2020 2020  or float.       
+00027b60: 2028 7769 6474 682c 2068 6569 6768 7429   (width, height)
+00027b70: 206f 6620 7468 6520 7061 6473 2e0a 2020   of the pads..  
+00027b80: 2020 7061 645f 6761 7020 3a20 696e 7420    pad_gap : int 
+00027b90: 6f72 2066 6c6f 6174 0a20 2020 2020 2020  or float.       
+00027ba0: 2044 6973 7461 6e63 6520 6265 7477 6565   Distance betwee
+00027bb0: 6e20 7468 6520 7061 6473 2061 6e64 2074  n the pads and t
+00027bc0: 6865 2067 726f 756e 6420 706c 616e 652e  he ground plane.
+00027bd0: 0a20 2020 2077 6972 655f 6c61 7965 7220  .    wire_layer 
+00027be0: 3a20 696e 740a 2020 2020 2020 2020 5370  : int.        Sp
+00027bf0: 6563 6966 6963 206c 6179 6572 2873 2920  ecific layer(s) 
+00027c00: 746f 2070 7574 2074 6865 2077 6972 6573  to put the wires
+00027c10: 206f 6e2e 0a20 2020 2070 6164 5f6c 6179   on..    pad_lay
+00027c20: 6572 203a 2069 6e74 0a20 2020 2020 2020  er : int.       
+00027c30: 2053 7065 6369 6669 6320 6c61 7965 7228   Specific layer(
+00027c40: 7329 2074 6f20 7075 7420 7468 6520 7061  s) to put the pa
+00027c50: 6473 206f 6e2e 0a20 2020 2067 6e64 5f6c  ds on..    gnd_l
+00027c60: 6179 6572 203a 2069 6e74 206f 7220 4e6f  ayer : int or No
+00027c70: 6e65 0a20 2020 2020 2020 2053 7065 6369  ne.        Speci
+00027c80: 6669 6320 6c61 7965 7228 7329 2074 6f20  fic layer(s) to 
+00027c90: 7075 7420 7468 6520 6772 6f75 6e64 2070  put the ground p
+00027ca0: 6c61 6e65 206f 6e2e 0a0a 2020 2020 5265  lane on...    Re
+00027cb0: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00027cc0: 2d0a 2020 2020 4465 7669 6365 0a20 2020  -.    Device.   
+00027cd0: 2020 2020 2041 2044 6576 6963 6520 636f       A Device co
+00027ce0: 6e74 6169 6e69 6e67 2074 6865 2063 7269  ntaining the cri
+00027cf0: 7469 6361 6c2d 6375 7272 656e 7420 7465  tical-current te
+00027d00: 7374 2073 7472 7563 7475 7265 2e0a 2020  st structure..  
+00027d10: 2020 2222 220a 2020 2020 4943 5320 3d20    """.    ICS = 
+00027d20: 4465 7669 6365 2822 7465 7374 5f69 6322  Device("test_ic"
+00027d30: 290a 0a20 2020 2023 2069 6620 676e 645f  )..    # if gnd_
+00027d40: 6c61 7965 7220 6973 204e 6f6e 653a 2067  layer is None: g
+00027d50: 6e64 5f6c 6179 6572 203d 2070 6164 5f6c  nd_layer = pad_l
+00027d60: 6179 6572 0a20 2020 2074 7261 6e73 6c61  ayer.    transla
+00027d70: 7469 6f6e 203d 2030 0a20 2020 2070 6164  tion = 0.    pad
+00027d80: 6220 3d20 4943 532e 6164 645f 7265 6628  b = ICS.add_ref(
+00027d90: 0a20 2020 2020 2020 2072 6563 7461 6e67  .        rectang
+00027da0: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
+00027db0: 7369 7a65 3d28 6e70 2e73 697a 6528 7769  size=(np.size(wi
+00027dc0: 7265 5f77 6964 7468 7329 202a 2028 7061  re_widths) * (pa
+00027dd0: 645f 7369 7a65 5b30 5d20 2a20 3620 2f20  d_size[0] * 6 / 
+00027de0: 3529 2c20 7061 645f 7369 7a65 5b31 5d29  5), pad_size[1])
+00027df0: 2c0a 2020 2020 2020 2020 2020 2020 6c61  ,.            la
+00027e00: 7965 723d 7769 7265 5f6c 6179 6572 2c0a  yer=wire_layer,.
+00027e10: 2020 2020 2020 2020 290a 2020 2020 290a          ).    ).
+00027e20: 0a20 2020 2070 6164 625f 6f76 6572 6c61  .    padb_overla
+00027e30: 7920 3d20 4943 532e 6164 645f 7265 6628  y = ICS.add_ref(
+00027e40: 0a20 2020 2020 2020 2072 6563 7461 6e67  .        rectang
+00027e50: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
+00027e60: 7369 7a65 3d28 0a20 2020 2020 2020 2020  size=(.         
+00027e70: 2020 2020 2020 2028 6e70 2e73 697a 6528         (np.size(
+00027e80: 7769 7265 5f77 6964 7468 7329 202a 2028  wire_widths) * (
+00027e90: 7061 645f 7369 7a65 5b30 5d20 2a20 3620  pad_size[0] * 6 
+00027ea0: 2f20 3529 2920 2a20 3920 2f20 3130 2c0a  / 5)) * 9 / 10,.
+00027eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027ec0: 7061 645f 7369 7a65 5b31 5d20 2a20 3920  pad_size[1] * 9 
+00027ed0: 2f20 3130 2c0a 2020 2020 2020 2020 2020  / 10,.          
+00027ee0: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+00027ef0: 206c 6179 6572 3d67 6e64 5f6c 6179 6572   layer=gnd_layer
+00027f00: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+00027f10: 290a 2020 2020 7061 6462 5f6f 7665 726c  ).    padb_overl
+00027f20: 6179 2e63 656e 7465 7220 3d20 7061 6462  ay.center = padb
+00027f30: 2e63 656e 7465 720a 2020 2020 7061 6462  .center.    padb
+00027f40: 5f6f 7665 726c 6179 2e79 6d69 6e20 3d20  _overlay.ymin = 
+00027f50: 7061 6462 2e79 6d69 6e0a 2020 2020 666f  padb.ymin.    fo
+00027f60: 7220 692c 2078 2069 6e20 656e 756d 6572  r i, x in enumer
+00027f70: 6174 6528 7769 7265 5f77 6964 7468 735f  ate(wire_widths_
+00027f80: 7769 6465 293a 0a20 2020 2020 2020 2070  wide):.        p
+00027f90: 6164 7420 3d20 4943 532e 6164 645f 7265  adt = ICS.add_re
+00027fa0: 6628 7265 6374 616e 676c 6528 7061 645f  f(rectangle(pad_
+00027fb0: 7369 7a65 2c20 7769 7265 5f6c 6179 6572  size, wire_layer
+00027fc0: 2929 0a20 2020 2020 2020 2070 6164 742e  )).        padt.
+00027fd0: 786d 696e 203d 2070 6164 622e 786d 696e  xmin = padb.xmin
+00027fe0: 202b 2074 7261 6e73 6c61 7469 6f6e 0a20   + translation. 
+00027ff0: 2020 2020 2020 2070 6164 742e 796d 696e         padt.ymin
+00028000: 203d 2070 6164 622e 796d 6178 202b 2070   = padb.ymax + p
+00028010: 6164 5f67 6170 0a20 2020 2020 2020 2070  ad_gap.        p
+00028020: 6164 745f 6f76 6572 6c61 7920 3d20 4943  adt_overlay = IC
+00028030: 532e 6164 645f 7265 6628 0a20 2020 2020  S.add_ref(.     
+00028040: 2020 2020 2020 2072 6563 7461 6e67 6c65         rectangle
+00028050: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00028060: 2020 7369 7a65 3d28 7061 645f 7369 7a65    size=(pad_size
+00028070: 5b30 5d20 2a20 3920 2f20 3130 2c20 7061  [0] * 9 / 10, pa
+00028080: 645f 7369 7a65 5b31 5d20 2a20 3920 2f20  d_size[1] * 9 / 
+00028090: 3130 292c 206c 6179 6572 3d70 6164 5f6c  10), layer=pad_l
+000280a0: 6179 6572 0a20 2020 2020 2020 2020 2020  ayer.           
+000280b0: 2029 0a20 2020 2020 2020 2029 0a20 2020   ).        ).   
+000280c0: 2020 2020 2070 6164 745f 6f76 6572 6c61       padt_overla
+000280d0: 792e 6365 6e74 6572 203d 2070 6164 742e  y.center = padt.
+000280e0: 6365 6e74 6572 0a20 2020 2020 2020 2070  center.        p
+000280f0: 6164 745f 6f76 6572 6c61 792e 796d 6178  adt_overlay.ymax
+00028100: 203d 2070 6164 742e 796d 6178 0a20 2020   = padt.ymax.   
+00028110: 2020 2020 2064 6966 6665 7265 6e63 6520       difference 
+00028120: 3d20 7061 6474 2e79 6d69 6e20 2d20 7061  = padt.ymin - pa
+00028130: 6462 2e79 6d61 780a 2020 2020 2020 2020  db.ymax.        
+00028140: 7769 7265 5f73 7465 7020 3d20 4943 532e  wire_step = ICS.
+00028150: 6164 645f 7265 6628 0a20 2020 2020 2020  add_ref(.       
+00028160: 2020 2020 205f 7465 7374 5f69 635f 7769       _test_ic_wi
+00028170: 7265 5f73 7465 7028 0a20 2020 2020 2020  re_step(.       
+00028180: 2020 2020 2020 2020 2077 6972 655f 7769           wire_wi
+00028190: 6474 6873 5f77 6964 655b 695d 2c20 7769  dths_wide[i], wi
+000281a0: 7265 5f77 6964 7468 735b 695d 2c20 7769  re_widths[i], wi
+000281b0: 7265 5f6c 6179 6572 3d77 6972 655f 6c61  re_layer=wire_la
+000281c0: 7965 720a 2020 2020 2020 2020 2020 2020  yer.            
+000281d0: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+000281e0: 2020 2020 7769 7265 5f73 7465 702e 726f      wire_step.ro
+000281f0: 7461 7465 2839 3029 0a20 2020 2020 2020  tate(90).       
+00028200: 2077 6972 655f 7374 6570 2e63 656e 7465   wire_step.cente
+00028210: 7220 3d20 2870 6164 742e 6365 6e74 6572  r = (padt.center
+00028220: 5b30 5d2c 2070 6164 622e 796d 6178 202b  [0], padb.ymax +
+00028230: 2064 6966 6665 7265 6e63 6520 2f20 3229   difference / 2)
+00028240: 0a20 2020 2020 2020 2074 7261 6e73 6c61  .        transla
+00028250: 7469 6f6e 203d 2074 7261 6e73 6c61 7469  tion = translati
+00028260: 6f6e 202b 2070 6164 5f73 697a 655b 305d  on + pad_size[0]
+00028270: 202a 2031 3220 2f20 3130 0a20 2020 2020   * 12 / 10.     
+00028280: 2020 2063 6f6e 6e5f 7769 7265 5f74 6f70     conn_wire_top
+00028290: 203d 2049 4353 2e61 6464 5f72 6566 280a   = ICS.add_ref(.
+000282a0: 2020 2020 2020 2020 2020 2020 7265 6374              rect
+000282b0: 616e 676c 6528 0a20 2020 2020 2020 2020  angle(.         
+000282c0: 2020 2020 2020 2073 697a 653d 2877 6972         size=(wir
+000282d0: 655f 7769 6474 6873 5f77 6964 655b 695d  e_widths_wide[i]
+000282e0: 2c20 7061 6474 2e79 6d69 6e20 2d20 7769  , padt.ymin - wi
+000282f0: 7265 5f73 7465 702e 796d 6178 292c 206c  re_step.ymax), l
+00028300: 6179 6572 3d77 6972 655f 6c61 7965 720a  ayer=wire_layer.
+00028310: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00028320: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00028330: 636f 6e6e 5f77 6972 655f 626f 7474 6f6d  conn_wire_bottom
+00028340: 203d 2049 4353 2e61 6464 5f72 6566 280a   = ICS.add_ref(.
+00028350: 2020 2020 2020 2020 2020 2020 7265 6374              rect
+00028360: 616e 676c 6528 0a20 2020 2020 2020 2020  angle(.         
+00028370: 2020 2020 2020 2073 697a 653d 2877 6972         size=(wir
+00028380: 655f 7769 6474 6873 5f77 6964 655b 695d  e_widths_wide[i]
+00028390: 2c20 7769 7265 5f73 7465 702e 796d 696e  , wire_step.ymin
+000283a0: 202d 2070 6164 622e 796d 6178 292c 206c   - padb.ymax), l
+000283b0: 6179 6572 3d77 6972 655f 6c61 7965 720a  ayer=wire_layer.
+000283c0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000283d0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000283e0: 636f 6e6e 5f77 6972 655f 746f 702e 796d  conn_wire_top.ym
+000283f0: 6178 203d 2070 6164 742e 796d 696e 0a20  ax = padt.ymin. 
+00028400: 2020 2020 2020 2063 6f6e 6e5f 7769 7265         conn_wire
+00028410: 5f74 6f70 2e78 6d69 6e20 3d20 7769 7265  _top.xmin = wire
+00028420: 5f73 7465 702e 786d 696e 0a20 2020 2020  _step.xmin.     
+00028430: 2020 2063 6f6e 6e5f 7769 7265 5f62 6f74     conn_wire_bot
+00028440: 746f 6d2e 796d 696e 203d 2070 6164 622e  tom.ymin = padb.
+00028450: 796d 6178 0a20 2020 2020 2020 2063 6f6e  ymax.        con
+00028460: 6e5f 7769 7265 5f62 6f74 746f 6d2e 786d  n_wire_bottom.xm
+00028470: 696e 203d 2077 6972 655f 7374 6570 2e78  in = wire_step.x
+00028480: 6d69 6e0a 0a20 2020 2072 6574 7572 6e20  min..    return 
+00028490: 4943 530a 0a0a 6465 6620 7465 7374 5f72  ICS...def test_r
+000284a0: 6573 280a 2020 2020 7061 645f 7369 7a65  es(.    pad_size
+000284b0: 3d5b 3530 2c20 3530 5d2c 206e 756d 5f73  =[50, 50], num_s
+000284c0: 7175 6172 6573 3d31 3030 302c 2077 6964  quares=1000, wid
+000284d0: 7468 3d31 2c20 7265 735f 6c61 7965 723d  th=1, res_layer=
+000284e0: 302c 2070 6164 5f6c 6179 6572 3d31 2c20  0, pad_layer=1, 
+000284f0: 676e 645f 6c61 7965 723d 320a 293a 0a20  gnd_layer=2.):. 
+00028500: 2020 2022 2222 4372 6561 7465 7320 616e     """Creates an
+00028510: 2065 6666 6963 6965 6e74 2072 6573 6f6e   efficient reson
+00028520: 6174 6f72 2073 7472 7563 7475 7265 2066  ator structure f
+00028530: 6f72 2061 2077 6166 6572 206c 6179 6f75  or a wafer layou
+00028540: 742e 0a0a 2020 2020 5061 7261 6d65 7465  t...    Paramete
+00028550: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+00028560: 2d0a 2020 2020 7061 645f 7369 7a65 203a  -.    pad_size :
+00028570: 2061 7272 6179 2d6c 696b 655b 325d 206f   array-like[2] o
+00028580: 6620 696e 7420 6f72 2066 6c6f 6174 0a20  f int or float. 
+00028590: 2020 2020 2020 2028 7769 6474 682c 2068         (width, h
+000285a0: 6569 6768 7429 206f 6620 7468 6520 7477  eight) of the tw
+000285b0: 6f20 6d61 7463 6865 6420 696d 7065 6461  o matched impeda
+000285c0: 6e63 6520 7061 6473 2069 6e20 6d69 6372  nce pads in micr
+000285d0: 6f6e 732e 0a20 2020 206e 756d 5f73 7175  ons..    num_squ
+000285e0: 6172 6573 203a 2069 6e74 206f 7220 666c  ares : int or fl
+000285f0: 6f61 740a 2020 2020 2020 2020 4e75 6d62  oat.        Numb
+00028600: 6572 206f 6620 7371 7561 7265 7320 636f  er of squares co
+00028610: 6d70 7269 7369 6e67 2074 6865 2072 6573  mprising the res
+00028620: 6f6e 6174 6f72 2077 6972 652e 0a20 2020  onator wire..   
+00028630: 2077 6964 7468 203a 2069 6e74 206f 7220   width : int or 
+00028640: 666c 6f61 740a 2020 2020 2020 2020 5468  float.        Th
+00028650: 6520 7769 6474 6820 6f66 2074 6865 2073  e width of the s
+00028660: 7175 6172 6573 2069 6e20 6d69 6372 6f6e  quares in micron
+00028670: 732e 0a20 2020 2072 6573 5f6c 6179 6572  s..    res_layer
+00028680: 203a 2069 6e74 0a20 2020 2020 2020 2053   : int.        S
+00028690: 7065 6369 6669 6320 6c61 7965 7228 7329  pecific layer(s)
+000286a0: 2074 6f20 7075 7420 7468 6520 7265 736f   to put the reso
+000286b0: 6e61 746f 7220 7374 7275 6374 7572 6520  nator structure 
+000286c0: 6f6e 2e0a 2020 2020 7061 645f 6c61 7965  on..    pad_laye
+000286d0: 7220 3a20 696e 7420 6f72 204e 6f6e 650a  r : int or None.
+000286e0: 2020 2020 2020 2020 5370 6563 6966 6963          Specific
+000286f0: 206c 6179 6572 2873 2920 746f 2070 7574   layer(s) to put
+00028700: 2074 6865 2070 6164 7320 6f6e 2e0a 2020   the pads on..  
+00028710: 2020 676e 645f 6c61 7965 7220 3a20 2069    gnd_layer :  i
+00028720: 6e74 206f 7220 4e6f 6e65 0a20 2020 2020  nt or None.     
+00028730: 2020 2053 7065 6369 6669 6320 6c61 7965     Specific laye
+00028740: 7228 7329 2074 6f20 7075 7420 7468 6520  r(s) to put the 
+00028750: 6772 6f75 6e64 2070 6c61 6e65 206f 6e2e  ground plane on.
+00028760: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
+00028770: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 5020    -------.    P 
+00028780: 3a20 4465 7669 6365 0a20 2020 2020 2020  : Device.       
+00028790: 2041 2044 6576 6963 6520 636f 6e74 6169   A Device contai
+000287a0: 6e69 6e67 2061 6e20 6566 6669 6369 656e  ning an efficien
+000287b0: 7420 7265 736f 6e61 746f 7220 7374 7275  t resonator stru
+000287c0: 6374 7572 652e 0a20 2020 2022 2222 0a20  cture..    """. 
+000287d0: 2020 2078 203d 2070 6164 5f73 697a 655b     x = pad_size[
+000287e0: 305d 0a20 2020 207a 203d 2070 6164 5f73  0].    z = pad_s
+000287f0: 697a 655b 315d 0a0a 2020 2020 2320 4368  ize[1]..    # Ch
+00028800: 6563 6b69 6e67 2076 616c 6964 6974 7920  ecking validity 
+00028810: 6f66 2069 6e70 7574 0a20 2020 2069 6620  of input.    if 
+00028820: 7820 3c3d 2030 206f 7220 7a20 3c3d 2030  x <= 0 or z <= 0
+00028830: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
+00028840: 5661 6c75 6545 7272 6f72 2822 5061 6420  ValueError("Pad 
+00028850: 6d75 7374 2068 6176 6520 706f 7369 7469  must have positi
+00028860: 7665 2c20 7265 616c 2064 696d 656e 7369  ve, real dimensi
+00028870: 6f6e 7322 290a 2020 2020 656c 6966 2077  ons").    elif w
+00028880: 6964 7468 203e 207a 3a0a 2020 2020 2020  idth > z:.      
+00028890: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+000288a0: 6f72 2822 5769 6474 6820 6f66 2063 656c  or("Width of cel
+000288b0: 6c20 6361 6e6e 6f74 2062 6520 6772 6561  l cannot be grea
+000288c0: 7465 7220 7468 616e 2068 6569 6768 7420  ter than height 
+000288d0: 6f66 2070 6164 2229 0a20 2020 2065 6c69  of pad").    eli
+000288e0: 6620 6e75 6d5f 7371 7561 7265 7320 3c3d  f num_squares <=
+000288f0: 2030 3a0a 2020 2020 2020 2020 7261 6973   0:.        rais
+00028900: 6520 5661 6c75 6545 7272 6f72 2822 4e75  e ValueError("Nu
+00028910: 6d62 6572 206f 6620 7371 7561 7265 7320  mber of squares 
+00028920: 6d75 7374 2062 6520 6120 706f 7369 7469  must be a positi
+00028930: 7665 2072 6561 6c20 6e75 6d62 6572 2229  ve real number")
+00028940: 0a20 2020 2065 6c69 6620 7769 6474 6820  .    elif width 
+00028950: 3c3d 2030 3a0a 2020 2020 2020 2020 7261  <= 0:.        ra
+00028960: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+00028970: 5769 6474 6820 6f66 2063 656c 6c20 6d75  Width of cell mu
+00028980: 7374 2062 6520 6120 706f 7369 7469 7665  st be a positive
+00028990: 2072 6561 6c20 6e75 6d62 6572 2229 0a0a   real number")..
+000289a0: 2020 2020 2320 5065 7266 6f72 6d69 6e67      # Performing
+000289b0: 2070 7265 6c69 6d69 6e61 7279 2063 616c   preliminary cal
+000289c0: 6375 6c61 7469 6f6e 730a 2020 2020 6e75  culations.    nu
+000289d0: 6d5f 726f 7773 203d 2069 6e74 286e 702e  m_rows = int(np.
+000289e0: 666c 6f6f 7228 7a20 2f20 2832 202a 2077  floor(z / (2 * w
+000289f0: 6964 7468 2929 290a 2020 2020 6966 206e  idth))).    if n
+00028a00: 756d 5f72 6f77 7320 2520 3220 3d3d 2030  um_rows % 2 == 0
+00028a10: 3a0a 2020 2020 2020 2020 6e75 6d5f 726f  :.        num_ro
+00028a20: 7773 202d 3d20 310a 2020 2020 6e75 6d5f  ws -= 1.    num_
+00028a30: 636f 6c75 6d6e 7320 3d20 6e75 6d5f 726f  columns = num_ro
+00028a40: 7773 202d 2031 0a20 2020 2073 7175 6172  ws - 1.    squar
+00028a50: 6573 5f69 6e5f 726f 7720 3d20 286e 756d  es_in_row = (num
+00028a60: 5f73 7175 6172 6573 202d 206e 756d 5f63  _squares - num_c
+00028a70: 6f6c 756d 6e73 202d 2032 2920 2f20 6e75  olumns - 2) / nu
+00028a80: 6d5f 726f 7773 0a0a 2020 2020 2320 436f  m_rows..    # Co
+00028a90: 6d70 656e 7361 7469 6e67 2066 6f72 2077  mpensating for w
+00028aa0: 6569 7264 2065 6467 6520 6361 7365 730a  eird edge cases.
+00028ab0: 2020 2020 6966 2073 7175 6172 6573 5f69      if squares_i
+00028ac0: 6e5f 726f 7720 3c20 313a 0a20 2020 2020  n_row < 1:.     
+00028ad0: 2020 206e 756d 5f72 6f77 7320 3d20 696e     num_rows = in
+00028ae0: 7428 726f 756e 6428 6e75 6d5f 726f 7773  t(round(num_rows
+00028af0: 202f 2032 2920 2d20 3229 0a20 2020 2020   / 2) - 2).     
+00028b00: 2020 2073 7175 6172 6573 5f69 6e5f 726f     squares_in_ro
+00028b10: 7720 3d20 310a 2020 2020 6966 2077 6964  w = 1.    if wid
+00028b20: 7468 202a 2032 203e 207a 3a0a 2020 2020  th * 2 > z:.    
+00028b30: 2020 2020 6e75 6d5f 726f 7773 203d 2031      num_rows = 1
+00028b40: 0a20 2020 2020 2020 2073 7175 6172 6573  .        squares
+00028b50: 5f69 6e5f 726f 7720 3d20 6e75 6d5f 7371  _in_row = num_sq
+00028b60: 7561 7265 7320 2d20 320a 0a20 2020 206c  uares - 2..    l
+00028b70: 656e 6774 685f 726f 7720 3d20 7371 7561  ength_row = squa
+00028b80: 7265 735f 696e 5f72 6f77 202a 2077 6964  res_in_row * wid
+00028b90: 7468 0a0a 2020 2020 2320 4372 6561 7469  th..    # Creati
+00028ba0: 6e67 2072 6f77 2f63 6f6c 756d 6e20 636f  ng row/column co
+00028bb0: 726e 6572 2063 6f6d 6269 6e61 7469 6f6e  rner combination
+00028bc0: 2073 7472 7563 7475 7265 0a20 2020 2054   structure.    T
+00028bd0: 203d 2044 6576 6963 6528 290a 2020 2020   = Device().    
+00028be0: 526f 7720 3d20 7265 6374 616e 676c 6528  Row = rectangle(
+00028bf0: 7369 7a65 3d28 6c65 6e67 7468 5f72 6f77  size=(length_row
+00028c00: 2c20 7769 6474 6829 2c20 6c61 7965 723d  , width), layer=
+00028c10: 7265 735f 6c61 7965 7229 0a20 2020 2043  res_layer).    C
+00028c20: 6f6c 203d 2072 6563 7461 6e67 6c65 2873  ol = rectangle(s
+00028c30: 697a 653d 2877 6964 7468 2c20 7769 6474  ize=(width, widt
+00028c40: 6829 2c20 6c61 7965 723d 7265 735f 6c61  h), layer=res_la
+00028c50: 7965 7229 0a0a 2020 2020 542e 6164 645f  yer)..    T.add_
+00028c60: 7265 6628 526f 7729 0a20 2020 2063 6f6c  ref(Row).    col
+00028c70: 203d 2054 2e61 6464 5f72 6566 2843 6f6c   = T.add_ref(Col
+00028c80: 290a 2020 2020 636f 6c2e 6d6f 7665 285b  ).    col.move([
+00028c90: 6c65 6e67 7468 5f72 6f77 202d 2077 6964  length_row - wid
+00028ca0: 7468 2c20 2d77 6964 7468 5d29 0a0a 2020  th, -width])..  
+00028cb0: 2020 2320 4372 6561 7469 6e67 2065 6e74    # Creating ent
+00028cc0: 6972 6520 7761 7665 6775 6964 6520 6e65  ire waveguide ne
+00028cd0: 740a 2020 2020 4e20 3d20 4465 7669 6365  t.    N = Device
+00028ce0: 2822 6e65 7422 290a 2020 2020 6e20 3d20  ("net").    n = 
+00028cf0: 310a 2020 2020 666f 7220 6920 696e 2072  1.    for i in r
+00028d00: 616e 6765 286e 756d 5f72 6f77 7329 3a0a  ange(num_rows):.
+00028d10: 2020 2020 2020 2020 6966 2069 2021 3d20          if i != 
+00028d20: 6e75 6d5f 726f 7773 202d 2031 3a0a 2020  num_rows - 1:.  
+00028d30: 2020 2020 2020 2020 2020 6420 3d20 4e2e            d = N.
+00028d40: 6164 645f 7265 6628 5429 0a20 2020 2020  add_ref(T).     
+00028d50: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00028d60: 2020 2020 2064 203d 204e 2e61 6464 5f72       d = N.add_r
+00028d70: 6566 2852 6f77 290a 2020 2020 2020 2020  ef(Row).        
+00028d80: 6966 206e 2025 2032 203d 3d20 303a 0a20  if n % 2 == 0:. 
+00028d90: 2020 2020 2020 2020 2020 2064 2e6d 6972             d.mir
+00028da0: 726f 7228 7031 3d28 642e 782c 2064 2e79  ror(p1=(d.x, d.y
+00028db0: 6d61 7829 2c20 7032 3d28 642e 782c 2064  max), p2=(d.x, d
+00028dc0: 2e79 6d69 6e29 290a 2020 2020 2020 2020  .ymin)).        
+00028dd0: 642e 6d6f 7665 7928 2d28 6e20 2d20 3129  d.movey(-(n - 1)
+00028de0: 202a 2054 2e79 7369 7a65 290a 2020 2020   * T.ysize).    
+00028df0: 2020 2020 6e20 2b3d 2031 0a20 2020 2064      n += 1.    d
+00028e00: 203d 204e 2e61 6464 5f72 6566 2843 6f6c   = N.add_ref(Col
+00028e10: 292e 6d6f 7665 7828 2d77 6964 7468 290a  ).movex(-width).
+00028e20: 2020 2020 6420 3d20 4e2e 6164 645f 7265      d = N.add_re
+00028e30: 6628 436f 6c29 2e6d 6f76 6528 5b6c 656e  f(Col).move([len
+00028e40: 6774 685f 726f 772c 202d 286e 202d 2032  gth_row, -(n - 2
+00028e50: 2920 2a20 542e 7973 697a 655d 290a 0a20  ) * T.ysize]).. 
+00028e60: 2020 2023 2043 7265 6174 696e 6720 7061     # Creating pa
+00028e70: 6473 0a20 2020 2050 203d 2044 6576 6963  ds.    P = Devic
+00028e80: 6528 2274 6573 745f 7265 7322 290a 2020  e("test_res").  
+00028e90: 2020 5061 6431 203d 2072 6563 7461 6e67    Pad1 = rectang
+00028ea0: 6c65 2873 697a 653d 2878 2c20 7a29 2c20  le(size=(x, z), 
+00028eb0: 6c61 7965 723d 7061 645f 6c61 7965 7229  layer=pad_layer)
+00028ec0: 0a20 2020 2050 6164 3220 3d20 7265 6374  .    Pad2 = rect
+00028ed0: 616e 676c 6528 7369 7a65 3d28 7820 2b20  angle(size=(x + 
+00028ee0: 352c 207a 292c 206c 6179 6572 3d70 6164  5, z), layer=pad
+00028ef0: 5f6c 6179 6572 290a 2020 2020 476e 6431  _layer).    Gnd1
+00028f00: 203d 206f 6666 7365 7428 5061 6431 2c20   = offset(Pad1, 
+00028f10: 6469 7374 616e 6365 3d2d 352c 206c 6179  distance=-5, lay
+00028f20: 6572 3d67 6e64 5f6c 6179 6572 290a 2020  er=gnd_layer).  
+00028f30: 2020 476e 6432 203d 206f 6666 7365 7428    Gnd2 = offset(
+00028f40: 5061 6432 2c20 6469 7374 616e 6365 3d2d  Pad2, distance=-
+00028f50: 352c 206c 6179 6572 3d67 6e64 5f6c 6179  5, layer=gnd_lay
+00028f60: 6572 290a 2020 2020 7061 6431 203d 2050  er).    pad1 = P
+00028f70: 2e61 6464 5f72 6566 2850 6164 3129 2e6d  .add_ref(Pad1).m
+00028f80: 6f76 6578 282d 7820 2d20 7769 6474 6829  ovex(-x - width)
+00028f90: 0a20 2020 2070 6164 3220 3d20 502e 6164  .    pad2 = P.ad
+00028fa0: 645f 7265 6628 5061 6431 292e 6d6f 7665  d_ref(Pad1).move
+00028fb0: 7828 6c65 6e67 7468 5f72 6f77 202b 2077  x(length_row + w
+00028fc0: 6964 7468 290a 2020 2020 502e 6164 645f  idth).    P.add_
+00028fd0: 7265 6628 476e 6431 292e 6365 6e74 6572  ref(Gnd1).center
+00028fe0: 203d 2070 6164 312e 6365 6e74 6572 2020   = pad1.center  
+00028ff0: 2320 676e 6431 0a20 2020 2067 6e64 3220  # gnd1.    gnd2 
+00029000: 3d20 502e 6164 645f 7265 6628 476e 6432  = P.add_ref(Gnd2
+00029010: 290a 2020 2020 502e 6164 645f 7265 6628  ).    P.add_ref(
+00029020: 4e29 2e79 203d 2070 6164 312e 7920 2023  N).y = pad1.y  #
+00029030: 206e 6574 730a 2020 2020 676e 6432 2e63   nets.    gnd2.c
+00029040: 656e 7465 7220 3d20 7061 6432 2e63 656e  enter = pad2.cen
+00029050: 7465 720a 2020 2020 676e 6432 2e6d 6f76  ter.    gnd2.mov
+00029060: 6578 2832 2e35 290a 0a20 2020 2072 6574  ex(2.5)..    ret
+00029070: 7572 6e20 500a 0a0a 2320 3d3d 3d3d 3d3d  urn P...# ======
+00029080: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00029090: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000290a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000290b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000290c0: 3d3d 3d3d 3d3d 3d3d 0a23 0a23 204f 7074  ========.#.# Opt
+000290d0: 696d 616c 2063 7572 7265 6e74 2d63 726f  imal current-cro
+000290e0: 7764 696e 6720 7375 7065 7263 6f6e 6475  wding supercondu
+000290f0: 6374 696e 6720 7374 7275 6374 7572 6573  cting structures
+00029100: 0a23 0a23 203d 3d3d 3d3d 3d3d 3d3d 3d3d  .#.# ===========
+00029110: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00029120: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00029130: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00029140: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00029150: 3d3d 3d0a 0a0a 4064 6576 6963 655f 6c72  ===...@device_lr
+00029160: 755f 6361 6368 650a 6465 6620 6f70 7469  u_cache.def opti
+00029170: 6d61 6c5f 6861 6972 7069 6e28 7769 6474  mal_hairpin(widt
+00029180: 683d 302e 322c 2070 6974 6368 3d30 2e36  h=0.2, pitch=0.6
+00029190: 2c20 6c65 6e67 7468 3d31 302c 2074 7572  , length=10, tur
+000291a0: 6e5f 7261 7469 6f3d 342c 206e 756d 5f70  n_ratio=4, num_p
+000291b0: 7473 3d35 302c 206c 6179 6572 3d30 293a  ts=50, layer=0):
+000291c0: 0a20 2020 2022 2222 4372 6561 7465 7320  .    """Creates 
+000291d0: 616e 206f 7074 696d 616c 6c79 2d72 6f75  an optimally-rou
+000291e0: 6e64 6564 2068 6169 7270 696e 2067 656f  nded hairpin geo
+000291f0: 6d65 7472 792c 2077 6974 6820 6120 3138  metry, with a 18
+00029200: 3020 6465 6772 6565 2074 7572 6e0a 2020  0 degree turn.  
+00029210: 2020 6f6e 2074 6865 2072 6967 6874 2065    on the right e
+00029220: 6e64 206f 6620 7468 6520 706f 6c79 676f  nd of the polygo
+00029230: 6e20 636f 6e6e 6563 7465 6420 746f 2074  n connected to t
+00029240: 776f 2070 726f 6e67 7320 6578 7465 6e64  wo prongs extend
+00029250: 696e 6720 746f 7761 7264 730a 2020 2020  ing towards.    
+00029260: 706f 7274 7320 6f6e 2074 6865 206c 6566  ports on the lef
+00029270: 7420 656e 642e 0a0a 2020 2020 5061 7261  t end...    Para
+00029280: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
+00029290: 2d2d 2d2d 2d0a 2020 2020 7769 6474 6820  -----.    width 
+000292a0: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
+000292b0: 2020 2020 2020 2057 6964 7468 206f 6620         Width of 
+000292c0: 7468 6520 6861 6972 7069 6e20 6c65 6164  the hairpin lead
+000292d0: 732e 0a20 2020 2070 6974 6368 203a 2069  s..    pitch : i
+000292e0: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
+000292f0: 2020 2020 4469 7374 616e 6365 2062 6574      Distance bet
+00029300: 7765 656e 2074 6865 2074 776f 2068 6169  ween the two hai
+00029310: 7270 696e 206c 6561 6473 2e20 4d75 7374  rpin leads. Must
+00029320: 2062 6520 6772 6561 7465 7220 7468 616e   be greater than
+00029330: 2077 6964 7468 2e0a 2020 2020 6c65 6e67   width..    leng
+00029340: 7468 203a 2069 6e74 206f 7220 666c 6f61  th : int or floa
+00029350: 740a 2020 2020 2020 2020 4c65 6e67 7468  t.        Length
+00029360: 206f 6620 7468 6520 6861 6972 7069 6e20   of the hairpin 
+00029370: 6672 6f6d 2074 6865 2063 6f6e 6e65 6374  from the connect
+00029380: 6f72 7320 746f 2074 6865 206f 7070 6f73  ors to the oppos
+00029390: 6974 6520 656e 6420 6f66 2074 6865 0a20  ite end of the. 
+000293a0: 2020 2020 2020 2063 7572 7665 2e0a 2020         curve..  
+000293b0: 2020 7475 726e 5f72 6174 696f 203a 2069    turn_ratio : i
+000293c0: 6e74 206f 7220 666c 6f61 740a 2020 2020  nt or float.    
+000293d0: 2020 2020 5370 6563 6966 6965 7320 686f      Specifies ho
+000293e0: 7720 6d75 6368 206f 6620 7468 6520 6861  w much of the ha
+000293f0: 6972 7069 6e20 6973 2064 6564 6963 6174  irpin is dedicat
+00029400: 6564 2074 6f20 7468 6520 3138 3020 6465  ed to the 180 de
+00029410: 6772 6565 2074 7572 6e2e 0a20 2020 2020  gree turn..     
+00029420: 2020 2041 2074 7572 6e5f 7261 7469 6f20     A turn_ratio 
+00029430: 6f66 2031 3020 7769 6c6c 2072 6573 756c  of 10 will resul
+00029440: 7420 696e 2032 3025 206f 6620 7468 6520  t in 20% of the 
+00029450: 6861 6972 7069 6e20 6265 696e 6720 636f  hairpin being co
+00029460: 6d70 7269 7365 6420 6f66 2074 6865 2074  mprised of the t
+00029470: 7572 6e2e 0a20 2020 206e 756d 5f70 7473  urn..    num_pts
+00029480: 203a 2069 6e74 0a20 2020 2020 2020 204e   : int.        N
+00029490: 756d 6265 7220 6f66 2070 6f69 6e74 7320  umber of points 
+000294a0: 636f 6e73 7469 7475 7469 6e67 2074 6865  constituting the
+000294b0: 2031 3830 2064 6567 7265 6520 7475 726e   180 degree turn
+000294c0: 2e0a 2020 2020 6c61 7965 7220 3a20 696e  ..    layer : in
+000294d0: 742c 2061 7272 6179 2d6c 696b 655b 325d  t, array-like[2]
+000294e0: 2c20 6f72 2073 6574 0a20 2020 2020 2020  , or set.       
+000294f0: 2053 7065 6369 6669 6320 6c61 7965 7228   Specific layer(
+00029500: 7329 2074 6f20 7075 7420 706f 6c79 676f  s) to put polygo
+00029510: 6e20 6765 6f6d 6574 7279 206f 6e2e 0a0a  n geometry on...
+00029520: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00029530: 2d2d 2d2d 2d2d 2d0a 2020 2020 4420 3a20  -------.    D : 
+00029540: 4465 7669 6365 0a20 2020 2020 2020 2041  Device.        A
+00029550: 2044 6576 6963 6520 636f 6e74 6169 6e69   Device containi
+00029560: 6e67 2061 6e20 6f70 7469 6d61 6c6c 792d  ng an optimally-
+00029570: 726f 756e 6465 6420 6861 6972 7069 6e20  rounded hairpin 
+00029580: 6765 6f6d 6574 7279 2e0a 0a20 2020 204e  geometry...    N
+00029590: 6f74 6573 0a20 2020 202d 2d2d 2d2d 0a20  otes.    -----. 
+000295a0: 2020 2048 6169 7270 696e 2070 6974 6368     Hairpin pitch
+000295b0: 206d 7573 7420 6265 2067 7265 6174 6572   must be greater
+000295c0: 2074 6861 6e20 7769 6474 682e 0a0a 2020   than width...  
+000295d0: 2020 4f70 7469 6d61 6c20 7374 7275 6374    Optimal struct
+000295e0: 7572 6520 6672 6f6d 2068 7474 7073 3a2f  ure from https:/
+000295f0: 2f64 6f69 2e6f 7267 2f31 302e 3131 3033  /doi.org/10.1103
+00029600: 2f50 6879 7352 6576 422e 3834 2e31 3734  /PhysRevB.84.174
+00029610: 3531 300a 2020 2020 436c 656d 2c20 4a2e  510.    Clem, J.
+00029620: 2c20 2620 4265 7267 6772 656e 2c20 4b2e  , & Berggren, K.
+00029630: 2028 3230 3131 292e 2047 656f 6d65 7472   (2011). Geometr
+00029640: 792d 6465 7065 6e64 656e 7420 6372 6974  y-dependent crit
+00029650: 6963 616c 2063 7572 7265 6e74 7320 696e  ical currents in
+00029660: 0a20 2020 2073 7570 6572 636f 6e64 7563  .    superconduc
+00029670: 7469 6e67 206e 616e 6f63 6972 6375 6974  ting nanocircuit
+00029680: 732e 2050 6879 7369 6361 6c20 5265 7669  s. Physical Revi
+00029690: 6577 2042 2c20 3834 2831 3729 2c20 31e2  ew B, 84(17), 1.
+000296a0: 8093 3237 2e0a 2020 2020 2222 220a 2020  ..27..    """.  
+000296b0: 2020 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d    # ============
+000296c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000296d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000296e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000296f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a20  ==============. 
+00029700: 2020 2023 2020 4372 6561 7465 2074 6865     #  Create the
+00029710: 2062 6173 6963 2067 656f 6d65 7472 790a   basic geometry.
+00029720: 2020 2020 2320 3d3d 3d3d 3d3d 3d3d 3d3d      # ==========
+00029730: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00029740: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00029750: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00029760: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00029770: 0a20 2020 2061 203d 2028 7069 7463 6820  .    a = (pitch 
+00029780: 2b20 7769 6474 6829 202f 2032 0a20 2020  + width) / 2.   
+00029790: 2079 203d 202d 2870 6974 6368 202d 2077   y = -(pitch - w
+000297a0: 6964 7468 2920 2f20 320a 2020 2020 7820  idth) / 2.    x 
+000297b0: 3d20 2d70 6974 6368 0a20 2020 2064 6c20  = -pitch.    dl 
+000297c0: 3d20 7769 6474 6820 2f20 286e 756d 5f70  = width / (num_p
+000297d0: 7473 202a 2032 290a 2020 2020 6e20 3d20  ts * 2).    n = 
+000297e0: 300a 0a20 2020 2023 2047 6574 2070 6f69  0..    # Get poi
+000297f0: 6e74 7320 6f66 2069 6465 616c 2063 7572  nts of ideal cur
+00029800: 7665 2066 726f 6d20 636f 6e66 6f72 6d61  ve from conforma
+00029810: 6c20 6d61 7070 696e 670a 2020 2020 2320  l mapping.    # 
+00029820: 544f 444f 2054 6869 7320 6973 2061 6e20  TODO This is an 
+00029830: 696e 6566 6669 6369 656e 7420 7761 7920  inefficient way 
+00029840: 6f66 2066 696e 6469 6e67 2070 6f69 6e74  of finding point
+00029850: 7320 7468 6174 2079 6f75 206e 6565 640a  s that you need.
+00029860: 2020 2020 7870 7473 203d 205b 785d 0a20      xpts = [x]. 
+00029870: 2020 2079 7074 7320 3d20 5b79 5d0a 2020     ypts = [y].  
+00029880: 2020 7768 696c 6520 2879 203c 2030 2920    while (y < 0) 
+00029890: 2620 286e 203c 2031 6536 293a 0a20 2020  & (n < 1e6):.   
+000298a0: 2020 2020 2073 203d 2078 202b 2031 6a20       s = x + 1j 
+000298b0: 2a20 790a 2020 2020 2020 2020 7720 3d20  * y.        w = 
+000298c0: 7371 7274 2831 202d 206e 702e 6578 7028  sqrt(1 - np.exp(
+000298d0: 7069 202a 2073 202f 2061 2929 0a20 2020  pi * s / a)).   
+000298e0: 2020 2020 2077 7820 3d20 6e70 2e72 6561       wx = np.rea
+000298f0: 6c28 7729 0a20 2020 2020 2020 2077 7920  l(w).        wy 
+00029900: 3d20 6e70 2e69 6d61 6728 7729 0a20 2020  = np.imag(w).   
+00029910: 2020 2020 2077 7820 3d20 7778 202f 2073       wx = wx / s
+00029920: 7172 7428 7778 2a2a 3220 2b20 7779 2a2a  qrt(wx**2 + wy**
+00029930: 3229 0a20 2020 2020 2020 2077 7920 3d20  2).        wy = 
+00029940: 7779 202f 2073 7172 7428 7778 2a2a 3220  wy / sqrt(wx**2 
+00029950: 2b20 7779 2a2a 3229 0a20 2020 2020 2020  + wy**2).       
+00029960: 2078 203d 2078 202b 2077 7820 2a20 646c   x = x + wx * dl
+00029970: 0a20 2020 2020 2020 2079 203d 2079 202b  .        y = y +
+00029980: 2077 7920 2a20 646c 0a20 2020 2020 2020   wy * dl.       
+00029990: 2078 7074 732e 6170 7065 6e64 2878 290a   xpts.append(x).
+000299a0: 2020 2020 2020 2020 7970 7473 2e61 7070          ypts.app
+000299b0: 656e 6428 7929 0a20 2020 2020 2020 206e  end(y).        n
+000299c0: 203d 206e 202b 2031 0a20 2020 2079 7074   = n + 1.    ypt
+000299d0: 735b 2d31 5d20 3d20 3020 2023 2053 6574  s[-1] = 0  # Set
+000299e0: 206c 6173 7420 706f 696e 7420 6265 206f   last point be o
+000299f0: 6e20 7468 6520 783d 3020 6178 6973 2066  n the x=0 axis f
+00029a00: 6f72 2073 616b 6520 6f66 2063 6c65 616e  or sake of clean
+00029a10: 6c69 6e65 7373 0a20 2020 2064 735f 6661  liness.    ds_fa
+00029a20: 6374 6f72 203d 2069 6e74 286c 656e 2878  ctor = int(len(x
+00029a30: 7074 7329 202f 206e 756d 5f70 7473 2920  pts) / num_pts) 
+00029a40: 2023 2044 6f77 6e73 616d 706c 6520 7468   # Downsample th
+00029a50: 6520 746f 7461 6c20 6e75 6d62 6572 206f  e total number o
+00029a60: 6620 706f 696e 7473 0a20 2020 2078 7074  f points.    xpt
+00029a70: 7320 3d20 7870 7473 5b3a 3a2d 6473 5f66  s = xpts[::-ds_f
+00029a80: 6163 746f 725d 0a20 2020 2078 7074 7320  actor].    xpts 
+00029a90: 3d20 7870 7473 5b3a 3a2d 315d 2020 2320  = xpts[::-1]  # 
+00029aa0: 5468 6973 206c 6f6f 6b73 2063 6f6e 6675  This looks confu
+00029ab0: 7369 6e67 2c20 6275 7420 6974 2773 206a  sing, but it's j
+00029ac0: 7573 7420 666c 6970 7069 6e67 2074 6865  ust flipping the
+00029ad0: 2061 7272 6179 7320 6172 6f75 6e64 0a20   arrays around. 
+00029ae0: 2020 2079 7074 7320 3d20 7970 7473 5b3a     ypts = ypts[:
+00029af0: 3a2d 6473 5f66 6163 746f 725d 0a20 2020  :-ds_factor].   
+00029b00: 2079 7074 7320 3d20 7970 7473 5b3a 3a2d   ypts = ypts[::-
+00029b10: 315d 2020 2320 736f 2074 6865 206c 6173  1]  # so the las
+00029b20: 7420 706f 696e 7420 6973 2067 7561 7261  t point is guara
+00029b30: 6e74 6565 6420 746f 2062 6520 696e 636c  nteed to be incl
+00029b40: 7564 6564 2077 6865 6e20 646f 776e 7361  uded when downsa
+00029b50: 6d70 6c65 640a 0a20 2020 2023 2041 6464  mpled..    # Add
+00029b60: 2070 6f69 6e74 7320 666f 7220 7468 6520   points for the 
+00029b70: 7265 7374 206f 6620 6d65 616e 6465 720a  rest of meander.
+00029b80: 2020 2020 7870 7473 2e61 7070 656e 6428      xpts.append(
+00029b90: 7870 7473 5b2d 315d 202b 2074 7572 6e5f  xpts[-1] + turn_
+00029ba0: 7261 7469 6f20 2a20 7769 6474 6829 0a20  ratio * width). 
+00029bb0: 2020 2079 7074 732e 6170 7065 6e64 2830     ypts.append(0
+00029bc0: 290a 2020 2020 7870 7473 2e61 7070 656e  ).    xpts.appen
+00029bd0: 6428 7870 7473 5b2d 315d 290a 2020 2020  d(xpts[-1]).    
+00029be0: 7970 7473 2e61 7070 656e 6428 2d61 290a  ypts.append(-a).
+00029bf0: 2020 2020 7870 7473 2e61 7070 656e 6428      xpts.append(
+00029c00: 7870 7473 5b30 5d29 0a20 2020 2079 7074  xpts[0]).    ypt
+00029c10: 732e 6170 7065 6e64 282d 6129 0a20 2020  s.append(-a).   
+00029c20: 2078 7074 732e 6170 7065 6e64 286d 6178   xpts.append(max
+00029c30: 2878 7074 7329 202d 206c 656e 6774 6829  (xpts) - length)
+00029c40: 0a20 2020 2079 7074 732e 6170 7065 6e64  .    ypts.append
+00029c50: 282d 6129 0a20 2020 2078 7074 732e 6170  (-a).    xpts.ap
+00029c60: 7065 6e64 2878 7074 735b 2d31 5d29 0a20  pend(xpts[-1]). 
+00029c70: 2020 2079 7074 732e 6170 7065 6e64 282d     ypts.append(-
+00029c80: 6120 2b20 7769 6474 6829 0a20 2020 2078  a + width).    x
+00029c90: 7074 732e 6170 7065 6e64 2878 7074 735b  pts.append(xpts[
+00029ca0: 305d 290a 2020 2020 7970 7473 2e61 7070  0]).    ypts.app
+00029cb0: 656e 6428 7970 7473 5b30 5d29 0a0a 2020  end(ypts[0])..  
+00029cc0: 2020 7870 7473 203d 206e 702e 6172 7261    xpts = np.arra
+00029cd0: 7928 7870 7473 290a 2020 2020 7970 7473  y(xpts).    ypts
+00029ce0: 203d 206e 702e 6172 7261 7928 7970 7473   = np.array(ypts
+00029cf0: 290a 0a20 2020 2023 203d 3d3d 3d3d 3d3d  )..    # =======
+00029d00: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00029d10: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00029d20: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00029d30: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00029d40: 3d3d 3d0a 2020 2020 2320 2043 7265 6174  ===.    #  Creat
+00029d50: 6520 6120 626c 616e 6b20 6465 7669 6365  e a blank device
+00029d60: 2c20 6164 6420 7468 6520 6765 6f6d 6574  , add the geomet
+00029d70: 7279 2c20 616e 6420 6465 6669 6e65 2074  ry, and define t
+00029d80: 6865 2070 6f72 7473 0a20 2020 2023 203d  he ports.    # =
+00029d90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00029da0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00029db0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00029dc0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00029dd0: 3d3d 3d3d 3d3d 3d3d 3d0a 2020 2020 4420  =========.    D 
+00029de0: 3d20 4465 7669 6365 286e 616d 653d 2268  = Device(name="h
+00029df0: 6169 7270 696e 2229 0a20 2020 2044 2e61  airpin").    D.a
+00029e00: 6464 5f70 6f6c 7967 6f6e 285b 7870 7473  dd_polygon([xpts
+00029e10: 2c20 7970 7473 5d2c 206c 6179 6572 3d6c  , ypts], layer=l
+00029e20: 6179 6572 290a 2020 2020 442e 6164 645f  ayer).    D.add_
+00029e30: 706f 6c79 676f 6e28 5b78 7074 732c 202d  polygon([xpts, -
+00029e40: 7970 7473 5d2c 206c 6179 6572 3d6c 6179  ypts], layer=lay
+00029e50: 6572 290a 0a20 2020 2078 706f 7274 7320  er)..    xports 
+00029e60: 3d20 6d69 6e28 7870 7473 290a 2020 2020  = min(xpts).    
+00029e70: 7970 6f72 7473 203d 202d 6120 2b20 7769  yports = -a + wi
+00029e80: 6474 6820 2f20 320a 2020 2020 442e 6164  dth / 2.    D.ad
+00029e90: 645f 706f 7274 286e 616d 653d 312c 206d  d_port(name=1, m
+00029ea0: 6964 706f 696e 743d 5b78 706f 7274 732c  idpoint=[xports,
+00029eb0: 202d 7970 6f72 7473 5d2c 2077 6964 7468   -yports], width
+00029ec0: 3d77 6964 7468 2c20 6f72 6965 6e74 6174  =width, orientat
+00029ed0: 696f 6e3d 3138 3029 0a20 2020 2044 2e61  ion=180).    D.a
+00029ee0: 6464 5f70 6f72 7428 6e61 6d65 3d32 2c20  dd_port(name=2, 
+00029ef0: 6d69 6470 6f69 6e74 3d5b 7870 6f72 7473  midpoint=[xports
+00029f00: 2c20 7970 6f72 7473 5d2c 2077 6964 7468  , yports], width
+00029f10: 3d77 6964 7468 2c20 6f72 6965 6e74 6174  =width, orientat
+00029f20: 696f 6e3d 3138 3029 0a0a 2020 2020 7265  ion=180)..    re
+00029f30: 7475 726e 2044 0a0a 0a40 6465 7669 6365  turn D...@device
+00029f40: 5f6c 7275 5f63 6163 6865 0a64 6566 206f  _lru_cache.def o
+00029f50: 7074 696d 616c 5f73 7465 7028 0a20 2020  ptimal_step(.   
+00029f60: 2073 7461 7274 5f77 6964 7468 3d31 302c   start_width=10,
+00029f70: 0a20 2020 2065 6e64 5f77 6964 7468 3d32  .    end_width=2
+00029f80: 322c 0a20 2020 206e 756d 5f70 7473 3d35  2,.    num_pts=5
+00029f90: 302c 0a20 2020 2077 6964 7468 5f74 6f6c  0,.    width_tol
+00029fa0: 3d31 652d 332c 0a20 2020 2061 6e74 6963  =1e-3,.    antic
+00029fb0: 726f 7764 696e 675f 6661 6374 6f72 3d31  rowding_factor=1
+00029fc0: 2e32 2c0a 2020 2020 7379 6d6d 6574 7269  .2,.    symmetri
+00029fd0: 633d 4661 6c73 652c 0a20 2020 206c 6179  c=False,.    lay
+00029fe0: 6572 3d30 2c0a 293a 0a20 2020 2022 2222  er=0,.):.    """
+00029ff0: 4372 6561 7465 7320 616e 206f 7074 696d  Creates an optim
+0002a000: 616c 6c79 2d72 6f75 6e64 6564 2073 7465  ally-rounded ste
+0002a010: 7020 6765 6f6d 6574 7279 2e0a 0a20 2020  p geometry...   
+0002a020: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+0002a030: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2073  ----------.    s
+0002a040: 7461 7274 5f77 6964 7468 203a 2069 6e74  tart_width : int
+0002a050: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
+0002a060: 2020 5769 6474 6820 6f66 2074 6865 2063    Width of the c
+0002a070: 6f6e 6e65 6374 6f72 206f 6e20 7468 6520  onnector on the 
+0002a080: 6c65 6674 2065 6e64 206f 6620 7468 6520  left end of the 
+0002a090: 7374 6570 2e0a 2020 2020 656e 645f 7769  step..    end_wi
+0002a0a0: 6474 6820 3a20 696e 7420 6f72 2066 6c6f  dth : int or flo
+0002a0b0: 6174 0a20 2020 2020 2020 2057 6964 7468  at.        Width
+0002a0c0: 206f 6620 7468 6520 636f 6e6e 6563 746f   of the connecto
+0002a0d0: 7220 6f6e 2074 6865 2072 6967 6874 2065  r on the right e
+0002a0e0: 6e64 206f 6620 7468 6520 7374 6570 2e0a  nd of the step..
+0002a0f0: 2020 2020 6e75 6d5f 7074 7320 3a20 696e      num_pts : in
+0002a100: 740a 2020 2020 2020 2020 5468 6520 6e75  t.        The nu
+0002a110: 6d62 6572 206f 6620 706f 696e 7473 2063  mber of points c
+0002a120: 6f6d 7072 6973 696e 6720 7468 6520 656e  omprising the en
+0002a130: 7469 7265 2073 7465 7020 6765 6f6d 6574  tire step geomet
+0002a140: 7279 2e0a 2020 2020 7769 6474 685f 746f  ry..    width_to
+0002a150: 6c20 3a20 666c 6f61 740a 2020 2020 2020  l : float.      
+0002a160: 2020 506f 696e 7420 6174 2077 6869 6368    Point at which
+0002a170: 2074 6f20 7465 726d 696e 6174 6520 7468   to terminate th
+0002a180: 6520 6361 6c63 756c 6174 696f 6e20 6f66  e calculation of
+0002a190: 2074 6865 206f 7074 696d 616c 2073 7465   the optimal ste
+0002a1a0: 700a 2020 2020 616e 7469 6372 6f77 6469  p.    anticrowdi
+0002a1b0: 6e67 5f66 6163 746f 7220 3a20 696e 7420  ng_factor : int 
+0002a1c0: 6f72 2066 6c6f 6174 0a20 2020 2020 2020  or float.       
+0002a1d0: 2046 6163 746f 7220 746f 2072 6564 7563   Factor to reduc
+0002a1e0: 6520 6375 7272 656e 7420 6372 6f77 6469  e current crowdi
+0002a1f0: 6e67 2062 7920 656c 6f6e 6761 7469 6e67  ng by elongating
+0002a200: 0a20 2020 2020 2020 2074 6865 2073 7472  .        the str
+0002a210: 7563 7475 7265 2061 6e64 2072 6564 7563  ucture and reduc
+0002a220: 696e 6720 7468 6520 6375 7276 6174 7572  ing the curvatur
+0002a230: 650a 2020 2020 7379 6d6d 6574 7269 6320  e.    symmetric 
+0002a240: 3a20 626f 6f6c 0a20 2020 2020 2020 2049  : bool.        I
+0002a250: 6620 5472 7565 2c20 6164 6473 2061 206d  f True, adds a m
+0002a260: 6972 726f 7265 6420 636f 7079 206f 6620  irrored copy of 
+0002a270: 7468 6520 7374 6570 2061 6372 6f73 7320  the step across 
+0002a280: 7468 6520 782d 6178 6973 2074 6f20 7468  the x-axis to th
+0002a290: 650a 2020 2020 2020 2020 6765 6f6d 6574  e.        geomet
+0002a2a0: 7279 2061 6e64 2061 646a 7573 7473 2074  ry and adjusts t
+0002a2b0: 6865 2077 6964 7468 206f 6620 7468 6520  he width of the 
+0002a2c0: 706f 7274 732e 0a20 2020 206c 6179 6572  ports..    layer
+0002a2d0: 203a 2069 6e74 2c20 6172 7261 792d 6c69   : int, array-li
+0002a2e0: 6b65 5b32 5d2c 206f 7220 7365 740a 2020  ke[2], or set.  
+0002a2f0: 2020 2020 2020 5370 6563 6966 6963 206c        Specific l
+0002a300: 6179 6572 2873 2920 746f 2070 7574 2070  ayer(s) to put p
+0002a310: 6f6c 7967 6f6e 2067 656f 6d65 7472 7920  olygon geometry 
+0002a320: 6f6e 2e0a 0a20 2020 2052 6574 7572 6e73  on...    Returns
+0002a330: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
+0002a340: 2044 203a 2044 6576 6963 650a 2020 2020   D : Device.    
+0002a350: 2020 2020 4120 4465 7669 6365 2063 6f6e      A Device con
+0002a360: 7461 696e 696e 6720 616e 206f 7074 696d  taining an optim
+0002a370: 616c 6c79 2d72 6f75 6e64 6564 2073 7465  ally-rounded ste
+0002a380: 702e 0a0a 2020 2020 4e6f 7465 730a 2020  p...    Notes.  
+0002a390: 2020 2d2d 2d2d 2d0a 2020 2020 4f70 7469    -----.    Opti
+0002a3a0: 6d61 6c20 7374 7275 6374 7572 6520 6672  mal structure fr
+0002a3b0: 6f6d 2068 7474 7073 3a2f 2f64 6f69 2e6f  om https://doi.o
+0002a3c0: 7267 2f31 302e 3131 3033 2f50 6879 7352  rg/10.1103/PhysR
+0002a3d0: 6576 422e 3834 2e31 3734 3531 300a 2020  evB.84.174510.  
+0002a3e0: 2020 436c 656d 2c20 4a2e 2c20 2620 4265    Clem, J., & Be
+0002a3f0: 7267 6772 656e 2c20 4b2e 2028 3230 3131  rggren, K. (2011
+0002a400: 292e 2047 656f 6d65 7472 792d 6465 7065  ). Geometry-depe
+0002a410: 6e64 656e 7420 6372 6974 6963 616c 2063  ndent critical c
+0002a420: 7572 7265 6e74 7320 696e 0a20 2020 2073  urrents in.    s
+0002a430: 7570 6572 636f 6e64 7563 7469 6e67 206e  uperconducting n
+0002a440: 616e 6f63 6972 6375 6974 732e 2050 6879  anocircuits. Phy
+0002a450: 7369 6361 6c20 5265 7669 6577 2042 2c20  sical Review B, 
+0002a460: 3834 2831 3729 2c20 31e2 8093 3237 2e0a  84(17), 1...27..
+0002a470: 2020 2020 2222 220a 0a20 2020 2023 203d      """..    # =
+0002a480: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002a490: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002a4a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002a4b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002a4c0: 3d3d 3d3d 3d3d 3d3d 3d0a 2020 2020 2320  =========.    # 
+0002a4d0: 2043 7265 6174 6520 7468 6520 6261 7369   Create the basi
+0002a4e0: 6320 6765 6f6d 6574 7279 0a20 2020 2023  c geometry.    #
+0002a4f0: 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d   ===============
+0002a500: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002a510: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002a520: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002a530: 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 2020 2020  ===========.    
+0002a540: 6465 6620 7374 6570 5f70 6f69 6e74 7328  def step_points(
+0002a550: 6574 612c 2057 2c20 6129 3a0a 2020 2020  eta, W, a):.    
+0002a560: 2020 2020 2320 5265 7475 726e 7320 706f      # Returns po
+0002a570: 696e 7473 2066 726f 6d20 6120 756e 6974  ints from a unit
+0002a580: 2073 656d 6963 6972 636c 6520 696e 2074   semicircle in t
+0002a590: 6865 2077 2028 3d20 7520 2b20 6976 2920  he w (= u + iv) 
+0002a5a0: 706c 616e 6520 746f 0a20 2020 2020 2020  plane to.       
+0002a5b0: 2023 2074 6865 206f 7074 696d 616c 2063   # the optimal c
+0002a5c0: 7572 7665 2069 6e20 7468 6520 7a65 7461  urve in the zeta
+0002a5d0: 2028 3d20 7820 2b20 6979 2920 706c 616e   (= x + iy) plan
+0002a5e0: 6520 7768 6963 6820 7472 616e 7369 7469  e which transiti
+0002a5f0: 6f6e 730a 2020 2020 2020 2020 2320 6120  ons.        # a 
+0002a600: 7769 7265 2066 726f 6d20 6120 7769 6474  wire from a widt
+0002a610: 6820 6f66 2027 5727 2074 6f20 6120 7769  h of 'W' to a wi
+0002a620: 6474 6820 6f66 2027 6127 0a20 2020 2020  dth of 'a'.     
+0002a630: 2020 2023 2065 7461 2074 616b 6573 2076     # eta takes v
+0002a640: 616c 7565 2030 2074 6f20 7069 0a0a 2020  alue 0 to pi..  
+0002a650: 2020 2020 2020 5720 3d20 6e70 2e61 7272        W = np.arr
+0002a660: 6179 2857 2c20 6474 7970 653d 636f 6d70  ay(W, dtype=comp
+0002a670: 6c65 7829 0a20 2020 2020 2020 2061 203d  lex).        a =
+0002a680: 206e 702e 6172 7261 7928 612c 2064 7479   np.array(a, dty
+0002a690: 7065 3d63 6f6d 706c 6578 290a 0a20 2020  pe=complex)..   
+0002a6a0: 2020 2020 2067 616d 6d61 203d 2028 6120       gamma = (a 
+0002a6b0: 2a20 6120 2b20 5720 2a20 5729 202f 2028  * a + W * W) / (
+0002a6c0: 6120 2a20 6120 2d20 5720 2a20 5729 0a0a  a * a - W * W)..
+0002a6d0: 2020 2020 2020 2020 7720 3d20 6e70 2e65          w = np.e
+0002a6e0: 7870 2831 6a20 2a20 6574 6129 0a0a 2020  xp(1j * eta)..  
+0002a6f0: 2020 2020 2020 7a65 7461 203d 2028 0a20        zeta = (. 
+0002a700: 2020 2020 2020 2020 2020 2034 0a20 2020             4.   
+0002a710: 2020 2020 2020 2020 202a 2031 6a0a 2020           * 1j.  
+0002a720: 2020 2020 2020 2020 2020 2f20 7069 0a20            / pi. 
+0002a730: 2020 2020 2020 2020 2020 202a 2028 0a20             * (. 
+0002a740: 2020 2020 2020 2020 2020 2020 2020 2057                 W
+0002a750: 202a 206e 702e 6172 6374 616e 2873 7172   * np.arctan(sqr
+0002a760: 7428 2877 202d 2067 616d 6d61 2920 2f20  t((w - gamma) / 
+0002a770: 2867 616d 6d61 202b 2031 2929 290a 2020  (gamma + 1))).  
+0002a780: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0002a790: 6120 2a20 6e70 2e61 7263 7461 6e28 7371  a * np.arctan(sq
+0002a7a0: 7274 2828 6761 6d6d 6120 2d20 3129 202f  rt((gamma - 1) /
+0002a7b0: 2028 7720 2d20 6761 6d6d 6129 2929 0a20   (w - gamma))). 
+0002a7c0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0002a7d0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0002a7e0: 7820 3d20 6e70 2e72 6561 6c28 7a65 7461  x = np.real(zeta
+0002a7f0: 290a 2020 2020 2020 2020 7920 3d20 6e70  ).        y = np
+0002a800: 2e69 6d61 6728 7a65 7461 290a 2020 2020  .imag(zeta).    
+0002a810: 2020 2020 7265 7475 726e 2078 2c20 790a      return x, y.
+0002a820: 0a20 2020 2064 6566 2069 6e76 6572 745f  .    def invert_
+0002a830: 7374 6570 5f70 6f69 6e74 2878 5f64 6573  step_point(x_des
+0002a840: 6972 6564 3d2d 3130 2c20 795f 6465 7369  ired=-10, y_desi
+0002a850: 7265 643d 4e6f 6e65 2c20 573d 312c 2061  red=None, W=1, a
+0002a860: 3d32 293a 0a20 2020 2020 2020 2023 2046  =2):.        # F
+0002a870: 696e 6473 2074 6865 2065 7461 2061 7373  inds the eta ass
+0002a880: 6f63 6961 7465 6420 7769 7468 2074 6865  ociated with the
+0002a890: 2076 616c 7565 2078 5f64 6573 6972 6564   value x_desired
+0002a8a0: 2061 6c6f 6e67 2074 6865 0a20 2020 2020   along the.     
+0002a8b0: 2020 2023 206f 7074 696d 616c 2063 7572     # optimal cur
+0002a8c0: 7665 0a20 2020 2020 2020 2064 6566 2066  ve.        def f
+0002a8d0: 6828 6574 6129 3a0a 2020 2020 2020 2020  h(eta):.        
+0002a8e0: 2020 2020 6775 6573 7365 645f 782c 2067      guessed_x, g
+0002a8f0: 7565 7373 6564 5f79 203d 2073 7465 705f  uessed_y = step_
+0002a900: 706f 696e 7473 2865 7461 2c20 573d 572c  points(eta, W=W,
+0002a910: 2061 3d61 290a 2020 2020 2020 2020 2020   a=a).          
+0002a920: 2020 6966 2079 5f64 6573 6972 6564 2069    if y_desired i
+0002a930: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0002a940: 2020 2020 2020 2020 7265 7475 726e 2028          return (
+0002a950: 6775 6573 7365 645f 7820 2d20 785f 6465  guessed_x - x_de
+0002a960: 7369 7265 6429 202a 2a20 3220 2023 2054  sired) ** 2  # T
+0002a970: 6865 2065 7272 6f72 0a20 2020 2020 2020  he error.       
+0002a980: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0002a990: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0002a9a0: 6e20 2867 7565 7373 6564 5f79 202d 2079  n (guessed_y - y
+0002a9b0: 5f64 6573 6972 6564 2920 2a2a 2032 0a0a  _desired) ** 2..
+0002a9c0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0002a9d0: 2020 2020 2020 2020 2066 726f 6d20 7363           from sc
+0002a9e0: 6970 792e 6f70 7469 6d69 7a65 2069 6d70  ipy.optimize imp
+0002a9f0: 6f72 7420 666d 696e 626f 756e 640a 2020  ort fminbound.  
+0002aa00: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+0002aa10: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+0002aa20: 2020 2020 7261 6973 6520 496d 706f 7274      raise Import
+0002aa30: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+0002aa40: 2020 2020 2020 2022 205b 5048 4944 4c5d         " [PHIDL]
+0002aa50: 2054 6f20 7275 6e20 7468 6520 6f70 7469   To run the opti
+0002aa60: 6d61 6c2d 6375 7276 6520 6765 6f6d 6574  mal-curve geomet
+0002aa70: 7279 2022 0a20 2020 2020 2020 2020 2020  ry ".           
+0002aa80: 2020 2020 2022 6675 6e63 7469 6f6e 7320       "functions 
+0002aa90: 796f 7520 6e65 6564 2073 6369 7079 2c20  you need scipy, 
+0002aaa0: 706c 6561 7365 2069 6e73 7461 6c6c 2022  please install "
+0002aab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002aac0: 2022 6974 2077 6974 6820 6070 6970 2069   "it with `pip i
+0002aad0: 6e73 7461 6c6c 2073 6369 7079 6022 0a20  nstall scipy`". 
+0002aae0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0002aaf0: 2020 2020 2066 6f75 6e64 5f65 7461 203d       found_eta =
+0002ab00: 2066 6d69 6e62 6f75 6e64 2866 682c 2078   fminbound(fh, x
+0002ab10: 313d 302c 2078 323d 7069 2c20 6172 6773  1=0, x2=pi, args
+0002ab20: 3d28 2929 0a20 2020 2020 2020 2072 6574  =()).        ret
+0002ab30: 7572 6e20 7374 6570 5f70 6f69 6e74 7328  urn step_points(
+0002ab40: 666f 756e 645f 6574 612c 2057 3d57 2c20  found_eta, W=W, 
+0002ab50: 613d 6129 0a0a 2020 2020 6966 2073 7461  a=a)..    if sta
+0002ab60: 7274 5f77 6964 7468 203e 2065 6e64 5f77  rt_width > end_w
+0002ab70: 6964 7468 3a0a 2020 2020 2020 2020 7265  idth:.        re
+0002ab80: 7665 7273 6520 3d20 5472 7565 0a20 2020  verse = True.   
+0002ab90: 2020 2020 2073 7461 7274 5f77 6964 7468       start_width
+0002aba0: 2c20 656e 645f 7769 6474 6820 3d20 656e  , end_width = en
+0002abb0: 645f 7769 6474 682c 2073 7461 7274 5f77  d_width, start_w
+0002abc0: 6964 7468 0a20 2020 2065 6c73 653a 0a20  idth.    else:. 
+0002abd0: 2020 2020 2020 2072 6576 6572 7365 203d         reverse =
+0002abe0: 2046 616c 7365 0a0a 2020 2020 4420 3d20   False..    D = 
+0002abf0: 4465 7669 6365 286e 616d 653d 2273 7465  Device(name="ste
+0002ac00: 7022 290a 2020 2020 6966 2073 7461 7274  p").    if start
+0002ac10: 5f77 6964 7468 203d 3d20 656e 645f 7769  _width == end_wi
+0002ac20: 6474 683a 2020 2320 4a75 7374 2072 6574  dth:  # Just ret
+0002ac30: 7572 6e20 6120 7371 7561 7265 0a20 2020  urn a square.   
+0002ac40: 2020 2020 2069 6620 7379 6d6d 6574 7269       if symmetri
+0002ac50: 633a 0a20 2020 2020 2020 2020 2020 2079  c:.            y
+0002ac60: 7074 7320 3d20 5b0a 2020 2020 2020 2020  pts = [.        
+0002ac70: 2020 2020 2020 2020 2d73 7461 7274 5f77          -start_w
+0002ac80: 6964 7468 202f 2032 2c0a 2020 2020 2020  idth / 2,.      
+0002ac90: 2020 2020 2020 2020 2020 7374 6172 745f            start_
+0002aca0: 7769 6474 6820 2f20 322c 0a20 2020 2020  width / 2,.     
+0002acb0: 2020 2020 2020 2020 2020 2073 7461 7274             start
+0002acc0: 5f77 6964 7468 202f 2032 2c0a 2020 2020  _width / 2,.    
+0002acd0: 2020 2020 2020 2020 2020 2020 2d73 7461              -sta
+0002ace0: 7274 5f77 6964 7468 202f 2032 2c0a 2020  rt_width / 2,.  
+0002acf0: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
+0002ad00: 2020 2020 2020 2020 7870 7473 203d 205b          xpts = [
+0002ad10: 302c 2030 2c20 7374 6172 745f 7769 6474  0, 0, start_widt
+0002ad20: 682c 2073 7461 7274 5f77 6964 7468 5d0a  h, start_width].
+0002ad30: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+0002ad40: 796d 6d65 7472 6963 3a0a 2020 2020 2020  ymmetric:.      
+0002ad50: 2020 2020 2020 7970 7473 203d 205b 302c        ypts = [0,
+0002ad60: 2073 7461 7274 5f77 6964 7468 2c20 7374   start_width, st
+0002ad70: 6172 745f 7769 6474 682c 2030 5d0a 2020  art_width, 0].  
+0002ad80: 2020 2020 2020 2020 2020 7870 7473 203d            xpts =
+0002ad90: 205b 302c 2030 2c20 7374 6172 745f 7769   [0, 0, start_wi
+0002ada0: 6474 682c 2073 7461 7274 5f77 6964 7468  dth, start_width
+0002adb0: 5d0a 2020 2020 2020 2020 442e 696e 666f  ].        D.info
+0002adc0: 5b22 6e75 6d5f 7371 7561 7265 7322 5d20  ["num_squares"] 
+0002add0: 3d20 310a 2020 2020 656c 7365 3a0a 2020  = 1.    else:.  
+0002ade0: 2020 2020 2020 786d 696e 2c20 796d 696e        xmin, ymin
+0002adf0: 203d 2069 6e76 6572 745f 7374 6570 5f70   = invert_step_p
+0002ae00: 6f69 6e74 280a 2020 2020 2020 2020 2020  oint(.          
+0002ae10: 2020 795f 6465 7369 7265 643d 7374 6172    y_desired=star
+0002ae20: 745f 7769 6474 6820 2a20 2831 202b 2077  t_width * (1 + w
+0002ae30: 6964 7468 5f74 6f6c 292c 2057 3d73 7461  idth_tol), W=sta
+0002ae40: 7274 5f77 6964 7468 2c20 613d 656e 645f  rt_width, a=end_
+0002ae50: 7769 6474 680a 2020 2020 2020 2020 290a  width.        ).
+0002ae60: 2020 2020 2020 2020 786d 6178 2c20 796d          xmax, ym
+0002ae70: 6178 203d 2069 6e76 6572 745f 7374 6570  ax = invert_step
+0002ae80: 5f70 6f69 6e74 280a 2020 2020 2020 2020  _point(.        
+0002ae90: 2020 2020 795f 6465 7369 7265 643d 656e      y_desired=en
+0002aea0: 645f 7769 6474 6820 2a20 2831 202d 2077  d_width * (1 - w
+0002aeb0: 6964 7468 5f74 6f6c 292c 2057 3d73 7461  idth_tol), W=sta
+0002aec0: 7274 5f77 6964 7468 2c20 613d 656e 645f  rt_width, a=end_
+0002aed0: 7769 6474 680a 2020 2020 2020 2020 290a  width.        ).
+0002aee0: 0a20 2020 2020 2020 2078 7074 7320 3d20  .        xpts = 
+0002aef0: 6e70 2e6c 696e 7370 6163 6528 786d 696e  np.linspace(xmin
+0002af00: 2c20 786d 6178 2c20 6e75 6d5f 7074 7329  , xmax, num_pts)
+0002af10: 2e74 6f6c 6973 7428 290a 2020 2020 2020  .tolist().      
+0002af20: 2020 7970 7473 203d 205b 5d0a 2020 2020    ypts = [].    
+0002af30: 2020 2020 666f 7220 7820 696e 2078 7074      for x in xpt
+0002af40: 733a 0a20 2020 2020 2020 2020 2020 2078  s:.            x
+0002af50: 2c20 7920 3d20 696e 7665 7274 5f73 7465  , y = invert_ste
+0002af60: 705f 706f 696e 7428 785f 6465 7369 7265  p_point(x_desire
+0002af70: 643d 782c 2057 3d73 7461 7274 5f77 6964  d=x, W=start_wid
+0002af80: 7468 2c20 613d 656e 645f 7769 6474 6829  th, a=end_width)
+0002af90: 0a20 2020 2020 2020 2020 2020 2079 7074  .            ypt
+0002afa0: 732e 6170 7065 6e64 2879 290a 0a20 2020  s.append(y)..   
+0002afb0: 2020 2020 2079 7074 735b 2d31 5d20 3d20       ypts[-1] = 
+0002afc0: 656e 645f 7769 6474 680a 2020 2020 2020  end_width.      
+0002afd0: 2020 7970 7473 5b30 5d20 3d20 7374 6172    ypts[0] = star
+0002afe0: 745f 7769 6474 680a 2020 2020 2020 2020  t_width.        
+0002aff0: 795f 6e75 6d5f 7371 203d 206e 702e 6172  y_num_sq = np.ar
+0002b000: 7261 7928 7970 7473 290a 2020 2020 2020  ray(ypts).      
+0002b010: 2020 785f 6e75 6d5f 7371 203d 206e 702e    x_num_sq = np.
+0002b020: 6172 7261 7928 7870 7473 290a 0a20 2020  array(xpts)..   
+0002b030: 2020 2020 2069 6620 6e6f 7420 7379 6d6d       if not symm
+0002b040: 6574 7269 633a 0a20 2020 2020 2020 2020  etric:.         
+0002b050: 2020 2078 7074 732e 6170 7065 6e64 2878     xpts.append(x
+0002b060: 7074 735b 2d31 5d29 0a20 2020 2020 2020  pts[-1]).       
+0002b070: 2020 2020 2079 7074 732e 6170 7065 6e64       ypts.append
+0002b080: 2830 290a 2020 2020 2020 2020 2020 2020  (0).            
+0002b090: 7870 7473 2e61 7070 656e 6428 7870 7473  xpts.append(xpts
+0002b0a0: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+0002b0b0: 2079 7074 732e 6170 7065 6e64 2830 290a   ypts.append(0).
+0002b0c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002b0d0: 2020 2020 2020 2020 2020 7870 7473 202b            xpts +
+0002b0e0: 3d20 5b78 2066 6f72 2078 2069 6e20 7870  = [x for x in xp
+0002b0f0: 7473 5b3a 3a2d 315d 5d0a 2020 2020 2020  ts[::-1]].      
+0002b100: 2020 2020 2020 7970 7473 202b 3d20 5b2d        ypts += [-
+0002b110: 7920 666f 7220 7920 696e 2079 7074 735b  y for y in ypts[
+0002b120: 3a3a 2d31 5d5d 0a20 2020 2020 2020 2020  ::-1]].         
+0002b130: 2020 2078 7074 7320 3d20 5b78 202f 2032     xpts = [x / 2
+0002b140: 2066 6f72 2078 2069 6e20 7870 7473 5d0a   for x in xpts].
+0002b150: 2020 2020 2020 2020 2020 2020 7970 7473              ypts
+0002b160: 203d 205b 7920 2f20 3220 666f 7220 7920   = [y / 2 for y 
+0002b170: 696e 2079 7074 735d 0a0a 2020 2020 2020  in ypts]..      
+0002b180: 2020 2320 616e 7469 6372 6f77 6469 6e67    # anticrowding
+0002b190: 5f66 6163 746f 7220 7374 7265 7463 6865  _factor stretche
+0002b1a0: 7320 7468 6520 7769 7265 206f 7574 3b20  s the wire out; 
+0002b1b0: 6120 7374 7265 7463 6865 6420 7769 7265  a stretched wire
+0002b1c0: 2069 7320 610a 2020 2020 2020 2020 2320   is a.        # 
+0002b1d0: 6765 6e74 6c65 7220 7472 616e 7369 7469  gentler transiti
+0002b1e0: 6f6e 2c20 736f 2074 6865 7265 2773 206c  on, so there's l
+0002b1f0: 6573 7320 6368 616e 6365 206f 6620 6375  ess chance of cu
+0002b200: 7272 656e 7420 6372 6f77 6469 6e67 2069  rrent crowding i
+0002b210: 660a 2020 2020 2020 2020 2320 7468 6520  f.        # the 
+0002b220: 6661 6272 6963 6174 696f 6e20 6973 6e27  fabrication isn'
+0002b230: 7420 7065 7266 6563 7420 6275 7420 6173  t perfect but as
+0002b240: 2061 2072 6573 756c 742c 2074 6865 2077   a result, the w
+0002b250: 6972 6520 6973 6e27 7420 6173 0a20 2020  ire isn't as.   
+0002b260: 2020 2020 2023 2073 686f 7274 2061 7320       # short as 
+0002b270: 6974 2063 6f75 6c64 2062 650a 2020 2020  it could be.    
+0002b280: 2020 2020 7870 7473 203d 2028 6e70 2e61      xpts = (np.a
+0002b290: 7272 6179 2878 7074 7329 202a 2061 6e74  rray(xpts) * ant
+0002b2a0: 6963 726f 7764 696e 675f 6661 6374 6f72  icrowding_factor
+0002b2b0: 292e 746f 6c69 7374 2829 0a0a 2020 2020  ).tolist()..    
+0002b2c0: 2020 2020 6966 2072 6576 6572 7365 2069      if reverse i
+0002b2d0: 7320 5472 7565 3a0a 2020 2020 2020 2020  s True:.        
+0002b2e0: 2020 2020 7870 7473 203d 2028 2d6e 702e      xpts = (-np.
+0002b2f0: 6172 7261 7928 7870 7473 2929 2e74 6f6c  array(xpts)).tol
+0002b300: 6973 7428 290a 2020 2020 2020 2020 2020  ist().          
+0002b310: 2020 7374 6172 745f 7769 6474 682c 2065    start_width, e
+0002b320: 6e64 5f77 6964 7468 203d 2065 6e64 5f77  nd_width = end_w
+0002b330: 6964 7468 2c20 7374 6172 745f 7769 6474  idth, start_widt
+0002b340: 680a 0a20 2020 2020 2020 2044 2e69 6e66  h..        D.inf
+0002b350: 6f5b 226e 756d 5f73 7175 6172 6573 225d  o["num_squares"]
+0002b360: 203d 206e 702e 7375 6d28 0a20 2020 2020   = np.sum(.     
+0002b370: 2020 2020 2020 206e 702e 6469 6666 2878         np.diff(x
+0002b380: 5f6e 756d 5f73 7129 202f 2028 2879 5f6e  _num_sq) / ((y_n
+0002b390: 756d 5f73 715b 3a2d 315d 202b 2079 5f6e  um_sq[:-1] + y_n
+0002b3a0: 756d 5f73 715b 313a 5d29 202f 2032 290a  um_sq[1:]) / 2).
+0002b3b0: 2020 2020 2020 2020 290a 0a20 2020 2023          )..    #
+0002b3c0: 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d   ===============
+0002b3d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002b3e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002b3f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002b400: 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 2020 2020  ===========.    
+0002b410: 2320 2043 7265 6174 6520 6120 626c 616e  #  Create a blan
+0002b420: 6b20 6465 7669 6365 2c20 6164 6420 7468  k device, add th
+0002b430: 6520 6765 6f6d 6574 7279 2c20 616e 6420  e geometry, and 
+0002b440: 6465 6669 6e65 2074 6865 2070 6f72 7473  define the ports
+0002b450: 0a20 2020 2023 203d 3d3d 3d3d 3d3d 3d3d  .    # =========
+0002b460: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002b470: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002b480: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002b490: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002b4a0: 3d0a 2020 2020 442e 6164 645f 706f 6c79  =.    D.add_poly
+0002b4b0: 676f 6e28 5b78 7074 732c 2079 7074 735d  gon([xpts, ypts]
+0002b4c0: 2c20 6c61 7965 723d 6c61 7965 7229 0a0a  , layer=layer)..
+0002b4d0: 2020 2020 6966 206e 6f74 2073 796d 6d65      if not symme
+0002b4e0: 7472 6963 3a0a 2020 2020 2020 2020 442e  tric:.        D.
+0002b4f0: 6164 645f 706f 7274 280a 2020 2020 2020  add_port(.      
+0002b500: 2020 2020 2020 6e61 6d65 3d31 2c0a 2020        name=1,.  
+0002b510: 2020 2020 2020 2020 2020 6d69 6470 6f69            midpoi
+0002b520: 6e74 3d5b 6d69 6e28 7870 7473 292c 2073  nt=[min(xpts), s
+0002b530: 7461 7274 5f77 6964 7468 202f 2032 5d2c  tart_width / 2],
+0002b540: 0a20 2020 2020 2020 2020 2020 2077 6964  .            wid
+0002b550: 7468 3d73 7461 7274 5f77 6964 7468 2c0a  th=start_width,.
+0002b560: 2020 2020 2020 2020 2020 2020 6f72 6965              orie
+0002b570: 6e74 6174 696f 6e3d 3138 302c 0a20 2020  ntation=180,.   
+0002b580: 2020 2020 2029 0a20 2020 2020 2020 2044       ).        D
+0002b590: 2e61 6464 5f70 6f72 7428 0a20 2020 2020  .add_port(.     
+0002b5a0: 2020 2020 2020 206e 616d 653d 322c 206d         name=2, m
+0002b5b0: 6964 706f 696e 743d 5b6d 6178 2878 7074  idpoint=[max(xpt
+0002b5c0: 7329 2c20 656e 645f 7769 6474 6820 2f20  s), end_width / 
+0002b5d0: 325d 2c20 7769 6474 683d 656e 645f 7769  2], width=end_wi
+0002b5e0: 6474 682c 206f 7269 656e 7461 7469 6f6e  dth, orientation
+0002b5f0: 3d30 0a20 2020 2020 2020 2029 0a20 2020  =0.        ).   
+0002b600: 2069 6620 7379 6d6d 6574 7269 633a 0a20   if symmetric:. 
+0002b610: 2020 2020 2020 2044 2e61 6464 5f70 6f72         D.add_por
+0002b620: 7428 6e61 6d65 3d31 2c20 6d69 6470 6f69  t(name=1, midpoi
+0002b630: 6e74 3d5b 6d69 6e28 7870 7473 292c 2030  nt=[min(xpts), 0
+0002b640: 5d2c 2077 6964 7468 3d73 7461 7274 5f77  ], width=start_w
+0002b650: 6964 7468 2c20 6f72 6965 6e74 6174 696f  idth, orientatio
+0002b660: 6e3d 3138 3029 0a20 2020 2020 2020 2044  n=180).        D
+0002b670: 2e61 6464 5f70 6f72 7428 6e61 6d65 3d32  .add_port(name=2
+0002b680: 2c20 6d69 6470 6f69 6e74 3d5b 6d61 7828  , midpoint=[max(
+0002b690: 7870 7473 292c 2030 5d2c 2077 6964 7468  xpts), 0], width
+0002b6a0: 3d65 6e64 5f77 6964 7468 2c20 6f72 6965  =end_width, orie
+0002b6b0: 6e74 6174 696f 6e3d 3029 0a0a 2020 2020  ntation=0)..    
+0002b6c0: 7265 7475 726e 2044 0a0a 0a64 6566 206f  return D...def o
+0002b6d0: 7074 696d 616c 5f39 3064 6567 2877 6964  ptimal_90deg(wid
+0002b6e0: 7468 3d31 3030 2e30 2c20 6e75 6d5f 7074  th=100.0, num_pt
+0002b6f0: 733d 3135 2c20 6c65 6e67 7468 5f61 646a  s=15, length_adj
+0002b700: 7573 743d 312c 206c 6179 6572 3d30 293a  ust=1, layer=0):
+0002b710: 0a20 2020 2022 2222 4372 6561 7465 7320  .    """Creates 
+0002b720: 616e 206f 7074 696d 616c 6c79 2d72 6f75  an optimally-rou
+0002b730: 6e64 6564 2039 3020 6465 6772 6565 2062  nded 90 degree b
+0002b740: 656e 6420 7468 6174 2069 7320 7368 6172  end that is shar
+0002b750: 7020 6f6e 2074 6865 206f 7574 6572 0a20  p on the outer. 
+0002b760: 2020 2063 6f72 6e65 722e 0a0a 2020 2020     corner...    
+0002b770: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+0002b780: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 7769  ---------.    wi
+0002b790: 6474 6820 3a20 696e 7420 6f72 2066 6c6f  dth : int or flo
+0002b7a0: 6174 0a20 2020 2020 2020 2057 6964 7468  at.        Width
+0002b7b0: 206f 6620 7468 6520 706f 7274 7320 6f6e   of the ports on
+0002b7c0: 2065 6974 6865 7220 7369 6465 206f 6620   either side of 
+0002b7d0: 7468 6520 6265 6e64 2e0a 2020 2020 6e75  the bend..    nu
+0002b7e0: 6d5f 7074 7320 3a20 696e 740a 2020 2020  m_pts : int.    
+0002b7f0: 2020 2020 5468 6520 6e75 6d62 6572 206f      The number o
+0002b800: 6620 706f 696e 7473 2063 6f6d 7072 6973  f points compris
+0002b810: 696e 6720 7468 6520 6375 7276 6564 2073  ing the curved s
+0002b820: 6563 7469 6f6e 206f 6620 7468 6520 6265  ection of the be
+0002b830: 6e64 2e0a 2020 2020 6c65 6e67 7468 5f61  nd..    length_a
+0002b840: 646a 7573 7420 3a20 696e 7420 6f72 2066  djust : int or f
+0002b850: 6c6f 6174 0a20 2020 2020 2020 2041 646a  loat.        Adj
+0002b860: 7573 7473 2074 6865 206c 656e 6774 6820  usts the length 
+0002b870: 6f66 2074 6865 206e 6f6e 2d63 7572 7665  of the non-curve
+0002b880: 6420 706f 7274 696f 6e20 6f66 2074 6865  d portion of the
+0002b890: 2062 656e 642e 0a20 2020 206c 6179 6572   bend..    layer
+0002b8a0: 203a 2069 6e74 2c20 6172 7261 792d 6c69   : int, array-li
+0002b8b0: 6b65 5b32 5d2c 206f 7220 7365 740a 2020  ke[2], or set.  
+0002b8c0: 2020 2020 2020 5370 6563 6966 6963 206c        Specific l
+0002b8d0: 6179 6572 2873 2920 746f 2070 7574 2070  ayer(s) to put p
+0002b8e0: 6f6c 7967 6f6e 2067 656f 6d65 7472 7920  olygon geometry 
+0002b8f0: 6f6e 2e0a 0a20 2020 2052 6574 7572 6e73  on...    Returns
+0002b900: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
+0002b910: 2044 203a 2044 6576 6963 650a 2020 2020   D : Device.    
+0002b920: 2020 2020 4120 4465 7669 6365 2063 6f6e      A Device con
+0002b930: 7461 696e 696e 6720 616e 206f 7074 696d  taining an optim
+0002b940: 616c 6c79 2d72 6f75 6e64 6564 2039 3020  ally-rounded 90 
+0002b950: 6465 6772 6565 2062 656e 642e 0a0a 2020  degree bend...  
+0002b960: 2020 4e6f 7465 730a 2020 2020 2d2d 2d2d    Notes.    ----
+0002b970: 2d0a 2020 2020 4f70 7469 6d61 6c20 7374  -.    Optimal st
+0002b980: 7275 6374 7572 6520 6672 6f6d 2068 7474  ructure from htt
+0002b990: 7073 3a2f 2f64 6f69 2e6f 7267 2f31 302e  ps://doi.org/10.
+0002b9a0: 3131 3033 2f50 6879 7352 6576 422e 3834  1103/PhysRevB.84
+0002b9b0: 2e31 3734 3531 300a 2020 2020 436c 656d  .174510.    Clem
+0002b9c0: 2c20 4a2e 2c20 2620 4265 7267 6772 656e  , J., & Berggren
+0002b9d0: 2c20 4b2e 2028 3230 3131 292e 2047 656f  , K. (2011). Geo
+0002b9e0: 6d65 7472 792d 6465 7065 6e64 656e 7420  metry-dependent 
+0002b9f0: 6372 6974 6963 616c 2063 7572 7265 6e74  critical current
+0002ba00: 7320 696e 0a20 2020 2073 7570 6572 636f  s in.    superco
+0002ba10: 6e64 7563 7469 6e67 206e 616e 6f63 6972  nducting nanocir
+0002ba20: 6375 6974 732e 2050 6879 7369 6361 6c20  cuits. Physical 
+0002ba30: 5265 7669 6577 2042 2c20 3834 2831 3729  Review B, 84(17)
+0002ba40: 2c20 31e2 8093 3237 2e0a 2020 2020 2222  , 1...27..    ""
+0002ba50: 220a 2020 2020 4420 3d20 4465 7669 6365  ".    D = Device
+0002ba60: 2822 3930 6465 6722 290a 0a20 2020 2023  ("90deg")..    #
+0002ba70: 2047 6574 2070 6f69 6e74 7320 6f66 2069   Get points of i
+0002ba80: 6465 616c 2063 7572 7665 0a20 2020 2061  deal curve.    a
+0002ba90: 203d 2032 202a 2077 6964 7468 0a20 2020   = 2 * width.   
+0002baa0: 2076 203d 206e 702e 6c6f 6773 7061 6365   v = np.logspace
+0002bab0: 282d 6c65 6e67 7468 5f61 646a 7573 742c  (-length_adjust,
+0002bac0: 206c 656e 6774 685f 6164 6a75 7374 2c20   length_adjust, 
+0002bad0: 6e75 6d5f 7074 7329 0a20 2020 2078 6920  num_pts).    xi 
+0002bae0: 3d20 280a 2020 2020 2020 2020 6120 2f20  = (.        a / 
+0002baf0: 322e 3020 2a20 2828 3120 2b20 3220 2f20  2.0 * ((1 + 2 / 
+0002bb00: 7069 202a 206e 702e 6172 6373 696e 6828  pi * np.arcsinh(
+0002bb10: 3120 2f20 7629 2920 2b20 316a 202a 2028  1 / v)) + 1j * (
+0002bb20: 3120 2b20 3220 2f20 7069 202a 206e 702e  1 + 2 / pi * np.
+0002bb30: 6172 6373 696e 6828 7629 2929 0a20 2020  arcsinh(v))).   
+0002bb40: 2029 0a20 2020 2078 7074 7320 3d20 6c69   ).    xpts = li
+0002bb50: 7374 286e 702e 7265 616c 2878 6929 290a  st(np.real(xi)).
+0002bb60: 2020 2020 7970 7473 203d 206c 6973 7428      ypts = list(
+0002bb70: 6e70 2e69 6d61 6728 7869 2929 0a0a 2020  np.imag(xi))..  
+0002bb80: 2020 2320 4164 6420 706f 696e 7473 2066    # Add points f
+0002bb90: 6f72 2074 6865 2072 6573 7420 6f66 2063  or the rest of c
+0002bba0: 7572 7665 0a20 2020 2064 203d 2032 202a  urve.    d = 2 *
+0002bbb0: 2078 7074 735b 305d 2020 2320 4661 7274   xpts[0]  # Fart
+0002bbc0: 6865 7374 2070 6f69 6e74 206f 7574 202a  hest point out *
+0002bbd0: 2032 2c20 726f 756e 6465 6420 746f 206e   2, rounded to n
+0002bbe0: 6561 7265 7374 2031 3030 0a20 2020 2078  earest 100.    x
+0002bbf0: 7074 732e 6170 7065 6e64 2877 6964 7468  pts.append(width
+0002bc00: 290a 2020 2020 7970 7473 2e61 7070 656e  ).    ypts.appen
+0002bc10: 6428 6429 0a20 2020 2078 7074 732e 6170  d(d).    xpts.ap
+0002bc20: 7065 6e64 2830 290a 2020 2020 7970 7473  pend(0).    ypts
+0002bc30: 2e61 7070 656e 6428 6429 0a20 2020 2078  .append(d).    x
+0002bc40: 7074 732e 6170 7065 6e64 2830 290a 2020  pts.append(0).  
+0002bc50: 2020 7970 7473 2e61 7070 656e 6428 3029    ypts.append(0)
+0002bc60: 0a20 2020 2078 7074 732e 6170 7065 6e64  .    xpts.append
+0002bc70: 2864 290a 2020 2020 7970 7473 2e61 7070  (d).    ypts.app
+0002bc80: 656e 6428 3029 0a20 2020 2078 7074 732e  end(0).    xpts.
+0002bc90: 6170 7065 6e64 2864 290a 2020 2020 7970  append(d).    yp
+0002bca0: 7473 2e61 7070 656e 6428 7769 6474 6829  ts.append(width)
+0002bcb0: 0a20 2020 2078 7074 732e 6170 7065 6e64  .    xpts.append
+0002bcc0: 2878 7074 735b 305d 290a 2020 2020 7970  (xpts[0]).    yp
+0002bcd0: 7473 2e61 7070 656e 6428 7970 7473 5b30  ts.append(ypts[0
+0002bce0: 5d29 0a0a 2020 2020 442e 6164 645f 706f  ])..    D.add_po
+0002bcf0: 6c79 676f 6e28 5b78 7074 732c 2079 7074  lygon([xpts, ypt
+0002bd00: 735d 2c20 6c61 7965 723d 6c61 7965 7229  s], layer=layer)
+0002bd10: 0a0a 2020 2020 442e 6164 645f 706f 7274  ..    D.add_port
+0002bd20: 286e 616d 653d 312c 206d 6964 706f 696e  (name=1, midpoin
+0002bd30: 743d 5b61 202f 2034 2c20 645d 2c20 7769  t=[a / 4, d], wi
+0002bd40: 6474 683d 6120 2f20 322c 206f 7269 656e  dth=a / 2, orien
+0002bd50: 7461 7469 6f6e 3d39 3029 0a20 2020 2044  tation=90).    D
+0002bd60: 2e61 6464 5f70 6f72 7428 6e61 6d65 3d32  .add_port(name=2
+0002bd70: 2c20 6d69 6470 6f69 6e74 3d5b 642c 2061  , midpoint=[d, a
+0002bd80: 202f 2034 5d2c 2077 6964 7468 3d61 202f   / 4], width=a /
+0002bd90: 2032 2c20 6f72 6965 6e74 6174 696f 6e3d   2, orientation=
+0002bda0: 3029 0a20 2020 2072 6574 7572 6e20 440a  0).    return D.
+0002bdb0: 0a0a 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ..# ============
+0002bdc0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002bdd0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002bde0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002bdf0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002be00: 3d3d 0a23 2045 7861 6d70 6c65 2063 6f64  ==.# Example cod
+0002be10: 650a 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  e.# ============
+0002be20: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002be30: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002be40: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002be50: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002be60: 3d3d 0a0a 2320 6861 6972 7069 6e20 3d20  ==..# hairpin = 
+0002be70: 6f70 7469 6d61 6c5f 6861 6972 7069 6e28  optimal_hairpin(
+0002be80: 7769 6474 6820 3d20 312c 2070 6974 6368  width = 1, pitch
+0002be90: 203d 2033 2c20 6c65 6e67 7468 203d 2033   = 3, length = 3
+0002bea0: 302c 206e 756d 5f70 7473 203d 2032 3029  0, num_pts = 20)
+0002beb0: 0a23 2071 7569 636b 706c 6f74 2868 6169  .# quickplot(hai
+0002bec0: 7270 696e 290a 0a0a 2320 7374 6570 203d  rpin)...# step =
+0002bed0: 206f 7074 696d 616c 5f73 7465 7028 7374   optimal_step(st
+0002bee0: 6172 745f 7769 6474 6820 3d20 352c 2065  art_width = 5, e
+0002bef0: 6e64 5f77 6964 7468 203d 2031 2c20 6e75  nd_width = 1, nu
+0002bf00: 6d5f 7074 7320 3d20 3830 2c20 7769 6474  m_pts = 80, widt
+0002bf10: 685f 746f 6c20 3d20 3165 2d33 290a 2320  h_tol = 1e-3).# 
+0002bf20: 7175 6963 6b70 6c6f 7428 7374 6570 290a  quickplot(step).
+0002bf30: 0a0a 2320 7475 726e 203d 206f 7074 696d  ..# turn = optim
+0002bf40: 616c 5f39 3064 6567 2877 6964 7468 203d  al_90deg(width =
+0002bf50: 2039 302c 206c 656e 6774 685f 6164 6a75   90, length_adju
+0002bf60: 7374 203d 2031 290a 2320 7175 6963 6b70  st = 1).# quickp
+0002bf70: 6c6f 7428 7475 726e 290a 0a0a 2320 3d3d  lot(turn)...# ==
+0002bf80: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002bf90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002bfa0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002bfb0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002bfc0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a23 0a23  ============.#.#
+0002bfd0: 2053 7570 6572 636f 6e64 7563 7469 6e67   Superconducting
+0002bfe0: 2064 6576 6963 6573 0a23 0a23 203d 3d3d   devices.#.# ===
+0002bff0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002c000: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002c010: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002c020: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002c030: 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 0a0a 4064  ===========...@d
+0002c040: 6576 6963 655f 6c72 755f 6361 6368 650a  evice_lru_cache.
+0002c050: 6465 6620 736e 7370 6428 0a20 2020 2077  def snspd(.    w
+0002c060: 6972 655f 7769 6474 683d 302e 322c 0a20  ire_width=0.2,. 
+0002c070: 2020 2077 6972 655f 7069 7463 683d 302e     wire_pitch=0.
+0002c080: 362c 0a20 2020 2073 697a 653d 2831 302c  6,.    size=(10,
+0002c090: 2038 292c 0a20 2020 206e 756d 5f73 7175   8),.    num_squ
+0002c0a0: 6172 6573 3d4e 6f6e 652c 0a20 2020 2074  ares=None,.    t
+0002c0b0: 7572 6e5f 7261 7469 6f3d 342c 0a20 2020  urn_ratio=4,.   
+0002c0c0: 2074 6572 6d69 6e61 6c73 5f73 616d 655f   terminals_same_
+0002c0d0: 7369 6465 3d46 616c 7365 2c0a 2020 2020  side=False,.    
+0002c0e0: 6c61 7965 723d 302c 0a29 3a0a 2020 2020  layer=0,.):.    
+0002c0f0: 2222 2243 7265 6174 6573 2061 6e20 6f70  """Creates an op
+0002c100: 7469 6d61 6c6c 792d 726f 756e 6465 6420  timally-rounded 
+0002c110: 534e 5350 442e 0a0a 2020 2020 5061 7261  SNSPD...    Para
+0002c120: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
+0002c130: 2d2d 2d2d 2d0a 2020 2020 7769 6474 6820  -----.    width 
+0002c140: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
+0002c150: 2020 2020 2020 2057 6964 7468 206f 6620         Width of 
+0002c160: 7468 6520 7769 7265 2e0a 2020 2020 7069  the wire..    pi
+0002c170: 7463 6820 3a20 696e 7420 6f72 2066 6c6f  tch : int or flo
+0002c180: 6174 0a20 2020 2020 2020 2044 6973 7461  at.        Dista
+0002c190: 6e63 6520 6265 7477 6565 6e20 7477 6f20  nce between two 
+0002c1a0: 6164 6a61 6365 6e74 2077 6972 6573 2e20  adjacent wires. 
+0002c1b0: 4d75 7374 2062 6520 6772 6561 7465 7220  Must be greater 
+0002c1c0: 7468 616e 2060 7769 6474 6860 2e0a 2020  than `width`..  
+0002c1d0: 2020 7369 7a65 203a 204e 6f6e 6520 6f72    size : None or
+0002c1e0: 2061 7272 6179 2d6c 696b 655b 325d 206f   array-like[2] o
+0002c1f0: 6620 696e 7420 6f72 2066 6c6f 6174 0a20  f int or float. 
+0002c200: 2020 2020 2020 2028 7769 6474 682c 2068         (width, h
+0002c210: 6569 6768 7429 206f 6620 7468 6520 7265  eight) of the re
+0002c220: 6374 616e 676c 6520 666f 726d 6564 2062  ctangle formed b
+0002c230: 7920 7468 6520 6f75 7465 7220 626f 756e  y the outer boun
+0002c240: 6461 7279 206f 6620 7468 650a 2020 2020  dary of the.    
+0002c250: 2020 2020 534e 5350 442e 204d 7573 7420      SNSPD. Must 
+0002c260: 6265 206e 6f6e 6520 6966 2060 6e75 6d5f  be none if `num_
+0002c270: 7371 7561 7265 7360 2069 7320 7370 6563  squares` is spec
+0002c280: 6966 6965 642e 0a20 2020 206e 756d 5f73  ified..    num_s
+0002c290: 7175 6172 6573 203a 2069 6e74 206f 7220  quares : int or 
+0002c2a0: 4e6f 6e65 0a20 2020 2020 2020 2054 6f74  None.        Tot
+0002c2b0: 616c 206e 756d 6265 7220 6f66 2073 7175  al number of squ
+0002c2c0: 6172 6573 2069 6e73 6964 6520 7468 6520  ares inside the 
+0002c2d0: 534e 5350 4420 6c65 6e67 7468 2e20 4d75  SNSPD length. Mu
+0002c2e0: 7374 2062 6520 6e6f 6e65 2069 660a 2020  st be none if.  
+0002c2f0: 2020 2020 2020 6073 697a 6560 2069 7320        `size` is 
+0002c300: 7370 6563 6966 6965 642e 0a20 2020 2074  specified..    t
+0002c310: 7572 6e5f 7261 7469 6f20 3a20 696e 7420  urn_ratio : int 
+0002c320: 6f72 2066 6c6f 6174 0a20 2020 2020 2020  or float.       
+0002c330: 2053 7065 6369 6669 6573 2068 6f77 206d   Specifies how m
+0002c340: 7563 6820 6f66 2074 6865 2053 4e53 5044  uch of the SNSPD
+0002c350: 2077 6964 7468 2069 7320 6465 6469 6361   width is dedica
+0002c360: 7465 6420 746f 2074 6865 2031 3830 2064  ted to the 180 d
+0002c370: 6567 7265 650a 2020 2020 2020 2020 7475  egree.        tu
+0002c380: 726e 2e20 4120 6074 7572 6e5f 7261 7469  rn. A `turn_rati
+0002c390: 6f60 206f 6620 3130 2077 696c 6c20 7265  o` of 10 will re
+0002c3a0: 7375 6c74 2069 6e20 3230 2520 6f66 2074  sult in 20% of t
+0002c3b0: 6865 2077 6964 7468 2062 6569 6e67 0a20  he width being. 
+0002c3c0: 2020 2020 2020 2063 6f6d 7072 6973 6564         comprised
+0002c3d0: 206f 6620 7468 6520 7475 726e 2e0a 2020   of the turn..  
+0002c3e0: 2020 7465 726d 696e 616c 735f 7361 6d65    terminals_same
+0002c3f0: 5f73 6964 6520 3a20 626f 6f6c 0a20 2020  _side : bool.   
+0002c400: 2020 2020 2049 6620 5472 7565 2c20 626f       If True, bo
+0002c410: 7468 2070 6f72 7473 2077 696c 6c20 6265  th ports will be
+0002c420: 206c 6f63 6174 6564 206f 6e20 7468 6520   located on the 
+0002c430: 7361 6d65 2073 6964 6520 6f66 2074 6865  same side of the
+0002c440: 2053 4e53 5044 2e0a 2020 2020 6c61 7965   SNSPD..    laye
+0002c450: 7220 3a20 696e 742c 2061 7272 6179 2d6c  r : int, array-l
+0002c460: 696b 655b 325d 2c20 6f72 2073 6574 0a20  ike[2], or set. 
+0002c470: 2020 2020 2020 2053 7065 6369 6669 6320         Specific 
+0002c480: 6c61 7965 7228 7329 2074 6f20 7075 7420  layer(s) to put 
+0002c490: 706f 6c79 676f 6e20 6765 6f6d 6574 7279  polygon geometry
+0002c4a0: 206f 6e2e 0a0a 2020 2020 5265 7475 726e   on...    Return
+0002c4b0: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
+0002c4c0: 2020 4420 3a20 4465 7669 6365 0a20 2020    D : Device.   
+0002c4d0: 2020 2020 2041 2044 6576 6963 6520 636f       A Device co
+0002c4e0: 6e74 6169 6e69 6e67 2061 6e20 6f70 7469  ntaining an opti
+0002c4f0: 6d61 6c6c 792d 726f 756e 6465 6420 534e  mally-rounded SN
+0002c500: 5350 442e 0a20 2020 2022 2222 0a20 2020  SPD..    """.   
+0002c510: 2023 2043 6f6e 7665 6e69 656e 6365 2074   # Convenience t
+0002c520: 6573 7473 2074 6f20 6175 746f 2d73 6861  ests to auto-sha
+0002c530: 7065 2074 6865 2073 697a 6520 6261 7365  pe the size base
+0002c540: 640a 2020 2020 2320 6f6e 2074 6865 206e  d.    # on the n
+0002c550: 756d 6265 7220 6f66 2073 7175 6172 6573  umber of squares
+0002c560: 0a20 2020 2069 6620 6e75 6d5f 7371 7561  .    if num_squa
+0002c570: 7265 7320 6973 206e 6f74 204e 6f6e 6520  res is not None 
+0002c580: 616e 6420 280a 2020 2020 2020 2020 2873  and (.        (s
+0002c590: 697a 6520 6973 204e 6f6e 6529 206f 7220  ize is None) or 
+0002c5a0: 2828 7369 7a65 5b30 5d20 6973 204e 6f6e  ((size[0] is Non
+0002c5b0: 6529 2061 6e64 2028 7369 7a65 5b31 5d29  e) and (size[1])
+0002c5c0: 2069 7320 4e6f 6e65 290a 2020 2020 293a   is None).    ):
+0002c5d0: 0a20 2020 2020 2020 2078 7920 3d20 6e70  .        xy = np
+0002c5e0: 2e73 7172 7428 6e75 6d5f 7371 7561 7265  .sqrt(num_square
+0002c5f0: 7320 2a20 7769 7265 5f70 6974 6368 202a  s * wire_pitch *
+0002c600: 2077 6972 655f 7769 6474 6829 0a20 2020   wire_width).   
+0002c610: 2020 2020 2073 697a 6520 3d20 5b78 792c       size = [xy,
+0002c620: 2078 795d 0a20 2020 2020 2020 206e 756d   xy].        num
+0002c630: 5f73 7175 6172 6573 203d 204e 6f6e 650a  _squares = None.
+0002c640: 2020 2020 6966 205b 7369 7a65 5b30 5d2c      if [size[0],
+0002c650: 2073 697a 655b 315d 2c20 6e75 6d5f 7371   size[1], num_sq
+0002c660: 7561 7265 735d 2e63 6f75 6e74 284e 6f6e  uares].count(Non
+0002c670: 6529 2021 3d20 313a 0a20 2020 2020 2020  e) != 1:.       
+0002c680: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0002c690: 7228 0a20 2020 2020 2020 2020 2020 2022  r(.            "
+0002c6a0: 5b50 4849 444c 5d20 736e 7370 6428 2920  [PHIDL] snspd() 
+0002c6b0: 7265 7175 6972 6573 2074 6861 7420 6578  requires that ex
+0002c6c0: 6163 746c 7920 4f4e 4520 7661 6c75 6520  actly ONE value 
+0002c6d0: 6f66 2022 0a20 2020 2020 2020 2020 2020  of ".           
+0002c6e0: 2022 7468 6520 6172 6775 6d65 6e74 7320   "the arguments 
+0002c6f0: 6060 6e75 6d5f 7371 7561 7265 7360 6020  ``num_squares`` 
+0002c700: 616e 6420 6060 7369 7a65 6060 2062 6520  and ``size`` be 
+0002c710: 4e6f 6e65 2022 0a20 2020 2020 2020 2020  None ".         
+0002c720: 2020 2022 746f 2070 7265 7665 6e74 206f     "to prevent o
+0002c730: 7665 7263 6f6e 7374 7261 696e 696e 672c  verconstraining,
+0002c740: 2066 6f72 2065 7861 6d70 6c65 3a5c 6e22   for example:\n"
+0002c750: 0a20 2020 2020 2020 2020 2020 2022 3e3e  .            ">>
+0002c760: 3e20 736e 7370 6428 7369 7a65 203d 2028  > snspd(size = (
+0002c770: 332c 204e 6f6e 6529 2c20 6e75 6d5f 7371  3, None), num_sq
+0002c780: 7561 7265 7320 3d20 3230 3030 2922 0a20  uares = 2000)". 
+0002c790: 2020 2020 2020 2029 0a20 2020 2069 6620         ).    if 
+0002c7a0: 7369 7a65 5b30 5d20 6973 204e 6f6e 653a  size[0] is None:
+0002c7b0: 0a20 2020 2020 2020 2079 7369 7a65 203d  .        ysize =
+0002c7c0: 2073 697a 655b 315d 0a20 2020 2020 2020   size[1].       
+0002c7d0: 2078 7369 7a65 203d 206e 756d 5f73 7175   xsize = num_squ
+0002c7e0: 6172 6573 202a 2077 6972 655f 7069 7463  ares * wire_pitc
+0002c7f0: 6820 2a20 7769 7265 5f77 6964 7468 202f  h * wire_width /
+0002c800: 2079 7369 7a65 0a20 2020 2065 6c69 6620   ysize.    elif 
+0002c810: 7369 7a65 5b31 5d20 6973 204e 6f6e 653a  size[1] is None:
+0002c820: 0a20 2020 2020 2020 2078 7369 7a65 203d  .        xsize =
+0002c830: 2073 697a 655b 305d 0a20 2020 2020 2020   size[0].       
+0002c840: 2079 7369 7a65 203d 206e 756d 5f73 7175   ysize = num_squ
+0002c850: 6172 6573 202a 2077 6972 655f 7069 7463  ares * wire_pitc
+0002c860: 6820 2a20 7769 7265 5f77 6964 7468 202f  h * wire_width /
+0002c870: 2078 7369 7a65 0a20 2020 2065 6c73 653a   xsize.    else:
+0002c880: 0a20 2020 2020 2020 2078 7369 7a65 203d  .        xsize =
+0002c890: 2073 697a 655b 305d 0a20 2020 2020 2020   size[0].       
+0002c8a0: 2079 7369 7a65 203d 2073 697a 655b 315d   ysize = size[1]
+0002c8b0: 0a0a 2020 2020 6e75 6d5f 6d65 616e 6465  ..    num_meande
+0002c8c0: 7273 203d 2069 6e74 286e 702e 6365 696c  rs = int(np.ceil
+0002c8d0: 2879 7369 7a65 202f 2077 6972 655f 7069  (ysize / wire_pi
+0002c8e0: 7463 6829 290a 0a20 2020 2044 203d 2044  tch))..    D = D
+0002c8f0: 6576 6963 6528 6e61 6d65 3d22 736e 7370  evice(name="snsp
+0002c900: 6422 290a 2020 2020 6861 6972 7069 6e20  d").    hairpin 
+0002c910: 3d20 6f70 7469 6d61 6c5f 6861 6972 7069  = optimal_hairpi
+0002c920: 6e28 0a20 2020 2020 2020 2077 6964 7468  n(.        width
+0002c930: 3d77 6972 655f 7769 6474 682c 0a20 2020  =wire_width,.   
+0002c940: 2020 2020 2070 6974 6368 3d77 6972 655f       pitch=wire_
+0002c950: 7069 7463 682c 0a20 2020 2020 2020 2074  pitch,.        t
+0002c960: 7572 6e5f 7261 7469 6f3d 7475 726e 5f72  urn_ratio=turn_r
+0002c970: 6174 696f 2c0a 2020 2020 2020 2020 6c65  atio,.        le
+0002c980: 6e67 7468 3d78 7369 7a65 202f 2032 2c0a  ngth=xsize / 2,.
+0002c990: 2020 2020 2020 2020 6e75 6d5f 7074 733d          num_pts=
+0002c9a0: 3230 2c0a 2020 2020 2020 2020 6c61 7965  20,.        laye
+0002c9b0: 723d 6c61 7965 722c 0a20 2020 2029 0a0a  r=layer,.    )..
+0002c9c0: 2020 2020 6966 2028 7465 726d 696e 616c      if (terminal
+0002c9d0: 735f 7361 6d65 5f73 6964 6520 6973 2046  s_same_side is F
+0002c9e0: 616c 7365 2920 616e 6420 2828 6e75 6d5f  alse) and ((num_
+0002c9f0: 6d65 616e 6465 7273 2025 2032 2920 3d3d  meanders % 2) ==
+0002ca00: 2030 293a 0a20 2020 2020 2020 206e 756d   0):.        num
+0002ca10: 5f6d 6561 6e64 6572 7320 2b3d 2031 0a20  _meanders += 1. 
+0002ca20: 2020 2065 6c69 6620 2874 6572 6d69 6e61     elif (termina
+0002ca30: 6c73 5f73 616d 655f 7369 6465 2069 7320  ls_same_side is 
+0002ca40: 5472 7565 2920 616e 6420 2828 6e75 6d5f  True) and ((num_
+0002ca50: 6d65 616e 6465 7273 2025 2032 2920 3d3d  meanders % 2) ==
+0002ca60: 2031 293a 0a20 2020 2020 2020 206e 756d   1):.        num
+0002ca70: 5f6d 6561 6e64 6572 7320 2b3d 2031 0a0a  _meanders += 1..
+0002ca80: 2020 2020 7374 6172 745f 6e77 203d 2044      start_nw = D
+0002ca90: 2e61 6464 5f72 6566 2863 6f6d 7061 7373  .add_ref(compass
+0002caa0: 2873 697a 653d 5b78 7369 7a65 202f 2032  (size=[xsize / 2
+0002cab0: 2c20 7769 7265 5f77 6964 7468 5d2c 206c  , wire_width], l
+0002cac0: 6179 6572 3d6c 6179 6572 2929 0a0a 2020  ayer=layer))..  
+0002cad0: 2020 6870 5f70 7265 7620 3d20 442e 6164    hp_prev = D.ad
+0002cae0: 645f 7265 6628 6861 6972 7069 6e29 0a20  d_ref(hairpin). 
+0002caf0: 2020 2068 705f 7072 6576 2e63 6f6e 6e65     hp_prev.conne
+0002cb00: 6374 2831 2c20 7374 6172 745f 6e77 2e70  ct(1, start_nw.p
+0002cb10: 6f72 7473 5b22 4522 5d29 0a20 2020 2061  orts["E"]).    a
+0002cb20: 6c74 6572 6e61 7465 203d 2054 7275 650a  lternate = True.
+0002cb30: 2020 2020 666f 7220 6e20 696e 2072 616e      for n in ran
+0002cb40: 6765 2832 2c20 6e75 6d5f 6d65 616e 6465  ge(2, num_meande
+0002cb50: 7273 293a 0a20 2020 2020 2020 2068 7020  rs):.        hp 
+0002cb60: 3d20 442e 6164 645f 7265 6628 6861 6972  = D.add_ref(hair
+0002cb70: 7069 6e29 0a20 2020 2020 2020 2069 6620  pin).        if 
+0002cb80: 616c 7465 726e 6174 653a 0a20 2020 2020  alternate:.     
+0002cb90: 2020 2020 2020 2068 702e 636f 6e6e 6563         hp.connec
+0002cba0: 7428 322c 2068 705f 7072 6576 2e70 6f72  t(2, hp_prev.por
+0002cbb0: 7473 5b32 5d29 0a20 2020 2020 2020 2020  ts[2]).         
+0002cbc0: 2020 206c 6173 745f 706f 7274 203d 2068     last_port = h
+0002cbd0: 702e 706f 7274 735b 315d 0a20 2020 2020  p.ports[1].     
+0002cbe0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0002cbf0: 2020 2020 2068 702e 636f 6e6e 6563 7428       hp.connect(
+0002cc00: 312c 2068 705f 7072 6576 2e70 6f72 7473  1, hp_prev.ports
+0002cc10: 5b31 5d29 0a20 2020 2020 2020 2020 2020  [1]).           
+0002cc20: 206c 6173 745f 706f 7274 203d 2068 702e   last_port = hp.
+0002cc30: 706f 7274 735b 325d 0a20 2020 2020 2020  ports[2].       
+0002cc40: 2068 705f 7072 6576 203d 2068 700a 2020   hp_prev = hp.  
+0002cc50: 2020 2020 2020 616c 7465 726e 6174 6520        alternate 
+0002cc60: 3d20 6e6f 7420 616c 7465 726e 6174 650a  = not alternate.
+0002cc70: 0a20 2020 2066 696e 6973 685f 7365 203d  .    finish_se =
+0002cc80: 2044 2e61 6464 5f72 6566 2863 6f6d 7061   D.add_ref(compa
+0002cc90: 7373 2873 697a 653d 5b78 7369 7a65 202f  ss(size=[xsize /
+0002cca0: 2032 2c20 7769 7265 5f77 6964 7468 5d2c   2, wire_width],
+0002ccb0: 206c 6179 6572 3d6c 6179 6572 2929 0a20   layer=layer)). 
+0002ccc0: 2020 2066 696e 6973 685f 7365 2e63 6f6e     finish_se.con
+0002ccd0: 6e65 6374 2822 4522 2c20 6c61 7374 5f70  nect("E", last_p
+0002cce0: 6f72 7429 0a0a 2020 2020 442e 6164 645f  ort)..    D.add_
+0002ccf0: 706f 7274 2870 6f72 743d 7374 6172 745f  port(port=start_
+0002cd00: 6e77 2e70 6f72 7473 5b22 5722 5d2c 206e  nw.ports["W"], n
+0002cd10: 616d 653d 3129 0a20 2020 2044 2e61 6464  ame=1).    D.add
+0002cd20: 5f70 6f72 7428 706f 7274 3d66 696e 6973  _port(port=finis
+0002cd30: 685f 7365 2e70 6f72 7473 5b22 5722 5d2c  h_se.ports["W"],
+0002cd40: 206e 616d 653d 3229 0a0a 2020 2020 442e   name=2)..    D.
+0002cd50: 696e 666f 5b22 6e75 6d5f 7371 7561 7265  info["num_square
+0002cd60: 7322 5d20 3d20 6e75 6d5f 6d65 616e 6465  s"] = num_meande
+0002cd70: 7273 202a 2028 7873 697a 6520 2f20 7769  rs * (xsize / wi
+0002cd80: 7265 5f77 6964 7468 290a 2020 2020 442e  re_width).    D.
+0002cd90: 696e 666f 5b22 6172 6561 225d 203d 2078  info["area"] = x
+0002cda0: 7369 7a65 202a 2079 7369 7a65 0a20 2020  size * ysize.   
+0002cdb0: 2044 2e69 6e66 6f5b 2273 697a 6522 5d20   D.info["size"] 
+0002cdc0: 3d20 2878 7369 7a65 2c20 7973 697a 6529  = (xsize, ysize)
+0002cdd0: 0a0a 2020 2020 7265 7475 726e 2044 0a0a  ..    return D..
+0002cde0: 0a64 6566 2073 6e73 7064 5f65 7870 616e  .def snspd_expan
+0002cdf0: 6465 6428 0a20 2020 2077 6972 655f 7769  ded(.    wire_wi
+0002ce00: 6474 683d 302e 322c 0a20 2020 2077 6972  dth=0.2,.    wir
+0002ce10: 655f 7069 7463 683d 302e 362c 0a20 2020  e_pitch=0.6,.   
+0002ce20: 2073 697a 653d 2831 302c 2038 292c 0a20   size=(10, 8),. 
+0002ce30: 2020 206e 756d 5f73 7175 6172 6573 3d4e     num_squares=N
+0002ce40: 6f6e 652c 0a20 2020 2063 6f6e 6e65 6374  one,.    connect
+0002ce50: 6f72 5f77 6964 7468 3d31 2c0a 2020 2020  or_width=1,.    
+0002ce60: 636f 6e6e 6563 746f 725f 7379 6d6d 6574  connector_symmet
+0002ce70: 7269 633d 4661 6c73 652c 0a20 2020 2074  ric=False,.    t
+0002ce80: 7572 6e5f 7261 7469 6f3d 342c 0a20 2020  urn_ratio=4,.   
+0002ce90: 2074 6572 6d69 6e61 6c73 5f73 616d 655f   terminals_same_
+0002cea0: 7369 6465 3d46 616c 7365 2c0a 2020 2020  side=False,.    
+0002ceb0: 6c61 7965 723d 302c 0a29 3a0a 2020 2020  layer=0,.):.    
+0002cec0: 2222 2243 7265 6174 6573 2061 6e20 6f70  """Creates an op
+0002ced0: 7469 6d61 6c6c 792d 726f 756e 6465 6420  timally-rounded 
+0002cee0: 534e 5350 4420 7769 7468 2077 6972 6573  SNSPD with wires
+0002cef0: 2063 6f6d 696e 6720 6f75 7420 6f66 2069   coming out of i
+0002cf00: 7420 7468 6174 0a20 2020 2065 7870 616e  t that.    expan
+0002cf10: 642e 0a0a 2020 2020 5061 7261 6d65 7465  d...    Paramete
+0002cf20: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+0002cf30: 2d0a 2020 2020 7769 6474 6820 3a20 696e  -.    width : in
+0002cf40: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
+0002cf50: 2020 2057 6964 7468 206f 6620 7468 6520     Width of the 
+0002cf60: 7769 7265 2e0a 2020 2020 7069 7463 6820  wire..    pitch 
+0002cf70: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
+0002cf80: 2020 2020 2020 2044 6973 7461 6e63 6520         Distance 
+0002cf90: 6265 7477 6565 6e20 7477 6f20 6164 6a61  between two adja
+0002cfa0: 6365 6e74 2077 6972 6573 2e20 4d75 7374  cent wires. Must
+0002cfb0: 2062 6520 6772 6561 7465 7220 7468 616e   be greater than
+0002cfc0: 2060 7769 6474 6860 2e0a 2020 2020 7369   `width`..    si
+0002cfd0: 7a65 203a 204e 6f6e 6520 6f72 2061 7272  ze : None or arr
+0002cfe0: 6179 2d6c 696b 655b 325d 206f 6620 696e  ay-like[2] of in
+0002cff0: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
+0002d000: 2020 2028 7769 6474 682c 2068 6569 6768     (width, heigh
+0002d010: 7429 206f 6620 7468 6520 7265 6374 616e  t) of the rectan
+0002d020: 676c 6520 666f 726d 6564 2062 7920 7468  gle formed by th
+0002d030: 6520 6f75 7465 7220 626f 756e 6461 7279  e outer boundary
+0002d040: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
+0002d050: 534e 5350 442e 204d 7573 7420 6265 206e  SNSPD. Must be n
+0002d060: 6f6e 6520 6966 2060 6e75 6d5f 7371 7561  one if `num_squa
+0002d070: 7265 7360 2069 7320 7370 6563 6966 6965  res` is specifie
+0002d080: 642e 0a20 2020 206e 756d 5f73 7175 6172  d..    num_squar
+0002d090: 6573 203a 2069 6e74 206f 7220 4e6f 6e65  es : int or None
+0002d0a0: 0a20 2020 2020 2020 2054 6f74 616c 206e  .        Total n
+0002d0b0: 756d 6265 7220 6f66 2073 7175 6172 6573  umber of squares
+0002d0c0: 2069 6e73 6964 6520 7468 6520 534e 5350   inside the SNSP
+0002d0d0: 4420 6c65 6e67 7468 2e20 4d75 7374 2062  D length. Must b
+0002d0e0: 6520 6e6f 6e65 2069 660a 2020 2020 2020  e none if.      
+0002d0f0: 2020 6073 697a 6560 2069 7320 7370 6563    `size` is spec
+0002d100: 6966 6965 642e 0a20 2020 2063 6f6e 6e65  ified..    conne
+0002d110: 6374 6f72 5f77 6964 7468 203a 2069 6e74  ctor_width : int
+0002d120: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
+0002d130: 2020 5769 6474 6820 6f66 2074 6865 2063    Width of the c
+0002d140: 6f6e 6e65 6374 6f72 732e 0a20 2020 2063  onnectors..    c
+0002d150: 6f6e 6e65 6374 6f72 5f73 796d 6d65 7472  onnector_symmetr
+0002d160: 6963 203a 2062 6f6f 6c0a 2020 2020 2020  ic : bool.      
+0002d170: 2020 4966 2054 7275 652c 206d 6972 726f    If True, mirro
+0002d180: 7273 2074 6865 2063 6f6e 6e65 6374 6f72  rs the connector
+0002d190: 7320 6163 726f 7373 2074 6865 6972 2066  s across their f
+0002d1a0: 6c61 7420 6564 6765 2061 6e64 2061 6464  lat edge and add
+0002d1b0: 7320 7468 656d 0a20 2020 2020 2020 2074  s them.        t
+0002d1c0: 6f20 7468 6520 636f 6e6e 6563 746f 7220  o the connector 
+0002d1d0: 6765 6f6d 6574 7279 2e0a 2020 2020 7475  geometry..    tu
+0002d1e0: 726e 5f72 6174 696f 203a 2069 6e74 206f  rn_ratio : int o
+0002d1f0: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
+0002d200: 5370 6563 6966 6965 7320 686f 7720 6d75  Specifies how mu
+0002d210: 6368 206f 6620 7468 6520 534e 5350 4420  ch of the SNSPD 
+0002d220: 7769 6474 6820 6973 2064 6564 6963 6174  width is dedicat
+0002d230: 6564 2074 6f20 7468 6520 3138 3020 6465  ed to the 180 de
+0002d240: 6772 6565 0a20 2020 2020 2020 2074 7572  gree.        tur
+0002d250: 6e2e 2041 2060 7475 726e 5f72 6174 696f  n. A `turn_ratio
+0002d260: 6020 6f66 2031 3020 7769 6c6c 2072 6573  ` of 10 will res
+0002d270: 756c 7420 696e 2032 3025 206f 6620 7468  ult in 20% of th
+0002d280: 6520 7769 6474 6820 6265 696e 670a 2020  e width being.  
+0002d290: 2020 2020 2020 636f 6d70 7269 7365 6420        comprised 
+0002d2a0: 6f66 2074 6865 2074 7572 6e2e 0a20 2020  of the turn..   
+0002d2b0: 2074 6572 6d69 6e61 6c73 5f73 616d 655f   terminals_same_
+0002d2c0: 7369 6465 203a 2062 6f6f 6c0a 2020 2020  side : bool.    
+0002d2d0: 2020 2020 4966 2054 7275 652c 2062 6f74      If True, bot
+0002d2e0: 6820 706f 7274 7320 7769 6c6c 2062 6520  h ports will be 
+0002d2f0: 6c6f 6361 7465 6420 6f6e 2074 6865 2073  located on the s
+0002d300: 616d 6520 7369 6465 206f 6620 7468 6520  ame side of the 
+0002d310: 534e 5350 442e 0a20 2020 206c 6179 6572  SNSPD..    layer
+0002d320: 203a 2069 6e74 2c20 6172 7261 792d 6c69   : int, array-li
+0002d330: 6b65 5b32 5d2c 206f 7220 7365 740a 2020  ke[2], or set.  
+0002d340: 2020 2020 2020 5370 6563 6966 6963 206c        Specific l
+0002d350: 6179 6572 2873 2920 746f 2070 7574 2070  ayer(s) to put p
+0002d360: 6f6c 7967 6f6e 2067 656f 6d65 7472 7920  olygon geometry 
+0002d370: 6f6e 2e0a 0a20 2020 2052 6574 7572 6e73  on...    Returns
+0002d380: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
+0002d390: 2044 203a 2044 6576 6963 650a 2020 2020   D : Device.    
+0002d3a0: 2020 2020 4120 4465 7669 6365 2063 6f6e      A Device con
+0002d3b0: 7461 696e 696e 6720 616e 206f 7074 696d  taining an optim
+0002d3c0: 616c 6c79 2d72 6f75 6e64 6564 2053 4e53  ally-rounded SNS
+0002d3d0: 5044 2077 6974 6820 6578 7061 6e64 696e  PD with expandin
+0002d3e0: 6720 696e 7075 742f 0a20 2020 2020 2020  g input/.       
+0002d3f0: 206f 7574 7075 7420 7769 7265 732e 0a20   output wires.. 
+0002d400: 2020 2022 2222 0a20 2020 2044 203d 2044     """.    D = D
+0002d410: 6576 6963 6528 2273 6e73 7064 5f65 7870  evice("snspd_exp
+0002d420: 616e 6465 6422 290a 2020 2020 5320 3d20  anded").    S = 
+0002d430: 736e 7370 6428 0a20 2020 2020 2020 2077  snspd(.        w
+0002d440: 6972 655f 7769 6474 683d 7769 7265 5f77  ire_width=wire_w
+0002d450: 6964 7468 2c0a 2020 2020 2020 2020 7769  idth,.        wi
+0002d460: 7265 5f70 6974 6368 3d77 6972 655f 7069  re_pitch=wire_pi
+0002d470: 7463 682c 0a20 2020 2020 2020 2073 697a  tch,.        siz
+0002d480: 653d 7369 7a65 2c0a 2020 2020 2020 2020  e=size,.        
+0002d490: 6e75 6d5f 7371 7561 7265 733d 6e75 6d5f  num_squares=num_
+0002d4a0: 7371 7561 7265 732c 0a20 2020 2020 2020  squares,.       
+0002d4b0: 2074 7572 6e5f 7261 7469 6f3d 7475 726e   turn_ratio=turn
+0002d4c0: 5f72 6174 696f 2c0a 2020 2020 2020 2020  _ratio,.        
+0002d4d0: 7465 726d 696e 616c 735f 7361 6d65 5f73  terminals_same_s
+0002d4e0: 6964 653d 7465 726d 696e 616c 735f 7361  ide=terminals_sa
+0002d4f0: 6d65 5f73 6964 652c 0a20 2020 2020 2020  me_side,.       
+0002d500: 206c 6179 6572 3d6c 6179 6572 2c0a 2020   layer=layer,.  
+0002d510: 2020 290a 2020 2020 7320 3d20 442e 6164    ).    s = D.ad
+0002d520: 645f 7265 6628 5329 0a20 2020 2073 7465  d_ref(S).    ste
+0002d530: 705f 6465 7669 6365 203d 206f 7074 696d  p_device = optim
+0002d540: 616c 5f73 7465 7028 0a20 2020 2020 2020  al_step(.       
+0002d550: 2073 7461 7274 5f77 6964 7468 3d77 6972   start_width=wir
+0002d560: 655f 7769 6474 682c 0a20 2020 2020 2020  e_width,.       
+0002d570: 2065 6e64 5f77 6964 7468 3d63 6f6e 6e65   end_width=conne
+0002d580: 6374 6f72 5f77 6964 7468 2c0a 2020 2020  ctor_width,.    
+0002d590: 2020 2020 6e75 6d5f 7074 733d 3130 302c      num_pts=100,
+0002d5a0: 0a20 2020 2020 2020 2061 6e74 6963 726f  .        anticro
+0002d5b0: 7764 696e 675f 6661 6374 6f72 3d32 2c0a  wding_factor=2,.
+0002d5c0: 2020 2020 2020 2020 7769 6474 685f 746f          width_to
+0002d5d0: 6c3d 3165 2d33 2c0a 2020 2020 2020 2020  l=1e-3,.        
+0002d5e0: 7379 6d6d 6574 7269 633d 636f 6e6e 6563  symmetric=connec
+0002d5f0: 746f 725f 7379 6d6d 6574 7269 632c 0a20  tor_symmetric,. 
+0002d600: 2020 2020 2020 206c 6179 6572 3d6c 6179         layer=lay
+0002d610: 6572 2c0a 2020 2020 290a 2020 2020 7374  er,.    ).    st
+0002d620: 6570 3120 3d20 442e 6164 645f 7265 6628  ep1 = D.add_ref(
+0002d630: 7374 6570 5f64 6576 6963 6529 0a20 2020  step_device).   
+0002d640: 2073 7465 7032 203d 2044 2e61 6464 5f72   step2 = D.add_r
+0002d650: 6566 2873 7465 705f 6465 7669 6365 290a  ef(step_device).
+0002d660: 2020 2020 7374 6570 312e 636f 6e6e 6563      step1.connec
+0002d670: 7428 706f 7274 3d31 2c20 6465 7374 696e  t(port=1, destin
+0002d680: 6174 696f 6e3d 732e 706f 7274 735b 315d  ation=s.ports[1]
+0002d690: 290a 2020 2020 7374 6570 322e 636f 6e6e  ).    step2.conn
+0002d6a0: 6563 7428 706f 7274 3d31 2c20 6465 7374  ect(port=1, dest
+0002d6b0: 696e 6174 696f 6e3d 732e 706f 7274 735b  ination=s.ports[
+0002d6c0: 325d 290a 2020 2020 442e 6164 645f 706f  2]).    D.add_po
+0002d6d0: 7274 286e 616d 653d 312c 2070 6f72 743d  rt(name=1, port=
+0002d6e0: 7374 6570 312e 706f 7274 735b 325d 290a  step1.ports[2]).
+0002d6f0: 2020 2020 442e 6164 645f 706f 7274 286e      D.add_port(n
+0002d700: 616d 653d 322c 2070 6f72 743d 7374 6570  ame=2, port=step
+0002d710: 322e 706f 7274 735b 325d 290a 0a20 2020  2.ports[2])..   
+0002d720: 2044 2e69 6e66 6f20 3d20 532e 696e 666f   D.info = S.info
+0002d730: 0a20 2020 2053 2e69 6e66 6f20 3d20 7b7d  .    S.info = {}
+0002d740: 0a0a 2020 2020 7265 7475 726e 2044 0a0a  ..    return D..
+0002d750: 0a23 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  .# =============
+0002d760: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002d770: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002d780: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002d790: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002d7a0: 3d0a 2320 4578 616d 706c 6520 636f 6465  =.# Example code
+0002d7b0: 0a23 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  .# =============
+0002d7c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002d7d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002d7e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002d7f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+0002d800: 3d0a 0a23 2073 203d 2073 6e73 7064 2877  =..# s = snspd(w
+0002d810: 6972 655f 7769 6474 6820 3d20 302e 322c  ire_width = 0.2,
+0002d820: 2077 6972 655f 7069 7463 6820 3d20 302e   wire_pitch = 0.
+0002d830: 362c 2073 697a 6520 3d20 5b31 302c 335d  6, size = [10,3]
+0002d840: 2c20 7465 726d 696e 616c 735f 7361 6d65  , terminals_same
+0002d850: 5f73 6964 6520 3d20 5472 7565 290a 2320  _side = True).# 
+0002d860: 7175 6963 6b70 6c6f 7428 7329 0a0a 2320  quickplot(s)..# 
+0002d870: 7320 3d20 736e 7370 6428 7769 7265 5f77  s = snspd(wire_w
+0002d880: 6964 7468 203d 2030 2e32 2c20 7769 7265  idth = 0.2, wire
+0002d890: 5f70 6974 6368 203d 2030 2e36 2c20 7369  _pitch = 0.6, si
+0002d8a0: 7a65 203d 205b 3130 2c20 4e6f 6e65 5d2c  ze = [10, None],
+0002d8b0: 0a23 2020 2020 2020 2020 2020 6e75 6d5f  .#          num_
+0002d8c0: 7371 7561 7265 7320 3d20 3130 3030 2c20  squares = 1000, 
+0002d8d0: 7465 726d 696e 616c 735f 7361 6d65 5f73  terminals_same_s
+0002d8e0: 6964 6520 3d20 5472 7565 290a 2320 7175  ide = True).# qu
+0002d8f0: 6963 6b70 6c6f 7428 7329 0a0a 0a64 6566  ickplot(s)...def
+0002d900: 2073 6e73 7064 5f63 616e 6465 6c61 6272   snspd_candelabr
+0002d910: 6128 2020 2320 6e6f 7161 3a20 4339 3031  a(  # noqa: C901
+0002d920: 0a20 2020 2077 6972 655f 7769 6474 683d  .    wire_width=
+0002d930: 302e 3532 2c0a 2020 2020 7769 7265 5f70  0.52,.    wire_p
+0002d940: 6974 6368 3d30 2e35 362c 0a20 2020 2068  itch=0.56,.    h
+0002d950: 6178 6973 3d39 302c 0a20 2020 2076 6178  axis=90,.    vax
+0002d960: 6973 3d35 302c 0a20 2020 2065 7175 616c  is=50,.    equal
+0002d970: 697a 655f 7061 7468 5f6c 656e 6774 6873  ize_path_lengths
+0002d980: 3d46 616c 7365 2c0a 2020 2020 7877 696e  =False,.    xwin
+0002d990: 673d 4661 6c73 652c 0a20 2020 206c 6179  g=False,.    lay
+0002d9a0: 6572 3d30 2c0a 293a 0a20 2020 2022 2222  er=0,.):.    """
+0002d9b0: 4372 6561 7465 7320 616e 206f 7074 696d  Creates an optim
+0002d9c0: 616c 6c79 2d72 6f75 6e64 6564 2053 4e53  ally-rounded SNS
+0002d9d0: 5044 2077 6974 6820 6c6f 7720 6375 7272  PD with low curr
+0002d9e0: 656e 7420 6372 6f77 6469 6e67 2061 6e64  ent crowding and
+0002d9f0: 0a20 2020 2061 7262 7469 7472 6172 696c  .    arbtitraril
+0002da00: 792d 6869 6768 2066 696c 6c20 6661 6374  y-high fill fact
+0002da10: 6f72 2061 7320 6465 7363 7269 6265 6420  or as described 
+0002da20: 6279 2052 6564 6479 2065 742e 2061 6c2e  by Reddy et. al.
+0002da30: 2c0a 2020 2020 4150 4c20 5068 6f74 6f6e  ,.    APL Photon
+0002da40: 6963 7320 372c 2030 3531 3330 3220 2832  ics 7, 051302 (2
+0002da50: 3032 3229 2020 6874 7470 733a 2f2f 646f  022)  https://do
+0002da60: 692e 6f72 672f 3130 2e31 3036 332f 352e  i.org/10.1063/5.
+0002da70: 3030 3838 3030 370a 0a20 2020 2050 6172  0088007..    Par
+0002da80: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+0002da90: 2d2d 2d2d 2d2d 0a20 2020 2077 6972 655f  ------.    wire_
+0002daa0: 7769 6474 6820 3a20 696e 7420 6f72 2066  width : int or f
+0002dab0: 6c6f 6174 0a20 2020 2020 2020 2057 6964  loat.        Wid
+0002dac0: 7468 206f 6620 7468 6520 7769 7265 2e0a  th of the wire..
+0002dad0: 2020 2020 7769 7265 5f70 6974 6368 203a      wire_pitch :
+0002dae0: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
+0002daf0: 2020 2020 2020 4469 7374 616e 6365 2062        Distance b
+0002db00: 6574 7765 656e 2074 776f 2061 646a 6163  etween two adjac
+0002db10: 656e 7420 7769 7265 732e 204d 7573 7420  ent wires. Must 
+0002db20: 6265 2067 7265 6174 6572 2074 6861 6e20  be greater than 
+0002db30: 6077 6964 7468 602e 0a20 2020 2068 6178  `width`..    hax
+0002db40: 6973 203a 2069 6e74 206f 7220 666c 6f61  is : int or floa
+0002db50: 740a 2020 2020 2020 2020 4c65 6e67 7468  t.        Length
+0002db60: 206f 6620 686f 7269 7a6f 6e74 616c 2064   of horizontal d
+0002db70: 6961 676f 6e61 6c20 6f66 2074 6865 2072  iagonal of the r
+0002db80: 686f 6d62 6f69 6461 6c20 6163 7469 7665  homboidal active
+0002db90: 2061 7265 612e 0a20 2020 2020 2020 2054   area..        T
+0002dba0: 6865 2070 6172 616d 6574 6572 2060 6861  he parameter `ha
+0002dbb0: 7869 7360 2069 7320 7072 696f 7269 7469  xis` is prioriti
+0002dbc0: 7a65 6420 6f76 6572 2060 7661 7869 7360  zed over `vaxis`
+0002dbd0: 2e0a 2020 2020 7661 7869 7320 3a20 696e  ..    vaxis : in
+0002dbe0: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
+0002dbf0: 2020 204c 656e 6774 6820 6f66 2076 6572     Length of ver
+0002dc00: 7469 6361 6c20 6469 6167 6f6e 616c 206f  tical diagonal o
+0002dc10: 6620 7468 6520 7268 6f6d 626f 6964 616c  f the rhomboidal
+0002dc20: 2061 6374 6976 6520 6172 6561 2e0a 2020   active area..  
+0002dc30: 2020 6571 7561 6c69 7a65 5f70 6174 685f    equalize_path_
+0002dc40: 6c65 6e67 7468 7320 3a20 626f 6f6c 0a20  lengths : bool. 
+0002dc50: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+0002dc60: 6164 6473 2077 6972 6520 7365 676d 656e  adds wire segmen
+0002dc70: 7473 2074 6f20 6861 6972 7069 6e20 6265  ts to hairpin be
+0002dc80: 6e64 7320 746f 2065 7175 616c 697a 6520  nds to equalize 
+0002dc90: 7061 7468 206c 656e 6774 6873 0a20 2020  path lengths.   
+0002dca0: 2020 2020 2066 726f 6d20 6365 6e74 6572       from center
+0002dcb0: 2074 6f20 6365 6e74 6572 2066 6f72 2061   to center for a
+0002dcc0: 6c6c 2070 6172 616c 6c65 6c20 7769 7265  ll parallel wire
+0002dcd0: 7320 696e 2061 6374 6976 6520 6172 6561  s in active area
+0002dce0: 2e0a 2020 2020 7877 696e 6720 3a20 626f  ..    xwing : bo
+0002dcf0: 6f6c 0a20 2020 2020 2020 2049 6620 5472  ol.        If Tr
+0002dd00: 7565 2c20 7265 706c 6163 6573 2039 302d  ue, replaces 90-
+0002dd10: 6465 6772 6565 2062 656e 6473 2077 6974  degree bends wit
+0002dd20: 6820 3133 352d 6465 6772 6565 2062 656e  h 135-degree ben
+0002dd30: 6473 2e0a 2020 2020 6c61 7965 7220 3a20  ds..    layer : 
+0002dd40: 696e 740a 2020 2020 2020 2020 5370 6563  int.        Spec
+0002dd50: 6966 6963 206c 6179 6572 2074 6f20 7075  ific layer to pu
+0002dd60: 7420 706f 6c79 676f 6e20 6765 6f6d 6574  t polygon geomet
+0002dd70: 7279 206f 6e2e 0a0a 2020 2020 5265 7475  ry on...    Retu
+0002dd80: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
+0002dd90: 2020 2020 4420 3a20 4465 7669 6365 0a20      D : Device. 
+0002dda0: 2020 2020 2020 2041 2044 6576 6963 6520         A Device 
+0002ddb0: 636f 6e74 6169 6e69 6e67 2061 6e20 6f70  containing an op
+0002ddc0: 7469 6d61 6c6c 792d 726f 756e 6465 6420  timally-rounded 
+0002ddd0: 534e 5350 4420 7769 7468 206d 696e 696d  SNSPD with minim
+0002dde0: 697a 6564 2063 7572 7265 6e74 0a20 2020  ized current.   
+0002ddf0: 2020 2020 2063 726f 7764 696e 6720 666f       crowding fo
+0002de00: 7220 616e 7920 6669 6c6c 2066 6163 746f  r any fill facto
+0002de10: 722e 0a20 2020 2022 2222 0a0a 2020 2020  r..    """..    
+0002de20: 6465 6620 6f66 665f 6178 6973 5f75 7475  def off_axis_utu
+0002de30: 726e 280a 2020 2020 2020 2020 7769 7265  rn(.        wire
+0002de40: 5f77 6964 7468 3d30 2e35 322c 0a20 2020  _width=0.52,.   
+0002de50: 2020 2020 2077 6972 655f 7069 7463 683d       wire_pitch=
+0002de60: 302e 3536 2c0a 2020 2020 2020 2020 7066  0.56,.        pf
+0002de70: 6163 743d 3130 2e30 202f 2033 2c0a 2020  act=10.0 / 3,.  
+0002de80: 2020 2020 2020 7368 6172 703d 4661 6c73        sharp=Fals
+0002de90: 652c 0a20 2020 2020 2020 2070 6164 5f6c  e,.        pad_l
+0002dea0: 656e 6774 683d 302c 0a20 2020 2020 2020  ength=0,.       
+0002deb0: 206c 6179 6572 3d30 2c0a 2020 2020 293a   layer=0,.    ):
+0002dec0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+0002ded0: 726e 7320 7068 6964 6c20 6465 7669 6365  rns phidl device
+0002dee0: 206c 6f77 2d63 726f 7764 696e 6720 752d   low-crowding u-
+0002def0: 7475 726e 2066 6f72 2063 616e 6465 6c61  turn for candela
+0002df00: 6272 6120 6d65 616e 6465 722e 2222 220a  bra meander.""".
+0002df10: 2020 2020 2020 2020 6261 7263 203d 206f          barc = o
+0002df20: 7074 696d 616c 5f39 3064 6567 2877 6964  ptimal_90deg(wid
+0002df30: 7468 3d77 6972 655f 7769 6474 682c 206c  th=wire_width, l
+0002df40: 6179 6572 3d6c 6179 6572 290a 2020 2020  ayer=layer).    
+0002df50: 2020 2020 6966 206e 6f74 2073 6861 7270      if not sharp
+0002df60: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0002df70: 466f 7220 6e6f 6e2d 726f 756e 6465 6420  For non-rounded 
+0002df80: 6f75 7465 7220 7261 6469 690a 2020 2020  outer radii.    
+0002df90: 2020 2020 2020 2020 2320 4e6f 7420 6675          # Not fu
+0002dfa0: 6c6c 7920 696d 706c 656d 656e 7465 640a  lly implemented.
+0002dfb0: 2020 2020 2020 2020 2020 2020 706f 7274              port
+0002dfc0: 316d 7020 3d20 5b62 6172 632e 706f 7274  1mp = [barc.port
+0002dfd0: 735b 315d 2e78 2c20 6261 7263 2e70 6f72  s[1].x, barc.por
+0002dfe0: 7473 5b31 5d2e 795d 0a20 2020 2020 2020  ts[1].y].       
+0002dff0: 2020 2020 2070 6f72 7431 6f72 203d 2062       port1or = b
+0002e000: 6172 632e 706f 7274 735b 315d 2e6f 7269  arc.ports[1].ori
+0002e010: 656e 7461 7469 6f6e 0a20 2020 2020 2020  entation.       
+0002e020: 2020 2020 2070 6f72 7432 6d70 203d 205b       port2mp = [
+0002e030: 6261 7263 2e70 6f72 7473 5b32 5d2e 782c  barc.ports[2].x,
+0002e040: 2062 6172 632e 706f 7274 735b 325d 2e79   barc.ports[2].y
+0002e050: 5d0a 2020 2020 2020 2020 2020 2020 706f  ].            po
+0002e060: 7274 326f 7220 3d20 6261 7263 2e70 6f72  rt2or = barc.por
+0002e070: 7473 5b32 5d2e 6f72 6965 6e74 6174 696f  ts[2].orientatio
+0002e080: 6e0a 2020 2020 2020 2020 2020 2020 6261  n.            ba
+0002e090: 7263 203d 2062 6f6f 6c65 616e 280a 2020  rc = boolean(.  
+0002e0a0: 2020 2020 2020 2020 2020 2020 2020 413d                A=
+0002e0b0: 6261 7263 2c0a 2020 2020 2020 2020 2020  barc,.          
+0002e0c0: 2020 2020 2020 423d 636f 7079 2862 6172        B=copy(bar
+0002e0d0: 6329 2e6d 6f76 6528 5b2d 7769 7265 5f77  c).move([-wire_w
+0002e0e0: 6964 7468 2c20 2d77 6972 655f 7769 6474  idth, -wire_widt
+0002e0f0: 685d 292c 0a20 2020 2020 2020 2020 2020  h]),.           
+0002e100: 2020 2020 206f 7065 7261 7469 6f6e 3d22       operation="
+0002e110: 6e6f 7422 2c0a 2020 2020 2020 2020 2020  not",.          
+0002e120: 2020 2020 2020 6c61 7965 723d 6c61 7965        layer=laye
+0002e130: 722c 0a20 2020 2020 2020 2020 2020 2029  r,.            )
+0002e140: 0a20 2020 2020 2020 2020 2020 2062 6172  .            bar
+0002e150: 632e 6164 645f 706f 7274 280a 2020 2020  c.add_port(.    
+0002e160: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+0002e170: 3d31 2c20 6d69 6470 6f69 6e74 3d70 6f72  =1, midpoint=por
+0002e180: 7431 6d70 2c20 7769 6474 683d 7769 7265  t1mp, width=wire
+0002e190: 5f77 6964 7468 2c20 6f72 6965 6e74 6174  _width, orientat
+0002e1a0: 696f 6e3d 706f 7274 316f 720a 2020 2020  ion=port1or.    
+0002e1b0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0002e1c0: 2020 2020 2020 6261 7263 2e61 6464 5f70        barc.add_p
+0002e1d0: 6f72 7428 0a20 2020 2020 2020 2020 2020  ort(.           
+0002e1e0: 2020 2020 206e 616d 653d 322c 206d 6964       name=2, mid
+0002e1f0: 706f 696e 743d 706f 7274 326d 702c 2077  point=port2mp, w
+0002e200: 6964 7468 3d77 6972 655f 7769 6474 682c  idth=wire_width,
+0002e210: 206f 7269 656e 7461 7469 6f6e 3d70 6f72   orientation=por
+0002e220: 7432 6f72 0a20 2020 2020 2020 2020 2020  t2or.           
+0002e230: 2029 0a20 2020 2020 2020 2070 696e 203d   ).        pin =
+0002e240: 206f 7074 696d 616c 5f68 6169 7270 696e   optimal_hairpin
+0002e250: 280a 2020 2020 2020 2020 2020 2020 7769  (.            wi
+0002e260: 6474 683d 7769 7265 5f77 6964 7468 2c0a  dth=wire_width,.
+0002e270: 2020 2020 2020 2020 2020 2020 7069 7463              pitc
+0002e280: 683d 7066 6163 7420 2a20 7769 7265 5f77  h=pfact * wire_w
+0002e290: 6964 7468 2c0a 2020 2020 2020 2020 2020  idth,.          
+0002e2a0: 2020 6c65 6e67 7468 3d38 202a 2077 6972    length=8 * wir
+0002e2b0: 655f 7769 6474 682c 0a20 2020 2020 2020  e_width,.       
+0002e2c0: 2020 2020 206c 6179 6572 3d6c 6179 6572       layer=layer
+0002e2d0: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+0002e2e0: 2020 2020 7061 7320 3d20 636f 6d70 6173      pas = compas
+0002e2f0: 7328 7369 7a65 3d28 7769 7265 5f77 6964  s(size=(wire_wid
+0002e300: 7468 2c20 7769 7265 5f70 6974 6368 292c  th, wire_pitch),
+0002e310: 206c 6179 6572 3d6c 6179 6572 290a 2020   layer=layer).  
+0002e320: 2020 2020 2020 4420 3d20 4465 7669 6365        D = Device
+0002e330: 2829 0a20 2020 2020 2020 2061 7263 3120  ().        arc1 
+0002e340: 3d20 442e 6164 645f 7265 6628 6261 7263  = D.add_ref(barc
+0002e350: 290a 2020 2020 2020 2020 6172 6331 2e72  ).        arc1.r
+0002e360: 6f74 6174 6528 3930 290a 2020 2020 2020  otate(90).      
+0002e370: 2020 7069 6e31 203d 2044 2e61 6464 5f72    pin1 = D.add_r
+0002e380: 6566 2870 696e 290a 2020 2020 2020 2020  ef(pin).        
+0002e390: 7069 6e31 2e63 6f6e 6e65 6374 2831 2c20  pin1.connect(1, 
+0002e3a0: 6172 6331 2e70 6f72 7473 5b32 5d29 0a20  arc1.ports[2]). 
+0002e3b0: 2020 2020 2020 2070 6173 3120 3d20 442e         pas1 = D.
+0002e3c0: 6164 645f 7265 6628 7061 7329 0a20 2020  add_ref(pas).   
+0002e3d0: 2020 2020 2070 6173 312e 636f 6e6e 6563       pas1.connec
+0002e3e0: 7428 7061 7331 2e70 6f72 7473 5b22 4e22  t(pas1.ports["N"
+0002e3f0: 5d2c 2070 696e 312e 706f 7274 735b 325d  ], pin1.ports[2]
+0002e400: 290a 2020 2020 2020 2020 6172 6332 203d  ).        arc2 =
+0002e410: 2044 2e61 6464 5f72 6566 2862 6172 6329   D.add_ref(barc)
+0002e420: 0a20 2020 2020 2020 2061 7263 322e 636f  .        arc2.co
+0002e430: 6e6e 6563 7428 322c 2070 6173 312e 706f  nnect(2, pas1.po
+0002e440: 7274 735b 2253 225d 290a 2020 2020 2020  rts["S"]).      
+0002e450: 2020 6966 2070 6164 5f6c 656e 6774 6820    if pad_length 
+0002e460: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+0002e470: 2070 696e 312e 6d6f 7665 7928 7061 645f   pin1.movey(pad_
+0002e480: 6c65 6e67 7468 202a 2030 2e35 290a 2020  length * 0.5).  
+0002e490: 2020 2020 2020 2020 2020 7465 6d70 6320            tempc 
+0002e4a0: 3d20 442e 6164 645f 7265 6628 0a20 2020  = D.add_ref(.   
+0002e4b0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+0002e4c0: 7061 7373 280a 2020 2020 2020 2020 2020  pass(.          
+0002e4d0: 2020 2020 2020 2020 2020 7369 7a65 3d28            size=(
+0002e4e0: 7069 6e31 2e70 6f72 7473 5b31 5d2e 7769  pin1.ports[1].wi
+0002e4f0: 6474 682c 2070 696e 312e 706f 7274 735b  dth, pin1.ports[
+0002e500: 315d 2e79 202d 2061 7263 312e 706f 7274  1].y - arc1.port
+0002e510: 735b 325d 2e79 292c 0a20 2020 2020 2020  s[2].y),.       
+0002e520: 2020 2020 2020 2020 2020 2020 206c 6179               lay
+0002e530: 6572 3d6c 6179 6572 2c0a 2020 2020 2020  er=layer,.      
+0002e540: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0002e550: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0002e560: 2020 2020 2020 7465 6d70 632e 636f 6e6e        tempc.conn
+0002e570: 6563 7428 224e 222c 2070 696e 312e 706f  ect("N", pin1.po
+0002e580: 7274 735b 315d 290a 2020 2020 2020 2020  rts[1]).        
+0002e590: 2020 2020 7465 6d70 6320 3d20 442e 6164      tempc = D.ad
+0002e5a0: 645f 7265 6628 0a20 2020 2020 2020 2020  d_ref(.         
+0002e5b0: 2020 2020 2020 2063 6f6d 7061 7373 280a         compass(.
+0002e5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e5d0: 2020 2020 7369 7a65 3d28 7069 6e31 2e70      size=(pin1.p
+0002e5e0: 6f72 7473 5b32 5d2e 7769 6474 682c 2070  orts[2].width, p
+0002e5f0: 696e 312e 706f 7274 735b 325d 2e79 202d  in1.ports[2].y -
+0002e600: 2070 6173 312e 706f 7274 735b 224e 225d   pas1.ports["N"]
+0002e610: 2e79 292c 0a20 2020 2020 2020 2020 2020  .y),.           
+0002e620: 2020 2020 2020 2020 206c 6179 6572 3d6c           layer=l
+0002e630: 6179 6572 2c0a 2020 2020 2020 2020 2020  ayer,.          
+0002e640: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0002e650: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0002e660: 2020 7465 6d70 632e 636f 6e6e 6563 7428    tempc.connect(
+0002e670: 224e 222c 2070 696e 312e 706f 7274 735b  "N", pin1.ports[
+0002e680: 325d 290a 2020 2020 2020 2020 442e 6164  2]).        D.ad
+0002e690: 645f 706f 7274 280a 2020 2020 2020 2020  d_port(.        
+0002e6a0: 2020 2020 6e61 6d65 3d31 2c0a 2020 2020      name=1,.    
+0002e6b0: 2020 2020 2020 2020 6d69 6470 6f69 6e74          midpoint
+0002e6c0: 3d61 7263 312e 706f 7274 735b 315d 2e6d  =arc1.ports[1].m
+0002e6d0: 6964 706f 696e 742c 0a20 2020 2020 2020  idpoint,.       
+0002e6e0: 2020 2020 2077 6964 7468 3d77 6972 655f       width=wire_
+0002e6f0: 7769 6474 682c 0a20 2020 2020 2020 2020  width,.         
+0002e700: 2020 206f 7269 656e 7461 7469 6f6e 3d61     orientation=a
+0002e710: 7263 312e 706f 7274 735b 315d 2e6f 7269  rc1.ports[1].ori
+0002e720: 656e 7461 7469 6f6e 2c0a 2020 2020 2020  entation,.      
+0002e730: 2020 290a 2020 2020 2020 2020 442e 6164    ).        D.ad
+0002e740: 645f 706f 7274 280a 2020 2020 2020 2020  d_port(.        
+0002e750: 2020 2020 6e61 6d65 3d32 2c0a 2020 2020      name=2,.    
+0002e760: 2020 2020 2020 2020 6d69 6470 6f69 6e74          midpoint
+0002e770: 3d61 7263 322e 706f 7274 735b 315d 2e6d  =arc2.ports[1].m
+0002e780: 6964 706f 696e 742c 0a20 2020 2020 2020  idpoint,.       
+0002e790: 2020 2020 2077 6964 7468 3d77 6972 655f       width=wire_
+0002e7a0: 7769 6474 682c 0a20 2020 2020 2020 2020  width,.         
+0002e7b0: 2020 206f 7269 656e 7461 7469 6f6e 3d61     orientation=a
+0002e7c0: 7263 322e 706f 7274 735b 315d 2e6f 7269  rc2.ports[1].ori
+0002e7d0: 656e 7461 7469 6f6e 2c0a 2020 2020 2020  entation,.      
+0002e7e0: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
+0002e7f0: 726e 2044 0a0a 2020 2020 6465 6620 7877  rn D..    def xw
+0002e800: 696e 675f 7574 7572 6e28 0a20 2020 2020  ing_uturn(.     
+0002e810: 2020 2077 6972 655f 7769 6474 683d 302e     wire_width=0.
+0002e820: 3532 2c20 7769 7265 5f70 6974 6368 3d30  52, wire_pitch=0
+0002e830: 2e35 362c 2070 6661 6374 3d31 302e 3020  .56, pfact=10.0 
+0002e840: 2f20 332c 2070 6164 5f6c 656e 6774 683d  / 3, pad_length=
+0002e850: 302c 206c 6179 6572 3d30 0a20 2020 2029  0, layer=0.    )
+0002e860: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+0002e870: 7572 6e73 2070 6869 646c 2064 6576 6963  urns phidl devic
+0002e880: 6520 6c6f 772d 6372 6f77 6469 6e67 2075  e low-crowding u
+0002e890: 2d74 7572 6e20 666f 7220 582d 7769 6e67  -turn for X-wing
+0002e8a0: 206d 6561 6e64 6572 2e22 2222 0a20 2020   meander.""".   
+0002e8b0: 2020 2020 2062 6172 6320 3d20 6172 6328       barc = arc(
+0002e8c0: 0a20 2020 2020 2020 2020 2020 2072 6164  .            rad
+0002e8d0: 6975 733d 7769 7265 5f77 6964 7468 202a  ius=wire_width *
+0002e8e0: 2033 2c20 7769 6474 683d 7769 7265 5f77   3, width=wire_w
+0002e8f0: 6964 7468 2c20 6c61 7965 723d 6c61 7965  idth, layer=laye
+0002e900: 722c 2074 6865 7461 3d34 350a 2020 2020  r, theta=45.    
+0002e910: 2020 2020 292e 726f 7461 7465 2831 3830      ).rotate(180
+0002e920: 290a 0a20 2020 2020 2020 2070 696e 203d  )..        pin =
+0002e930: 206f 7074 696d 616c 5f68 6169 7270 696e   optimal_hairpin
+0002e940: 280a 2020 2020 2020 2020 2020 2020 7769  (.            wi
+0002e950: 6474 683d 7769 7265 5f77 6964 7468 2c0a  dth=wire_width,.
+0002e960: 2020 2020 2020 2020 2020 2020 7069 7463              pitc
+0002e970: 683d 7066 6163 7420 2a20 7769 7265 5f77  h=pfact * wire_w
+0002e980: 6964 7468 2c0a 2020 2020 2020 2020 2020  idth,.          
+0002e990: 2020 6c65 6e67 7468 3d31 3520 2a20 7769    length=15 * wi
+0002e9a0: 7265 5f77 6964 7468 2c0a 2020 2020 2020  re_width,.      
+0002e9b0: 2020 2020 2020 6c61 7965 723d 6c61 7965        layer=laye
+0002e9c0: 722c 0a20 2020 2020 2020 2029 0a0a 2020  r,.        )..  
+0002e9d0: 2020 2020 2020 7061 736c 656e 203d 2070        paslen = p
+0002e9e0: 6661 6374 202a 2077 6972 655f 7769 6474  fact * wire_widt
+0002e9f0: 6820 2d20 6e70 2e73 7172 7428 3229 202a  h - np.sqrt(2) *
+0002ea00: 2077 6972 655f 7069 7463 680a 2020 2020   wire_pitch.    
+0002ea10: 2020 2020 7061 7320 3d20 636f 6d70 6173      pas = compas
+0002ea20: 7328 7369 7a65 3d28 7769 7265 5f77 6964  s(size=(wire_wid
+0002ea30: 7468 2c20 6162 7328 7061 736c 656e 2929  th, abs(paslen))
+0002ea40: 2c20 6c61 7965 723d 6c61 7965 7229 0a20  , layer=layer). 
+0002ea50: 2020 2020 2020 2044 7465 6d70 203d 2044         Dtemp = D
+0002ea60: 6576 6963 6528 290a 2020 2020 2020 2020  evice().        
+0002ea70: 6172 6331 203d 2044 7465 6d70 2e61 6464  arc1 = Dtemp.add
+0002ea80: 5f72 6566 2862 6172 6329 0a20 2020 2020  _ref(barc).     
+0002ea90: 2020 2061 7263 312e 726f 7461 7465 2839     arc1.rotate(9
+0002eaa0: 3029 0a20 2020 2020 2020 2070 696e 3120  0).        pin1 
+0002eab0: 3d20 4474 656d 702e 6164 645f 7265 6628  = Dtemp.add_ref(
+0002eac0: 7069 6e29 0a20 2020 2020 2020 2070 6173  pin).        pas
+0002ead0: 3120 3d20 4474 656d 702e 6164 645f 7265  1 = Dtemp.add_re
+0002eae0: 6628 7061 7329 0a20 2020 2020 2020 2061  f(pas).        a
+0002eaf0: 7263 3220 3d20 4474 656d 702e 6164 645f  rc2 = Dtemp.add_
+0002eb00: 7265 6628 6261 7263 290a 2020 2020 2020  ref(barc).      
+0002eb10: 2020 6966 2070 6173 6c65 6e20 3e20 303a    if paslen > 0:
+0002eb20: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+0002eb30: 312e 636f 6e6e 6563 7428 7061 7331 2e70  1.connect(pas1.p
+0002eb40: 6f72 7473 5b22 5322 5d2c 2061 7263 312e  orts["S"], arc1.
+0002eb50: 706f 7274 735b 325d 290a 2020 2020 2020  ports[2]).      
+0002eb60: 2020 2020 2020 7069 6e31 2e63 6f6e 6e65        pin1.conne
+0002eb70: 6374 2831 2c20 7061 7331 2e70 6f72 7473  ct(1, pas1.ports
+0002eb80: 5b22 4e22 5d29 0a20 2020 2020 2020 2020  ["N"]).         
+0002eb90: 2020 2061 7263 322e 636f 6e6e 6563 7428     arc2.connect(
+0002eba0: 322c 2070 696e 312e 706f 7274 735b 325d  2, pin1.ports[2]
+0002ebb0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0002ebc0: 2020 2020 2020 2020 2020 2020 7069 6e31              pin1
+0002ebd0: 2e63 6f6e 6e65 6374 2831 2c20 6172 6331  .connect(1, arc1
+0002ebe0: 2e70 6f72 7473 5b32 5d29 0a20 2020 2020  .ports[2]).     
+0002ebf0: 2020 2020 2020 2070 6173 312e 636f 6e6e         pas1.conn
+0002ec00: 6563 7428 224e 222c 2070 696e 312e 706f  ect("N", pin1.po
+0002ec10: 7274 735b 325d 290a 2020 2020 2020 2020  rts[2]).        
+0002ec20: 2020 2020 6172 6332 2e63 6f6e 6e65 6374      arc2.connect
+0002ec30: 2832 2c20 7061 7331 2e70 6f72 7473 5b22  (2, pas1.ports["
+0002ec40: 5322 5d29 0a20 2020 2020 2020 2069 6620  S"]).        if 
+0002ec50: 7061 645f 6c65 6e67 7468 203e 2030 3a0a  pad_length > 0:.
+0002ec60: 2020 2020 2020 2020 2020 2020 7069 6e31              pin1
+0002ec70: 2e6d 6f76 6528 5b70 6164 5f6c 656e 6774  .move([pad_lengt
+0002ec80: 6820 2a20 302e 3520 2f20 6e70 2e73 7172  h * 0.5 / np.sqr
+0002ec90: 7428 3229 2c20 7061 645f 6c65 6e67 7468  t(2), pad_length
+0002eca0: 202a 2030 2e35 202f 206e 702e 7371 7274   * 0.5 / np.sqrt
+0002ecb0: 2832 295d 290a 2020 2020 2020 2020 2020  (2)]).          
+0002ecc0: 2020 6966 2070 6173 6c65 6e20 3e20 303a    if paslen > 0:
+0002ecd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002ece0: 2069 6e64 7831 203d 2032 0a20 2020 2020   indx1 = 2.     
+0002ecf0: 2020 2020 2020 2020 2020 2069 6e64 7832             indx2
+0002ed00: 203d 2031 0a20 2020 2020 2020 2020 2020   = 1.           
+0002ed10: 2020 2020 206d 7961 7263 203d 2061 7263       myarc = arc
+0002ed20: 320a 2020 2020 2020 2020 2020 2020 656c  2.            el
+0002ed30: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0002ed40: 2020 2020 696e 6478 3120 3d20 310a 2020      indx1 = 1.  
+0002ed50: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0002ed60: 6478 3220 3d20 320a 2020 2020 2020 2020  dx2 = 2.        
+0002ed70: 2020 2020 2020 2020 6d79 6172 6320 3d20          myarc = 
+0002ed80: 6172 6331 0a20 2020 2020 2020 2020 2020  arc1.           
+0002ed90: 2063 6f6d 7064 6973 7420 3d20 6e70 2e73   compdist = np.s
+0002eda0: 7172 7428 0a20 2020 2020 2020 2020 2020  qrt(.           
+0002edb0: 2020 2020 206e 702e 7375 6d28 6e70 2e73       np.sum(np.s
+0002edc0: 7175 6172 6528 7069 6e31 2e70 6f72 7473  quare(pin1.ports
+0002edd0: 5b69 6e64 7831 5d2e 6d69 6470 6f69 6e74  [indx1].midpoint
+0002ede0: 202d 206d 7961 7263 2e70 6f72 7473 5b32   - myarc.ports[2
+0002edf0: 5d2e 6d69 6470 6f69 6e74 2929 0a20 2020  ].midpoint)).   
+0002ee00: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0002ee10: 2020 2020 2020 2074 656d 7063 203d 2044         tempc = D
+0002ee20: 7465 6d70 2e61 6464 5f72 6566 280a 2020  temp.add_ref(.  
+0002ee30: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0002ee40: 6d70 6173 7328 7369 7a65 3d28 7069 6e31  mpass(size=(pin1
+0002ee50: 2e70 6f72 7473 5b69 6e64 7831 5d2e 7769  .ports[indx1].wi
+0002ee60: 6474 682c 2063 6f6d 7064 6973 7429 2c20  dth, compdist), 
+0002ee70: 6c61 7965 723d 6c61 7965 7229 0a20 2020  layer=layer).   
+0002ee80: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0002ee90: 2020 2020 2020 2074 656d 7063 2e63 6f6e         tempc.con
+0002eea0: 6e65 6374 2822 4e22 2c20 7069 6e31 2e70  nect("N", pin1.p
+0002eeb0: 6f72 7473 5b69 6e64 7831 5d29 0a20 2020  orts[indx1]).   
+0002eec0: 2020 2020 2020 2020 2063 6f6d 7064 6973           compdis
+0002eed0: 7420 3d20 6e70 2e73 7172 7428 0a20 2020  t = np.sqrt(.   
+0002eee0: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+0002eef0: 7375 6d28 6e70 2e73 7175 6172 6528 7069  sum(np.square(pi
+0002ef00: 6e31 2e70 6f72 7473 5b69 6e64 7832 5d2e  n1.ports[indx2].
+0002ef10: 6d69 6470 6f69 6e74 202d 2070 6173 312e  midpoint - pas1.
+0002ef20: 706f 7274 735b 224e 225d 2e6d 6964 706f  ports["N"].midpo
+0002ef30: 696e 7429 290a 2020 2020 2020 2020 2020  int)).          
+0002ef40: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0002ef50: 7465 6d70 6320 3d20 4474 656d 702e 6164  tempc = Dtemp.ad
+0002ef60: 645f 7265 6628 0a20 2020 2020 2020 2020  d_ref(.         
+0002ef70: 2020 2020 2020 2063 6f6d 7061 7373 2873         compass(s
+0002ef80: 697a 653d 2870 696e 312e 706f 7274 735b  ize=(pin1.ports[
+0002ef90: 696e 6478 325d 2e77 6964 7468 2c20 636f  indx2].width, co
+0002efa0: 6d70 6469 7374 292c 206c 6179 6572 3d6c  mpdist), layer=l
+0002efb0: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
+0002efc0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0002efd0: 7465 6d70 632e 636f 6e6e 6563 7428 224e  tempc.connect("N
+0002efe0: 222c 2070 696e 312e 706f 7274 735b 696e  ", pin1.ports[in
+0002eff0: 6478 325d 290a 0a20 2020 2020 2020 2044  dx2])..        D
+0002f000: 7465 6d70 2e61 6464 5f70 6f72 7428 0a20  temp.add_port(. 
+0002f010: 2020 2020 2020 2020 2020 206e 616d 653d             name=
+0002f020: 312c 0a20 2020 2020 2020 2020 2020 206d  1,.            m
+0002f030: 6964 706f 696e 743d 6172 6331 2e70 6f72  idpoint=arc1.por
+0002f040: 7473 5b31 5d2e 6d69 6470 6f69 6e74 2c0a  ts[1].midpoint,.
+0002f050: 2020 2020 2020 2020 2020 2020 7769 6474              widt
+0002f060: 683d 7769 7265 5f77 6964 7468 2c0a 2020  h=wire_width,.  
+0002f070: 2020 2020 2020 2020 2020 6f72 6965 6e74            orient
+0002f080: 6174 696f 6e3d 6172 6331 2e70 6f72 7473  ation=arc1.ports
+0002f090: 5b31 5d2e 6f72 6965 6e74 6174 696f 6e2c  [1].orientation,
+0002f0a0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0002f0b0: 2020 2044 7465 6d70 2e61 6464 5f70 6f72     Dtemp.add_por
+0002f0c0: 7428 0a20 2020 2020 2020 2020 2020 206e  t(.            n
+0002f0d0: 616d 653d 322c 0a20 2020 2020 2020 2020  ame=2,.         
+0002f0e0: 2020 206d 6964 706f 696e 743d 6172 6332     midpoint=arc2
+0002f0f0: 2e70 6f72 7473 5b31 5d2e 6d69 6470 6f69  .ports[1].midpoi
+0002f100: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
+0002f110: 7769 6474 683d 7769 7265 5f77 6964 7468  width=wire_width
+0002f120: 2c0a 2020 2020 2020 2020 2020 2020 6f72  ,.            or
+0002f130: 6965 6e74 6174 696f 6e3d 6172 6332 2e70  ientation=arc2.p
+0002f140: 6f72 7473 5b31 5d2e 6f72 6965 6e74 6174  orts[1].orientat
+0002f150: 696f 6e2c 0a20 2020 2020 2020 2029 0a0a  ion,.        )..
+0002f160: 2020 2020 2020 2020 7265 7475 726e 2044          return D
+0002f170: 7465 6d70 0a0a 2020 2020 4420 3d20 4465  temp..    D = De
+0002f180: 7669 6365 286e 616d 653d 2273 6e73 7064  vice(name="snspd
+0002f190: 5f63 616e 6465 6c61 6272 6122 290a 2020  _candelabra").  
+0002f1a0: 2020 6966 2078 7769 6e67 3a0a 2020 2020    if xwing:.    
+0002f1b0: 2020 2020 4474 656d 7020 3d20 7877 696e      Dtemp = xwin
+0002f1c0: 675f 7574 7572 6e28 7769 7265 5f77 6964  g_uturn(wire_wid
+0002f1d0: 7468 3d77 6972 655f 7769 6474 682c 2077  th=wire_width, w
+0002f1e0: 6972 655f 7069 7463 683d 7769 7265 5f70  ire_pitch=wire_p
+0002f1f0: 6974 6368 2c20 6c61 7965 723d 6c61 7965  itch, layer=laye
+0002f200: 7229 0a20 2020 2065 6c73 653a 0a20 2020  r).    else:.   
+0002f210: 2020 2020 2044 7465 6d70 203d 206f 6666       Dtemp = off
+0002f220: 5f61 7869 735f 7574 7572 6e28 0a20 2020  _axis_uturn(.   
+0002f230: 2020 2020 2020 2020 2077 6972 655f 7769           wire_wi
+0002f240: 6474 683d 7769 7265 5f77 6964 7468 2c20  dth=wire_width, 
+0002f250: 7769 7265 5f70 6974 6368 3d77 6972 655f  wire_pitch=wire_
+0002f260: 7069 7463 682c 206c 6179 6572 3d6c 6179  pitch, layer=lay
+0002f270: 6572 0a20 2020 2020 2020 2029 0a20 2020  er.        ).   
+0002f280: 2044 7465 6d70 5f6d 6972 726f 7265 6420   Dtemp_mirrored 
+0002f290: 3d20 6465 6570 636f 7079 2844 7465 6d70  = deepcopy(Dtemp
+0002f2a0: 292e 6d69 7272 6f72 285b 302c 2030 5d2c  ).mirror([0, 0],
+0002f2b0: 205b 302c 2031 5d29 0a20 2020 2070 6164   [0, 1]).    pad
+0002f2c0: 6469 6e67 203d 2044 7465 6d70 2e78 7369  ding = Dtemp.xsi
+0002f2d0: 7a65 0a20 2020 206d 6178 6c6c 203d 2068  ze.    maxll = h
+0002f2e0: 6178 6973 202d 2032 202a 2070 6164 6469  axis - 2 * paddi
+0002f2f0: 6e67 0a20 2020 2064 6c6c 203d 2061 6273  ng.    dll = abs
+0002f300: 2844 7465 6d70 2e70 6f72 7473 5b31 5d2e  (Dtemp.ports[1].
+0002f310: 7820 2d20 4474 656d 702e 706f 7274 735b  x - Dtemp.ports[
+0002f320: 325d 2e78 2920 2b20 7769 7265 5f70 6974  2].x) + wire_pit
+0002f330: 6368 0a20 2020 2068 616c 665f 6e75 6d5f  ch.    half_num_
+0002f340: 6d65 616e 6465 7273 203d 2069 6e74 286e  meanders = int(n
+0002f350: 702e 6365 696c 2830 2e35 202a 2076 6178  p.ceil(0.5 * vax
+0002f360: 6973 202f 2077 6972 655f 7069 7463 6829  is / wire_pitch)
+0002f370: 2920 2b20 320a 0a20 2020 2069 6620 7877  ) + 2..    if xw
+0002f380: 696e 673a 0a20 2020 2020 2020 2062 656e  ing:.        ben
+0002f390: 6420 3d20 442e 6164 645f 7265 6628 0a20  d = D.add_ref(. 
+0002f3a0: 2020 2020 2020 2020 2020 2061 7263 2872             arc(r
+0002f3b0: 6164 6975 733d 7769 7265 5f77 6964 7468  adius=wire_width
+0002f3c0: 202a 2033 2c20 7769 6474 683d 7769 7265   * 3, width=wire
+0002f3d0: 5f77 6964 7468 2c20 7468 6574 613d 3930  _width, theta=90
+0002f3e0: 2c20 6c61 7965 723d 6c61 7965 7229 0a20  , layer=layer). 
+0002f3f0: 2020 2020 2020 2029 2e72 6f74 6174 6528         ).rotate(
+0002f400: 3138 3029 0a20 2020 2065 6c73 653a 0a20  180).    else:. 
+0002f410: 2020 2020 2020 2062 656e 6420 3d20 442e         bend = D.
+0002f420: 6164 645f 7265 6628 6f70 7469 6d61 6c5f  add_ref(optimal_
+0002f430: 3930 6465 6728 7769 6474 683d 7769 7265  90deg(width=wire
+0002f440: 5f77 6964 7468 2c20 6c61 7965 723d 6c61  _width, layer=la
+0002f450: 7965 7229 290a 2020 2020 6966 2028 6d61  yer)).    if (ma
+0002f460: 786c 6c20 2d20 646c 6c20 2a20 6861 6c66  xll - dll * half
+0002f470: 5f6e 756d 5f6d 6561 6e64 6572 7329 203c  _num_meanders) <
+0002f480: 3d20 302e 303a 0a20 2020 2020 2020 2077  = 0.0:.        w
+0002f490: 6869 6c65 2028 6d61 786c 6c20 2d20 646c  hile (maxll - dl
+0002f4a0: 6c20 2a20 6861 6c66 5f6e 756d 5f6d 6561  l * half_num_mea
+0002f4b0: 6e64 6572 7329 203c 3d20 302e 303a 0a20  nders) <= 0.0:. 
+0002f4c0: 2020 2020 2020 2020 2020 2068 616c 665f             half_
+0002f4d0: 6e75 6d5f 6d65 616e 6465 7273 203d 2068  num_meanders = h
+0002f4e0: 616c 665f 6e75 6d5f 6d65 616e 6465 7273  alf_num_meanders
+0002f4f0: 202d 2031 0a20 2020 2066 7061 7320 3d20   - 1.    fpas = 
+0002f500: 442e 6164 645f 7265 6628 0a20 2020 2020  D.add_ref(.     
+0002f510: 2020 2063 6f6d 7061 7373 2873 697a 653d     compass(size=
+0002f520: 2830 2e35 202a 2028 6d61 786c 6c20 2d20  (0.5 * (maxll - 
+0002f530: 646c 6c20 2a20 6861 6c66 5f6e 756d 5f6d  dll * half_num_m
+0002f540: 6561 6e64 6572 7329 2c20 7769 7265 5f77  eanders), wire_w
+0002f550: 6964 7468 292c 206c 6179 6572 3d6c 6179  idth), layer=lay
+0002f560: 6572 290a 2020 2020 290a 2020 2020 442e  er).    ).    D.
+0002f570: 6d6f 7665 7828 2d62 656e 642e 706f 7274  movex(-bend.port
+0002f580: 735b 315d 2e78 290a 2020 2020 6670 6173  s[1].x).    fpas
+0002f590: 2e63 6f6e 6e65 6374 2866 7061 732e 706f  .connect(fpas.po
+0002f5a0: 7274 735b 2257 225d 2c20 6265 6e64 2e70  rts["W"], bend.p
+0002f5b0: 6f72 7473 5b32 5d29 0a20 2020 206c 6c20  orts[2]).    ll 
+0002f5c0: 3d20 442e 7873 697a 6520 2a20 3220 2d20  = D.xsize * 2 - 
+0002f5d0: 7769 7265 5f77 6964 7468 0a20 2020 2069  wire_width.    i
+0002f5e0: 6620 6571 7561 6c69 7a65 5f70 6174 685f  f equalize_path_
+0002f5f0: 6c65 6e67 7468 733a 0a20 2020 2020 2020  lengths:.       
+0002f600: 2069 6620 7877 696e 673a 0a20 2020 2020   if xwing:.     
+0002f610: 2020 2020 2020 2044 7465 6d70 203d 2078         Dtemp = x
+0002f620: 7769 6e67 5f75 7475 726e 280a 2020 2020  wing_uturn(.    
+0002f630: 2020 2020 2020 2020 2020 2020 7769 7265              wire
+0002f640: 5f77 6964 7468 3d77 6972 655f 7769 6474  _width=wire_widt
+0002f650: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
+0002f660: 2020 2077 6972 655f 7069 7463 683d 7769     wire_pitch=wi
+0002f670: 7265 5f70 6974 6368 2c0a 2020 2020 2020  re_pitch,.      
+0002f680: 2020 2020 2020 2020 2020 7061 645f 6c65            pad_le
+0002f690: 6e67 7468 3d28 6d61 786c 6c20 2d20 6c6c  ngth=(maxll - ll
+0002f6a0: 202d 2064 6c6c 2920 2a20 6571 7561 6c69   - dll) * equali
+0002f6b0: 7a65 5f70 6174 685f 6c65 6e67 7468 732c  ze_path_lengths,
+0002f6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f6d0: 206c 6179 6572 3d6c 6179 6572 2c0a 2020   layer=layer,.  
+0002f6e0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0002f6f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0002f700: 2020 2020 2020 4474 656d 7020 3d20 6f66        Dtemp = of
+0002f710: 665f 6178 6973 5f75 7475 726e 280a 2020  f_axis_uturn(.  
+0002f720: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+0002f730: 7265 5f77 6964 7468 3d77 6972 655f 7769  re_width=wire_wi
+0002f740: 6474 682c 0a20 2020 2020 2020 2020 2020  dth,.           
+0002f750: 2020 2020 2077 6972 655f 7069 7463 683d       wire_pitch=
+0002f760: 7769 7265 5f70 6974 6368 2c0a 2020 2020  wire_pitch,.    
+0002f770: 2020 2020 2020 2020 2020 2020 7061 645f              pad_
+0002f780: 6c65 6e67 7468 3d28 6d61 786c 6c20 2d20  length=(maxll - 
+0002f790: 6c6c 202d 2064 6c6c 2920 2a20 6571 7561  ll - dll) * equa
+0002f7a0: 6c69 7a65 5f70 6174 685f 6c65 6e67 7468  lize_path_length
+0002f7b0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0002f7c0: 2020 206c 6179 6572 3d6c 6179 6572 2c0a     layer=layer,.
+0002f7d0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0002f7e0: 2020 7574 7572 6e20 3d20 442e 6164 645f    uturn = D.add_
+0002f7f0: 7265 6628 4474 656d 7029 0a20 2020 2075  ref(Dtemp).    u
+0002f800: 7475 726e 2e63 6f6e 6e65 6374 2831 2c20  turn.connect(1, 
+0002f810: 6670 6173 2e70 6f72 7473 5b22 4522 5d29  fpas.ports["E"])
+0002f820: 0a20 2020 2064 6972 5f6c 6566 7420 3d20  .    dir_left = 
+0002f830: 5472 7565 0a0a 2020 2020 7475 726e 5f70  True..    turn_p
+0002f840: 6164 6469 6e67 203d 206d 6178 6c6c 202d  adding = maxll -
+0002f850: 206c 6c20 2d20 3220 2a20 646c 6c0a 0a20   ll - 2 * dll.. 
+0002f860: 2020 2077 6869 6c65 206c 6c20 3c20 6d61     while ll < ma
+0002f870: 786c 6c20 2d20 646c 6c3a 0a20 2020 2020  xll - dll:.     
+0002f880: 2020 206c 6c20 3d20 6c6c 202b 2064 6c6c     ll = ll + dll
+0002f890: 0a20 2020 2020 2020 2069 6620 6571 7561  .        if equa
+0002f8a0: 6c69 7a65 5f70 6174 685f 6c65 6e67 7468  lize_path_length
+0002f8b0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
+0002f8c0: 6620 7877 696e 673a 0a20 2020 2020 2020  f xwing:.       
+0002f8d0: 2020 2020 2020 2020 2044 7465 6d70 203d           Dtemp =
+0002f8e0: 2078 7769 6e67 5f75 7475 726e 280a 2020   xwing_uturn(.  
+0002f8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f900: 2020 7769 7265 5f77 6964 7468 3d77 6972    wire_width=wir
+0002f910: 655f 7769 6474 682c 0a20 2020 2020 2020  e_width,.       
+0002f920: 2020 2020 2020 2020 2020 2020 2077 6972               wir
+0002f930: 655f 7069 7463 683d 7769 7265 5f70 6974  e_pitch=wire_pit
+0002f940: 6368 2c0a 2020 2020 2020 2020 2020 2020  ch,.            
+0002f950: 2020 2020 2020 2020 7061 645f 6c65 6e67          pad_leng
+0002f960: 7468 3d74 7572 6e5f 7061 6464 696e 6720  th=turn_padding 
+0002f970: 2a20 6571 7561 6c69 7a65 5f70 6174 685f  * equalize_path_
+0002f980: 6c65 6e67 7468 732c 0a20 2020 2020 2020  lengths,.       
+0002f990: 2020 2020 2020 2020 2020 2020 206c 6179               lay
+0002f9a0: 6572 3d6c 6179 6572 2c0a 2020 2020 2020  er=layer,.      
+0002f9b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0002f9c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002f9d0: 2020 2020 2020 2020 2020 2020 2020 4474                Dt
+0002f9e0: 656d 7020 3d20 6f66 665f 6178 6973 5f75  emp = off_axis_u
+0002f9f0: 7475 726e 280a 2020 2020 2020 2020 2020  turn(.          
+0002fa00: 2020 2020 2020 2020 2020 7769 7265 5f77            wire_w
+0002fa10: 6964 7468 3d77 6972 655f 7769 6474 682c  idth=wire_width,
+0002fa20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002fa30: 2020 2020 2077 6972 655f 7069 7463 683d       wire_pitch=
+0002fa40: 7769 7265 5f70 6974 6368 2c0a 2020 2020  wire_pitch,.    
+0002fa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fa60: 7061 645f 6c65 6e67 7468 3d74 7572 6e5f  pad_length=turn_
+0002fa70: 7061 6464 696e 6720 2a20 6571 7561 6c69  padding * equali
+0002fa80: 7a65 5f70 6174 685f 6c65 6e67 7468 732c  ze_path_lengths,
+0002fa90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002faa0: 2020 2020 206c 6179 6572 3d6c 6179 6572       layer=layer
+0002fab0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002fac0: 2020 290a 2020 2020 2020 2020 7475 726e    ).        turn
+0002fad0: 5f70 6164 6469 6e67 203d 2074 7572 6e5f  _padding = turn_
+0002fae0: 7061 6464 696e 6720 2d20 646c 6c0a 2020  padding - dll.  
+0002faf0: 2020 2020 2020 6e65 7770 6173 203d 2044        newpas = D
+0002fb00: 2e61 6464 5f72 6566 2863 6f6d 7061 7373  .add_ref(compass
+0002fb10: 2873 697a 653d 286c 6c2c 2077 6972 655f  (size=(ll, wire_
+0002fb20: 7769 6474 6829 2c20 6c61 7965 723d 6c61  width), layer=la
+0002fb30: 7965 7229 290a 2020 2020 2020 2020 6966  yer)).        if
+0002fb40: 2064 6972 5f6c 6566 743a 0a20 2020 2020   dir_left:.     
+0002fb50: 2020 2020 2020 206e 6577 7061 732e 636f         newpas.co
+0002fb60: 6e6e 6563 7428 6e65 7770 6173 2e70 6f72  nnect(newpas.por
+0002fb70: 7473 5b22 4522 5d2c 2075 7475 726e 2e70  ts["E"], uturn.p
+0002fb80: 6f72 7473 5b32 5d29 0a20 2020 2020 2020  orts[2]).       
+0002fb90: 2020 2020 2069 6620 6571 7561 6c69 7a65       if equalize
+0002fba0: 5f70 6174 685f 6c65 6e67 7468 733a 0a20  _path_lengths:. 
+0002fbb0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+0002fbc0: 7475 726e 203d 2044 2e61 6464 5f72 6566  turn = D.add_ref
+0002fbd0: 2844 7465 6d70 2e6d 6972 726f 7228 5b30  (Dtemp.mirror([0
+0002fbe0: 2c20 305d 2c20 5b30 2c20 315d 2929 0a20  , 0], [0, 1])). 
+0002fbf0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0002fc00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002fc10: 2075 7475 726e 203d 2044 2e61 6464 5f72   uturn = D.add_r
+0002fc20: 6566 2844 7465 6d70 5f6d 6972 726f 7265  ef(Dtemp_mirrore
+0002fc30: 6429 0a20 2020 2020 2020 2020 2020 2075  d).            u
+0002fc40: 7475 726e 2e63 6f6e 6e65 6374 2831 2c20  turn.connect(1, 
+0002fc50: 6e65 7770 6173 2e70 6f72 7473 5b22 5722  newpas.ports["W"
+0002fc60: 5d29 0a20 2020 2020 2020 2020 2020 2064  ]).            d
+0002fc70: 6972 5f6c 6566 7420 3d20 4661 6c73 650a  ir_left = False.
+0002fc80: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002fc90: 2020 2020 2020 2020 2020 6e65 7770 6173            newpas
+0002fca0: 2e63 6f6e 6e65 6374 286e 6577 7061 732e  .connect(newpas.
+0002fcb0: 706f 7274 735b 2257 225d 2c20 7574 7572  ports["W"], utur
+0002fcc0: 6e2e 706f 7274 735b 325d 290a 2020 2020  n.ports[2]).    
+0002fcd0: 2020 2020 2020 2020 7574 7572 6e20 3d20          uturn = 
+0002fce0: 442e 6164 645f 7265 6628 4474 656d 7029  D.add_ref(Dtemp)
+0002fcf0: 0a20 2020 2020 2020 2020 2020 2075 7475  .            utu
+0002fd00: 726e 2e63 6f6e 6e65 6374 2831 2c20 6e65  rn.connect(1, ne
+0002fd10: 7770 6173 2e70 6f72 7473 5b22 4522 5d29  wpas.ports["E"])
+0002fd20: 0a20 2020 2020 2020 2020 2020 2064 6972  .            dir
+0002fd30: 5f6c 6566 7420 3d20 5472 7565 0a0a 2020  _left = True..  
+0002fd40: 2020 6e65 7770 6173 203d 2044 2e61 6464    newpas = D.add
+0002fd50: 5f72 6566 2863 6f6d 7061 7373 2873 697a  _ref(compass(siz
+0002fd60: 653d 286c 6c20 2f20 322c 2077 6972 655f  e=(ll / 2, wire_
+0002fd70: 7769 6474 6829 2c20 6c61 7965 723d 6c61  width), layer=la
+0002fd80: 7965 7229 290a 2020 2020 6966 2064 6972  yer)).    if dir
+0002fd90: 5f6c 6566 743a 0a20 2020 2020 2020 206e  _left:.        n
+0002fda0: 6577 7061 732e 636f 6e6e 6563 7428 6e65  ewpas.connect(ne
+0002fdb0: 7770 6173 2e70 6f72 7473 5b22 4522 5d2c  wpas.ports["E"],
+0002fdc0: 2075 7475 726e 2e70 6f72 7473 5b32 5d29   uturn.ports[2])
+0002fdd0: 0a20 2020 2020 2020 2064 6972 5f6c 6566  .        dir_lef
+0002fde0: 7420 3d20 4661 6c73 650a 2020 2020 656c  t = False.    el
+0002fdf0: 7365 3a0a 2020 2020 2020 2020 6e65 7770  se:.        newp
+0002fe00: 6173 2e63 6f6e 6e65 6374 286e 6577 7061  as.connect(newpa
+0002fe10: 732e 706f 7274 735b 2257 225d 2c20 7574  s.ports["W"], ut
+0002fe20: 7572 6e2e 706f 7274 735b 325d 290a 2020  urn.ports[2]).  
+0002fe30: 2020 2020 2020 6469 725f 6c65 6674 203d        dir_left =
+0002fe40: 2054 7275 650a 0a20 2020 2044 2e6d 6f76   True..    D.mov
+0002fe50: 6578 282d 442e 7829 0a20 2020 2069 6620  ex(-D.x).    if 
+0002fe60: 6e6f 7420 7877 696e 673a 0a20 2020 2020  not xwing:.     
+0002fe70: 2020 2062 656e 642e 6d6f 7665 7828 2d62     bend.movex(-b
+0002fe80: 656e 642e 706f 7274 735b 315d 2e78 290a  end.ports[1].x).
+0002fe90: 2020 2020 6966 2028 6670 6173 2e70 6f72      if (fpas.por
+0002fea0: 7473 5b22 5722 5d2e 7820 2d20 6265 6e64  ts["W"].x - bend
+0002feb0: 2e70 6f72 7473 5b32 5d2e 7829 203e 2030  .ports[2].x) > 0
+0002fec0: 3a0a 2020 2020 2020 2020 7465 6d70 6320  :.        tempc 
+0002fed0: 3d20 442e 6164 645f 7265 6628 0a20 2020  = D.add_ref(.   
+0002fee0: 2020 2020 2020 2020 2063 6f6d 7061 7373           compass
+0002fef0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0002ff00: 2020 7369 7a65 3d28 6670 6173 2e70 6f72    size=(fpas.por
+0002ff10: 7473 5b22 5722 5d2e 7820 2d20 6265 6e64  ts["W"].x - bend
+0002ff20: 2e70 6f72 7473 5b32 5d2e 782c 2062 656e  .ports[2].x, ben
+0002ff30: 642e 706f 7274 735b 325d 2e77 6964 7468  d.ports[2].width
+0002ff40: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0002ff50: 2020 206c 6179 6572 3d6c 6179 6572 2c0a     layer=layer,.
+0002ff60: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0002ff70: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0002ff80: 7465 6d70 632e 636f 6e6e 6563 7428 2245  tempc.connect("E
+0002ff90: 222c 2066 7061 732e 706f 7274 735b 2257  ", fpas.ports["W
+0002ffa0: 225d 290a 2020 2020 442e 6d6f 7665 285b  "]).    D.move([
+0002ffb0: 2d44 2e78 2c20 2d44 2e79 6d69 6e20 2d20  -D.x, -D.ymin - 
+0002ffc0: 7769 7265 5f77 6964 7468 202a 2030 2e35  wire_width * 0.5
+0002ffd0: 5d29 0a20 2020 2044 2e61 6464 5f70 6f72  ]).    D.add_por
+0002ffe0: 7428 6e61 6d65 3d31 2c20 706f 7274 3d62  t(name=1, port=b
+0002fff0: 656e 642e 706f 7274 735b 315d 290a 2020  end.ports[1]).  
+00030000: 2020 6966 2064 6972 5f6c 6566 743a 0a20    if dir_left:. 
+00030010: 2020 2020 2020 2044 2e61 6464 5f70 6f72         D.add_por
+00030020: 7428 6e61 6d65 3d32 2c20 706f 7274 3d6e  t(name=2, port=n
+00030030: 6577 7061 732e 706f 7274 735b 2245 225d  ewpas.ports["E"]
+00030040: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
+00030050: 2020 2020 442e 6164 645f 706f 7274 286e      D.add_port(n
+00030060: 616d 653d 322c 2070 6f72 743d 6e65 7770  ame=2, port=newp
+00030070: 6173 2e70 6f72 7473 5b22 5722 5d29 0a0a  as.ports["W"])..
+00030080: 2020 2020 446f 7574 203d 2044 6576 6963      Dout = Devic
+00030090: 6528 290a 2020 2020 4431 203d 2044 6f75  e().    D1 = Dou
+000300a0: 742e 6164 645f 7265 6628 4429 0a20 2020  t.add_ref(D).   
+000300b0: 2044 3220 3d20 446f 7574 2e61 6464 5f72   D2 = Dout.add_r
+000300c0: 6566 2863 6f70 7928 4429 2e72 6f74 6174  ef(copy(D).rotat
+000300d0: 6528 3138 3029 290a 2020 2020 7465 6d70  e(180)).    temp
+000300e0: 6320 3d20 446f 7574 2e61 6464 5f72 6566  c = Dout.add_ref
+000300f0: 280a 2020 2020 2020 2020 636f 6d70 6173  (.        compas
+00030100: 7328 0a20 2020 2020 2020 2020 2020 2073  s(.            s
+00030110: 697a 653d 2861 6273 2844 312e 706f 7274  ize=(abs(D1.port
+00030120: 735b 325d 2e78 202d 2044 322e 706f 7274  s[2].x - D2.port
+00030130: 735b 325d 2e78 292c 2044 312e 706f 7274  s[2].x), D1.port
+00030140: 735b 325d 2e77 6964 7468 292c 206c 6179  s[2].width), lay
+00030150: 6572 3d6c 6179 6572 0a20 2020 2020 2020  er=layer.       
+00030160: 2029 0a20 2020 2029 0a20 2020 2069 6620   ).    ).    if 
+00030170: 4431 2e70 6f72 7473 5b32 5d2e 7820 3e20  D1.ports[2].x > 
+00030180: 4432 2e70 6f72 7473 5b32 5d2e 783a 0a20  D2.ports[2].x:. 
+00030190: 2020 2020 2020 2074 656d 7063 2e63 6f6e         tempc.con
+000301a0: 6e65 6374 2822 4522 2c20 4431 2e70 6f72  nect("E", D1.por
+000301b0: 7473 5b32 5d29 0a20 2020 2065 6c73 653a  ts[2]).    else:
+000301c0: 0a20 2020 2020 2020 2074 656d 7063 2e63  .        tempc.c
+000301d0: 6f6e 6e65 6374 2822 5722 2c20 4431 2e70  onnect("W", D1.p
+000301e0: 6f72 7473 5b32 5d29 0a20 2020 2044 6f75  orts[2]).    Dou
+000301f0: 742e 6164 645f 706f 7274 286e 616d 653d  t.add_port(name=
+00030200: 312c 2070 6f72 743d 4431 2e70 6f72 7473  1, port=D1.ports
+00030210: 5b31 5d29 0a20 2020 2044 6f75 742e 6164  [1]).    Dout.ad
+00030220: 645f 706f 7274 286e 616d 653d 322c 2070  d_port(name=2, p
+00030230: 6f72 743d 4432 2e70 6f72 7473 5b31 5d29  ort=D2.ports[1])
+00030240: 0a20 2020 2072 6574 7572 6e20 446f 7574  .    return Dout
+00030250: 0a0a 0a64 6566 2079 7472 6f6e 5f72 6f75  ...def ytron_rou
+00030260: 6e64 280a 2020 2020 7268 6f3d 312c 0a20  nd(.    rho=1,. 
+00030270: 2020 2061 726d 5f6c 656e 6774 6873 3d28     arm_lengths=(
+00030280: 3530 302c 2033 3030 292c 0a20 2020 2073  500, 300),.    s
+00030290: 6f75 7263 655f 6c65 6e67 7468 3d35 3030  ource_length=500
+000302a0: 2c0a 2020 2020 6172 6d5f 7769 6474 6873  ,.    arm_widths
+000302b0: 3d28 3230 302c 2032 3030 292c 0a20 2020  =(200, 200),.   
+000302c0: 2074 6865 7461 3d32 2e35 2c0a 2020 2020   theta=2.5,.    
+000302d0: 7468 6574 615f 7265 736f 6c75 7469 6f6e  theta_resolution
+000302e0: 3d31 302c 0a20 2020 206c 6179 6572 3d30  =10,.    layer=0
+000302f0: 2c0a 293a 0a20 2020 2022 2222 5974 726f  ,.):.    """Ytro
+00030300: 6e20 7374 7275 6374 7572 6520 666f 7220  n structure for 
+00030310: 7375 7065 7263 6f6e 6475 6374 696e 6720  superconducting 
+00030320: 6e61 6e6f 7769 7265 730a 0a20 2020 204d  nanowires..    M
+00030330: 6343 6175 6768 616e 2c20 412e 204e 2e2c  cCaughan, A. N.,
+00030340: 2041 6265 6265 2c20 4e2e 2053 2e2c 205a   Abebe, N. S., Z
+00030350: 6861 6f2c 2051 2e2d 592e 2026 2042 6572  hao, Q.-Y. & Ber
+00030360: 6767 7265 6e2c 204b 2e20 4b2e 0a20 2020  ggren, K. K..   
+00030370: 2055 7369 6e67 2047 656f 6d65 7472 7920   Using Geometry 
+00030380: 546f 2053 656e 7365 2043 7572 7265 6e74  To Sense Current
+00030390: 2e20 4e61 6e6f 204c 6574 742e 2031 362c  . Nano Lett. 16,
+000303a0: 2037 3632 36e2 8093 3736 3331 2028 3230   7626...7631 (20
+000303b0: 3136 292e 0a20 2020 2068 7474 703a 2f2f  16)..    http://
+000303c0: 6478 2e64 6f69 2e6f 7267 2f31 302e 3130  dx.doi.org/10.10
+000303d0: 3231 2f61 6373 2e6e 616e 6f6c 6574 742e  21/acs.nanolett.
+000303e0: 3662 3033 3539 330a 0a20 2020 2050 6172  6b03593..    Par
+000303f0: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+00030400: 2d2d 2d2d 2d2d 0a20 2020 2072 686f 203a  ------.    rho :
+00030410: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
+00030420: 2020 2020 2020 5261 6469 7573 206f 6620        Radius of 
+00030430: 6375 7276 6174 7572 6520 6f66 2079 7472  curvature of ytr
+00030440: 6f6e 2069 6e74 6572 7365 6374 696f 6e20  on intersection 
+00030450: 706f 696e 740a 2020 2020 6172 6d5f 6c65  point.    arm_le
+00030460: 6e67 7468 7320 3a20 6172 7261 792d 6c69  ngths : array-li
+00030470: 6b65 5b32 5d20 6f66 2069 6e74 206f 7220  ke[2] of int or 
+00030480: 666c 6f61 740a 2020 2020 2020 2020 4c65  float.        Le
+00030490: 6e67 7468 7320 6f66 2074 6865 206c 6566  ngths of the lef
+000304a0: 7420 616e 6420 7269 6768 7420 6172 6d73  t and right arms
+000304b0: 206f 6620 7468 6520 7954 726f 6e2c 2072   of the yTron, r
+000304c0: 6573 7065 6374 6976 656c 792e 0a20 2020  espectively..   
+000304d0: 2073 6f75 7263 655f 6c65 6e67 7468 203a   source_length :
+000304e0: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
+000304f0: 2020 2020 2020 4c65 6e67 7468 206f 6620        Length of 
+00030500: 7468 6520 736f 7572 6365 206f 6620 7468  the source of th
+00030510: 6520 7954 726f 6e2e 0a20 2020 2061 726d  e yTron..    arm
+00030520: 5f77 6964 7468 7320 3a20 6172 7261 792d  _widths : array-
+00030530: 6c69 6b65 5b32 5d20 6f66 2069 6e74 206f  like[2] of int o
+00030540: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
+00030550: 5769 6474 6873 206f 6620 7468 6520 6c65  Widths of the le
+00030560: 6674 2061 6e64 2072 6967 6874 2061 726d  ft and right arm
+00030570: 7320 6f66 2074 6865 2079 5472 6f6e 2c20  s of the yTron, 
+00030580: 7265 7370 6563 7469 7665 6c79 2e0a 2020  respectively..  
+00030590: 2020 7468 6574 6120 3a20 696e 7420 6f72    theta : int or
+000305a0: 2066 6c6f 6174 0a20 2020 2020 2020 2041   float.        A
+000305b0: 6e67 6c65 2062 6574 7765 656e 2074 6865  ngle between the
+000305c0: 2074 776f 2079 5472 6f6e 2061 726d 732e   two yTron arms.
+000305d0: 0a20 2020 2074 6865 7461 5f72 6573 6f6c  .    theta_resol
+000305e0: 7574 696f 6e20 3a20 696e 7420 6f72 2066  ution : int or f
+000305f0: 6c6f 6174 0a20 2020 2020 2020 2041 6e67  loat.        Ang
+00030600: 6c65 2072 6573 6f6c 7574 696f 6e20 666f  le resolution fo
+00030610: 7220 6375 7276 6174 7572 6520 6f66 2079  r curvature of y
+00030620: 7472 6f6e 2069 6e74 6572 7365 6374 696f  tron intersectio
+00030630: 6e20 706f 696e 740a 2020 2020 6c61 7965  n point.    laye
+00030640: 7220 3a20 696e 742c 2061 7272 6179 2d6c  r : int, array-l
+00030650: 696b 655b 325d 2c20 6f72 2073 6574 0a20  ike[2], or set. 
+00030660: 2020 2020 2020 2053 7065 6369 6669 6320         Specific 
+00030670: 6c61 7965 7228 7329 2074 6f20 7075 7420  layer(s) to put 
+00030680: 706f 6c79 676f 6e20 6765 6f6d 6574 7279  polygon geometry
+00030690: 206f 6e2e 0a0a 2020 2020 5265 7475 726e   on...    Return
+000306a0: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
+000306b0: 2020 4420 3a20 4465 7669 6365 0a20 2020    D : Device.   
+000306c0: 2020 2020 2041 2044 6576 6963 6520 636f       A Device co
+000306d0: 6e74 6169 6e69 6e67 2061 2079 5472 6f6e  ntaining a yTron
+000306e0: 2067 656f 6d65 7472 792e 0a20 2020 2022   geometry..    "
+000306f0: 2222 0a20 2020 2023 203d 3d3d 3d3d 3d3d  "".    # =======
+00030700: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030710: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030720: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030730: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030740: 3d3d 3d0a 2020 2020 2320 2043 7265 6174  ===.    #  Creat
+00030750: 6520 7468 6520 6261 7369 6320 6765 6f6d  e the basic geom
+00030760: 6574 7279 0a20 2020 2023 203d 3d3d 3d3d  etry.    # =====
+00030770: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030780: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030790: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000307a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000307b0: 3d3d 3d3d 3d0a 2020 2020 7468 6574 6120  =====.    theta 
+000307c0: 3d20 7468 6574 6120 2a20 7069 202f 2031  = theta * pi / 1
+000307d0: 3830 0a20 2020 2074 6865 7461 5f72 6573  80.    theta_res
+000307e0: 6f6c 7574 696f 6e20 3d20 7468 6574 615f  olution = theta_
+000307f0: 7265 736f 6c75 7469 6f6e 202a 2070 6920  resolution * pi 
+00030800: 2f20 3138 300a 2020 2020 7468 6574 616c  / 180.    thetal
+00030810: 6973 7420 3d20 6e70 2e6c 696e 7370 6163  ist = np.linspac
+00030820: 6528 0a20 2020 2020 2020 202d 2870 6920  e(.        -(pi 
+00030830: 2d20 7468 6574 6129 2c20 2d74 6865 7461  - theta), -theta
+00030840: 2c20 696e 7428 2870 6920 2d20 3220 2a20  , int((pi - 2 * 
+00030850: 7468 6574 6129 202f 2074 6865 7461 5f72  theta) / theta_r
+00030860: 6573 6f6c 7574 696f 6e29 202b 2032 0a20  esolution) + 2. 
+00030870: 2020 2029 0a20 2020 2073 656d 6963 6972     ).    semicir
+00030880: 636c 655f 7820 3d20 7268 6f20 2a20 636f  cle_x = rho * co
+00030890: 7328 7468 6574 616c 6973 7429 0a20 2020  s(thetalist).   
+000308a0: 2073 656d 6963 6972 636c 655f 7920 3d20   semicircle_y = 
+000308b0: 7268 6f20 2a20 7369 6e28 7468 6574 616c  rho * sin(thetal
+000308c0: 6973 7429 202b 2072 686f 0a0a 2020 2020  ist) + rho..    
+000308d0: 2320 5265 7374 206f 6620 7954 726f 6e0a  # Rest of yTron.
+000308e0: 2020 2020 7863 203d 2072 686f 202a 2063      xc = rho * c
+000308f0: 6f73 2874 6865 7461 290a 2020 2020 7963  os(theta).    yc
+00030900: 203d 2072 686f 202a 2073 696e 2874 6865   = rho * sin(the
+00030910: 7461 290a 2020 2020 6172 6d5f 785f 6c65  ta).    arm_x_le
+00030920: 6674 203d 2061 726d 5f6c 656e 6774 6873  ft = arm_lengths
+00030930: 5b30 5d20 2a20 7369 6e28 7468 6574 6129  [0] * sin(theta)
+00030940: 0a20 2020 2061 726d 5f79 5f6c 6566 7420  .    arm_y_left 
+00030950: 3d20 6172 6d5f 6c65 6e67 7468 735b 305d  = arm_lengths[0]
+00030960: 202a 2063 6f73 2874 6865 7461 290a 2020   * cos(theta).  
+00030970: 2020 6172 6d5f 785f 7269 6768 7420 3d20    arm_x_right = 
+00030980: 6172 6d5f 6c65 6e67 7468 735b 315d 202a  arm_lengths[1] *
+00030990: 2073 696e 2874 6865 7461 290a 2020 2020   sin(theta).    
+000309a0: 6172 6d5f 795f 7269 6768 7420 3d20 6172  arm_y_right = ar
+000309b0: 6d5f 6c65 6e67 7468 735b 315d 202a 2063  m_lengths[1] * c
+000309c0: 6f73 2874 6865 7461 290a 0a20 2020 2023  os(theta)..    #
+000309d0: 2057 7269 7465 206f 7574 2078 2061 6e64   Write out x and
+000309e0: 2079 2063 6f6f 7264 7320 666f 7220 7954   y coords for yT
+000309f0: 726f 6e20 706f 6c79 676f 6e0a 2020 2020  ron polygon.    
+00030a00: 7870 7473 203d 2073 656d 6963 6972 636c  xpts = semicircl
+00030a10: 655f 782e 746f 6c69 7374 2829 202b 205b  e_x.tolist() + [
+00030a20: 0a20 2020 2020 2020 2078 6320 2b20 6172  .        xc + ar
+00030a30: 6d5f 785f 7269 6768 742c 0a20 2020 2020  m_x_right,.     
+00030a40: 2020 2078 6320 2b20 6172 6d5f 785f 7269     xc + arm_x_ri
+00030a50: 6768 7420 2b20 6172 6d5f 7769 6474 6873  ght + arm_widths
+00030a60: 5b31 5d2c 0a20 2020 2020 2020 2078 6320  [1],.        xc 
+00030a70: 2b20 6172 6d5f 7769 6474 6873 5b31 5d2c  + arm_widths[1],
+00030a80: 0a20 2020 2020 2020 2078 6320 2b20 6172  .        xc + ar
+00030a90: 6d5f 7769 6474 6873 5b31 5d2c 0a20 2020  m_widths[1],.   
+00030aa0: 2020 2020 2030 2c0a 2020 2020 2020 2020       0,.        
+00030ab0: 2d28 7863 202b 2061 726d 5f77 6964 7468  -(xc + arm_width
+00030ac0: 735b 305d 292c 0a20 2020 2020 2020 202d  s[0]),.        -
+00030ad0: 2878 6320 2b20 6172 6d5f 7769 6474 6873  (xc + arm_widths
+00030ae0: 5b30 5d29 2c0a 2020 2020 2020 2020 2d28  [0]),.        -(
+00030af0: 7863 202b 2061 726d 5f78 5f6c 6566 7420  xc + arm_x_left 
+00030b00: 2b20 6172 6d5f 7769 6474 6873 5b30 5d29  + arm_widths[0])
+00030b10: 2c0a 2020 2020 2020 2020 2d28 7863 202b  ,.        -(xc +
+00030b20: 2061 726d 5f78 5f6c 6566 7429 2c0a 2020   arm_x_left),.  
+00030b30: 2020 5d0a 2020 2020 7970 7473 203d 2073    ].    ypts = s
+00030b40: 656d 6963 6972 636c 655f 792e 746f 6c69  emicircle_y.toli
+00030b50: 7374 2829 202b 205b 0a20 2020 2020 2020  st() + [.       
+00030b60: 2079 6320 2b20 6172 6d5f 795f 7269 6768   yc + arm_y_righ
+00030b70: 742c 0a20 2020 2020 2020 2079 6320 2b20  t,.        yc + 
+00030b80: 6172 6d5f 795f 7269 6768 742c 0a20 2020  arm_y_right,.   
+00030b90: 2020 2020 2079 632c 0a20 2020 2020 2020       yc,.       
+00030ba0: 2079 6320 2d20 736f 7572 6365 5f6c 656e   yc - source_len
+00030bb0: 6774 682c 0a20 2020 2020 2020 2079 6320  gth,.        yc 
+00030bc0: 2d20 736f 7572 6365 5f6c 656e 6774 682c  - source_length,
+00030bd0: 0a20 2020 2020 2020 2079 6320 2d20 736f  .        yc - so
+00030be0: 7572 6365 5f6c 656e 6774 682c 0a20 2020  urce_length,.   
+00030bf0: 2020 2020 2079 632c 0a20 2020 2020 2020       yc,.       
+00030c00: 2079 6320 2b20 6172 6d5f 795f 6c65 6674   yc + arm_y_left
+00030c10: 2c0a 2020 2020 2020 2020 7963 202b 2061  ,.        yc + a
+00030c20: 726d 5f79 5f6c 6566 742c 0a20 2020 205d  rm_y_left,.    ]
+00030c30: 0a0a 2020 2020 2320 3d3d 3d3d 3d3d 3d3d  ..    # ========
+00030c40: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030c50: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030c60: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030c70: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030c80: 3d3d 0a20 2020 2023 2020 4372 6561 7465  ==.    #  Create
+00030c90: 2061 2062 6c61 6e6b 2064 6576 6963 652c   a blank device,
+00030ca0: 2061 6464 2074 6865 2067 656f 6d65 7472   add the geometr
+00030cb0: 792c 2061 6e64 2064 6566 696e 6520 7468  y, and define th
+00030cc0: 6520 706f 7274 730a 2020 2020 2320 3d3d  e ports.    # ==
+00030cd0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030ce0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030cf0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030d00: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030d10: 3d3d 3d3d 3d3d 3d3d 0a20 2020 2044 203d  ========.    D =
+00030d20: 2044 6576 6963 6528 6e61 6d65 3d22 7974   Device(name="yt
+00030d30: 726f 6e22 290a 2020 2020 442e 6164 645f  ron").    D.add_
+00030d40: 706f 6c79 676f 6e28 5b78 7074 732c 2079  polygon([xpts, y
+00030d50: 7074 735d 2c20 6c61 7965 723d 6c61 7965  pts], layer=laye
+00030d60: 7229 0a20 2020 2044 2e61 6464 5f70 6f72  r).    D.add_por
+00030d70: 7428 0a20 2020 2020 2020 206e 616d 653d  t(.        name=
+00030d80: 226c 6566 7422 2c0a 2020 2020 2020 2020  "left",.        
+00030d90: 6d69 6470 6f69 6e74 3d5b 2d28 7863 202b  midpoint=[-(xc +
+00030da0: 2061 726d 5f78 5f6c 6566 7420 2b20 6172   arm_x_left + ar
+00030db0: 6d5f 7769 6474 6873 5b30 5d20 2f20 3229  m_widths[0] / 2)
+00030dc0: 2c20 7963 202b 2061 726d 5f79 5f6c 6566  , yc + arm_y_lef
+00030dd0: 745d 2c0a 2020 2020 2020 2020 7769 6474  t],.        widt
+00030de0: 683d 6172 6d5f 7769 6474 6873 5b30 5d2c  h=arm_widths[0],
+00030df0: 0a20 2020 2020 2020 206f 7269 656e 7461  .        orienta
+00030e00: 7469 6f6e 3d39 302c 0a20 2020 2029 0a20  tion=90,.    ). 
+00030e10: 2020 2044 2e61 6464 5f70 6f72 7428 0a20     D.add_port(. 
+00030e20: 2020 2020 2020 206e 616d 653d 2272 6967         name="rig
+00030e30: 6874 222c 0a20 2020 2020 2020 206d 6964  ht",.        mid
+00030e40: 706f 696e 743d 5b78 6320 2b20 6172 6d5f  point=[xc + arm_
+00030e50: 785f 7269 6768 7420 2b20 6172 6d5f 7769  x_right + arm_wi
+00030e60: 6474 6873 5b31 5d20 2f20 322c 2079 6320  dths[1] / 2, yc 
+00030e70: 2b20 6172 6d5f 795f 7269 6768 745d 2c0a  + arm_y_right],.
+00030e80: 2020 2020 2020 2020 7769 6474 683d 6172          width=ar
+00030e90: 6d5f 7769 6474 6873 5b31 5d2c 0a20 2020  m_widths[1],.   
+00030ea0: 2020 2020 206f 7269 656e 7461 7469 6f6e       orientation
+00030eb0: 3d39 302c 0a20 2020 2029 0a20 2020 2044  =90,.    ).    D
+00030ec0: 2e61 6464 5f70 6f72 7428 0a20 2020 2020  .add_port(.     
+00030ed0: 2020 206e 616d 653d 2273 6f75 7263 6522     name="source"
+00030ee0: 2c0a 2020 2020 2020 2020 6d69 6470 6f69  ,.        midpoi
+00030ef0: 6e74 3d5b 3020 2b20 2861 726d 5f77 6964  nt=[0 + (arm_wid
+00030f00: 7468 735b 315d 202d 2061 726d 5f77 6964  ths[1] - arm_wid
+00030f10: 7468 735b 305d 2920 2f20 322c 202d 736f  ths[0]) / 2, -so
+00030f20: 7572 6365 5f6c 656e 6774 6820 2b20 7963  urce_length + yc
+00030f30: 5d2c 0a20 2020 2020 2020 2077 6964 7468  ],.        width
+00030f40: 3d61 726d 5f77 6964 7468 735b 305d 202b  =arm_widths[0] +
+00030f50: 2061 726d 5f77 6964 7468 735b 315d 202b   arm_widths[1] +
+00030f60: 2032 202a 2078 632c 0a20 2020 2020 2020   2 * xc,.       
+00030f70: 206f 7269 656e 7461 7469 6f6e 3d2d 3930   orientation=-90
+00030f80: 2c0a 2020 2020 290a 0a20 2020 2023 203d  ,.    )..    # =
+00030f90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030fa0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030fb0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030fc0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00030fd0: 3d3d 3d3d 3d3d 3d3d 3d0a 2020 2020 2320  =========.    # 
+00030fe0: 2052 6563 6f72 6420 616e 7920 7061 7261   Record any para
+00030ff0: 6d65 7465 7273 2079 6f75 206d 6179 2077  meters you may w
+00031000: 616e 7420 746f 2061 6363 6573 7320 6c61  ant to access la
+00031010: 7465 720a 2020 2020 2320 3d3d 3d3d 3d3d  ter.    # ======
+00031020: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00031030: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00031040: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00031050: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00031060: 3d3d 3d3d 0a20 2020 2044 2e69 6e66 6f5b  ====.    D.info[
+00031070: 2272 686f 225d 203d 2072 686f 0a20 2020  "rho"] = rho.   
+00031080: 2044 2e69 6e66 6f5b 226c 6566 745f 7769   D.info["left_wi
+00031090: 6474 6822 5d20 3d20 6172 6d5f 7769 6474  dth"] = arm_widt
+000310a0: 6873 5b30 5d0a 2020 2020 442e 696e 666f  hs[0].    D.info
+000310b0: 5b22 7269 6768 745f 7769 6474 6822 5d20  ["right_width"] 
+000310c0: 3d20 6172 6d5f 7769 6474 6873 5b31 5d0a  = arm_widths[1].
+000310d0: 2020 2020 442e 696e 666f 5b22 736f 7572      D.info["sour
+000310e0: 6365 5f77 6964 7468 225d 203d 2061 726d  ce_width"] = arm
+000310f0: 5f77 6964 7468 735b 305d 202b 2061 726d  _widths[0] + arm
+00031100: 5f77 6964 7468 735b 315d 202b 2032 202a  _widths[1] + 2 *
+00031110: 2078 630a 0a20 2020 2072 6574 7572 6e20   xc..    return 
+00031120: 440a 0a0a 2320 3d3d 3d3d 3d3d 3d3d 3d3d  D...# ==========
+00031130: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00031140: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00031150: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00031160: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00031170: 3d3d 3d3d 0a23 2045 7861 6d70 6c65 2063  ====.# Example c
+00031180: 6f64 650a 2320 3d3d 3d3d 3d3d 3d3d 3d3d  ode.# ==========
+00031190: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000311a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000311b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000311c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000311d0: 3d3d 3d3d 0a0a 2320 7920 3d20 7974 726f  ====..# y = ytro
+000311e0: 6e5f 726f 756e 6428 7268 6f20 3d20 312c  n_round(rho = 1,
+000311f0: 2061 726d 5f6c 656e 6774 6873 203d 2028   arm_lengths = (
+00031200: 3530 302c 3330 3029 2c20 2073 6f75 7263  500,300),  sourc
+00031210: 655f 6c65 6e67 7468 203d 2035 3030 2c0a  e_length = 500,.
+00031220: 2320 6172 6d5f 7769 6474 6873 203d 2028  # arm_widths = (
+00031230: 3230 302c 2032 3030 292c 2074 6865 7461  200, 200), theta
+00031240: 203d 2032 2e35 2c20 7468 6574 615f 7265   = 2.5, theta_re
+00031250: 736f 6c75 7469 6f6e 203d 2031 302c 0a23  solution = 10,.#
+00031260: 206c 6179 6572 203d 2030 290a 2320 7175   layer = 0).# qu
+00031270: 6963 6b70 6c6f 7428 7929 0a0a 0a23 2025  ickplot(y)...# %
+00031280: 250a                                     %.
```

### Comparing `phidl-1.6.4/phidl/path.py` & `phidl-1.7.0/phidl/path.py`

 * *Files 0% similar despite different names*

```diff
@@ -311,15 +311,15 @@
         (40, 0),
         (80, 40),
         (80, 10),
         (100, 10),
     ],
     radius=4,
     corner_fun=euler,
-    **kwargs
+    **kwargs,
 ):
     """Create a smooth path from a series of waypoints. Corners will be rounded
     using `corner_fun` and any additional key word arguments (for example,
     `use_eff = True` when `corner_fun = pp.euler`)
 
     Parameters
     ----------
@@ -434,15 +434,14 @@
         raise ValueError(
             """[PHIDL] transition() found no named sections in one
         or both inputs (cross_section1/cross_section2)."""
         )
 
     for alias in X1.aliases.keys():
         if alias in X2.aliases:
-
             offset1 = X1[alias]["offset"]
             offset2 = X2[alias]["offset"]
             width1 = X1[alias]["width"]
             width2 = X2[alias]["width"]
 
             if callable(offset1):
                 offset1 = offset1(1)
```

### Comparing `phidl-1.6.4/phidl/quickplotter.py` & `phidl-1.7.0/phidl/quickplotter.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,12 +1,13 @@
 # TODO: Allow toggling of layers with 1-9 keypresses
 # TODO: alias font should be slightly transparent
 
 
 import sys
+import warnings
 
 import gdspy
 import numpy as np
 
 import phidl
 from phidl.device_layout import (
     CellArray,
@@ -297,14 +298,16 @@
                 x=points[:, 0],
                 y=points[:, 1],
                 ax=ax,
                 linestyle="--",
                 linewidth=2,
                 color="b",
             )
+            _draw_arrow(ax=ax, x=points[-1, 0], y=points[-1, 1], angle=item.end_angle)
+            _draw_dot(ax=ax, x=points[0, 0], y=points[0, 1])
             bbox = _update_bbox(bbox, new_bbox)
 
     if bbox is None:
         bbox = [-1, -1, 1, 1]
     xmargin = (bbox[2] - bbox[0]) * 0.1 + 1e-9
     ymargin = (bbox[3] - bbox[1]) * 0.1 + 1e-9
     ax.set_xlim([bbox[0] - xmargin, bbox[2] + xmargin])
@@ -322,14 +325,26 @@
     except Exception:
         pass
 
     plt.draw()
     plt.show(block=blocking)
 
 
+def _draw_arrow(ax, x, y, angle):
+    from matplotlib.markers import MarkerStyle
+
+    rotated_marker = MarkerStyle(marker=9)
+    rotated_marker._transform = rotated_marker.get_transform().rotate_deg(angle)
+    ax.scatter(x, y, marker=rotated_marker, s=50, facecolors="b", alpha=0.5)
+
+
+def _draw_dot(ax, x, y):
+    ax.scatter(x, y, marker=".", color="b", s=50, alpha=0.9)
+
+
 def _use_interactive_zoom():
     """Checks whether the current matplotlib backend is compatible with
     interactive zoom"""
     import matplotlib
 
     if _quickplot_options["interactive_zoom"] is not None:
         return _quickplot_options["interactive_zoom"]
@@ -739,17 +754,15 @@
 
     def update_gridsize_label(self):
         self.gridsize_label.setText("grid size = " + str(self.grid_size_snapped))
         self.gridsize_label.move(QPoint(5, self.height() - 25))
 
     def update_mouse_position_label(self):
         self.position_label.setText(
-            "X = {:0.4f} / Y = {:0.4f}".format(
-                self.mouse_position[0], self.mouse_position[1]
-            )
+            f"X = {self.mouse_position[0]:0.4f} / Y = {self.mouse_position[1]:0.4f}"
         )
         self.position_label.move(QPoint(self.width() - 250, self.height() - 25))
 
     def update_help_label(self):
         self.help_label.setText('Press "?" key for help')
         self.help_label.move(QPoint(self.width() - 175, 0))
 
@@ -935,14 +948,22 @@
               F2: Show/hide ports
               F3: Show/hide subports (ports in underlying references)
             """
             QMessageBox.about(self, "PHIDL Help", help_str)
 
 
 def quickplot2(item_list, *args, **kwargs):
+    """
+    .. deprecated:: 1.6.4
+        `quickplot2` will be removed in April 2025, please replace with quickplot()
+    """
+    warnings.warn(
+        """[PHIDL] Warning: `quickplot2` will be removed in April 2025, please replace with quickplot() """
+    )
+
     if not qt_imported:
         raise ImportError(
             "PHIDL tried to import PyQt5 but it failed. PHIDL will"
             + "still work but quickplot2() may not.  Try using"
             + "quickplot() instead (based on matplotlib)"
         )
```

### Comparing `phidl-1.6.4/phidl/utilities.py` & `phidl-1.7.0/phidl/utilities.py`

 * *Files 1% similar despite different names*

```diff
@@ -10,15 +10,14 @@
     stipple_count = 0
 
     if filename[-4:] != ".lyp":
         filename = filename + ".lyp"
 
     # Opening file for writing
     with open("%s" % filename, "w+") as f:
-
         # Writing header string
         f.write('<?xml version="1.0" encoding="utf-8"?>\n')
 
         # Writing layer properties opener
         f.write("<layer-properties>\n")
 
         unsorted_layers = layerset._layers.values()
@@ -219,18 +218,15 @@
                 poly_str = '    <path style="fill:%s"\n          d="' % color
                 n = 0
                 for p in polygon:
                     if n == 0:
                         poly_str += "M "
                     else:
                         poly_str += "L "
-                    poly_str += "{:0.6f} {:0.6f} ".format(
-                        (p[0] - dx) * scale,
-                        (-(p[1] - dy) + ysize) * scale,
-                    )
+                    poly_str += f"{(p[0] - dx) * scale:0.6f} {(-(p[1] - dy) + ysize) * scale:0.6f} "
                     n += 1
                 poly_str += 'Z"/>\n'
                 f.write(poly_str)
             f.write("  </g>\n")
 
         f.write("</svg>\n")
     return filename
```

### Comparing `phidl-1.6.4/phidl.egg-info/PKG-INFO` & `phidl-1.7.0/phidl.egg-info/PKG-INFO`

 * *Files 4% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: phidl
-Version: 1.6.4
+Version: 1.7.0
 Summary: PHIDL
 Author: Adam McCaughan
 Author-email: amccaugh@gmail.com
 Description-Content-Type: text/markdown
 License-File: LICENSE
 
 [![pytest](https://github.com/amccaugh/phidl/actions/workflows/pytest.yml/badge.svg)](https://github.com/amccaugh/phidl/actions/workflows/pytest.yml)
@@ -12,16 +12,18 @@
 
 # PHIDL
 GDS scripting for Python that's intuitive, fast, and powerful.
 
 - [**Installation / requirements**](#installation--requirements)
 - [**Tutorial + examples**](https://phidl.readthedocs.io/en/latest/tutorials.html) (or [try an interactive notebook](https://mybinder.org/v2/gh/amccaugh/phidl/master?filepath=phidl_tutorial_example.ipynb))
 - [**Geometry library + function documentation**](https://phidl.readthedocs.io/en/latest/geometry_reference.html)
-- [Changelog](https://github.com/amccaugh/phidl/blob/master/CHANGELOG.md) (latest update 1.6.3 on July 20, 2023)
-    - New `pg.fill_rectangle()` [examples and documentation](https://phidl.readthedocs.io/en/latest/geometry_reference.html#Fill-tool)
+- [Changelog](https://github.com/amccaugh/phidl/blob/master/CHANGELOG.md) (latest update 1.7.0 on April 9, 2024)
+-  New KLayout-based boolean/offset/outline functions!  These are under the name `pg.kl_boolean()`, `pg.kl_offset`, `pg.kl_outline()`, `pg.kl_invert()`.  They utilize the excellent KLayout tile processor, which allows breaking down & parallelizing these operations--in a nutshell, these operations should be much, much faster, and they also are more robust than the gdspy/clipper implementation.
+-  To use these new functions, you must first `pip install klayout`
+
 
 # Citation
 
 If you found PHIDL useful, please consider citing it in (just one!) of your publications -- we appreciate it greatly. ([BibTeX](https://raw.githubusercontent.com/amccaugh/phidl/master/CITATION.bib))
  - McCaughan, A. N., et. al. PHIDL: Python-based layout and geometry creation for nanolithography. *J. Vac. Sci. Technol. B* 39, 062601 (2021). http://dx.doi.org/10.1116/6.0001203
 
 # Gallery
```

### Comparing `phidl-1.6.4/setup.py` & `phidl-1.7.0/setup.py`

 * *Files 16% similar despite different names*

```diff
@@ -15,15 +15,15 @@
 this_directory = path.abspath(path.dirname(__file__))
 with open(path.join(this_directory, "README.md"), encoding="utf-8") as f:
     long_description = f.read()
 
 
 setup(
     name="phidl",
-    version="1.6.4",
+    version="1.7.0",
     description="PHIDL",
     long_description=long_description,
     long_description_content_type="text/markdown",
     install_requires=install_requires,
     author="Adam McCaughan",
     author_email="amccaugh@gmail.com",
     packages=["phidl"],
```

### Comparing `phidl-1.6.4/tests/test_device.py` & `phidl-1.7.0/tests/test_device.py`

 * *Files identical despite different names*

### Comparing `phidl-1.6.4/tests/test_geometry.py` & `phidl-1.7.0/tests/test_geometry.py`

 * *Files 5% similar despite different names*

```diff
@@ -104,14 +104,79 @@
     A = pg.cross(length=10, width=3, layer=0)
     B = pg.ellipse(radii=(10, 5), angle_resolution=2.5, layer=1)
     D = pg.outline([A, B], distance=1, precision=1e-6, layer=2)
     h = D.hash_geometry(precision=1e-4)
     assert h == "503522b071080be6c98017cdc616752c1a3d75ce"
 
 
+# KLayout boolean functions
+def test_kl_offset():
+    A = pg.cross(length=20, width=3.1, layer=0)
+    B = pg.ellipse(radii=(10, 5), angle_resolution=2.5, layer=1)
+    D = pg.kl_offset(
+        [A, B],
+        distance=0.8,
+        precision=1e-4,
+        miter_mode=2,
+        tile_size=(1000, 1000),
+        merge_after=True,
+        layer=0,
+    )
+    h = D.hash_geometry(precision=1e-4)
+    assert h == "55733cfaedeafdbdd450acc6712feef6809e15f9"
+
+
+def test_kl_invert():
+    A = pg.cross(length=17, width=3.2, layer=0)
+    B = pg.ellipse(radii=(10, 5), angle_resolution=2.5, layer=1)
+    D = pg.kl_invert(
+        [A, B],
+        border=(10, 17.2),
+        precision=1e-4,
+        tile_size=(1000, 1000),
+        merge_after=True,
+        layer=0,
+    )
+    h = D.hash_geometry(precision=1e-4)
+    assert h == "1ae27a56b510f8bf6b90d0c89bec1a1f1d1e041a"
+
+
+def test_kl_boolean():
+    A = pg.cross(length=19, width=3.5, layer=0)
+    B = pg.ellipse(radii=(10, 5), angle_resolution=2.5, layer=1)
+    D = pg.kl_boolean(
+        A=A,
+        B=B,
+        operation="and",
+        precision=1e-6,
+        tile_size=(1000, 1000),
+        merge_after=True,
+        layer=0,
+    )
+    h = D.hash_geometry(precision=1e-4)
+    assert h == "eae9ef1c4e5a582add69fc0246218bcba4c013ec"
+
+
+def test_kl_outline():
+    A = pg.cross(length=19, width=3.7, layer=0)
+    B = pg.ellipse(radii=(10, 5), angle_resolution=2.5, layer=1)
+    D = pg.kl_outline(
+        [A, B],
+        distance=0.1,
+        open_ports=False,
+        precision=1e-4,
+        miter_mode=2,
+        tile_size=(1000, 1000),
+        merge_after=True,
+        layer=0,
+    )
+    h = D.hash_geometry(precision=1e-4)
+    assert h == "68cf77355b04a87ca68cbeafc7b2df9356783f2c"
+
+
 def test_port_geometry():
     # Conversion between object and geometric representation of ports
     def geom_equal(A, B):
         h1 = A.hash_geometry(precision=1e-4)
         h2 = B.hash_geometry(precision=1e-4)
         return h1 == h2
```

### Comparing `phidl-1.6.4/tests/test_path.py` & `phidl-1.7.0/tests/test_path.py`

 * *Files identical despite different names*

### Comparing `phidl-1.6.4/tests/test_routing.py` & `phidl-1.7.0/tests/test_routing.py`

 * *Files identical despite different names*

